import*as e from"three";import{Euler as t,Vector3 as i,Matrix4 as n,Color as s,Vector2 as r,MathUtils as o,ShaderMaterial as a,PlaneGeometry as l,Mesh as h,Plane as c,BackSide as d,Object3D as u,Raycaster as p,OrthographicCamera as f,BoxGeometry as m,Sprite as g,Quaternion as v,Vector4 as y,MeshBasicMaterial as x,CanvasTexture as w,SpriteMaterial as b,GridHelper as _,BufferGeometry as S,Float32BufferAttribute as M,Uint32BufferAttribute as C,Line3 as A,Box3 as E,Triangle as T,Sphere as P,BufferAttribute as O,FrontSide as D,Ray as B,DoubleSide as I,EdgesGeometry as R,LineBasicMaterial as k,LineSegments as L,Data3DTexture as z,RGBAFormat as U,UnsignedByteType as F,LinearFilter as N,InstancedMesh as j,Group as V,PointsMaterial as H,Texture as W,RepeatWrapping as G,ClampToEdgeWrapping as Y,Uniform as X,NoBlending as Q,WebGLRenderTarget as q,HalfFloatType as Z,Scene as K,Camera as J,MeshStandardMaterial as $,PerspectiveCamera as ee,DepthTexture as te,DepthFormat as ie,UnsignedShortType as ne,SRGBColorSpace as se,FloatType as re,Clock as oe,LinearSRGBColorSpace as ae,ShaderChunk as le,Material as he,MeshPhongMaterial as ce,AdditiveBlending as de,RawShaderMaterial as ue,GLSL3 as pe,Matrix3 as fe,Points as me,EventDispatcher as ge,InstancedBufferGeometry as ve,InstancedInterleavedBuffer as ye,InterleavedBufferAttribute as xe,DataTexture as we,UVMapping as be,UniformsLib as _e,QuadraticBezierCurve3 as Se,DynamicDrawUsage as Me,Uint16BufferAttribute as Ce,StaticDrawUsage as Ae,MirroredRepeatWrapping as Ee,NearestFilter as Te,NearestMipmapNearestFilter as Pe,NearestMipmapLinearFilter as Oe,LinearMipmapNearestFilter as De,LinearMipmapLinearFilter as Be,NeverDepth as Ie,AlwaysDepth as Re,LessDepth as ke,LessEqualDepth as Le,EqualDepth as ze,GreaterEqualDepth as Ue,GreaterDepth as Fe,NotEqualDepth as Ne,NormalBlending as je,SubtractiveBlending as Ve,MultiplyBlending as He,TangentSpaceNormalMap as We,ObjectSpaceNormalMap as Ge,MeshPhysicalMaterial as Ye,ArrowHelper as Xe,AxesHelper as Qe,Box3Helper as qe,BoxHelper as Ze,CameraHelper as Ke,DirectionalLightHelper as Je,HemisphereLightHelper as $e,PlaneHelper as et,PointLightHelper as tt,PolarGridHelper as it,SkeletonHelper as nt,SpotLightHelper as st,WireframeGeometry as rt,ShaderLib as ot,UniformsUtils as at,ShapeUtils as lt,Shape as ht,Path as ct,ExtrudeGeometry as dt,MeshLambertMaterial as ut,LineDashedMaterial as pt,REVISION as ft,SkinnedMesh as mt,TextureLoader as gt,AnimationObjectGroup as vt,AnimationMixer as yt,AnimationClip as xt,NumberKeyframeTrack as wt,VectorKeyframeTrack as bt,BooleanKeyframeTrack as _t,InterpolateDiscrete as St,ColorKeyframeTrack as Mt,Loader as Ct,Cache as At,Layers as Et,InstancedBufferAttribute as Tt,ObjectLoader as Pt,Bone as Ot,LineLoop as Dt,Line as Bt,LOD as It,BatchedMesh as Rt,LightProbe as kt,HemisphereLight as Lt,SpotLight as zt,RectAreaLight as Ut,PointLight as Ft,DirectionalLight as Nt,AmbientLight as jt,Fog as Vt,FogExp2 as Ht,ImageLoader as Wt,FileLoader as Gt,WebGLCubeRenderTarget as Yt,CubeCamera as Xt,CubeUVReflectionMapping as Qt,CylinderGeometry as qt,OctahedronGeometry as Zt,TorusGeometry as Kt,SphereGeometry as Jt,WebGLRenderer as $t,PCFSoftShadowMap as ei,PMREMGenerator as ti,EquirectangularReflectionMapping as ii,CubeTextureLoader as ni,CapsuleGeometry as si,CircleGeometry as ri,DodecahedronGeometry as oi,IcosahedronGeometry as ai,LatheGeometry as li,RingGeometry as hi,TetrahedronGeometry as ci,TorusKnotGeometry as di,TubeGeometry as ui,Spherical as pi,Frustum as fi,DataUtils as mi,Box2 as gi,ACESFilmicToneMapping as vi,ReinhardToneMapping as yi,EqualStencilFunc as xi,ShapeGeometry as wi,AlwaysStencilFunc as bi,IncrementWrapStencilOp as _i,BasicDepthPacking as Si,RGBADepthPacking as Mi,MeshDepthMaterial as Ci,NoColorSpace as Ai,MeshNormalMaterial as Ei,DepthStencilFormat as Ti,UnsignedInt248Type as Pi,UnsignedIntType as Oi,LuminanceFormat as Di,RedFormat as Bi,RGFormat as Ii,LoadingManager as Ri}from"three";import{FBXLoader as ki}from"three/examples/jsm/loaders/FBXLoader.js";import*as Li from"three/examples/jsm/loaders/GLTFLoader.js";import{GLTFLoader as zi}from"three/examples/jsm/loaders/GLTFLoader.js";import{OBJLoader as Ui}from"three/examples/jsm/loaders/OBJLoader.js";import{MeshoptDecoder as Fi}from"three/examples/jsm/libs/meshopt_decoder.module.js";import{DDSLoader as Ni}from"three/examples/jsm/loaders/DDSLoader.js";import{DRACOLoader as ji}from"three/examples/jsm/loaders/DRACOLoader.js";import{KTX2Loader as Vi}from"three/examples/jsm/loaders/KTX2Loader.js";import{MTLLoader as Hi}from"three/examples/jsm/loaders/MTLLoader.js";import{SVGLoader as Wi}from"three/examples/jsm/loaders/SVGLoader.js";import{RGBELoader as Gi}from"three/examples/jsm/loaders/RGBELoader.js";import{CSS2DObject as Yi}from"three/examples/jsm/renderers/CSS2DRenderer.js";import{CSS3DSprite as Xi,CSS3DObject as Qi,CSS3DRenderer as qi}from"three/examples/jsm/renderers/CSS3DRenderer.js";import*as Zi from"three/examples/jsm/utils/SkeletonUtils.js";import"three/examples/jsm/controls/TransformControls.js";import{Lut as Ki}from"three/examples/jsm/math/Lut.js";import{mergeVertices as Ji,mergeGeometries as $i,toCreasedNormals as en}from"three/examples/jsm/utils/BufferGeometryUtils.js";import"three/examples/jsm/lines/Line2.js";import"three/examples/jsm/lines/LineGeometry.js";import{LineMaterial as tn}from"three/examples/jsm/lines/LineMaterial.js";import{LineSegments2 as nn}from"three/examples/jsm/lines/LineSegments2.js";import{LineSegmentsGeometry as sn}from"three/examples/jsm/lines/LineSegmentsGeometry.js";import{RoomEnvironment as rn}from"three/examples/jsm/environments/RoomEnvironment.js";import{HDRCubeTextureLoader as on}from"three/examples/jsm/loaders/HDRCubeTextureLoader.js";import{ParametricGeometry as an}from"three/examples/jsm/geometries/ParametricGeometry.js";import*as ln from"three/examples/jsm/postprocessing/Pass.js";var hn=Object.freeze({__proto__:null,get AbstractDecoratorBehavior(){return RL},get ActionBehavior(){return UL},get ActionCallback(){return Dy},get ActionDelay(){return By},get ActionMotion(){return Iy},get ActionRepeat(){return Ty},get ActionTween(){return Oy},get ActionYoyo(){return Py},get Adapter(){return oR},get AddObject3DCommand(){return vU},get AnimateMarkerBase(){return YU},get AnimationBehavior(){return az},get AnimationTrack(){return oz},get AnimationTrackPlayback(){return rz},get Animator(){return BD},get AnimatorFrameMaterial(){return CA},get AnimatorModule(){return vz},get App(){return KH},get AppBase(){return Uw},get AppModuleBase(){return Fw},get AppObject(){return yy},get ApplyCollision(){return yI},get ApplyForce(){return GB},get ApplyRoute(){return Sk},get ApplySequences(){return fI},get AxisAngleGenerator(){return DB},get BaseCommand(){return sU},get BaseUVUnwrapper(){return ww},get BaseUvAtlas(){return aw},get BatchedRenderer(){return qI},get Behavior(){return IL},get BehaviorModule(){return lz},get BehaviorStatus(){return ML},get BetterRaycastingPoints(){return UE},get Bezier(){return dB},get BidirectionalMap(){return pv},get Billboard(){return nD},get BillboardModule(){return wL},get BitSet(){return ZW},get BlendFunction(){return CY},get BloomEffect(){return IX},get BoxHelper(){return zD},get BranchBehavior(){return ZL},get BreathingApertureMarker(){return XU},get BufferShader(){return GA},get ButtonGroupControl(){return nF},get CSS2DRendererModule(){return cH},get CSS3DRendererModule(){return dH},get CallFunctionCommand(){return lU},get CameraControls(){return BN},get CameraModule(){return kF},get CancelablePromise(){return gY},get CancelledCommandException(){return Ww},get CanvasUtils(){return $G},get ChangeEmitDirection(){return XB},get ChromaticAberrationEffect(){return kX},get CircleEmitter(){return TI},get ColorBySpeed(){return xI},get ColorDepthEffect(){return RX},get ColorGeneratorFromJSON(){return MB},get ColorOverLife(){return kB},get ColorRange(){return vB},get CommandHistory(){return dU},get CommandModule(){return mH},get CompositeBehavior(){return NL},get ConditionBehavior(){return tz},get ConditionalBehavior(){return kL},get ConeEmitter(){return EI},get ConstantColor(){return SB},get ConstantValue(){return CB},get ContextMenu(){return eF},get ConvolutionMaterial(){return EA},get CoordSystemModule(){return cV},get CopyPass(){return eX},get CubeEmitter(){return wk},get CustomShaderMaterial(){return yE},get DEFAULT_EASING(){return Ay},get DEG2RAD(){return _v},get DOM(){return bz},get DefaultTool(){return Mz},get DelayBehavior(){return FL},get DependencyError(){return sy},get DepthOfFieldEffect(){return LX},get DepthPass(){return oX},get DepthPickingPass(){return cX},get DestoryBehavior(){return HL},get DiffusedApertureMarker(){return QU},get DispatchEvent(){return _y},get DonutEmitter(){return PI},get DotScreenEffect(){return zX},get DrawShapeTool(){return wU},get DynamicEnvironment(){return yL},get DynamicInstancedMesh(){return gA},get Easings(){return Ey},get EdgeDetectionMode(){return AY},get Effect(){return BX},get EffectAttribute(){return EY},get EffectComposer(){return SX},get EffectPass(){return pX},get EmitSubParticleSystem(){return KB},get EmitterFromJSON(){return LI},get EmitterMode(){return CI},get EmitterShapes(){return kI},get Entity(){return UP},get EntityBase(){return Nw},get EntityManagerModule(){return uH},get EntityModuleBase(){return Sy},get EntityOutlineModule(){return pH},get EntityQueryModule(){return oV},get Environment(){return cL},get EulerGenerator(){return BB},get EventDispatcher(){return Kv},get EventModule(){return fF},get ExtrudeMesh(){return tT},get FXAAEffect(){return UX},get FailingBehavior(){return YL},get FillExtrusionsEntity(){return qO},get FillExtrusionsModule(){return QO},get FilterBehavior(){return KL},get FixedSizeMeshMaterial(){return yA},get FlowMaterial(){return wA},get FluorescenceMarker(){return qU},get FontManager(){return WE},get ForceOverLife(){return FB},get FrameOverLife(){return VB},get FullScreenQuad(){return pL},get FullscreenControl(){return uF},get GeneratorFromJSON(){return RB},get GeoBounds(){return Yb},get GeoPoint(){return Nb},get GeoProjection(){return qb},get GlLinesEntity(){return KO},get GlLinesModule(){return ZO},get GlitchEffect(){return VX},get GlitchMode(){return PY},get GodRaysEffect(){return GX},get Gradient(){return wB},get Graph(){return HG},get GraphNodeType(){return dR},get GravityForce(){return YB},get Grid(){return Jw},get GridEmitter(){return II},get GridHelperModule(){return tb},get HaloRingMarker(){return ZU},get Heatmap(){return WD},get HemisphereEmitter(){return BI},get HolographicMaterial(){return bE},get HyperbolicHelicoidGeometry(){return ZG},get IgnoreFailureBehavior(){return $L},get InputModule(){return hV},get InstancedMeshEntity(){return NP},get InstancedMeshModule(){return vA},get InteractiveEvent(){return by},get InteractiveObject(){return rV},get Interpolation(){return Zb},get Interpreter(){return lR},get IntervalValue(){return AB},get InvertStatusBehavior(){return iz},get KawaseBlurPass(){return fX},get KernelSize(){return OY},get LODRaycast(){return lY},get Label(){return KE},get LabelMaterial(){return qE},get LabelPool(){return JE},get LambdaPass(){return mX},get LimitSpeedOverLife(){return _I},get Line2(){return cO},get LineGeometry(){return hO},get LineMaterial(){return YP},get LineSegments2(){return lO},get LineSegmentsGeometry(){return GP},get LinearToSRGB(){return gx},get LoadManager(){return eL},get LoaderManager(){return Ck},get LogMessageBehavior(){return LL},get Logger(){return ny},get MapHeightNode(){return oY},get MapNode(){return iY},get MapNodeGeometry(){return nY},get MapNodeHeightGeometry(){return rY},get MapOpenWay(){return Rk},get MapPlaneNode(){return sY},get MapProvider(){return mY},get MapThreeLayer(){return RP},get MapUtils(){return hY},get MapView(){return fY},get MapViewEntity(){return yY},get Marker2D(){return UU},get Marker3D(){return GU},get MeshEntity(){return FP},get MeshLine(){return CT},get MeshLineGeometry(){return yT},get MeshLineMaterial(){return MT},get MeshModule(){return mA},get MeshReflectorMaterial(){return OA},get MeshSurfaceEmitter(){return RI},get MeshTransmissionMaterial(){return YA},get MiniMapControl(){return pF},get ModelModule(){return yz},get ModuleBase(){return xy},get ModuleManager(){return wy},get MousePositionControl(){return dF},get MultiCmdsCommand(){return cU},get Node(){return sR},get NodeDef(){return cR},get NodeGraph(){return hk},get NodeParticle(){return aB},get NodeType(){return hR},get NodeTypes(){return uR},get NodeVFX(){return fk},get NodeValueType(){return eR},get Noise(){return dI},get NormalPass(){return xX},get OrbitControlModule(){return RN},get OrbitOverLife(){return HB},get OrderIndex(){return gy},get OutlineEffect(){return YX},get OutlineModule(){return _L},get Outlines(){return rD},get OutputNodeTypeNames(){return lk},get OverrideMaterialManager(){return AX},get PackedMipMapGenerator(){return gL},get ParallelBehavior(){return jL},get ParallelBehaviorPolicy(){return AL},get ParticleEmitter(){return sB},get ParticleLoader(){return ZI},get ParticleModule(){return gz},get ParticlePlugins(){return KI},get ParticleRenderModule(){return gH},get ParticleSystem(){return WI},get Pass(){return $Y},get PathAnimateModule(){return gF},get PathEmitter(){return bk},get PathGeometry(){return IT},get PathPointList(){return BT},get PathTubeEntities(){return iD},get PathTubeGeometry(){return kT},get PhysicsManagerModule(){return VH},get PhysicsModule(){return mF},get PickModule(){return fH},get PickTool(){return LU},get PiecewiseBezier(){return TB},get PiecewiseFunction(){return EB},get PixelationEffect(){return XX},get PluginManager(){return qk},get Plugins(){return Zk},get PointEmitter(){return OI},get PointerDragHelper(){return Vy},get PolygonsEntity(){return XO},get PolygonsModule(){return YO},get PolylinesEntity(){return GO},get PolylinesModule(){return WO},get Popup2D(){return HU},get PostProcessModule(){return sV},get PredicationMode(){return DY},get Projection(){return Qb},get PromiseBehavior(){return WL},get PushValueCommand(){return fU},get QuadTreePosition(){return tY},get RAD2DEG(){return Sv},get RadarMaterial(){return wE},get RandomColor(){return gB},get RandomColorBetweenGradient(){return _B},get RandomQuatGenerator(){return OB},get RayQueryType(){return PP},get RecordState(){return hB},get RectCollideModule(){return vH},get ReflectorBlurMaterial(){return GD},get ReflectorDudvMaterial(){return AE},get ReflectorMaterial(){return ME},get ReflectorObject(){return YD},get Render3dTexture(){return FA},get RenderMode(){return zI},get RenderPass(){return rX},get RepeatBehavior(){return XL},get RepeatUntilFailureBehavior(){return JL},get RepeatUntilSuccessBehavior(){return ez},get ResManager(){return iL},get ResStatus(){return Mk},get ResourceManager(){return tL},get RotatingApertureMarker(){return KU},get RotatingTextBorderMarker(){return JU},get Rotation3DOverLife(){return UB},get RotationBehavior(){return sz},get RotationBySpeed(){return bI},get RotationGeneratorFromJSON(){return IB},get RotationOverLife(){return LB},get RunningTween(){return Ry},get SMAAEffect(){return KX},get SMAAPreset(){return BY},get SRGBToLinear(){return mx},get SSAOEffect(){return JX},get SceneModule(){return VF},get Scheduler(){return Qw},get ScreenQuad(){return kD},get SelectiveBloomEffect(){return QX},get SelectorBehavior(){return nz},get SendEventBehavior(){return zL},get SequenceBehavior(){return VL},get SequencerFromJSON(){return pI},get Serialization(){return Ex},get Service(){return Vk},get SetDataCommand(){return gU},get SetEmitDirection(){return _k},get SetMaterialMapCommand(){return rU},get SetMultipleValuesCommand(){return hU},get SetPositionCommand(){return pU},get SetRotationCommand(){return uU},get SetScaleCommand(){return mU},get SetValueCommand(){return oU},get ShaderPass(){return wX},get ShadertoyMaterial(){return jA},get ShadertoyTexture(){return HA},get ShapeType2(){return OH},get Signal(){return cy},get SignalHandler(){return ay},get SimpleEventDispatcher(){return Fy},get SimulationFromJSON(){return MI},get SimulationTypes(){return SI},get SizeBySpeed(){return wI},get SizeOverLife(){return NB},get SpeedOverLife(){return jB},get SphereEmitter(){return DI},get SphubeGeometry(){return KG},get SpriteAnimatorEntity(){return VP},get SpriteAnimatorModule(){return BL},get SpriteBatch(){return XI},get SpriteImages(){return PD},get SpriteImagesEntity(){return $O},get SpriteImagesModule(){return fz},get SpriteMarker(){return TD},get SpriteMarkerEntity(){return JO},get SpriteMarkerModule(){return pz},get SpriteParticle(){return lB},get SpriteTexts(){return OD},get SpriteTextsEntity(){return eD},get SpriteTextsModule(){return mz},get StatModule(){return nV},get StateNode(){return _z},get Store(){return Cy},get SubParticleEmitMode(){return ZB},get SucceedingBehavior(){return GL},get SymbolEntity(){return jP},get SymbolModule(){return FE},get TYPED_ARRAYS(){return Zy},get TextureEffect(){return $X},get TextureSequencer(){return uI},get TextureUtils(){return eY},get Time(){return ry},get ToneMappingEffect(){return eQ},get ToneMappingMode(){return IY},get ToolStateModule(){return xH},get TrailBatch(){return QI},get TrailLine(){return cD},get TrailLineEntity(){return tD},get TrailParticle(){return cB},get TransformControls(){return bU},get TransformControlsGizmo(){return _U},get TransformControlsPlane(){return SU},get TransformTool(){return IU},get TurbulenceField(){return oI},get Tween(){return ky},get TweenManager(){return Ly},get UVUnwrapper(){return bw},get UiConfigMethods(){return gP},get UiConfigRendererBase(){return xP},get UiConfigTypeMap(){return KT},get UiModule(){return QH},get UiPanelJsonConfig(){return yP},get UnitsUtils(){return cY},get UpdateValueCommand(){return aU},get UvAtlasWebWorker(){return xw},get VFXBatch(){return UI},get ValueGeneratorFromJSON(){return PB},get VariableTubeGeometry(){return XG},get ViewHelper(){return $w},get WaitForEventBehavior(){return QL},get WebGLRendererModule(){return CF},get WebGPUCompiler(){return gk},get WidthOverLength(){return WB},get Wire(){return rR},get Wireframe(){return pO},get WireframeGeometry2(){return fO},get XHRUtils(){return vY},get __DEV(){return sQ},get __buildDate(){return tQ},get __buildVerNo(){return nQ},get __buildVersion(){return iQ},get absMax(){return Kx},get acceleratedRaycast(){return QC},get addResourceRefCount(){return aW},get addScript(){return vG},get aesGcmDecrypt(){return Rx},get aesGcmEncrypt(){return Ix},get anchorOrigin(){return wz},get anchorTranslate(){return xz},get animation(){return zy},get animationAsync(){return Uy},get applyMixins(){return cv},get approxArrayEquals(){return Bv},get approxEquals(){return Tv},get approxZero(){return Ev},get arrayBufferToBase64(){return Qy},get base64ToArrayBuffer(){return qy},get bindAll(){return gv},get blobToDataURL(){return cx},get buildPathTubeTopo(){return GG},get buildTopoGraph(){return WG},get cameraDistance2NdcZ(){return nW},get cameraWorldDirection(){return wW},get canvasFlipY(){return Nx},get clamp(){return Mv},get clearBit(){return $x},get cloneDeep(){return fv},get cloneMaterial(){return TW},get closestPointOnPolyline(){return pS},get closestPointOnPolylines(){return fS},get closestPointOnSegment(){return lS},get closestToSegment3d(){return uS},get colorToDataUrl(){return vx},get computeBoundsTree(){return qC},get containSkeleton(){return hW},get convertToMaterialParameters(){return qw},get copyProps(){return Cx},get creataMeasureRuler(){return aL},get createAnimatorFrameSpriteMaterial(){return AA},get createCanvasElement(){return Hy},get createDefaultMarkerElement(){return zU},get createDiv(){return Wy},get createFlowGradientMaterial(){return xE},get createFlyline(){return xL},get createImage(){return Gy},get createLabel(){return eT},get createMapApp(){return DP},get createReflectorShaderMesh(){return nL},get createRender2dTexture(){return IA},get createRenderElementFlowMaterial(){return bA},get createScreenSpaceEntity(){return AW},get createScriptFromURL(){return Xy},get createSpriteAnimator(){return hD},get createStyles(){return Yy},get createSymbolMaterial(){return xA},get createTextFlowMaterial(){return _A},get createTextMesh(){return lD},get createUnProjectMenu(){return IG},get createWallBufferGeometry(){return JG},get createWorker(){return pw},get createWorkerWrap(){return yw},get css(){return rx},get debounce(){return lv},get decryptFromBase64(){return Ik},get deepAccessObject(){return ew},get default(){return rQ},get degToRad(){return Wv},get deleteArrItem(){return hv},get disableBloom(){return mW},get disableBloomSelectedRayQuery(){return vW},get disableOutline(){return gW},get disableRayQuery(){return pW},get disableSelected(){return fW},get dispatchViaProxy(){return fy},get disposeBoundsTree(){return ZC},get disposeMaterial(){return PW},get disposeObject3D(){return lW},get dist2d(){return wG},get downloadBlob(){return hx},get downloadFile(){return dx},get embedUrlRefs(){return Xx},get enableMaterialVerticeOpacity(){return DW},get enableRealisticRender(){return zG},get enableSRGBColorSpace(){return kG},get enableShadow(){return UG},get encryptToBase64(){return Bk},get escapeRegExp(){return tx},get eventKeyCode(){return sG},get eventXY(){return hG},get expandLine(){return NW},get explodeGroup(){return RG},get exportRenderTarget(){return gG},get extend(){return vv},get extrudeGeoJSON(){return rS},get extrudePolygon(){return iS},get extrudePolyline(){return nS},get findShortestPath(){return YG},get findSignalHandlerIndexByHandle(){return dy},get findSignalHandlerIndexByHandleAndContext(){return uy},get flatModel(){return jG},get fromDist(){return kW},get fromWorld(){return IW},get genDefaultForNodeValueType(){return nR},get generateUUID(){return uv},get generateUiConfig(){return $T},get generateUiFolder(){return eP},get geoBounds(){return Xb},get geoPoint(){return jb},get getAlignOfNodeValueType(){return tR},get getBoundingBox(){return dW},get getEmptyMeta(){return UT},get getEntityParents(){return Pk},get getEnvmapFromHDRTexture(){return FG},get getEnvmapFromScene(){return NG},get getFilenameFromPath(){return ex},get getFilterColorMatrix(){return Hv},get getFrustum(){return OG},get getFrustumFromHeight(){return DG},get getFullscreenTriangle(){return EG},get getKeyByValue(){return tw},get getObjectAnchorPoint(){return uW},get getObjectOwnerEntity(){return Ek},get getObjectRefCount(){return rW},get getOrCall(){return Mx},get getOwerScene(){return Tk},get getPhysicsResolver(){return vI},get getPropertyDescriptor(){return bx},get getScreenSpaceBox(){return PG},get getShapeParameters(){return DH},get getSizeOfNodeValueType(){return iR},get getSphericalCube(){return TG},get getTypedArray(){return Ky},get getUrlQueryParam(){return nw},get getValueFromEmitterMode(){return AI},get glsl(){return sx},get highlightMaterial(){return ib},get html(){return ox},get htmlToCanvas(){return qx},get htmlToPng(){return Zx},get htmlToSvg(){return Qx},get httpHelper(){return jk},get iMaterialUI(){return FT},get imageBitmapToBase64(){return kx},get imageDataToCanvas(){return Ux},get imageToCanvas(){return zx},get imageUrlToImageData(){return Lx},get includesAll(){return yx},get infinityToMaxNumber(){return Rv},get interpolatePointsByRatio(){return YW},get intersectLine3D(){return SG},get isAltKeyDown(){return nG},get isCtrlKeyDown(){return iG},get isDeleteKey(){return aG},get isEnterKey(){return rG},get isEscKey(){return oG},get isGeoPointLike(){return Vb},get isLeftButton(){return JW},get isMapMode(){return CW},get isMiddleButton(){return $W},get isObjectBehindCamera(){return iW},get isObjectOcclude(){return sW},get isPointInPolygon(){return yG},get isPropertyWritable(){return _x},get isRightButton(){return eG},get isShiftKeyDown(){return tG},get isWebpExportSupported(){return Fx},get lerp(){return Cv},get lerpCameras(){return BG},get lerpCoordinates(){return xG},get lerpEuler(){return Av},get line3dSplit(){return CG},get lineDistance(){return WW},get lineIntersection(){return k_},get lineSlice(){return GW},get lineSplit(){return gS},get loadImage(){return cG},get loadParticlePlugin(){return JI},get loadPhysicsEngine(){return LH},get loadPlugin3dtiles(){return Jk},get loadPluginAlgorithm(){return Kk},get longestCommonPrefix(){return nx},get makeBasicMaterialUiConfig(){return NT},get makeCameraUiConfig(){return zP},get makeColorSvg(){return jx},get makeColorSvgCircle(){return Vx},get makeGeomertyUiConfig(){return WT},get makeLightUiConfig(){return wP},get makeMaterialUiConfig(){return HT},get makeObject3DUiConfig(){return LP},get makePhongMaterialUiConfig(){return jT},get makePhysicalMaterialUiConfig(){return VT},get makeSamplerUi(){return zT},get makeTextSvg(){return Hx},get map2dUtils(){return BP},get max2(){return Uv},get max3(){return Lv},get maxNumberToInfinity(){return kv},get maxValue(){return Pv},get min2(){return Fv},get min3(){return zv},get minValue(){return Ov},get mobileAndTabletCheck(){return fx},get multiLine3dSplit(){return AG},get multiLineSplit(){return vS},get now(){return jy},get object2Entity(){return Ak},get objectHasOwn(){return iw},get objectTransformToMatrix(){return cW},get offsetCoords(){return bG},get offsetPolygon(){return W_},get onChange(){return Tx},get onChange2(){return Px},get onChange3(){return Ox},get openMapDarkStyle(){return Hk},get openMapLightStyle(){return Wk},get optimizeModelRender(){return LG},get parseFileExtension(){return $y},get pathJoin(){return rw},get pick(){return mv},get pointDistance(){return HW},get pointToSegmentDistance(){return aS},get prettyScrollbar(){return lx},get preventDefaultEvent(){return lG},get pushObjectStatus(){return wv},get radToDeg(){return Gv},get randColor(){return bW},get randHtmlColor(){return _W},get randInt(){return Dv},get randPoint2D(){return MW},get randPoint3D(){return SW},get reactivity(){return nv},get registerShaderChunks(){return nB},get remoteWorkerURL(){return ow},get render2d(){return Of},get renderTargetToDataUrl(){return uG},get replaceAll(){return ix},get resetUV(){return yW},get roundToStep(){return Iv},get safeSetProperty(){return Sx},get segmentIntersect(){return mS},get segmentIntersect3d(){return MG},get serializable(){return Bx},get serialize(){return Dx},get setMaterialOpacity(){return OW},get setPhysicsResolver(){return gI},get setUrlQueryParam(){return sw},get shaderMaterial(){return Zw},get simplifyPoints(){return C_},get sleep(){return xv},get smoothPoints(){return jv},get strMd5(){return yv},get svgToCanvas(){return Wx},get svgToPng(){return Gx},get svgUrl(){return ax},get tea(){return Ok},get texImageToCanvas(){return mG},get textureDataToImageData(){return dG},get textureToCanvas(){return fG},get textureToDataUrl(){return pG},get threeToCannon(){return BH},get throttle(){return av},get timeout(){return Ny},get toDist(){return RW},get toTitleCase(){return Jy},get toVector3(){return Vv},get toWorld(){return BW},get transform(){return Gb},get traverseMaterial(){return EW},get triangle2dArea(){return z_},get triangulatFlatten(){return F_},get triangulate(){return U_},get uiButton(){return lP},get uiColor(){return dP},get uiConfig(){return iP},get uiContainer(){return nP},get uiDropdown(){return aP},get uiFolderContainer(){return mP},get uiImage(){return uP},get uiInput(){return hP},get uiMonitor(){return sP},get uiNumber(){return cP},get uiPanelContainer(){return fP},get uiSlider(){return rP},get uiToggle(){return pP},get uiVector(){return oP},get unloadParticlePlugin(){return $I},get updateBit(){return Jx},get uploadFile(){return ux},get uploadFileGetContent(){return px},get useFBO(){return UA},get workerLink(){return vw},get workerProxy(){return mw},get workerTransfer(){return gw},get workerWrap(){return fw}});class cn{constructor(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1}}const dn=new class{constructor(){this.browser=new cn,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow="undefined"!=typeof window}};"object"==typeof wx&&"function"==typeof wx.getSystemInfoSync?(dn.wxa=!0,dn.touchEventsSupported=!0):"undefined"==typeof document&&"undefined"!=typeof self?dn.worker=!0:"undefined"==typeof navigator||0===navigator.userAgent.indexOf("Node.js")?(dn.node=!0,dn.svgSupported=!0):function(e,t){const i=t.browser,n=e.match(/Firefox\/([\d.]+)/),s=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/.+?rv:(([\d.]+))/),r=e.match(/Edge?\/([\d.]+)/),o=/micromessenger/i.test(e);n&&(i.firefox=!0,i.version=n[1]),s&&(i.ie=!0,i.version=s[1]),r&&(i.edge=!0,i.version=r[1],i.newEdge=+r[1].split(".")[0]>18),o&&(i.weChat=!0),t.svgSupported="undefined"!=typeof SVGRect,t.touchEventsSupported="ontouchstart"in window&&!i.ie&&!i.edge,t.pointerEventsSupported="onpointerdown"in window&&(i.edge||i.ie&&+i.version>=11),t.domSupported="undefined"!=typeof document;const a=document.documentElement.style;t.transform3dSupported=(i.ie&&"transition"in a||i.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in a)&&!("OTransition"in a),t.transformSupported=t.transform3dSupported||i.ie&&+i.version>=9}(navigator.userAgent,dn);const un=12,pn="sans-serif",fn=`${un}px ${pn}`,mn=function(e){const t={};if("undefined"==typeof JSON)return t;for(let e=0;e<95;e++){const i=String.fromCharCode(e+32),n=("007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N".charCodeAt(e)-20)/100;t[i]=n}return t}(),gn={createCanvas:()=>"undefined"!=typeof document&&document.createElement("canvas"),measureText:function(){let e,t;return(i,n)=>{if(!e){const t=gn.createCanvas();e=t&&t.getContext("2d")}if(e)return t!==n&&(t=e.font=n||fn),e.measureText(i);{i=i||"";const e=/(\d+)px/.exec(n=n||fn),t=e&&+e[1]||un;let s=0;if(n.indexOf("mono")>=0)s=t*i.length;else for(let e=0;e<i.length;e++){const n=mn[i[e]];s+=null==n?t:n*t}return{width:s}}}}(),loadImage(e,t,i){const n=new Image;return n.onload=t,n.onerror=i,n.src=e,n}},vn=jn(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],((e,t)=>(e["[object "+t+"]"]=!0,e)),{}),yn=jn(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],((e,t)=>(e["[object "+t+"Array]"]=!0,e)),{}),xn=Object.prototype.toString,wn=Array.prototype,bn=wn.forEach,_n=wn.filter,Sn=wn.slice,Mn=wn.map,Cn=function(){}.constructor,An=Cn?Cn.prototype:null,En="__proto__";let Tn=2311;function Pn(){return Tn++}function On(...e){"undefined"!=typeof console&&console.error.apply(console,e)}function Dn(e){if(null==e||"object"!=typeof e)return e;let t=e;const i=xn.call(e);if("[object Array]"===i){if(!hs(e)){t=[];for(let i=0,n=e.length;i<n;i++)t[i]=Dn(e[i])}}else if(yn[i]){if(!hs(e)){const i=e.constructor;if(i.from)t=i.from(e);else{t=new i(e.length);for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}}}else if(!vn[i]&&!hs(e)&&!Jn(e)){t={};for(let i in e)e.hasOwnProperty(i)&&i!==En&&(t[i]=Dn(e[i]))}return t}function Bn(e,t,i){if(!qn(t)||!qn(e))return i?Dn(t):e;for(let n in t)if(t.hasOwnProperty(n)&&n!==En){const s=e[n],r=t[n];!qn(r)||!qn(s)||Gn(r)||Gn(s)||Jn(r)||Jn(s)||Zn(r)||Zn(s)||hs(r)||hs(s)?!i&&n in e||(e[n]=Dn(t[n])):Bn(s,r,i)}return e}function In(e,t){if(Object.assign)Object.assign(e,t);else for(let i in t)t.hasOwnProperty(i)&&i!==En&&(e[i]=t[i]);return e}function Rn(e,t,i){const n=Hn(t);for(let s=0;s<n.length;s++){let r=n[s];(i?null!=t[r]:null==e[r])&&(e[r]=t[r])}return e}const kn=gn.createCanvas;function Ln(e,t){if(e){if(e.indexOf)return e.indexOf(t);for(let i=0,n=e.length;i<n;i++)if(e[i]===t)return i}return-1}function zn(e,t,i){if(e="prototype"in e?e.prototype:e,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames){const n=Object.getOwnPropertyNames(t);for(let s=0;s<n.length;s++){const r=n[s];"constructor"!==r&&(i?null!=t[r]:null==e[r])&&(e[r]=t[r])}}else Rn(e,t,i)}function Un(e){return!!e&&"string"!=typeof e&&"number"==typeof e.length}function Fn(e,t,i){if(e&&t)if(e.forEach&&e.forEach===bn)e.forEach(t,i);else if(e.length===+e.length)for(let n=0,s=e.length;n<s;n++)t.call(i,e[n],n,e);else for(let n in e)e.hasOwnProperty(n)&&t.call(i,e[n],n,e)}function Nn(e,t,i){if(!e)return[];if(!t)return ss(e);if(e.map&&e.map===Mn)return e.map(t,i);{const n=[];for(let s=0,r=e.length;s<r;s++)n.push(t.call(i,e[s],s,e));return n}}function jn(e,t,i,n){if(e&&t){for(let s=0,r=e.length;s<r;s++)i=t.call(n,i,e[s],s,e);return i}}function Vn(e,t,i){if(!e)return[];if(!t)return ss(e);if(e.filter&&e.filter===_n)return e.filter(t,i);{const n=[];for(let s=0,r=e.length;s<r;s++)t.call(i,e[s],s,e)&&n.push(e[s]);return n}}function Hn(e){if(!e)return[];if(Object.keys)return Object.keys(e);let t=[];for(let i in e)e.hasOwnProperty(i)&&t.push(i);return t}const Wn=An&&Yn(An.bind)?An.call.bind(An.bind):function(e,t,...i){return function(){return e.apply(t,i.concat(Sn.call(arguments)))}};function Gn(e){return Array.isArray?Array.isArray(e):"[object Array]"===xn.call(e)}function Yn(e){return"function"==typeof e}function Xn(e){return"string"==typeof e}function Qn(e){return"number"==typeof e}function qn(e){const t=typeof e;return"function"===t||!!e&&"object"===t}function Zn(e){return!!vn[xn.call(e)]}function Kn(e){return!!yn[xn.call(e)]}function Jn(e){return"object"==typeof e&&"number"==typeof e.nodeType&&"object"==typeof e.ownerDocument}function $n(e){return null!=e.colorStops}function es(e){return null!=e.image}function ts(e){return e!=e}function is(e,t){return null!=e?e:t}function ns(e,t,i){return null!=e?e:null!=t?t:i}function ss(e,...t){return Sn.apply(e,t)}function rs(e){if("number"==typeof e)return[e,e,e,e];const t=e.length;return 2===t?[e[0],e[1],e[0],e[1]]:3===t?[e[0],e[1],e[2],e[1]]:e}function os(e,t){if(!e)throw new Error(t)}function as(e){return null==e?null:"function"==typeof e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}const ls="__ec_primitive__";function hs(e){return e[ls]}class cs{constructor(){this.data={}}delete(e){const t=this.has(e);return t&&delete this.data[e],t}has(e){return this.data.hasOwnProperty(e)}get(e){return this.data[e]}set(e,t){return this.data[e]=t,this}keys(){return Hn(this.data)}forEach(e){const t=this.data;for(const i in t)t.hasOwnProperty(i)&&e(t[i],i)}}const ds="function"==typeof Map;class us{constructor(e){const t=Gn(e);this.data=ds?new Map:new cs;const i=this;function n(e,n){t?i.set(e,n):i.set(n,e)}e instanceof us?e.each(n):e&&Fn(e,n)}hasKey(e){return this.data.has(e)}get(e){return this.data.get(e)}set(e,t){return this.data.set(e,t),t}each(e,t){this.data.forEach(((i,n)=>{e.call(t,i,n)}))}keys(){const e=this.data.keys();return ds?Array.from(e):e}removeKey(e){this.data.delete(e)}}function ps(e,t){let i;if(Object.create)i=Object.create(e);else{const t=function(){};t.prototype=e,i=new t}return t&&In(i,t),i}function fs(e){const t=e.style;t.webkitUserSelect="none",t.userSelect="none",t.webkitTapHighlightColor="rgba(0,0,0,0)",t["-webkit-touch-callout"]="none"}function ms(e,t){return e.hasOwnProperty(t)}function gs(){}const vs=180/Math.PI;var ys=Object.freeze({__proto__:null,HashMap:us,RADIAN_TO_DEGREE:vs,assert:os,bind:Wn,clone:Dn,concatArray:function(e,t){const i=new e.constructor(e.length+t.length);for(let t=0;t<e.length;t++)i[t]=e[t];const n=e.length;for(let e=0;e<t.length;e++)i[e+n]=t[e];return i},createCanvas:kn,createHashMap:function(e){return new us(e)},createObject:ps,curry:function(e,...t){return function(){return e.apply(this,t.concat(Sn.call(arguments)))}},defaults:Rn,disableUserSelect:fs,each:Fn,eqNaN:ts,extend:In,filter:Vn,find:function(e,t,i){if(e&&t)for(let n=0,s=e.length;n<s;n++)if(t.call(i,e[n],n,e))return e[n]},guid:Pn,hasOwn:ms,indexOf:Ln,inherits:function(e,t){const i=e.prototype;function n(){}n.prototype=t.prototype,e.prototype=new n;for(let t in i)i.hasOwnProperty(t)&&(e.prototype[t]=i[t]);e.prototype.constructor=e,e.superClass=t},isArray:Gn,isArrayLike:Un,isBuiltInObject:Zn,isDom:Jn,isFunction:Yn,isGradientObject:$n,isImagePatternObject:es,isNumber:Qn,isObject:qn,isPrimitive:hs,isRegExp:function(e){return"[object RegExp]"===xn.call(e)},isString:Xn,isStringSafe:function(e){return"[object String]"===xn.call(e)},isTypedArray:Kn,keys:Hn,logError:On,map:Nn,merge:Bn,mergeAll:function(e,t){let i=e[0];for(let n=1,s=e.length;n<s;n++)i=Bn(i,e[n],t);return i},mixin:zn,noop:gs,normalizeCssArray:rs,reduce:jn,retrieve:function(...e){for(let t=0,i=e.length;t<i;t++)if(null!=e[t])return e[t]},retrieve2:is,retrieve3:ns,setAsPrimitive:function(e){e[ls]=!0},slice:ss,trim:as});function xs(e,t){return null==e&&(e=0),null==t&&(t=0),[e,t]}function ws(e){return[e[0],e[1]]}function bs(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function _s(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function Ss(e){return Math.sqrt(Cs(e))}const Ms=Ss;function Cs(e){return e[0]*e[0]+e[1]*e[1]}const As=Cs;function Es(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function Ts(e,t){const i=Ss(t);return 0===i?(e[0]=0,e[1]=0):(e[0]=t[0]/i,e[1]=t[1]/i),e}function Ps(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}const Os=Ps;function Ds(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}const Bs=Ds;function Is(e,t,i,n){return e[0]=t[0]+n*(i[0]-t[0]),e[1]=t[1]+n*(i[1]-t[1]),e}function Rs(e,t,i){const n=t[0],s=t[1];return e[0]=i[0]*n+i[2]*s+i[4],e[1]=i[1]*n+i[3]*s+i[5],e}function ks(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function Ls(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}var zs=Object.freeze({__proto__:null,add:bs,applyTransform:Rs,clone:ws,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},create:xs,dist:Os,distSquare:Bs,distance:Ps,distanceSquare:Ds,div:function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},len:Ss,lenSquare:Cs,length:Ms,lengthSquare:As,lerp:Is,max:Ls,min:ks,mul:function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e},negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},normalize:Ts,scale:Es,scaleAndAdd:function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e},set:function(e,t,i){return e[0]=t,e[1]=i,e},sub:_s});class Us{constructor(e,t){this.target=e,this.topTarget=t&&t.topTarget}}class Fs{constructor(e){this.handler=e,e.on("mousedown",this._dragStart,this),e.on("mousemove",this._drag,this),e.on("mouseup",this._dragEnd,this)}_dragStart(e){let t=e.target;for(;t&&!t.draggable;)t=t.parent||t.__hostTarget;t&&(this._draggingTarget=t,t.dragging=!0,this._x=e.offsetX,this._y=e.offsetY,this.handler.dispatchToElement(new Us(t,e),"dragstart",e.event))}_drag(e){const t=this._draggingTarget;if(t){const i=e.offsetX,n=e.offsetY,s=i-this._x,r=n-this._y;this._x=i,this._y=n,t.drift(s,r,e),this.handler.dispatchToElement(new Us(t,e),"drag",e.event);const o=this.handler.findHover(i,n,t).target,a=this._dropTarget;this._dropTarget=o,t!==o&&(a&&o!==a&&this.handler.dispatchToElement(new Us(a,e),"dragleave",e.event),o&&o!==a&&this.handler.dispatchToElement(new Us(o,e),"dragenter",e.event))}}_dragEnd(e){const t=this._draggingTarget;t&&(t.dragging=!1),this.handler.dispatchToElement(new Us(t,e),"dragend",e.event),this._dropTarget&&this.handler.dispatchToElement(new Us(this._dropTarget,e),"drop",e.event),this._draggingTarget=null,this._dropTarget=null}}class Ns{constructor(e){e&&(this._$eventProcessor=e)}on(e,t,i,n){this._$handlers||(this._$handlers={});const s=this._$handlers;if("function"==typeof t&&(n=i,i=t,t=null),!i||!e)return this;const r=this._$eventProcessor;null!=t&&r&&r.normalizeQuery&&(t=r.normalizeQuery(t)),s[e]||(s[e]=[]);for(let t=0;t<s[e].length;t++)if(s[e][t].h===i)return this;const o={h:i,query:t,ctx:n||this,callAtLast:i.zrEventfulCallAtLast},a=s[e].length-1,l=s[e][a];return l&&l.callAtLast?s[e].splice(a,0,o):s[e].push(o),this}isSilent(e){const t=this._$handlers;return!t||!t[e]||!t[e].length}off(e,t){const i=this._$handlers;if(!i)return this;if(!e)return this._$handlers={},this;if(t){if(i[e]){const n=[];for(let s=0,r=i[e].length;s<r;s++)i[e][s].h!==t&&n.push(i[e][s]);i[e]=n}i[e]&&0===i[e].length&&delete i[e]}else delete i[e];return this}trigger(e,...t){if(!this._$handlers)return this;const i=this._$handlers[e],n=this._$eventProcessor;if(i){const s=t.length,r=i.length;for(let o=0;o<r;o++){const r=i[o];if(!n||!n.filter||null==r.query||n.filter(e,r.query))switch(s){case 0:r.h.call(r.ctx);break;case 1:r.h.call(r.ctx,t[0]);break;case 2:r.h.call(r.ctx,t[0],t[1]);break;default:r.h.apply(r.ctx,t)}}}return n&&n.afterTrigger&&n.afterTrigger(e),this}triggerWithContext(e,...t){if(!this._$handlers)return this;const i=this._$handlers[e],n=this._$eventProcessor;if(i){const s=t.length,r=t[s-1],o=i.length;for(let a=0;a<o;a++){const o=i[a];if(!n||!n.filter||null==o.query||n.filter(e,o.query))switch(s){case 0:o.h.call(r);break;case 1:o.h.call(r,t[0]);break;case 2:o.h.call(r,t[0],t[1]);break;default:o.h.apply(r,t.slice(1,s-1))}}}return n&&n.afterTrigger&&n.afterTrigger(e),this}}const js=Math.log(2);function Vs(e,t,i,n,s,r){const o=n+"-"+s,a=e.length;if(r.hasOwnProperty(o))return r[o];if(1===t){const t=Math.round(Math.log((1<<a)-1&~s)/js);return e[i][t]}const l=n|1<<i;let h=i+1;for(;n&1<<h;)h++;let c=0;for(let n=0,o=0;n<a;n++){const a=1<<n;a&s||(c+=(o%2?-1:1)*e[i][n]*Vs(e,t-1,h,l,s|a,r),o++)}return r[o]=c,c}const Hs="___zrEVENTSAVED";function Ws(e){return"CANVAS"===e.nodeName.toUpperCase()}const Gs=/([&<>"'])/g,Ys={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Xs=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Qs=[],qs=dn.browser.firefox&&+dn.browser.version.split(".")[0]<39;function Zs(e,t,i,n){return i=i||{},n?Ks(e,t,i):qs&&null!=t.layerX&&t.layerX!==t.offsetX?(i.zrX=t.layerX,i.zrY=t.layerY):null!=t.offsetX?(i.zrX=t.offsetX,i.zrY=t.offsetY):Ks(e,t,i),i}function Ks(e,t,i){if(dn.domSupported&&e.getBoundingClientRect){const n=t.clientX,s=t.clientY;if(Ws(e)){const t=e.getBoundingClientRect();return i.zrX=n-t.left,void(i.zrY=s-t.top)}if(function(e,t,i,n,s){if(t.getBoundingClientRect&&dn.domSupported&&!Ws(t)){const s=t[Hs]||(t[Hs]={}),r=function(e,t){let i=t.markers;if(i)return i;i=t.markers=[];const n=["left","right"],s=["top","bottom"];for(let t=0;t<4;t++){const r=document.createElement("div"),o=t%2,a=(t>>1)%2;r.style.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",n[o]+":0",s[a]+":0",n[1-o]+":auto",s[1-a]+":auto",""].join("!important;"),e.appendChild(r),i.push(r)}return i}(t,s),o=function(e,t,i){const n="trans",s=t[n],r=t.srcCoords,o=[],a=[];let l=!0;for(let t=0;t<4;t++){const i=e[t].getBoundingClientRect(),n=2*t,s=i.left,h=i.top;o.push(s,h),l=l&&r&&s===r[n]&&h===r[n+1],a.push(e[t].offsetLeft,e[t].offsetTop)}return l&&s?s:(t.srcCoords=o,t[n]=function(e,t){const i=[[e[0],e[1],1,0,0,0,-t[0]*e[0],-t[0]*e[1]],[0,0,0,e[0],e[1],1,-t[1]*e[0],-t[1]*e[1]],[e[2],e[3],1,0,0,0,-t[2]*e[2],-t[2]*e[3]],[0,0,0,e[2],e[3],1,-t[3]*e[2],-t[3]*e[3]],[e[4],e[5],1,0,0,0,-t[4]*e[4],-t[4]*e[5]],[0,0,0,e[4],e[5],1,-t[5]*e[4],-t[5]*e[5]],[e[6],e[7],1,0,0,0,-t[6]*e[6],-t[6]*e[7]],[0,0,0,e[6],e[7],1,-t[7]*e[6],-t[7]*e[7]]],n={},s=Vs(i,8,0,0,0,n);if(0===s)return;const r=[];for(let e=0;e<8;e++)for(let o=0;o<8;o++)null==r[o]&&(r[o]=0),r[o]+=((e+o)%2?-1:1)*Vs(i,7,0===e?1:0,1<<e,1<<o,n)/s*t[e];return function(e,t,i){const n=t*r[6]+i*r[7]+1;e[0]=(t*r[0]+i*r[1]+r[2])/n,e[1]=(t*r[3]+i*r[4]+r[5])/n}}(o,a))}(r,s);if(o)return o(e,i,n),!0}return!1}(Qs,e,n,s))return i.zrX=Qs[0],void(i.zrY=Qs[1])}i.zrX=i.zrY=0}function Js(e){return e||window.event}function $s(e,t,i){if(null!=(t=Js(t)).zrX)return t;const n=t.type;if(n&&n.indexOf("touch")>=0){const s="touchend"!==n?t.targetTouches[0]:t.changedTouches[0];s&&Zs(e,s,t,i)}else{Zs(e,t,t,i);const n=function(e){const t=e.wheelDelta;if(t)return t;const i=e.deltaX,n=e.deltaY;return null==i||null==n?t:3*(0!==n?Math.abs(n):Math.abs(i))*(n>0?-1:n<0?1:i>0?-1:1)}(t);t.zrDelta=n?n/120:-(t.detail||0)/3}const s=t.button;return null==t.which&&void 0!==s&&Xs.test(t.type)&&(t.which=1&s?1:2&s?3:4&s?2:0),t}class er{constructor(){this._track=[]}recognize(e,t,i){return this._doTrack(e,t,i),this._recognize(e)}clear(){return this._track.length=0,this}_doTrack(e,t,i){const n=e.touches;if(!n)return;const s={points:[],touches:[],target:t,event:e};for(let e=0,t=n.length;e<t;e++){const t=n[e],r=Zs(i,t,{});s.points.push([r.zrX,r.zrY]),s.touches.push(t)}this._track.push(s)}_recognize(e){for(let t in ir)if(ir.hasOwnProperty(t)){const i=ir[t](this._track,e);if(i)return i}}}function tr(e){const t=e[1][0]-e[0][0],i=e[1][1]-e[0][1];return Math.sqrt(t*t+i*i)}const ir={pinch:function(e,t){const i=e.length;if(!i)return;const n=(e[i-1]||{}).points,s=(e[i-2]||{}).points||n;if(s&&s.length>1&&n&&n.length>1){let i=tr(n)/tr(s);!isFinite(i)&&(i=1),t.pinchScale=i;const o=[((r=n)[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2];return t.pinchX=o[0],t.pinchY=o[1],{type:"pinch",target:e[0].target,event:t}}var r}};function nr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function sr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function rr(e,t,i){const n=t[0]*i[0]+t[2]*i[1],s=t[1]*i[0]+t[3]*i[1],r=t[0]*i[2]+t[2]*i[3],o=t[1]*i[2]+t[3]*i[3],a=t[0]*i[4]+t[2]*i[5]+t[4],l=t[1]*i[4]+t[3]*i[5]+t[5];return e[0]=n,e[1]=s,e[2]=r,e[3]=o,e[4]=a,e[5]=l,e}function or(e,t,i){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+i[0],e[5]=t[5]+i[1],e}function ar(e,t,i,n=[0,0]){const s=t[0],r=t[2],o=t[4],a=t[1],l=t[3],h=t[5],c=Math.sin(i),d=Math.cos(i);return e[0]=s*d+a*c,e[1]=-s*c+a*d,e[2]=r*d+l*c,e[3]=-r*c+d*l,e[4]=d*(o-n[0])+c*(h-n[1])+n[0],e[5]=d*(h-n[1])-c*(o-n[0])+n[1],e}function lr(e,t,i){const n=i[0],s=i[1];return e[0]=t[0]*n,e[1]=t[1]*s,e[2]=t[2]*n,e[3]=t[3]*s,e[4]=t[4]*n,e[5]=t[5]*s,e}function hr(e,t){const i=t[0],n=t[2],s=t[4],r=t[1],o=t[3],a=t[5];let l=i*o-r*n;return l?(l=1/l,e[0]=o*l,e[1]=-r*l,e[2]=-n*l,e[3]=i*l,e[4]=(n*a-o*s)*l,e[5]=(r*s-i*a)*l,e):null}var cr=Object.freeze({__proto__:null,clone:function(e){const t=[1,0,0,1,0,0];return sr(t,e),t},copy:sr,create:function(){return[1,0,0,1,0,0]},identity:nr,invert:hr,mul:rr,rotate:ar,scale:lr,translate:or});class dr{constructor(e,t){this.x=e||0,this.y=t||0}copy(e){return this.x=e.x,this.y=e.y,this}clone(){return new dr(this.x,this.y)}set(e,t){return this.x=e,this.y=t,this}equal(e){return e.x===this.x&&e.y===this.y}add(e){return this.x+=e.x,this.y+=e.y,this}scale(e){this.x*=e,this.y*=e}scaleAndAdd(e,t){this.x+=e.x*t,this.y+=e.y*t}sub(e){return this.x-=e.x,this.y-=e.y,this}dot(e){return this.x*e.x+this.y*e.y}len(){return Math.sqrt(this.x*this.x+this.y*this.y)}lenSquare(){return this.x*this.x+this.y*this.y}normalize(){const e=this.len();return this.x/=e,this.y/=e,this}distance(e){const t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)}distanceSquare(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}negate(){return this.x=-this.x,this.y=-this.y,this}transform(e){if(!e)return;const t=this.x,i=this.y;return this.x=e[0]*t+e[2]*i+e[4],this.y=e[1]*t+e[3]*i+e[5],this}toArray(e){return e[0]=this.x,e[1]=this.y,e}fromArray(e){this.x=e[0],this.y=e[1]}static set(e,t,i){e.x=t,e.y=i}static copy(e,t){e.x=t.x,e.y=t.y}static len(e){return Math.sqrt(e.x*e.x+e.y*e.y)}static lenSquare(e){return e.x*e.x+e.y*e.y}static dot(e,t){return e.x*t.x+e.y*t.y}static add(e,t,i){e.x=t.x+i.x,e.y=t.y+i.y}static sub(e,t,i){e.x=t.x-i.x,e.y=t.y-i.y}static scale(e,t,i){e.x=t.x*i,e.y=t.y*i}static scaleAndAdd(e,t,i,n){e.x=t.x+i.x*n,e.y=t.y+i.y*n}static lerp(e,t,i,n){const s=1-n;e.x=s*t.x+n*i.x,e.y=s*t.y+n*i.y}}const ur=Math.min,pr=Math.max,fr=new dr,mr=new dr,gr=new dr,vr=new dr,yr=new dr,xr=new dr;class wr{constructor(e,t,i,n){i<0&&(e+=i,i=-i),n<0&&(t+=n,n=-n),this.x=e,this.y=t,this.width=i,this.height=n}union(e){const t=ur(e.x,this.x),i=ur(e.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=pr(e.x+e.width,this.x+this.width)-t:this.width=e.width,isFinite(this.y)&&isFinite(this.height)?this.height=pr(e.y+e.height,this.y+this.height)-i:this.height=e.height,this.x=t,this.y=i}applyTransform(e){wr.applyTransform(this,this,e)}calculateTransform(e){const t=this,i=e.width/t.width,n=e.height/t.height,s=[1,0,0,1,0,0];return or(s,s,[-t.x,-t.y]),lr(s,s,[i,n]),or(s,s,[e.x,e.y]),s}intersect(e,t){if(!e)return!1;e instanceof wr||(e=wr.create(e));const i=this,n=i.x,s=i.x+i.width,r=i.y,o=i.y+i.height,a=e.x,l=e.x+e.width,h=e.y,c=e.y+e.height;let d=!(s<a||l<n||o<h||c<r);if(t){let e=1/0,t=0;const i=Math.abs(s-a),d=Math.abs(l-n),u=Math.abs(o-h),p=Math.abs(c-r),f=Math.min(i,d),m=Math.min(u,p);s<a||l<n?f>t&&(t=f,i<d?dr.set(xr,-i,0):dr.set(xr,d,0)):f<e&&(e=f,i<d?dr.set(yr,i,0):dr.set(yr,-d,0)),o<h||c<r?m>t&&(t=m,u<p?dr.set(xr,0,-u):dr.set(xr,0,p)):f<e&&(e=f,u<p?dr.set(yr,0,u):dr.set(yr,0,-p))}return t&&dr.copy(t,d?yr:xr),d}contain(e,t){const i=this;return e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height}clone(){return new wr(this.x,this.y,this.width,this.height)}copy(e){wr.copy(this,e)}plain(){return{x:this.x,y:this.y,width:this.width,height:this.height}}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isZero(){return 0===this.width||0===this.height}static create(e){return new wr(e.x,e.y,e.width,e.height)}static copy(e,t){e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height}static applyTransform(e,t,i){if(!i)return void(e!==t&&wr.copy(e,t));if(i[1]<1e-5&&i[1]>-1e-5&&i[2]<1e-5&&i[2]>-1e-5){const n=i[0],s=i[3],r=i[4],o=i[5];return e.x=t.x*n+r,e.y=t.y*s+o,e.width=t.width*n,e.height=t.height*s,e.width<0&&(e.x+=e.width,e.width=-e.width),void(e.height<0&&(e.y+=e.height,e.height=-e.height))}fr.x=gr.x=t.x,fr.y=vr.y=t.y,mr.x=vr.x=t.x+t.width,mr.y=gr.y=t.y+t.height,fr.transform(i),vr.transform(i),mr.transform(i),gr.transform(i),e.x=ur(fr.x,mr.x,gr.x,vr.x),e.y=ur(fr.y,mr.y,gr.y,vr.y);const n=pr(fr.x,mr.x,gr.x,vr.x),s=pr(fr.y,mr.y,gr.y,vr.y);e.width=n-e.x,e.height=s-e.y}}const br="silent";function _r(){!function(e){e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0}(this.event)}class Sr extends Ns{constructor(){super(...arguments),this.handler=null}dispose(){}setCursor(){}}class Mr{constructor(e,t){this.x=e,this.y=t}}const Cr=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],Ar=new wr(0,0,0,0);class Er extends Ns{constructor(e,t,i,n,s){super(),this._hovered=new Mr(0,0),this.storage=e,this.painter=t,this.painterRoot=n,this._pointerSize=s,i=i||new Sr,this.proxy=null,this.setHandlerProxy(i),this._draggingMgr=new Fs(this)}setHandlerProxy(e){this.proxy&&this.proxy.dispose(),e&&(Fn(Cr,(function(t){e.on&&e.on(t,this[t],this)}),this),e.handler=this),this.proxy=e}mousemove(e){const t=e.zrX,i=e.zrY,n=Or(this,t,i);let s=this._hovered,r=s.target;r&&!r.__zr&&(s=this.findHover(s.x,s.y),r=s.target);const o=this._hovered=n?new Mr(t,i):this.findHover(t,i),a=o.target,l=this.proxy;l.setCursor&&l.setCursor(a?a.cursor:"default"),r&&a!==r&&this.dispatchToElement(s,"mouseout",e),this.dispatchToElement(o,"mousemove",e),a&&a!==r&&this.dispatchToElement(o,"mouseover",e)}mouseout(e){const t=e.zrEventControl;"only_globalout"!==t&&this.dispatchToElement(this._hovered,"mouseout",e),"no_globalout"!==t&&this.trigger("globalout",{type:"globalout",event:e})}resize(){this._hovered=new Mr(0,0)}dispatch(e,t){const i=this[e];i&&i.call(this,t)}dispose(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null}setCursorStyle(e){const t=this.proxy;t.setCursor&&t.setCursor(e)}dispatchToElement(e,t,i){let n=(e=e||{}).target;if(n&&n.silent)return;const s="on"+t,r=function(e,t,i){return{type:e,event:i,target:t.target,topTarget:t.topTarget,cancelBubble:!1,offsetX:i.zrX,offsetY:i.zrY,gestureEvent:i.gestureEvent,pinchX:i.pinchX,pinchY:i.pinchY,pinchScale:i.pinchScale,wheelDelta:i.zrDelta,zrByTouch:i.zrByTouch,which:i.which,stop:_r}}(t,e,i);for(;n&&(n[s]&&(r.cancelBubble=!!n[s].call(n,r)),n.trigger(t,r),n=n.__hostTarget?n.__hostTarget:n.parent,!r.cancelBubble););r.cancelBubble||(this.trigger(t,r),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer((function(e){"function"==typeof e[s]&&e[s].call(e,r),e.trigger&&e.trigger(t,r)})))}findHover(e,t,i){const n=this.storage.getDisplayList(),s=new Mr(e,t);if(Pr(n,s,e,t,i),this._pointerSize&&!s.target){const r=[],o=this._pointerSize,a=o/2,l=new wr(e-a,t-a,o,o);for(let e=n.length-1;e>=0;e--){const t=n[e];t===i||t.ignore||t.ignoreCoarsePointer||t.parent&&t.parent.ignoreCoarsePointer||(Ar.copy(t.getBoundingRect()),t.transform&&Ar.applyTransform(t.transform),Ar.intersect(l)&&r.push(t))}if(r.length){const n=4,o=Math.PI/12,l=2*Math.PI;for(let h=0;h<a;h+=n)for(let n=0;n<l;n+=o)if(Pr(r,s,e+h*Math.cos(n),t+h*Math.sin(n),i),s.target)return s}}return s}processGesture(e,t){this._gestureMgr||(this._gestureMgr=new er);const i=this._gestureMgr;"start"===t&&i.clear();const n=i.recognize(e,this.findHover(e.zrX,e.zrY,null).target,this.proxy.dom);if("end"===t&&i.clear(),n){const t=n.type;e.gestureEvent=t;let i=new Mr;i.target=n.target,this.dispatchToElement(i,t,n.event)}}}function Tr(e,t,i){if(e[e.rectHover?"rectContain":"contain"](t,i)){let n,s=e,r=!1;for(;s;){if(s.ignoreClip&&(r=!0),!r){let e=s.getClipPath();if(e&&!e.contain(t,i))return!1;s.silent&&(n=!0)}s=s.__hostTarget||s.parent}return!n||br}return!1}function Pr(e,t,i,n,s){for(let r=e.length-1;r>=0;r--){const o=e[r];let a;if(o!==s&&!o.ignore&&(a=Tr(o,i,n))&&(!t.topTarget&&(t.topTarget=o),a!==br)){t.target=o;break}}}function Or(e,t,i){const n=e.painter;return t<0||t>n.getWidth()||i<0||i>n.getHeight()}function Dr(e,t,i,n){var s=t+1;if(s===i)return 1;if(n(e[s++],e[t])<0){for(;s<i&&n(e[s],e[s-1])<0;)s++;!function(e,t,i){for(i--;t<i;){var n=e[t];e[t++]=e[i],e[i--]=n}}(e,t,s)}else for(;s<i&&n(e[s],e[s-1])>=0;)s++;return s-t}function Br(e,t,i,n,s){for(n===t&&n++;n<i;n++){for(var r,o=e[n],a=t,l=n;a<l;)s(o,e[r=a+l>>>1])<0?l=r:a=r+1;var h=n-a;switch(h){case 3:e[a+3]=e[a+2];case 2:e[a+2]=e[a+1];case 1:e[a+1]=e[a];break;default:for(;h>0;)e[a+h]=e[a+h-1],h--}e[a]=o}}function Ir(e,t,i,n,s,r){var o=0,a=0,l=1;if(r(e,t[i+s])>0){for(a=n-s;l<a&&r(e,t[i+s+l])>0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a),o+=s,l+=s}else{for(a=s+1;l<a&&r(e,t[i+s-l])<=0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a);var h=o;o=s-l,l=s-h}for(o++;o<l;){var c=o+(l-o>>>1);r(e,t[i+c])>0?o=c+1:l=c}return l}function Rr(e,t,i,n,s,r){var o=0,a=0,l=1;if(r(e,t[i+s])<0){for(a=s+1;l<a&&r(e,t[i+s-l])<0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a);var h=o;o=s-l,l=s-h}else{for(a=n-s;l<a&&r(e,t[i+s+l])>=0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a),o+=s,l+=s}for(o++;o<l;){var c=o+(l-o>>>1);r(e,t[i+c])<0?l=c:o=c+1}return l}Fn(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],(function(e){Er.prototype[e]=function(t){const i=t.zrX,n=t.zrY,s=Or(this,i,n);let r,o;if("mouseup"===e&&s||(r=this.findHover(i,n),o=r.target),"mousedown"===e)this._downEl=o,this._downPoint=[t.zrX,t.zrY],this._upEl=o;else if("mouseup"===e)this._upEl=o;else if("click"===e){if(this._downEl!==this._upEl||!this._downPoint||Os(this._downPoint,[t.zrX,t.zrY])>4)return;this._downPoint=null}this.dispatchToElement(r,e,t)}}));let kr,Lr=!1;function zr(){Lr||(Lr=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function Ur(e,t){return e.zlevel===t.zlevel?e.z===t.z?e.z2-t.z2:e.z-t.z:e.zlevel-t.zlevel}class Fr{constructor(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=Ur}traverse(e,t){for(let i=0;i<this._roots.length;i++)this._roots[i].traverse(e,t)}getDisplayList(e,t){t=t||!1;const i=this._displayList;return!e&&i.length||this.updateDisplayList(t),i}updateDisplayList(e){this._displayListLen=0;const t=this._roots,i=this._displayList;for(let i=0,n=t.length;i<n;i++)this._updateAndAddDisplayable(t[i],null,e);i.length=this._displayListLen,function(e,t,i,n){i||(i=0),n||(n=e.length);var s=n-i;if(!(s<2)){var r=0;if(s<32)Br(e,i,n,i+(r=Dr(e,i,n,t)),t);else{var o=function(e,t){let i,n,s=7,r=0;e.length;var o=[];function a(a){var l=i[a],h=n[a],c=i[a+1],d=n[a+1];n[a]=h+d,a===r-3&&(i[a+1]=i[a+2],n[a+1]=n[a+2]),r--;var u=Rr(e[c],e,l,h,0,t);l+=u,0!=(h-=u)&&0!==(d=Ir(e[l+h-1],e,c,d,d-1,t))&&(h<=d?function(i,n,r,a){var l=0;for(l=0;l<n;l++)o[l]=e[i+l];var h=0,c=r,d=i;if(e[d++]=e[c++],0!=--a)if(1!==n){for(var u,p,f,m=s;;){u=0,p=0,f=!1;do{if(t(e[c],o[h])<0){if(e[d++]=e[c++],p++,u=0,0==--a){f=!0;break}}else if(e[d++]=o[h++],u++,p=0,1==--n){f=!0;break}}while((u|p)<m);if(f)break;do{if(0!==(u=Rr(e[c],o,h,n,0,t))){for(l=0;l<u;l++)e[d+l]=o[h+l];if(d+=u,h+=u,(n-=u)<=1){f=!0;break}}if(e[d++]=e[c++],0==--a){f=!0;break}if(0!==(p=Ir(o[h],e,c,a,0,t))){for(l=0;l<p;l++)e[d+l]=e[c+l];if(d+=p,c+=p,0==(a-=p)){f=!0;break}}if(e[d++]=o[h++],1==--n){f=!0;break}m--}while(u>=7||p>=7);if(f)break;m<0&&(m=0),m+=2}if(s=m,s<1&&(s=1),1===n){for(l=0;l<a;l++)e[d+l]=e[c+l];e[d+a]=o[h]}else{if(0===n)throw new Error;for(l=0;l<n;l++)e[d+l]=o[h+l]}}else{for(l=0;l<a;l++)e[d+l]=e[c+l];e[d+a]=o[h]}else for(l=0;l<n;l++)e[d+l]=o[h+l]}(l,h,c,d):function(i,n,r,a){var l=0;for(l=0;l<a;l++)o[l]=e[r+l];var h=i+n-1,c=a-1,d=r+a-1,u=0,p=0;if(e[d--]=e[h--],0!=--n)if(1!==a){for(var f=s;;){var m=0,g=0,v=!1;do{if(t(o[c],e[h])<0){if(e[d--]=e[h--],m++,g=0,0==--n){v=!0;break}}else if(e[d--]=o[c--],g++,m=0,1==--a){v=!0;break}}while((m|g)<f);if(v)break;do{if(0!=(m=n-Rr(o[c],e,i,n,n-1,t))){for(n-=m,p=1+(d-=m),u=1+(h-=m),l=m-1;l>=0;l--)e[p+l]=e[u+l];if(0===n){v=!0;break}}if(e[d--]=o[c--],1==--a){v=!0;break}if(0!=(g=a-Ir(e[h],o,0,a,a-1,t))){for(a-=g,p=1+(d-=g),u=1+(c-=g),l=0;l<g;l++)e[p+l]=o[u+l];if(a<=1){v=!0;break}}if(e[d--]=e[h--],0==--n){v=!0;break}f--}while(m>=7||g>=7);if(v)break;f<0&&(f=0),f+=2}if(s=f,s<1&&(s=1),1===a){for(p=1+(d-=n),u=1+(h-=n),l=n-1;l>=0;l--)e[p+l]=e[u+l];e[d]=o[c]}else{if(0===a)throw new Error;for(u=d-(a-1),l=0;l<a;l++)e[u+l]=o[l]}}else{for(p=1+(d-=n),u=1+(h-=n),l=n-1;l>=0;l--)e[p+l]=e[u+l];e[d]=o[c]}else for(u=d-(a-1),l=0;l<a;l++)e[u+l]=o[l]}(l,h,c,d))}return i=[],n=[],{mergeRuns:function(){for(;r>1;){var e=r-2;if(e>=1&&n[e-1]<=n[e]+n[e+1]||e>=2&&n[e-2]<=n[e]+n[e-1])n[e-1]<n[e+1]&&e--;else if(n[e]>n[e+1])break;a(e)}},forceMergeRuns:function(){for(;r>1;){var e=r-2;e>0&&n[e-1]<n[e+1]&&e--,a(e)}},pushRun:function(e,t){i[r]=e,n[r]=t,r+=1}}}(e,t),a=function(e){for(var t=0;e>=32;)t|=1&e,e>>=1;return e+t}(s);do{if((r=Dr(e,i,n,t))<a){var l=s;l>a&&(l=a),Br(e,i,i+l,i+r,t),r=l}o.pushRun(i,r),o.mergeRuns(),s-=r,i+=r}while(0!==s);o.forceMergeRuns()}}}(i,Ur)}_updateAndAddDisplayable(e,t,i){if(e.ignore&&!i)return;e.beforeUpdate(),e.update(),e.afterUpdate();const n=e.getClipPath();if(e.ignoreClip)t=null;else if(n){t=t?t.slice():[];let i=n,s=e;for(;i;)i.parent=s,i.updateTransform(),t.push(i),s=i,i=i.getClipPath()}if(e.childrenRef){const n=e.childrenRef();for(let s=0;s<n.length;s++){const r=n[s];e.__dirty&&(r.__dirty|=1),this._updateAndAddDisplayable(r,t,i)}e.__dirty=0}else{const i=e;t&&t.length?i.__clipPaths=t:i.__clipPaths&&i.__clipPaths.length>0&&(i.__clipPaths=[]),isNaN(i.z)&&(zr(),i.z=0),isNaN(i.z2)&&(zr(),i.z2=0),isNaN(i.zlevel)&&(zr(),i.zlevel=0),this._displayList[this._displayListLen++]=i}const s=e.getDecalElement&&e.getDecalElement();s&&this._updateAndAddDisplayable(s,t,i);const r=e.getTextGuideLine();r&&this._updateAndAddDisplayable(r,t,i);const o=e.getTextContent();o&&this._updateAndAddDisplayable(o,t,i)}addRoot(e){e.__zr&&e.__zr.storage===this||this._roots.push(e)}delRoot(e){if(e instanceof Array){for(let t=0,i=e.length;t<i;t++)this.delRoot(e[t]);return}const t=Ln(this._roots,e);t>=0&&this._roots.splice(t,1)}delAllRoots(){this._roots=[],this._displayList=[],this._displayListLen=0}getRoots(){return this._roots}dispose(){this._displayList=null,this._roots=null}}kr=dn.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){return setTimeout(e,16)};var Nr=kr;const jr={linear:e=>e,quadraticIn:e=>e*e,quadraticOut:e=>e*(2-e),quadraticInOut:e=>(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1),cubicIn:e=>e*e*e,cubicOut:e=>--e*e*e+1,cubicInOut:e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2),quarticIn:e=>e*e*e*e,quarticOut:e=>1- --e*e*e*e,quarticInOut:e=>(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),quinticIn:e=>e*e*e*e*e,quinticOut:e=>--e*e*e*e*e+1,quinticInOut:e=>(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),sinusoidalIn:e=>1-Math.cos(e*Math.PI/2),sinusoidalOut:e=>Math.sin(e*Math.PI/2),sinusoidalInOut:e=>.5*(1-Math.cos(Math.PI*e)),exponentialIn:e=>0===e?0:Math.pow(1024,e-1),exponentialOut:e=>1===e?1:1-Math.pow(2,-10*e),exponentialInOut:e=>0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1))),circularIn:e=>1-Math.sqrt(1-e*e),circularOut:e=>Math.sqrt(1- --e*e),circularInOut:e=>(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),elasticIn(e){let t,i=.1;return 0===e?0:1===e?1:(!i||i<1?(i=1,t=.1):t=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},elasticOut(e){let t,i=.1;return 0===e?0:1===e?1:(!i||i<1?(i=1,t=.1):t=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},elasticInOut(e){let t,i=.1;return 0===e?0:1===e?1:(!i||i<1?(i=1,t=.1):t=.4*Math.asin(1/i)/(2*Math.PI),(e*=2)<1?i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)},backIn(e){let t=1.70158;return e*e*((t+1)*e-t)},backOut(e){let t=1.70158;return--e*e*((t+1)*e+t)+1},backInOut(e){let t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:e=>1-jr.bounceOut(1-e),bounceOut:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,bounceInOut:e=>e<.5?.5*jr.bounceIn(2*e):.5*jr.bounceOut(2*e-1)+.5},Vr=Math.pow,Hr=Math.sqrt,Wr=1e-8,Gr=1e-4,Yr=Hr(3),Xr=1/3,Qr=xs(),qr=xs(),Zr=xs();function Kr(e){return e>-Wr&&e<Wr}function Jr(e){return e>Wr||e<-Wr}function $r(e,t,i,n,s){const r=1-s;return r*r*(r*e+3*s*t)+s*s*(s*n+3*r*i)}function eo(e,t,i,n,s){const r=1-s;return 3*(((t-e)*r+2*(i-t)*s)*r+(n-i)*s*s)}function to(e,t,i,n,s,r){const o=n+3*(t-i)-e,a=3*(i-2*t+e),l=3*(t-e),h=e-s,c=a*a-3*o*l,d=a*l-9*o*h,u=l*l-3*a*h;let p=0;if(Kr(c)&&Kr(d))if(Kr(a))r[0]=0;else{const e=-l/a;e>=0&&e<=1&&(r[p++]=e)}else{const e=d*d-4*c*u;if(Kr(e)){const e=d/c,t=-a/o+e,i=-e/2;t>=0&&t<=1&&(r[p++]=t),i>=0&&i<=1&&(r[p++]=i)}else if(e>0){const t=Hr(e);let i=c*a+1.5*o*(-d+t),n=c*a+1.5*o*(-d-t);i=i<0?-Vr(-i,Xr):Vr(i,Xr),n=n<0?-Vr(-n,Xr):Vr(n,Xr);const s=(-a-(i+n))/(3*o);s>=0&&s<=1&&(r[p++]=s)}else{const e=(2*c*a-3*o*d)/(2*Hr(c*c*c)),t=Math.acos(e)/3,i=Hr(c),n=Math.cos(t),s=(-a-2*i*n)/(3*o),l=(-a+i*(n+Yr*Math.sin(t)))/(3*o),h=(-a+i*(n-Yr*Math.sin(t)))/(3*o);s>=0&&s<=1&&(r[p++]=s),l>=0&&l<=1&&(r[p++]=l),h>=0&&h<=1&&(r[p++]=h)}}return p}function io(e,t,i,n,s){const r=6*i-12*t+6*e,o=9*t+3*n-3*e-9*i,a=3*t-3*e;let l=0;if(Kr(o)){if(Jr(r)){const e=-a/r;e>=0&&e<=1&&(s[l++]=e)}}else{const e=r*r-4*o*a;if(Kr(e))s[0]=-r/(2*o);else if(e>0){const t=Hr(e),i=(-r+t)/(2*o),n=(-r-t)/(2*o);i>=0&&i<=1&&(s[l++]=i),n>=0&&n<=1&&(s[l++]=n)}}return l}function no(e,t,i,n,s,r){const o=(t-e)*s+e,a=(i-t)*s+t,l=(n-i)*s+i,h=(a-o)*s+o,c=(l-a)*s+a,d=(c-h)*s+h;r[0]=e,r[1]=o,r[2]=h,r[3]=d,r[4]=d,r[5]=c,r[6]=l,r[7]=n}function so(e,t,i,n,s,r,o,a,l){let h=e,c=t,d=0;const u=1/l;for(let p=1;p<=l;p++){let l=p*u;const f=$r(e,i,s,o,l),m=$r(t,n,r,a,l),g=f-h,v=m-c;d+=Math.sqrt(g*g+v*v),h=f,c=m}return d}function ro(e,t,i,n){const s=1-n;return s*(s*e+2*n*t)+n*n*i}function oo(e,t,i,n){return 2*((1-n)*(t-e)+n*(i-t))}function ao(e,t,i){const n=e+i-2*t;return 0===n?.5:(e-t)/n}function lo(e,t,i,n,s){const r=(t-e)*n+e,o=(i-t)*n+t,a=(o-r)*n+r;s[0]=e,s[1]=r,s[2]=a,s[3]=a,s[4]=o,s[5]=i}function ho(e,t,i,n,s,r,o){let a=e,l=t,h=0;const c=1/o;for(let d=1;d<=o;d++){let o=d*c;const u=ro(e,i,s,o),p=ro(t,n,r,o),f=u-a,m=p-l;h+=Math.sqrt(f*f+m*m),a=u,l=p}return h}const co=/cubic-bezier\(([0-9,\.e ]+)\)/;function uo(e){const t=e&&co.exec(e);if(t){const e=t[1].split(","),i=+as(e[0]),n=+as(e[1]),s=+as(e[2]),r=+as(e[3]);if(isNaN(i+n+s+r))return;const o=[];return e=>e<=0?0:e>=1?1:to(0,i,s,1,e,o)&&$r(0,n,r,1,o[0])}}class po{constructor(e){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=e.life||1e3,this._delay=e.delay||0,this.loop=e.loop||!1,this.onframe=e.onframe||gs,this.ondestroy=e.ondestroy||gs,this.onrestart=e.onrestart||gs,e.easing&&this.setEasing(e.easing)}step(e,t){if(this._inited||(this._startTime=e+this._delay,this._inited=!0),this._paused)return void(this._pausedTime+=t);const i=this._life;let n=e-this._startTime-this._pausedTime,s=n/i;s<0&&(s=0),s=Math.min(s,1);const r=this.easingFunc,o=r?r(s):s;if(this.onframe(o),1===s){if(!this.loop)return!0;{const t=n%i;this._startTime=e-t,this._pausedTime=0,this.onrestart()}}return!1}pause(){this._paused=!0}resume(){this._paused=!1}setEasing(e){this.easing=e,this.easingFunc=Yn(e)?e:jr[e]||uo(e)}}class fo{constructor(e){this.value=e}}class mo{constructor(e){this._list=new class{constructor(){this._len=0}insert(e){const t=new fo(e);return this.insertEntry(t),t}insertEntry(e){this.head?(this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++}remove(e){const t=e.prev,i=e.next;t?t.next=i:this.head=i,i?i.prev=t:this.tail=t,e.next=e.prev=null,this._len--}len(){return this._len}clear(){this.head=this.tail=null,this._len=0}},this._maxSize=10,this._map={},this._maxSize=e}put(e,t){const i=this._list,n=this._map;let s=null;if(null==n[e]){const r=i.len();let o=this._lastRemovedEntry;if(r>=this._maxSize&&r>0){const e=i.head;i.remove(e),delete n[e.key],s=e.value,this._lastRemovedEntry=e}o?o.value=t:o=new fo(t),o.key=e,i.insertEntry(o),n[e]=o}return s}get(e){const t=this._map[e],i=this._list;if(null!=t)return t!==i.tail&&(i.remove(t),i.insertEntry(t)),t.value}clear(){this._list.clear(),this._map={}}len(){return this._list.len()}}const go={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function vo(e){return(e=Math.round(e))<0?0:e>255?255:e}function yo(e){return e<0?0:e>1?1:e}function xo(e){let t=e;return t.length&&"%"===t.charAt(t.length-1)?vo(parseFloat(t)/100*255):vo(parseInt(t,10))}function wo(e){let t=e;return t.length&&"%"===t.charAt(t.length-1)?yo(parseFloat(t)/100):yo(parseFloat(t))}function bo(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function _o(e,t,i){return e+(t-e)*i}function So(e,t,i,n,s){return e[0]=t,e[1]=i,e[2]=n,e[3]=s,e}function Mo(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}const Co=new mo(20);let Ao=null;function Eo(e,t){Ao&&Mo(Ao,t),Ao=Co.put(e,Ao||t.slice())}function To(e,t){if(!e)return;t=t||[];let i=Co.get(e);if(i)return Mo(t,i);let n=(e+="").replace(/ /g,"").toLowerCase();if(n in go)return Mo(t,go[n]),Eo(e,t),t;const s=n.length;if("#"===n.charAt(0)){if(4===s||5===s){const i=parseInt(n.slice(1,4),16);return i>=0&&i<=4095?(So(t,(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,5===s?parseInt(n.slice(4),16)/15:1),Eo(e,t),t):void So(t,0,0,0,1)}if(7===s||9===s){const i=parseInt(n.slice(1,7),16);return i>=0&&i<=16777215?(So(t,(16711680&i)>>16,(65280&i)>>8,255&i,9===s?parseInt(n.slice(7),16)/255:1),Eo(e,t),t):void So(t,0,0,0,1)}return}let r=n.indexOf("("),o=n.indexOf(")");if(-1!==r&&o+1===s){let i=n.substr(0,r),s=n.substr(r+1,o-(r+1)).split(","),a=1;switch(i){case"rgba":if(4!==s.length)return 3===s.length?So(t,+s[0],+s[1],+s[2],1):So(t,0,0,0,1);a=wo(s.pop());case"rgb":return s.length>=3?(So(t,xo(s[0]),xo(s[1]),xo(s[2]),3===s.length?a:wo(s[3])),Eo(e,t),t):void So(t,0,0,0,1);case"hsla":return 4!==s.length?void So(t,0,0,0,1):(s[3]=wo(s[3]),Po(s,t),Eo(e,t),t);case"hsl":return 3!==s.length?void So(t,0,0,0,1):(Po(s,t),Eo(e,t),t);default:return}}So(t,0,0,0,1)}function Po(e,t){const i=(parseFloat(e[0])%360+360)%360/360,n=wo(e[1]),s=wo(e[2]),r=s<=.5?s*(n+1):s+n-s*n,o=2*s-r;return So(t=t||[],vo(255*bo(o,r,i+1/3)),vo(255*bo(o,r,i)),vo(255*bo(o,r,i-1/3)),1),4===e.length&&(t[3]=e[3]),t}function Oo(e,t){const i=To(e);if(i){for(let e=0;e<3;e++)i[e]=t<0?i[e]*(1-t)|0:(255-i[e])*t+i[e]|0,i[e]>255?i[e]=255:i[e]<0&&(i[e]=0);return ko(i,4===i.length?"rgba":"rgb")}}function Do(e,t,i){if(!t||!t.length||!(e>=0&&e<=1))return;i=i||[];const n=e*(t.length-1),s=Math.floor(n),r=Math.ceil(n),o=t[s],a=t[r],l=n-s;return i[0]=vo(_o(o[0],a[0],l)),i[1]=vo(_o(o[1],a[1],l)),i[2]=vo(_o(o[2],a[2],l)),i[3]=yo(_o(o[3],a[3],l)),i}const Bo=Do;function Io(e,t,i){if(!t||!t.length||!(e>=0&&e<=1))return;const n=e*(t.length-1),s=Math.floor(n),r=Math.ceil(n),o=To(t[s]),a=To(t[r]),l=n-s,h=ko([vo(_o(o[0],a[0],l)),vo(_o(o[1],a[1],l)),vo(_o(o[2],a[2],l)),yo(_o(o[3],a[3],l))],"rgba");return i?{color:h,leftIndex:s,rightIndex:r,value:n}:h}const Ro=Io;function ko(e,t){if(!e||!e.length)return;let i=e[0]+","+e[1]+","+e[2];return"rgba"!==t&&"hsva"!==t&&"hsla"!==t||(i+=","+e[3]),t+"("+i+")"}function Lo(e,t){const i=To(e);return i?(.299*i[0]+.587*i[1]+.114*i[2])*i[3]/255+(1-i[3])*t:0}function zo(){return ko([Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())],"rgb")}const Uo=new mo(100);function Fo(e){if(Xn(e)){let t=Uo.get(e);return t||(t=Oo(e,-.1),Uo.put(e,t)),t}if($n(e)){const t=In({},e);return t.colorStops=Nn(e.colorStops,(e=>({offset:e.offset,color:Oo(e.color,-.1)}))),t}return e}var No=Object.freeze({__proto__:null,fastLerp:Do,fastMapToColor:Bo,lerp:Io,lift:Oo,liftColor:Fo,lum:Lo,mapToColor:Ro,modifyAlpha:function(e,t){const i=To(e);if(i&&null!=t)return i[3]=yo(t),ko(i,"rgba")},modifyHSL:function(e,t,i,n){let s=To(e);if(e)return s=function(e){if(!e)return;const t=e[0]/255,i=e[1]/255,n=e[2]/255,s=Math.min(t,i,n),r=Math.max(t,i,n),o=r-s,a=(r+s)/2;let l,h;if(0===o)l=0,h=0;else{h=a<.5?o/(r+s):o/(2-r-s);const e=((r-t)/6+o/2)/o,c=((r-i)/6+o/2)/o,d=((r-n)/6+o/2)/o;t===r?l=d-c:i===r?l=1/3+e-d:n===r&&(l=2/3+c-e),l<0&&(l+=1),l>1&&(l-=1)}const c=[360*l,h,a];return null!=e[3]&&c.push(e[3]),c}(s),null!=t&&(s[0]=(r=t,(r=Math.round(r))<0?0:r>360?360:r)),null!=i&&(s[1]=wo(i)),null!=n&&(s[2]=wo(n)),ko(Po(s),"rgba");var r},parse:To,random:zo,stringify:ko,toHex:function(e){const t=To(e);if(t)return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)}});const jo=Math.round;function Vo(e){let t;if(e&&"transparent"!==e){if("string"==typeof e&&e.indexOf("rgba")>-1){const i=To(e);i&&(e="rgb("+i[0]+","+i[1]+","+i[2]+")",t=i[3])}}else e="none";return{color:e,opacity:null==t?1:t}}const Ho=1e-4;function Wo(e){return e<Ho&&e>-Ho}function Go(e){return jo(1e3*e)/1e3}function Yo(e){return jo(1e4*e)/1e4}const Xo={left:"start",right:"end",center:"middle",middle:"middle"};function Qo(e){return e&&!!e.image}function qo(e){return Qo(e)||function(e){return e&&!!e.svgElement}(e)}function Zo(e){return"linear"===e.type}function Ko(e){return"radial"===e.type}function Jo(e){return e&&("linear"===e.type||"radial"===e.type)}function $o(e){return`url(#${e})`}function ea(e){const t=e.getGlobalScale(),i=Math.max(t[0],t[1]);return Math.max(Math.ceil(Math.log(i)/Math.log(10)),1)}function ta(e){const t=e.x||0,i=e.y||0,n=(e.rotation||0)*vs,s=is(e.scaleX,1),r=is(e.scaleY,1),o=e.skewX||0,a=e.skewY||0,l=[];return(t||i)&&l.push(`translate(${t}px,${i}px)`),n&&l.push(`rotate(${n})`),1===s&&1===r||l.push(`scale(${s},${r})`),(o||a)&&l.push(`skew(${jo(o*vs)}deg, ${jo(a*vs)}deg)`),l.join(" ")}const ia=dn.hasGlobalWindow&&Yn(window.btoa)?function(e){return window.btoa(unescape(encodeURIComponent(e)))}:"undefined"!=typeof Buffer?function(e){return Buffer.from(e).toString("base64")}:function(e){return null},na=Array.prototype.slice;function sa(e,t,i){return(t-e)*i+e}function ra(e,t,i,n){const s=t.length;for(let r=0;r<s;r++)e[r]=sa(t[r],i[r],n);return e}function oa(e,t,i,n){const s=t.length;for(let r=0;r<s;r++)e[r]=t[r]+i[r]*n;return e}function aa(e,t,i,n){const s=t.length,r=s&&t[0].length;for(let o=0;o<s;o++){e[o]||(e[o]=[]);for(let s=0;s<r;s++)e[o][s]=t[o][s]+i[o][s]*n}return e}function la(e,t){const i=e.length,n=t.length,s=i>n?t:e,r=Math.min(i,n),o=s[r-1]||{color:[0,0,0,0],offset:0};for(let e=r;e<Math.max(i,n);e++)s.push({offset:o.offset,color:o.color.slice()})}function ha(e,t,i){let n=e,s=t;if(!n.push||!s.push)return;const r=n.length,o=s.length;if(r!==o)if(r>o)n.length=o;else for(let e=r;e<o;e++)n.push(1===i?s[e]:na.call(s[e]));const a=n[0]&&n[0].length;for(let e=0;e<n.length;e++)if(1===i)isNaN(n[e])&&(n[e]=s[e]);else for(let t=0;t<a;t++)isNaN(n[e][t])&&(n[e][t]=s[e][t])}function ca(e){if(Un(e)){const t=e.length;if(Un(e[0])){const i=[];for(let n=0;n<t;n++)i.push(na.call(e[n]));return i}return na.call(e)}return e}function da(e){return e[0]=Math.floor(e[0])||0,e[1]=Math.floor(e[1])||0,e[2]=Math.floor(e[2])||0,e[3]=null==e[3]?1:e[3],"rgba("+e.join(",")+")"}function ua(e){return 4===e||5===e}function pa(e){return 1===e||2===e}let fa=[0,0,0,0];class ma{constructor(e){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=e}isFinished(){return this._finished}setFinished(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()}needsAnimate(){return this.keyframes.length>=1}getAdditiveTrack(){return this._additiveTrack}addKeyframe(e,t,i){this._needsSort=!0;let n=this.keyframes,s=n.length,r=!1,o=6,a=t;if(Un(t)){let e=function(e){return Un(e&&e[0])?2:1}(t);o=e,(1===e&&!Qn(t[0])||2===e&&!Qn(t[0][0]))&&(r=!0)}else if(Qn(t)&&!ts(t))o=0;else if(Xn(t))if(isNaN(+t)){const e=To(t);e&&(a=e,o=3)}else o=0;else if($n(t)){const e=In({},a);e.colorStops=Nn(t.colorStops,(e=>({offset:e.offset,color:To(e.color)}))),Zo(t)?o=4:Ko(t)&&(o=5),a=e}0===s?this.valType=o:o===this.valType&&6!==o||(r=!0),this.discrete=this.discrete||r;const l={time:e,value:a,rawValue:t,percent:0};return i&&(l.easing=i,l.easingFunc=Yn(i)?i:jr[i]||uo(i)),n.push(l),l}prepare(e,t){let i=this.keyframes;this._needsSort&&i.sort((function(e,t){return e.time-t.time}));const n=this.valType,s=i.length,r=i[s-1],o=this.discrete,a=pa(n),l=ua(n);for(let t=0;t<s;t++){const h=i[t],c=h.value,d=r.value;h.percent=h.time/e,o||(a&&t!==s-1?ha(c,d,n):l&&la(c.colorStops,d.colorStops))}if(!o&&5!==n&&t&&this.needsAnimate()&&t.needsAnimate()&&n===t.valType&&!t._finished){this._additiveTrack=t;const e=i[0].value;for(let t=0;t<s;t++)0===n?i[t].additiveValue=i[t].value-e:3===n?i[t].additiveValue=oa([],i[t].value,e,-1):pa(n)&&(i[t].additiveValue=1===n?oa([],i[t].value,e,-1):aa([],i[t].value,e,-1))}}step(e,t){if(this._finished)return;this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);const i=null!=this._additiveTrack,n=i?"additiveValue":"value",s=this.valType,r=this.keyframes,o=r.length,a=this.propName,l=3===s;let h;const c=this._lastFr,d=Math.min;let u,p;if(1===o)u=p=r[0];else{if(t<0)h=0;else if(t<this._lastFrP){for(h=d(c+1,o-1);h>=0&&!(r[h].percent<=t);h--);h=d(h,o-2)}else{for(h=c;h<o&&!(r[h].percent>t);h++);h=d(h-1,o-2)}p=r[h+1],u=r[h]}if(!u||!p)return;this._lastFr=h,this._lastFrP=t;const f=p.percent-u.percent;let m=0===f?1:d((t-u.percent)/f,1);p.easingFunc&&(m=p.easingFunc(m));let g=i?this._additiveValue:l?fa:e[a];if(!pa(s)&&!l||g||(g=this._additiveValue=[]),this.discrete)e[a]=m<1?u.rawValue:p.rawValue;else if(pa(s))1===s?ra(g,u[n],p[n],m):function(e,t,i,n){const s=t.length,r=s&&t[0].length;for(let o=0;o<s;o++){e[o]||(e[o]=[]);for(let s=0;s<r;s++)e[o][s]=sa(t[o][s],i[o][s],n)}}(g,u[n],p[n],m);else if(ua(s)){const t=u[n],i=p[n],r=4===s;e[a]={type:r?"linear":"radial",x:sa(t.x,i.x,m),y:sa(t.y,i.y,m),colorStops:Nn(t.colorStops,((e,t)=>{const n=i.colorStops[t];return{offset:sa(e.offset,n.offset,m),color:da(ra([],e.color,n.color,m))}})),global:i.global},r?(e[a].x2=sa(t.x2,i.x2,m),e[a].y2=sa(t.y2,i.y2,m)):e[a].r=sa(t.r,i.r,m)}else if(l)ra(g,u[n],p[n],m),i||(e[a]=da(g));else{const t=sa(u[n],p[n],m);i?this._additiveValue=t:e[a]=t}i&&this._addToTarget(e)}_addToTarget(e){const t=this.valType,i=this.propName,n=this._additiveValue;0===t?e[i]=e[i]+n:3===t?(To(e[i],fa),oa(fa,fa,n,1),e[i]=da(fa)):1===t?oa(e[i],e[i],n,1):2===t&&aa(e[i],e[i],n,1)}}let ga=class{constructor(e,t,i,n){this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=e,this._loop=t,t&&n?On("Can' use additive animation on looped animation."):(this._additiveAnimators=n,this._allowDiscrete=i)}getMaxTime(){return this._maxTime}getDelay(){return this._delay}getLoop(){return this._loop}getTarget(){return this._target}changeTarget(e){this._target=e}when(e,t,i){return this.whenWithKeys(e,t,Hn(t),i)}whenWithKeys(e,t,i,n){const s=this._tracks;for(let r=0;r<i.length;r++){const o=i[r];let a=s[o];if(!a){let t;a=s[o]=new ma(o);const i=this._getAdditiveTrack(o);if(i){const e=i.keyframes,n=e[e.length-1];t=n&&n.value,3===i.valType&&t&&(t=da(t))}else t=this._target[o];if(null==t)continue;e>0&&a.addKeyframe(0,ca(t),n),this._trackKeys.push(o)}a.addKeyframe(e,ca(t[o]),n)}return this._maxTime=Math.max(this._maxTime,e),this}pause(){this._clip.pause(),this._paused=!0}resume(){this._clip.resume(),this._paused=!1}isPaused(){return!!this._paused}duration(e){return this._maxTime=e,this._force=!0,this}_doneCallback(){this._setTracksFinished(),this._clip=null;const e=this._doneCbs;if(e){const t=e.length;for(let i=0;i<t;i++)e[i].call(this)}}_abortedCallback(){this._setTracksFinished();const e=this.animation,t=this._abortedCbs;if(e&&e.removeClip(this._clip),this._clip=null,t)for(let e=0;e<t.length;e++)t[e].call(this)}_setTracksFinished(){const e=this._tracks,t=this._trackKeys;for(let i=0;i<t.length;i++)e[t[i]].setFinished()}_getAdditiveTrack(e){let t;const i=this._additiveAnimators;if(i)for(let n=0;n<i.length;n++){const s=i[n].getTrack(e);s&&(t=s)}return t}start(e){if(this._started>0)return;this._started=1;const t=this,i=[],n=this._maxTime||0;for(let e=0;e<this._trackKeys.length;e++){const s=this._trackKeys[e],r=this._tracks[s],o=this._getAdditiveTrack(s),a=r.keyframes,l=a.length;if(r.prepare(n,o),r.needsAnimate())if(!this._allowDiscrete&&r.discrete){const e=a[l-1];e&&(t._target[r.propName]=e.rawValue),r.setFinished()}else i.push(r)}if(i.length||this._force){const s=new po({life:n,loop:this._loop,delay:this._delay||0,onframe(e){t._started=2;const n=t._additiveAnimators;if(n){let e=!1;for(let t=0;t<n.length;t++)if(n[t]._clip){e=!0;break}e||(t._additiveAnimators=null)}for(let n=0;n<i.length;n++)i[n].step(t._target,e);const s=t._onframeCbs;if(s)for(let i=0;i<s.length;i++)s[i](t._target,e)},ondestroy(){t._doneCallback()}});this._clip=s,this.animation&&this.animation.addClip(s),e&&s.setEasing(e)}else this._doneCallback();return this}stop(e){if(!this._clip)return;const t=this._clip;e&&t.onframe(1),this._abortedCallback()}delay(e){return this._delay=e,this}during(e){return e&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(e)),this}done(e){return e&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(e)),this}aborted(e){return e&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(e)),this}getClip(){return this._clip}getTrack(e){return this._tracks[e]}getTracks(){return Nn(this._trackKeys,(e=>this._tracks[e]))}stopTracks(e,t){if(!e.length||!this._clip)return!0;const i=this._tracks,n=this._trackKeys;for(let n=0;n<e.length;n++){const s=i[e[n]];s&&!s.isFinished()&&(t?s.step(this._target,1):1===this._started&&s.step(this._target,0),s.setFinished())}let s=!0;for(let e=0;e<n.length;e++)if(!i[n[e]].isFinished()){s=!1;break}return s&&this._abortedCallback(),s}saveTo(e,t,i){if(e){t=t||this._trackKeys;for(let n=0;n<t.length;n++){const s=t[n],r=this._tracks[s];if(!r||r.isFinished())continue;const o=r.keyframes,a=o[i?0:o.length-1];a&&(e[s]=ca(a.rawValue))}}}__changeFinalValue(e,t){t=t||Hn(e);for(let i=0;i<t.length;i++){const n=t[i],s=this._tracks[n];if(!s)continue;const r=s.keyframes;if(r.length>1){const t=r.pop();s.addKeyframe(t.time,e[n]),s.prepare(this._maxTime,s.getAdditiveTrack())}}}};function va(){return(new Date).getTime()}class ya extends Ns{constructor(e){super(),this._running=!1,this._time=0,this._pausedTime=0,this._pauseStart=0,this._paused=!1,e=e||{},this.stage=e.stage||{}}addClip(e){e.animation&&this.removeClip(e),this._head?(this._tail.next=e,e.prev=this._tail,e.next=null,this._tail=e):this._head=this._tail=e,e.animation=this}addAnimator(e){e.animation=this;const t=e.getClip();t&&this.addClip(t)}removeClip(e){if(!e.animation)return;const t=e.prev,i=e.next;t?t.next=i:this._head=i,i?i.prev=t:this._tail=t,e.next=e.prev=e.animation=null}removeAnimator(e){const t=e.getClip();t&&this.removeClip(t),e.animation=null}update(e){const t=va()-this._pausedTime,i=t-this._time;let n=this._head;for(;n;){const e=n.next;n.step(t,i)?(n.ondestroy(),this.removeClip(n),n=e):n=e}this._time=t,e||(this.trigger("frame",i),this.stage.update&&this.stage.update())}_startLoop(){const e=this;this._running=!0,Nr((function t(){e._running&&(Nr(t),!e._paused&&e.update())}))}start(){this._running||(this._time=va(),this._pausedTime=0,this._startLoop())}stop(){this._running=!1}pause(){this._paused||(this._pauseStart=va(),this._paused=!0)}resume(){this._paused&&(this._pausedTime+=va()-this._pauseStart,this._paused=!1)}clear(){let e=this._head;for(;e;){let t=e.next;e.prev=e.next=e.animation=null,e=t}this._head=this._tail=null}isFinished(){return null==this._head}animate(e,t){t=t||{},this.start();const i=new ga(e,t.loop);return this.addAnimator(i),i}}const xa=dn.domSupported,wa=function(){const e=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],t={pointerdown:1,pointerup:1,pointermove:1,pointerout:1};return{mouse:e,touch:["touchstart","touchend","touchmove"],pointer:Nn(e,(function(e){const i=e.replace("mouse","pointer");return t.hasOwnProperty(i)?i:e}))}}(),ba=["mousemove","mouseup"],_a=["pointermove","pointerup"];let Sa=!1;function Ma(e){const t=e.pointerType;return"pen"===t||"touch"===t}function Ca(e){e&&(e.zrByTouch=!0)}function Aa(e,t){let i=t,n=!1;for(;i&&9!==i.nodeType&&!(n=i.domBelongToZr||i!==t&&i===e.painterRoot);)i=i.parentNode;return n}class Ea{constructor(e,t){this.stopPropagation=gs,this.stopImmediatePropagation=gs,this.preventDefault=gs,this.type=t.type,this.target=this.currentTarget=e.dom,this.pointerType=t.pointerType,this.clientX=t.clientX,this.clientY=t.clientY}}const Ta={mousedown(e){e=$s(this.dom,e),this.__mayPointerCapture=[e.zrX,e.zrY],this.trigger("mousedown",e)},mousemove(e){e=$s(this.dom,e);const t=this.__mayPointerCapture;!t||e.zrX===t[0]&&e.zrY===t[1]||this.__togglePointerCapture(!0),this.trigger("mousemove",e)},mouseup(e){e=$s(this.dom,e),this.__togglePointerCapture(!1),this.trigger("mouseup",e)},mouseout(e){Aa(this,(e=$s(this.dom,e)).toElement||e.relatedTarget)||(this.__pointerCapturing&&(e.zrEventControl="no_globalout"),this.trigger("mouseout",e))},wheel(e){Sa=!0,e=$s(this.dom,e),this.trigger("mousewheel",e)},mousewheel(e){Sa||(e=$s(this.dom,e),this.trigger("mousewheel",e))},touchstart(e){Ca(e=$s(this.dom,e)),this.__lastTouchMoment=new Date,this.handler.processGesture(e,"start"),Ta.mousemove.call(this,e),Ta.mousedown.call(this,e)},touchmove(e){Ca(e=$s(this.dom,e)),this.handler.processGesture(e,"change"),Ta.mousemove.call(this,e)},touchend(e){Ca(e=$s(this.dom,e)),this.handler.processGesture(e,"end"),Ta.mouseup.call(this,e),+new Date-+this.__lastTouchMoment<300&&Ta.click.call(this,e)},pointerdown(e){Ta.mousedown.call(this,e)},pointermove(e){Ma(e)||Ta.mousemove.call(this,e)},pointerup(e){Ta.mouseup.call(this,e)},pointerout(e){Ma(e)||Ta.mouseout.call(this,e)}};Fn(["click","dblclick","contextmenu"],(function(e){Ta[e]=function(t){t=$s(this.dom,t),this.trigger(e,t)}}));const Pa={pointermove:function(e){Ma(e)||Pa.mousemove.call(this,e)},pointerup:function(e){Pa.mouseup.call(this,e)},mousemove:function(e){this.trigger("mousemove",e)},mouseup:function(e){const t=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",e),t&&(e.zrEventControl="only_globalout",this.trigger("mouseout",e))}};function Oa(e,t,i,n){e.mounted[t]=i,e.listenerOpts[t]=n,function(e,t,i,n){e.addEventListener(t,i,n)}(e.domTarget,t,i,n)}function Da(e){const t=e.mounted;for(let o in t)t.hasOwnProperty(o)&&(i=e.domTarget,n=o,s=t[o],r=e.listenerOpts[o],i.removeEventListener(n,s,r));var i,n,s,r;e.mounted={}}class Ba{constructor(e,t){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=e,this.domHandlers=t}}class Ia extends Ns{constructor(e,t){super(),this.__pointerCapturing=!1,this.dom=e,this.painterRoot=t,this._localHandlerScope=new Ba(e,Ta),xa&&(this._globalHandlerScope=new Ba(document,Pa)),function(e,t){const i=t.domHandlers;dn.pointerEventsSupported?Fn(wa.pointer,(function(n){Oa(t,n,(function(t){i[n].call(e,t)}))})):(dn.touchEventsSupported&&Fn(wa.touch,(function(n){Oa(t,n,(function(s){i[n].call(e,s),function(e){e.touching=!0,null!=e.touchTimer&&(clearTimeout(e.touchTimer),e.touchTimer=null),e.touchTimer=setTimeout((function(){e.touching=!1,e.touchTimer=null}),700)}(t)}))})),Fn(wa.mouse,(function(n){Oa(t,n,(function(s){s=Js(s),t.touching||i[n].call(e,s)}))})))}(this,this._localHandlerScope)}dispose(){Da(this._localHandlerScope),xa&&Da(this._globalHandlerScope)}setCursor(e){this.dom.style&&(this.dom.style.cursor=e||"default")}__togglePointerCapture(e){if(this.__mayPointerCapture=null,xa&&+this.__pointerCapturing^+e){this.__pointerCapturing=e;const t=this._globalHandlerScope;e?function(e,t){function i(i){Oa(t,i,(function(n){n=Js(n),Aa(e,n.target)||(n=function(e,t){return $s(e.dom,new Ea(e,t),!0)}(e,n),t.domHandlers[i].call(e,n))}),{capture:!0})}dn.pointerEventsSupported?Fn(_a,i):dn.touchEventsSupported||Fn(ba,i)}(this,t):Da(t)}}}let Ra=1;dn.hasGlobalWindow&&(Ra=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));const ka=Ra,La="#333",za="#ccc",Ua=nr;function Fa(e){return e>5e-5||e<-5e-5}const Na=[],ja=[],Va=[1,0,0,1,0,0],Ha=Math.abs;class Wa{getLocalTransform(e){return Wa.getLocalTransform(this,e)}setPosition(e){this.x=e[0],this.y=e[1]}setScale(e){this.scaleX=e[0],this.scaleY=e[1]}setSkew(e){this.skewX=e[0],this.skewY=e[1]}setOrigin(e){this.originX=e[0],this.originY=e[1]}needLocalTransform(){return Fa(this.rotation)||Fa(this.x)||Fa(this.y)||Fa(this.scaleX-1)||Fa(this.scaleY-1)||Fa(this.skewX)||Fa(this.skewY)}updateTransform(){const e=this.parent&&this.parent.transform,t=this.needLocalTransform();let i=this.transform;t||e?(i=i||[1,0,0,1,0,0],t?this.getLocalTransform(i):Ua(i),e&&(t?rr(i,e,i):sr(i,e)),this.transform=i,this._resolveGlobalScaleRatio(i)):i&&(Ua(i),this.invTransform=null)}_resolveGlobalScaleRatio(e){const t=this.globalScaleRatio;if(null!=t&&1!==t){this.getGlobalScale(Na);const i=Na[0]<0?-1:1,n=Na[1]<0?-1:1,s=((Na[0]-i)*t+i)/Na[0]||0,r=((Na[1]-n)*t+n)/Na[1]||0;e[0]*=s,e[1]*=s,e[2]*=r,e[3]*=r}this.invTransform=this.invTransform||[1,0,0,1,0,0],hr(this.invTransform,e)}getComputedTransform(){let e=this;const t=[];for(;e;)t.push(e),e=e.parent;for(;e=t.pop();)e.updateTransform();return this.transform}setLocalTransform(e){if(!e)return;let t=e[0]*e[0]+e[1]*e[1],i=e[2]*e[2]+e[3]*e[3];const n=Math.atan2(e[1],e[0]),s=Math.PI/2+n-Math.atan2(e[3],e[2]);i=Math.sqrt(i)*Math.cos(s),t=Math.sqrt(t),this.skewX=s,this.skewY=0,this.rotation=-n,this.x=+e[4],this.y=+e[5],this.scaleX=t,this.scaleY=i,this.originX=0,this.originY=0}decomposeTransform(){if(!this.transform)return;const e=this.parent;let t=this.transform;e&&e.transform&&(rr(ja,e.invTransform,t),t=ja);const i=this.originX,n=this.originY;(i||n)&&(Va[4]=i,Va[5]=n,rr(ja,t,Va),ja[4]-=i,ja[5]-=n,t=ja),this.setLocalTransform(t)}getGlobalScale(e){const t=this.transform;return e=e||[],t?(e[0]=Math.sqrt(t[0]*t[0]+t[1]*t[1]),e[1]=Math.sqrt(t[2]*t[2]+t[3]*t[3]),t[0]<0&&(e[0]=-e[0]),t[3]<0&&(e[1]=-e[1]),e):(e[0]=1,e[1]=1,e)}transformCoordToLocal(e,t){const i=[e,t],n=this.invTransform;return n&&Rs(i,i,n),i}transformCoordToGlobal(e,t){const i=[e,t],n=this.transform;return n&&Rs(i,i,n),i}getLineScale(){const e=this.transform;return e&&Ha(e[0]-1)>1e-10&&Ha(e[3]-1)>1e-10?Math.sqrt(Ha(e[0]*e[3]-e[2]*e[1])):1}copyTransform(e){Ya(this,e)}static getLocalTransform(e,t){t=t||[];const i=e.originX||0,n=e.originY||0,s=e.scaleX,r=e.scaleY,o=e.anchorX,a=e.anchorY,l=e.rotation||0,h=e.x,c=e.y,d=e.skewX?Math.tan(e.skewX):0,u=e.skewY?Math.tan(-e.skewY):0;if(i||n||o||a){const e=i+o,l=n+a;t[4]=-e*s-d*l*r,t[5]=-l*r-u*e*s}else t[4]=t[5]=0;return t[0]=s,t[3]=r,t[1]=u*s,t[2]=d*r,l&&ar(t,t,l),t[4]+=i+h,t[5]+=n+c,t}}Wa.initDefaultProps=function(){const e=Wa.prototype;e.scaleX=e.scaleY=e.globalScaleRatio=1,e.x=e.y=e.originX=e.originY=e.skewX=e.skewY=e.rotation=e.anchorX=e.anchorY=0}();const Ga=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function Ya(e,t){for(let i=0;i<Ga.length;i++){const n=Ga[i];e[n]=t[n]}}let Xa={};function Qa(e,t){let i=Xa[t=t||fn];i||(i=Xa[t]=new mo(500));let n=i.get(e);return null==n&&(n=gn.measureText(e,t).width,i.put(e,n)),n}function qa(e,t,i,n){const s=Qa(e,t),r=Ja(t),o=Za(0,s,i),a=Ka(0,r,n);return new wr(o,a,s,r)}function Za(e,t,i){return"right"===i?e-=t:"center"===i&&(e-=t/2),e}function Ka(e,t,i){return"middle"===i?e-=t/2:"bottom"===i&&(e-=t),e}function Ja(e){return Qa("国",e)}function $a(e,t){return"string"==typeof e?e.lastIndexOf("%")>=0?parseFloat(e)/100*t:parseFloat(e):e}const el="__zr_normal__",tl=Ga.concat(["ignore"]),il=jn(Ga,((e,t)=>(e[t]=!0,e)),{ignore:!1});let nl={},sl=new wr(0,0,0,0);class rl{constructor(e){this.id=Pn(),this.animators=[],this.currentStates=[],this.states={},this._init(e)}_init(e){this.attr(e)}drift(e,t,i){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0}let n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=e,n[5]+=t,this.decomposeTransform(),this.markRedraw()}beforeUpdate(){}afterUpdate(){}update(){this.updateTransform(),this.__dirty&&this.updateInnerText()}updateInnerText(e){const t=this._textContent;if(t&&(!t.ignore||e)){this.textConfig||(this.textConfig={});const e=this.textConfig,i=e.local,n=t.innerTransformable;let s,r,o=!1;n.parent=i?this:null;let a=!1;if(n.copyTransform(t),null!=e.position){let t=sl;e.layoutRect?t.copy(e.layoutRect):t.copy(this.getBoundingRect()),i||t.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(nl,e,t):function(e,t,i){const n=t.position||"inside",s=null!=t.distance?t.distance:5,r=i.height,o=i.width,a=r/2;let l=i.x,h=i.y,c="left",d="top";if(n instanceof Array)l+=$a(n[0],i.width),h+=$a(n[1],i.height),c=null,d=null;else switch(n){case"left":l-=s,h+=a,c="right",d="middle";break;case"right":l+=s+o,h+=a,d="middle";break;case"top":l+=o/2,h-=s,c="center",d="bottom";break;case"bottom":l+=o/2,h+=r+s,c="center";break;case"inside":l+=o/2,h+=a,c="center",d="middle";break;case"insideLeft":l+=s,h+=a,d="middle";break;case"insideRight":l+=o-s,h+=a,c="right",d="middle";break;case"insideTop":l+=o/2,h+=s,c="center";break;case"insideBottom":l+=o/2,h+=r-s,c="center",d="bottom";break;case"insideTopLeft":l+=s,h+=s;break;case"insideTopRight":l+=o-s,h+=s,c="right";break;case"insideBottomLeft":l+=s,h+=r-s,d="bottom";break;case"insideBottomRight":l+=o-s,h+=r-s,c="right",d="bottom"}(e=e||{}).x=l,e.y=h,e.align=c,e.verticalAlign=d}(nl,e,t),n.x=nl.x,n.y=nl.y,s=nl.align,r=nl.verticalAlign;const o=e.origin;if(o&&null!=e.rotation){let e,s;"center"===o?(e=.5*t.width,s=.5*t.height):(e=$a(o[0],t.width),s=$a(o[1],t.height)),a=!0,n.originX=-n.x+e+(i?0:t.x),n.originY=-n.y+s+(i?0:t.y)}}null!=e.rotation&&(n.rotation=e.rotation);const l=e.offset;l&&(n.x+=l[0],n.y+=l[1],a||(n.originX=-l[0],n.originY=-l[1]));const h=null==e.inside?"string"==typeof e.position&&e.position.indexOf("inside")>=0:e.inside,c=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={});let d,u,p;h&&this.canBeInsideText()?(d=e.insideFill,u=e.insideStroke,null!=d&&"auto"!==d||(d=this.getInsideTextFill()),null!=u&&"auto"!==u||(u=this.getInsideTextStroke(d),p=!0)):(d=e.outsideFill,u=e.outsideStroke,null!=d&&"auto"!==d||(d=this.getOutsideFill()),null!=u&&"auto"!==u||(u=this.getOutsideStroke(d),p=!0)),d=d||"#000",d===c.fill&&u===c.stroke&&p===c.autoStroke&&s===c.align&&r===c.verticalAlign||(o=!0,c.fill=d,c.stroke=u,c.autoStroke=p,c.align=s,c.verticalAlign=r,t.setDefaultTextStyle(c)),t.__dirty|=1,o&&t.dirtyStyle(!0)}}canBeInsideText(){return!0}getInsideTextFill(){return"#fff"}getInsideTextStroke(e){return"#000"}getOutsideFill(){return this.__zr&&this.__zr.isDarkMode()?za:La}getOutsideStroke(e){const t=this.__zr&&this.__zr.getBackgroundColor();let i="string"==typeof t&&To(t);i||(i=[255,255,255,1]);const n=i[3],s=this.__zr.isDarkMode();for(let e=0;e<3;e++)i[e]=i[e]*n+(s?0:255)*(1-n);return i[3]=1,ko(i,"rgba")}traverse(e,t){}attrKV(e,t){"textConfig"===e?this.setTextConfig(t):"textContent"===e?this.setTextContent(t):"clipPath"===e?this.setClipPath(t):"extra"===e?(this.extra=this.extra||{},In(this.extra,t)):this[e]=t}hide(){this.ignore=!0,this.markRedraw()}show(){this.ignore=!1,this.markRedraw()}attr(e,t){if("string"==typeof e)this.attrKV(e,t);else if(qn(e)){let t=Hn(e);for(let i=0;i<t.length;i++){let n=t[i];this.attrKV(n,e[n])}}return this.markRedraw(),this}saveCurrentToNormalState(e){this._innerSaveToNormal(e);const t=this._normalState;for(let e=0;e<this.animators.length;e++){const i=this.animators[e],n=i.__fromStateTransition;if(i.getLoop()||n&&n!==el)continue;const s=i.targetName,r=s?t[s]:t;i.saveTo(r)}}_innerSaveToNormal(e){let t=this._normalState;t||(t=this._normalState={}),e.textConfig&&!t.textConfig&&(t.textConfig=this.textConfig),this._savePrimaryToNormal(e,t,tl)}_savePrimaryToNormal(e,t,i){for(let n=0;n<i.length;n++){let s=i[n];null==e[s]||s in t||(t[s]=this[s])}}hasState(){return this.currentStates.length>0}getState(e){return this.states[e]}ensureState(e){const t=this.states;return t[e]||(t[e]={}),t[e]}clearStates(e){this.useState(el,!1,e)}useState(e,t,i,n){const s=e===el;if(!this.hasState()&&s)return;const r=this.currentStates,o=this.stateTransition;if(Ln(r,e)>=0&&(t||1===r.length))return;let a;if(this.stateProxy&&!s&&(a=this.stateProxy(e)),a||(a=this.states&&this.states[e]),!a&&!s)return void On(`State ${e} not exists.`);s||this.saveCurrentToNormalState(a);const l=!!(a&&a.hoverLayer||n);l&&this._toggleHoverLayerFlag(!0),this._applyStateObj(e,a,this._normalState,t,!i&&!this.__inHover&&o&&o.duration>0,o);const h=this._textContent,c=this._textGuide;return h&&h.useState(e,t,i,l),c&&c.useState(e,t,i,l),s?(this.currentStates=[],this._normalState={}):t?this.currentStates.push(e):this.currentStates=[e],this._updateAnimationTargets(),this.markRedraw(),!l&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=-2),a}useStates(e,t,i){if(e.length){const n=[],s=this.currentStates,r=e.length;let o=r===s.length;if(o)for(let t=0;t<r;t++)if(e[t]!==s[t]){o=!1;break}if(o)return;for(let t=0;t<r;t++){const i=e[t];let s;this.stateProxy&&(s=this.stateProxy(i,e)),s||(s=this.states[i]),s&&n.push(s)}const a=n[r-1],l=!!(a&&a.hoverLayer||i);l&&this._toggleHoverLayerFlag(!0);const h=this._mergeStates(n),c=this.stateTransition;this.saveCurrentToNormalState(h),this._applyStateObj(e.join(","),h,this._normalState,!1,!t&&!this.__inHover&&c&&c.duration>0,c);const d=this._textContent,u=this._textGuide;d&&d.useStates(e,t,l),u&&u.useStates(e,t,l),this._updateAnimationTargets(),this.currentStates=e.slice(),this.markRedraw(),!l&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=-2)}else this.clearStates()}isSilent(){let e=this.silent,t=this.parent;for(;!e&&t;){if(t.silent){e=!0;break}t=t.parent}return e}_updateAnimationTargets(){for(let e=0;e<this.animators.length;e++){const t=this.animators[e];t.targetName&&t.changeTarget(this[t.targetName])}}removeState(e){const t=Ln(this.currentStates,e);if(t>=0){const e=this.currentStates.slice();e.splice(t,1),this.useStates(e)}}replaceState(e,t,i){const n=this.currentStates.slice(),s=Ln(n,e),r=Ln(n,t)>=0;s>=0?r?n.splice(s,1):n[s]=t:i&&!r&&n.push(t),this.useStates(n)}toggleState(e,t){t?this.useState(e,!0):this.removeState(e)}_mergeStates(e){const t={};let i;for(let n=0;n<e.length;n++){const s=e[n];In(t,s),s.textConfig&&(i=i||{},In(i,s.textConfig))}return i&&(t.textConfig=i),t}_applyStateObj(e,t,i,n,s,r){const o=!(t&&n);t&&t.textConfig?(this.textConfig=In({},n?this.textConfig:i.textConfig),In(this.textConfig,t.textConfig)):o&&i.textConfig&&(this.textConfig=i.textConfig);const a={};let l=!1;for(let e=0;e<tl.length;e++){const n=tl[e],r=s&&il[n];t&&null!=t[n]?r?(l=!0,a[n]=t[n]):this[n]=t[n]:o&&null!=i[n]&&(r?(l=!0,a[n]=i[n]):this[n]=i[n])}if(!s)for(let e=0;e<this.animators.length;e++){const n=this.animators[e],s=n.targetName;n.getLoop()||n.__changeFinalValue(s?(t||i)[s]:t||i)}l&&this._transitionState(e,a,r)}_attachComponent(e){if(e.__zr&&!e.__hostTarget)return;if(e===this)return;const t=this.__zr;t&&e.addSelfToZr(t),e.__zr=t,e.__hostTarget=this}_detachComponent(e){e.__zr&&e.removeSelfFromZr(e.__zr),e.__zr=null,e.__hostTarget=null}getClipPath(){return this._clipPath}setClipPath(e){this._clipPath&&this._clipPath!==e&&this.removeClipPath(),this._attachComponent(e),this._clipPath=e,this.markRedraw()}removeClipPath(){const e=this._clipPath;e&&(this._detachComponent(e),this._clipPath=null,this.markRedraw())}getTextContent(){return this._textContent}setTextContent(e){const t=this._textContent;t!==e&&(t&&t!==e&&this.removeTextContent(),e.innerTransformable=new Wa,this._attachComponent(e),this._textContent=e,this.markRedraw())}setTextConfig(e){this.textConfig||(this.textConfig={}),In(this.textConfig,e),this.markRedraw()}removeTextConfig(){this.textConfig=null,this.markRedraw()}removeTextContent(){const e=this._textContent;e&&(e.innerTransformable=null,this._detachComponent(e),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())}getTextGuideLine(){return this._textGuide}setTextGuideLine(e){this._textGuide&&this._textGuide!==e&&this.removeTextGuideLine(),this._attachComponent(e),this._textGuide=e,this.markRedraw()}removeTextGuideLine(){const e=this._textGuide;e&&(this._detachComponent(e),this._textGuide=null,this.markRedraw())}markRedraw(){this.__dirty|=1;const e=this.__zr;e&&(this.__inHover?e.refreshHover():e.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()}dirty(){this.markRedraw()}_toggleHoverLayerFlag(e){this.__inHover=e;const t=this._textContent,i=this._textGuide;t&&(t.__inHover=e),i&&(i.__inHover=e)}addSelfToZr(e){if(this.__zr===e)return;this.__zr=e;const t=this.animators;if(t)for(let i=0;i<t.length;i++)e.animation.addAnimator(t[i]);this._clipPath&&this._clipPath.addSelfToZr(e),this._textContent&&this._textContent.addSelfToZr(e),this._textGuide&&this._textGuide.addSelfToZr(e)}removeSelfFromZr(e){if(!this.__zr)return;this.__zr=null;const t=this.animators;if(t)for(let i=0;i<t.length;i++)e.animation.removeAnimator(t[i]);this._clipPath&&this._clipPath.removeSelfFromZr(e),this._textContent&&this._textContent.removeSelfFromZr(e),this._textGuide&&this._textGuide.removeSelfFromZr(e)}animate(e,t,i){let n=e?this[e]:this;const s=new ga(n,t,i);return e&&(s.targetName=e),this.addAnimator(s,e),s}addAnimator(e,t){const i=this.__zr,n=this;e.during((function(){n.updateDuringAnimation(t)})).done((function(){const t=n.animators,i=Ln(t,e);i>=0&&t.splice(i,1)})),this.animators.push(e),i&&i.animation.addAnimator(e),i&&i.wakeUp()}updateDuringAnimation(e){this.markRedraw()}stopAnimation(e,t){const i=this.animators,n=i.length,s=[];for(let r=0;r<n;r++){const n=i[r];e&&e!==n.scope?s.push(n):n.stop(t)}return this.animators=s,this}animateTo(e,t,i){ol(this,e,t,i)}animateFrom(e,t,i){ol(this,e,t,i,!0)}_transitionState(e,t,i,n){const s=ol(this,t,i,n);for(let t=0;t<s.length;t++)s[t].__fromStateTransition=e}getBoundingRect(){return null}getPaintRect(){return null}}function ol(e,t,i,n,s){const r=[];hl(e,"",e,t,i=i||{},n,r,s);let o=r.length,a=!1;const l=i.done,h=i.aborted,c=()=>{a=!0,o--,o<=0&&(a?l&&l():h&&h())},d=()=>{o--,o<=0&&(a?l&&l():h&&h())};o||l&&l(),r.length>0&&i.during&&r[0].during(((e,t)=>{i.during(t)}));for(let e=0;e<r.length;e++){const t=r[e];c&&t.done(c),d&&t.aborted(d),i.force&&t.duration(i.duration),t.start(i.easing)}return r}function al(e,t,i){for(let n=0;n<i;n++)e[n]=t[n]}function ll(e,t,i){if(Un(t[i]))if(Un(e[i])||(e[i]=[]),Kn(t[i])){const n=t[i].length;e[i].length!==n&&(e[i]=new t[i].constructor(n),al(e[i],t[i],n))}else{const n=t[i],s=e[i],r=n.length;if(Un(n[0])){const e=n[0].length;for(let t=0;t<r;t++)s[t]?al(s[t],n[t],e):s[t]=Array.prototype.slice.call(n[t])}else al(s,n,r);s.length=n.length}else e[i]=t[i]}function hl(e,t,i,n,s,r,o,a){const l=Hn(n),h=s.duration,c=s.delay,d=s.additive,u=s.setToFinal,p=!qn(r),f=e.animators;let m=[];for(let h=0;h<l.length;h++){const c=l[h],d=n[c];if(null!=d&&null!=i[c]&&(p||r[c]))if(!qn(d)||Un(d)||$n(d))m.push(c);else{if(t){a||(i[c]=d,e.updateDuringAnimation(t));continue}hl(e,c,i[c],d,s,r&&r[c],o,a)}else a||(i[c]=d,e.updateDuringAnimation(t),m.push(c))}let g=m.length;if(!d&&g)for(let e=0;e<f.length;e++){const i=f[e];if(i.targetName===t&&i.stopTracks(m)){const e=Ln(f,i);f.splice(e,1)}}if(s.force||(m=Vn(m,(e=>{return!((t=n[e])===(s=i[e])||Un(t)&&Un(s)&&function(e,t){const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}(t,s));var t,s})),g=m.length),g>0||s.force&&!o.length){let r,l,p;if(a){l={},u&&(r={});for(let e=0;e<g;e++){const t=m[e];l[t]=i[t],u?r[t]=n[t]:i[t]=n[t]}}else if(u){p={};for(let e=0;e<g;e++){const t=m[e];p[t]=ca(i[t]),ll(i,n,t)}}const v=new ga(i,!1,!1,d?Vn(f,(e=>e.targetName===t)):null);v.targetName=t,s.scope&&(v.scope=s.scope),u&&r&&v.whenWithKeys(0,r,m),p&&v.whenWithKeys(0,p,m),v.whenWithKeys(null==h?500:h,a?l:n,m).delay(c||0),e.addAnimator(v,t),o.push(v)}}rl.initDefaultProps=function(){const e=rl.prototype;function t(t,i,n,s){function r(e,t){Object.defineProperty(t,0,{get:()=>e[n],set(t){e[n]=t}}),Object.defineProperty(t,1,{get:()=>e[s],set(t){e[s]=t}})}Object.defineProperty(e,t,{get(){return this[i]||r(this,this[i]=[]),this[i]},set(e){this[n]=e[0],this[s]=e[1],this[i]=e,r(this,e)}})}e.type="element",e.name="",e.ignore=e.silent=e.isGroup=e.draggable=e.dragging=e.ignoreClip=e.__inHover=!1,e.__dirty=1,Object.defineProperty&&(t("position","_legacyPos","x","y"),t("scale","_legacyScale","scaleX","scaleY"),t("origin","_legacyOrigin","originX","originY"))}(),zn(rl,Ns),zn(rl,Wa);class cl extends rl{constructor(e){super(),this.isGroup=!0,this._children=[],this.attr(e)}childrenRef(){return this._children}children(){return this._children.slice()}childAt(e){return this._children[e]}childOfName(e){const t=this._children;for(let i=0;i<t.length;i++)if(t[i].name===e)return t[i]}childCount(){return this._children.length}add(e){return e&&e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),this}addBefore(e,t){if(e&&e!==this&&e.parent!==this&&t&&t.parent===this){const i=this._children,n=i.indexOf(t);n>=0&&(i.splice(n,0,e),this._doAdd(e))}return this}replace(e,t){const i=Ln(this._children,e);return i>=0&&this.replaceAt(t,i),this}replaceAt(e,t){const i=this._children,n=i[t];if(e&&e!==this&&e.parent!==this&&e!==n){i[t]=e,n.parent=null;const s=this.__zr;s&&n.removeSelfFromZr(s),this._doAdd(e)}return this}_doAdd(e){e.parent&&e.parent.remove(e),e.parent=this;const t=this.__zr;t&&t!==e.__zr&&e.addSelfToZr(t),t&&t.refresh()}remove(e){const t=this.__zr,i=this._children,n=Ln(i,e);return n<0||(i.splice(n,1),e.parent=null,t&&e.removeSelfFromZr(t),t&&t.refresh()),this}removeAll(){const e=this._children,t=this.__zr;for(let i=0;i<e.length;i++){const n=e[i];t&&n.removeSelfFromZr(t),n.parent=null}return e.length=0,this}eachChild(e,t){const i=this._children;for(let n=0;n<i.length;n++){const s=i[n];e.call(t,s,n)}return this}traverse(e,t){for(let i=0;i<this._children.length;i++){const n=this._children[i],s=e.call(t,n);n.isGroup&&!s&&n.traverse(e,t)}return this}addSelfToZr(e){super.addSelfToZr(e);for(let t=0;t<this._children.length;t++)this._children[t].addSelfToZr(e)}removeSelfFromZr(e){super.removeSelfFromZr(e);for(let t=0;t<this._children.length;t++)this._children[t].removeSelfFromZr(e)}getBoundingRect(e){const t=new wr(0,0,0,0),i=e||this._children,n=[];let s=null;for(let e=0;e<i.length;e++){const r=i[e];if(r.ignore||r.invisible)continue;const o=r.getBoundingRect(),a=r.getLocalTransform(n);a?(wr.applyTransform(t,o,a),s=s||t.clone(),s.union(t)):(s=s||o.clone(),s.union(o))}return s||t}}cl.prototype.type="group";const dl={};let ul={};class pl{constructor(e,t,i){this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,i=i||{},this.dom=t,this.id=e;const n=new Fr;let s=i.renderer||"canvas";dl[s]||(s=Hn(dl)[0]),i.useDirtyRect=null!=i.useDirtyRect&&i.useDirtyRect;const r=new dl[s](t,n,i,e),o=i.ssr||r.ssrOnly;this.storage=n,this.painter=r;const a=dn.node||dn.worker||o?null:new Ia(r.getViewportRoot(),r.root),l=i.useCoarsePointer;let h;(null==l||"auto"===l?dn.touchEventsSupported:!!l)&&(h=is(i.pointerSize,44)),this.handler=new Er(n,r,a,r.root,h),this.animation=new ya({stage:{update:o?null:()=>this._flush(!0)}}),o||this.animation.start()}add(e){e&&(this.storage.addRoot(e),e.addSelfToZr(this),this.refresh())}remove(e){e&&(this.storage.delRoot(e),e.removeSelfFromZr(this),this.refresh())}configLayer(e,t){this.painter.configLayer&&this.painter.configLayer(e,t),this.refresh()}setBackgroundColor(e){this.painter.setBackgroundColor&&this.painter.setBackgroundColor(e),this.refresh(),this._backgroundColor=e,this._darkMode=function(e){if(!e)return!1;if("string"==typeof e)return Lo(e,1)<.4;if(e.colorStops){const t=e.colorStops;let i=0;const n=t.length;for(let e=0;e<n;e++)i+=Lo(t[e].color,1);return i/=n,i<.4}return!1}(e)}getBackgroundColor(){return this._backgroundColor}setDarkMode(e){this._darkMode=e}isDarkMode(){return this._darkMode}refreshImmediately(e){e||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1}refresh(){this._needsRefresh=!0,this.animation.start()}flush(){this._flush(!1)}_flush(e){let t;const i=va();this._needsRefresh&&(t=!0,this.refreshImmediately(e)),this._needsRefreshHover&&(t=!0,this.refreshHoverImmediately());const n=va();t?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:n-i})):this._sleepAfterStill>0&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())}setSleepAfterStill(e){this._sleepAfterStill=e}wakeUp(){this.animation.start(),this._stillFrameAccum=0}refreshHover(){this._needsRefreshHover=!0}refreshHoverImmediately(){this._needsRefreshHover=!1,this.painter.refreshHover&&"canvas"===this.painter.getType()&&this.painter.refreshHover()}resize(e){e=e||{},this.painter.resize(e.width,e.height),this.handler.resize()}clearAnimation(){this.animation.clear()}getWidth(){return this.painter.getWidth()}getHeight(){return this.painter.getHeight()}setCursorStyle(e){this.handler.setCursorStyle(e)}findHover(e,t){return this.handler.findHover(e,t)}on(e,t,i){return this.handler.on(e,t,i),this}off(e,t){this.handler.off(e,t)}trigger(e,t){this.handler.trigger(e,t)}clear(){const e=this.storage.getRoots();for(let t=0;t<e.length;t++)e[t]instanceof cl&&e[t].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()}dispose(){var e;this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,e=this.id,delete ul[e]}}function fl(e,t){const i=new pl(Pn(),e,t);return ul[i.id]=i,i}function ml(e,t){dl[e]=t}let gl=function(e){return null};function vl(e){if("function"==typeof gl)return gl(e)}const yl="__zr_style_"+Math.round(10*Math.random()),xl={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},wl={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};xl[yl]=!0;const bl=["z","z2","invisible"],_l=["invisible"];class Sl extends rl{constructor(e){super(e)}_init(e){const t=Hn(e);for(let i=0;i<t.length;i++){const n=t[i];"style"===n?this.useStyle(e[n]):super.attrKV(n,e[n])}this.style||this.useStyle({})}beforeBrush(){}afterBrush(){}innerBeforeBrush(){}innerAfterBrush(){}shouldBePainted(e,t,i,n){const s=this.transform;if(this.ignore||this.invisible||0===this.style.opacity||this.culling&&(r=this,o=e,a=t,Ml.copy(r.getBoundingRect()),r.transform&&Ml.applyTransform(r.transform),Cl.width=o,Cl.height=a,!Ml.intersect(Cl))||s&&!s[0]&&!s[3])return!1;var r,o,a;if(i&&this.__clipPaths)for(let e=0;e<this.__clipPaths.length;++e)if(this.__clipPaths[e].isZeroArea())return!1;if(n&&this.parent){let e=this.parent;for(;e;){if(e.ignore)return!1;e=e.parent}}return!0}contain(e,t){return this.rectContain(e,t)}traverse(e,t){e.call(t,this)}rectContain(e,t){const i=this.transformCoordToLocal(e,t);return this.getBoundingRect().contain(i[0],i[1])}getPaintRect(){let e=this._paintRect;if(!this._paintRect||this.__dirty){const t=this.transform,i=this.getBoundingRect(),n=this.style,s=n.shadowBlur||0,r=n.shadowOffsetX||0,o=n.shadowOffsetY||0;e=this._paintRect||(this._paintRect=new wr(0,0,0,0)),t?wr.applyTransform(e,i,t):e.copy(i),(s||r||o)&&(e.width+=2*s+Math.abs(r),e.height+=2*s+Math.abs(o),e.x=Math.min(e.x,e.x+r-s),e.y=Math.min(e.y,e.y+o-s));const a=this.dirtyRectTolerance;e.isZero()||(e.x=Math.floor(e.x-a),e.y=Math.floor(e.y-a),e.width=Math.ceil(e.width+1+2*a),e.height=Math.ceil(e.height+1+2*a))}return e}setPrevPaintRect(e){e?(this._prevPaintRect=this._prevPaintRect||new wr(0,0,0,0),this._prevPaintRect.copy(e)):this._prevPaintRect=null}getPrevPaintRect(){return this._prevPaintRect}animateStyle(e){return this.animate("style",e)}updateDuringAnimation(e){"style"===e?this.dirtyStyle():this.markRedraw()}attrKV(e,t){"style"!==e?super.attrKV(e,t):this.style?this.setStyle(t):this.useStyle(t)}setStyle(e,t){return"string"==typeof e?this.style[e]=t:In(this.style,e),this.dirtyStyle(),this}dirtyStyle(e){e||this.markRedraw(),this.__dirty|=2,this._rect&&(this._rect=null)}dirty(){this.dirtyStyle()}styleChanged(){return!!(2&this.__dirty)}styleUpdated(){this.__dirty&=-3}createStyle(e){return ps(xl,e)}useStyle(e){e[yl]||(e=this.createStyle(e)),this.__inHover?this.__hoverStyle=e:this.style=e,this.dirtyStyle()}isStyleObject(e){return e[yl]}_innerSaveToNormal(e){super._innerSaveToNormal(e);const t=this._normalState;e.style&&!t.style&&(t.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(e,t,bl)}_applyStateObj(e,t,i,n,s,r){super._applyStateObj(e,t,i,n,s,r);const o=!(t&&n);let a;if(t&&t.style?s?n?a=t.style:(a=this._mergeStyle(this.createStyle(),i.style),this._mergeStyle(a,t.style)):(a=this._mergeStyle(this.createStyle(),n?this.style:i.style),this._mergeStyle(a,t.style)):o&&(a=i.style),a)if(s){const t=this.style;if(this.style=this.createStyle(o?{}:t),o){const e=Hn(t);for(let i=0;i<e.length;i++){const n=e[i];n in a&&(a[n]=a[n],this.style[n]=t[n])}}const i=Hn(a);for(let e=0;e<i.length;e++){const t=i[e];this.style[t]=this.style[t]}this._transitionState(e,{style:a},r,this.getAnimationStyleProps())}else this.useStyle(a);const l=this.__inHover?_l:bl;for(let e=0;e<l.length;e++){let n=l[e];t&&null!=t[n]?this[n]=t[n]:o&&null!=i[n]&&(this[n]=i[n])}}_mergeStates(e){const t=super._mergeStates(e);let i;for(let t=0;t<e.length;t++){const n=e[t];n.style&&(i=i||{},this._mergeStyle(i,n.style))}return i&&(t.style=i),t}_mergeStyle(e,t){return In(e,t),e}getAnimationStyleProps(){return wl}}Sl.initDefaultProps=function(){const e=Sl.prototype;e.type="displayable",e.invisible=!1,e.z=0,e.z2=0,e.zlevel=0,e.culling=!1,e.cursor="pointer",e.rectHover=!1,e.incremental=!1,e._rect=null,e.dirtyRectTolerance=0,e.__dirty=3}();const Ml=new wr(0,0,0,0),Cl=new wr(0,0,0,0),Al=Math.min,El=Math.max,Tl=Math.sin,Pl=Math.cos,Ol=2*Math.PI,Dl=xs(),Bl=xs(),Il=xs();function Rl(e,t,i){if(0===e.length)return;let n=e[0],s=n[0],r=n[0],o=n[1],a=n[1];for(let t=1;t<e.length;t++)n=e[t],s=Al(s,n[0]),r=El(r,n[0]),o=Al(o,n[1]),a=El(a,n[1]);t[0]=s,t[1]=o,i[0]=r,i[1]=a}function kl(e,t,i,n,s,r){s[0]=Al(e,i),s[1]=Al(t,n),r[0]=El(e,i),r[1]=El(t,n)}const Ll=[],zl=[];function Ul(e,t,i,n,s,r,o,a,l,h){const c=io,d=$r;let u=c(e,i,s,o,Ll);l[0]=1/0,l[1]=1/0,h[0]=-1/0,h[1]=-1/0;for(let t=0;t<u;t++){const n=d(e,i,s,o,Ll[t]);l[0]=Al(n,l[0]),h[0]=El(n,h[0])}u=c(t,n,r,a,zl);for(let e=0;e<u;e++){const i=d(t,n,r,a,zl[e]);l[1]=Al(i,l[1]),h[1]=El(i,h[1])}l[0]=Al(e,l[0]),h[0]=El(e,h[0]),l[0]=Al(o,l[0]),h[0]=El(o,h[0]),l[1]=Al(t,l[1]),h[1]=El(t,h[1]),l[1]=Al(a,l[1]),h[1]=El(a,h[1])}function Fl(e,t,i,n,s,r,o,a){const l=ao,h=ro,c=El(Al(l(e,i,s),1),0),d=El(Al(l(t,n,r),1),0),u=h(e,i,s,c),p=h(t,n,r,d);o[0]=Al(e,s,u),o[1]=Al(t,r,p),a[0]=El(e,s,u),a[1]=El(t,r,p)}function Nl(e,t,i,n,s,r,o,a,l){const h=ks,c=Ls,d=Math.abs(s-r);if(d%Ol<1e-4&&d>1e-4)return a[0]=e-i,a[1]=t-n,l[0]=e+i,void(l[1]=t+n);if(Dl[0]=Pl(s)*i+e,Dl[1]=Tl(s)*n+t,Bl[0]=Pl(r)*i+e,Bl[1]=Tl(r)*n+t,h(a,Dl,Bl),c(l,Dl,Bl),(s%=Ol)<0&&(s+=Ol),(r%=Ol)<0&&(r+=Ol),s>r&&!o?r+=Ol:s<r&&o&&(s+=Ol),o){const e=r;r=s,s=e}for(let o=0;o<r;o+=Math.PI/2)o>s&&(Il[0]=Pl(o)*i+e,Il[1]=Tl(o)*n+t,h(a,Il,a),c(l,Il,l))}const jl={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},Vl=[],Hl=[],Wl=[],Gl=[],Yl=[],Xl=[],Ql=Math.min,ql=Math.max,Zl=Math.cos,Kl=Math.sin,Jl=Math.abs,$l=Math.PI,eh=2*$l,th="undefined"!=typeof Float32Array,ih=[];function nh(e){return Math.round(e/$l*1e8)/1e8%2*$l}class sh{constructor(e){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,e&&(this._saveData=!1),this._saveData&&(this.data=[])}increaseVersion(){this._version++}getVersion(){return this._version}setScale(e,t,i){(i=i||0)>0&&(this._ux=Jl(i/ka/e)||0,this._uy=Jl(i/ka/t)||0)}setDPR(e){this.dpr=e}setContext(e){this._ctx=e}getContext(){return this._ctx}beginPath(){return this._ctx&&this._ctx.beginPath(),this.reset(),this}reset(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++}moveTo(e,t){return this._drawPendingPt(),this.addData(jl.M,e,t),this._ctx&&this._ctx.moveTo(e,t),this._x0=e,this._y0=t,this._xi=e,this._yi=t,this}lineTo(e,t){const i=Jl(e-this._xi),n=Jl(t-this._yi),s=i>this._ux||n>this._uy;if(this.addData(jl.L,e,t),this._ctx&&s&&this._ctx.lineTo(e,t),s)this._xi=e,this._yi=t,this._pendingPtDist=0;else{const s=i*i+n*n;s>this._pendingPtDist&&(this._pendingPtX=e,this._pendingPtY=t,this._pendingPtDist=s)}return this}bezierCurveTo(e,t,i,n,s,r){return this._drawPendingPt(),this.addData(jl.C,e,t,i,n,s,r),this._ctx&&this._ctx.bezierCurveTo(e,t,i,n,s,r),this._xi=s,this._yi=r,this}quadraticCurveTo(e,t,i,n){return this._drawPendingPt(),this.addData(jl.Q,e,t,i,n),this._ctx&&this._ctx.quadraticCurveTo(e,t,i,n),this._xi=i,this._yi=n,this}arc(e,t,i,n,s,r){this._drawPendingPt(),ih[0]=n,ih[1]=s,function(e,t){let i=nh(e[0]);i<0&&(i+=eh);let n=i-e[0],s=e[1];s+=n,!t&&s-i>=eh?s=i+eh:t&&i-s>=eh?s=i-eh:!t&&i>s?s=i+(eh-nh(i-s)):t&&i<s&&(s=i-(eh-nh(s-i))),e[0]=i,e[1]=s}(ih,r),n=ih[0];let o=(s=ih[1])-n;return this.addData(jl.A,e,t,i,i,n,o,0,r?0:1),this._ctx&&this._ctx.arc(e,t,i,n,s,r),this._xi=Zl(s)*i+e,this._yi=Kl(s)*i+t,this}arcTo(e,t,i,n,s){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(e,t,i,n,s),this}rect(e,t,i,n){return this._drawPendingPt(),this._ctx&&this._ctx.rect(e,t,i,n),this.addData(jl.R,e,t,i,n),this}closePath(){this._drawPendingPt(),this.addData(jl.Z);const e=this._ctx,t=this._x0,i=this._y0;return e&&e.closePath(),this._xi=t,this._yi=i,this}fill(e){e&&e.fill(),this.toStatic()}stroke(e){e&&e.stroke(),this.toStatic()}len(){return this._len}setData(e){const t=e.length;this.data&&this.data.length===t||!th||(this.data=new Float32Array(t));for(let i=0;i<t;i++)this.data[i]=e[i];this._len=t}appendPath(e){e instanceof Array||(e=[e]);const t=e.length;let i=0,n=this._len;for(let n=0;n<t;n++)i+=e[n].len();th&&this.data instanceof Float32Array&&(this.data=new Float32Array(n+i));for(let i=0;i<t;i++){const t=e[i].data;for(let e=0;e<t.length;e++)this.data[n++]=t[e]}this._len=n}addData(e,t,i,n,s,r,o,a,l){if(!this._saveData)return;let h=this.data;this._len+arguments.length>h.length&&(this._expandData(),h=this.data);for(let e=0;e<arguments.length;e++)h[this._len++]=arguments[e]}_drawPendingPt(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)}_expandData(){if(!(this.data instanceof Array)){const e=[];for(let t=0;t<this._len;t++)e[t]=this.data[t];this.data=e}}toStatic(){if(!this._saveData)return;this._drawPendingPt();const e=this.data;e instanceof Array&&(e.length=this._len,th&&this._len>11&&(this.data=new Float32Array(e)))}getBoundingRect(){Wl[0]=Wl[1]=Yl[0]=Yl[1]=Number.MAX_VALUE,Gl[0]=Gl[1]=Xl[0]=Xl[1]=-Number.MAX_VALUE;const e=this.data;let t,i=0,n=0,s=0,r=0;for(t=0;t<this._len;){const o=e[t++],a=1===t;switch(a&&(i=e[t],n=e[t+1],s=i,r=n),o){case jl.M:i=s=e[t++],n=r=e[t++],Yl[0]=s,Yl[1]=r,Xl[0]=s,Xl[1]=r;break;case jl.L:kl(i,n,e[t],e[t+1],Yl,Xl),i=e[t++],n=e[t++];break;case jl.C:Ul(i,n,e[t++],e[t++],e[t++],e[t++],e[t],e[t+1],Yl,Xl),i=e[t++],n=e[t++];break;case jl.Q:Fl(i,n,e[t++],e[t++],e[t],e[t+1],Yl,Xl),i=e[t++],n=e[t++];break;case jl.A:const o=e[t++],l=e[t++],h=e[t++],c=e[t++],d=e[t++],u=e[t++]+d;t+=1;const p=!e[t++];a&&(s=Zl(d)*h+o,r=Kl(d)*c+l),Nl(o,l,h,c,d,u,p,Yl,Xl),i=Zl(u)*h+o,n=Kl(u)*c+l;break;case jl.R:s=i=e[t++],r=n=e[t++],kl(s,r,s+e[t++],r+e[t++],Yl,Xl);break;case jl.Z:i=s,n=r}ks(Wl,Wl,Yl),Ls(Gl,Gl,Xl)}return 0===t&&(Wl[0]=Wl[1]=Gl[0]=Gl[1]=0),new wr(Wl[0],Wl[1],Gl[0]-Wl[0],Gl[1]-Wl[1])}_calculateLength(){const e=this.data,t=this._len,i=this._ux,n=this._uy;let s=0,r=0,o=0,a=0;this._pathSegLen||(this._pathSegLen=[]);const l=this._pathSegLen;let h=0,c=0;for(let d=0;d<t;){const u=e[d++],p=1===d;p&&(s=e[d],r=e[d+1],o=s,a=r);let f=-1;switch(u){case jl.M:s=o=e[d++],r=a=e[d++];break;case jl.L:{const o=e[d++],a=e[d++],l=o-s,h=a-r;(Jl(l)>i||Jl(h)>n||d===t-1)&&(f=Math.sqrt(l*l+h*h),s=o,r=a);break}case jl.C:{const t=e[d++],i=e[d++],n=e[d++],o=e[d++],a=e[d++],l=e[d++];f=so(s,r,t,i,n,o,a,l,10),s=a,r=l;break}case jl.Q:{const t=e[d++],i=e[d++],n=e[d++],o=e[d++];f=ho(s,r,t,i,n,o,10),s=n,r=o;break}case jl.A:const l=e[d++],h=e[d++],c=e[d++],u=e[d++],m=e[d++];let g=e[d++];const v=g+m;d+=1,e[d++],p&&(o=Zl(m)*c+l,a=Kl(m)*u+h),f=ql(c,u)*Ql(eh,Math.abs(g)),s=Zl(v)*c+l,r=Kl(v)*u+h;break;case jl.R:o=s=e[d++],a=r=e[d++],f=2*e[d++]+2*e[d++];break;case jl.Z:{const e=o-s,t=a-r;f=Math.sqrt(e*e+t*t),s=o,r=a;break}}f>=0&&(l[c++]=f,h+=f)}return this._pathLen=h,h}rebuildPath(e,t){const i=this.data,n=this._ux,s=this._uy,r=this._len;let o,a,l,h,c,d;const u=t<1;let p,f,m,g,v,y=0,x=0,w=0;if(!u||(this._pathSegLen||this._calculateLength(),p=this._pathSegLen,f=this._pathLen,m=t*f,m))e:for(let t=0;t<r;){const r=i[t++],f=1===t;switch(f&&(l=i[t],h=i[t+1],o=l,a=h),r!==jl.L&&w>0&&(e.lineTo(g,v),w=0),r){case jl.M:o=l=i[t++],a=h=i[t++],e.moveTo(l,h);break;case jl.L:{c=i[t++],d=i[t++];const r=Jl(c-l),o=Jl(d-h);if(r>n||o>s){if(u){const t=p[x++];if(y+t>m){const i=(m-y)/t;e.lineTo(l*(1-i)+c*i,h*(1-i)+d*i);break e}y+=t}e.lineTo(c,d),l=c,h=d,w=0}else{const e=r*r+o*o;e>w&&(g=c,v=d,w=e)}break}case jl.C:{const n=i[t++],s=i[t++],r=i[t++],o=i[t++],a=i[t++],c=i[t++];if(u){const t=p[x++];if(y+t>m){const i=(m-y)/t;no(l,n,r,a,i,Vl),no(h,s,o,c,i,Hl),e.bezierCurveTo(Vl[1],Hl[1],Vl[2],Hl[2],Vl[3],Hl[3]);break e}y+=t}e.bezierCurveTo(n,s,r,o,a,c),l=a,h=c;break}case jl.Q:{const n=i[t++],s=i[t++],r=i[t++],o=i[t++];if(u){const t=p[x++];if(y+t>m){const i=(m-y)/t;lo(l,n,r,i,Vl),lo(h,s,o,i,Hl),e.quadraticCurveTo(Vl[1],Hl[1],Vl[2],Hl[2]);break e}y+=t}e.quadraticCurveTo(n,s,r,o),l=r,h=o;break}case jl.A:const r=i[t++],b=i[t++],_=i[t++],S=i[t++];let M=i[t++],C=i[t++];const A=i[t++],E=!i[t++],T=_>S?_:S,P=Jl(_-S)>.001;let O=M+C,D=!1;if(u){const e=p[x++];y+e>m&&(O=M+C*(m-y)/e,D=!0),y+=e}if(P&&e.ellipse?e.ellipse(r,b,_,S,A,M,O,E):e.arc(r,b,T,M,O,E),D)break e;f&&(o=Zl(M)*_+r,a=Kl(M)*S+b),l=Zl(O)*_+r,h=Kl(O)*S+b;break;case jl.R:o=l=i[t],a=h=i[t+1],c=i[t++],d=i[t++];const B=i[t++],I=i[t++];if(u){const t=p[x++];if(y+t>m){let t=m-y;e.moveTo(c,d),e.lineTo(c+Ql(t,B),d),t-=B,t>0&&e.lineTo(c+B,d+Ql(t,I)),t-=I,t>0&&e.lineTo(c+ql(B-t,0),d+I),t-=B,t>0&&e.lineTo(c,d+ql(I-t,0));break e}y+=t}e.rect(c,d,B,I);break;case jl.Z:if(u){const t=p[x++];if(y+t>m){const i=(m-y)/t;e.lineTo(l*(1-i)+o*i,h*(1-i)+a*i);break e}y+=t}e.closePath(),l=o,h=a}}}clone(){const e=new sh,t=this.data;return e.data=t.slice?t.slice():Array.prototype.slice.call(t),e._len=this._len,e}}function rh(e,t,i,n,s,r,o){if(0===s)return!1;const a=s;let l=0,h=e;if(o>t+a&&o>n+a||o<t-a&&o<n-a||r>e+a&&r>i+a||r<e-a&&r<i-a)return!1;if(e===i)return Math.abs(r-e)<=a/2;l=(t-n)/(e-i),h=(e*n-i*t)/(e-i);const c=l*r-o+h;return c*c/(l*l+1)<=a/2*a/2}function oh(e,t,i,n,s,r,o,a,l,h,c){if(0===l)return!1;const d=l;if(c>t+d&&c>n+d&&c>r+d&&c>a+d||c<t-d&&c<n-d&&c<r-d&&c<a-d||h>e+d&&h>i+d&&h>s+d&&h>o+d||h<e-d&&h<i-d&&h<s-d&&h<o-d)return!1;const u=function(e,t,i,n,s,r,o,a,l,h,c){let d,u,p,f,m,g=.005,v=1/0;Qr[0]=l,Qr[1]=h;for(let l=0;l<1;l+=.05)qr[0]=$r(e,i,s,o,l),qr[1]=$r(t,n,r,a,l),f=Bs(Qr,qr),f<v&&(d=l,v=f);v=1/0;for(let l=0;l<32&&!(g<Gr);l++)u=d-g,p=d+g,qr[0]=$r(e,i,s,o,u),qr[1]=$r(t,n,r,a,u),f=Bs(qr,Qr),u>=0&&f<v?(d=u,v=f):(Zr[0]=$r(e,i,s,o,p),Zr[1]=$r(t,n,r,a,p),m=Bs(Zr,Qr),p<=1&&m<v?(d=p,v=m):g*=.5);return Hr(v)}(e,t,i,n,s,r,o,a,h,c);return u<=d/2}function ah(e,t,i,n,s,r,o,a,l){if(0===o)return!1;const h=o;if(l>t+h&&l>n+h&&l>r+h||l<t-h&&l<n-h&&l<r-h||a>e+h&&a>i+h&&a>s+h||a<e-h&&a<i-h&&a<s-h)return!1;const c=function(e,t,i,n,s,r,o,a,l){let h,c=.005,d=1/0;Qr[0]=o,Qr[1]=a;for(let o=0;o<1;o+=.05){qr[0]=ro(e,i,s,o),qr[1]=ro(t,n,r,o);const a=Bs(Qr,qr);a<d&&(h=o,d=a)}d=1/0;for(let o=0;o<32&&!(c<Gr);o++){const o=h-c,a=h+c;qr[0]=ro(e,i,s,o),qr[1]=ro(t,n,r,o);const l=Bs(qr,Qr);if(o>=0&&l<d)h=o,d=l;else{Zr[0]=ro(e,i,s,a),Zr[1]=ro(t,n,r,a);const o=Bs(Zr,Qr);a<=1&&o<d?(h=a,d=o):c*=.5}}return Hr(d)}(e,t,i,n,s,r,a,l);return c<=h/2}sh.CMD=jl,sh.initDefaultProps=function(){const e=sh.prototype;e._saveData=!0,e._ux=0,e._uy=0,e._pendingPtDist=0,e._version=0}();const lh=2*Math.PI;function hh(e){return(e%=lh)<0&&(e+=lh),e}const ch=2*Math.PI;function dh(e,t,i,n,s,r,o,a,l){if(0===o)return!1;const h=o;a-=e,l-=t;const c=Math.sqrt(a*a+l*l);if(c-h>i||c+h<i)return!1;if(Math.abs(n-s)%ch<1e-4)return!0;if(r){const e=n;n=hh(s),s=hh(e)}else n=hh(n),s=hh(s);n>s&&(s+=ch);let d=Math.atan2(l,a);return d<0&&(d+=ch),d>=n&&d<=s||d+ch>=n&&d+ch<=s}function uh(e,t,i,n,s,r){if(r>t&&r>n||r<t&&r<n)return 0;if(n===t)return 0;const o=(r-t)/(n-t);let a=n<t?1:-1;1!==o&&0!==o||(a=n<t?.5:-.5);const l=o*(i-e)+e;return l===s?1/0:l>s?a:0}const ph=sh.CMD,fh=2*Math.PI,mh=[-1,-1,-1],gh=[-1,-1];function vh(){const e=gh[0];gh[0]=gh[1],gh[1]=e}function yh(e,t,i,n,s,r,o,a,l,h){if(h>t&&h>n&&h>r&&h>a||h<t&&h<n&&h<r&&h<a)return 0;const c=to(t,n,r,a,h,mh);if(0===c)return 0;{let h,d,u=0,p=-1;for(let f=0;f<c;f++){let c=mh[f],m=0===c||1===c?.5:1;$r(e,i,s,o,c)<l||(p<0&&(p=io(t,n,r,a,gh),gh[1]<gh[0]&&p>1&&vh(),h=$r(t,n,r,a,gh[0]),p>1&&(d=$r(t,n,r,a,gh[1]))),2===p?c<gh[0]?u+=h<t?m:-m:c<gh[1]?u+=d<h?m:-m:u+=a<d?m:-m:c<gh[0]?u+=h<t?m:-m:u+=a<h?m:-m)}return u}}function xh(e,t,i,n,s,r,o,a){if(a>t&&a>n&&a>r||a<t&&a<n&&a<r)return 0;const l=function(e,t,i,n,s){const r=e-2*t+i,o=2*(t-e),a=e-n;let l=0;if(Kr(r)){if(Jr(o)){const e=-a/o;e>=0&&e<=1&&(s[l++]=e)}}else{const e=o*o-4*r*a;if(Kr(e)){const e=-o/(2*r);e>=0&&e<=1&&(s[l++]=e)}else if(e>0){const t=Hr(e),i=(-o+t)/(2*r),n=(-o-t)/(2*r);i>=0&&i<=1&&(s[l++]=i),n>=0&&n<=1&&(s[l++]=n)}}return l}(t,n,r,a,mh);if(0===l)return 0;{const a=ao(t,n,r);if(a>=0&&a<=1){let h=0,c=ro(t,n,r,a);for(let n=0;n<l;n++){let l=0===mh[n]||1===mh[n]?.5:1;ro(e,i,s,mh[n])<o||(mh[n]<a?h+=c<t?l:-l:h+=r<c?l:-l)}return h}{const n=0===mh[0]||1===mh[0]?.5:1;return ro(e,i,s,mh[0])<o?0:r<t?n:-n}}}function wh(e,t,i,n,s,r,o,a){if((a-=t)>i||a<-i)return 0;const l=Math.sqrt(i*i-a*a);mh[0]=-l,mh[1]=l;const h=Math.abs(n-s);if(h<1e-4)return 0;if(h>=fh-1e-4){n=0,s=fh;const t=r?1:-1;return o>=mh[0]+e&&o<=mh[1]+e?t:0}if(n>s){const e=n;n=s,s=e}n<0&&(n+=fh,s+=fh);let c=0;for(let t=0;t<2;t++){const i=mh[t];if(i+e>o){let e=Math.atan2(a,i),t=r?1:-1;e<0&&(e=fh+e),(e>=n&&e<=s||e+fh>=n&&e+fh<=s)&&(e>Math.PI/2&&e<1.5*Math.PI&&(t=-t),c+=t)}}return c}function bh(e,t,i,n,s){const r=e.data,o=e.len();let a,l,h=0,c=0,d=0,u=0,p=0;for(let e=0;e<o;){const o=r[e++],f=1===e;switch(o===ph.M&&e>1&&(i||(h+=uh(c,d,u,p,n,s))),f&&(c=r[e],d=r[e+1],u=c,p=d),o){case ph.M:u=r[e++],p=r[e++],c=u,d=p;break;case ph.L:if(i){if(rh(c,d,r[e],r[e+1],t,n,s))return!0}else h+=uh(c,d,r[e],r[e+1],n,s)||0;c=r[e++],d=r[e++];break;case ph.C:if(i){if(oh(c,d,r[e++],r[e++],r[e++],r[e++],r[e],r[e+1],t,n,s))return!0}else h+=yh(c,d,r[e++],r[e++],r[e++],r[e++],r[e],r[e+1],n,s)||0;c=r[e++],d=r[e++];break;case ph.Q:if(i){if(ah(c,d,r[e++],r[e++],r[e],r[e+1],t,n,s))return!0}else h+=xh(c,d,r[e++],r[e++],r[e],r[e+1],n,s)||0;c=r[e++],d=r[e++];break;case ph.A:const o=r[e++],m=r[e++],g=r[e++],v=r[e++],y=r[e++],x=r[e++];e+=1;const w=!!(1-r[e++]);a=Math.cos(y)*g+o,l=Math.sin(y)*v+m,f?(u=a,p=l):h+=uh(c,d,a,l,n,s);const b=(n-o)*v/g+o;if(i){if(dh(o,m,v,y,y+x,w,t,b,s))return!0}else h+=wh(o,m,v,y,y+x,w,b,s);c=Math.cos(y+x)*g+o,d=Math.sin(y+x)*v+m;break;case ph.R:if(u=c=r[e++],p=d=r[e++],a=u+r[e++],l=p+r[e++],i){if(rh(u,p,a,p,t,n,s)||rh(a,p,a,l,t,n,s)||rh(a,l,u,l,t,n,s)||rh(u,l,u,p,t,n,s))return!0}else h+=uh(a,p,a,l,n,s),h+=uh(u,l,u,p,n,s);break;case ph.Z:if(i){if(rh(c,d,u,p,t,n,s))return!0}else h+=uh(c,d,u,p,n,s);c=u,d=p}}return i||function(e,t){return Math.abs(e-t)<1e-4}(d,p)||(h+=uh(c,d,u,p,n,s)||0),0!==h}const _h=Rn({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},xl),Sh={style:Rn({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},wl.style)},Mh=Ga.concat(["invisible","culling","z","z2","zlevel","parent"]);class Ch extends Sl{constructor(e){super(e)}update(){super.update();const e=this.style;if(e.decal){const t=this._decalEl=this._decalEl||new Ch;t.buildPath===Ch.prototype.buildPath&&(t.buildPath=e=>{this.buildPath(e,this.shape)}),t.silent=!0;const i=t.style;for(let t in e)i[t]!==e[t]&&(i[t]=e[t]);i.fill=e.fill?e.decal:null,i.decal=null,i.shadowColor=null,e.strokeFirst&&(i.stroke=null);for(let e=0;e<Mh.length;++e)t[Mh[e]]=this[Mh[e]];t.__dirty|=1}else this._decalEl&&(this._decalEl=null)}getDecalElement(){return this._decalEl}_init(e){const t=Hn(e);this.shape=this.getDefaultShape();const i=this.getDefaultStyle();i&&this.useStyle(i);for(let i=0;i<t.length;i++){const n=t[i],s=e[n];"style"===n?this.style?In(this.style,s):this.useStyle(s):"shape"===n?In(this.shape,s):super.attrKV(n,s)}this.style||this.useStyle({})}getDefaultStyle(){return null}getDefaultShape(){return{}}canBeInsideText(){return this.hasFill()}getInsideTextFill(){const e=this.style.fill;if("none"!==e){if(Xn(e)){const t=Lo(e,0);return t>.5?La:t>.2?"#eee":za}if(e)return za}return La}getInsideTextStroke(e){const t=this.style.fill;if(Xn(t)){const i=this.__zr;if(!(!i||!i.isDarkMode())==Lo(e,0)<.4)return t}}buildPath(e,t,i){}pathUpdated(){this.__dirty&=-5}getUpdatedPathProxy(e){return!this.path&&this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,e),this.path}createPathProxy(){this.path=new sh(!1)}hasStroke(){const e=this.style,t=e.stroke;return!(null==t||"none"===t||!(e.lineWidth>0))}hasFill(){const e=this.style.fill;return null!=e&&"none"!==e}getBoundingRect(){let e=this._rect;const t=this.style,i=!e;if(i){let t=!1;this.path||(t=!0,this.createPathProxy());let i=this.path;(t||4&this.__dirty)&&(i.beginPath(),this.buildPath(i,this.shape,!1),this.pathUpdated()),e=i.getBoundingRect()}if(this._rect=e,this.hasStroke()&&this.path&&this.path.len()>0){const n=this._rectStroke||(this._rectStroke=e.clone());if(this.__dirty||i){n.copy(e);const i=t.strokeNoScale?this.getLineScale():1;let s=t.lineWidth;if(!this.hasFill()){const e=this.strokeContainThreshold;s=Math.max(s,null==e?4:e)}i>1e-10&&(n.width+=s/i,n.height+=s/i,n.x-=s/i/2,n.y-=s/i/2)}return n}return e}contain(e,t){const i=this.transformCoordToLocal(e,t),n=this.getBoundingRect(),s=this.style;if(e=i[0],t=i[1],n.contain(e,t)){const i=this.path;if(this.hasStroke()){let n=s.lineWidth,r=s.strokeNoScale?this.getLineScale():1;if(r>1e-10&&(this.hasFill()||(n=Math.max(n,this.strokeContainThreshold)),function(e,t,i,n){return bh(e,t,!0,i,n)}(i,n/r,e,t)))return!0}if(this.hasFill())return function(e,t,i){return bh(e,0,!1,t,i)}(i,e,t)}return!1}dirtyShape(){this.__dirty|=4,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()}dirty(){this.dirtyStyle(),this.dirtyShape()}animateShape(e){return this.animate("shape",e)}updateDuringAnimation(e){"style"===e?this.dirtyStyle():"shape"===e?this.dirtyShape():this.markRedraw()}attrKV(e,t){"shape"===e?this.setShape(t):super.attrKV(e,t)}setShape(e,t){let i=this.shape;return i||(i=this.shape={}),"string"==typeof e?i[e]=t:In(i,e),this.dirtyShape(),this}shapeChanged(){return!!(4&this.__dirty)}createStyle(e){return ps(_h,e)}_innerSaveToNormal(e){super._innerSaveToNormal(e);const t=this._normalState;e.shape&&!t.shape&&(t.shape=In({},this.shape))}_applyStateObj(e,t,i,n,s,r){super._applyStateObj(e,t,i,n,s,r);const o=!(t&&n);let a;if(t&&t.shape?s?n?a=t.shape:(a=In({},i.shape),In(a,t.shape)):(a=In({},n?this.shape:i.shape),In(a,t.shape)):o&&(a=i.shape),a)if(s){this.shape=In({},this.shape);const t={},i=Hn(a);for(let e=0;e<i.length;e++){const n=i[e];"object"==typeof a[n]?this.shape[n]=a[n]:t[n]=a[n]}this._transitionState(e,{shape:t},r)}else this.shape=a,this.dirtyShape()}_mergeStates(e){const t=super._mergeStates(e);let i;for(let t=0;t<e.length;t++){const n=e[t];n.shape&&(i=i||{},this._mergeStyle(i,n.shape))}return i&&(t.shape=i),t}getAnimationStyleProps(){return Sh}isZeroArea(){return!1}static extend(e){class t extends Ch{getDefaultStyle(){return Dn(e.style)}getDefaultShape(){return Dn(e.shape)}constructor(t){super(t),e.init&&e.init.call(this,t)}}for(let i in e)"function"==typeof e[i]&&(t.prototype[i]=e[i]);return t}}Ch.initDefaultProps=function(){const e=Ch.prototype;e.type="path",e.strokeContainThreshold=5,e.segmentIgnoreThreshold=0,e.subPixelOptimize=!1,e.autoBatch=!1,e.__dirty=7}();const Ah=sh.CMD,Eh=[[],[],[]],Th=Math.sqrt,Ph=Math.atan2;function Oh(e,t){if(!t)return;let i=e.data;const n=e.len();let s,r,o,a,l,h;const c=Ah.M,d=Ah.C,u=Ah.L,p=Ah.R,f=Ah.A,m=Ah.Q;for(o=0,a=0;o<n;){switch(s=i[o++],a=o,r=0,s){case c:case u:r=1;break;case d:r=3;break;case m:r=2;break;case f:const e=t[4],n=t[5],s=Th(t[0]*t[0]+t[1]*t[1]),l=Th(t[2]*t[2]+t[3]*t[3]),g=Ph(-t[1]/l,t[0]/s);i[o]*=s,i[o++]+=e,i[o]*=l,i[o++]+=n,i[o++]*=s,i[o++]*=l,i[o++]+=g,i[o++]+=g,o+=2,a=o;break;case p:h[0]=i[o++],h[1]=i[o++],Rs(h,h,t),i[a++]=h[0],i[a++]=h[1],h[0]+=i[o++],h[1]+=i[o++],Rs(h,h,t),i[a++]=h[0],i[a++]=h[1]}for(l=0;l<r;l++){let e=Eh[l];e[0]=i[o++],e[1]=i[o++],Rs(e,e,t),i[a++]=e[0],i[a++]=e[1]}}e.increaseVersion()}const Dh=Math.sqrt,Bh=Math.sin,Ih=Math.cos,Rh=Math.PI;function kh(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Lh(e,t){return(e[0]*t[0]+e[1]*t[1])/(kh(e)*kh(t))}function zh(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(Lh(e,t))}function Uh(e,t,i,n,s,r,o,a,l,h,c){const d=l*(Rh/180),u=Ih(d)*(e-i)/2+Bh(d)*(t-n)/2,p=-1*Bh(d)*(e-i)/2+Ih(d)*(t-n)/2,f=u*u/(o*o)+p*p/(a*a);f>1&&(o*=Dh(f),a*=Dh(f));const m=(s===r?-1:1)*Dh((o*o*(a*a)-o*o*(p*p)-a*a*(u*u))/(o*o*(p*p)+a*a*(u*u)))||0,g=m*o*p/a,v=m*-a*u/o,y=(e+i)/2+Ih(d)*g-Bh(d)*v,x=(t+n)/2+Bh(d)*g+Ih(d)*v,w=zh([1,0],[(u-g)/o,(p-v)/a]),b=[(u-g)/o,(p-v)/a],_=[(-1*u-g)/o,(-1*p-v)/a];let S=zh(b,_);if(Lh(b,_)<=-1&&(S=Rh),Lh(b,_)>=1&&(S=0),S<0){const e=Math.round(S/Rh*1e6)/1e6;S=2*Rh+e%2*Rh}c.addData(h,y,x,o,a,w,S,d,r)}const Fh=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/gi,Nh=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;class jh extends Ch{applyTransform(e){}}function Vh(e){return null!=e.setData}function Hh(e,t){const i=function(e){const t=new sh;if(!e)return t;let i,n=0,s=0,r=n,o=s;const a=sh.CMD,l=e.match(Fh);if(!l)return t;for(let e=0;e<l.length;e++){const h=l[e];let c,d=h.charAt(0);const u=h.match(Nh)||[],p=u.length;for(let e=0;e<p;e++)u[e]=parseFloat(u[e]);let f=0;for(;f<p;){let e,l,h,p,m,g,v,y,x,w=n,b=s;switch(d){case"l":n+=u[f++],s+=u[f++],c=a.L,t.addData(c,n,s);break;case"L":n=u[f++],s=u[f++],c=a.L,t.addData(c,n,s);break;case"m":n+=u[f++],s+=u[f++],c=a.M,t.addData(c,n,s),r=n,o=s,d="l";break;case"M":n=u[f++],s=u[f++],c=a.M,t.addData(c,n,s),r=n,o=s,d="L";break;case"h":n+=u[f++],c=a.L,t.addData(c,n,s);break;case"H":n=u[f++],c=a.L,t.addData(c,n,s);break;case"v":s+=u[f++],c=a.L,t.addData(c,n,s);break;case"V":s=u[f++],c=a.L,t.addData(c,n,s);break;case"C":c=a.C,t.addData(c,u[f++],u[f++],u[f++],u[f++],u[f++],u[f++]),n=u[f-2],s=u[f-1];break;case"c":c=a.C,t.addData(c,u[f++]+n,u[f++]+s,u[f++]+n,u[f++]+s,u[f++]+n,u[f++]+s),n+=u[f-2],s+=u[f-1];break;case"S":e=n,l=s,y=t.len(),x=t.data,i===a.C&&(e+=n-x[y-4],l+=s-x[y-3]),c=a.C,w=u[f++],b=u[f++],n=u[f++],s=u[f++],t.addData(c,e,l,w,b,n,s);break;case"s":e=n,l=s,y=t.len(),x=t.data,i===a.C&&(e+=n-x[y-4],l+=s-x[y-3]),c=a.C,w=n+u[f++],b=s+u[f++],n+=u[f++],s+=u[f++],t.addData(c,e,l,w,b,n,s);break;case"Q":w=u[f++],b=u[f++],n=u[f++],s=u[f++],c=a.Q,t.addData(c,w,b,n,s);break;case"q":w=u[f++]+n,b=u[f++]+s,n+=u[f++],s+=u[f++],c=a.Q,t.addData(c,w,b,n,s);break;case"T":e=n,l=s,y=t.len(),x=t.data,i===a.Q&&(e+=n-x[y-4],l+=s-x[y-3]),n=u[f++],s=u[f++],c=a.Q,t.addData(c,e,l,n,s);break;case"t":e=n,l=s,y=t.len(),x=t.data,i===a.Q&&(e+=n-x[y-4],l+=s-x[y-3]),n+=u[f++],s+=u[f++],c=a.Q,t.addData(c,e,l,n,s);break;case"A":h=u[f++],p=u[f++],m=u[f++],g=u[f++],v=u[f++],w=n,b=s,n=u[f++],s=u[f++],c=a.A,Uh(w,b,n,s,g,v,h,p,m,c,t);break;case"a":h=u[f++],p=u[f++],m=u[f++],g=u[f++],v=u[f++],w=n,b=s,n+=u[f++],s+=u[f++],c=a.A,Uh(w,b,n,s,g,v,h,p,m,c,t)}}"z"!==d&&"Z"!==d||(c=a.Z,t.addData(c),n=r,s=o),i=c}return t.toStatic(),t}(e),n=In({},t);return n.buildPath=function(e){if(Vh(e)){e.setData(i.data);const t=e.getContext();t&&e.rebuildPath(t,1)}else{const t=e;i.rebuildPath(t,1)}},n.applyTransform=function(e){Oh(i,e),this.dirtyShape()},n}function Wh(e,t){return new jh(Hh(e,t))}function Gh(e,t){t=t||{};const i=new Ch;return e.shape&&i.setShape(e.shape),i.setStyle(e.style),t.bakeTransform?Oh(i.path,e.getComputedTransform()):t.toLocal?i.setLocalTransform(e.getComputedTransform()):i.copyTransform(e),i.buildPath=e.buildPath,i.applyTransform=i.applyTransform,i.z=e.z,i.z2=e.z2,i.zlevel=e.zlevel,i}var Yh=Object.freeze({__proto__:null,clonePath:Gh,createFromString:Wh,extendFromString:function(e,t){const i=Hh(e,t);return class extends jh{constructor(e){super(e),this.applyTransform=i.applyTransform,this.buildPath=i.buildPath}}},mergePath:function(e,t){const i=[],n=e.length;for(let t=0;t<n;t++){const n=e[t];i.push(n.getUpdatedPathProxy(!0))}const s=new Ch(t);return s.createPathProxy(),s.buildPath=function(e){if(Vh(e)){e.appendPath(i);const t=e.getContext();t&&e.rebuildPath(t,1)}},s}});const Xh=Rn({x:0,y:0},xl),Qh={style:Rn({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},wl.style)};class qh extends Sl{createStyle(e){return ps(Xh,e)}_getSize(e){const t=this.style;let i=t[e];if(null!=i)return i;const n=(s=t.image)&&"string"!=typeof s&&s.width&&s.height?t.image:this.__image;var s;if(!n)return 0;const r="width"===e?"height":"width";let o=t[r];return null==o?n[e]:n[e]/n[r]*o}getWidth(){return this._getSize("width")}getHeight(){return this._getSize("height")}getAnimationStyleProps(){return Qh}getBoundingRect(){const e=this.style;return this._rect||(this._rect=new wr(e.x||0,e.y||0,this.getWidth(),this.getHeight())),this._rect}}qh.prototype.type="image";class Zh{constructor(){this.cx=0,this.cy=0,this.r=0}}class Kh extends Ch{constructor(e){super(e)}getDefaultShape(){return new Zh}buildPath(e,t){e.moveTo(t.cx+t.r,t.cy),e.arc(t.cx,t.cy,t.r,0,2*Math.PI)}}Kh.prototype.type="circle";const Jh=Math.round;function $h(e,t,i){if(!t)return e;const n=Jh(2*e);return(n+Jh(t))%2==0?n/2:(n+(i?1:-1))/2}class ec{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}}const tc={};class ic extends Ch{constructor(e){super(e)}getDefaultShape(){return new ec}buildPath(e,t){let i,n,s,r;if(this.subPixelOptimize){const e=function(e,t,i){if(!t)return;const n=t.x,s=t.y,r=t.width,o=t.height;e.x=n,e.y=s,e.width=r,e.height=o;const a=i&&i.lineWidth;return a?(e.x=$h(n,a,!0),e.y=$h(s,a,!0),e.width=Math.max($h(n+r,a,!1)-e.x,0===r?0:1),e.height=Math.max($h(s+o,a,!1)-e.y,0===o?0:1),e):e}(tc,t,this.style);i=e.x,n=e.y,s=e.width,r=e.height,e.r=t.r,t=e}else i=t.x,n=t.y,s=t.width,r=t.height;t.r?function(e,t){let i,n,s,r,o,a=t.x,l=t.y,h=t.width,c=t.height,d=t.r;h<0&&(a+=h,h=-h),c<0&&(l+=c,c=-c),"number"==typeof d?i=n=s=r=d:d instanceof Array?1===d.length?i=n=s=r=d[0]:2===d.length?(i=s=d[0],n=r=d[1]):3===d.length?(i=d[0],n=r=d[1],s=d[2]):(i=d[0],n=d[1],s=d[2],r=d[3]):i=n=s=r=0,i+n>h&&(o=i+n,i*=h/o,n*=h/o),s+r>h&&(o=s+r,s*=h/o,r*=h/o),n+s>c&&(o=n+s,n*=c/o,s*=c/o),i+r>c&&(o=i+r,i*=c/o,r*=c/o),e.moveTo(a+i,l),e.lineTo(a+h-n,l),0!==n&&e.arc(a+h-n,l+n,n,-Math.PI/2,0),e.lineTo(a+h,l+c-s),0!==s&&e.arc(a+h-s,l+c-s,s,0,Math.PI/2),e.lineTo(a+r,l+c),0!==r&&e.arc(a+r,l+c-r,r,Math.PI/2,Math.PI),e.lineTo(a,l+i),0!==i&&e.arc(a+i,l+i,i,Math.PI,1.5*Math.PI)}(e,t):e.rect(i,n,s,r)}isZeroArea(){return!this.shape.width||!this.shape.height}}ic.prototype.type="rect";class nc{constructor(){this.cx=0,this.cy=0,this.rx=0,this.ry=0}}class sc extends Ch{constructor(e){super(e)}getDefaultShape(){return new nc}buildPath(e,t){const i=.5522848,n=t.cx,s=t.cy,r=t.rx,o=t.ry,a=r*i,l=o*i;e.moveTo(n-r,s),e.bezierCurveTo(n-r,s-l,n-a,s-o,n,s-o),e.bezierCurveTo(n+a,s-o,n+r,s-l,n+r,s),e.bezierCurveTo(n+r,s+l,n+a,s+o,n,s+o),e.bezierCurveTo(n-a,s+o,n-r,s+l,n-r,s),e.closePath()}}sc.prototype.type="ellipse";const rc={};class oc{constructor(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}}class ac extends Ch{constructor(e){super(e)}getDefaultStyle(){return{stroke:"#000",fill:null}}getDefaultShape(){return new oc}buildPath(e,t){let i,n,s,r;if(this.subPixelOptimize){const e=function(e,t,i){if(!t)return;const n=t.x1,s=t.x2,r=t.y1,o=t.y2;e.x1=n,e.x2=s,e.y1=r,e.y2=o;const a=i&&i.lineWidth;return a?(Jh(2*n)===Jh(2*s)&&(e.x1=e.x2=$h(n,a,!0)),Jh(2*r)===Jh(2*o)&&(e.y1=e.y2=$h(r,a,!0)),e):e}(rc,t,this.style);i=e.x1,n=e.y1,s=e.x2,r=e.y2}else i=t.x1,n=t.y1,s=t.x2,r=t.y2;const o=t.percent;0!==o&&(e.moveTo(i,n),o<1&&(s=i*(1-o)+s*o,r=n*(1-o)+r*o),e.lineTo(s,r))}pointAt(e){const t=this.shape;return[t.x1*(1-e)+t.x2*e,t.y1*(1-e)+t.y2*e]}}function lc(e,t,i){const n=t.smooth;let s=t.points;if(s&&s.length>=2){if(n){const r=function(e,t,i,n){const s=[],r=[],o=[],a=[];let l,h,c,d;if(n){c=[1/0,1/0],d=[-1/0,-1/0];for(let t=0,i=e.length;t<i;t++)ks(c,c,e[t]),Ls(d,d,e[t]);ks(c,c,n[0]),Ls(d,d,n[1])}for(let u=0,p=e.length;u<p;u++){const f=e[u];if(i)l=e[u?u-1:p-1],h=e[(u+1)%p];else{if(0===u||u===p-1){s.push(ws(e[u]));continue}l=e[u-1],h=e[u+1]}_s(r,h,l),Es(r,r,t);let m=Ps(f,l),g=Ps(f,h);const v=m+g;0!==v&&(m/=v,g/=v),Es(o,r,-m),Es(a,r,g);const y=bs([],f,o),x=bs([],f,a);n&&(Ls(y,y,c),ks(y,y,d),Ls(x,x,c),ks(x,x,d)),s.push(y),s.push(x)}return i&&s.push(s.shift()),s}(s,n,i,t.smoothConstraint);e.moveTo(s[0][0],s[0][1]);const o=s.length;for(let t=0;t<(i?o:o-1);t++){const i=r[2*t],n=r[2*t+1],a=s[(t+1)%o];e.bezierCurveTo(i[0],i[1],n[0],n[1],a[0],a[1])}}else{e.moveTo(s[0][0],s[0][1]);for(let t=1,i=s.length;t<i;t++)e.lineTo(s[t][0],s[t][1])}i&&e.closePath()}}ac.prototype.type="line";class hc{constructor(){this.points=null,this.smooth=0,this.smoothConstraint=null}}class cc extends Ch{constructor(e){super(e)}getDefaultShape(){return new hc}buildPath(e,t){lc(e,t,!0)}}cc.prototype.type="polygon";class dc{constructor(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null}}class uc extends Ch{constructor(e){super(e)}getDefaultStyle(){return{stroke:"#000",fill:null}}getDefaultShape(){return new dc}buildPath(e,t){lc(e,t,!1)}}uc.prototype.type="polyline";let pc=class{constructor(e){this.colorStops=e||[]}addColorStop(e,t){this.colorStops.push({offset:e,color:t})}};class fc extends pc{constructor(e,t,i,n,s,r){super(s),this.x=null==e?0:e,this.y=null==t?0:t,this.x2=null==i?1:i,this.y2=null==n?0:n,this.type="linear",this.global=r||!1}}class mc extends pc{constructor(e,t,i,n,s){super(n),this.x=null==e?.5:e,this.y=null==t?.5:t,this.r=null==i?.5:i,this.type="radial",this.global=s||!1}}const gc=Rn({strokeFirst:!0,font:fn,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},_h);class vc extends Sl{hasStroke(){const e=this.style,t=e.stroke;return null!=t&&"none"!==t&&e.lineWidth>0}hasFill(){const e=this.style.fill;return null!=e&&"none"!==e}createStyle(e){return ps(gc,e)}setBoundingRect(e){this._rect=e}getBoundingRect(){const e=this.style;if(!this._rect){let t=e.text;null!=t?t+="":t="";const i=function(e,t,i,n){const s=((e||"")+"").split("\n");if(1===s.length)return qa(s[0],t,i,n);{const e=new wr(0,0,0,0);for(let r=0;r<s.length;r++){const o=qa(s[r],t,i,n);0===r?e.copy(o):e.union(o)}return e}}(t,e.font,e.textAlign,e.textBaseline);if(i.x+=e.x||0,i.y+=e.y||0,this.hasStroke()){const t=e.lineWidth;i.x-=t/2,i.y-=t/2,i.width+=t,i.height+=t}this._rect=i}return this._rect}}let yc;vc.initDefaultProps=void(vc.prototype.dirtyRectTolerance=10),vc.prototype.type="tspan";const xc={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},wc=Hn(xc),bc={"alignment-baseline":"textBaseline","stop-color":"stopColor"},_c=Hn(bc);class Sc{constructor(){this._defs={},this._root=null}parse(e,t){t=t||{};const i=function(e){Xn(e)&&(e=(new DOMParser).parseFromString(e,"text/xml"));let t=e;for(9===t.nodeType&&(t=t.firstChild);"svg"!==t.nodeName.toLowerCase()||1!==t.nodeType;)t=t.nextSibling;return t}(e);this._defsUsePending=[];let n=new cl;this._root=n;const s=[],r=i.getAttribute("viewBox")||"";let o=parseFloat(i.getAttribute("width")||t.width),a=parseFloat(i.getAttribute("height")||t.height);isNaN(o)&&(o=null),isNaN(a)&&(a=null),Pc(i,n,null,!0,!1);let l,h,c=i.firstChild;for(;c;)this._parseNode(c,n,s,null,!1,!1),c=c.nextSibling;if(function(e,t){for(let i=0;i<t.length;i++){const n=t[i];n[0].style[n[1]]=e[n[2]]}}(this._defs,this._defsUsePending),this._defsUsePending=[],r){const e=Ic(r);e.length>=4&&(l={x:parseFloat(e[0]||0),y:parseFloat(e[1]||0),width:parseFloat(e[2]),height:parseFloat(e[3])})}if(l&&null!=o&&null!=a&&(h=function(e,t){const i=t.width/e.width,n=t.height/e.height,s=Math.min(i,n);return{scale:s,x:-(e.x+e.width/2)*s+(t.x+t.width/2),y:-(e.y+e.height/2)*s+(t.y+t.height/2)}}(l,{x:0,y:0,width:o,height:a}),!t.ignoreViewBox)){const e=n;n=new cl,n.add(e),e.scaleX=e.scaleY=h.scale,e.x=h.x,e.y=h.y}return t.ignoreRootClip||null==o||null==a||n.setClipPath(new ic({shape:{x:0,y:0,width:o,height:a}})),{root:n,width:o,height:a,viewBoxRect:l,viewBoxTransform:h,named:s}}_parseNode(e,t,i,n,s,r){const o=e.nodeName.toLowerCase();let a,l=n;if("defs"===o&&(s=!0),"text"===o&&(r=!0),"defs"===o||"switch"===o)a=t;else{if(!s){const s=yc[o];if(s&&ms(yc,o)){a=s.call(this,e,t);const r=e.getAttribute("name");if(r){const e={name:r,namedFrom:null,svgNodeTagLower:o,el:a};i.push(e),"g"===o&&(l=e)}else n&&i.push({name:n.name,namedFrom:n,svgNodeTagLower:o,el:a});t.add(a)}}const r=Mc[o];if(r&&ms(Mc,o)){const t=r.call(this,e),i=e.getAttribute("id");i&&(this._defs[i]=t)}}if(a&&a.isGroup){let t=e.firstChild;for(;t;)1===t.nodeType?this._parseNode(t,a,i,l,s,r):3===t.nodeType&&r&&this._parseText(t,a),t=t.nextSibling}}_parseText(e,t){const i=new vc({style:{text:e.textContent},silent:!0,x:this._textX||0,y:this._textY||0});Ec(t,i),Pc(e,i,this._defsUsePending,!1,!1),function(e,t){const i=t.__selfStyle;if(i){const t=i.textBaseline;let n=t;t&&"auto"!==t?"baseline"===t?n="alphabetic":"before-edge"===t||"text-before-edge"===t?n="top":"after-edge"===t||"text-after-edge"===t?n="bottom":"central"!==t&&"mathematical"!==t||(n="middle"):n="alphabetic",e.style.textBaseline=n}const n=t.__inheritedStyle;if(n){const t=n.textAlign;let i=t;t&&("middle"===t&&(i="center"),e.style.textAlign=i)}}(i,t);const n=i.style,s=n.fontSize;s&&s<9&&(n.fontSize=9,i.scaleX*=s/9,i.scaleY*=s/9);const r=(n.fontSize||n.fontFamily)&&[n.fontStyle,n.fontWeight,(n.fontSize||12)+"px",n.fontFamily||"sans-serif"].join(" ");n.font=r;const o=i.getBoundingRect();return this._textX+=o.width,t.add(i),i}}Sc.internalField=void(yc={g:function(e,t){const i=new cl;return Ec(t,i),Pc(e,i,this._defsUsePending,!1,!1),i},rect:function(e,t){const i=new ic;return Ec(t,i),Pc(e,i,this._defsUsePending,!1,!1),i.setShape({x:parseFloat(e.getAttribute("x")||"0"),y:parseFloat(e.getAttribute("y")||"0"),width:parseFloat(e.getAttribute("width")||"0"),height:parseFloat(e.getAttribute("height")||"0")}),i.silent=!0,i},circle:function(e,t){const i=new Kh;return Ec(t,i),Pc(e,i,this._defsUsePending,!1,!1),i.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),r:parseFloat(e.getAttribute("r")||"0")}),i.silent=!0,i},line:function(e,t){const i=new ac;return Ec(t,i),Pc(e,i,this._defsUsePending,!1,!1),i.setShape({x1:parseFloat(e.getAttribute("x1")||"0"),y1:parseFloat(e.getAttribute("y1")||"0"),x2:parseFloat(e.getAttribute("x2")||"0"),y2:parseFloat(e.getAttribute("y2")||"0")}),i.silent=!0,i},ellipse:function(e,t){const i=new sc;return Ec(t,i),Pc(e,i,this._defsUsePending,!1,!1),i.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),rx:parseFloat(e.getAttribute("rx")||"0"),ry:parseFloat(e.getAttribute("ry")||"0")}),i.silent=!0,i},polygon:function(e,t){const i=e.getAttribute("points");let n;i&&(n=Tc(i));const s=new cc({shape:{points:n||[]},silent:!0});return Ec(t,s),Pc(e,s,this._defsUsePending,!1,!1),s},polyline:function(e,t){const i=e.getAttribute("points");let n;i&&(n=Tc(i));const s=new uc({shape:{points:n||[]},silent:!0});return Ec(t,s),Pc(e,s,this._defsUsePending,!1,!1),s},image:function(e,t){const i=new qh;return Ec(t,i),Pc(e,i,this._defsUsePending,!1,!1),i.setStyle({image:e.getAttribute("xlink:href")||e.getAttribute("href"),x:+e.getAttribute("x"),y:+e.getAttribute("y"),width:+e.getAttribute("width"),height:+e.getAttribute("height")}),i.silent=!0,i},text:function(e,t){const i=e.getAttribute("x")||"0",n=e.getAttribute("y")||"0",s=e.getAttribute("dx")||"0",r=e.getAttribute("dy")||"0";this._textX=parseFloat(i)+parseFloat(s),this._textY=parseFloat(n)+parseFloat(r);const o=new cl;return Ec(t,o),Pc(e,o,this._defsUsePending,!1,!0),o},tspan:function(e,t){const i=e.getAttribute("x"),n=e.getAttribute("y");null!=i&&(this._textX=parseFloat(i)),null!=n&&(this._textY=parseFloat(n));const s=e.getAttribute("dx")||"0",r=e.getAttribute("dy")||"0",o=new cl;return Ec(t,o),Pc(e,o,this._defsUsePending,!1,!0),this._textX+=parseFloat(s),this._textY+=parseFloat(r),o},path:function(e,t){const i=Wh(e.getAttribute("d")||"");return Ec(t,i),Pc(e,i,this._defsUsePending,!1,!1),i.silent=!0,i}});const Mc={lineargradient:function(e){const t=parseInt(e.getAttribute("x1")||"0",10),i=parseInt(e.getAttribute("y1")||"0",10),n=parseInt(e.getAttribute("x2")||"10",10),s=parseInt(e.getAttribute("y2")||"0",10),r=new fc(t,i,n,s);return Cc(e,r),Ac(e,r),r},radialgradient:function(e){const t=parseInt(e.getAttribute("cx")||"0",10),i=parseInt(e.getAttribute("cy")||"0",10),n=parseInt(e.getAttribute("r")||"0",10),s=new mc(t,i,n);return Cc(e,s),Ac(e,s),s}};function Cc(e,t){"userSpaceOnUse"===e.getAttribute("gradientUnits")&&(t.global=!0)}function Ac(e,t){let i=e.firstChild;for(;i;){if(1===i.nodeType&&"stop"===i.nodeName.toLocaleLowerCase()){const e=i.getAttribute("offset");let n;n=e&&e.indexOf("%")>0?parseInt(e,10)/100:e?parseFloat(e):0;const s={};zc(i,s,s);const r=s.stopColor||i.getAttribute("stop-color")||"#000000";t.colorStops.push({offset:n,color:r})}i=i.nextSibling}}function Ec(e,t){e&&e.__inheritedStyle&&(t.__inheritedStyle||(t.__inheritedStyle={}),Rn(t.__inheritedStyle,e.__inheritedStyle))}function Tc(e){const t=Ic(e),i=[];for(let e=0;e<t.length;e+=2){const n=parseFloat(t[e]),s=parseFloat(t[e+1]);i.push([n,s])}return i}function Pc(e,t,i,n,s){const r=t,o=r.__inheritedStyle=r.__inheritedStyle||{},a={};1===e.nodeType&&(function(e,t){let i=e.getAttribute("transform");if(i){i=i.replace(/,/g," ");const e=[];let n=null;i.replace(Rc,(function(t,i,n){return e.push(i,n),""}));for(let t=e.length-1;t>0;t-=2){const i=e[t],s=e[t-1],r=Ic(i);switch(n=n||[1,0,0,1,0,0],s){case"translate":or(n,n,[parseFloat(r[0]),parseFloat(r[1]||"0")]);break;case"scale":lr(n,n,[parseFloat(r[0]),parseFloat(r[1]||r[0])]);break;case"rotate":ar(n,n,-parseFloat(r[0])*kc,[parseFloat(r[1]||"0"),parseFloat(r[2]||"0")]);break;case"skewX":rr(n,[1,0,Math.tan(parseFloat(r[0])*kc),1,0,0],n);break;case"skewY":rr(n,[1,Math.tan(parseFloat(r[0])*kc),0,1,0,0],n);break;case"matrix":n[0]=parseFloat(r[0]),n[1]=parseFloat(r[1]),n[2]=parseFloat(r[2]),n[3]=parseFloat(r[3]),n[4]=parseFloat(r[4]),n[5]=parseFloat(r[5])}}t.setLocalTransform(n)}}(e,t),zc(e,o,a),n||function(e,t,i){for(let i=0;i<wc.length;i++){const n=wc[i],s=e.getAttribute(n);null!=s&&(t[xc[n]]=s)}for(let t=0;t<_c.length;t++){const n=_c[t],s=e.getAttribute(n);null!=s&&(i[bc[n]]=s)}}(e,o,a)),r.style=r.style||{},null!=o.fill&&(r.style.fill=Dc(r,"fill",o.fill,i)),null!=o.stroke&&(r.style.stroke=Dc(r,"stroke",o.stroke,i)),Fn(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],(function(e){null!=o[e]&&(r.style[e]=parseFloat(o[e]))})),Fn(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],(function(e){null!=o[e]&&(r.style[e]=o[e])})),s&&(r.__selfStyle=a),o.lineDash&&(r.style.lineDash=Nn(Ic(o.lineDash),(function(e){return parseFloat(e)}))),"hidden"!==o.visibility&&"collapse"!==o.visibility||(r.invisible=!0),"none"===o.display&&(r.ignore=!0)}const Oc=/^url\(\s*#(.*?)\)/;function Dc(e,t,i,n){const s=i&&i.match(Oc);if(!s)return"none"===i&&(i=null),i;{const i=as(s[1]);n.push([e,t,i])}}const Bc=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function Ic(e){return e.match(Bc)||[]}const Rc=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,kc=Math.PI/180,Lc=/([^\s:;]+)\s*:\s*([^:;]+)/g;function zc(e,t,i){const n=e.getAttribute("style");if(!n)return;let s;for(Lc.lastIndex=0;null!=(s=Lc.exec(n));){const e=s[1],n=ms(xc,e)?xc[e]:null;n&&(t[n]=s[2]);const r=ms(bc,e)?bc[e]:null;r&&(i[r]=s[2])}}const Uc=Math.PI,Fc=2*Uc,Nc=Math.sin,jc=Math.cos,Vc=Math.acos,Hc=Math.atan2,Wc=Math.abs,Gc=Math.sqrt,Yc=Math.max,Xc=Math.min,Qc=1e-4;function qc(e,t,i,n,s,r,o){const a=e-i,l=t-n,h=(o?r:-r)/Gc(a*a+l*l),c=h*l,d=-h*a,u=e+c,p=t+d,f=i+c,m=n+d,g=(u+f)/2,v=(p+m)/2,y=f-u,x=m-p,w=y*y+x*x,b=s-r,_=u*m-f*p,S=(x<0?-1:1)*Gc(Yc(0,b*b*w-_*_));let M=(_*x-y*S)/w,C=(-_*y-x*S)/w;const A=(_*x+y*S)/w,E=(-_*y+x*S)/w,T=M-g,P=C-v,O=A-g,D=E-v;return T*T+P*P>O*O+D*D&&(M=A,C=E),{cx:M,cy:C,x0:-c,y0:-d,x1:M*(s/b-1),y1:C*(s/b-1)}}class Zc{constructor(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0,this.cornerRadius=0}}class Kc extends Ch{constructor(e){super(e)}getDefaultShape(){return new Zc}buildPath(e,t){!function(e,t){let i=Yc(t.r,0),n=Yc(t.r0||0,0);const s=i>0;if(!(s||n>0))return;if(s||(i=n,n=0),n>i){const e=i;i=n,n=e}const{startAngle:r,endAngle:o}=t;if(isNaN(r)||isNaN(o))return;const{cx:a,cy:l}=t,h=!!t.clockwise;let c=Wc(o-r);const d=c>Fc&&c%Fc;if(d>Qc&&(c=d),i>Qc)if(c>Fc-Qc)e.moveTo(a+i*jc(r),l+i*Nc(r)),e.arc(a,l,i,r,o,!h),n>Qc&&(e.moveTo(a+n*jc(o),l+n*Nc(o)),e.arc(a,l,n,o,r,h));else{let s,d,u,p,f,m,g,v,y,x,w,b,_,S,M,C;const A=i*jc(r),E=i*Nc(r),T=n*jc(o),P=n*Nc(o),O=c>Qc;if(O){const e=t.cornerRadius;e&&([s,d,u,p]=function(e){let t;if(Gn(e)){const i=e.length;if(!i)return e;t=1===i?[e[0],e[0],0,0]:2===i?[e[0],e[0],e[1],e[1]]:3===i?e.concat(e[2]):e}else t=[e,e,e,e];return t}(e));const a=Wc(i-n)/2;if(f=Xc(a,u),m=Xc(a,p),g=Xc(a,s),v=Xc(a,d),w=y=Yc(f,m),b=x=Yc(g,v),(y>Qc||x>Qc)&&(_=i*jc(o),S=i*Nc(o),M=n*jc(r),C=n*Nc(r),c<Uc)){const e=function(e,t,i,n,s,r,o,a){const l=i-e,h=n-t,c=o-s,d=a-r;let u=d*l-c*h;if(!(u*u<Qc))return u=(c*(t-r)-d*(e-s))/u,[e+u*l,t+u*h]}(A,E,M,C,_,S,T,P);if(e){const t=A-e[0],s=E-e[1],r=_-e[0],o=S-e[1],a=1/Nc(Vc((t*r+s*o)/(Gc(t*t+s*s)*Gc(r*r+o*o)))/2),l=Gc(e[0]*e[0]+e[1]*e[1]);w=Xc(y,(i-l)/(a+1)),b=Xc(x,(n-l)/(a-1))}}}if(O)if(w>Qc){const t=Xc(u,w),n=Xc(p,w),s=qc(M,C,A,E,i,t,h),r=qc(_,S,T,P,i,n,h);e.moveTo(a+s.cx+s.x0,l+s.cy+s.y0),w<y&&t===n?e.arc(a+s.cx,l+s.cy,w,Hc(s.y0,s.x0),Hc(r.y0,r.x0),!h):(t>0&&e.arc(a+s.cx,l+s.cy,t,Hc(s.y0,s.x0),Hc(s.y1,s.x1),!h),e.arc(a,l,i,Hc(s.cy+s.y1,s.cx+s.x1),Hc(r.cy+r.y1,r.cx+r.x1),!h),n>0&&e.arc(a+r.cx,l+r.cy,n,Hc(r.y1,r.x1),Hc(r.y0,r.x0),!h))}else e.moveTo(a+A,l+E),e.arc(a,l,i,r,o,!h);else e.moveTo(a+A,l+E);if(n>Qc&&O)if(b>Qc){const t=Xc(s,b),i=Xc(d,b),r=qc(T,P,_,S,n,-i,h),o=qc(A,E,M,C,n,-t,h);e.lineTo(a+r.cx+r.x0,l+r.cy+r.y0),b<x&&t===i?e.arc(a+r.cx,l+r.cy,b,Hc(r.y0,r.x0),Hc(o.y0,o.x0),!h):(i>0&&e.arc(a+r.cx,l+r.cy,i,Hc(r.y0,r.x0),Hc(r.y1,r.x1),!h),e.arc(a,l,n,Hc(r.cy+r.y1,r.cx+r.x1),Hc(o.cy+o.y1,o.cx+o.x1),h),t>0&&e.arc(a+o.cx,l+o.cy,t,Hc(o.y1,o.x1),Hc(o.y0,o.x0),!h))}else e.lineTo(a+T,l+P),e.arc(a,l,n,o,r,h);else e.lineTo(a+T,l+P)}else e.moveTo(a,l);e.closePath()}(e,t)}isZeroArea(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0}}Kc.prototype.type="sector";const Jc=sh.CMD;function $c(e,t){return Math.abs(e-t)<1e-5}function ed(e){const t=e.data,i=e.len(),n=[];let s,r,o,a,l,h=0,c=0,d=0,u=0;function p(e,t){s&&s.length>2&&n.push(s),s=[e,t]}function f(e,t,i,n){$c(e,i)&&$c(t,n)||s.push(e,t,i,n,i,n)}function m(e,t,i,n,r,o){const a=Math.abs(t-e),l=4*Math.tan(a/4)/3,h=t<e?-1:1,c=Math.cos(e),d=Math.sin(e),u=Math.cos(t),p=Math.sin(t),f=c*r+i,m=d*o+n,g=u*r+i,v=p*o+n,y=r*l*h,x=o*l*h;s.push(f-y*d,m+x*c,g+y*p,v-x*u,g,v)}for(let e=0;e<i;){const i=t[e++],n=1===e;switch(n&&(h=t[e],c=t[e+1],d=h,u=c,i!==Jc.L&&i!==Jc.C&&i!==Jc.Q||(s=[d,u])),i){case Jc.M:h=d=t[e++],c=u=t[e++],p(d,u);break;case Jc.L:r=t[e++],o=t[e++],f(h,c,r,o),h=r,c=o;break;case Jc.C:s.push(t[e++],t[e++],t[e++],t[e++],h=t[e++],c=t[e++]);break;case Jc.Q:r=t[e++],o=t[e++],a=t[e++],l=t[e++],s.push(h+2/3*(r-h),c+2/3*(o-c),a+2/3*(r-a),l+2/3*(o-l),a,l),h=a,c=l;break;case Jc.A:const i=t[e++],g=t[e++],v=t[e++],y=t[e++],x=t[e++],w=t[e++]+x;e+=1;const b=!t[e++];r=Math.cos(x)*v+i,o=Math.sin(x)*y+g,n?(d=r,u=o,p(d,u)):f(h,c,r,o),h=Math.cos(w)*v+i,c=Math.sin(w)*y+g;const _=(b?-1:1)*Math.PI/2;for(let e=x;b?e>w:e<w;e+=_)m(e,b?Math.max(e+_,w):Math.min(e+_,w),i,g,v,y);break;case Jc.R:d=h=t[e++],u=c=t[e++],r=d+t[e++],o=u+t[e++],p(r,u),f(r,u,r,o),f(r,o,d,o),f(d,o,d,u),f(d,u,r,u);break;case Jc.Z:s&&f(h,c,d,u),h=d,c=u}}return s&&s.length>2&&n.push(s),n}function td(e,t,i,n,s,r,o,a,l,h){if($c(e,i)&&$c(t,n)&&$c(s,o)&&$c(r,a))return void l.push(o,a);const c=2/h,d=c*c;let u=o-e,p=a-t;const f=Math.sqrt(u*u+p*p);u/=f,p/=f;const m=i-e,g=n-t,v=s-o,y=r-a,x=m*m+g*g,w=v*v+y*y;if(x<d&&w<d)return void l.push(o,a);const b=u*m+p*g,_=-u*v-p*y;if(x-b*b<d&&b>=0&&w-_*_<d&&_>=0)return void l.push(o,a);const S=[],M=[];no(e,i,s,o,.5,S),no(t,n,r,a,.5,M),td(S[0],M[0],S[1],M[1],S[2],M[2],S[3],M[3],l,h),td(S[4],M[4],S[5],M[5],S[6],M[6],S[7],M[7],l,h)}function id(e,t,i){const n=e[t],s=e[1-t],r=Math.abs(n/s);let o=Math.ceil(Math.sqrt(r*i)),a=Math.floor(i/o);0===a&&(a=1,o=i);const l=[];for(let e=0;e<o;e++)l.push(a);const h=i-o*a;if(h>0)for(let e=0;e<h;e++)l[e%o]+=1;return l}function nd(e,t,i){const n=e.r0,s=e.r,r=e.startAngle,o=e.endAngle,a=Math.abs(o-r),l=a*s,h=s-n,c=l>Math.abs(h),d=id([l,h],c?0:1,t),u=(c?a:h)/d.length;for(let t=0;t<d.length;t++){const s=(c?h:a)/d[t];for(let o=0;o<d[t];o++){const a={};c?(a.startAngle=r+u*t,a.endAngle=r+u*(t+1),a.r0=n+s*o,a.r=n+s*(o+1)):(a.startAngle=r+s*o,a.endAngle=r+s*(o+1),a.r0=n+u*t,a.r=n+u*(t+1)),a.clockwise=e.clockwise,a.cx=e.cx,a.cy=e.cy,i.push(a)}}}function sd(e,t,i,n){return e*n-i*t}function rd(e,t,i,n,s,r,o,a){const l=i-e,h=n-t,c=o-s,d=a-r,u=sd(c,d,l,h);if(Math.abs(u)<1e-6)return null;const p=sd(e-s,t-r,c,d)/u;return p<0||p>1?null:new dr(p*l+e,p*h+t)}function od(e,t,i){const n=new dr;dr.sub(n,i,t),n.normalize();const s=new dr;return dr.sub(s,e,t),s.dot(n)}function ad(e,t){const i=e[e.length-1];i&&i[0]===t[0]&&i[1]===t[1]||e.push(t)}function ld(e){const t=e.points,i=[],n=[];Rl(t,i,n);const s=new wr(i[0],i[1],n[0]-i[0],n[1]-i[1]),r=s.width,o=s.height,a=s.x,l=s.y,h=new dr,c=new dr;return r>o?(h.x=c.x=a+r/2,h.y=l,c.y=l+o):(h.y=c.y=l+o/2,h.x=a,c.x=a+r),function(e,t,i){const n=e.length,s=[];for(let r=0;r<n;r++){const o=e[r],a=e[(r+1)%n],l=rd(o[0],o[1],a[0],a[1],t.x,t.y,i.x,i.y);l&&s.push({projPt:od(l,t,i),pt:l,idx:r})}if(s.length<2)return[{points:e},{points:e}];s.sort(((e,t)=>e.projPt-t.projPt));let r=s[0],o=s[s.length-1];if(o.idx<r.idx){const e=r;r=o,o=e}const a=[r.pt.x,r.pt.y],l=[o.pt.x,o.pt.y],h=[a],c=[l];for(let t=r.idx+1;t<=o.idx;t++)ad(h,e[t].slice());ad(h,l),ad(h,a);for(let t=o.idx+1;t<=r.idx+n;t++)ad(c,e[t%n].slice());return ad(c,a),ad(c,l),[{points:h},{points:c}]}(t,h,c)}function hd(e,t,i,n){if(1===i)n.push(t);else{const s=Math.floor(i/2),r=e(t);hd(e,r[0],s,n),hd(e,r[1],i-s,n)}return n}function cd(e,t){const i=[],n=e.shape;let s;switch(e.type){case"rect":!function(e,t,i){const n=e.width,s=e.height,r=n>s,o=id([n,s],r?0:1,t),a=r?"width":"height",l=r?"height":"width",h=r?"x":"y",c=r?"y":"x",d=e[a]/o.length;for(let t=0;t<o.length;t++){const n=e[l]/o[t];for(let s=0;s<o[t];s++){const r={};r[h]=t*d,r[c]=s*n,r[a]=d,r[l]=n,r.x+=e.x,r.y+=e.y,i.push(r)}}}(n,t,i),s=ic;break;case"sector":nd(n,t,i),s=Kc;break;case"circle":nd({r0:0,r:n.r,startAngle:0,endAngle:2*Math.PI,cx:n.cx,cy:n.cy},t,i),s=Kc;break;default:const r=e.getComputedTransform(),o=r?Math.sqrt(Math.max(r[0]*r[0]+r[1]*r[1],r[2]*r[2]+r[3]*r[3])):1,a=Nn(function(e,t){const i=ed(e),n=[];t=t||1;for(let e=0;e<i.length;e++){const s=i[e],r=[];let o=s[0],a=s[1];r.push(o,a);for(let e=2;e<s.length;){const i=s[e++],n=s[e++],l=s[e++],h=s[e++],c=s[e++],d=s[e++];td(o,a,i,n,l,h,c,d,r,t),o=c,a=d}n.push(r)}return n}(e.getUpdatedPathProxy(),o),(e=>function(e){const t=[];for(let i=0;i<e.length;)t.push([e[i++],e[i++]]);return t}(e))),l=a.length;if(0===l)hd(ld,{points:a[0]},t,i);else if(l===t)for(let e=0;e<l;e++)i.push({points:a[e]});else{let e=0;const n=Nn(a,(t=>{const i=[],n=[];Rl(t,i,n);const s=(n[1]-i[1])*(n[0]-i[0]);return e+=s,{poly:t,area:s}}));n.sort(((e,t)=>t.area-e.area));let s=t;for(let r=0;r<l;r++){const o=n[r];if(s<=0)break;const a=r===l-1?s:Math.ceil(o.area/e*t);a<0||(hd(ld,{points:o.poly},a,i),s-=a)}}s=cc}if(!s)return function(e,t){const i=[];for(let n=0;n<t;n++)i.push(Gh(e));return i}(e,t);const r=[];for(let t=0;t<i.length;t++){const n=new s;n.setShape(i[t]),o=e,(a=n).setStyle(o.style),a.z=o.z,a.z2=o.z2,a.zlevel=o.zlevel,r.push(n)}var o,a;return r}function dd(e,t){const i=e.length,n=t.length;if(i===n)return[e,t];const s=[],r=[],o=i<n?e:t,a=Math.min(i,n),l=Math.abs(n-i)/6,h=(a-2)/6,c=Math.ceil(l/h)+1,d=[o[0],o[1]];let u=l;for(let e=2;e<a;){let t=o[e-2],i=o[e-1],n=o[e++],a=o[e++],l=o[e++],h=o[e++],p=o[e++],f=o[e++];if(u<=0){d.push(n,a,l,h,p,f);continue}let m=Math.min(u,c-1)+1;for(let e=1;e<=m;e++){const o=e/m;no(t,n,l,p,o,s),no(i,a,h,f,o,r),t=s[3],i=r[3],d.push(s[1],r[1],s[2],r[2],t,i),n=s[5],a=r[5],l=s[6],h=r[6]}u-=m-1}return o===e?[d,t]:[e,d]}function ud(e,t){const i=e.length,n=e[i-2],s=e[i-1],r=[];for(let e=0;e<t.length;)r[e++]=n,r[e++]=s;return r}function pd(e,t){let i,n,s=[],r=[];for(let o=0;o<Math.max(e.length,t.length);o++){const a=e[o],l=t[o];let h,c;a?l?([h,c]=dd(a,l),i=h,n=c):(c=ud(n||a,a),h=a):(h=ud(i||l,l),c=l),s.push(h),r.push(c)}return[s,r]}function fd(e){let t=0,i=0,n=0;const s=e.length;for(let r=0,o=s-2;r<s;o=r,r+=2){const s=e[o],a=e[o+1],l=e[r],h=e[r+1],c=s*h-l*a;t+=c,i+=(s+l)*c,n+=(a+h)*c}return 0===t?[e[0]||0,e[1]||0]:[i/t/3,n/t/3,t]}function md(e,t,i,n){const s=(e.length-2)/6;let r=1/0,o=0;const a=e.length,l=a-2;for(let h=0;h<s;h++){const s=6*h;let c=0;for(let r=0;r<a;r+=2){let o=0===r?s:(s+r-2)%l+2;const a=e[o]-i[0],h=e[o+1]-i[1],d=t[r]-n[0]-a,u=t[r+1]-n[1]-h;c+=d*d+u*u}c<r&&(r=c,o=h)}return o}function gd(e){const t=[],i=e.length;for(let n=0;n<i;n+=2)t[n]=e[i-n-2],t[n+1]=e[i-n-1];return t}function vd(e){return e.__isCombineMorphing}const yd="__mOriginal_";function xd(e,t,i){const n=yd+t,s=e[n]||e[t];e[n]||(e[n]=e[t]);const r=i.replace,o=i.after,a=i.before;e[t]=function(){const e=arguments;let t;return a&&a.apply(this,e),t=r?r.apply(this,e):s.apply(this,e),o&&o.apply(this,e),t}}function wd(e,t){const i=yd+t;e[i]&&(e[t]=e[i],e[i]=null)}function bd(e,t){for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;){const i=n[e],s=n[e+1];n[e++]=t[0]*i+t[2]*s+t[4],n[e++]=t[1]*i+t[3]*s+t[5]}}}function _d(e,t){const i=e.getUpdatedPathProxy(),n=t.getUpdatedPathProxy(),[s,r]=pd(ed(i),ed(n)),o=e.getComputedTransform(),a=t.getComputedTransform();o&&bd(s,o),a&&bd(r,a),xd(t,"updateTransform",{replace:function(){this.transform=null}}),t.transform=null;const l=function(e,t,i,n){const s=[];let r;for(let i=0;i<e.length;i++){let o=e[i];const a=t[i],l=fd(o),h=fd(a);null==r&&(r=l[2]<0!=h[2]<0);const c=[],d=[];let u=0,p=1/0,f=[];const m=o.length;r&&(o=gd(o));const g=6*md(o,a,l,h),v=m-2;for(let e=0;e<v;e+=2){const t=(g+e)%v+2;c[e+2]=o[t]-l[0],c[e+3]=o[t+1]-l[1]}c[0]=o[g]-l[0],c[1]=o[g+1]-l[1];{const e=n/10;for(let t=-n/2;t<=n/2;t+=e){const e=Math.sin(t),i=Math.cos(t);let n=0;for(let t=0;t<o.length;t+=2){const s=c[t],r=c[t+1],o=a[t]-h[0],l=a[t+1]-h[1],d=o*i-l*e,u=o*e+l*i;f[t]=d,f[t+1]=u;const p=d-s,m=u-r;n+=p*p+m*m}if(n<p){p=n,u=t;for(let e=0;e<f.length;e++)d[e]=f[e]}}}s.push({from:c,to:d,fromCp:l,toCp:h,rotation:-u})}return s}(s,r,0,Math.PI),h=[];xd(t,"buildPath",{replace(e){const i=t.__morphT,n=1-i,s=[];for(let t=0;t<l.length;t++){const r=l[t],o=r.from,a=r.to,c=r.rotation*i,d=r.fromCp,u=r.toCp,p=Math.sin(c),f=Math.cos(c);Is(s,d,u,i);for(let e=0;e<o.length;e+=2){const t=o[e],r=o[e+1],l=t*n+a[e]*i,c=r*n+a[e+1]*i;h[e]=l*f-c*p+s[0],h[e+1]=l*p+c*f+s[1]}let m=h[0],g=h[1];e.moveTo(m,g);for(let t=2;t<o.length;){const i=h[t++],n=h[t++],s=h[t++],r=h[t++],o=h[t++],a=h[t++];m===i&&g===n&&s===o&&r===a?e.lineTo(o,a):e.bezierCurveTo(i,n,s,r,o,a),m=o,g=a}}}})}function Sd(e,t,i){if(!e||!t)return t;const n=i.done,s=i.during;return _d(e,t),t.__morphT=0,t.animateTo({__morphT:1},Rn({during(e){t.dirtyShape(),s&&s(e)},done(){wd(t,"buildPath"),wd(t,"updateTransform"),t.__morphT=-1,t.createPathProxy(),t.dirtyShape(),n&&n()}},i)),t}function Md(e,t,i,n,s,r){e=s===i?0:Math.round(32767*(e-i)/(s-i)),t=r===n?0:Math.round(32767*(t-n)/(r-n));let o,a=0;for(let i=32768;i>0;i/=2){let n=0,s=0;(e&i)>0&&(n=1),(t&i)>0&&(s=1),a+=i*i*(3*n^s),0===s&&(1===n&&(e=i-1-e,t=i-1-t),o=e,e=t,t=o)}return a}function Cd(e){let t=1/0,i=1/0,n=-1/0,s=-1/0;const r=Nn(e,(e=>{const r=e.getBoundingRect(),o=e.getComputedTransform(),a=r.x+r.width/2+(o?o[4]:0),l=r.y+r.height/2+(o?o[5]:0);return t=Math.min(a,t),i=Math.min(l,i),n=Math.max(a,n),s=Math.max(l,s),[a,l]}));return Nn(r,((r,o)=>({cp:r,z:Md(r[0],r[1],t,i,n,s),path:e[o]}))).sort(((e,t)=>e.z-t.z)).map((e=>e.path))}function Ad(e){return cd(e.path,e.count)}var Ed=Object.freeze({__proto__:null,alignBezierCurves:pd,centroid:fd,combineMorph:function(e,t,i){let n=[];!function e(t){for(let i=0;i<t.length;i++){const s=t[i];vd(s)?e(s.childrenRef()):s instanceof Ch&&n.push(s)}}(e);const s=n.length;if(!s)return{fromIndividuals:[],toIndividuals:[],count:0};let r=(i.dividePath||Ad)({path:t,count:s});if(r.length!==s)return console.error("Invalid morphing: unmatched splitted path"),{fromIndividuals:[],toIndividuals:[],count:0};n=Cd(n),r=Cd(r);const o=i.done,a=i.during,l=i.individualDelay,h=new Wa;for(let e=0;e<s;e++){const i=n[e],s=r[e];s.parent=t,s.copyTransform(h),l||_d(i,s)}function c(e){for(let t=0;t<r.length;t++)r[t].addSelfToZr(e)}function d(){t.__isCombineMorphing=!1,t.__morphT=-1,t.childrenRef=null,wd(t,"addSelfToZr"),wd(t,"removeSelfFromZr")}t.__isCombineMorphing=!0,t.childrenRef=function(){return r},xd(t,"addSelfToZr",{after(e){c(e)}}),xd(t,"removeSelfFromZr",{after(e){for(let t=0;t<r.length;t++)r[t].removeSelfFromZr(e)}});const u=r.length;if(l){let e=u;const t=()=>{e--,0===e&&(d(),o&&o())};for(let e=0;e<u;e++){const s=l?Rn({delay:(i.delay||0)+l(e,u,n[e],r[e]),done:t},i):i;Sd(n[e],r[e],s)}}else t.__morphT=0,t.animateTo({__morphT:1},Rn({during(e){for(let e=0;e<u;e++){const i=r[e];i.__morphT=t.__morphT,i.dirtyShape()}a&&a(e)},done(){d();for(let t=0;t<e.length;t++)wd(e[t],"updateTransform");o&&o()}},i));return t.__zr&&c(t.__zr),{fromIndividuals:n,toIndividuals:r,count:u}},defaultDividePath:cd,isCombineMorphing:vd,isMorphing:function(e){return e.__morphT>=0},morphPath:Sd,separateMorph:function(e,t,i){const n=t.length;let s=[];const r=i.dividePath||Ad;if(vd(e)){!function e(t){for(let i=0;i<t.length;i++){const n=t[i];vd(n)?e(n.childrenRef()):n instanceof Ch&&s.push(n)}}(e.childrenRef());const t=s.length;if(t<n){let e=0;for(let i=t;i<n;i++)s.push(Gh(s[e++%t]))}s.length=n}else{s=r({path:e,count:n});const t=e.getComputedTransform();for(let e=0;e<s.length;e++)s[e].setLocalTransform(t);if(s.length!==n)return console.error("Invalid morphing: unmatched splitted path"),{fromIndividuals:[],toIndividuals:[],count:0}}s=Cd(s),t=Cd(t);const o=i.individualDelay;for(let e=0;e<n;e++){const r=o?Rn({delay:(i.delay||0)+o(e,n,s[e],t[e])},i):i;Sd(s[e],t[e],r)}return{fromIndividuals:s,toIndividuals:t,count:t.length}}});class Td extends Ch{constructor(){super(...arguments),this.type="compound"}_updatePathDirty(){const e=this.shape.paths;let t=this.shapeChanged();for(let i=0;i<e.length;i++)t=t||e[i].shapeChanged();t&&this.dirtyShape()}beforeBrush(){this._updatePathDirty();const e=this.shape.paths||[],t=this.getGlobalScale();for(let i=0;i<e.length;i++)e[i].path||e[i].createPathProxy(),e[i].path.setScale(t[0],t[1],e[i].segmentIgnoreThreshold)}buildPath(e,t){const i=t.paths||[];for(let t=0;t<i.length;t++)i[t].buildPath(e,i[t].shape,!0)}afterBrush(){const e=this.shape.paths||[];for(let t=0;t<e.length;t++)e[t].pathUpdated()}getBoundingRect(){return this._updatePathDirty.call(this),Ch.prototype.getBoundingRect.call(this)}}const Pd=[],Od=new mo(50);function Dd(e){if("string"==typeof e){const t=Od.get(e);return t&&t.image}return e}function Bd(e,t,i,n,s){if(e){if("string"==typeof e){if(t&&t.__zrImageSrc===e||!i)return t;const r=Od.get(e),o={hostEl:i,cb:n,cbPayload:s};return r?!Rd(t=r.image)&&r.pending.push(o):((t=gn.loadImage(e,Id,Id)).__zrImageSrc=e,Od.put(e,t.__cachedImgObj={image:t,pending:[o]})),t}return e}return t}function Id(){const e=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(let t=0;t<e.pending.length;t++){const i=e.pending[t],n=i.cb;n&&n(this,i.cbPayload),i.hostEl.dirty()}e.pending.length=0}function Rd(e){return e&&e.width&&e.height}const kd=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function Ld(e,t,i,n,s){if(!t)return"";const r=(e+"").split("\n");s=zd(t,i,n,s);for(let e=0,t=r.length;e<t;e++)r[e]=Ud(r[e],s);return r.join("\n")}function zd(e,t,i,n){let s=In({},n=n||{});s.font=t,i=is(i,"..."),s.maxIterations=is(n.maxIterations,2);const r=s.minChar=is(n.minChar,0);s.cnCharWidth=Qa("国",t);const o=s.ascCharWidth=Qa("a",t);s.placeholder=is(n.placeholder,"");let a=e=Math.max(0,e-1);for(let e=0;e<r&&a>=o;e++)a-=o;let l=Qa(i,t);return l>a&&(i="",l=0),a=e-l,s.ellipsis=i,s.ellipsisWidth=l,s.contentWidth=a,s.containerWidth=e,s}function Ud(e,t){const i=t.containerWidth,n=t.font,s=t.contentWidth;if(!i)return"";let r=Qa(e,n);if(r<=i)return e;for(let i=0;;i++){if(r<=s||i>=t.maxIterations){e+=t.ellipsis;break}const o=0===i?Fd(e,s,t.ascCharWidth,t.cnCharWidth):r>0?Math.floor(e.length*s/r):0;r=Qa(e=e.substr(0,o),n)}return""===e&&(e=t.placeholder),e}function Fd(e,t,i,n){let s=0,r=0;for(let o=e.length;r<o&&s<t;r++){const t=e.charCodeAt(r);s+=0<=t&&t<=127?i:n}return r}class Nd{}class jd{constructor(e){this.tokens=[],e&&(this.tokens=e)}}class Vd{constructor(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[]}}function Hd(e,t,i,n,s){const r=""===t,o=s&&i.rich[s]||{},a=e.lines,l=o.font||i.font;let h,c,d=!1;if(n){const e=o.padding;let i=e?e[1]+e[3]:0;if(null!=o.width&&"auto"!==o.width){const e=$a(o.width,n.width)+i;a.length>0&&e+n.accumWidth>n.width&&(h=t.split("\n"),d=!0),n.accumWidth=e}else{const e=Yd(t,l,n.width,n.breakAll,n.accumWidth);n.accumWidth=e.accumWidth+i,c=e.linesWidths,h=e.lines}}else h=t.split("\n");for(let e=0;e<h.length;e++){const t=h[e],i=new Nd;if(i.styleName=s,i.text=t,i.isLineHolder=!t&&!r,"number"==typeof o.width?i.width=o.width:i.width=c?c[e]:Qa(t,l),e||d)a.push(new jd([i]));else{const e=(a[a.length-1]||(a[0]=new jd)).tokens,n=e.length;1===n&&e[0].isLineHolder?e[0]=i:(t||!n||r)&&e.push(i)}}}const Wd=jn(",&?/;] ".split(""),(function(e,t){return e[t]=!0,e}),{});function Gd(e){return!function(e){let t=e.charCodeAt(0);return t>=32&&t<=591||t>=880&&t<=4351||t>=4608&&t<=5119||t>=7680&&t<=8303}(e)||!!Wd[e]}function Yd(e,t,i,n,s){let r=[],o=[],a="",l="",h=0,c=0;for(let d=0;d<e.length;d++){const u=e.charAt(d);if("\n"===u){l&&(a+=l,c+=h),r.push(a),o.push(c),a="",l="",h=0,c=0;continue}const p=Qa(u,t),f=!n&&!Gd(u);(r.length?c+p>i:s+c+p>i)?c?(a||l)&&(f?(a||(a=l,l="",h=0,c=h),r.push(a),o.push(c-h),l+=u,h+=p,a="",c=h):(l&&(a+=l,l="",h=0),r.push(a),o.push(c),a=u,c=p)):f?(r.push(l),o.push(h),l=u,h=p):(r.push(u),o.push(p)):(c+=p,f?(l+=u,h+=p):(l&&(a+=l,l="",h=0),a+=u))}return r.length||a||(a=e,l="",h=0),l&&(a+=l),a&&(r.push(a),o.push(c)),1===r.length&&(c+=s),{accumWidth:c,lines:r,linesWidths:o}}const Xd={fill:"#000"},Qd={style:Rn({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},wl.style)};class qd extends Sl{constructor(e){super(),this.type="text",this._children=[],this._defaultStyle=Xd,this.attr(e)}childrenRef(){return this._children}update(){super.update(),this.styleChanged()&&this._updateSubTexts();for(let e=0;e<this._children.length;e++){const t=this._children[e];t.zlevel=this.zlevel,t.z=this.z,t.z2=this.z2,t.culling=this.culling,t.cursor=this.cursor,t.invisible=this.invisible}}updateTransform(){const e=this.innerTransformable;e?(e.updateTransform(),e.transform&&(this.transform=e.transform)):super.updateTransform()}getLocalTransform(e){const t=this.innerTransformable;return t?t.getLocalTransform(e):super.getLocalTransform(e)}getComputedTransform(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),super.getComputedTransform()}_updateSubTexts(){var e;this._childCursor=0,iu(e=this.style),Fn(e.rich,iu),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()}addSelfToZr(e){super.addSelfToZr(e);for(let t=0;t<this._children.length;t++)this._children[t].__zr=e}removeSelfFromZr(e){super.removeSelfFromZr(e);for(let e=0;e<this._children.length;e++)this._children[e].__zr=null}getBoundingRect(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){const e=new wr(0,0,0,0),t=this._children,i=[];let n=null;for(let s=0;s<t.length;s++){const r=t[s],o=r.getBoundingRect(),a=r.getLocalTransform(i);a?(e.copy(o),e.applyTransform(a),n=n||e.clone(),n.union(e)):(n=n||o.clone(),n.union(o))}this._rect=n||e}return this._rect}setDefaultTextStyle(e){this._defaultStyle=e||Xd}setTextContent(e){}_mergeStyle(e,t){if(!t)return e;const i=t.rich,n=e.rich||i&&{};return In(e,t),i&&n?(this._mergeRich(n,i),e.rich=n):n&&(e.rich=n),e}_mergeRich(e,t){const i=Hn(t);for(let n=0;n<i.length;n++){const s=i[n];e[s]=e[s]||{},In(e[s],t[s])}}getAnimationStyleProps(){return Qd}_getOrCreateChild(e){let t=this._children[this._childCursor];return t&&t instanceof e||(t=new e),this._children[this._childCursor++]=t,t.__zr=this.__zr,t.parent=this,t}_updatePlainTexts(){const e=this.style,t=e.font||fn,i=e.padding,n=function(e,t){null!=e&&(e+="");const i=t.overflow,n=t.padding,s=t.font,r="truncate"===i,o=Ja(s),a=is(t.lineHeight,o),l=!!t.backgroundColor,h="truncate"===t.lineOverflow;let c,d=t.width;c=null==d||"break"!==i&&"breakAll"!==i?e?e.split("\n"):[]:e?Yd(e,t.font,d,"breakAll"===i,0).lines:[];const u=c.length*a,p=is(t.height,u);if(u>p&&h){const e=Math.floor(p/a);c=c.slice(0,e)}if(e&&r&&null!=d){const e=zd(d,s,t.ellipsis,{minChar:t.truncateMinChar,placeholder:t.placeholder});for(let t=0;t<c.length;t++)c[t]=Ud(c[t],e)}let f=p,m=0;for(let e=0;e<c.length;e++)m=Math.max(Qa(c[e],s),m);null==d&&(d=m);let g=m;return n&&(f+=n[0]+n[2],g+=n[1]+n[3],d+=n[1]+n[3]),l&&(g=d),{lines:c,height:p,outerWidth:g,outerHeight:f,lineHeight:a,calculatedLineHeight:o,contentWidth:m,contentHeight:u,width:d}}(ou(e),e),s=au(e),r=!!e.backgroundColor,o=n.outerHeight,a=n.outerWidth,l=n.contentWidth,h=n.lines,c=n.lineHeight,d=this._defaultStyle,u=e.x||0,p=e.y||0,f=e.align||d.align||"left",m=e.verticalAlign||d.verticalAlign||"top";let g=u,v=Ka(p,n.contentHeight,m);if(s||i){const t=Za(u,a,f),i=Ka(p,o,m);s&&this._renderBackground(e,e,t,i,a,o)}v+=c/2,i&&(g=ru(u,f,i),"top"===m?v+=i[0]:"bottom"===m&&(v-=i[2]));let y=0,x=!1;const w=su("fill"in e?e.fill:(x=!0,d.fill)),b=nu("stroke"in e?e.stroke:r||d.autoStroke&&!x?null:(y=2,d.stroke)),_=e.textShadowBlur>0,S=null!=e.width&&("truncate"===e.overflow||"break"===e.overflow||"breakAll"===e.overflow),M=n.calculatedLineHeight;for(let i=0;i<h.length;i++){const n=this._getOrCreateChild(vc),s=n.createStyle();n.useStyle(s),s.text=h[i],s.x=g,s.y=v,f&&(s.textAlign=f),s.textBaseline="middle",s.opacity=e.opacity,s.strokeFirst=!0,_&&(s.shadowBlur=e.textShadowBlur||0,s.shadowColor=e.textShadowColor||"transparent",s.shadowOffsetX=e.textShadowOffsetX||0,s.shadowOffsetY=e.textShadowOffsetY||0),s.stroke=b,s.fill=w,b&&(s.lineWidth=e.lineWidth||y,s.lineDash=e.lineDash,s.lineDashOffset=e.lineDashOffset||0),s.font=t,eu(s,e),v+=c,S&&n.setBoundingRect(new wr(Za(s.x,e.width,s.textAlign),Ka(s.y,M,s.textBaseline),l,M))}}_updateRichTexts(){const e=this.style,t=function(e,t){const i=new Vd;if(null!=e&&(e+=""),!e)return i;const n=t.width,s=t.height,r=t.overflow;let o,a="break"!==r&&"breakAll"!==r||null==n?null:{width:n,accumWidth:0,breakAll:"breakAll"===r},l=kd.lastIndex=0;for(;null!=(o=kd.exec(e));){const n=o.index;n>l&&Hd(i,e.substring(l,n),t,a),Hd(i,o[2],t,a,o[1]),l=kd.lastIndex}l<e.length&&Hd(i,e.substring(l,e.length),t,a);let h=[],c=0,d=0;const u=t.padding,p="truncate"===r,f="truncate"===t.lineOverflow;function m(e,t,i){e.width=t,e.lineHeight=i,c+=i,d=Math.max(d,t)}e:for(let e=0;e<i.lines.length;e++){const r=i.lines[e];let o=0,a=0;for(let l=0;l<r.tokens.length;l++){const d=r.tokens[l],u=d.styleName&&t.rich[d.styleName]||{},g=d.textPadding=u.padding,v=g?g[1]+g[3]:0,y=d.font=u.font||t.font;d.contentHeight=Ja(y);let x=is(u.height,d.contentHeight);if(d.innerHeight=x,g&&(x+=g[0]+g[2]),d.height=x,d.lineHeight=ns(u.lineHeight,t.lineHeight,x),d.align=u&&u.align||t.align,d.verticalAlign=u&&u.verticalAlign||"middle",f&&null!=s&&c+d.lineHeight>s){l>0?(r.tokens=r.tokens.slice(0,l),m(r,a,o),i.lines=i.lines.slice(0,e+1)):i.lines=i.lines.slice(0,e);break e}let w=u.width,b=null==w||"auto"===w;if("string"==typeof w&&"%"===w.charAt(w.length-1))d.percentWidth=w,h.push(d),d.contentWidth=Qa(d.text,y);else{if(b){const e=u.backgroundColor;let t=e&&e.image;t&&(t=Dd(t),Rd(t)&&(d.width=Math.max(d.width,t.width*x/t.height)))}const e=p&&null!=n?n-a:null;null!=e&&e<d.width?!b||e<v?(d.text="",d.width=d.contentWidth=0):(d.text=Ld(d.text,e-v,y,t.ellipsis,{minChar:t.truncateMinChar}),d.width=d.contentWidth=Qa(d.text,y)):d.contentWidth=Qa(d.text,y)}d.width+=v,a+=d.width,u&&(o=Math.max(o,d.lineHeight))}m(r,a,o)}i.outerWidth=i.width=is(n,d),i.outerHeight=i.height=is(s,c),i.contentHeight=c,i.contentWidth=d,u&&(i.outerWidth+=u[1]+u[3],i.outerHeight+=u[0]+u[2]);for(let e=0;e<h.length;e++){const t=h[e],n=t.percentWidth;t.width=parseInt(n,10)/100*i.width}return i}(ou(e),e),i=t.width,n=t.outerWidth,s=t.outerHeight,r=e.padding,o=e.x||0,a=e.y||0,l=this._defaultStyle,h=e.align||l.align,c=e.verticalAlign||l.verticalAlign,d=Za(o,n,h),u=Ka(a,s,c);let p=d,f=u;r&&(p+=r[3],f+=r[0]);let m=p+i;au(e)&&this._renderBackground(e,e,d,u,n,s);const g=!!e.backgroundColor;for(let n=0;n<t.lines.length;n++){const s=t.lines[n],r=s.tokens,o=r.length,a=s.lineHeight;let l,h=s.width,c=0,d=p,u=m,v=o-1;for(;c<o&&(l=r[c],!l.align||"left"===l.align);)this._placeToken(l,e,a,f,d,"left",g),h-=l.width,d+=l.width,c++;for(;v>=0&&(l=r[v],"right"===l.align);)this._placeToken(l,e,a,f,u,"right",g),h-=l.width,u-=l.width,v--;for(d+=(i-(d-p)-(m-u)-h)/2;c<=v;)l=r[c],this._placeToken(l,e,a,f,d+l.width/2,"center",g),d+=l.width,c++;f+=a}}_placeToken(e,t,i,n,s,r,o){const a=t.rich[e.styleName]||{};a.text=e.text;const l=e.verticalAlign;let h=n+i/2;"top"===l?h=n+e.height/2:"bottom"===l&&(h=n+i-e.height/2),!e.isLineHolder&&au(a)&&this._renderBackground(a,t,"right"===r?s-e.width:"center"===r?s-e.width/2:s,h-e.height/2,e.width,e.height);const c=!!a.backgroundColor,d=e.textPadding;d&&(s=ru(s,r,d),h-=e.height/2-d[0]-e.innerHeight/2);const u=this._getOrCreateChild(vc),p=u.createStyle();u.useStyle(p);const f=this._defaultStyle;let m=!1,g=0;const v=su("fill"in a?a.fill:"fill"in t?t.fill:(m=!0,f.fill)),y=nu("stroke"in a?a.stroke:"stroke"in t?t.stroke:c||o||f.autoStroke&&!m?null:(g=2,f.stroke)),x=a.textShadowBlur>0||t.textShadowBlur>0;p.text=e.text,p.x=s,p.y=h,x&&(p.shadowBlur=a.textShadowBlur||t.textShadowBlur||0,p.shadowColor=a.textShadowColor||t.textShadowColor||"transparent",p.shadowOffsetX=a.textShadowOffsetX||t.textShadowOffsetX||0,p.shadowOffsetY=a.textShadowOffsetY||t.textShadowOffsetY||0),p.textAlign=r,p.textBaseline="middle",p.font=e.font||fn,p.opacity=ns(a.opacity,t.opacity,1),eu(p,a),y&&(p.lineWidth=ns(a.lineWidth,t.lineWidth,g),p.lineDash=is(a.lineDash,t.lineDash),p.lineDashOffset=t.lineDashOffset||0,p.stroke=y),v&&(p.fill=v);const w=e.contentWidth,b=e.contentHeight;u.setBoundingRect(new wr(Za(p.x,w,p.textAlign),Ka(p.y,b,p.textBaseline),w,b))}_renderBackground(e,t,i,n,s,r){const o=e.backgroundColor,a=e.borderWidth,l=e.borderColor,h=o&&o.image,c=o&&!h,d=e.borderRadius,u=this;let p,f;if(c||e.lineHeight||a&&l){p=this._getOrCreateChild(ic),p.useStyle(p.createStyle()),p.style.fill=null;const e=p.shape;e.x=i,e.y=n,e.width=s,e.height=r,e.r=d,p.dirtyShape()}if(c){const t=p.style;t.fill=o||null,t.fillOpacity=is(e.fillOpacity,1)}else if(h){f=this._getOrCreateChild(qh),f.onload=function(){u.dirtyStyle()};const e=f.style;e.image=o.image,e.x=i,e.y=n,e.width=s,e.height=r}if(a&&l){const t=p.style;t.lineWidth=a,t.stroke=l,t.strokeOpacity=is(e.strokeOpacity,1),t.lineDash=e.borderDash,t.lineDashOffset=e.borderDashOffset||0,p.strokeContainThreshold=0,p.hasFill()&&p.hasStroke()&&(t.strokeFirst=!0,t.lineWidth*=2)}const m=(p||f).style;m.shadowBlur=e.shadowBlur||0,m.shadowColor=e.shadowColor||"transparent",m.shadowOffsetX=e.shadowOffsetX||0,m.shadowOffsetY=e.shadowOffsetY||0,m.opacity=ns(e.opacity,t.opacity,1)}static makeFont(e){let t="";return tu(e)&&(t=[e.fontStyle,e.fontWeight,$d(e.fontSize),e.fontFamily||"sans-serif"].join(" ")),t&&as(t)||e.textFont||e.font}}const Zd={left:!0,right:1,center:1},Kd={top:1,bottom:1,middle:1},Jd=["fontStyle","fontWeight","fontSize","fontFamily"];function $d(e){return"string"!=typeof e||-1===e.indexOf("px")&&-1===e.indexOf("rem")&&-1===e.indexOf("em")?isNaN(+e)?un+"px":e+"px":e}function eu(e,t){for(let i=0;i<Jd.length;i++){const n=Jd[i],s=t[n];null!=s&&(e[n]=s)}}function tu(e){return null!=e.fontSize||e.fontFamily||e.fontWeight}function iu(e){if(e){e.font=qd.makeFont(e);let t=e.align;"middle"===t&&(t="center"),e.align=null==t||Zd[t]?t:"left";let i=e.verticalAlign;"center"===i&&(i="middle"),e.verticalAlign=null==i||Kd[i]?i:"top",e.padding&&(e.padding=rs(e.padding))}}function nu(e,t){return null==e||t<=0||"transparent"===e||"none"===e?null:e.image||e.colorStops?"#000":e}function su(e){return null==e||"none"===e?null:e.image||e.colorStops?"#000":e}function ru(e,t,i){return"right"===t?e-i[1]:"center"===t?e+i[3]/2-i[1]/2:e+i[3]}function ou(e){let t=e.text;return null!=t&&(t+=""),t}function au(e){return!!(e.backgroundColor||e.lineHeight||e.borderWidth&&e.borderColor)}class lu{constructor(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0}}class hu extends Ch{constructor(e){super(e)}getDefaultStyle(){return{stroke:"#000",fill:null}}getDefaultShape(){return new lu}buildPath(e,t){const i=t.cx,n=t.cy,s=Math.max(t.r,0),r=t.startAngle,o=t.endAngle,a=t.clockwise,l=Math.cos(r),h=Math.sin(r);e.moveTo(l*s+i,h*s+n),e.arc(i,n,s,r,o,!a)}}hu.prototype.type="arc";const cu=[];class du{constructor(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1}}function uu(e,t,i){const n=e.cpx2,s=e.cpy2;return null!=n||null!=s?[(i?eo:$r)(e.x1,e.cpx1,e.cpx2,e.x2,t),(i?eo:$r)(e.y1,e.cpy1,e.cpy2,e.y2,t)]:[(i?oo:ro)(e.x1,e.cpx1,e.x2,t),(i?oo:ro)(e.y1,e.cpy1,e.y2,t)]}class pu extends Ch{constructor(e){super(e)}getDefaultStyle(){return{stroke:"#000",fill:null}}getDefaultShape(){return new du}buildPath(e,t){let i=t.x1,n=t.y1,s=t.x2,r=t.y2,o=t.cpx1,a=t.cpy1,l=t.cpx2,h=t.cpy2,c=t.percent;0!==c&&(e.moveTo(i,n),null==l||null==h?(c<1&&(lo(i,o,s,c,cu),o=cu[1],s=cu[2],lo(n,a,r,c,cu),a=cu[1],r=cu[2]),e.quadraticCurveTo(o,a,s,r)):(c<1&&(no(i,o,l,s,c,cu),o=cu[1],l=cu[2],s=cu[3],no(n,a,h,r,c,cu),a=cu[1],h=cu[2],r=cu[3]),e.bezierCurveTo(o,a,l,h,s,r)))}pointAt(e){return uu(this.shape,e,!1)}tangentAt(e){const t=uu(this.shape,e,!0);return Ts(t,t)}}pu.prototype.type="bezier-curve";class fu{constructor(){this.cx=0,this.cy=0,this.width=0,this.height=0}}class mu extends Ch{constructor(e){super(e)}getDefaultShape(){return new fu}buildPath(e,t){const i=t.cx,n=t.cy,s=t.width,r=t.height;e.moveTo(i,n+s),e.bezierCurveTo(i+s,n+s,i+3*s/2,n-s/3,i,n-r),e.bezierCurveTo(i-3*s/2,n-s/3,i-s,n+s,i,n+s),e.closePath()}}mu.prototype.type="droplet";class gu{constructor(){this.cx=0,this.cy=0,this.width=0,this.height=0}}class vu extends Ch{constructor(e){super(e)}getDefaultShape(){return new gu}buildPath(e,t){const i=t.cx,n=t.cy,s=t.width,r=t.height;e.moveTo(i,n),e.bezierCurveTo(i+s/2,n-2*r/3,i+2*s,n+r/3,i,n+r),e.bezierCurveTo(i-2*s,n+r/3,i-s/2,n-2*r/3,i,n)}}vu.prototype.type="heart";const yu=Math.PI,xu=Math.sin,wu=Math.cos;class bu{constructor(){this.x=0,this.y=0,this.r=0,this.n=0}}class _u extends Ch{constructor(e){super(e)}getDefaultShape(){return new bu}buildPath(e,t){const i=t.n;if(!i||i<2)return;const n=t.x,s=t.y,r=t.r,o=2*yu/i;let a=-yu/2;e.moveTo(n+r*wu(a),s+r*xu(a));for(let t=0,l=i-1;t<l;t++)a+=o,e.lineTo(n+r*wu(a),s+r*xu(a));e.closePath()}}_u.prototype.type="isogon";class Su{constructor(){this.cx=0,this.cy=0,this.r=0,this.r0=0}}class Mu extends Ch{constructor(e){super(e)}getDefaultShape(){return new Su}buildPath(e,t){const i=t.cx,n=t.cy,s=2*Math.PI;e.moveTo(i+t.r,n),e.arc(i,n,t.r,0,s,!1),e.moveTo(i+t.r0,n),e.arc(i,n,t.r0,0,s,!0)}}Mu.prototype.type="ring";const Cu=Math.sin,Au=Math.cos,Eu=Math.PI/180;class Tu{constructor(){this.cx=0,this.cy=0,this.r=[],this.k=0,this.n=1}}class Pu extends Ch{constructor(e){super(e)}getDefaultStyle(){return{stroke:"#000",fill:null}}getDefaultShape(){return new Tu}buildPath(e,t){const i=t.r,n=t.k,s=t.n,r=t.cx,o=t.cy;let a,l,h;e.moveTo(r,o);for(let t=0,c=i.length;t<c;t++){h=i[t];for(let t=0;t<=360*s;t++)a=h*Cu(n/s*t%360*Eu)*Au(t*Eu)+r,l=h*Cu(n/s*t%360*Eu)*Cu(t*Eu)+o,e.lineTo(a,l)}}}Pu.prototype.type="rose";const Ou=Math.PI,Du=Math.cos,Bu=Math.sin;class Iu{constructor(){this.cx=0,this.cy=0,this.n=3,this.r=0}}class Ru extends Ch{constructor(e){super(e)}getDefaultShape(){return new Iu}buildPath(e,t){const i=t.n;if(!i||i<2)return;const n=t.cx,s=t.cy,r=t.r;let o=t.r0;null==o&&(o=i>4?r*Du(2*Ou/i)/Du(Ou/i):r/3);const a=Ou/i;let l=-Ou/2;const h=n+r*Du(l),c=s+r*Bu(l);l+=a,e.moveTo(h,c);for(let t,h=0,c=2*i-1;h<c;h++)t=h%2==0?o:r,e.lineTo(n+t*Du(l),s+t*Bu(l)),l+=a;e.closePath()}}Ru.prototype.type="star";const ku=Math.cos,Lu=Math.sin;class zu{constructor(){this.cx=0,this.cy=0,this.r=0,this.r0=0,this.d=0,this.location="out"}}class Uu extends Ch{constructor(e){super(e)}getDefaultStyle(){return{stroke:"#000",fill:null}}getDefaultShape(){return new zu}buildPath(e,t){const i=t.r,n=t.r0,s=t.d,r=t.cx,o=t.cy,a="out"===t.location?1:-1;let l,h,c,d;if(t.location&&i<=n)return;let u,p=0,f=1;l=(i+a*n)*ku(0)-a*s*ku(0)+r,h=(i+a*n)*Lu(0)-s*Lu(0)+o,e.moveTo(l,h);do{p++}while(n*p%(i+a*n)!=0);do{u=Math.PI/180*f,c=(i+a*n)*ku(u)-a*s*ku((i/n+a)*u)+r,d=(i+a*n)*Lu(u)-s*Lu((i/n+a)*u)+o,e.lineTo(c,d),f++}while(f<=n*p/(i+a*n)*360)}}Uu.prototype.type="trochoid";const Fu=[0,0],Nu=[0,0],ju=new dr,Vu=new dr;class Hu{constructor(e,t){this._corners=[],this._axes=[],this._origin=[0,0];for(let e=0;e<4;e++)this._corners[e]=new dr;for(let e=0;e<2;e++)this._axes[e]=new dr;e&&this.fromBoundingRect(e,t)}fromBoundingRect(e,t){const i=this._corners,n=this._axes,s=e.x,r=e.y,o=s+e.width,a=r+e.height;if(i[0].set(s,r),i[1].set(o,r),i[2].set(o,a),i[3].set(s,a),t)for(let e=0;e<4;e++)i[e].transform(t);dr.sub(n[0],i[1],i[0]),dr.sub(n[1],i[3],i[0]),n[0].normalize(),n[1].normalize();for(let e=0;e<2;e++)this._origin[e]=n[e].dot(i[0])}intersect(e,t){let i=!0;const n=!t;return ju.set(1/0,1/0),Vu.set(0,0),!this._intersectCheckOneSide(this,e,ju,Vu,n,1)&&(i=!1,n)||!this._intersectCheckOneSide(e,this,ju,Vu,n,-1)&&(i=!1,n)||n||dr.copy(t,i?ju:Vu),i}_intersectCheckOneSide(e,t,i,n,s,r){let o=!0;for(let a=0;a<2;a++){const l=this._axes[a];if(this._getProjMinMaxOnAxis(a,e._corners,Fu),this._getProjMinMaxOnAxis(a,t._corners,Nu),Fu[1]<Nu[0]||Fu[0]>Nu[1]){if(o=!1,s)return o;const e=Math.abs(Nu[0]-Fu[1]),t=Math.abs(Fu[0]-Nu[1]);Math.min(e,t)>n.len()&&(e<t?dr.scale(n,l,-e*r):dr.scale(n,l,t*r))}else if(i){const e=Math.abs(Nu[0]-Fu[1]),t=Math.abs(Fu[0]-Nu[1]);Math.min(e,t)<i.len()&&(e<t?dr.scale(i,l,e*r):dr.scale(i,l,-t*r))}}return o}_getProjMinMaxOnAxis(e,t,i){const n=this._axes[e],s=this._origin,r=t[0].dot(n)+s[e];let o=r,a=r;for(let i=1;i<t.length;i++){const r=t[i].dot(n)+s[e];o=Math.min(r,o),a=Math.max(r,a)}i[0]=o,i[1]=a}}class Wu{constructor(e){const t=this.dom=document.createElement("div");t.className="ec-debug-dirty-rect",e=In({},e),In(e,{backgroundColor:"rgba(0, 0, 255, 0.2)",border:"1px solid #00f"}),t.style.cssText="\nposition: absolute;\nopacity: 0;\ntransition: opacity 0.5s linear;\npointer-events: none;\n";for(let i in e)e.hasOwnProperty(i)&&(t.style[i]=e[i])}update(e){const t=this.dom.style;t.width=e.width+"px",t.height=e.height+"px",t.left=e.x+"px",t.top=e.y+"px"}hide(){this.dom.style.opacity="0"}show(e){clearTimeout(this._hideTimeout),this.dom.style.opacity="1",this._hideTimeout=setTimeout((()=>{this.hide()}),e||1e3)}}const Gu=(e,t)=>{var i=fl(null,{renderer:"svg",ssr:!0,width:null!=t?t:2e4,height:null!=t?t:2e4});const n=new cl;i.add(n),Array.isArray(e)||(e=[e]),e.forEach((e=>n.add(e)));let s=n.getBoundingRect();return i.dispose(),s};function Yu(e){return isFinite(e)}function Xu(e,t,i){const n="radial"===t.type?function(e,t,i){const n=i.width,s=i.height,r=Math.min(n,s);let o=null==t.x?.5:t.x,a=null==t.y?.5:t.y,l=null==t.r?.5:t.r;return t.global||(o=o*n+i.x,a=a*s+i.y,l*=r),o=Yu(o)?o:.5,a=Yu(a)?a:.5,l=l>=0&&Yu(l)?l:.5,e.createRadialGradient(o,a,0,o,a,l)}(e,t,i):function(e,t,i){let n=null==t.x?0:t.x,s=null==t.x2?1:t.x2,r=null==t.y?0:t.y,o=null==t.y2?0:t.y2;return t.global||(n=n*i.width+i.x,s=s*i.width+i.x,r=r*i.height+i.y,o=o*i.height+i.y),n=Yu(n)?n:0,s=Yu(s)?s:1,r=Yu(r)?r:0,o=Yu(o)?o:0,e.createLinearGradient(n,r,s,o)}(e,t,i),s=t.colorStops;for(let e=0;e<s.length;e++)n.addColorStop(s[e].offset,s[e].color);return n}function Qu(e){return parseInt(e,10)}function qu(e,t,i){const n=["width","height"][t],s=["clientWidth","clientHeight"][t],r=["paddingLeft","paddingTop"][t],o=["paddingRight","paddingBottom"][t];if(null!=i[n]&&"auto"!==i[n])return parseFloat(i[n]);const a=document.defaultView.getComputedStyle(e);return(e[s]||Qu(a[n])||Qu(e.style[n]))-(Qu(a[r])||0)-(Qu(a[o])||0)|0}function Zu(e){const t=e.style;let i=t.lineDash&&t.lineWidth>0&&(n=t.lineDash,s=t.lineWidth,n&&"solid"!==n&&s>0?"dashed"===n?[4*s,2*s]:"dotted"===n?[s]:Qn(n)?[n]:Gn(n)?n:null:null);var n,s;let r=t.lineDashOffset;if(i){const n=t.strokeNoScale&&e.getLineScale?e.getLineScale():1;n&&1!==n&&(i=Nn(i,(function(e){return e/n})),r/=n)}return[i,r]}const Ku=new sh(!0);function Ju(e){const t=e.stroke;return!(null==t||"none"===t||!(e.lineWidth>0))}function $u(e){return"string"==typeof e&&"none"!==e}function ep(e){const t=e.fill;return null!=t&&"none"!==t}function tp(e,t){if(null!=t.fillOpacity&&1!==t.fillOpacity){const i=e.globalAlpha;e.globalAlpha=t.fillOpacity*t.opacity,e.fill(),e.globalAlpha=i}else e.fill()}function ip(e,t){if(null!=t.strokeOpacity&&1!==t.strokeOpacity){const i=e.globalAlpha;e.globalAlpha=t.strokeOpacity*t.opacity,e.stroke(),e.globalAlpha=i}else e.stroke()}function np(e,t,i){const n=Bd(t.image,t.__image,i);if(Rd(n)){const i=e.createPattern(n,t.repeat||"repeat");if("function"==typeof DOMMatrix&&i&&i.setTransform){const e=new DOMMatrix;e.translateSelf(t.x||0,t.y||0),e.rotateSelf(0,0,(t.rotation||0)*vs),e.scaleSelf(t.scaleX||1,t.scaleY||1),i.setTransform(e)}return i}}const sp=["shadowBlur","shadowOffsetX","shadowOffsetY"],rp=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function op(e,t,i,n,s){let r=!1;if(!n&&t===(i=i||{}))return!1;if(n||t.opacity!==i.opacity){hp(e,s),r=!0;const i=Math.max(Math.min(t.opacity,1),0);e.globalAlpha=isNaN(i)?xl.opacity:i}(n||t.blend!==i.blend)&&(r||(hp(e,s),r=!0),e.globalCompositeOperation=t.blend||xl.blend);for(let o=0;o<sp.length;o++){const a=sp[o];(n||t[a]!==i[a])&&(r||(hp(e,s),r=!0),e[a]=e.dpr*(t[a]||0))}return(n||t.shadowColor!==i.shadowColor)&&(r||(hp(e,s),r=!0),e.shadowColor=t.shadowColor||xl.shadowColor),r}function ap(e,t,i,n,s){const r=cp(t,s.inHover),o=n?null:i&&cp(i,s.inHover)||{};if(r===o)return!1;let a=op(e,r,o,n,s);if((n||r.fill!==o.fill)&&(a||(hp(e,s),a=!0),$u(r.fill)&&(e.fillStyle=r.fill)),(n||r.stroke!==o.stroke)&&(a||(hp(e,s),a=!0),$u(r.stroke)&&(e.strokeStyle=r.stroke)),(n||r.opacity!==o.opacity)&&(a||(hp(e,s),a=!0),e.globalAlpha=null==r.opacity?1:r.opacity),t.hasStroke()){const i=r.lineWidth/(r.strokeNoScale&&t.getLineScale?t.getLineScale():1);e.lineWidth!==i&&(a||(hp(e,s),a=!0),e.lineWidth=i)}for(let t=0;t<rp.length;t++){const i=rp[t],l=i[0];(n||r[l]!==o[l])&&(a||(hp(e,s),a=!0),e[l]=r[l]||i[1])}return a}function lp(e,t){const i=t.transform,n=e.dpr||1;i?e.setTransform(n*i[0],n*i[1],n*i[2],n*i[3],n*i[4],n*i[5]):e.setTransform(n,0,0,n,0,0)}function hp(e,t){t.batchFill&&e.fill(),t.batchStroke&&e.stroke(),t.batchFill="",t.batchStroke=""}function cp(e,t){return t&&e.__hoverStyle||e.style}function dp(e,t,i,n){const s=t.transform;if(!t.shouldBePainted(i.viewWidth,i.viewHeight,!1,!1))return t.__dirty&=-2,void(t.__isRendered=!1);const r=t.__clipPaths,o=i.prevElClipPaths;let a=!1,l=!1;if(o&&!function(e,t){if(e===t||!e&&!t)return!1;if(!e||!t||e.length!==t.length)return!0;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!0;return!1}(r,o)||(o&&o.length&&(hp(e,i),e.restore(),l=a=!0,i.prevElClipPaths=null,i.allClipped=!1,i.prevEl=null),r&&r.length&&(hp(e,i),e.save(),function(e,t,i){let n=!1;for(let i=0;i<e.length;i++){const s=e[i];n=n||s.isZeroArea(),lp(t,s),t.beginPath(),s.buildPath(t,s.shape),t.clip()}i.allClipped=n}(r,e,i),a=!0),i.prevElClipPaths=r),i.allClipped)return void(t.__isRendered=!1);t.beforeBrush&&t.beforeBrush(),t.innerBeforeBrush();const h=i.prevEl;h||(l=a=!0);let c=t instanceof Ch&&t.autoBatch&&function(e){const t=ep(e),i=Ju(e);return!(e.lineDash||!(+t^+i)||t&&"string"!=typeof e.fill||i&&"string"!=typeof e.stroke||e.strokePercent<1||e.strokeOpacity<1||e.fillOpacity<1)}(t.style);var d,u;a||(d=s,u=h.transform,d&&u?d[0]!==u[0]||d[1]!==u[1]||d[2]!==u[2]||d[3]!==u[3]||d[4]!==u[4]||d[5]!==u[5]:d||u)?(hp(e,i),lp(e,t)):c||hp(e,i);const p=cp(t,i.inHover);t instanceof Ch?(1!==i.lastDrawType&&(l=!0,i.lastDrawType=1),ap(e,t,h,l,i),c&&(i.batchFill||i.batchStroke)||e.beginPath(),function(e,t,i,n){let s=Ju(i),r=ep(i);const o=i.strokePercent,a=o<1,l=!t.path;t.silent&&!a||!l||t.createPathProxy();const h=t.path||Ku,c=t.__dirty;if(!n){const n=i.fill,o=i.stroke,a=r&&!!n.colorStops,l=s&&!!o.colorStops,h=r&&!!n.image,d=s&&!!o.image;let u,p,f,m,g;(a||l)&&(g=t.getBoundingRect()),a&&(u=c?Xu(e,n,g):t.__canvasFillGradient,t.__canvasFillGradient=u),l&&(p=c?Xu(e,o,g):t.__canvasStrokeGradient,t.__canvasStrokeGradient=p),h&&(f=c||!t.__canvasFillPattern?np(e,n,t):t.__canvasFillPattern,t.__canvasFillPattern=f),d&&(m=c||!t.__canvasStrokePattern?np(e,o,t):t.__canvasStrokePattern,t.__canvasStrokePattern=f),a?e.fillStyle=u:h&&(f?e.fillStyle=f:r=!1),l?e.strokeStyle=p:d&&(m?e.strokeStyle=m:s=!1)}const d=t.getGlobalScale();let u,p;h.setScale(d[0],d[1],t.segmentIgnoreThreshold),e.setLineDash&&i.lineDash&&([u,p]=Zu(t));let f=!0;(l||4&c)&&(h.setDPR(e.dpr),a?h.setContext(null):(h.setContext(e),f=!1),h.reset(),t.buildPath(h,t.shape,n),h.toStatic(),t.pathUpdated()),f&&h.rebuildPath(e,a?o:1),u&&(e.setLineDash(u),e.lineDashOffset=p),n||(i.strokeFirst?(s&&ip(e,i),r&&tp(e,i)):(r&&tp(e,i),s&&ip(e,i))),u&&e.setLineDash([])}(e,t,p,c),c&&(i.batchFill=p.fill||"",i.batchStroke=p.stroke||"")):t instanceof vc?(3!==i.lastDrawType&&(l=!0,i.lastDrawType=3),ap(e,t,h,l,i),function(e,t,i){let n=i.text;if(null!=n&&(n+=""),n){let s,r;e.font=i.font||fn,e.textAlign=i.textAlign,e.textBaseline=i.textBaseline,e.setLineDash&&i.lineDash&&([s,r]=Zu(t)),s&&(e.setLineDash(s),e.lineDashOffset=r),i.strokeFirst?(Ju(i)&&e.strokeText(n,i.x,i.y),ep(i)&&e.fillText(n,i.x,i.y)):(ep(i)&&e.fillText(n,i.x,i.y),Ju(i)&&e.strokeText(n,i.x,i.y)),s&&e.setLineDash([])}}(e,t,p)):t instanceof qh?(2!==i.lastDrawType&&(l=!0,i.lastDrawType=2),function(e,t,i,n,s){op(e,cp(t,s.inHover),i&&cp(i,s.inHover),n,s)}(e,t,h,l,i),function(e,t,i){const n=t.__image=Bd(i.image,t.__image,t,t.onload);if(!n||!Rd(n))return;const s=i.x||0,r=i.y||0;let o=t.getWidth(),a=t.getHeight();const l=n.width/n.height;if(null==o&&null!=a?o=a*l:null==a&&null!=o?a=o/l:null==o&&null==a&&(o=n.width,a=n.height),i.sWidth&&i.sHeight){const t=i.sx||0,l=i.sy||0;e.drawImage(n,t,l,i.sWidth,i.sHeight,s,r,o,a)}else if(i.sx&&i.sy){const t=i.sx,l=i.sy,h=o-t,c=a-l;e.drawImage(n,t,l,h,c,s,r,o,a)}else e.drawImage(n,s,r,o,a)}(e,t,p)):t.getTemporalDisplayables&&(4!==i.lastDrawType&&(l=!0,i.lastDrawType=4),function(e,t,i){let n=t.getDisplayables(),s=t.getTemporalDisplayables();e.save();let r,o,a={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:i.viewWidth,viewHeight:i.viewHeight,inHover:i.inHover};for(r=t.getCursor(),o=n.length;r<o;r++){const t=n[r];t.beforeBrush&&t.beforeBrush(),t.innerBeforeBrush(),dp(e,t,a,r===o-1),t.innerAfterBrush(),t.afterBrush&&t.afterBrush(),a.prevEl=t}for(let t=0,i=s.length;t<i;t++){const n=s[t];n.beforeBrush&&n.beforeBrush(),n.innerBeforeBrush(),dp(e,n,a,t===i-1),n.innerAfterBrush(),n.afterBrush&&n.afterBrush(),a.prevEl=n}t.clearTemporalDisplayables(),t.notClear=!0,e.restore()}(e,t,i)),c&&n&&hp(e,i),t.innerAfterBrush(),t.afterBrush&&t.afterBrush(),i.prevEl=t,t.__dirty=0,t.__isRendered=!0}function up(e,t,i){const n=gn.createCanvas(),s=t.getWidth(),r=t.getHeight(),o=n.style;return o&&(o.position="absolute",o.left="0",o.top="0",o.width=s+"px",o.height=r+"px",n.setAttribute("data-zr-dom-id",e)),n.width=s*i,n.height=r*i,n}class pp extends Ns{constructor(e,t,i){let n;super(),this.motionBlur=!1,this.lastFrameAlpha=.7,this.dpr=1,this.virtual=!1,this.config={},this.incremental=!1,this.zlevel=0,this.maxRepaintRectCount=5,this.__dirty=!0,this.__firstTimePaint=!0,this.__used=!1,this.__drawIndex=0,this.__startIndex=0,this.__endIndex=0,this.__prevStartIndex=null,this.__prevEndIndex=null,i=i||ka,"string"==typeof e?n=up(e,t,i):qn(e)&&(n=e,e=n.id),this.id=e,this.dom=n;const s=n.style;s&&(fs(n),n.onselectstart=()=>!1,s.padding="0",s.margin="0",s.borderWidth="0"),this.painter=t,this.dpr=i}getElementCount(){return this.__endIndex-this.__startIndex}afterBrush(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex}initContext(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr}setUnpainted(){this.__firstTimePaint=!0}createBackBuffer(){const e=this.dpr;this.domBack=up("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),1!==e&&this.ctxBack.scale(e,e)}createRepaintRects(e,t,i,n){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;const s=[],r=this.maxRepaintRectCount;let o=!1;const a=new wr(0,0,0,0);function l(e){if(e.isFinite()&&!e.isZero())if(0===s.length){const t=new wr(0,0,0,0);t.copy(e),s.push(t)}else{let t=!1,i=1/0,n=0;for(let r=0;r<s.length;++r){const l=s[r];if(l.intersect(e)){const i=new wr(0,0,0,0);i.copy(l),i.union(e),s[r]=i,t=!0;break}if(o){a.copy(e),a.union(l);const t=e.width*e.height,s=l.width*l.height,o=a.width*a.height-t-s;o<i&&(i=o,n=r)}}if(o&&(s[n].union(e),t=!0),!t){const t=new wr(0,0,0,0);t.copy(e),s.push(t)}o||(o=s.length>=r)}}for(let t=this.__startIndex;t<this.__endIndex;++t){const s=e[t];if(s){const e=s.shouldBePainted(i,n,!0,!0),t=s.__isRendered&&(1&s.__dirty||!e)?s.getPrevPaintRect():null;t&&l(t);const r=e&&(1&s.__dirty||!s.__isRendered)?s.getPaintRect():null;r&&l(r)}}for(let e=this.__prevStartIndex;e<this.__prevEndIndex;++e){const s=t[e],r=s&&s.shouldBePainted(i,n,!0,!0);if(s&&(!r||!s.__zr)&&s.__isRendered){const e=s.getPrevPaintRect();e&&l(e)}}let h;do{h=!1;for(let e=0;e<s.length;)if(s[e].isZero())s.splice(e,1);else{for(let t=e+1;t<s.length;)s[e].intersect(s[t])?(h=!0,s[e].union(s[t]),s.splice(t,1)):t++;e++}}while(h);return this._paintRects=s,s}debugGetPaintRects(){return(this._paintRects||[]).slice()}resize(e,t){const i=this.dpr,n=this.dom,s=n.style,r=this.domBack;s&&(s.width=e+"px",s.height=t+"px"),n.width=e*i,n.height=t*i,r&&(r.width=e*i,r.height=t*i,1!==i&&this.ctxBack.scale(i,i))}clear(e,t,i){const n=this.dom,s=this.ctx,r=n.width,o=n.height;t=t||this.clearColor;const a=this.motionBlur&&!e,l=this.lastFrameAlpha,h=this.dpr,c=this;a&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(n,0,0,r/h,o/h));const d=this.domBack;function u(e,i,n,r){if(s.clearRect(e,i,n,r),t&&"transparent"!==t){let o;$n(t)?(o=(t.global||t.__width===n&&t.__height===r)&&t.__canvasGradient||Xu(s,t,{x:0,y:0,width:n,height:r}),t.__canvasGradient=o,t.__width=n,t.__height=r):es(t)&&(t.scaleX=t.scaleX||h,t.scaleY=t.scaleY||h,o=np(s,t,{dirty(){c.setUnpainted(),c.painter.refresh()}})),s.save(),s.fillStyle=o||t,s.fillRect(e,i,n,r),s.restore()}a&&(s.save(),s.globalAlpha=l,s.drawImage(d,e,i,n,r),s.restore())}!i||a?u(0,0,r,o):i.length&&Fn(i,(e=>{u(e.x*h,e.y*h,e.width*h,e.height*h)}))}}const fp=1e5,mp=314159,gp=.01,vp=Math.sin,yp=Math.cos,xp=Math.PI,wp=2*Math.PI,bp=180/xp;class _p{reset(e){this._start=!0,this._d=[],this._str="",this._p=Math.pow(10,e||4)}moveTo(e,t){this._add("M",e,t)}lineTo(e,t){this._add("L",e,t)}bezierCurveTo(e,t,i,n,s,r){this._add("C",e,t,i,n,s,r)}quadraticCurveTo(e,t,i,n){this._add("Q",e,t,i,n)}arc(e,t,i,n,s,r){this.ellipse(e,t,i,i,0,n,s,r)}ellipse(e,t,i,n,s,r,o,a){let l=o-r;const h=!a,c=Math.abs(l),d=Wo(c-wp)||(h?l>=wp:-l>=wp),u=l>0?l%wp:l%wp+wp;let p=!1;p=!!d||!Wo(c)&&u>=xp==!!h;const f=e+i*yp(r),m=t+n*vp(r);this._start&&this._add("M",f,m);const g=Math.round(s*bp);if(d){const s=1/this._p,o=(h?1:-1)*(wp-s);this._add("A",i,n,g,1,+h,e+i*yp(r+o),t+n*vp(r+o)),s>.01&&this._add("A",i,n,g,0,+h,f,m)}else{const s=e+i*yp(o),r=t+n*vp(o);this._add("A",i,n,g,+p,+h,s,r)}}rect(e,t,i,n){this._add("M",e,t),this._add("l",i,0),this._add("l",0,n),this._add("l",-i,0),this._add("Z")}closePath(){this._d.length>0&&this._add("Z")}_add(e,t,i,n,s,r,o,a,l){const h=[],c=this._p;for(let e=1;e<arguments.length;e++){const t=arguments[e];if(isNaN(t))return void(this._invalid=!0);h.push(Math.round(t*c)/c)}this._d.push(e+h.join(" ")),this._start="Z"===e}generateStr(){this._str=this._invalid?"":this._d.join(""),this._d=[]}getStr(){return this._str}}const Sp="none",Mp=Math.round,Cp=["lineCap","miterLimit","lineJoin"],Ap=Nn(Cp,(e=>`stroke-${e.toLowerCase()}`)),Ep="http://www.w3.org/2000/svg",Tp="http://www.w3.org/1999/xlink",Pp="http://www.w3.org/2000/xmlns/",Op="http://www.w3.org/XML/1998/namespace",Dp="ecmeta_";function Bp(e){return document.createElementNS(Ep,e)}function Ip(e,t,i,n,s){return{tag:e,attrs:i||{},children:n,text:s,key:t}}function Rp(e,t){const i=(t=t||{}).newline?"\n":"";return function e(t){const{children:n,tag:s,attrs:r,text:o}=t;return function(e,t){const i=[];if(t)for(let e in t){const n=t[e];let s=e;!1!==n&&(!0!==n&&null!=n&&(s+=`="${n}"`),i.push(s))}return`<${e} ${i.join(" ")}>`}(s,r)+("style"!==s?null==(a=o)?"":(a+"").replace(Gs,(function(e,t){return Ys[t]})):o||"")+(n?`${i}${Nn(n,(t=>e(t))).join(i)}${i}`:"")+`</${s}>`;var a}(e)}function kp(e){return{zrId:e,shadowCache:{},patternCache:{},gradientCache:{},clipPathCache:{},defs:{},cssNodes:{},cssAnims:{},cssStyleCache:{},cssAnimIdx:0,shadowIdx:0,gradientIdx:0,patternIdx:0,clipPathIdx:0}}function Lp(e,t,i,n){return Ip("svg","root",{width:e,height:t,xmlns:Ep,"xmlns:xlink":Tp,version:"1.1",baseProfile:"full",viewBox:!!n&&`0 0 ${e} ${t}`},i)}let zp=0;function Up(){return zp++}const Fp={cubicIn:"0.32,0,0.67,0",cubicOut:"0.33,1,0.68,1",cubicInOut:"0.65,0,0.35,1",quadraticIn:"0.11,0,0.5,0",quadraticOut:"0.5,1,0.89,1",quadraticInOut:"0.45,0,0.55,1",quarticIn:"0.5,0,0.75,0",quarticOut:"0.25,1,0.5,1",quarticInOut:"0.76,0,0.24,1",quinticIn:"0.64,0,0.78,0",quinticOut:"0.22,1,0.36,1",quinticInOut:"0.83,0,0.17,1",sinusoidalIn:"0.12,0,0.39,0",sinusoidalOut:"0.61,1,0.88,1",sinusoidalInOut:"0.37,0,0.63,1",exponentialIn:"0.7,0,0.84,0",exponentialOut:"0.16,1,0.3,1",exponentialInOut:"0.87,0,0.13,1",circularIn:"0.55,0,1,0.45",circularOut:"0,0.55,0.45,1",circularInOut:"0.85,0,0.15,1"},Np="transform-origin";function jp(e,t,i){const n=In({},e.shape);In(n,t),e.buildPath(i,n);const s=new _p;return s.reset(ea(e)),i.rebuildPath(s,1),s.generateStr(),s.getStr()}function Vp(e,t){const{originX:i,originY:n}=t;(i||n)&&(e[Np]=`${i}px ${n}px`)}const Hp={fill:"fill",opacity:"opacity",lineWidth:"stroke-width",lineDashOffset:"stroke-dashoffset"};function Wp(e,t){const i=t.zrId+"-ani-"+t.cssAnimIdx++;return t.cssAnims[i]=e,i}function Gp(e){return Xn(e)?Fp[e]?`cubic-bezier(${Fp[e]})`:uo(e)?e:"":""}function Yp(e,t,i,n){const s=e.animators,r=s.length,o=[];if(e instanceof Td){const n=function(e,t,i){const n=e.shape.paths,s={};let r,o;if(Fn(n,(e=>{const t=kp(i.zrId);t.animation=!0,Yp(e,{},t,!0);const n=t.cssAnims,a=t.cssNodes,l=Hn(n),h=l.length;if(!h)return;o=l[h-1];const c=n[o];for(let e in c){const t=c[e];s[e]=s[e]||{d:""},s[e].d+=t.d||""}for(let e in a){const t=a[e].animation;t.indexOf(o)>=0&&(r=t)}})),!r)return;t.d=!1;const a=Wp(s,i);return r.replace(o,a)}(e,t,i);if(n)o.push(n);else if(!r)return}else if(!r)return;const a={};for(let e=0;e<r;e++){const t=s[e],i=[t.getMaxTime()/1e3+"s"],n=Gp(t.getClip().easing),r=t.getDelay();n?i.push(n):i.push("linear"),r&&i.push(r/1e3+"s"),t.getLoop()&&i.push("infinite");const o=i.join(" ");a[o]=a[o]||[o,[]],a[o][1].push(t)}function l(s){const r=s[1],o=r.length,a={},l={},h={},c="animation-timing-function";function d(e,t,i){const n=e.getTracks(),s=e.getMaxTime();for(let e=0;e<n.length;e++){const r=n[e];if(r.needsAnimate()){const e=r.keyframes;let n=r.propName;if(i&&(n=i(n)),n)for(let i=0;i<e.length;i++){const r=e[i],o=Math.round(r.time/s*100)+"%",a=Gp(r.easing),l=r.rawValue;(Xn(l)||Qn(l))&&(t[o]=t[o]||{},t[o][n]=r.rawValue,a&&(t[o][c]=a))}}}}for(let e=0;e<o;e++){const t=r[e],i=t.targetName;i?"shape"===i&&d(t,l):!n&&d(t,a)}for(let t in a){const i={};Ya(i,e),In(i,a[t]);const n=ta(i),s=a[t][c];h[t]=n?{transform:n}:{},Vp(h[t],i),s&&(h[t][c]=s)}let u,p=!0;for(let t in l){h[t]=h[t]||{};const i=!u,n=l[t][c];i&&(u=new sh);let s=u.len();u.reset(),h[t].d=jp(e,l[t],u);let r=u.len();if(!i&&s!==r){p=!1;break}n&&(h[t][c]=n)}if(!p)for(let e in h)delete h[e].d;if(!n)for(let e=0;e<o;e++){const t=r[e];"style"===t.targetName&&d(t,h,(e=>Hp[e]))}const f=Hn(h);let m,g=!0;for(let e=1;e<f.length;e++){const t=f[e-1],i=f[e];if(h[t][Np]!==h[i][Np]){g=!1;break}m=h[t][Np]}if(g&&m){for(const e in h)h[e][Np]&&delete h[e][Np];t[Np]=m}if(Vn(f,(e=>Hn(h[e]).length>0)).length)return`${Wp(h,i)} ${s[0]} both`}for(let e in a){const t=l(a[e]);t&&o.push(t)}if(o.length){const e=i.zrId+"-cls-"+Up();i.cssNodes["."+e]={animation:o.join(",")},t.class=e}}function Xp(e,t,i,n){const s=JSON.stringify(e);let r=i.cssStyleCache[s];r||(r=i.zrId+"-cls-"+Up(),i.cssStyleCache[s]=r,i.cssNodes["."+r+(n?":hover":"")]=e),t.class=t.class?t.class+" "+r:r}const Qp=Math.round;function qp(e){return e&&Xn(e.src)}function Zp(e){return e&&Yn(e.toDataURL)}function Kp(e,t,i,n){(function(e,t,i,n){const s=null==t.opacity?1:t.opacity;if(i instanceof qh)e("opacity",s);else{if(function(e){const t=e.fill;return null!=t&&t!==Sp}(t)){const i=Vo(t.fill);e("fill",i.color);const n=null!=t.fillOpacity?t.fillOpacity*i.opacity*s:i.opacity*s;n<1&&e("fill-opacity",n)}else e("fill",Sp);if(function(e){const t=e.stroke;return null!=t&&t!==Sp}(t)){const n=Vo(t.stroke);e("stroke",n.color);const r=t.strokeNoScale?i.getLineScale():1,o=r?(t.lineWidth||0)/r:0,a=null!=t.strokeOpacity?t.strokeOpacity*n.opacity*s:n.opacity*s,l=t.strokeFirst;if(1!==o&&e("stroke-width",o),l&&e("paint-order",l?"stroke":"fill"),a<1&&e("stroke-opacity",a),t.lineDash){let[t,n]=Zu(i);t&&(n=Mp(n||0),e("stroke-dasharray",t.join(",")),n&&e("stroke-dashoffset",n))}for(let i=0;i<Cp.length;i++){const n=Cp[i];if(t[n]!==_h[n]){const s=t[n]||_h[n];s&&e(Ap[i],s)}}}}})(((s,r)=>{const o="fill"===s||"stroke"===s;o&&Jo(r)?af(t,e,s,n):o&&qo(r)?lf(i,e,s,n):e[s]=o&&"none"===r?"transparent":r}),t,i),function(e,t,i){const n=e.style;if(function(e){return e&&(e.shadowBlur||e.shadowOffsetX||e.shadowOffsetY)}(n)){const s=function(e){const t=e.style,i=e.getGlobalScale();return[t.shadowColor,(t.shadowBlur||0).toFixed(2),(t.shadowOffsetX||0).toFixed(2),(t.shadowOffsetY||0).toFixed(2),i[0],i[1]].join(",")}(e),r=i.shadowCache;let o=r[s];if(!o){const t=e.getGlobalScale(),a=t[0],l=t[1];if(!a||!l)return;const h=n.shadowOffsetX||0,c=n.shadowOffsetY||0,d=n.shadowBlur,{opacity:u,color:p}=Vo(n.shadowColor),f=d/2/a+" "+d/2/l;o=i.zrId+"-s"+i.shadowIdx++,i.defs[o]=Ip("filter",o,{id:o,x:"-100%",y:"-100%",width:"300%",height:"300%"},[Ip("feDropShadow","",{dx:h/a,dy:c/l,stdDeviation:f,"flood-color":p,"flood-opacity":u})]),r[s]=o}t.filter=$o(o)}}(i,e,n)}function Jp(e,t){const i=vl(t);i&&(i.each(((t,i)=>{e[(Dp+i).toLowerCase()]=t+""})),t.isSilent()&&(e[Dp+"silent"]="true"))}function $p(e){return Wo(e[0]-1)&&Wo(e[1])&&Wo(e[2])&&Wo(e[3]-1)}function ef(e,t,i){if(t&&(!function(e){return Wo(e[4])&&Wo(e[5])}(t)||!$p(t))){const n=i?10:1e4;e.transform=$p(t)?`translate(${Qp(t[4]*n)/n} ${Qp(t[5]*n)/n})`:function(e){return"matrix("+Go(e[0])+","+Go(e[1])+","+Go(e[2])+","+Go(e[3])+","+Yo(e[4])+","+Yo(e[5])+")"}(t)}}function tf(e,t,i){const n=e.points,s=[];for(let e=0;e<n.length;e++)s.push(Qp(n[e][0]*i)/i),s.push(Qp(n[e][1]*i)/i);t.points=s.join(" ")}function nf(e){return!e.smooth}const sf={circle:[function(e){const t=Nn(["cx","cy","r"],(e=>"string"==typeof e?[e,e]:e));return function(e,i,n){for(let s=0;s<t.length;s++){const r=t[s],o=e[r[0]];null!=o&&(i[r[1]]=Qp(o*n)/n)}}}()],polyline:[tf,nf],polygon:[tf,nf]};function rf(e,t){const i=e.style,n=e.shape,s=sf[e.type],r={},o=t.animation;let a="path";const l=e.style.strokePercent,h=t.compress&&ea(e)||4;if(!s||t.willUpdate||s[1]&&!s[1](n)||o&&function(e){const t=e.animators;for(let e=0;e<t.length;e++)if("shape"===t[e].targetName)return!0;return!1}(e)||l<1){const t=!e.path||e.shapeChanged();e.path||e.createPathProxy();const i=e.path;t&&(i.beginPath(),e.buildPath(i,e.shape),e.pathUpdated());const n=i.getVersion(),s=e;let o=s.__svgPathBuilder;s.__svgPathVersion===n&&o&&l===s.__svgPathStrokePercent||(o||(o=s.__svgPathBuilder=new _p),o.reset(h),i.rebuildPath(o,l),o.generateStr(),s.__svgPathVersion=n,s.__svgPathStrokePercent=l),r.d=o.getStr()}else{a=e.type;const t=Math.pow(10,h);s[0](n,r,t)}return ef(r,e.transform),Kp(r,i,e,t),Jp(r,e),t.animation&&Yp(e,r,t),t.emphasis&&function(e,t,i){if(!e.ignore)if(e.isSilent())Xp({"pointer-events":"none"},t,i,!0);else{const n=e.states.emphasis&&e.states.emphasis.style?e.states.emphasis.style:{};let s=n.fill;if(!s){const t=e.style&&e.style.fill,i=e.states.select&&e.states.select.style&&e.states.select.style.fill,n=e.currentStates.indexOf("select")>=0&&i||t;n&&(s=Fo(n))}let r=n.lineWidth;r&&(r/=!n.strokeNoScale&&e.transform?e.transform[0]:1);const o={cursor:"pointer"};s&&(o.fill=s),n.stroke&&(o.stroke=n.stroke),r&&(o["stroke-width"]=r),Xp(o,t,i,!0)}}(e,r,t),Ip(a,e.id+"",r)}function of(e,t){return e instanceof Ch?rf(e,t):e instanceof qh?function(e,t){const i=e.style;let n=i.image;if(n&&!Xn(n)&&(qp(n)?n=n.src:Zp(n)&&(n=n.toDataURL())),!n)return;const s=i.x||0,r=i.y||0,o={href:n,width:i.width,height:i.height};return s&&(o.x=s),r&&(o.y=r),ef(o,e.transform),Kp(o,i,e,t),Jp(o,e),t.animation&&Yp(e,o,t),Ip("image",e.id+"",o)}(e,t):e instanceof vc?function(e,t){const i=e.style;let n=i.text;if(null!=n&&(n+=""),!n||isNaN(i.x)||isNaN(i.y))return;const s=i.font||fn,r=i.x||0,o=function(e,t,i){return"top"===i?e+=t/2:"bottom"===i&&(e-=t/2),e}(i.y||0,Ja(s),i.textBaseline),a={"dominant-baseline":"central","text-anchor":Xo[i.textAlign]||i.textAlign};if(tu(i)){let e="";const t=i.fontStyle,n=$d(i.fontSize);if(!parseFloat(n))return;const s=i.fontFamily||pn,r=i.fontWeight;e+=`font-size:${n};font-family:${s};`,t&&"normal"!==t&&(e+=`font-style:${t};`),r&&"normal"!==r&&(e+=`font-weight:${r};`),a.style=e}else a.style=`font: ${s}`;return n.match(/\s/)&&(a["xml:space"]="preserve"),r&&(a.x=r),o&&(a.y=o),ef(a,e.transform),Kp(a,i,e,t),Jp(a,e),t.animation&&Yp(e,a,t),Ip("text",e.id+"",a,void 0,n)}(e,t):void 0}function af(e,t,i,n){const s=e[i];let r,o={gradientUnits:s.global?"userSpaceOnUse":"objectBoundingBox"};if(Zo(s))r="linearGradient",o.x1=s.x,o.y1=s.y,o.x2=s.x2,o.y2=s.y2;else{if(!Ko(s))return;r="radialGradient",o.cx=is(s.x,.5),o.cy=is(s.y,.5),o.r=is(s.r,.5)}const a=s.colorStops,l=[];for(let e=0,t=a.length;e<t;++e){const t=100*Yo(a[e].offset)+"%",i=a[e].color,{color:n,opacity:s}=Vo(i),r={offset:t};r["stop-color"]=n,s<1&&(r["stop-opacity"]=s),l.push(Ip("stop",e+"",r))}const h=Rp(Ip(r,"",o,l)),c=n.gradientCache;let d=c[h];d||(d=n.zrId+"-g"+n.gradientIdx++,c[h]=d,o.id=d,n.defs[d]=Ip(r,d,o,l)),t[i]=$o(d)}function lf(e,t,i,n){const s=e.style[i],r=e.getBoundingRect(),o={},a=s.repeat,l="no-repeat"===a,h="repeat-x"===a,c="repeat-y"===a;let d,u,p;if(Qo(s)){let t,i=s.imageWidth,n=s.imageHeight;const a=s.image;if(Xn(a)?t=a:qp(a)?t=a.src:Zp(a)&&(t=a.toDataURL()),"undefined"==typeof Image){const e="Image width/height must been given explictly in svg-ssr renderer.";os(i,e),os(n,e)}else if(null==i||null==n){const s=(e,t)=>{if(e){const s=e.elm;let o=i||t.width,a=n||t.height;"pattern"===e.tag&&(h?(a=1,o/=r.width):c&&(o=1,a/=r.height)),e.attrs.width=o,e.attrs.height=a,s&&(s.setAttribute("width",o),s.setAttribute("height",a))}},o=Bd(t,null,e,(e=>{l||s(m,e),s(d,e)}));o&&o.width&&o.height&&(i=i||o.width,n=n||o.height)}d=Ip("image","img",{href:t,width:i,height:n}),o.width=i,o.height=n}else s.svgElement&&(d=Dn(s.svgElement),o.width=s.svgWidth,o.height=s.svgHeight);if(!d)return;l?u=p=1:h?(p=1,u=o.width/r.width):c?(u=1,p=o.height/r.height):o.patternUnits="userSpaceOnUse",null==u||isNaN(u)||(o.width=u),null==p||isNaN(p)||(o.height=p);const f=ta(s);f&&(o.patternTransform=f);let m=Ip("pattern","",o,[d]);const g=Rp(m),v=n.patternCache;let y=v[g];y||(y=n.zrId+"-p"+n.patternIdx++,v[g]=y,o.id=y,m=n.defs[y]=Ip("pattern",y,o,[d])),t[i]=$o(y)}function hf(e,t,i){const{clipPathCache:n,defs:s}=i;let r=n[e.id];if(!r){r=i.zrId+"-c"+i.clipPathIdx++;const t={id:r};n[e.id]=r,s[r]=Ip("clipPath",r,t,[rf(e,i)])}t["clip-path"]=$o(r)}function cf(e){return document.createTextNode(e)}function df(e,t,i){e.insertBefore(t,i)}function uf(e,t){e.removeChild(t)}function pf(e,t){e.appendChild(t)}function ff(e){return e.parentNode}function mf(e){return e.nextSibling}function gf(e,t){e.textContent=t}const vf=58,yf=120,xf=Ip("","");function wf(e){return void 0===e}function bf(e){return void 0!==e}function _f(e,t,i){const n={};for(let s=t;s<=i;++s){const t=e[s].key;void 0!==t&&(n[t]=s)}return n}function Sf(e,t){const i=e.key===t.key;return e.tag===t.tag&&i}function Mf(e){let t;const i=e.children,n=e.tag;if(bf(n)){const s=e.elm=Bp(n);if(Ef(xf,e),Gn(i))for(t=0;t<i.length;++t){const e=i[t];null!=e&&pf(s,Mf(e))}else bf(e.text)&&!qn(e.text)&&pf(s,cf(e.text))}else e.elm=cf(e.text);return e.elm}function Cf(e,t,i,n,s){for(;n<=s;++n){const s=i[n];null!=s&&df(e,Mf(s),t)}}function Af(e,t,i,n){for(;i<=n;++i){const n=t[i];null!=n&&(bf(n.tag)?uf(ff(n.elm),n.elm):uf(e,n.elm))}}function Ef(e,t){let i;const n=t.elm,s=e&&e.attrs||{},r=t.attrs||{};if(s!==r){for(i in r){const e=r[i];s[i]!==e&&(!0===e?n.setAttribute(i,""):!1===e?n.removeAttribute(i):"style"===i?n.style.cssText=e:i.charCodeAt(0)!==yf?n.setAttribute(i,e):"xmlns:xlink"===i||"xmlns"===i?n.setAttributeNS(Pp,i,e):i.charCodeAt(3)===vf?n.setAttributeNS(Op,i,e):i.charCodeAt(5)===vf?n.setAttributeNS(Tp,i,e):n.setAttribute(i,e))}for(i in s)i in r||n.removeAttribute(i)}}function Tf(e,t){const i=t.elm=e.elm,n=e.children,s=t.children;e!==t&&(Ef(e,t),wf(t.text)?bf(n)&&bf(s)?n!==s&&function(e,t,i){let n,s,r,o,a=0,l=0,h=t.length-1,c=t[0],d=t[h],u=i.length-1,p=i[0],f=i[u];for(;a<=h&&l<=u;)null==c?c=t[++a]:null==d?d=t[--h]:null==p?p=i[++l]:null==f?f=i[--u]:Sf(c,p)?(Tf(c,p),c=t[++a],p=i[++l]):Sf(d,f)?(Tf(d,f),d=t[--h],f=i[--u]):Sf(c,f)?(Tf(c,f),df(e,c.elm,mf(d.elm)),c=t[++a],f=i[--u]):Sf(d,p)?(Tf(d,p),df(e,d.elm,c.elm),d=t[--h],p=i[++l]):(wf(n)&&(n=_f(t,a,h)),s=n[p.key],wf(s)?df(e,Mf(p),c.elm):(r=t[s],r.tag!==p.tag?df(e,Mf(p),c.elm):(Tf(r,p),t[s]=void 0,df(e,r.elm,c.elm))),p=i[++l]);(a<=h||l<=u)&&(a>h?(o=null==i[u+1]?null:i[u+1].elm,Cf(e,o,i,l,u)):Af(e,t,a,h))}(i,n,s):bf(s)?(bf(e.text)&&gf(i,""),Cf(i,null,s,0,s.length-1)):bf(n)?Af(i,n,0,n.length-1):bf(e.text)&&gf(i,""):e.text!==t.text&&(bf(n)&&Af(i,n,0,n.length-1),gf(i,t.text)))}let Pf=0;ml("canvas",class{constructor(e,t,i,n){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";const s=!e.nodeName||"CANVAS"===e.nodeName.toUpperCase();this._opts=i=In({},i||{}),this.dpr=i.devicePixelRatio||ka,this._singleCanvas=s,this.root=e,e.style&&(fs(e),e.innerHTML=""),this.storage=t;const r=this._zlevelList;this._prevDisplayList=[];const o=this._layers;if(s){const t=e;let n=t.width,s=t.height;null!=i.width&&(n=i.width),null!=i.height&&(s=i.height),this.dpr=i.devicePixelRatio||1,t.width=n*this.dpr,t.height=s*this.dpr,this._width=n,this._height=s;const a=new pp(t,this,this.dpr);a.__builtin__=!0,a.initContext(),o[314159]=a,a.zlevel=mp,r.push(mp),this._domRoot=e}else{this._width=qu(e,0,i),this._height=qu(e,1,i);const t=this._domRoot=function(e,t){const i=document.createElement("div");return i.style.cssText=["position:relative","width:"+e+"px","height:"+t+"px","padding:0","margin:0","border-width:0"].join(";")+";",i}(this._width,this._height);e.appendChild(t)}}getType(){return"canvas"}isSingleCanvas(){return this._singleCanvas}getViewportRoot(){return this._domRoot}getViewportRootOffset(){const e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}}refresh(e){const t=this.storage.getDisplayList(!0),i=this._prevDisplayList,n=this._zlevelList;this._redrawId=Math.random(),this._paintList(t,i,e,this._redrawId);for(let e=0;e<n.length;e++){const t=n[e],i=this._layers[t];if(!i.__builtin__&&i.refresh){const t=0===e?this._backgroundColor:null;i.refresh(t)}}return this._opts.useDirtyRect&&(this._prevDisplayList=t.slice()),this}refreshHover(){this._paintHoverList(this.storage.getDisplayList(!1))}_paintHoverList(e){let t=e.length,i=this._hoverlayer;if(i&&i.clear(),!t)return;const n={inHover:!0,viewWidth:this._width,viewHeight:this._height};let s;for(let r=0;r<t;r++){const o=e[r];o.__inHover&&(i||(i=this._hoverlayer=this.getLayer(fp)),s||(s=i.ctx,s.save()),dp(s,o,n,r===t-1))}s&&s.restore()}getHoverLayer(){return this.getLayer(fp)}paintOne(e,t){!function(e,t){dp(e,t,{inHover:!1,viewWidth:0,viewHeight:0},!0)}(e,t)}_paintList(e,t,i,n){if(this._redrawId!==n)return;i=i||!1,this._updateLayerStatus(e);const{finished:s,needsRefreshHover:r}=this._doPaintList(e,t,i);if(this._needsManuallyCompositing&&this._compositeManually(),r&&this._paintHoverList(e),s)this.eachLayer((e=>{e.afterBrush&&e.afterBrush()}));else{const s=this;Nr((function(){s._paintList(e,t,i,n)}))}}_compositeManually(){const e=this.getLayer(mp).ctx,t=this._domRoot.width,i=this._domRoot.height;e.clearRect(0,0,t,i),this.eachBuiltinLayer((function(n){n.virtual&&e.drawImage(n.dom,0,0,t,i)}))}_doPaintList(e,t,i){const n=[],s=this._opts.useDirtyRect;for(let e=0;e<this._zlevelList.length;e++){const t=this._zlevelList[e],s=this._layers[t];s.__builtin__&&s!==this._hoverlayer&&(s.__dirty||i)&&n.push(s)}let r=!0,o=!1;for(let l=0;l<n.length;l++){const h=n[l],c=h.ctx,d=s&&h.createRepaintRects(e,t,this._width,this._height);let u=i?h.__startIndex:h.__drawIndex;const p=!i&&h.incremental&&Date.now,f=p&&Date.now(),m=h.zlevel===this._zlevelList[0]?this._backgroundColor:null;if(h.__startIndex===h.__endIndex)h.clear(!1,m,d);else if(u===h.__startIndex){const t=e[u];t.incremental&&t.notClear&&!i||h.clear(!1,m,d)}let g;-1===u&&(console.error("For some unknown reason. drawIndex is -1"),u=h.__startIndex);const v=t=>{const i={inHover:!1,allClipped:!1,prevEl:null,viewWidth:this._width,viewHeight:this._height};for(g=u;g<h.__endIndex;g++){const n=e[g];if(n.__inHover&&(o=!0),this._doPaintEl(n,h,s,t,i,g===h.__endIndex-1),p&&Date.now()-f>15)break}i.prevElClipPaths&&c.restore()};if(d)if(0===d.length)g=h.__endIndex;else{const e=this.dpr;for(var a=0;a<d.length;++a){const t=d[a];c.save(),c.beginPath(),c.rect(t.x*e,t.y*e,t.width*e,t.height*e),c.clip(),v(t),c.restore()}}else c.save(),v(),c.restore();h.__drawIndex=g,h.__drawIndex<h.__endIndex&&(r=!1)}return dn.wxa&&Fn(this._layers,(function(e){e&&e.ctx&&e.ctx.draw&&e.ctx.draw()})),{finished:r,needsRefreshHover:o}}_doPaintEl(e,t,i,n,s,r){const o=t.ctx;if(i){const t=e.getPaintRect();(!n||t&&t.intersect(n))&&(dp(o,e,s,r),e.setPrevPaintRect(t))}else dp(o,e,s,r)}getLayer(e,t){this._singleCanvas&&!this._needsManuallyCompositing&&(e=mp);let i=this._layers[e];return i||(i=new pp("zr_"+e,this,this.dpr),i.zlevel=e,i.__builtin__=!0,this._layerConfig[e]?Bn(i,this._layerConfig[e],!0):this._layerConfig[e-gp]&&Bn(i,this._layerConfig[e-gp],!0),t&&(i.virtual=t),this.insertLayer(e,i),i.initContext()),i}insertLayer(e,t){const i=this._layers,n=this._zlevelList,s=n.length,r=this._domRoot;let o=null,a=-1;if(!i[e]&&function(e){return!!e&&(!!e.__builtin__||"function"==typeof e.resize&&"function"==typeof e.refresh)}(t)){if(s>0&&e>n[0]){for(a=0;a<s-1&&!(n[a]<e&&n[a+1]>e);a++);o=i[n[a]]}if(n.splice(a+1,0,e),i[e]=t,!t.virtual)if(o){const e=o.dom;e.nextSibling?r.insertBefore(t.dom,e.nextSibling):r.appendChild(t.dom)}else r.firstChild?r.insertBefore(t.dom,r.firstChild):r.appendChild(t.dom);t.painter||(t.painter=this)}}eachLayer(e,t){const i=this._zlevelList;for(let n=0;n<i.length;n++){const s=i[n];e.call(t,this._layers[s],s)}}eachBuiltinLayer(e,t){const i=this._zlevelList;for(let n=0;n<i.length;n++){const s=i[n],r=this._layers[s];r.__builtin__&&e.call(t,r,s)}}eachOtherLayer(e,t){const i=this._zlevelList;for(let n=0;n<i.length;n++){const s=i[n],r=this._layers[s];r.__builtin__||e.call(t,r,s)}}getLayers(){return this._layers}_updateLayerStatus(e){function t(e){s&&(s.__endIndex!==e&&(s.__dirty=!0),s.__endIndex=e)}if(this.eachBuiltinLayer((function(e,t){e.__dirty=e.__used=!1})),this._singleCanvas)for(let t=1;t<e.length;t++){const i=e[t];if(i.zlevel!==e[t-1].zlevel||i.incremental){this._needsManuallyCompositing=!0;break}}let i,n,s=null,r=0;for(n=0;n<e.length;n++){const o=e[n],a=o.zlevel;let l;i!==a&&(i=a,r=0),o.incremental?(l=this.getLayer(a+.001,this._needsManuallyCompositing),l.incremental=!0,r=1):l=this.getLayer(a+(r>0?gp:0),this._needsManuallyCompositing),l.__builtin__||On("ZLevel "+a+" has been used by unkown layer "+l.id),l!==s&&(l.__used=!0,l.__startIndex!==n&&(l.__dirty=!0),l.__startIndex=n,l.incremental?l.__drawIndex=-1:l.__drawIndex=n,t(n),s=l),1&o.__dirty&&!o.__inHover&&(l.__dirty=!0,l.incremental&&l.__drawIndex<0&&(l.__drawIndex=n))}t(n),this.eachBuiltinLayer((function(e,t){!e.__used&&e.getElementCount()>0&&(e.__dirty=!0,e.__startIndex=e.__endIndex=e.__drawIndex=0),e.__dirty&&e.__drawIndex<0&&(e.__drawIndex=e.__startIndex)}))}clear(){return this.eachBuiltinLayer(this._clearLayer),this}_clearLayer(e){e.clear()}setBackgroundColor(e){this._backgroundColor=e,Fn(this._layers,(e=>{e.setUnpainted()}))}configLayer(e,t){if(t){const i=this._layerConfig;i[e]?Bn(i[e],t,!0):i[e]=t;for(let t=0;t<this._zlevelList.length;t++){const n=this._zlevelList[t];n!==e&&n!==e+gp||Bn(this._layers[n],i[e],!0)}}}delLayer(e){const t=this._layers,i=this._zlevelList,n=t[e];n&&(n.dom.parentNode.removeChild(n.dom),delete t[e],i.splice(Ln(i,e),1))}resize(e,t){if(this._domRoot.style){const i=this._domRoot;i.style.display="none";const n=this._opts,s=this.root;if(null!=e&&(n.width=e),null!=t&&(n.height=t),e=qu(s,0,n),t=qu(s,1,n),i.style.display="",this._width!==e||t!==this._height){i.style.width=e+"px",i.style.height=t+"px";for(let i in this._layers)this._layers.hasOwnProperty(i)&&this._layers[i].resize(e,t);this.refresh(!0)}this._width=e,this._height=t}else{if(null==e||null==t)return;this._width=e,this._height=t,this.getLayer(mp).resize(e,t)}return this}clearLayer(e){const t=this._layers[e];t&&t.clear()}dispose(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null}getRenderedCanvas(e){if(e=e||{},this._singleCanvas&&!this._compositeManually)return this._layers[314159].dom;const t=new pp("image",this,e.pixelRatio||this.dpr);t.initContext(),t.clear(!1,e.backgroundColor||this._backgroundColor);const i=t.ctx;if(e.pixelRatio<=this.dpr){this.refresh();const e=t.dom.width,n=t.dom.height;this.eachLayer((function(t){t.__builtin__?i.drawImage(t.dom,0,0,e,n):t.renderToCanvas&&(i.save(),t.renderToCanvas(i),i.restore())}))}else{const e={inHover:!1,viewWidth:this._width,viewHeight:this._height},t=this.storage.getDisplayList(!0);for(let n=0,s=t.length;n<s;n++){const r=t[n];dp(i,r,e,n===s-1)}}return t.dom}getWidth(){return this._width}getHeight(){return this._height}}),ml("svg",class{constructor(e,t,i){if(this.type="svg",this.refreshHover=function(){},this.configLayer=function(){},this.storage=t,this._opts=i=In({},i),this.root=e,this._id="zr"+Pf++,this._oldVNode=Lp(i.width,i.height),e&&!i.ssr){const t=this._viewport=document.createElement("div");t.style.cssText="position:relative;overflow:hidden";const i=this._svgDom=this._oldVNode.elm=Bp("svg");Ef(null,this._oldVNode),t.appendChild(i),e.appendChild(t)}this.resize(i.width,i.height)}getType(){return this.type}getViewportRoot(){return this._viewport}getViewportRootOffset(){const e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}}getSvgDom(){return this._svgDom}refresh(){if(this.root){const e=this.renderToVNode({willUpdate:!0});e.attrs.style="position:absolute;left:0;top:0;user-select:none",function(e,t){if(Sf(e,t))Tf(e,t);else{const i=e.elm,n=ff(i);Mf(t),null!==n&&(df(n,t.elm,mf(i)),Af(n,[e],0,0))}}(this._oldVNode,e),this._oldVNode=e}}renderOneToVNode(e){return of(e,kp(this._id))}renderToVNode(e){e=e||{};const t=this.storage.getDisplayList(!0),i=this._width,n=this._height,s=kp(this._id);s.animation=e.animation,s.willUpdate=e.willUpdate,s.compress=e.compress,s.emphasis=e.emphasis;const r=[],o=this._bgVNode=function(e,t,i,n){let s;if(i&&"none"!==i)if(s=Ip("rect","bg",{width:e,height:t,x:"0",y:"0"}),Jo(i))af({fill:i},s.attrs,"fill",n);else if(qo(i))lf({style:{fill:i},dirty:gs,getBoundingRect:()=>({width:e,height:t})},s.attrs,"fill",n);else{const{color:e,opacity:t}=Vo(i);s.attrs.fill=e,t<1&&(s.attrs["fill-opacity"]=t)}return s}(i,n,this._backgroundColor,s);o&&r.push(o);const a=e.compress?null:this._mainVNode=Ip("g","main",{},[]);this._paintList(t,s,a?a.children:r),a&&r.push(a);const l=Nn(Hn(s.defs),(e=>s.defs[e]));if(l.length&&r.push(Ip("defs","defs",{},l)),e.animation){const e=function(e,t,i){const n=(i=i||{}).newline?"\n":"",s=` {${n}`,r=`${n}}`,o=Nn(Hn(e),(t=>t+s+Nn(Hn(e[t]),(i=>`${i}:${e[t][i]};`)).join(n)+r)).join(n),a=Nn(Hn(t),(e=>`@keyframes ${e}${s}`+Nn(Hn(t[e]),(i=>i+s+Nn(Hn(t[e][i]),(n=>{let s=t[e][i][n];return"d"===n&&(s=`path("${s}")`),`${n}:${s};`})).join(n)+r)).join(n)+r)).join(n);return o||a?["<![CDATA[",o,a,"]]>"].join(n):""}(s.cssNodes,s.cssAnims,{newline:!0});if(e){const t=Ip("style","stl",{},[],e);r.push(t)}}return Lp(i,n,r,e.useViewBox)}renderToString(e){return e=e||{},Rp(this.renderToVNode({animation:is(e.cssAnimation,!0),emphasis:is(e.cssEmphasis,!0),willUpdate:!1,compress:!0,useViewBox:is(e.useViewBox,!0)}),{newline:!0})}setBackgroundColor(e){this._backgroundColor=e}getSvgRoot(){return this._mainVNode&&this._mainVNode.elm}_paintList(e,t,i){const n=e.length,s=[];let r,o,a=0,l=0;for(let h=0;h<n;h++){const n=e[h];if(!n.invisible){const e=n.__clipPaths,h=e&&e.length||0,c=o&&o.length||0;let d;for(d=Math.max(h-1,c-1);d>=0&&(!e||!o||e[d]!==o[d]);d--);for(let e=c-1;e>d;e--)a--,r=s[a-1];for(let n=d+1;n<h;n++){const o={};hf(e[n],o,t);const h=Ip("g","clip-g-"+l++,o,[]);(r?r.children:i).push(h),s[a++]=h,r=h}o=e;const u=of(n,t);u&&(r?r.children:i).push(u)}}}resize(e,t){const i=this._opts,n=this.root,s=this._viewport;if(null!=e&&(i.width=e),null!=t&&(i.height=t),n&&s&&(s.style.display="none",e=qu(n,0,i),t=qu(n,1,i),s.style.display=""),this._width!==e||this._height!==t){if(this._width=e,this._height=t,s){const i=s.style;i.width=e+"px",i.height=t+"px"}if(qo(this._backgroundColor))this.refresh();else{const i=this._svgDom;i&&(i.setAttribute("width",e),i.setAttribute("height",t));const n=this._bgVNode&&this._bgVNode.elm;n&&(n.setAttribute("width",e),n.setAttribute("height",t))}}}getWidth(){return this._width}getHeight(){return this._height}dispose(){this.root&&(this.root.innerHTML=""),this._svgDom=this._viewport=this.storage=this._oldVNode=this._bgVNode=this._mainVNode=null}clear(){this._svgDom&&(this._svgDom.innerHTML=null),this._oldVNode=null}toDataURL(e){let t=this.renderToString();const i="data:image/svg+xml;";return e?(t=ia(t),t&&i+"base64,"+t):i+"charset=UTF-8,"+encodeURIComponent(t)}});var Of=Object.freeze({__proto__:null,Arc:hu,ArcShape:lu,BezierCurve:pu,BezierCurveShape:du,BoundingRect:wr,Circle:Kh,CircleShape:Zh,CompoundPath:Td,Displayable:Sl,Droplet:mu,DropletShape:fu,Element:rl,Ellipse:sc,EllipseShape:nc,Group:cl,Heart:vu,HeartShape:gu,Image:qh,IncrementalDisplayable:class extends Sl{constructor(){super(...arguments),this.notClear=!0,this.incremental=!0,this._displayables=[],this._temporaryDisplayables=[],this._cursor=0}traverse(e,t){e.call(t,this)}useStyle(){this.style={}}getCursor(){return this._cursor}innerAfterBrush(){this._cursor=this._displayables.length}clearDisplaybles(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1}clearTemporalDisplayables(){this._temporaryDisplayables=[]}addDisplayable(e,t){t?this._temporaryDisplayables.push(e):this._displayables.push(e),this.markRedraw()}addDisplayables(e,t){t=t||!1;for(let i=0;i<e.length;i++)this.addDisplayable(e[i],t)}getDisplayables(){return this._displayables}getTemporalDisplayables(){return this._temporaryDisplayables}eachPendingDisplayable(e){for(let t=this._cursor;t<this._displayables.length;t++)e&&e(this._displayables[t]);for(let t=0;t<this._temporaryDisplayables.length;t++)e&&e(this._temporaryDisplayables[t])}update(){this.updateTransform();for(let e=this._cursor;e<this._displayables.length;e++){const t=this._displayables[e];t.parent=this,t.update(),t.parent=null}for(let e=0;e<this._temporaryDisplayables.length;e++){const t=this._temporaryDisplayables[e];t.parent=this,t.update(),t.parent=null}}getBoundingRect(){if(!this._rect){const e=new wr(1/0,1/0,-1/0,-1/0);for(let t=0;t<this._displayables.length;t++){const i=this._displayables[t],n=i.getBoundingRect().clone();i.needLocalTransform()&&n.applyTransform(i.getLocalTransform(Pd)),e.union(n)}this._rect=e}return this._rect}contain(e,t){const i=this.transformCoordToLocal(e,t);if(this.getBoundingRect().contain(i[0],i[1]))for(let i=0;i<this._displayables.length;i++)if(this._displayables[i].contain(e,t))return!0;return!1}},Isogon:_u,IsogonShape:bu,Line:ac,LineShape:oc,LinearGradient:fc,OrientedBoundingRect:Hu,Path:Ch,Pattern:class{constructor(e,t){this.image=e,this.repeat=t,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1}},Point:dr,Polygon:cc,PolygonShape:hc,Polyline:uc,PolylineShape:dc,RadialGradient:mc,Rect:ic,RectShape:ec,Ring:Mu,RingShape:Su,Rose:Pu,RoseShape:Tu,Sector:Kc,SectorShape:Zc,Star:Ru,StarShape:Iu,TSpan:vc,Text:qd,Trochoid:Uu,TrochoidShape:zu,color:No,dispose:function(e){e.dispose()},disposeAll:function(){for(let e in ul)ul.hasOwnProperty(e)&&ul[e].dispose();ul={}},getElementSSRData:vl,getInstance:function(e){return ul[e]},init:fl,matrix:cr,measureBoundingRect:Gu,morph:Ed,parseSVG:function(e,t){return(new Sc).parse(e,t)},path:Yh,registerPainter:ml,registerSSRDataGetter:function(e){gl=e},setPlatformAPI:function(e){for(let t in gn)e[t]&&(gn[t]=e[t])},showDebugDirtyRect:function(e,t){t=t||{};const i=e.painter;if(!i.getLayers)throw new Error("Debug dirty rect can only been used on canvas renderer.");if(i.isSingleCanvas())throw new Error("Debug dirty rect can only been used on render2d inited with container.");const n=document.createElement("div");n.style.cssText="\nposition:absolute;\nleft:0;\ntop:0;\nright:0;\nbottom:0;\npointer-events:none;\n",n.className="ec-debug-dirty-rect-container";const s=[],r=e.dom;r.appendChild(n),"static"===getComputedStyle(r).position&&(r.style.position="relative"),e.on("rendered",(function(){if(i.getLayers){let e=0;i.eachBuiltinLayer((i=>{if(!i.debugGetPaintRects)return;const r=i.debugGetPaintRects();for(let i=0;i<r.length;i++)r[i].width&&r[i].height&&(s[e]||(s[e]=new Wu(t.style),n.appendChild(s[e].dom)),s[e].show(t.autoHideDelay),s[e].update(r[i]),e++)}));for(let t=e;t<s.length;t++)s[t].hide()}}))},util:ys,vector:zs});let Df;class Bf{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Df,!e&&Df&&(this.index=(Df.scopes||(Df.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const t=Df;try{return Df=this,e()}finally{Df=t}}}on(){Df=this}off(){Df=this.parent}stop(e){if(this._active){let t,i;for(t=0,i=this.effects.length;t<i;t++)this.effects[t].stop();for(t=0,i=this.cleanups.length;t<i;t++)this.cleanups[t]();if(this.scopes)for(t=0,i=this.scopes.length;t<i;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0,this._active=!1}}}function If(e){return new Bf(e)}function Rf(e,t=Df){t&&t.active&&t.effects.push(e)}function kf(e,t){const i=Object.create(null),n=e.split(",");for(let e=0;e<n.length;e++)i[n[e]]=!0;return t?e=>!!i[e.toLowerCase()]:e=>!!i[e]}const Lf={},zf=()=>{},Uf=Object.assign,Ff=Object.prototype.hasOwnProperty,Nf=(e,t)=>Ff.call(e,t),jf=Array.isArray,Vf=e=>"[object Map]"===qf(e),Hf=e=>"[object Set]"===qf(e),Wf=e=>"function"==typeof e,Gf=e=>"symbol"==typeof e,Yf=e=>null!==e&&"object"==typeof e,Xf=e=>(Yf(e)||Wf(e))&&Wf(e.then)&&Wf(e.catch),Qf=Object.prototype.toString,qf=e=>Qf.call(e),Zf=e=>qf(e).slice(8,-1),Kf=e=>"[object Object]"===qf(e),Jf=e=>"string"==typeof e&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,$f=(e,t)=>!Object.is(e,t),em=e=>{const t=new Set(e);return t.w=0,t.n=0,t},tm=e=>(e.w&rm)>0,im=e=>(e.n&rm)>0,nm=new WeakMap;let sm=0,rm=1;const om=30;let am;const lm=Symbol(""),hm=Symbol("");class cm{constructor(e,t=null,i){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,Rf(this,i)}run(){if(!this.active)return this.fn();let e=am;const t=um;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=am,am=this,um=!0,rm=1<<++sm,sm<=om?(({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=rm})(this):dm(this),this.fn()}finally{sm<=om&&(e=>{const{deps:t}=e;if(t.length){let i=0;for(let n=0;n<t.length;n++){const s=t[n];tm(s)&&!im(s)?s.delete(e):t[i++]=s,s.w&=~rm,s.n&=~rm}t.length=i}})(this),rm=1<<--sm,am=this.parent,um=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){am===this?this.deferStop=!0:this.active&&(dm(this),this.onStop&&this.onStop(),this.active=!1)}}function dm(e){const{deps:t}=e;if(t.length){for(let i=0;i<t.length;i++)t[i].delete(e);t.length=0}}let um=!0;const pm=[];function fm(){pm.push(um),um=!1}function mm(){const e=pm.pop();um=void 0===e||e}function gm(e,t,i){if(um&&am){let t=nm.get(e);t||nm.set(e,t=new Map);let n=t.get(i);n||t.set(i,n=em()),vm(n)}}function vm(e){let t=!1;sm<=om?im(e)||(e.n|=rm,t=!tm(e)):t=!e.has(am),t&&(e.add(am),am.deps.push(e))}function ym(e,t,i,n){const s=nm.get(e);if(!s)return;let r=[];if("clear"===t)r=[...s.values()];else if("length"===i&&jf(e)){const e=Number(n);s.forEach(((t,i)=>{("length"===i||i>=e)&&r.push(t)}))}else switch(void 0!==i&&r.push(s.get(i)),t){case"add":jf(e)?Jf(i)&&r.push(s.get("length")):(r.push(s.get(lm)),Vf(e)&&r.push(s.get(hm)));break;case"delete":jf(e)||(r.push(s.get(lm)),Vf(e)&&r.push(s.get(hm)));break;case"set":Vf(e)&&r.push(s.get(lm))}if(1===r.length)r[0]&&xm(r[0]);else{const e=[];for(const t of r)t&&e.push(...t);xm(em(e))}}function xm(e){const t=jf(e)?e:[...e];for(const e of t)e.computed&&wm(e);for(const e of t)e.computed||wm(e)}function wm(e){(e!==am||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const bm=kf("__proto__,__v_isRef,__isVue"),_m=new Set(Object.getOwnPropertyNames(Symbol).filter((e=>"arguments"!==e&&"caller"!==e)).map((e=>Symbol[e])).filter(Gf)),Sm=Om(),Mm=Om(!1,!0),Cm=Om(!0),Am=Om(!0,!0),Em=Tm();function Tm(){const e={};return["includes","indexOf","lastIndexOf"].forEach((t=>{e[t]=function(...e){const i=mg(this);for(let e=0,t=this.length;e<t;e++)gm(i,0,e+"");const n=i[t](...e);return-1===n||!1===n?i[t](...e.map(mg)):n}})),["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){fm();const i=mg(this)[t].apply(this,e);return mm(),i}})),e}function Pm(e){const t=mg(this);return gm(t,0,e),t.hasOwnProperty(e)}function Om(e=!1,t=!1){return function(i,n,s){if("__v_isReactive"===n)return!e;if("__v_isReadonly"===n)return e;if("__v_isShallow"===n)return t;if("__v_raw"===n&&s===(e?t?ag:og:t?rg:sg).get(i))return i;const r=jf(i);if(!e){if(r&&Nf(Em,n))return Reflect.get(Em,n,s);if("hasOwnProperty"===n)return Pm}const o=Reflect.get(i,n,s);return(Gf(n)?_m.has(n):bm(n))?o:(e||gm(i,0,n),t?o:wg(o)?r&&Jf(n)?o:o.value:Yf(o)?e?cg(o):lg(o):o)}}function Dm(e=!1){return function(t,i,n,s){let r=t[i];if(pg(r)&&wg(r)&&!wg(n))return!1;if(!e&&(fg(n)||pg(n)||(r=mg(r),n=mg(n)),!jf(t)&&wg(r)&&!wg(n)))return r.value=n,!0;const o=jf(t)&&Jf(i)?Number(i)<t.length:Nf(t,i),a=Reflect.set(t,i,n,s);return t===mg(s)&&(o?$f(n,r)&&ym(t,"set",i,n):ym(t,"add",i,n)),a}}const Bm={get:Sm,set:Dm(),deleteProperty:function(e,t){const i=Nf(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&i&&ym(e,"delete",t,void 0),n},has:function(e,t){const i=Reflect.has(e,t);return Gf(t)&&_m.has(t)||gm(e,0,t),i},ownKeys:function(e){return gm(e,0,jf(e)?"length":lm),Reflect.ownKeys(e)}},Im={get:Cm,set:(e,t)=>!0,deleteProperty:(e,t)=>!0},Rm=Uf({},Bm,{get:Mm,set:Dm(!0)}),km=Uf({},Im,{get:Am}),Lm=e=>e,zm=e=>Reflect.getPrototypeOf(e);function Um(e,t,i=!1,n=!1){const s=mg(e=e.__v_raw),r=mg(t);i||($f(t,r)&&gm(s,0,t),gm(s,0,r));const{has:o}=zm(s),a=n?Lm:i?vg:gg;return o.call(s,t)?a(e.get(t)):o.call(s,r)?a(e.get(r)):void(e!==s&&e.get(t))}function Fm(e,t=!1){const i=this.__v_raw,n=mg(i),s=mg(e);return t||($f(e,s)&&gm(n,0,e),gm(n,0,s)),e===s?i.has(e):i.has(e)||i.has(s)}function Nm(e,t=!1){return e=e.__v_raw,!t&&gm(mg(e),0,lm),Reflect.get(e,"size",e)}function jm(e){e=mg(e);const t=mg(this);return zm(t).has.call(t,e)||(t.add(e),ym(t,"add",e,e)),this}function Vm(e,t){t=mg(t);const i=mg(this),{has:n,get:s}=zm(i);let r=n.call(i,e);r||(e=mg(e),r=n.call(i,e));const o=s.call(i,e);return i.set(e,t),r?$f(t,o)&&ym(i,"set",e,t):ym(i,"add",e,t),this}function Hm(e){const t=mg(this),{has:i}=zm(t);let n=i.call(t,e);n||(e=mg(e),n=i.call(t,e));const s=t.delete(e);return n&&ym(t,"delete",e,void 0),s}function Wm(){const e=mg(this),t=0!==e.size,i=e.clear();return t&&ym(e,"clear",void 0,void 0),i}function Gm(e,t){return function(i,n){const s=this,r=s.__v_raw,o=mg(r),a=t?Lm:e?vg:gg;return!e&&gm(o,0,lm),r.forEach(((e,t)=>i.call(n,a(e),a(t),s)))}}function Ym(e,t,i){return function(...n){const s=this.__v_raw,r=mg(s),o=Vf(r),a="entries"===e||e===Symbol.iterator&&o,l="keys"===e&&o,h=s[e](...n),c=i?Lm:t?vg:gg;return!t&&gm(r,0,l?hm:lm),{next(){const{value:e,done:t}=h.next();return t?{value:e,done:t}:{value:a?[c(e[0]),c(e[1])]:c(e),done:t}},[Symbol.iterator](){return this}}}}function Xm(e){return function(...t){return"delete"!==e&&this}}function Qm(){const e={get(e){return Um(this,e)},get size(){return Nm(this)},has:Fm,add:jm,set:Vm,delete:Hm,clear:Wm,forEach:Gm(!1,!1)},t={get(e){return Um(this,e,!1,!0)},get size(){return Nm(this)},has:Fm,add:jm,set:Vm,delete:Hm,clear:Wm,forEach:Gm(!1,!0)},i={get(e){return Um(this,e,!0)},get size(){return Nm(this,!0)},has(e){return Fm.call(this,e,!0)},add:Xm("add"),set:Xm("set"),delete:Xm("delete"),clear:Xm("clear"),forEach:Gm(!0,!1)},n={get(e){return Um(this,e,!0,!0)},get size(){return Nm(this,!0)},has(e){return Fm.call(this,e,!0)},add:Xm("add"),set:Xm("set"),delete:Xm("delete"),clear:Xm("clear"),forEach:Gm(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach((s=>{e[s]=Ym(s,!1,!1),i[s]=Ym(s,!0,!1),t[s]=Ym(s,!1,!0),n[s]=Ym(s,!0,!0)})),[e,i,t,n]}const[qm,Zm,Km,Jm]=Qm();function $m(e,t){const i=t?e?Jm:Km:e?Zm:qm;return(t,n,s)=>"__v_isReactive"===n?!e:"__v_isReadonly"===n?e:"__v_raw"===n?t:Reflect.get(Nf(i,n)&&n in t?i:t,n,s)}const eg={get:$m(!1,!1)},tg={get:$m(!1,!0)},ig={get:$m(!0,!1)},ng={get:$m(!0,!0)},sg=new WeakMap,rg=new WeakMap,og=new WeakMap,ag=new WeakMap;function lg(e){return pg(e)?e:dg(e,!1,Bm,eg,sg)}function hg(e){return dg(e,!1,Rm,tg,rg)}function cg(e){return dg(e,!0,Im,ig,og)}function dg(e,t,i,n,s){if(!Yf(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const r=s.get(e);if(r)return r;const o=(a=e).__v_skip||!Object.isExtensible(a)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(Zf(a));var a;if(0===o)return e;const l=new Proxy(e,2===o?n:i);return s.set(e,l),l}function ug(e){return pg(e)?ug(e.__v_raw):!(!e||!e.__v_isReactive)}function pg(e){return!(!e||!e.__v_isReadonly)}function fg(e){return!(!e||!e.__v_isShallow)}function mg(e){const t=e&&e.__v_raw;return t?mg(t):e}const gg=e=>Yf(e)?lg(e):e,vg=e=>Yf(e)?cg(e):e;function yg(e){um&&am&&vm((e=mg(e)).dep||(e.dep=em()))}function xg(e,t){const i=(e=mg(e)).dep;i&&xm(i)}function wg(e){return!(!e||!0!==e.__v_isRef)}function bg(e){return _g(e,!1)}function _g(e,t){return wg(e)?e:new Sg(e,t)}class Sg{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:mg(e),this._value=t?e:gg(e)}get value(){return yg(this),this._value}set value(e){const t=this.__v_isShallow||fg(e)||pg(e);e=t?e:mg(e),$f(e,this._rawValue)&&(this._rawValue=e,this._value=t?e:gg(e),xg(this))}}function Mg(e){return wg(e)?e.value:e}const Cg={get:(e,t,i)=>Mg(Reflect.get(e,t,i)),set:(e,t,i,n)=>{const s=e[t];return wg(s)&&!wg(i)?(s.value=i,!0):Reflect.set(e,t,i,n)}};class Ag{constructor(e){this.dep=void 0,this.__v_isRef=!0;const{get:t,set:i}=e((()=>yg(this)),(()=>xg(this)));this._get=t,this._set=i}get value(){return this._get()}set value(e){this._set(e)}}class Eg{constructor(e,t,i){this._object=e,this._key=t,this._defaultValue=i,this.__v_isRef=!0}get value(){const e=this._object[this._key];return void 0===e?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return function(e,t){var i;return null===(i=nm.get(e))||void 0===i?void 0:i.get(t)}(mg(this._object),this._key)}}class Tg{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function Pg(e,t,i){const n=e[t];return wg(n)?n:new Eg(e,t,i)}var Og,Dg;class Bg{constructor(e,t,i,n){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[Og]=!1,this._dirty=!0,this.effect=new cm(e,(()=>{this._dirty||(this._dirty=!0,xg(this))})),this.effect.computed=this,this.effect.active=this._cacheable=!n,this.__v_isReadonly=i}get value(){const e=mg(this);return yg(e),!e._dirty&&e._cacheable||(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}Og="__v_isReadonly";const Ig=Promise.resolve(),Rg=[];let kg=!1;const Lg=()=>{for(let e=0;e<Rg.length;e++)Rg[e]();Rg.length=0,kg=!1};class zg{constructor(e){let t;this.dep=void 0,this._dirty=!0,this.__v_isRef=!0,this[Dg]=!0;let i=!1,n=!1;this.effect=new cm(e,(e=>{if(this.dep){if(e)t=this._value,i=!0;else if(!n){const e=i?t:this._value;n=!0,i=!1,s=()=>{this.effect.active&&this._get()!==e&&xg(this),n=!1},Rg.push(s),kg||(kg=!0,Ig.then(Lg))}for(const e of this.dep)e.computed instanceof zg&&e.scheduler(!0)}var s;this._dirty=!0})),this.effect.computed=this}_get(){return this._dirty?(this._dirty=!1,this._value=this.effect.run()):this._value}get value(){return yg(this),mg(this)._get()}}function Ug(e,t,i,n){let s;try{s=n?e(...n):e()}catch(e){Ng(e)}return s}function Fg(e,t,i,n){if(Wf(e)){const t=Ug(e,0,0,n);return t&&Xf(t)&&t.catch((e=>{Ng(e)})),t}const s=[];for(let r=0;r<e.length;r++)s.push(Fg(e[r],t,i,n));return s}function Ng(e,t,i,n=!0){!function(e,t,i,n=!0){console.error(e)}(e,0,0,n)}Dg="__v_isReadonly";let jg=!1,Vg=!1;const Hg=[];let Wg=0;const Gg=[];let Yg=null,Xg=0;const Qg=Promise.resolve(),qg=e=>null==e.id?1/0:e.id,Zg=(e,t)=>{const i=qg(e)-qg(t);if(0===i){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return i};function Kg(e){Vg=!1,jg=!0,Hg.sort(Zg);try{for(Wg=0;Wg<Hg.length;Wg++){const e=Hg[Wg];e&&!1!==e.active&&Ug(e)}}finally{Wg=0,Hg.length=0,function(e){if(Gg.length){const e=[...new Set(Gg)];if(Gg.length=0,Yg)return void Yg.push(...e);for(Yg=e,Yg.sort(((e,t)=>qg(e)-qg(t))),Xg=0;Xg<Yg.length;Xg++)Yg[Xg]();Yg=null,Xg=0}}(),jg=!1,(Hg.length||Gg.length)&&Kg()}}function Jg(e,t){return tv(e,null,t)}const $g={};function ev(e,t,i){return tv(e,t,i)}function tv(e,t,{immediate:i,deep:n,flush:s}=Lf){let r,o,a=!1,l=!1;if(wg(e)?(r=()=>e.value,a=fg(e)):ug(e)?(r=()=>e,n=!0):jf(e)?(l=!0,a=e.some((e=>ug(e)||fg(e))),r=()=>e.map((e=>wg(e)?e.value:ug(e)?iv(e):Wf(e)?Ug(e):void 0))):r=Wf(e)?t?()=>Ug(e):()=>(o&&o(),Fg(e,null,3,[h])):zf,t&&n){const e=r;r=()=>iv(e())}const h=e=>{o=p.onStop=()=>{Ug(e)}};let c=l?new Array(e.length).fill($g):$g;const d=()=>{if(p.active)if(t){const e=p.run();(n||a||(l?e.some(((e,t)=>$f(e,c[t]))):$f(e,c)))&&(o&&o(),Fg(t,null,3,[e,c===$g?void 0:l&&c[0]===$g?[]:c,h]),c=e)}else p.run()};let u;d.allowRecurse=!!t,"sync"===s?u=d:(d.pre=!0,u=()=>function(e){Hg.length&&Hg.includes(e,jg&&e.allowRecurse?Wg+1:Wg)||(null==e.id?Hg.push(e):Hg.splice(function(e){let t=Wg+1,i=Hg.length;for(;t<i;){const n=t+i>>>1;qg(Hg[n])<e?t=n+1:i=n}return t}(e.id),0,e),jg||Vg||(Vg=!0,Qg.then(Kg)))}(d));const p=new cm(r,u);return t?i?d():c=p.run():p.run(),()=>{p.stop()}}function iv(e,t){if(!Yf(e)||e.__v_skip)return e;if((t=t||new Set).has(e))return e;if(t.add(e),wg(e))iv(e.value,t);else if(jf(e))for(let i=0;i<e.length;i++)iv(e[i],t);else if(Hf(e)||Vf(e))e.forEach((e=>{iv(e,t)}));else if(Kf(e))for(const i in e)iv(e[i],t);return e}var nv=Object.freeze({__proto__:null,EffectScope:Bf,ITERATE_KEY:lm,ReactiveEffect:cm,computed:function(e,t,i=!1){let n,s;const r=Wf(e);return r?(n=e,s=zf):(n=e.get,s=e.set),new Bg(n,s,r||!s,i)},createPathGetter:function(e,t){const i=t.split(".");return()=>{let t=e;for(let e=0;e<i.length&&t;e++)t=t[i[e]];return t}},customRef:function(e){return new Ag(e)},deferredComputed:function(e){return new zg(e)},effect:function(e,t){e.effect&&(e=e.effect.fn);const i=new cm(e);t&&(Uf(i,t),t.scope&&Rf(i,t.scope)),t&&t.lazy||i.run();const n=i.run.bind(i);return n.effect=i,n},effectScope:If,enableTracking:function(){pm.push(um),um=!0},getCurrentScope:function(){return Df},isProxy:function(e){return ug(e)||pg(e)},isReactive:ug,isReadonly:pg,isRef:wg,isShallow:fg,markRaw:function(e){return t=e,Object.defineProperty(t,"__v_skip",{configurable:!0,enumerable:!1,value:!0}),e;var t},onScopeDispose:function(e){Df&&Df.cleanups.push(e)},pauseTracking:fm,proxyRefs:function(e){return ug(e)?e:new Proxy(e,Cg)},reactive:lg,readonly:cg,ref:bg,resetTracking:mm,shallowReactive:hg,shallowReadonly:function(e){return dg(e,!0,km,ng,ag)},shallowRef:function(e){return _g(e,!0)},stop:function(e){e.effect.stop()},toRaw:mg,toRef:function(e,t,i){return wg(e)?e:Wf(e)?new Tg(e):Yf(e)&&arguments.length>1?Pg(e,t,i):bg(e)},toRefs:function(e){const t=jf(e)?new Array(e.length):{};for(const i in e)t[i]=Pg(e,i);return t},toValue:function(e){return Wf(e)?e():Mg(e)},track:gm,trigger:ym,triggerRef:function(e){xg(e)},unref:Mg,watch:ev,watchEffect:Jg,watchSyncEffect:function(e){return tv(e,null,{flush:"sync"})}});function sv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var rv={exports:{}};rv.exports=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(e,t){var i=e[0],n=e[1],s=e[2],r=e[3];n=((n+=((s=((s+=((r=((r+=((i=((i+=(n&s|~n&r)+t[0]-680876936|0)<<7|i>>>25)+n|0)&n|~i&s)+t[1]-389564586|0)<<12|r>>>20)+i|0)&i|~r&n)+t[2]+606105819|0)<<17|s>>>15)+r|0)&r|~s&i)+t[3]-1044525330|0)<<22|n>>>10)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n&s|~n&r)+t[4]-176418897|0)<<7|i>>>25)+n|0)&n|~i&s)+t[5]+1200080426|0)<<12|r>>>20)+i|0)&i|~r&n)+t[6]-1473231341|0)<<17|s>>>15)+r|0)&r|~s&i)+t[7]-45705983|0)<<22|n>>>10)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n&s|~n&r)+t[8]+1770035416|0)<<7|i>>>25)+n|0)&n|~i&s)+t[9]-1958414417|0)<<12|r>>>20)+i|0)&i|~r&n)+t[10]-42063|0)<<17|s>>>15)+r|0)&r|~s&i)+t[11]-1990404162|0)<<22|n>>>10)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n&s|~n&r)+t[12]+1804603682|0)<<7|i>>>25)+n|0)&n|~i&s)+t[13]-40341101|0)<<12|r>>>20)+i|0)&i|~r&n)+t[14]-1502002290|0)<<17|s>>>15)+r|0)&r|~s&i)+t[15]+1236535329|0)<<22|n>>>10)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n&r|s&~r)+t[1]-165796510|0)<<5|i>>>27)+n|0)&s|n&~s)+t[6]-1069501632|0)<<9|r>>>23)+i|0)&n|i&~n)+t[11]+643717713|0)<<14|s>>>18)+r|0)&i|r&~i)+t[0]-373897302|0)<<20|n>>>12)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n&r|s&~r)+t[5]-701558691|0)<<5|i>>>27)+n|0)&s|n&~s)+t[10]+38016083|0)<<9|r>>>23)+i|0)&n|i&~n)+t[15]-660478335|0)<<14|s>>>18)+r|0)&i|r&~i)+t[4]-405537848|0)<<20|n>>>12)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n&r|s&~r)+t[9]+568446438|0)<<5|i>>>27)+n|0)&s|n&~s)+t[14]-1019803690|0)<<9|r>>>23)+i|0)&n|i&~n)+t[3]-187363961|0)<<14|s>>>18)+r|0)&i|r&~i)+t[8]+1163531501|0)<<20|n>>>12)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n&r|s&~r)+t[13]-1444681467|0)<<5|i>>>27)+n|0)&s|n&~s)+t[2]-51403784|0)<<9|r>>>23)+i|0)&n|i&~n)+t[7]+1735328473|0)<<14|s>>>18)+r|0)&i|r&~i)+t[12]-1926607734|0)<<20|n>>>12)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n^s^r)+t[5]-378558|0)<<4|i>>>28)+n|0)^n^s)+t[8]-2022574463|0)<<11|r>>>21)+i|0)^i^n)+t[11]+1839030562|0)<<16|s>>>16)+r|0)^r^i)+t[14]-35309556|0)<<23|n>>>9)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n^s^r)+t[1]-1530992060|0)<<4|i>>>28)+n|0)^n^s)+t[4]+1272893353|0)<<11|r>>>21)+i|0)^i^n)+t[7]-155497632|0)<<16|s>>>16)+r|0)^r^i)+t[10]-1094730640|0)<<23|n>>>9)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n^s^r)+t[13]+681279174|0)<<4|i>>>28)+n|0)^n^s)+t[0]-358537222|0)<<11|r>>>21)+i|0)^i^n)+t[3]-722521979|0)<<16|s>>>16)+r|0)^r^i)+t[6]+76029189|0)<<23|n>>>9)+s|0,n=((n+=((s=((s+=((r=((r+=((i=((i+=(n^s^r)+t[9]-640364487|0)<<4|i>>>28)+n|0)^n^s)+t[12]-421815835|0)<<11|r>>>21)+i|0)^i^n)+t[15]+530742520|0)<<16|s>>>16)+r|0)^r^i)+t[2]-995338651|0)<<23|n>>>9)+s|0,n=((n+=((r=((r+=(n^((i=((i+=(s^(n|~r))+t[0]-198630844|0)<<6|i>>>26)+n|0)|~s))+t[7]+1126891415|0)<<10|r>>>22)+i|0)^((s=((s+=(i^(r|~n))+t[14]-1416354905|0)<<15|s>>>17)+r|0)|~i))+t[5]-57434055|0)<<21|n>>>11)+s|0,n=((n+=((r=((r+=(n^((i=((i+=(s^(n|~r))+t[12]+1700485571|0)<<6|i>>>26)+n|0)|~s))+t[3]-1894986606|0)<<10|r>>>22)+i|0)^((s=((s+=(i^(r|~n))+t[10]-1051523|0)<<15|s>>>17)+r|0)|~i))+t[1]-2054922799|0)<<21|n>>>11)+s|0,n=((n+=((r=((r+=(n^((i=((i+=(s^(n|~r))+t[8]+1873313359|0)<<6|i>>>26)+n|0)|~s))+t[15]-30611744|0)<<10|r>>>22)+i|0)^((s=((s+=(i^(r|~n))+t[6]-1560198380|0)<<15|s>>>17)+r|0)|~i))+t[13]+1309151649|0)<<21|n>>>11)+s|0,n=((n+=((r=((r+=(n^((i=((i+=(s^(n|~r))+t[4]-145523070|0)<<6|i>>>26)+n|0)|~s))+t[11]-1120210379|0)<<10|r>>>22)+i|0)^((s=((s+=(i^(r|~n))+t[2]+718787259|0)<<15|s>>>17)+r|0)|~i))+t[9]-343485551|0)<<21|n>>>11)+s|0,e[0]=i+e[0]|0,e[1]=n+e[1]|0,e[2]=s+e[2]|0,e[3]=r+e[3]|0}function n(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return i}function s(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return i}function r(e){var t,s,r,o,a,l,h=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=h;t+=64)i(c,n(e.substring(t-64,t)));for(s=(e=e.substring(t-64)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<s;t+=1)r[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),t>55)for(i(c,r),t=0;t<16;t+=1)r[t]=0;return o=(o=8*h).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,r[14]=a,r[15]=l,i(c,r),c}function o(e){var i,n="";for(i=0;i<4;i+=1)n+=t[e>>8*i+4&15]+t[e>>8*i&15];return n}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=o(e[t]);return e.join("")}function l(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function h(e){var t,i=[],n=e.length;for(t=0;t<n-1;t+=2)i.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,i)}function c(){this.reset()}return a(r("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(t,i){var n,s,r,o,a=this.byteLength,l=e(t,a),h=a;return void 0!==i&&(h=e(i,a)),l>h?new ArrayBuffer(0):(n=h-l,s=new ArrayBuffer(n),r=new Uint8Array(s),o=new Uint8Array(this,l,n),r.set(o),s)}}(),c.prototype.append=function(e){return this.appendBinary(l(e)),this},c.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,s=this._buff.length;for(t=64;t<=s;t+=64)i(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},c.prototype.end=function(e){var t,i,n=this._buff,s=n.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<s;t+=1)r[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(r,s),i=a(this._hash),e&&(i=h(i)),this.reset(),i},c.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},c.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},c.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},c.prototype._finish=function(e,t){var n,s,r,o=t;if(e[o>>2]|=128<<(o%4<<3),o>55)for(i(this._hash,e),o=0;o<16;o+=1)e[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(n[2],16),r=parseInt(n[1],16)||0,e[14]=s,e[15]=r,i(this._hash,e)},c.hash=function(e,t){return c.hashBinary(l(e),t)},c.hashBinary=function(e,t){var i=a(r(e));return t?h(i):i},c.ArrayBuffer=function(){this.reset()},c.ArrayBuffer.prototype.append=function(e){var t,n,r,o,a=(n=this._buff.buffer,r=e,(o=new Uint8Array(n.byteLength+r.byteLength)).set(new Uint8Array(n)),o.set(new Uint8Array(r),n.byteLength),o),l=a.length;for(this._length+=e.byteLength,t=64;t<=l;t+=64)i(this._hash,s(a.subarray(t-64,t)));return this._buff=t-64<l?new Uint8Array(a.buffer.slice(t-64)):new Uint8Array(0),this},c.ArrayBuffer.prototype.end=function(e){var t,i,n=this._buff,s=n.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<s;t+=1)r[t>>2]|=n[t]<<(t%4<<3);return this._finish(r,s),i=a(this._hash),e&&(i=h(i)),this.reset(),i},c.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.ArrayBuffer.prototype.getState=function(){var e,t=c.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},c.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var i,n=e.length,s=new ArrayBuffer(n),r=new Uint8Array(s);for(i=0;i<n;i+=1)r[i]=e.charCodeAt(i);return r}(e.buff),c.prototype.setState.call(this,e)},c.ArrayBuffer.prototype.destroy=c.prototype.destroy,c.ArrayBuffer.prototype._finish=c.prototype._finish,c.ArrayBuffer.hash=function(e,t){var n=a(function(e){var t,n,r,o,a,l,h=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=h;t+=64)i(c,s(e.subarray(t-64,t)));for(n=(e=t-64<h?e.subarray(t-64):new Uint8Array(0)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)r[t>>2]|=e[t]<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),t>55)for(i(c,r),t=0;t<16;t+=1)r[t]=0;return o=(o=8*h).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,r[14]=a,r[15]=l,i(c,r),c}(new Uint8Array(e)));return t?h(n):n},c}();var ov=sv(rv.exports);const av=(e,t=10,i="both")=>{let n,s,r,o=!1,a="trailingPromise"===i?new Promise((e=>r=e)):void 0;return function(...l){if(s=l,o)return null!=a?a:n;o=!0,"leading"!==i&&"both"!==i||(n=e.apply(this,s));const h=()=>{"trailing"!==i&&"both"!==i&&"trailingPromise"!==i||(n=e.apply(this,s),null==r||r(n),a="trailingPromise"===i?new Promise((e=>r=e)):void 0),o=!1};return t>0?setTimeout(h,t):queueMicrotask(h),null!=a?a:n}},lv=(e,t=10,i="both")=>{let n,s,r,o,a="trailingPromise"===i?new Promise((e=>o=e)):void 0;return function(...l){return r=l,n?n():"leading"!==i&&"both"!==i||(s=e.apply(this,r)),n=((e,t)=>{if(0===t){let t=!0;return queueMicrotask((()=>t&&e())),()=>t=!1}const i=setTimeout(e,t);return()=>clearTimeout(i)})((()=>{"trailing"!==i&&"both"!==i&&"trailingPromise"!==i||(s=e.apply(this,r),null==o||o(s),a="trailingPromise"===i?new Promise((e=>o=e)):void 0),n=void 0}),t),null!=a?a:s}};function hv(e,t){const i=e.indexOf(t);i>=0&&e.splice(i,1)}const cv=(e,t,i)=>{for(const n of i){const i=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),n);i&&(i.get||i.set?i.get&&i.set?Object.defineProperty(e,n,{get:()=>t[n],set(e){t[n]=e},configurable:!0}):i.get?Object.defineProperty(e,n,{get:()=>t[n],configurable:!0}):i.set&&Object.defineProperty(e,n,{set(e){t[n]=e},configurable:!0}):e[n]=t[n].bind(t))}return()=>{for(const t of i)delete e[t]}},dv=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function uv(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(dv[255&e]+dv[e>>8&255]+dv[e>>16&255]+dv[e>>24&255]+"-"+dv[255&t]+dv[t>>8&255]+"-"+dv[t>>16&15|64]+dv[t>>24&255]+"-"+dv[63&i|128]+dv[i>>8&255]+"-"+dv[i>>16&255]+dv[i>>24&255]+dv[255&n]+dv[n>>8&255]+dv[n>>16&255]+dv[n>>24&255]).toLowerCase()}class pv{constructor(e){this.fwdMap={},this.revMap={},this.fwdMap=Object.assign({},e),this.revMap=Object.keys(e).reduce(((t,i)=>Object.assign(Object.assign({},t),{[e[i]]:i})),{})}get(e){return this.fwdMap[e]}getByValue(e){return this.revMap[e]}add(e,t){this.remove(e),this.fwdMap[e]=t,this.revMap[t]=e}remove(e){let t=this.fwdMap[e];void 0!==t&&(delete this.fwdMap[e],delete this.revMap[t])}removeByValue(e){let t=this.revMap[e];void 0!==e&&(delete this.revMap[e],delete this.fwdMap[t])}}function fv(e){const t=new Map,i=function e(i){if(null===i)return null;if("object"==typeof i){const n=t.get(i);if(void 0!==n)return n;if(Array.isArray(i)){const n=[];t.set(i,n),n.length=i.length;for(let t=0;t<n.length;++t)n[t]=e(i[t]);return n}if(i instanceof Date){const e=new Date(i.getTime());return t.set(i,e),e}if(i instanceof RegExp){const e=new RegExp(i.source,i.flags);return t.set(i,e),e}{const n={};t.set(i,n);for(const t in i)if(i.hasOwnProperty(t))try{n[t]=e(i[t])}catch(e){}return n}}return i}(e);return t.clear(),i}function mv(e,t){const i={};for(const n of t)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}function gv(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function vv(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}function yv(e){return ov.hash(e)}function xv(e){return new Promise((t=>{setTimeout(t,null!=e?e:1e3)}))}function wv(e,t){var i,n,s;let r=Object.keys(t),o=r.map((t=>e[t]));if(null!==(i=e._oldValue)&&void 0!==i||(e._oldValue={}),(null!==(n=e._oldRef)&&void 0!==n?n:0)>0)for(let i=0;i<r.length;i++)o[i]=null!==(s=e._oldValue[i])&&void 0!==s?s:t[i];else for(let t=0;t<r.length;t++)e._oldValue[t]=o[t];return{push:()=>{var i,n;for(let n=0;n<r.length;n++)e._oldValue[n]=null!==(i=o[n])&&void 0!==i?i:t[n];e._oldRef=(null!==(n=e._oldRef)&&void 0!==n?n:0)+1},pop:()=>{var t;for(let t=0;t<r.length;t++)e._oldValue[t]=o[t];e._oldRef=(null!==(t=e._oldRef)&&void 0!==t?t:0)-1,e._oldRef<=0&&(delete e._oldRef,delete e._oldValue)}}}const bv=1e-5,_v=Math.PI/180,Sv=180/Math.PI;function Mv(e,t,i){return Math.max(t,Math.min(i,e))}function Cv(e,t,i){return(1-i)*e+i*t}function Av(e,i,n){return(new t).set(Cv(e.x,i.x,n),Cv(e.y,i.y,n),Cv(e.z,i.z,n))}function Ev(e,t=bv){return Math.abs(e)<t}function Tv(e,t,i=bv){return Ev(e-t,i)}function Pv(e){if(0==e.length)return;let t=e[1];for(let i=1;i<e.length;i++)e[i]>t&&(t=e[i]);return t}function Ov(e){if(0==e.length)return;let t=e[1];for(let i=1;i<e.length;i++)e[i]<t&&(t=e[i]);return t}function Dv(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Bv(e,t,i=bv){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!Tv(e[n],t[n],i))return!1;return!0}function Iv(e,t){return Math.round(e/t)*t}function Rv(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function kv(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function Lv(e,t,i){let n=e;return n<t&&(n=t),n<i&&(n=i),n}function zv(e,t,i){let n=e;return n>t&&(n=t),n>i&&(n=i),n}function Uv(e,t){return e<t?t:e}function Fv(e,t){return e<t?e:t}class Nv{constructor(e){this.coords=e.coords,this.radius=e.radius,this.init()}init(){}static getBezierPoints(e,t=10){if(e.length<=2)return e;let i=[],n=e.length-1;for(let r=0;r<=1;r+=1/t){let t=0,o=0;for(var s=0;s<=n;s++){let i=Nv.getBinomialFactor(n,s),a=Math.pow(r,s),l=Math.pow(1-r,n-s);t+=i*a*l*e[s][0],o+=i*a*l*e[s][1]}i.push([t,o])}return i.push(e[n]),i}static getBinomialFactor(e,t){return Nv.getFactorial(e)/(Nv.getFactorial(t)*Nv.getFactorial(e-t))}static getFactorial(e){if(e<=1)return 1;if(2==e)return 2;if(3==e)return 6;if(4==e)return 24;if(5==e)return 120;for(var t=1,i=1;i<=e;i++)t*=i;return t}}function jv(e,t,i,n){let s=e,r=[];((i=null!=i?i:.9)<0||i>1)&&(i=.9);let o=Array.isArray(n);if(o&&(n.length=0),s.length>2){r.push(s[0]),o&&n.push(0);for(let e=1;e<s.length-1;e++){let o=s[e-1],a=s[e],l=s[e+1],h=[o[0]+i*(a[0]-o[0]),o[1]+i*(a[1]-o[1]),o[2]+i*(a[2]-o[2])],c=[a[0]+(1-i)*(l[0]-a[0]),a[1]+(1-i)*(l[1]-a[1]),a[2]+(1-i)*(l[2]-a[2])],d=Nv.getBezierPoints([[h[0],h[2]],[a[0],a[2]],[c[0],c[2]]],null!=t?t:5);for(let t of d)r.push([t[0],a[1],t[1]]),n&&n.push(e)}return r.push(s[s.length-1]),o&&n.push(s.length-1),r}if(o)for(let e=0;e<s.length;e++)n.push(e);return s}function Vv(e){if(Array.isArray(e))return(new i).fromArray(e);if(e.isVector3)return e;if("number"==typeof e)return new i(e,e,e);if("object"==typeof e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z)return new i(e.x,e.y,e.z);throw Error("to vector failed ")}function Hv(e){let t=new n;if(null==e?void 0:e.inVerseColor){let e=new n;e.set(-1,0,0,0,0,-1,0,0,0,0,-1,0,1,1,1,1),t.multiply(e)}if(null==e?void 0:e.monochromeColor){let i=new s(null==e?void 0:e.monochromeColor),r=new n;const o=i.r,a=i.g,l=i.b;r.set(o,a,l,0,o,a,l,0,o,a,l,0,0,0,0,1),t.multiply(r)}if(null==e?void 0:e.bright){let i=new n;const s=e.bright;i.set(s,0,0,0,0,s,0,0,0,0,s,0,0,0,0,1),t.multiply(i)}if(null==e?void 0:e.contrast){let i=new n;const s=e.contrast,r=.5*(1-s);i.set(s,0,0,0,0,s,0,0,0,0,s,0,r,r,r,1),t.multiply(i)}if(null==e?void 0:e.saturation){let i=new n;const s=e.saturation,r=.3*(1-s),o=.6*(1-s),a=.1*(1-s);i.set(r+s,r,r,0,o,o+s,o,0,a,a,a+s,0,0,0,0,1),t.multiply(i)}return t}function Wv(e){return e*_v}function Gv(e){return e*Sv}function Yv(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i}function Xv(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}function Qv(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))}function qv(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function Zv(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i}"function"==typeof SuppressedError&&SuppressedError;class Kv{constructor(){this._events=Object.create(null),this._eventCount=0,this._dispatchingListeners=[]}hasEvent(e){return null!=this._events[e]}eventNames(){return 0===this._eventCount?[]:Object.keys(this._events)}listenerCount(e){const t=this._events[e];return t?Array.isArray(t)?t.length:1:0}dispatch(e,...t){if(!this._events[e])return!1;const i=this._events[e];if(Array.isArray(i)){const n=i.length,s=this._dispatchingListeners;s.length=n;for(let e=0;e<n;e++)s[e]=i[e];for(let i=0;i<n;i++){const n=s[i];n.destroyed||(n.once&&this.off(e,n.fn),n.fn(...t))}s.length=0}else i.once&&this.off(e,i.fn),i.fn(...t,this);return!0}on(e,t){return this._addEventListener(e,t)}once(e,t){return this._addEventListener(e,t,!0)}off(e,t){if(!this._events[e])return this;if(!t)return this._clearEvent(e),this;const i=this._events[e],n=Array.isArray(i);if(n||i.fn!==t){if(n){for(let e=i.length-1;e>=0;e--)i[e].fn===t&&(i[e].destroyed=!0,i.splice(e,1));0===i.length?this._clearEvent(e):1===i.length&&(this._events[e]=i[0])}}else this._clearEvent(e);return this}removeAllEventListeners(e){e?this._events[e]&&this._clearEvent(e):(this._events=Object.create(null),this._eventCount=0)}_addEventListener(e,t,i){const n={fn:t,once:i},s=this._events,r=s[e];return r?Array.isArray(r)?r.push(n):s[e]=[r,n]:(s[e]=n,this._eventCount++),this}_clearEvent(e){0==--this._eventCount?this._events=Object.create(null):delete this._events[e]}}const Jv=(e,...t)=>{},$v=console.log.bind(console),ey=console.info.bind(console),ty=console.warn.bind(console),iy=console.error.bind(console),ny={debug:Jv,info:Jv,warn:Jv,error:Jv,isEnabled:!1,enable(){this.debug=$v,this.info=ey,this.warn=ty,this.error=iy,this.isEnabled=!0},disable(){this.debug=Jv,this.info=Jv,this.warn=Jv,this.error=Jv,this.isEnabled=!1}};class sy extends Error{constructor(e,t,i,n=!1){super(`@${e}: ${t}`);const s=this.stack.split("\n");s.splice(1,2),this.stack=s.join("\n"),ny.error("Active module:",i),n&&ny.error("Dependency module:",n),this.name="DependencyError"}}class ry{get frameCount(){return this._frameCount}get deltaTime(){return this._deltaTime}get elapsedTime(){return this._elapsedTime}get actualDeltaTime(){return this._actualDeltaTime}get actualElapsedTime(){return this._actualElapsedTime}constructor(){this._frameCount=0,this._deltaTime=0,this._actualDeltaTime=0,this._elapsedTime=0,this._actualElapsedTime=0,this.maximumDeltaTime=.333333,this.timeScale=1,this._lastSystemTime=performance.now()/1e3}_reset(){this._lastSystemTime=performance.now()/1e3}_update(){const e=performance.now()/1e3,t=e-this._lastSystemTime;this._actualDeltaTime=t,this._actualElapsedTime+=t;const i=Math.min(t,this.maximumDeltaTime)*this.timeScale;this._deltaTime=i,this._elapsedTime+=i,this._frameCount++,this._lastSystemTime=e}}const oy={RemoveAfterExecution:1};class ay{constructor(e,t){this.handle=e,this.context=t,this.flags=0}setFlag(e){this.flags|=e}clearFlag(e){this.flags&=~e}writeFlag(e,t){t?this.setFlag(e):this.clearFlag(e)}getFlag(e){return(this.flags&e)===e}}const ly=[];let hy=0;class cy{constructor(){this.handlers=[],this.flags=0}get dispatching(){return this.getFlag(2)}set dispatching(e){this.writeFlag(2,e)}get silent(){return this.getFlag(1)}set silent(e){this.writeFlag(1,e)}setFlag(e){this.flags|=e}clearFlag(e){this.flags&=~e}writeFlag(e,t){t?this.setFlag(e):this.clearFlag(e)}getFlag(e){return(this.flags&e)===e}contains(e){return-1!==dy(this.handlers,e)}mute(){this.setFlag(1)}unmute(){this.clearFlag(1)}hasHandlers(){return this.handlers.length>0}addOne(e,t){const i=new ay(e,t);return i.setFlag(oy.RemoveAfterExecution),this.handlers.push(i),()=>this.remove(e,t)}add(e,t){const i=new ay(e,t);return this.handlers.push(i),()=>this.remove(e,t)}remove(e,t){return void 0===t?function(e,t){const i=e.handlers,n=dy(i,t);return n>=0&&(i.splice(n,1),!0)}(this,e):function(e,t,i){const n=e.handlers,s=uy(n,t,i);return s>=0&&(n.splice(s,1),!0)}(this,e,t)}removeAll(){const e=this.handlers;e.splice(0,e.length)}dispatch(...e){0==(1&this.flags)&&(this.setFlag(2),fy(this.handlers,e),this.clearFlag(2))}isDispatching(){return this.getFlag(2)}merge(e){const t=new cy;function i(){t.dispatch(arguments)}return this.add(i),e.add(i),t}}function dy(e,t,i){const n=e.length;for(let s=0;s<n;s++){const n=e[s];if(n.handle===t){if(void 0!==i&&i!==n.context)continue;return s}}return-1}function uy(e,t,i){const n=e.length;for(let s=0;s<n;s++){const n=e[s];if(n.handle===t&&n.context===i)return s}return-1}function py(e,t,i){try{e.apply(t,i)}catch(t){console.error("Failed to dispatch handler",e,t)}}function fy(e,t){const i=e.length,n=hy,s=n+i;let r,o;for(hy=s,r=0;r<i;r++)ly[n+r]=e[i-(r+1)];for(r=s-1;r>=n;r--){if(o=ly[r],o.getFlag(oy.RemoveAfterExecution)){const t=e.indexOf(o);e.splice(t,1)}py(o.handle,o.context,t)}hy=n}var my,gy,vy;class yy extends Kv{get uiConfig(){return this._uiConfig?this._uiConfig:"function"==typeof this.setupUiConfig?(this._uiConfig=this.setupUiConfig(),this._uiConfig):void 0}constructor(e){super(),this.instanceId=++yy._instanceIdCounter,my.set(this,[]),this.onSetApp=new cy,this.data=hg({}),this.extData={},this._destroyed=!1,e&&(this.app=e)}get app(){var e;return this._app||(null===(e=this.entity)||void 0===e?void 0:e.app)}set app(e){let t=!this._app&&e;this._app=e,t&&this.onSetApp.dispatch(e)}get destroyed(){return this._destroyed}destroy(){if(!this._destroyed){for(const e of qv(this,my,"f"))e();Zv(this,my,[],"f"),this._destroyed=!0}}effectScope(e){if(!e)return;const t=If();t.run(e),this.addDispose((()=>{t.stop()}))}applyMixinsTo(e,t,i,n){if(void 0===t){let e=new Set(["constructor","setupUiConfig","toJSON","fromJSON",...null!=n?n:[]]);t=Object.getOwnPropertyNames(Object.getPrototypeOf(this)).filter((t=>0!=t.indexOf("#")&&!t.match(/^on[A-Z].*/)&&!e.has(t)))}i&&(t=[...t,...i]),this.addDispose(cv(e,this,t))}addDispose(e){qv(this,my,"f").push(e)}removeDispose(e){hv(qv(this,my,"f"),e)}}my=new WeakMap,yy._instanceIdCounter=0,function(e){e[e.StartMost=-1e6]="StartMost",e[e.Start=-1e3]="Start",e[e.Normal=0]="Normal",e[e.End=1e3]="End",e[e.EndMost=1e6]="EndMost"}(gy||(gy={}));class xy extends yy{constructor(){super(...arguments),this._awoken=!1,this._phasedActive=!1,this._enabled=!0,this.appRenderIndex=0}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,e?(this._phasedActive=!0,this._onEnable()):(this._phasedActive=!1,this._onDisable()))}_onAwake(){this.onAwake&&this.onAwake()}_onEnable(){var e;null===(e=this.app)||void 0===e||e.moduleManager.addModule(this),this.onEnable&&this.onEnable()}_onDisable(){var e;this.onDisable&&this.onDisable(),null===(e=this.app)||void 0===e||e.moduleManager.removeModule(this)}_setActive(e){e?(this._awoken||(this._awoken=!0,this._onAwake()),!this._phasedActive&&this._enabled&&(this._phasedActive=!0,this._onEnable())):this._phasedActive&&!this._enabled&&(this._phasedActive=!1,this._onDisable())}_onDestroy(){super.destroy(),this._enabled&&this._onDisable(),this.onDestroy&&this.onDestroy()}}xy.moduleName="";class wy{constructor(e){this.modules=new Map,this._orderDirty={},this._isApp=null!=e&&e,this._orderDirty.onAppRender=!1}addModule(e){for(const t of Object.getOwnPropertyNames(Object.getPrototypeOf(e))){let i=!1,n=!1;if(/^onApp[A-Z][a-z]+/.test(t)?i=!0:n=/^on[A-Z][a-z]+/.test(t),this._isApp&&i||!this._isApp&&(n||i)){if("function"!=typeof e[t])continue;const i=this.modules.get(t);i?i.includes(e)||(i.push(e),t in this._orderDirty&&(this._orderDirty[t]=!0)):this.modules.set(t,[e])}}}getModules(e){return this.modules.get(e)||[]}callModules(e,...t){let i=this.getModules(e);if(i.length>1&&e in this._orderDirty){const t=e.substring(2,3).toLowerCase()+e.substring(3)+"Index",n=[];n.push(...i.filter((e=>t in e&&e[t]<gy.Normal)).sort(((e,i)=>e[t]-i[t]))),n.push(...i.filter((e=>t in e&&e[t]===gy.Normal||!(t in e)))),n.push(...i.filter((e=>t in e&&e[t]>gy.Normal)).sort(((e,i)=>e[t]-i[t]))),i=n,this.modules.set(e,i),this._orderDirty[e]=!1}i.forEach((i=>{i[e](...t)})),"onAppStart"===e&&this.modules.set(e,[])}removeModule(e){for(const[,t]of this.modules)hv(t,e)}}class by{constructor(e,t=null,i){this.coords=new r(0,0),this.distance=0,this.intersected=!1,this.cancelBubble=!1,this.type=e,this.originalEvent=t,this.originMapEvent=i}stopPropagation(){this.cancelBubble=!0}}class _y{constructor(e){this.cancelBubble=!1,this.type=e,this.data={}}stopPropagation(){this.cancelBubble=!0}}class Sy extends xy{constructor(e){super(),this.entity=e,this.app=null==e?void 0:e.app}_onEnable(){var e,t;null===(e=this.entity)||void 0===e||e.moduleManager.addModule(this),null===(t=this.app)||void 0===t||t.moduleManager.addModule(this),this.onEnable&&this.onEnable()}_onDisable(){var e,t;this.onDisable&&this.onDisable(),null===(e=this.entity)||void 0===e||e.moduleManager.removeModule(this),null===(t=this.app)||void 0===t||t.moduleManager.removeModule(this)}}class My{static _addCheck(e,t){for(;t!==xy;){const i=My._dependenciesMap.get(t);if(i){const{Modules:n,mode:s}=i;for(let i=0,r=n.length;i<r;i++){const r=n[i];if(!e.getModule(r)){if(s!==vy.AutoAdd)throw`Should add ${r.name} before adding ${t.name}`;e.addModule(r)}}}t=Object.getPrototypeOf(t)}}static _removeCheck(e,t){for(;t!==xy;){const i=My._invDependenciesMap.get(t);if(i)for(let n=0,s=i.length;n<s;n++)if(e.getModule(i[n]))throw`Should remove ${i[n].name} before adding ${t.name}`;t=Object.getPrototypeOf(t)}}static _addDependency(e,t,i){const n=i.get(e);n?n.includes(t)||n.push(t):i.set(e,[t])}static _addInvDependency(e,t){const i=this._invDependenciesMap,n=i.get(e);n?n.includes(t)||n.push(t):i.set(e,[t])}constructor(){}}My._invDependenciesMap=new Map,My._dependenciesMap=new Map,function(e){e[e.CheckOnly=0]="CheckOnly",e[e.AutoAdd=1]="AutoAdd"}(vy||(vy={}));class Cy{}Cy.useData={};let Ay="easeInOutExpo";class Ey{static linear(e){return e}static easeInSine(e){return 1-Math.cos(e*Math.PI/2)}static easeOutSine(e){return Math.sin(e*Math.PI/2)}static easeInOutSine(e){return-(Math.cos(Math.PI*e)-1)/2}static easeInQuad(e){return e*e}static easeOutQuad(e){return 1-(1-e)*(1-e)}static easeInOutQuad(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}static easeInCubic(e){return e*e*e}static easeOutCubic(e){return 1-Math.pow(1-e,3)}static easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}static easeInQuart(e){return e*e*e*e}static easeOutQuart(e){return 1-Math.pow(1-e,4)}static easeInOutQuart(e){return e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2}static easeInQuint(e){return e*e*e*e*e}static easeOutQuint(e){return 1-Math.pow(1-e,5)}static easeInOutQuint(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}static easeInExpo(e){return 0===e?0:Math.pow(2,10*e-10)}static easeOutExpo(e){return 1===e?1:1-Math.pow(2,-10*e)}static easeInOutExpo(e){return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}static easeInCirc(e){return 1-Math.sqrt(1-Math.pow(e,2))}static easeOutCirc(e){return Math.sqrt(1-Math.pow(e-1,2))}static easeInOutCirc(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}static easeInBack(e){return 2.70158*e*e*e-1.70158*e*e}static easeOutBack(e){return 1+2.70158*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2)}static easeInOutBack(e){const t=2.5949095;return e<.5?Math.pow(2*e,2)*(7.189819*e-t)/2:(Math.pow(2*e-2,2)*((t+1)*(2*e-2)+t)+2)/2}static easeInElastic(e){return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*(2*Math.PI)/3)}static easeOutElastic(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*(2*Math.PI)/3)+1}static easeInOutElastic(e){const t=2*Math.PI/4.5;return 0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*t)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*t)/2+1}static easeInBounce(e){return 1-this.easeOutBounce(1-e)}static easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}static easeInOutBounce(e){return e<.5?(1-this.easeOutBounce(1-2*e))/2:(1+this.easeOutBounce(2*e-1))/2}}class Ty{constructor(e){this.times=e,this.hasActions=!1,this.isRepeat=!0}}class Py{constructor(e){this.times=e,this.hasActions=!1,this.isYoyo=!0}}class Oy{constructor(...e){this.hasActions=!0,this.isTween=!0,this.tweens=[];for(const t of e)this.tweens.push(t.clone())}}class Dy{constructor(e){this.callback=e,this.hasActions=!0}init(){return{actions:[{callback:this.callback,time:0}]}}}class By{constructor(e){this.time=e,this.hasActions=!0}init(){return{actions:[{callback:()=>{},time:this.time}]}}}class Iy{constructor(e,t,i,n){this.time=e,this.motion=t,this.config=i,this.isBy=n,this.hasActions=!0}init(e){var t,i,n,s;const r=[];for(const o in this.motion){if("easing"===o)continue;const a=this.motion[o],l=e[o],h=null!==(s=null!==(n=null!==(i=null!==(t=this.vector3(o,a,l))&&void 0!==t?t:this.quaternion(o,a,l))&&void 0!==i?i:this.euler(o,a,l))&&void 0!==n?n:this.color(o,a,l))&&void 0!==s?s:this.number(e,o,a);h&&r.push(h)}return{actions:r,config:this.config}}getEasing(){var e,t,i;const n=null!==(t=null===(e=this.config)||void 0===e?void 0:e.easing)&&void 0!==t?t:Ay;return"string"==typeof n?null!==(i=Ey[n])&&void 0!==i?i:Ey.linear:n}vector3(e,t,n){if(null==n?void 0:n.isVector3){const s="number"==typeof t?new i(t,t,t):t;return{key:e,time:this.time,easing:this.getEasing(),start:n.clone(),end:this.isBy?s.clone().add(n):s,callback:(e,t,i)=>{n.lerpVectors(e,t,i)}}}}quaternion(e,t,i){if(null==i?void 0:i.isQuaternion)return{key:e,time:this.time,easing:this.getEasing(),start:i.clone(),end:this.isBy?t.clone().premultiply(i):t,callback:(e,t,n)=>{i.slerpQuaternions(e,t,n)}}}euler(e,i,n){if(null==n?void 0:n.isEuler)return{key:e,time:this.time,easing:this.getEasing(),start:n.clone(),end:this.isBy?new t(i.x+n.x,i.y+n.y,i.z+n.z):i,callback:(e,t,i)=>{n.set(o.lerp(e.x,t.x,i),o.lerp(e.y,t.y,i),o.lerp(e.z,t.z,i))}}}color(e,t,i){if(null==i?void 0:i.isColor)return{key:e,time:this.time,easing:this.getEasing(),start:i.clone(),end:this.isBy?new s(t).add(i):new s(t),callback:(e,t,n)=>{i.lerpColors(e,t,n)}}}number(e,t,i){if("number"==typeof i)return{key:t,time:this.time,easing:this.getEasing(),start:e[t],end:this.isBy?i+e[t]:i,callback:(i,n,s)=>{e[t]=o.lerp(i,n,s)}}}}class Ry{get finished(){return this._finished}constructor(e,t,i){this.actionIndex=-1,this.history=[],this.repetitions={},this._finished=!1,this.paused=!1,this.timeScale=1,this.target=e,this.tween=t,this.tweenManager=i}setTimeScale(e){return this.timeScale=e,this}pause(){this.paused=!0}resume(){this.paused=!1}stop(){var e,t,i;this.tweenManager.stop(this),null===(i=null===(t=null===(e=this.currentBlock)||void 0===e?void 0:e.config)||void 0===t?void 0:t.onComplete)||void 0===i||i.call(this.target,this.target,!0,!0)}complete(){this.tweenManager.complete(this)}getBlock(){var e,t,i,n,s;const r=this.getCurrentBlock();return null===(i=null===(t=null===(e=this.currentBlock)||void 0===e?void 0:e.config)||void 0===t?void 0:t.onComplete)||void 0===i||i.call(this.target,this.target,!r,!1),null===(s=null===(n=null==r?void 0:r.config)||void 0===n?void 0:n.onStart)||void 0===s||s.call(this.target,this.target),this.tween.blockHistory||this.reversed||this.repeat||!r||this.history.push(r),this.currentBlock=r,r}getCurrentBlock(){return this.reversed?this.getPrevBlock():this.repeat?this.getRepeatBlock():this.getNextBlock()}getPrevBlock(){if(this.actionIndex>0){const e=this.history[--this.actionIndex];return e.reversed=!e.originallyReversed,e.elapsedTime=0,e.tweensStarted=!1,e}}getRepeatBlock(){if(this.actionIndex<this.history.length-1){const e=this.history[++this.actionIndex];return e.reversed=e.originallyReversed,e.elapsedTime=0,e.tweensStarted=!1,e}}getNextBlock(){for(;++this.actionIndex<this.tween.actions.length;){const e=this.tween.actions[this.actionIndex];if(e.isRepeat)this.handleRepetition(e.times);else{if(!e.isYoyo)return e.isTween?this.handleTween(e):this.handleMotion();{const t=this.handleYoyo(e.times);if(t)return t}}}}cloneBlock(e){return{elapsedTime:0,totalTime:e.totalTime,reversed:!e.reversed,originallyReversed:!e.reversed,actions:e.actions,tweens:e.tweens,config:e.config,runningTweens:this.cloneRunningTweens(e.runningTweens)}}cloneRunningTweens(e){if(!e)return;const t=[];for(const i of e){const e=new Ry(i.target,i.tween,i.tweenManager);e.timeScale=i.timeScale,e.root=i.root,e.history=i.history,e.actionIndex=i.reversed?-1:i.history.length,e.originallyReversed=!i.reversed,e.repeat=i.reversed,t.push(e)}return t}handleMotion(){const e=this.tween.actions[this.actionIndex].init(this.target);return{config:e.config,actions:e.actions,elapsedTime:0,totalTime:Math.max(...e.actions.map((e=>e.time)))}}handleTween(e){return{tweens:e.tweens,elapsedTime:0,totalTime:0}}handleRepetition(e){var t,i;const n=this.repetitions;if(null!==(t=n[i=this.actionIndex])&&void 0!==t||(n[i]=0),n[this.actionIndex]<e){n[this.actionIndex]++;do{this.actionIndex--}while(this.actionIndex>-1&&!this.tween.actions[this.actionIndex].hasActions);this.actionIndex--}}handleYoyo(e){var t,i;const n=this.repetitions;if(null!==(t=n[i=this.actionIndex])&&void 0!==t||(n[i]=0),n[this.actionIndex]<e){if(n[this.actionIndex]++,n[this.actionIndex--]<3)return this.cloneBlock(this.history[this.history.length-1]);const e=this.history[this.history.length-2];return e.elapsedTime=0,e.tweensStarted=!1,e}}execute(e){if(this.paused)return!0;e*=this.timeScale;do{e=Math.min(this.executeBlock(e),this.getTweensDelta(this.currentBlock))}while(e>=0&&this.getBlock());return e<0}executeBlock(e){const t=this.currentBlock;return t.elapsedTime+=e,this.executeActions(t),this.executeTweens(t,e),t.elapsedTime-t.totalTime}executeActions(e){var t,i,n,s,r,o;if(e.actions){for(const r of e.actions){const o=Math.min(1,e.elapsedTime/(r.time+Math.pow(10,-12))),a=e.reversed?1-o:o,l=null!==(i=null===(t=r.easing)||void 0===t?void 0:t.call(this,a))&&void 0!==i?i:a;!1!==(null===(s=null===(n=e.config)||void 0===n?void 0:n.onProgress)||void 0===s?void 0:s.call(this.target,this.target,r.key,r.start,r.end,l,e.reversed))&&r.callback(r.start,r.end,l)}null===(o=null===(r=e.config)||void 0===r?void 0:r.onUpdate)||void 0===o||o.call(this.target,this.target)}}executeTweens(e,t){if(e.tweens&&!e.tweensStarted){if(e.runningTweens)for(const i of e.runningTweens)i.executeExistingTween(t,this.reversed);else{e.runningTweens=[];for(const i of e.tweens)this.executeTween(e,t,i)}e.tweensStarted=!0}}executeTween(e,t,i){var n;const s=this.tweenManager.createChildren(this.target,i,null!==(n=this.root)&&void 0!==n?n:this);e.runningTweens.push(s),s.execute(t)&&this.tweenManager.addChildren(s)}executeExistingTween(e,t){this.reversed=t?!this.originallyReversed:this.originallyReversed,this.repeat=!this.reversed,this.actionIndex=this.reversed?this.history.length:-1,this.getBlock(),this.execute(e)&&this.tweenManager.addChildren(this)}getTweensDelta(e){let t=Number.MAX_SAFE_INTEGER;if(e.runningTweens)for(const i of e.runningTweens){const e=i.repeat||i.reversed?i.actionIndex:i.history.length-1,n=i.history[e];t=Math.min(t,n.elapsedTime-n.totalTime,i.getTweensDelta(n))}return t}}class ky{constructor(e,t){this.actions=[],this.blockHistory=!1,this.infiniteLoop=!1,this.tags=[],this.target=e,this.tweenManager=t,this.id=uv()}setId(e){return this.id=e,this}setTags(...e){return this.tags=e,this}setTarget(e){return this.target=e,this}to(e,t,i){return this.actions.push(new Iy(e,t,i,!1)),this}by(e,t,i){return this.actions.push(new Iy(e,t,i,!0)),this}set(e){return this.actions.push(new Iy(0,e,{},!1)),this}call(e){return this.actions.push(new Dy(e)),this}delay(e){return this.actions.push(new By(e)),this}repeat(e=1){return e===1/0&&(this.blockHistory=!0,this.infiniteLoop=!0),this.actions[this.actions.length-1].isRepeat?this.actions[this.actions.length-1].times+=e:this.actions.push(new Ty(e)),this}repeatForever(){return this.repeat(1/0)}yoyo(e=1){return e===1/0&&(this.infiniteLoop=!0),this.actions[this.actions.length-1].isYoyo?this.actions[this.actions.length-1].times+=e:this.actions.push(new Py(e)),this}yoyoForever(){return this.yoyo(1/0)}then(e){return this.actions.push(new Oy(e)),this.infiniteLoop||(this.infiniteLoop=e.infiniteLoop),this}parallel(...e){return this.actions.push(new Oy(...e)),this.infiniteLoop||(this.infiniteLoop=e.some((e=>e.infiniteLoop))),this}sequence(...e){for(const t of e)this.actions.push(new Oy(t)),this.infiniteLoop||(this.infiniteLoop=t.infiniteLoop);return this}chain(e){return this.actions.push(...e.actions),this.infiniteLoop||(this.infiniteLoop=e.infiniteLoop),this}clone(){const e=new ky(this.target);return e.actions=[...this.actions],e.tags=[...this.tags],e.infiniteLoop=this.infiniteLoop,e.id=uv(),e}start(e){var t,i;if((e=e||this.tweenManager)||this.target&&((e=this.target.tweenManager)||(e=null===(t=this.target.app)||void 0===t?void 0:t.tweenManager)),e||(e=null===(i=Cy.app)||void 0===i?void 0:i.tweenManager),!e)return void console.error("tweenManager is null");void 0!==this.id&&e.stopById(this.id);let n=e.create(this.target,this);return this.runningTween=n,n}}class Ly{constructor(){this._running=[],this._runningChildren=[]}create(e,t){const i=new Ry(e,t,this);return i.getBlock(),this._running.push(i),i}createChildren(e,t,i){const n=new Ry(e,t,this);return n.root=i,n.getBlock(),n}addChildren(e){this._runningChildren.push(e)}update(e){const t=this._runningChildren;for(let i=t.length-1;i>=0;i--){const n=t[i];n.execute(e*n.root.timeScale)||t.splice(i,1)}const i=this._running;for(let t=i.length-1;t>=0;t--)i[t].execute(e)||(i[t]._finished=!0,i.splice(t,1))}stop(e){const t=this._running.indexOf(e);if(t<0)return;this._running.splice(t,1),e._finished=!0,e.paused=!1;const i=this._runningChildren;for(let t=i.length-1;t>=0;t--)i[t].root===e&&i.splice(t,1)}complete(e){const t=this._running.indexOf(e);if(t<0)return;e.paused=!1;const i=this._runningChildren;for(let t=i.length-1;t>=0;t--)i[t].root!==e||i[t].execute(1/0)||i.splice(t,1);!e.tween.infiniteLoop&&e.execute(1/0)||(this._running.splice(t,1),e._finished=!0)}stopById(e){for(let t=this._running.length-1;t>=0;t--)if(this._running[t].tween.id===e)return void this._running[t].stop()}stopAll(){for(let e=this._running.length-1;e>=0;e--)this._running[e].stop()}stopAllByTag(e){for(let t=this._running.length-1;t>=0;t--)this._running[t].tween.tags.indexOf(e)>-1&&this._running[t].stop()}completeAll(){for(let e=this._running.length-1;e>=0;e--)this._running[e].complete()}completeAllByTag(e){for(let t=this._running.length-1;t>=0;t--)this._running[t].tween.tags.indexOf(e)>-1&&this._running[t].complete()}}function zy(e){let{id:t,tag:i,from:n,to:s,by:r,duration:o,easing:a,yoyoForever:l,yoyoTimes:h,repeatForever:c,repeatTimes:d,delay:u,onComplete:p,onStart:f,onUpdate:m,onProgress:g,autoPlay:v}=e;null!=n||(n={value:0}),null!=s||(s={value:1}),null!=a||(a=Ey.linear);let y=new ky(n);t&&y.setId(t),i&&y.setTags(i),u&&y.delay(u);let x="to";return r&&(x="by"),y[x](o,s,{easing:a,onComplete:p,onStart:f,onUpdate:m,onProgress:g}),h&&y.yoyo(h),l&&y.yoyoForever(),d&&y.repeat(d),c&&y.repeatForever(),!1!==v&&y.start(),y}function Uy(e){return new Promise(((t,i)=>{try{let i=zy(Object.assign(Object.assign({easing:"linear"},e),{onComplete:(n,s,r)=>{(null==e?void 0:e.onComplete)&&(null==e||e.onComplete(n,s,r)),s&&t({anim:i,target:n,isEnd:s,isStop:r})}}))}catch(e){i(e)}}))}class Fy{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,t){const i=this._eventListeners;void 0===i[e]&&(i[e]=[]),i[e].includes(t)||i[e].push(t)}hasEventListener(e,t){const i=this._eventListeners;return void 0!==i[e]&&i[e].includes(t)}removeEventListener(e,t){const i=this._eventListeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){const t=this._eventListeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e)}}}function Ny(e){return Qv(this,void 0,void 0,(function*(){return yield new Promise((t=>setTimeout(t,Math.max(0,e))))}))}function jy(){return("undefined"==typeof performance?Date:performance).now()}class Vy extends Fy{constructor(){super(...arguments),this._onPointerDown=e=>{if(0!==e.button)return;if(!this._element)return;this._pointerUp=void 0;const t=e.clientX/this._element.clientWidth*2-1,i=-e.clientY/this._element.clientHeight*2+1,n=jy();this._pointerDown={x:t,y:i,time:n},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=e=>{if(!this._pointerDown||!this._pointer)return;if(!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,i=-e.clientY/this._element.clientHeight*2+1,n=jy();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:t-this._pointerDown.x,y:i-this._pointerDown.y,time:n-this._pointerDown.time},delta:{x:t-this._pointer.x,y:i-this._pointer.y,time:n-this._pointer.time}}),this._pointer={x:t,y:i,time:jy()},e.buttons%2==0&&this._onPointerUp(e)},this._onPointerUp=e=>{if(0!==e.button)return;if(!this._pointerDown)return;if(!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,i=-e.clientY/this._element.clientHeight*2+1,n=jy();this._pointerUp={x:t,y:i,time:n},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(e){this._element!==e&&(this._element&&this._removeElement(),this._element=e,this._element&&this._addElement())}_removeElement(){var e,t,i,n,s;null===(e=this._element)||void 0===e||e.removeEventListener("pointerdown",this._onPointerDown),null===(t=this._element)||void 0===t||t.removeEventListener("pointermove",this._onPointerMove),null===(i=this._element)||void 0===i||i.removeEventListener("pointerup",this._onPointerUp),null===(n=this._element)||void 0===n||n.removeEventListener("pointercancel",this._onPointerUp),null===(s=this._element)||void 0===s||s.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var e,t,i,n,s;null===(e=this._element)||void 0===e||e.addEventListener("pointerdown",this._onPointerDown),null===(t=this._element)||void 0===t||t.addEventListener("pointermove",this._onPointerMove),null===(i=this._element)||void 0===i||i.addEventListener("pointerup",this._onPointerUp),null===(n=this._element)||void 0===n||n.addEventListener("pointercancel",this._onPointerUp),null===(s=this._element)||void 0===s||s.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}}function Hy(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}function Wy({innerHTML:e="",id:t,classList:i,addToBody:n=!0,elementTag:s="div"}){const r=document.createElement(s);return t&&(r.id=t),r.innerHTML=e,i&&r.classList.add(...i),n&&document.body.appendChild(r),r}function Gy(e){return Qv(this,void 0,void 0,(function*(){return yield new Promise(((t,i)=>{const n=new Image;n.onload=()=>t(n),n.onerror=i,n.crossOrigin="anonymous",n.decoding="sync",n.src=e}))}))}function Yy(e,t=document.head){const i=document.createElement("style");return i.type="text/css",i.innerText=e,null==t||t.appendChild(i),i}function Xy(e,t=document.head){return Qv(this,void 0,void 0,(function*(){return yield new Promise(((i,n)=>{const s=document.createElement("script");s.setAttribute("src",e),s.addEventListener("load",(()=>i(s))),s.addEventListener("error",n),t.appendChild(s)}))}))}function Qy(e){if(!window)return console.warn("window is required"),"";let t="";const i=new Uint8Array(e),n=i.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(i[e]);return window.btoa(t)}function qy(e){if(!window)return console.warn("window is required"),new Uint8Array(0);const t=window.atob(e),i=t.length,n=new Uint8Array(i);for(let e=0;e<i;e++)n[e]=t.charCodeAt(e);return n.buffer}const Zy={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Ky(e,t){return new Zy[e](t)}function Jy(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}function $y(e){var t;if(!e||""===e||e.match(/__MACOSX\/.*\._/))return"";const i=null!==(t=(e=e.replace(/\?.*$/,"")).split(/[\\/]/).pop())&&void 0!==t?t:"",n=i.lastIndexOf(".");return""===i||n<1?"":i.slice(n+1)}function ex(e){return e.substring(e.lastIndexOf("/")+1)}function tx(e){return e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function ix(e,t,i){return e.replace(new RegExp(tx(t),"g"),i)}function nx(e){return e.sort(),e[0].split("").map(((t,i)=>e[e.length-1][i]===t?t:"\0")).join("").split("\0").at(0)||""}const sx=(e,...t)=>String.raw({raw:e},...t),rx=(e,...t)=>String.raw({raw:e},...t),ox=(e,...t)=>String.raw({raw:e},...t),ax=(e,...t)=>{let i=String.raw({raw:e},...t);return i=ix(i,"%","%25"),i=ix(i,"> <","><"),i=ix(i,"; }",";}"),i=ix(i,"<","%3c"),i=ix(i,">","%3e"),i=ix(i,'"',"'"),i=ix(i,"#","%23"),i=ix(i,"{","%7b"),i=ix(i,"}","%7d"),i=ix(i,"|","%7c"),i=ix(i,"^","%5e"),i=ix(i,"`","%60"),i=ix(i,"@","%40"),i=ix(i,"&","&amp;"),i=ix(i,"\n","%0A"),"data:image/svg+xml;charset=UTF-8,"+i};function lx(e=document.head){return Yy(rx`
            ::-webkit-scrollbar {
                width: 8px; /* for vertical scrollbars */
                height: 8px; /* for horizontal scrollbars */
            }
            ::-webkit-scrollbar-track {
                background: rgba(64, 64, 64, 0.4);
                border-radius: 6px;
            }
            ::-webkit-scrollbar-thumb {
                background: rgba(128, 128, 128, 0.2);
                border-radius: 6px;
            }
            ::-webkit-scrollbar-corner {
                background: rgba(0, 0, 0, 0.5);
            }
        `,e)}function hx(e,t,i){e="string"==typeof e?new Blob([e],null!=i?i:{type:"application/json"}):e;const n=window.URL.createObjectURL(e),s=document.createElement("a");s.style.display="none",s.href=n,s.download=t,document.body.appendChild(s),s.click(),setTimeout((()=>{document.body.removeChild(s),window.URL.revokeObjectURL(n)}),1e3)}function cx(e){return Qv(this,void 0,void 0,(function*(){return yield new Promise(((t,i)=>{const n=new FileReader;n.onload=e=>t(n.result),n.onerror=e=>i(n.error),n.onabort=e=>i(new Error("Read aborted")),n.readAsDataURL(e)}))}))}function dx(e,t){return hx(e,null!=t?t:e.name)}function ux(e=!1,t=!1,i){return Qv(this,void 0,void 0,(function*(){const n=document.createElement("input");n.type="file",n.multiple=e,n.accept=i||"*",n.webkitdirectory=t,n.style.display="none",document.body.appendChild(n),n.click();const s=yield new Promise((e=>{n.onchange=t=>{e(Array.from(n.files||[]))}}));return document.body.removeChild(n),s}))}function px(e,t){return Qv(this,void 0,void 0,(function*(){let i=yield ux(!1,!1,null!=e?e:".json");if(0==i.length)return;let n=i[0];return yield(s=n,r=t,new Promise(((e,t)=>{const i=new FileReader;i.onload=t=>{e(t.target.result)},i.onerror=e=>t(e),r?i.readAsArrayBuffer(s):i.readAsText(s)})));var s,r}))}function fx(){let e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function mx(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function gx(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function vx(e,t=1,i=1){const n=document.createElement("canvas");n.width=t,n.height=i;const s=n.getContext("2d");s.fillStyle="#"+e,s.fillRect(0,0,t,i);const r=n.toDataURL();return n.remove(),r}function yx(e,t){for(const i of t)if(!e.includes(i))return!1;return!0}function xx(e,t){for(let i=e.length-1;i>=0;i--)if(t(e[i]))return i;return-1}function bx(e,t){let i;do{i=Object.getOwnPropertyDescriptor(e,t)}while(!i&&(e=Object.getPrototypeOf(e)));return i}function _x(e,t,i=!0,n=!1){const s=bx(e,t);return!!(null==s?void 0:s.set)||i&&!1!==(null==s?void 0:s.writable)&&void 0===(null==s?void 0:s.get)||n&&!s}function Sx(e,t,i,n=!0,s=!1){return!(!e||!_x(e,t,n,s)||(e[t]=i,0))}function Mx(e,...t){return"function"==typeof e&&(e=e(...t)),e}function Cx(e,t,i){for(const n of i){const i=e[n];void 0!==i&&Sx(t,n,i,!0)}return t}const Ax={priority:1/0,serialize:(e,t)=>Object.fromEntries(Object.entries(e).map((([e,i])=>[e,Ex.Serialize(i,t,!1)]))),deserialize:(e,t,i)=>Object.assign(t||{},Object.fromEntries(Object.entries(e).map((([e,n])=>[e,Ex.Deserialize(n,null==t?void 0:t[e],i,!1)])))),isType:e=>(e.constructor||Object)===Object};class Ex{static GetSerializer(e){return Ex.Serializers.find((t=>t.isType(e)))}static RegisterSerializer(...e){var t;for(const i of e){const e=null!==(t=i.priority)&&void 0!==t?t:1e10,n=xx(Ex.Serializers,(t=>void 0!==t.priority&&t.priority<e));n>=0?Ex.Serializers.splice(n+1,0,i):Ex.Serializers.push(i)}}static UnregisterSerializer(...e){for(const t of e){const e=Ex.Serializers.indexOf(t);e>=0&&Ex.Serializers.splice(e,1)}}static Serialize(e,t,i=!1){var n,s;if("function"==typeof e)return;if(!i){const i=Ex.GetSerializer(e);if(i)return i.serialize(e,t);if("function"==typeof e.toJSON){const i=e.toJSON(t);return e.serializableClassId&&i&&(i.serializableClassId=e.serializableClassId),i}}let r=null!==(n=e.constructor)&&void 0!==n?n:Object;const o={};for(;r&&r!==Object;){const i=null!==(s=Ex.TypeMap.get(r))&&void 0!==s?s:[];for(const[n,s]of i)o[n]=Ex.Serialize(e[s],t,!1);r=Object.getPrototypeOf(r)}return e.serializableClassId&&(o.serializableClassId=e.serializableClassId),o}static Deserialize(e,t,i,n=!1){var s,r;if(void 0===e)return t;if(t===e)return t;if(e&&"object"==typeof e&&(e.constructor||Object)===Object&&e.resource&&"string"==typeof e.resource&&e.uuid){const n=null==i?void 0:i[e.resource];if(!n)return console.warn(`Resource ${e.resource} not found`),t;if("object"==typeof(e=n[e.uuid])&&(e.__useCount=e.__useCount?e.__useCount+1:1),e||console.warn(`Resource ${e.resource} with uuid ${e.uuid} not found`),t===e)return t;if(e&&"object"==typeof e){if((e.constructor||Object)!==Object)return t?(console.warn("replacing object",t,"with deserialized object from meta",e),e):e;console.error("Deserialize; meta should only have class instances, not js objects",e,t,i)}}if(e&&"object"==typeof e&&(e.constructor||Object)!==Object&&!Array.isArray(e)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",e,"source",t,e.constructor,e.constructor!==Object),e&&"object"==typeof e)if(!e.serializableClassId||t&&t.serializableClassId===e.serializableClassId)(e.constructor||Object)!==Object||t?Array.isArray(e)&&!t&&(t=[]):t={};else{const i=Ex.SerializableClasses.get(e.serializableClassId);i&&(t=i.DataInConstructor?new i(e):new i)}if("function"==typeof t)return console.error("cannot deserialize over function",t,e),t;if(!n){const n=Ex.GetSerializer(e);if(n&&n!==Ax)return n.deserialize(e,t,i)}if(!e||null==t||"object"!=typeof t)return e;if(!n&&"function"==typeof(null==t?void 0:t.fromJSON))return t.fromJSON(e,i),t;let o=null!==(s=t.constructor)&&void 0!==s?s:Object;if(o===Object)return Ax.deserialize(e,t,i);for(;o&&o!==Object;){const n=null!==(r=Ex.TypeMap.get(o))&&void 0!==r?r:[];for(const[s,r]of n){const n=t[r],o=Ex.Deserialize(e[s],n,i,!1);o!==n&&Sx(t,r,o,!0)}o=Object.getPrototypeOf(o)}return t}}function Tx(e,t="param"){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(i,n)=>{Object.defineProperty(i,n,{get(){return this[`_oc_${n}`]},set(i){var s;const r=this[`_oc_${n}`];if(r===i)return;this[`_oc_${n}`]=i;const o="param"===t?[n,i,r]:"object"===t?[{key:n,value:i,oldValue:r}]:"";if("string"==typeof e)null===(s=this[e])||void 0===s||s.call(this,...o);else if("function"==typeof e){let t=!1;if(e.name){let i=this;for(;i;){if(i[e.name]===e){e.call(this,...o),t=!0;break}i=Object.getPrototypeOf(i)}}t||(e.name&&this[e.name].name===`bound ${e.name}`?this[e.name](...o):e(...o))}}})}}function Px(e,t="void"){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return Tx(e,t)}function Ox(e,t="object"){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return Tx(e,t)}function Dx(e){return(t,i)=>{const n=t.constructor;if(n===Object)throw new Error("All properties in an object are serialized by default");Ex.TypeMap.has(n)||Ex.TypeMap.set(n,[]),Ex.TypeMap.get(n).push([e||i,i])}}function Bx(e){return t=>(t=class extends t{constructor(){super(...arguments),this.serializableClassId=e}},Ex.SerializableClasses.set(e,t),t)}function Ix(e,t,i){return Qv(this,void 0,void 0,(function*(){const n="string"==typeof t?(new TextEncoder).encode(t):t,s=yield crypto.subtle.digest("SHA-256",n),r=crypto.getRandomValues(new Uint8Array(12)),o=Array.from(r).map((e=>String.fromCharCode(e))).join(""),a={name:"AES-GCM",iv:r},l=yield crypto.subtle.importKey("raw",s,a,!1,["encrypt"]),h="string"==typeof e?(new TextEncoder).encode(e):e,c=yield crypto.subtle.encrypt(a,l,h),d=new Uint8Array(c),u=Array.from(d),p=u.map((e=>String.fromCharCode(e))).join(""),f=i?"string"==typeof i?i:(new TextDecoder).decode(i):"",m=i?"string"==typeof i?(new TextEncoder).encode(i):Array.from(i):[];return"string"==typeof e?f+o+p:new Uint8Array([...m,...r,...u])}))}function Rx(e,t){return Qv(this,void 0,void 0,(function*(){const i="string"==typeof t?(new TextEncoder).encode(t):t,n=yield crypto.subtle.digest("SHA-256",i),s=e.slice(0,12),r={name:"AES-GCM",iv:"string"==typeof s?new Uint8Array(Array.from(s).map((e=>e.charCodeAt(0)))):s},o=yield crypto.subtle.importKey("raw",n,r,!1,["decrypt"]),a=e.slice(12),l="string"==typeof a?new Uint8Array(Array.from(a).map((e=>e.charCodeAt(0)))):a;try{const t=yield crypto.subtle.decrypt(r,o,l);return"string"==typeof e?(new TextDecoder).decode(t):new Uint8Array(t)}catch(e){throw new Error("Decrypt failed")}}))}function kx(e,t=8192,i=!1){var n;if(!e.width||!e.height)return"";const s=document.createElement("canvas");s.width=Math.min(t,e.width),s.height=Math.floor(1+s.width*e.height/e.width);const r=e instanceof ImageBitmap,o=r&&i&&Math.abs(s.width-e.width)<.5?s.getContext("bitmaprenderer"):void 0;o?o.transferFromImageBitmap(e):null===(n=s.getContext("2d"))||void 0===n||n.drawImage(e,0,0,s.width,s.height);const a=s.toDataURL("image/png");return s.remove(),r&&i&&e.close(),a}function Lx(e){return Qv(this,void 0,void 0,(function*(){return yield new Promise(((t,i)=>{const n=new Image;n.addEventListener("load",(()=>{const e=document.createElement("canvas");e.width=n.width,e.height=n.height;const s=e.getContext("2d");if(!s)return void i(new Error("Could not get 2d context"));s.drawImage(n,0,0,e.width,e.height);const r=s.getImageData(0,0,e.width,e.height);t(r),e.remove(),n.remove()}),!1),n.addEventListener("error",(e=>{n.remove(),i(e)}),!1),n.src=e}))}))}function zx(e,{backgroundColor:t="",scale:i=1,width:n=512,height:s=512}){const r=document.createElement("canvas"),o=r.getContext("2d"),a=i,l=n,h=s;return r.width=l*a,r.height=h*a,r.style.width=`${l}`,r.style.height=`${h}`,(null==t?void 0:t.length)>0&&(o.fillStyle=t,o.fillRect(0,0,r.width,r.height)),o.drawImage(e,0,0,r.width,r.height),r}function Ux(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t}function Fx(){const e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&e.toDataURL("image/webp").startsWith("data:image/webp")}function Nx(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");if(!i)throw new Error("Unable to get 2d context");return i.translate(0,e.height),i.scale(1,-1),i.drawImage(e,0,0),t}Ex.TypeMap=new Map,Ex.SerializableClasses=new Map,Ex.Serializers=[{priority:0,isType:e=>Array.isArray(e),serialize:(e,t)=>e.map((e=>Ex.Serialize(e,t,!1))),deserialize:(e,t,i)=>{const n=e.length;Array.isArray(t)||(t=[]);for(let s=0;s<n;s++){const n=e[s],r=t.length>s?Ex.Deserialize(n,t[s],i,!1):Ex.Deserialize(n,void 0,i,!1);t.length<=s?t.push(r):t[s]=r}return t}},{priority:0,isType:e=>!e||"object"!=typeof e,serialize:e=>{if(e&&"number"==typeof e){if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN"}return e},deserialize:(e,t)=>{if("number"==typeof t){if("Infinity"===e)return 1/0;if("-Infinity"===e)return-1/0;if("NaN"===e)return NaN;if("number"==typeof e||!e)return e}return e}},Ax];const jx=e=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${e}'/%3E%3C/svg%3E%0A`,Vx=e=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${e}'/%3E%3C/svg%3E%0A`,Hx=e=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${e}%3C/text%3E%3C/svg%3E%0A`,Wx=(e,t)=>Qv(void 0,void 0,void 0,(function*(){return zx(yield Gy(e),t)})),Gx=(e,t)=>Qv(void 0,void 0,void 0,(function*(){return yield Wx(e,t).then((e=>e.toDataURL("image/png")))})),Yx=e=>Qv(void 0,void 0,void 0,(function*(){return yield cx(yield(yield fetch(e)).blob())}));function Xx(e,t=Yx){return Qv(this,void 0,void 0,(function*(){const i=e.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(i)for(const n of i){const i=yield t(n);e=e.replace(n,i)}return e}))}function Qx(e,t,{width:i,height:n},s=!0){const r=`\n<svg viewBox="0 0 ${i} ${n}" xmlns="http://www.w3.org/2000/svg">\n    <style>\n    ${t}\n    </style>\n    <foreignObject x="0" y="0" width="100%" height="100%">\n        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">\n            ${e}\n        </div>\n    </foreignObject>\n</svg>\n    `;return s?ax(r):r}function qx(e,t,i){return Qv(this,void 0,void 0,(function*(){"string"!=typeof e&&(e=(new XMLSerializer).serializeToString(e));const n=Qx(e,t,i);return yield Wx(n,i)}))}function Zx(e,t,i){return Qv(this,void 0,void 0,(function*(){const n=Qx(e,t,i);return yield Gx(n,i)}))}function Kx(e,t){return Math.abs(e)>Math.abs(t)?e:t}function Jx(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function $x(e,t){return e&~(1<<t)}function ew(e,t,i=!1){for("string"==typeof e&&(e=e.split("."));e.length>0;){if(!t)return;const n=e.splice(0,1)[0];if(!(n.length<1)){if(!(n in t)){if(i)throw new Error("invalid access, check "+n+" in "+t);return}t=t[n]}}return t}function tw(e,t){return Object.keys(e).find((i=>e[i]===t))}function iw(e,t){return Object.hasOwn?Object.hasOwn(e,t):e.hasOwnProperty(t)}function nw(e,t=null){var i;return null!==(i=new URL(window.location.href).searchParams.get(e))&&void 0!==i?i:t}function sw(e,t,i=!1){const n=new URLSearchParams(location.search);null==t?n.has(e)&&n.delete(e):n.set(e,t),i?window.location.search=n.toString():window.history.replaceState({},"","?"+n.toString())}function rw(e,t="/"){return e.join(t)}function ow(e,t){const i=(t?`var Module = { locateFile: function(s) { return "${t}"; } }; \n`:"")+`importScripts( "${e}" );`;return URL.createObjectURL(new Blob([i],{type:"text/javascript"}))}class aw{}function lw(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}const hw={},cw=function(e){const t=Symbol("vjworker.proxy"),i=Symbol("vjworker.endpoint"),n=Symbol("vjworker.releaseProxy"),s=Symbol("vjworker.finalizer"),r=Symbol("vjworker.thrown"),o=e=>"object"==typeof e&&null!==e||"function"==typeof e,a=new Map([["proxy",{canHandle:e=>o(e)&&e[t],serialize(e){const{port1:t,port2:i}=new MessageChannel;return l(e,t),[i,[i]]},deserialize:e=>(e.start(),c(e))}],["throw",{canHandle:e=>o(e)&&r in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function l(e,t=globalThis,i=["*"]){t.addEventListener("message",(function n(o){if(!o||!o.data)return;if(!function(e,t){for(const i of e){if(t===i||"*"===i)return!0;if(i instanceof RegExp&&i.test(t))return!0}return!1}(i,o.origin))return void console.warn("Invalid origin  for vjworker proxy");const{id:a,type:c,path:d}=Object.assign({path:[]},o.data),u=(o.data.argumentList||[]).map(b);let p;try{const t=d.slice(0,-1).reduce(((e,t)=>e[t]),e),i=d.reduce(((e,t)=>e[t]),e);switch(c){case"GET":p=i;break;case"SET":t[d.slice(-1)[0]]=b(o.data.value),p=!0;break;case"APPLY":p=i.apply(t,u);break;case"CONSTRUCT":p=x(new i(...u));break;case"ENDPOINT":{const{port1:t,port2:i}=new MessageChannel;l(e,i),p=y(t,[t])}break;case"RELEASE":p=void 0;break;default:return}}catch(e){p={value:e,[r]:0}}Promise.resolve(p).catch((e=>({value:e,[r]:0}))).then((i=>{const[r,o]=w(i);t.postMessage(Object.assign(Object.assign({},r),{id:a}),o),"RELEASE"===c&&(t.removeEventListener("message",n),h(t),s in e&&"function"==typeof e[s]&&e[s]())})).catch((e=>{const[i,n]=w({value:new TypeError("Unserializable return value"),[r]:0});t.postMessage(Object.assign(Object.assign({},i),{id:a}),n)}))})),t.start&&t.start()}function h(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function c(e,t){return m(e,[],t)}function d(e){if(e)throw new Error("Proxy has been released and is not useable")}function u(e){return _(e,{type:"RELEASE"}).then((()=>{h(e)}))}const p=new WeakMap,f="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(p.get(e)||0)-1;p.set(e,t),0===t&&u(e)}));function m(e,t=[],s=function(){}){let r=!1;const o=new Proxy(s,{get(i,s){if(d(r),s===n)return()=>{!function(e){f&&f.unregister(e)}(o),u(e),r=!0};if("then"===s){if(0===t.length)return{then:()=>o};const i=_(e,{type:"GET",path:t.map((e=>e.toString()))}).then(b);return i.then.bind(i)}return m(e,[...t,s])},set(i,n,s){d(r);const[o,a]=w(s);return _(e,{type:"SET",path:[...t,n].map((e=>e.toString())),value:o},a).then(b)},apply(n,s,o){d(r);const a=t[t.length-1];if(a===i)return _(e,{type:"ENDPOINT"}).then(b);if("bind"===a)return m(e,t.slice(0,-1));const[l,h]=g(o);return _(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:l},h).then(b)},construct(i,n){d(r);const[s,o]=g(n);return _(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:s},o).then(b)}});return function(e,t){const i=(p.get(t)||0)+1;p.set(t,i),f&&f.register(e,t,e)}(o,e),o}function g(e){const t=e.map(w);return[t.map((e=>e[0])),(i=t.map((e=>e[1])),Array.prototype.concat.apply([],i))];var i}const v=new WeakMap;function y(e,t){return v.set(e,t),e}function x(e){return Object.assign(e,{[t]:!0})}function w(e){for(const[t,i]of a)if(i.canHandle(e)){const[n,s]=i.serialize(e);return[{type:"HANDLER",name:t,value:n},s]}return[{type:"RAW",value:e},v.get(e)||[]]}function b(e){switch(e.type){case"HANDLER":return a.get(e.name).deserialize(e.value);case"RAW":return e.value}}function _(e,t,i){return new Promise((n=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(i){i.data&&i.data.id&&i.data.id===s&&(e.removeEventListener("message",t),n(i.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),i)}))}e.createEndpoint=i,e.expose=l,e.finalizer=s,e.proxy=x,e.proxyMarker=t,e.releaseProxy=n,e.transfer=y,e.transferHandlers=a,e.windowEndpoint=function(e,t=globalThis,i="*"){return{postMessage:(t,n)=>e.postMessage(t,i,n),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}},e.wrap=c},dw=`!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vjworker={})}(this,(${cw.toString()}));`;cw(hw);const uw=dw+";var workerWrap = vjworker.wrap;var workerProxy = vjworker.proxy;var workerTransfer = vjworker.transfer;";function pw(e,t){let i,n="";if(t)for(let e in t)"function"==typeof t[e]?t[e].name?n+=`function ${e}(`+t[e].toString().substring(9+t[e].name.length+1)+"\n":n+=`function ${e}(`+t[e].toString().substring(9)+"\n":"string"==typeof t[e]&&(n+=t[e]+"\n");if("function"==typeof e){const t=Function.prototype.toString;i=URL.createObjectURL(new Blob([`${t.call(lw)}\n${n}\n${uw}\nvjworker.expose(${t.call(e)})`]))}else"string"==typeof e&&(i=e,e.indexOf("blob:"));if(i)return new Worker(i);throw"WorkerProxy only supports functions, classes, urls"}function fw(e,t){return hw.wrap(e,t)}function mw(e){return hw.proxy(e)}function gw(e,t){return hw.transfer(e,t)}function vw(){return hw}function yw(e,t,i){let n=pw(e,t);return{worker:n,wrap:fw(n,i)}}class xw extends aw{init(e,t,i,n){if(!this.api){if(!n)throw new Error("workerFilePath is required");(()=>{Qv(this,void 0,void 0,(function*(){const s=yield fetch(n).then((e=>e.blob())),r=URL.createObjectURL(s),o=new Worker(r,{type:"module"});this.api=yield new(fw(o))(mw((()=>{e(),URL.revokeObjectURL(r)})),mw(((e,t)=>"xatlas_web.wasm"===e?i:e+t)),mw(t))}))})()}}}class ww{constructor(e,t={bilinear:!0,blockAlign:!1,bruteForce:!1,createImage:!1,maxChartSize:0,padding:0,resolution:0,rotateCharts:!0,rotateChartsToAxis:!0,texelsPerUnit:0},i={fixWinding:!1,maxBoundaryLength:0,maxChartArea:0,maxCost:2,maxIterations:1,normalDeviationWeight:2,normalSeamWeight:4,roundnessWeight:.009999999776482582,straightnessWeight:6,textureSeamWeight:.5,useInputMeshUvs:!0},n=!0,s=!1,r=!1){this.THREE=e,this.packOptions=t,this.chartOptions=i,this.useNormals=n,this.timeUnwrap=s,this.logProgress=r,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createUvAtlas()}loadLibrary(e,t,i){return Qv(this,void 0,void 0,(function*(){if(null!=t||(t=eL.loaderUrlPath+"uvatlas/xatlas.wasm"),null!=i||(i=eL.loaderUrlPath+"uvatlas/xatlas.js"),!this._libraryLoaded){for(null!=e||(e=()=>{}),yield new Promise(((n,s)=>{try{this.xAtlas.init((()=>{n()}),e,t,i)}catch(e){s(e)}}));!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise((e=>setTimeout(e,100)));this._libraryLoaded=!0}}))}packAtlas(e,t="uv2",i="uv"){return Qv(this,void 0,void 0,(function*(){if(!this._libraryLoaded)return console.warn("uvatlas: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const n=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("uvatlas: unwrapping another mesh, waiting 100 ms"),yield new Promise((e=>setTimeout(e,100)));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let s=[],r="";for(let t of e){let{uuid:e,index:i,attributes:o}=t;const a=t.userData.worldScale||1;s.push(e),i&&o.position&&3===o.position.itemSize?(r="Mesh"+s.length+" added to atlas: "+e,this.timeUnwrap&&console.time(r),yield this.xAtlas.api.addMesh(i.array,o.position.array,o.normal?o.normal.array:void 0,o.uv?o.uv.array:void 0,e,this.useNormals,n,a),this.timeUnwrap&&console.timeEnd(r)):console.warn("uvatlas: Geometry not supported: ",t)}r="Generated atlas with "+s.length+" meshes",this.timeUnwrap&&console.time(r);let o=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(r);let a=[];for(let n of o){let s=e.find((e=>e.uuid===n.mesh));s?(n.vertex.vertices&&s.setAttribute("position",new this.THREE.BufferAttribute(n.vertex.vertices,3,!1)),n.vertex.normals&&s.setAttribute("normal",new this.THREE.BufferAttribute(n.vertex.normals,3,!0)),n.vertex.coords1&&s.setAttribute(t,new this.THREE.BufferAttribute(n.vertex.coords1,2,!1)),n.vertex.coords&&t!==i&&s.setAttribute(i,new this.THREE.BufferAttribute(n.vertex.coords,2,!1)),n.index&&s.setIndex(new this.THREE.BufferAttribute(n.index,1,!1)),a.push(s)):console.error("uvatlas: Mesh not found: ",n.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,a}))}unwrapGeometry(e,t="uv",i="uv2"){return Qv(this,void 0,void 0,(function*(){return this.packAtlas([e],t,i)}))}}class bw extends ww{_createUvAtlas(){return new xw}}var _w,Sw,Mw,Cw,Aw,Ew,Tw,Pw,Ow,Dw,Bw,Iw,Rw,kw,Lw,zw;class Uw extends Kv{get uiConfig(){return this._uiConfig?this._uiConfig:"function"==typeof this.setupUiConfig?(this._uiConfig=this.setupUiConfig(),this._uiConfig):void 0}constructor(e){var t,i,n,s,r,o;if(super(),_w.add(this),Sw.set(this,1),Mw.set(this,1),Cw.set(this,!0),Aw.set(this,void 0),Ew.set(this,void 0),Tw.set(this,60),Pw.set(this,1e3/60),Ow.set(this,!1),Dw.set(this,!1),Bw.set(this,!1),Iw.set(this,new ry),Rw.set(this,!0),kw.set(this,[]),this._modules=[],this.needRenderUpdate=!0,this.moduleManager=new wy(!0),this.data=hg({}),this.containerSize=lg({width:0,height:0}),this.tweenManager=new Ly,this._animate=()=>{var e,t;qv(this,Sw,"f")?(Zv(this,Aw,requestAnimationFrame(this._animate),"f"),0==(Zv(this,Mw,(t=qv(this,Mw,"f"),e=t++,t),"f"),e%qv(this,Sw,"f"))&&(this.update(),Zv(this,Mw,1,"f"))):(Zv(this,Ew,window.setTimeout(this._animate,qv(this,Pw,"f")),"f"),this.update())},e.offscreenCanvas?this.offscreenCanvas=new OffscreenCanvas(null!==(t=e.offscreenCanvas.width)&&void 0!==t?t:512,null!==(i=e.offscreenCanvas.height)&&void 0!==i?i:512):Cy.app=this,this.options=e,null===(n=this.options)||void 0===n?void 0:n.container)if("string"==typeof this.options.container){const e=document.getElementById(this.options.container);if(!e)throw`${this.options.container} element id is not exist`;this.container=e}else this.container=this.options.container;else this.offscreenCanvas?(this.container=Wy({}),this.container.style.width=(null!==(s=null==e?void 0:e.offscreenCanvas.width)&&void 0!==s?s:"512")+"px",this.container.style.height=(null!==(r=null==e?void 0:e.offscreenCanvas.height)&&void 0!==r?r:"512")+"px"):this.container=document.body;Zv(this,Rw,null===(o=this.options.enableTweenManager)||void 0===o||o,"f"),!1!==this.options.autoStart&&this.run()}get container(){return this.data.container}set container(e){this.data.container=e}get domElement(){return this.data.domElement}set domElement(e){this.data.domElement=e}get camera(){return this.data.camera}set camera(e){this.data.camera=e}get scene(){return this.data.scene}set scene(e){this.data.scene=e}get cameraControl(){return this.data.cameraControls}get isPaused(){return qv(this,Cw,"f")}get vSyncCount(){return qv(this,Sw,"f")}set vSyncCount(e){Zv(this,Sw,Math.max(0,Math.floor(e)),"f")}get time(){return qv(this,Iw,"f")}get targetFrameRate(){return qv(this,Tw,"f")}set targetFrameRate(e){e=Math.max(1e-6,e),Zv(this,Tw,e,"f"),Zv(this,Pw,1e3/e,"f")}onNextFrame(e){const t=i=>{e(i);let n=qv(this,kw,"f").indexOf(t);n<0||qv(this,kw,"f").splice(n,1)};qv(this,kw,"f").push(t)}pause(){Zv(this,Cw,!0,"f"),cancelAnimationFrame(qv(this,Aw,"f")),clearTimeout(qv(this,Ew,"f"))}resume(){qv(this,Cw,"f")&&(Zv(this,Cw,!1,"f"),this.time._reset(),Zv(this,Aw,requestAnimationFrame(this._animate),"f"))}run(){this.resume(),this.dispatch("run",this)}update(){var e;let t=null!==(e=this.data._isLogTime)&&void 0!==e&&e;t&&console.time("app update time:");const i=qv(this,Iw,"f");i._update(),this.needRenderUpdate=!0,Zv(this,Ow,!0,"f"),this.data._renderTempData={},qv(this,_w,"m",Lw).call(this,qv(this,kw,"f")),qv(this,Rw,"f")&&this.tweenManager.update(1e3*i.deltaTime),this.callModules("onAppStart",i),this.callModules("onAppBeforeUpdate",i),this.callModules("onAppUpdate",i),this.callModules("onAppAfterUpdate",i),this.callModules("onAppBeforeRender",i),this.callModules("onAppRender",i),this.callModules("onAppAfterRender",i),qv(this,Dw,"f")&&this._destroy(),this.data._renderTempData={},Zv(this,Ow,!1,"f"),t&&console.timeEnd("app update time:")}get destroyed(){return qv(this,Bw,"f")}_destroy(){this.dispatch("shutdown",this),this.pause(),Zv(this,Iw,null,"f"),Zv(this,Dw,!1,"f"),Zv(this,Bw,!0,"f"),this.offscreenCanvas&&(this.container.remove(),delete this.offscreenCanvas,this.offscreenCanvas=null)}destroy(){qv(this,Bw,"f")||(qv(this,Ow,"f")?Zv(this,Dw,!0,"f"):this._destroy())}addModule(e,t){return this.add(e,t)}add(e,t){My._addCheck(this,e);const i=this.getModule(e);if(i)return i;const n=new e(this,t);return n.app=this,this._modules.push(n),this.moduleManager.addModule(n),n._setActive(!0),n}getModule(e){const t=this._modules;for(let i=t.length-1;i>=0;i--){const n=t[i];if(n instanceof e)return n}}removeModule(e){const t=this._modules;let i=-1;for(i=t.length-1;i>=0&&!(t[i]instanceof e);i--);i>=0&&(t[i]._onDestroy(),this.moduleManager.removeModule(t[i]),t.splice(i,1))}removeAllModules(){const e=this._modules;let t=-1;for(t=e.length-1;t>=0;t--)e[t]._onDestroy(),this.moduleManager.removeModule(e[t]);this._modules.length=0}callModules(e,...t){(t=t||[]).push(new _y(e)),this.moduleManager.callModules(e,...t),this.dispatch(e,...t),this.signal&&this.signal[e]&&this.signal[e].dispatch(...t)}}Sw=new WeakMap,Mw=new WeakMap,Cw=new WeakMap,Aw=new WeakMap,Ew=new WeakMap,Tw=new WeakMap,Pw=new WeakMap,Ow=new WeakMap,Dw=new WeakMap,Bw=new WeakMap,Iw=new WeakMap,Rw=new WeakMap,kw=new WeakMap,_w=new WeakSet,Lw=function(e){if(0===e.length)return;const t=[];for(let i=0;i<e.length;i++)t.push(e[i]);for(let e=0;e<t.length;e++)t[e](this)};class Fw extends xy{constructor(e){super(),this.app=e,this.isAppModule=!0}}class Nw extends yy{constructor(e){super(null==e?void 0:e.app),zw.set(this,[]),this.uuid=uv(),this.moduleManager=new wy,this.options=e||{}}get modules(){return qv(this,zw,"f")}addModule(e,t){return this.add(e,t)}add(e,t){My._addCheck(this,e);const i=this.getModule(e);if(i)return i;const n=new e(this,t);return n.extData.moduleParamerter={cls:e,param:t},n.entity=this,qv(this,zw,"f").push(n),this.moduleManager.addModule(n),this.app?(n.app=this.app,this.app.moduleManager.addModule(n),n._setActive(!0)):this.addDispose(this.onSetApp.addOne((e=>{n.app=e,e.moduleManager.addModule(n),n._setActive(!0)}))),n}getModule(e){const t=qv(this,zw,"f");for(let i=t.length-1;i>=0;i--){const n=t[i];if(n instanceof e)return n}}removeModule(e){var t;const i=qv(this,zw,"f");let n=-1;for(n=i.length-1;n>=0&&!(i[n]instanceof e);n--);n>=0&&(i[n]._onDestroy(),this.moduleManager.removeModule(i[n]),null===(t=this.app)||void 0===t||t.moduleManager.removeModule(i[n]),i.splice(n,1))}removeAllModules(){var e;const t=qv(this,zw,"f");let i=-1;for(i=t.length-1;i>=0;i--)t[i]._onDestroy(),this.moduleManager.removeModule(t[i]),null===(e=this.app)||void 0===e||e.moduleManager.removeModule(t[i]);Zv(this,zw,[],"f")}callModules(e,...t){this.traverse((i=>{(t=t||[]).push(new _y(e)),i.moduleManager.callModules(e,...t),i.dispatch(e,...t),this.signal&&this.signal[e]&&this.signal[e].dispatch(...t)}))}}function jw(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}zw=new WeakMap;var Vw={exports:{}};Vw.exports=function e(t,i,n){function s(o,a){if(!i[o]){if(!t[o]){if(!a&&jw)return jw(o);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[o]={exports:{}};t[o][0].call(h.exports,(function(e){return s(t[o][1][e]||e)}),h,h.exports,e,t,i,n)}return i[o].exports}for(var r=jw,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,t,i){var n,s,r,o,a,l={}.hasOwnProperty;n=e("./PriorityQueue/AbstractPriorityQueue"),s=e("./PriorityQueue/ArrayStrategy"),o=e("./PriorityQueue/BinaryHeapStrategy"),r=e("./PriorityQueue/BHeapStrategy"),a=function(e){function t(e){e||(e={}),e.strategy||(e.strategy=o),e.comparator||(e.comparator=function(e,t){return(e||0)-(t||0)}),t.__super__.constructor.call(this,e)}return function(e,t){for(var i in t)l.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(t,e),t}(n),a.ArrayStrategy=s,a.BinaryHeapStrategy=o,a.BHeapStrategy=r,t.exports=a},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(e,t,i){t.exports=function(){function e(e){var t;if(null==(null!=e?e.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=e?e.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new e.strategy(e),this.length=(null!=e&&null!=(t=e.initialValues)?t.length:void 0)||0}return e.prototype.queue=function(e){this.length++,this.priv.queue(e)},e.prototype.dequeue=function(e){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},e.prototype.peek=function(e){if(!this.length)throw"Empty queue";return this.priv.peek()},e.prototype.clear=function(){return this.length=0,this.priv.clear()},e}()},{}],3:[function(e,t,i){var n;n=function(e,t,i){var n,s,r;for(s=0,n=e.length;s<n;)i(e[r=s+n>>>1],t)>=0?s=r+1:n=r;return s},t.exports=function(){function e(e){var t;this.options=e,this.comparator=this.options.comparator,this.data=(null!=(t=this.options.initialValues)?t.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return e.prototype.queue=function(e){var t;t=n(this.data,e,this.comparator),this.data.splice(t,0,e)},e.prototype.dequeue=function(){return this.data.pop()},e.prototype.peek=function(){return this.data[this.data.length-1]},e.prototype.clear=function(){this.data.length=0},e}()},{}],4:[function(e,t,i){t.exports=function(){function e(e){var t,i,n,s,r,o,a,l;for(this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.pageSize=(null!=e?e.pageSize:void 0)||512,this.length=0,a=0;1<<a<this.pageSize;)a+=1;if(1<<a!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=a,this._emptyMemoryPageTemplate=t=[],i=0,r=this.pageSize;0<=r?i<r:i>r;0<=r?++i:--i)t.push(null);if(this._memory=[],this._mask=this.pageSize-1,e.initialValues)for(n=0,s=(o=e.initialValues).length;n<s;n++)l=o[n],this.queue(l)}return e.prototype.queue=function(e){this.length+=1,this._write(this.length,e),this._bubbleUp(this.length,e)},e.prototype.dequeue=function(){var e,t;return e=this._read(1),t=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,t),this._bubbleDown(1,t)),e},e.prototype.peek=function(){return this._read(1)},e.prototype.clear=function(){this.length=0,this._memory.length=0},e.prototype._write=function(e,t){var i;for(i=e>>this._shift;i>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[i][e&this._mask]=t},e.prototype._read=function(e){return this._memory[e>>this._shift][e&this._mask]},e.prototype._bubbleUp=function(e,t){var i,n,s,r;for(i=this.comparator;e>1&&(n=e&this._mask,e<this.pageSize||n>3?s=e&~this._mask|n>>1:n<2?(s=e-this.pageSize>>this._shift,s+=s&~(this._mask>>1),s|=this.pageSize>>1):s=e-2,!(i(r=this._read(s),t)<0));)this._write(s,t),this._write(e,r),e=s},e.prototype._bubbleDown=function(e,t){var i,n,s,r,o;for(o=this.comparator;e<this.length;)if(e>this._mask&&!(e&this._mask-1)?i=n=e+2:e&this.pageSize>>1?(i=(e&~this._mask)>>1,n=1+(i=1+(i|=e&this._mask>>1)<<this._shift)):n=(i=e+(e&this._mask))+1,i!==n&&n<=this.length)if(s=this._read(i),r=this._read(n),o(s,t)<0&&o(s,r)<=0)this._write(i,t),this._write(e,s),e=i;else{if(!(o(r,t)<0))break;this._write(n,t),this._write(e,r),e=n}else{if(!(i<=this.length))break;if(!(o(s=this._read(i),t)<0))break;this._write(i,t),this._write(e,s),e=i}},e}()},{}],5:[function(e,t,i){t.exports=function(){function e(e){var t;this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.length=0,this.data=(null!=(t=e.initialValues)?t.slice(0):void 0)||[],this._heapify()}return e.prototype._heapify=function(){var e,t,i;if(this.data.length>0)for(e=t=1,i=this.data.length;1<=i?t<i:t>i;e=1<=i?++t:--t)this._bubbleUp(e)},e.prototype.queue=function(e){this.data.push(e),this._bubbleUp(this.data.length-1)},e.prototype.dequeue=function(){var e,t;return t=this.data[0],e=this.data.pop(),this.data.length>0&&(this.data[0]=e,this._bubbleDown(0)),t},e.prototype.peek=function(){return this.data[0]},e.prototype.clear=function(){this.length=0,this.data.length=0},e.prototype._bubbleUp=function(e){for(var t,i;e>0&&(t=e-1>>>1,this.comparator(this.data[e],this.data[t])<0);)i=this.data[t],this.data[t]=this.data[e],this.data[e]=i,e=t},e.prototype._bubbleDown=function(e){var t,i,n,s,r;for(t=this.data.length-1;s=1+(i=1+(e<<1)),n=e,i<=t&&this.comparator(this.data[i],this.data[n])<0&&(n=i),s<=t&&this.comparator(this.data[s],this.data[n])<0&&(n=s),n!==e;)r=this.data[n],this.data[n]=this.data[e],this.data[e]=r,e=n},e}()},{}]},{},[1])(1);var Hw=sv(Vw.exports);class Ww{constructor(e){this.command=e,this.isCancelledCommandException=!0}toString(){return`Cancelled command ${this.command.id}`}}let Gw=0;function Yw(e,t){const i=t.priority-e.priority;return 0===i?t.timestamp-e.timestamp:i}function Xw(){return{queue(e){let t=this.storages.get(e.id);t||(t={q:new Hw({comparator:Yw}),priority:1,accumulator:0},this.storages.set(e.id,t)),t.priority=e.priority||1,t.q.queue(e),this.counters.pending++},storages:new Map,counters:{executing:0,executed:0,failed:0,cancelled:0,pending:0},execute(e,t){return this.counters.pending--,this.counters.executing++,(t?t.executeCommand:e.executeCommand)(e).then((t=>{this.counters.executing--,e.resolve(t),this.counters.executed++}),(t=>{this.counters.executing--,e.reject(t),this.counters.failed++}))}}}class Qw{constructor(){this.defaultQueue=Xw(),this.hostQueues=new Map,this.providers={},this.maxCommandsPerHost=6}runCommand(e,t,i){const n=e.protocol?this.getProtocolProvider(e.protocol):null;if(e.protocol){if(!n)throw new Error(`No known provider for layer ${e.id}`)}else if(!e.executeCommand)throw new Error(`No executeCommand callback for layer ${e.id}`);t.execute(e,n,i).then((()=>{if(e.notifyChange&&e.notifyChange(e),t.counters.executing<this.maxCommandsPerHost){const e=this.deQueue(t);e&&this.runCommand(e,t)}}))}execute(e){const t=e.url?new URL(function(e){const t=/\$\{u:([\w-_.|]+)\}/.exec(e);if(!t)return e;const i=t[1].split("|");return e.replace(t[0],i[Gw++%i.length])}(e.url),document.location).host:void 0;e.promise=new Promise(((t,i)=>{e.resolve=t,e.reject=i})),t&&!this.hostQueues.has(t)&&this.hostQueues.set(t,Xw());const i=t?this.hostQueues.get(t):this.defaultQueue;return e.timestamp=Date.now(),i.queue(e),i.counters.executing<this.maxCommandsPerHost&&Promise.resolve().then((()=>{if(i.counters.executing<this.maxCommandsPerHost){const e=this.deQueue(i);e&&this.runCommand(e,i)}})),e.promise}addProtocolProvider(e,t){if("function"!=typeof t.executeCommand)throw new Error(`Can't add provider for ${e}: missing a executeCommand function.`);this.providers[e]=t}getProtocolProvider(e){return this.providers[e]}commandsWaitingExecutionCount(){let e=this.defaultQueue.counters.pending+this.defaultQueue.counters.executing;for(const t of this.hostQueues)e+=t[1].counters.pending+t[1].counters.executing;return e}commandsRunningCount(){let e=this.defaultQueue.counters.executing;for(const t of this.hostQueues)e+=t[1].counters.executing;return e}resetCommandsCount(e){let t=this.defaultQueue.counters[e];this.defaultQueue.counters[e]=0;for(const i of this.hostQueues)t+=i[1].counters[e],i[1].counters[e]=0;return t}deQueue(e){const t=function(e){let t,i,n=0;for(const s of e){const e=s[1];e.q.length>0&&(n+=e.priority,e.accumulator+=e.priority,(!t||e.accumulator>i)&&(t=e,i=e.accumulator))}if(t)return t.accumulator-=n,t.q}(e.storages);for(;t&&t.length>0;){const i=t.dequeue();if(!i.earlyDropFunction||!i.earlyDropFunction(i))return i;e.counters.pending--,e.counters.cancelled++,i.reject(new Ww(i))}}}const qw=(e,t)=>{const i=null!=t?t:new a;let n={};for(const t in e)void 0!==i[t]&&(n[t]=e[t]);return n};function Zw(e,t,i,n){class s extends a{constructor(s,r){super(qw(Object.assign(Object.assign({},s),{uniforms:Object.assign(Object.assign({},Object.fromEntries(Object.entries(e).map((([e,t])=>[e,{value:t}])))),r),vertexShader:t,fragmentShader:i})));for(const[t]of Object.entries(e))Object.defineProperty(this,t,{get:()=>this.uniforms[t].value,set:e=>this.uniforms[t].value=e});Object.assign(this,s),null==n||n(this)}}return s.key=o.generateUUID(),s}const Kw=Zw({cellSize:1,sectionSize:1,fadeDistance:1e3,fadeStrength:1,cellThickness:.8,sectionThickness:1,axisThickness:1.8,cellColor:new s,sectionColor:new s,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new i,worldPlanePosition:new i},"\n    #include <common>\n    #include <fog_pars_vertex>\n      varying vec3 localPosition;\n      varying vec4 worldPosition;\n  \n      uniform vec3 worldCamProjPosition;\n      uniform vec3 worldPlanePosition;\n      uniform float fadeDistance;\n      uniform bool infiniteGrid;\n      uniform bool followCamera;\n  \n      void main() {\n        localPosition = position.xzy;\n        if (infiniteGrid) localPosition *= 1.0 + fadeDistance;\n        \n        worldPosition = modelMatrix * vec4(localPosition, 1.0);\n        if (followCamera) {\n          worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);\n          localPosition = (inverse(modelMatrix) * worldPosition).xyz;\n        }\n  \n        gl_Position = projectionMatrix * viewMatrix * worldPosition;\n        #include <fog_vertex>\n      }\n    ","\n      #include <common>\n      #include <fog_pars_fragment>\n      varying vec3 localPosition;\n      varying vec4 worldPosition;\n  \n      uniform vec3 worldCamProjPosition;\n      uniform float cellSize;\n      uniform float sectionSize;\n      uniform vec3 cellColor;\n      uniform vec3 sectionColor;\n      uniform float fadeDistance;\n      uniform float fadeStrength;\n      uniform float cellThickness;\n      uniform float sectionThickness;\n      uniform float axisThickness;\n      float getGrid(float size, float thickness) {\n        vec2 r = localPosition.xz / size;\n        vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);\n        float line = min(grid.x, grid.y) + 1.0 - thickness;\n        return 1.0 - min(line, 1.0);\n      }\n  \n      float axisGrid(float size, float thickness) {\n        vec2 r = localPosition.xz / size;\n        vec2 grid = abs(r) / fwidth(r);\n        float line = min(grid.x, grid.y) + 1.0 - thickness;\n        return 1.0 - min(line, 1.0);\n      }\n\n      void main() {\n        float g1 = getGrid(cellSize, cellThickness);\n        float g2 = getGrid(sectionSize, sectionThickness);\n        float g3 = axisGrid(sectionSize, axisThickness);\n  \n        float dist = distance(worldCamProjPosition, worldPosition.xyz);\n        float d = 1.0 - min(dist / fadeDistance, 1.0);\n        vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * (g2 + g3)));\n  \n        gl_FragColor = vec4(color, (g1 + g2 + g3) * pow(d, fadeStrength));\n        gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);\n        if (gl_FragColor.a <= 0.0) discard;\n  \n        #include <fog_fragment>\n        #include <tonemapping_fragment>\n        #include <colorspace_fragment>\n      }\n    "),Jw=({args:e=[100,100],cellColor:t=new s("rgb(50,55,72)"),sectionColor:n=new s("rgb(73,79,105)"),cellSize:r=1,sectionSize:o=10,followCamera:a=!1,infiniteGrid:u=!1,fadeDistance:p=1e3,fadeStrength:f=1,cellThickness:m=.8,sectionThickness:g=1,axisThickness:v=1.8,side:y=d,depthWrite:x=!1}={})=>{const w={cellSize:r,sectionSize:o,cellColor:t,sectionColor:n,cellThickness:m,sectionThickness:g,axisThickness:v},b={fadeDistance:p,fadeStrength:f,infiniteGrid:u,followCamera:a},_=new Kw(Object.assign(Object.assign({depthWrite:x,transparent:!0,side:y},w),b)),S=new l(e[0],e[1]),M=new h(S,_);M.frustumCulled=!1,M.renderOrder=-1;const C=new c,A=new i(0,1,0),E=new i(0,0,0);return{mesh:M,update:e=>{if(!M.parent)return;C.setFromNormalAndCoplanarPoint(A,E).applyMatrix4(M.matrixWorld);const t=M.material,i=t.uniforms.worldCamProjPosition,n=t.uniforms.worldPlanePosition;C.projectPoint(e.position,i.value),n.value.set(0,0,0).applyMatrix4(M.matrixWorld)}}};class $w extends u{constructor(e,t,n){super(),this.isViewHelper=!0,this.animating=!1,this.center=new i;const o=new s("#ff3653"),a=new s("#8adb00"),l=new s("#2c8fff"),c=[],d=new p,_=new r;new u;const S=new f(-2,2,2,-2,0,4);S.position.set(0,0,2);const M=new m(.8,.05,.05).translate(.4,0,0),C=new h(M,F(o)),A=new h(M,F(a)),E=new h(M,F(l));A.rotation.z=Math.PI/2,E.rotation.y=-Math.PI/2,this.add(C),this.add(E),this.add(A);const T=new g(N(o,"X"));T.userData.type="posX";const P=new g(N(a,"Y"));P.userData.type="posY";const O=new g(N(l,"Z"));O.userData.type="posZ";const D=new g(N(o));D.userData.type="negX";const B=new g(N(a));B.userData.type="negY";const I=new g(N(l));I.userData.type="negZ",T.position.x=1,P.position.y=1,O.position.z=1,D.position.x=-1,D.scale.setScalar(.8),B.position.y=-1,B.scale.setScalar(.8),I.position.z=-1,I.scale.setScalar(.8),this.add(T),this.add(P),this.add(O),this.add(D),this.add(B),this.add(I),c.push(T),c.push(P),c.push(O),c.push(D),c.push(B),c.push(I);const R=new i;this.viewSize=null!=n?n:128;const k=document.createElement("div");this.container=k,k.className="viewHelper",k.style.position="absolute",k.style.zIndex="100";let L=!1,z=!1;(t=null!=t?t:"rightTop").indexOf("left")>=0?(k.style.left=0,L=!0):t.indexOf("right")>=0&&(k.style.right=0),t.indexOf("Top")>=0?(k.style.top=0,z=!0):t.indexOf("Bottom")>=0&&(k.style.bottom=0),k.style.height=this.viewSize+"px",k.style.width=this.viewSize+"px",e.container.appendChild(k),this.render=function(t){if(!e.camera)return;this.quaternion.copy(e.camera.quaternion).invert(),this.updateMatrixWorld(),R.set(0,0,1),R.applyQuaternion(e.camera.quaternion),R.x>=0?(T.material.opacity=1,D.material.opacity=.5):(T.material.opacity=.5,D.material.opacity=1),R.y>=0?(P.material.opacity=1,B.material.opacity=.5):(P.material.opacity=.5,B.material.opacity=1),R.z>=0?(O.material.opacity=1,I.material.opacity=.5):(O.material.opacity=.5,I.material.opacity=1),t.clearDepth(),t.getViewport(U);let i=e.containerSize;t.setViewport(L?0:i.width-this.viewSize,z?i.height-this.viewSize:0,this.viewSize,this.viewSize),t.render(this,S),t.setViewport(U.x,U.y,U.z,U.w)},new i,new v,new v,new v;const U=new y;function F(e){return new x({color:e,toneMapped:!1})}function N(e,t=null){const i=document.createElement("canvas");i.width=64,i.height=64;const n=i.getContext("2d");n.beginPath(),n.arc(32,32,16,0,2*Math.PI),n.closePath(),n.fillStyle=e.getStyle(),n.fill(),null!==t&&(n.font="24px Arial",n.textAlign="center",n.fillStyle="#000000",n.fillText(t,32,41));const s=new w(i);return new b({map:s,toneMapped:!1})}this.handleClick=function(t){return Qv(this,void 0,void 0,(function*(){if(!0===this.animating)return!1;const i=k.getBoundingClientRect(),n=i.left+(k.offsetWidth-this.viewSize),s=i.top+(k.offsetHeight-this.viewSize);_.x=(t.clientX-n)/(i.right-n)*2-1,_.y=-(t.clientY-s)/(i.bottom-s)*2+1,d.setFromCamera(_,S);const r=d.intersectObjects(c);if(r.length>0){const t=r[0].object;return this.animating=!0,yield function(t,i){return Qv(this,void 0,void 0,(function*(){const i=.5*Math.PI,n=Math.PI;if(e.cameraControl)switch(t.userData.type){case"posX":yield e.cameraControl.rotateTo(i,i,!0);break;case"posY":yield e.cameraControl.rotateTo(0,0,!0);break;case"posZ":yield e.cameraControl.rotateTo(0,i,!0);break;case"negX":yield e.cameraControl.rotateTo(-i,i,!0);break;case"negY":yield e.cameraControl.rotateTo(0,n,!0);break;case"negZ":yield e.cameraControl.rotateTo(n,i,!0);break;default:console.error("ViewHelper: Invalid axis.")}}))}(t,this.center),this.animating=!1,!0}return!1}))},k.addEventListener("pointerup",this.handleClick),this.dispose=function(){M.dispose(),C.material.dispose(),A.material.dispose(),E.material.dispose(),T.material.map.dispose(),P.material.map.dispose(),O.material.map.dispose(),D.material.map.dispose(),B.material.map.dispose(),I.material.map.dispose(),T.material.dispose(),P.material.dispose(),O.material.dispose(),D.material.dispose(),B.material.dispose(),I.material.dispose(),k.removeEventListener("pointerup",this.handleClick),e.container.removeChild(k)}}}var eb;class tb extends Sy{constructor(e,t){var i,n;super(e),eb.set(this,void 0),Zv(this,eb,null!=t?t:{},"f"),this.setVisible(null===(i=t.visible)||void 0===i||i),this.setVisible(null!==(n=t.drawGridLine)&&void 0!==n&&n,!0),this.addDispose((()=>{this.setVisible(!1),this.setVisible(!1,!0)}))}getVisible(e){var t;return e?!!this.gridLineHelper:!!(null===(t=this.grid)||void 0===t?void 0:t.mesh)}setVisible(e,t){var i,n,s;if(t)if(e)this.gridLineHelper||(this.gridLineHelper=new _(qv(this,eb,"f").gridLineSize,qv(this,eb,"f").gridLineDivisions,qv(this,eb,"f").gridLineColor1,qv(this,eb,"f").gridLineColor2)),this.entity.addObjects(this.gridLineHelper),vW(this.gridLineHelper);else{if(!this.gridLineHelper)return;this.entity.removeObjects(this.gridLineHelper),this.gridLineHelper.dispose(),delete this.gridLineHelper}else if(e){if(null===(i=this.grid)||void 0===i?void 0:i.mesh)return;this.grid=Jw(qv(this,eb,"f")),!1!==qv(this,eb,"f").polygonOffset&&(this.grid.mesh.material.polygonOffset=!0,this.grid.mesh.material.polygonOffsetFactor=null!==(n=qv(this,eb,"f").polygonOffsetFactor)&&void 0!==n?n:1,this.grid.mesh.material.polygonOffsetUnits=null!==(s=qv(this,eb,"f").polygonOffsetUnits)&&void 0!==s?s:1),this.entity.addObjects(this.grid.mesh),pW(this.entity.node),fW(this.entity.node)}else{if(null==this.grid||this.grid&&!this.grid.mesh)return;this.entity.removeObjects(this.grid.mesh),lW(this.grid.mesh),this.grid.mesh=null}}onAppUpdate(e){var t;this.app.camera&&(null===(t=this.grid)||void 0===t?void 0:t.mesh)&&this.grid.update(this.app.camera)}setupUiConfig(){const e=(e,t)=>t.split(".").reduce((function(e,t){return e?e[t]:void 0}),e),t=(t,i,n,s)=>({type:t,label:i,hidden:()=>!this.getVisible(),getValue:()=>{var t;return(null===(t=this.grid)||void 0===t?void 0:t.mesh)?n.indexOf(".")<=0?this.grid.mesh.material[n]:e(this.grid.mesh.material,n+".value"):s},setValue:t=>{var i;(null===(i=this.grid)||void 0===i?void 0:i.mesh)&&(n.indexOf(".")<=0?this.grid.mesh.material[n]=t:e(this.grid.mesh.material,n).value=t)}}),i=(e,t,i,n)=>({type:e,label:t,hidden:()=>!this.getVisible(!0),getValue:()=>{var e;return null!==(e=qv(this,eb,"f")[i])&&void 0!==e?e:n},setValue:e=>{qv(this,eb,"f")[i]=e,this.setVisible(!1,!0),this.setVisible(!0,!0)}});return{type:"folder",expanded:!0,label:"模块参数设置",app:this.app,children:[{type:"checkbox",label:"显示",getValue:()=>this.getVisible(),setValue:e=>{var t,i;this.setVisible(e),null===(i=null===(t=this.uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===i||i.call(t,!1)}},()=>t("color","cellColor","uniforms.cellColor",new s("#fff")),()=>t("color","sectionColor","uniforms.sectionColor",new s("#fff")),()=>t("number","cellSize","uniforms.cellSize",0),()=>t("number","sectionSize","uniforms.sectionSize",0),()=>t("number","cellThickness","uniforms.cellThickness",.5),()=>t("number","sectionThickness","uniforms.sectionThickness",1),()=>t("number","axisThickness","uniforms.axisThickness",1.8),()=>t("number","fadeDistance","uniforms.fadeDistance",0),()=>t("number","fadeStrength","uniforms.fadeStrength",0),()=>t("checkbox","infiniteGrid","uniforms.infiniteGrid",!1),()=>t("checkbox","followCamera","uniforms.followCamera",!1),()=>t("checkbox","polygonOffset","polygonOffset",!1),()=>t("number","polygonOffsetFactor","polygonOffsetFactor",0),()=>t("number","polygonOffsetUnits","polygonOffsetUnits",0),{type:"checkbox",label:"绘制网格线",getValue:()=>this.getVisible(!0),setValue:e=>{var t,i;this.setVisible(e,!0),null===(i=null===(t=this.uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===i||i.call(t,!1)}},()=>i("number","网格线大小","gridLineSize",10),()=>i("number","网格线分割数","gridLineDivisions",10),()=>i("color","网格线中心线的颜色","gridLineColor1",4473924),()=>i("color","网格线线条的颜色","gridLineColor2",8947848)]}}}eb=new WeakMap,tb.moduleName="GridHelperModule";const ib=e=>EW(e.material,(t=>{const i=t.clone();return i.onBeforeCompile=t=>{t.uniforms.highlightOpacity=e.highlightOpacity,t.uniforms.highlightColor=e.highlightColor,t.fragmentShader=t.fragmentShader.replace("#include <common>","\n#include <common>\nuniform float highlightOpacity;\nuniform vec3 highlightColor;\n"),t.fragmentShader=t.fragmentShader.replace("#include <opaque_fragment>","\n#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4(mix(outgoingLight,highlightColor,highlightOpacity),diffuseColor.a);\n")},i}));function nb(e,t){if(!e)throw new Error(t)}function sb(...e){const t=e.length-1;return function(...i){let n=t,s=e[t].apply(null,i);for(;n--;)s=e[n].call(null,s);return s}}function rb(e,t,i=!1){if(null===e)return;let n,s,r,o,a,l,h,c,d=0,u=0;const{type:p}=e,f="FeatureCollection"===p,m="Feature"===p,g=f?e.features.length:1;for(let p=0;p<g;p++){h=f?e.features[p].geometry:m?e.geometry:e,c=!!h&&"GeometryCollection"===h.type,a=c?h.geometries.length:1;for(let e=0;e<a;e++){let a=0,f=0;if(o=c?h.geometries[e]:h,null===o)continue;const m=o.type;switch(d=!i||"Polygon"!==m&&"MultiPolygon"!==m?0:1,m){case null:break;case"Point":case"GeometryPoint":if(l=o.coordinates,!1===t(l,-1,u,p,a,f))return!1;u++,a++;break;case"LineString":case"MultiPoint":for(l=o.coordinates,n=0;n<l.length;n++){if(!1===t(l,n,u,p,a,f))return!1;u++,"MultiPoint"===m&&a++}"LineString"===m&&a++;break;case"Polygon":case"MultiLineString":for(l=o.coordinates,n=0;n<l.length;n++){for(s=0;s<l[n].length-d;s++){if(!1===t(l[n],s,u,p,a,f))return!1;u++}"MultiLineString"===m&&a++,"Polygon"===m&&f++}"Polygon"===m&&a++;break;case"MultiPolygon":for(l=o.coordinates,n=0;n<l.length;n++){for(f=0,s=0;s<l[n].length;s++){for(r=0;r<l[n][s].length-d;r++){if(!1===t(l[n][s],r,u,p,a,f))return!1;u++}f++}a++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===rb(o.geometries[n],t,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}const{sin:ob,cos:ab,atan2:lb,sqrt:hb,PI:cb}=Math,db=3e3*cb/180;function ub(e){const[t,i]=e,n=t-.0065,s=i-.006,r=hb(n*n+s*s)-2e-5*ob(s*db),o=lb(s,n)-3e-6*ab(n*db);return[r*ab(o),r*ob(o)]}function pb(e){const[t,i]=e,n=t,s=i,r=hb(n*n+s*s)+2e-5*ob(s*db),o=lb(s,n)+3e-6*ab(n*db);return[r*ab(o)+.0065,r*ob(o)+.006]}const{abs:fb}=Math,mb=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],gb=[75,60,45,30,15,0],vb=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],yb=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]];function xb(e,t,i){const n=fb(t)/i[9];let s=i[0]+i[1]*fb(e),r=i[2]+i[3]*n+i[4]*Math.pow(n,2)+i[5]*Math.pow(n,3)+i[6]*Math.pow(n,4)+i[7]*Math.pow(n,5)+i[8]*Math.pow(n,6);return s*=e<0?-1:1,r*=t<0?-1:1,[s,r]}function wb(e){const[t,i]=e;let n=[];for(let e=0;e<gb.length;e++)if(fb(i)>gb[e]){n=yb[e];break}return xb(t,i,n)}function bb(e){const[t,i]=e;let n=[];for(let e=0;e<mb.length;e++)if(i>=mb[e]){n=vb[e];break}return xb(t,i,n)}const _b=180/Math.PI,Sb=Math.PI/180,Mb=6378137,Cb=20037508.342789244;function Ab(e){return[e[0]*_b/Mb,(.5*Math.PI-2*Math.atan(Math.exp(-e[1]/Mb)))*_b]}function Eb(e){const t=Math.abs(e[0])<=180?e[0]:e[0]-360*(e[0]<0?-1:1),i=[Mb*t*Sb,Mb*Math.log(Math.tan(.25*Math.PI+.5*e[1]*Sb))];return i[0]>Cb&&(i[0]=Cb),i[0]<-Cb&&(i[0]=-Cb),i[1]>Cb&&(i[1]=Cb),i[1]<-Cb&&(i[1]=-Cb),i}const{sin:Tb,cos:Pb,sqrt:Ob,abs:Db,PI:Bb}=Math,Ib=6378245,Rb=.006693421622965823;function kb(e,t){return e>=72.004&&e<=137.8347&&t>=.8293&&t<=55.8271}function Lb(e){const[t,i]=e;if(!kb(t,i))return[t,i];const n=function(e,t){let i=function(e,t){let i=300+e+2*t+.1*e*e+.1*e*t+.1*Ob(Db(e));return i+=2*(20*Tb(6*e*Bb)+20*Tb(2*e*Bb))/3,i+=2*(20*Tb(e*Bb)+40*Tb(e/3*Bb))/3,i+=2*(150*Tb(e/12*Bb)+300*Tb(e/30*Bb))/3,i}(e-105,t-35),n=function(e,t){let i=2*e-100+3*t+.2*t*t+.1*e*t+.2*Ob(Db(e));return i+=2*(20*Tb(6*e*Bb)+20*Tb(2*e*Bb))/3,i+=2*(20*Tb(t*Bb)+40*Tb(t/3*Bb))/3,i+=2*(160*Tb(t/12*Bb)+320*Tb(t*Bb/30))/3,i}(e-105,t-35);const s=t/180*Bb;let r=Tb(s);r=1-Rb*r*r;const o=Ob(r);return i=180*i/(Ib/o*Pb(s)*Bb),n=180*n/(Ib*(1-Rb)/(r*o)*Bb),[i,n]}(t,i);return[t+n[0],i+n[1]]}function zb(e){const[t,i]=e;if(!kb(t,i))return[t,i];let[n,s]=[t,i],r=Lb([n,s]),o=r[0]-t,a=r[1]-i;for(;Db(o)>1e-6||Db(a)>1e-6;)n-=o,s-=a,r=Lb([n,s]),o=r[0]-t,a=r[1]-i;return[n,s]}var Ub;!function(e){e.WGS84="WGS84",e.WGS1984="WGS84",e.EPSG4326="WGS84",e.GCJ02="GCJ02",e.AMap="GCJ02",e.BD09="BD09",e.BD09LL="BD09",e.Baidu="BD09",e.BMap="BD09",e.BD09MC="BD09MC",e.BD09Meter="BD09MC",e.EPSG3857="EPSG3857",e.EPSG900913="EPSG3857",e.EPSG102100="EPSG3857",e.WebMercator="EPSG3857",e.WM="EPSG3857"}(Ub||(Ub={}));const Fb={WGS84:{to:{[Ub.GCJ02]:Lb,[Ub.BD09]:sb(pb,Lb),[Ub.BD09MC]:sb(wb,pb,Lb),[Ub.EPSG3857]:Eb}},GCJ02:{to:{[Ub.WGS84]:zb,[Ub.BD09]:pb,[Ub.BD09MC]:sb(wb,pb),[Ub.EPSG3857]:sb(Eb,zb)}},BD09:{to:{[Ub.WGS84]:sb(zb,ub),[Ub.GCJ02]:ub,[Ub.EPSG3857]:sb(Eb,zb,ub),[Ub.BD09MC]:wb}},EPSG3857:{to:{[Ub.WGS84]:Ab,[Ub.GCJ02]:sb(Lb,Ab),[Ub.BD09]:sb(pb,Lb,Ab),[Ub.BD09MC]:sb(wb,pb,Lb,Ab)}},BD09MC:{to:{[Ub.WGS84]:sb(zb,ub,bb),[Ub.GCJ02]:sb(ub,bb),[Ub.EPSG3857]:sb(Eb,zb,ub,bb),[Ub.BD09]:bb}}};class Nb{static convert(e){if(e instanceof Nb)return e.clone();if(Array.isArray(e)){if(2===e.length)return new Nb(Number(e[0]),Number(e[1]));if(e.length>2)return new Nb(Number(e[0]),Number(e[1]),Number(e[2]))}if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return"lat"in e?new Nb(Number("lng"in e?e.lng:e.lon),Number(e.lat)):new Nb(Number(e.x),Number(e.y));throw new Error("`GeoPointLike` argument must be specified as a GeoPoint instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [x, y, z?]")}static fromString(e){let t=(e=null!=e?e:"").split(",");if(2==t.length)return new Nb(+t[0],+t[1]);if(t.length>=3)return new Nb(+t[0],+t[1],+t[2]);throw Error("param is not string format x,y")}constructor(e,t,i){this.x=e,this.y=t,this.z=i}clone(){return new Nb(this.x,this.y,this.z)}_add(e){return this.x+=e.x,this.y+=e.y,void 0!==e.z&&void 0!==this.z&&(this.z+=e.z),this}toArray(){const e=[this.x,this.y];return void 0!==this.z&&e.push(this.z),e}toString(e=6){let t=`${this.x.toFixed(e)},${this.y.toFixed(e)}`;return this.z&&(t+=`,${this.z.toFixed(e)}`),t}round(e=6){const t=1/Math.pow(10,e),i=this.clone();return i.x=Math.round(i.x/t)*t,i.y=Math.round(i.y/t)*t,i.z&&(i.y=Math.round(i.z/t)*t),i}roundStr(e=6){return this.round(e).toString(e)}add(e){return this.clone()._add(e)}_sub(e){return this.x-=e.x,this.y-=e.y,void 0!==e.z&&void 0!==this.z&&(this.z-=e.z),this}sub(e){return this.clone()._sub(e)}lengthSq(){return void 0!==this.z?Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z):Math.sqrt(this.x*this.x+this.y*this.y)}_multByPoint(e){return this.x*=e.x,this.y*=e.y,void 0!==e.z&&void 0!==this.z&&(this.z*=e.y),this}multByPoint(e){return this.clone()._multByPoint(e)}_divByPoint(e){return this.x/=e.x,this.y/=e.y,void 0!==e.z&&void 0!==this.z&&(this.z/=e.y),this}divByPoint(e){return this.clone()._divByPoint(e)}dot(e){return void 0!==this.z&&void 0!==e.z?this.x*e.x+this.y*e.y+this.z*e.z:this.x*e.x+this.y*e.y}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,void 0!==this.z&&void 0!==e.z&&(this.z+=(e.z-this.z)*t),this}_mult(e){return this.x*=e,this.y*=e,void 0!==this.z&&(this.z*=e),this}mult(e){return this.clone()._mult(e)}_div(e){return this.x/=e,this.y/=e,void 0!==this.z&&(this.z/=e),this}div(e){return this.clone()._div(e)}_rotate(e){const t=Math.cos(e),i=Math.sin(e),n=t*this.x-i*this.y,s=i*this.x+t*this.y;return this.x=n,this.y=s,this}rotate(e){return this.clone()._rotate(e)}_rotateAround(e,t){const i=Math.cos(e),n=Math.sin(e),s=t.x+i*(this.x-t.x)-n*(this.y-t.y),r=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=s,this.y=r,this}roateAround(e,t){return this.clone()._rotateAround(e,t)}_matMult(e){const t=e[0]*this.x+e[1]*this.y,i=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=i,this}matMult(e){return this.clone()._matMult(e)}_unit(){return this.div(this.mag()),this}unit(){return this.clone()._unit()}_perp(){const e=this.y;return this.y=this.x,this.x=-e,this}perp(){return this.clone()._perp()}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundInt(){return this.clone()._round()}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(e,t=8){const i=1/Math.pow(10,t);return Math.abs(this.x-e.x)<=i&&Math.abs(this.y-e.y)<=i}equalsZ(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}distanceTo(e){return Math.sqrt(this.distSqr(e))}distSqr(e){const t=e.x-this.x,i=e.y-this.y;return t*t+i*i}angle(){return Math.atan2(this.y,this.x)}angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)}angleWith(e){return this.angleWithSep(e.x,e.y)}angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}transform(e,t,i,n){i=null!=i?i:1,n=null!=n?n:0;const s=Math.cos(n*Math.PI/180),r=Math.sin(n*Math.PI/180),o=t.x+i*s*(this.x-e.x)-i*r*(this.y-e.y),a=t.y+i*r*(this.x-e.x)+i*s*(this.y-e.y);return this.x=o,this.y=a,this}}function jb(e){return Nb.convert(e)}function Vb(e){if(Array.isArray(e)){const[t,i,n]=e;return"number"==typeof t&&"number"==typeof i&&(void 0===n||"number"==typeof n)}if(e instanceof Nb)return!0;if("object"==typeof e){if("x"in e&&"y"in e)return!0;if("lng"in e&&"lat"in e)return!0;if("lon"in e&&"lat"in e)return!0}return!1}var Hb;function Wb(e,t){if(e==Hb.Wgs84)return{epsg:"EPSG:4326",proj:"+proj=longlat +datum=WGS84 +no_defs"};if(e==Hb.Merc3857)return{epsg:"EPSG:3857",proj:"+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"};let i=+(t+"").substr(0,2);if(e==Hb.Beijing54){if(i>=13&&i<=23){let e=i-13;return{epsg:`EPSG:${21413+e}`,proj:`+proj=tmerc +lat_0=0 +lon_0=${75+6*e} +k=1.000000 +x_0=${135e5+1e6*e} +y_0=0 +ellps=krass +units=m +no_defs  no_defs`}}if(i>=25&&i<=45){let e=i-25;return{epsg:`EPSG:${2401+e}`,proj:`+proj=tmerc +lat_0=0 +lon_0=${75+3*e} +k=1.000000 +x_0=${255e5+1e6*e} +y_0=0 +ellps=krass +units=m +no_defs  no_defs`}}}else if(e==Hb.NewBeijing54){if(i>=13&&i<=23){let e=i-13;return{epsg:`EPSG:${4568+e}`,proj:`+proj=tmerc +lat_0=0 +lon_0=${75+6*e} +k=1.000000 +x_0=${135e5+1e6*e} +y_0=0 +ellps=krass +units=m +no_defs +type=crs`}}if(i>=25&&i<=29){let e=i-25;return{epsg:`EPSG:${4652+e}`,proj:`+proj=tmerc +lat_0=0 +lon_0=${75+3*e} +k=1.000000 +x_0=${255e5+1e6*e} +y_0=0 +ellps=krass +units=m +no_defs +type=crs`}}if(i>=30&&i<=45){let e=i-30;return{epsg:`EPSG:${4766+e}`,proj:`+proj=tmerc +lat_0=0 +lon_0=${75+3*(e+5)} +k=1.000000 +x_0=${255e5+1e6*(e+5)} +y_0=0 +ellps=krass +units=m +no_defs +type=crs`}}}else if(e==Hb.Xian80){if(i>=13&&i<=23){let e=i-13;return{epsg:`EPSG:${2327+e}`,proj:`+proj=tmerc +lat_0=0 +lon_0=${75+6*e} +k=1.000000 +x_0=${135e5+1e6*e} +y_0=0 +a=6378140 +b=6356755.288157528 +units=m +no_defs  no_defs`}}if(i>=25&&i<=45){let e=i-25;return{epsg:`EPSG:${2349+e}`,proj:`+proj=tmerc +lat_0=0 +lon_0=${75+3*e} +k=1.000000 +x_0=${255e5+1e6*e} +y_0=0 +a=6378140 +b=6356755.288157528 +units=m +no_defs  no_defs`}}}else if(e==Hb.CGCS2000){if(i>=13&&i<=23){let e=i-13;return{epsg:`EPSG:${4491+e}`,proj:`+proj=tmerc +lat_0=0 +lon_0=${75+6*e} +k=1 +x_0=${135e5+1e6*e} +y_0=0 +ellps=GRS80 +units=m +no_defs `}}if(i>=25&&i<=45){let e=i-25;return{epsg:`EPSG:${4513+e}`,proj:`+proj=tmerc +lat_0=0 +lon_0=${75+3*e} +k=1 +x_0=${255e5+1e6*e} +y_0=0 +ellps=GRS80 +units=m +no_defs `}}}return null}!function(e){e.Beijing54="Beijing54",e.Xian80="Xian80",e.CGCS2000="CGCS2000",e.Wgs84="Wgs84",e.Merc3857="Merc3857",e.NewBeijing54="NewBeijing54"}(Hb||(Hb={}));const Gb={CRSTypes:Ub,convert:function(e,t,i){var n,s;nb(!!e,"The args[0] input coordinate is required");const r=typeof e;if(nb("string"===r||"object"===r,`Invalid input coordinate type: ${r}`),"string"===r)try{e=JSON.parse(e)}catch(t){throw new Error(`Invalid input coordinate: ${e}`)}let o;if("function"==typeof t)o=t;else{if(nb(!!t,"The args[1] original coordinate system is required"),nb(!!i,"The args[2] target coordinate system is required"),t===i)return e;const n=Fb[t];nb(!!n,`Invalid original coordinate system: ${t}`);const s=n.to[i];nb(!!s,`Invalid target coordinate system: ${i}`),o=s}if(Vb(e)){const t=Nb.convert(e);return o([t.x,t.y])}return function(e){return!!e&&"[object Array]"===Object.prototype.toString.call(e)}(e)?0===e.length?e:Array.isArray(e)&&(null===(n=e[0])||void 0===n?void 0:n.length)>0&&Array.isArray(e[0][0])&&(null===(s=e[0][0])||void 0===s?void 0:s.length)>=2?e.map((e=>e.map((e=>{const t=Nb.convert(e);return o([t.x,t.y])})))):e.map((e=>{const t=Nb.convert(e);return o([t.x,t.y])})):(rb(e,((e,t)=>{if(t<0){let t=o(e);e[0]=t[0],e[1]=t[1]}else e[t]=o(e[t])})),e)},EpsgCrsTypes:Hb,getEpsgParam:Wb,getEpsgCode:function(e,t,i){let n=[],s=Array.isArray(e)&&2==e.length;if(s&&e[0]>1e7&&e[0]<5e7&&(e=+(e[0]+"").substr(0,2)),"number"==typeof e&&e>10&&e<50){let s=[Hb.Beijing54,Hb.NewBeijing54,Hb.Xian80,Hb.CGCS2000];for(let r of s){let s=Wb(r,e);if(s){let o=!(e>=13&&e<=23);if(t&&r!=t)continue;if("boolean"==typeof i&&o!=i)continue;n.push({crs:r,is3DegreeBelt:o,epsg:s.epsg,proj:s.proj})}}}else if(s){let s=[{crs:"Xian80",is3DegreeBelt:!1,epsgs:[{epsg:"2338",projectBounds:"374665.35,3921191.52,773407.72,4552717.34",lngLatBounds:"73.62,35.42,78.01,41.07"},{epsg:"2339",projectBounds:"206116.69,3227004.8,791936.12,5237245.65",lngLatBounds:"77.98,29.16,84.0,47.23"},{epsg:"2340",projectBounds:"203003.59,3023089.64,796996.41,5453983.17",lngLatBounds:"84.0,27.32,90.0,49.18"},{epsg:"2341",projectBounds:"204050.76,3066306.22,796936.26,5311699.12",lngLatBounds:"90.0,27.71,96.01,47.9"},{epsg:"2342",projectBounds:"188253.38,2337471.29,812786.49,4787120.08",lngLatBounds:"96.0,21.13,102.01,43.18"},{epsg:"2343",projectBounds:"189098.51,2381759.84,810901.49,4708209.07",lngLatBounds:"102.0,21.53,108.0,42.47"},{epsg:"2344",projectBounds:"182364.58,2003157.78,817635.42,5001552.17",lngLatBounds:"108.0,18.11,114.0,45.11"},{epsg:"2345",projectBounds:"190416.42,2449303.99,809583.58,5714208.92",lngLatBounds:"114.0,22.14,120.0,51.52"},{epsg:"2346",projectBounds:"200433.02,2914504.74,799566.98,5941134.37",lngLatBounds:"120.0,26.34,126.0,53.56"},{epsg:"2347",projectBounds:"247158.43,4528359.59,752841.57,5855474.42",lngLatBounds:"126.0,40.89,132.0,52.79"},{epsg:"2348",projectBounds:"263541.63,4987195.08,482969.27,5367258.33",lngLatBounds:"132.0,45.02,134.77,48.4"}]},{crs:"Xian80",is3DegreeBelt:!0,epsgs:[{epsg:"2370",projectBounds:"375272.44,3964464.3,635574.19,4502789.7",lngLatBounds:"73.62,35.81,76.5,40.65"},{epsg:"2371",projectBounds:"356780.68,3434302.02,643219.32,4633844.82",lngLatBounds:"76.5,31.03,79.5,41.83"},{epsg:"2372",projectBounds:"355189.66,3314572.35,645775.86,5083859.29",lngLatBounds:"79.5,29.95,82.51,45.88"},{epsg:"2373",projectBounds:"352803.44,3127256.81,647196.56,5233910.91",lngLatBounds:"82.5,28.26,85.5,47.23"},{epsg:"2374",projectBounds:"352176.01,3076279.61,647823.99,5450731.68",lngLatBounds:"85.5,27.8,88.5,49.18"},{epsg:"2375",projectBounds:"350541.53,3023089.64,649458.47,5366233.54",lngLatBounds:"88.49,27.32,91.51,48.42"},{epsg:"2376",projectBounds:"352054.36,3066306.21,647945.64,5000488.84",lngLatBounds:"91.5,27.71,94.5,45.13"},{epsg:"2377",projectBounds:"352762.23,3123932.11,648219.48,4930492.52",lngLatBounds:"94.5,28.23,97.51,44.5"},{epsg:"2378",projectBounds:"344482.25,2370687.5,655517.75,4737151.76",lngLatBounds:"97.5,21.43,100.5,42.76"},{epsg:"2379",projectBounds:"344166.5,2337471.28,655833.5,4729375.42",lngLatBounds:"100.5,21.13,103.5,42.69"},{epsg:"2380",projectBounds:"345643.0,2489168.48,655386.22,4676068.94",lngLatBounds:"103.5,22.5,106.51,42.21"},{epsg:"2381",projectBounds:"341298.75,2012012.36,659759.45,4704950.68",lngLatBounds:"106.5,18.19,109.51,42.47"},{epsg:"2382",projectBounds:"341226.51,2003157.78,658773.49,4998266.16",lngLatBounds:"109.5,18.11,112.5,45.11"},{epsg:"2383",projectBounds:"344577.81,2380652.6,655422.19,5036052.73",lngLatBounds:"112.5,21.52,115.5,45.45"},{epsg:"2384",projectBounds:"345754.23,2500242.25,654245.77,5528581.54",lngLatBounds:"115.5,22.6,118.5,49.88"},{epsg:"2385",projectBounds:"347872.18,2702917.29,652127.82,5912397.96",lngLatBounds:"118.5,24.43,121.5,53.33"},{epsg:"2386",projectBounds:"352748.5,3122823.87,647251.5,5937993.2",lngLatBounds:"121.5,28.22,124.5,53.56"},{epsg:"2387",projectBounds:"372262.41,4450628.03,627737.59,5897931.5",lngLatBounds:"124.5,40.19,127.5,53.2"},{epsg:"2388",projectBounds:"374503.71,4581666.7,625496.29,5569734.31",lngLatBounds:"127.5,41.37,130.5,50.25"},{epsg:"2389",projectBounds:"376543.07,4698291.56,623456.93,5417370.16",lngLatBounds:"130.5,42.42,133.5,48.88"},{epsg:"2390",projectBounds:"383491.79,5079441.55,482969.27,5363995.11",lngLatBounds:"133.5,45.85,134.77,48.4"}]},{crs:"Beijing54",is3DegreeBelt:!0,epsgs:[{epsg:"2422",projectBounds:"3296383.15,4381545.25,3757058.1,4951411.64",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2423",projectBounds:"451091.38,4096560.08,1391399.92,4699231.2",lngLatBounds:"77.45,37.0,88.0,41.99"},{epsg:"2424",projectBounds:"183995.11,4096573.83,1123544.69,4674339.6",lngLatBounds:"77.45,37.0,88.0,41.99"},{epsg:"2425",projectBounds:"-83340.76,4096567.77,856155.46,4671372.52",lngLatBounds:"77.45,37.0,88.0,41.99"},{epsg:"2426",projectBounds:"-351113.65,4096555.16,589035.91,4694923.16",lngLatBounds:"77.45,37.0,88.0,41.99"},{epsg:"2427",projectBounds:"1976959.87,4009688.54,2339082.85,4514214.43",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2428",projectBounds:"1715213.78,3965567.42,2060496.88,4458890.92",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2429",projectBounds:"1454082.98,3930445.77,1783263.16,4413158.15",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2430",projectBounds:"1193461.13,3904025.08,1507175.86,4376682.52",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2431",projectBounds:"933223.08,3886082.06,1232008.98,4349198.23",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2432",projectBounds:"673230.61,3876465.73,957522.0,4330505.28",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2433",projectBounds:"408674.58,3874638.91,683463.94,4320467.53",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2434",projectBounds:"407976.62,2025353.43,1109716.5,2544005.59",lngLatBounds:"110.13,18.31,116.76,22.89"},{epsg:"2435",projectBounds:"90567.69,2025354.18,791817.63,2537636.61",lngLatBounds:"110.13,18.31,116.76,22.89"},{epsg:"2436",projectBounds:"-227750.51,2025370.81,475314.12,2548932.85",lngLatBounds:"110.13,18.31,116.76,22.89"},{epsg:"2437",projectBounds:"426572.82,3456514.27,982314.29,4152979.39",lngLatBounds:"119.23,31.23,125.06,37.4"},{epsg:"2438",projectBounds:"140624.83,3456516.82,696214.13,4147621.8",lngLatBounds:"119.23,31.23,125.06,37.4"},{epsg:"2439",projectBounds:"-1245205.59,3993821.39,-888839.2,4494509.48",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2440",projectBounds:"-1524789.66,4044117.92,-1151040.07,4556416.04",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2441",projectBounds:"-1806004.32,4104087.82,-1413972.96,4628625.0",lngLatBounds:"107.0,35.0,110.01,39.0"},{epsg:"2442",projectBounds:"-2088963.21,4174250.75,-1677658.57,4711662.24",lngLatBounds:"107.0,35.0,110.01,39.0"}]},{crs:"CGCS2000",is3DegreeBelt:!1,epsgs:[{epsg:"4502",projectBounds:"374665.41,3921189.69,773407.59,4552715.22",lngLatBounds:"73.62,35.42,78.01,41.07"},{epsg:"4503",projectBounds:"206116.83,3227003.3,791935.98,5237243.2",lngLatBounds:"77.98,29.16,84.0,47.23"},{epsg:"4504",projectBounds:"203003.72,3023088.23,796996.28,5453980.63",lngLatBounds:"84.0,27.32,90.0,49.18"},{epsg:"4505",projectBounds:"204050.9,3066304.79,796936.12,5311696.64",lngLatBounds:"90.0,27.71,96.01,47.9"},{epsg:"4506",projectBounds:"188253.52,2337470.2,812786.34,4787117.85",lngLatBounds:"96.0,21.13,102.01,43.18"},{epsg:"4507",projectBounds:"181721.15,1963312.19,818278.85,4708206.87",lngLatBounds:"102.0,17.75,108.0,42.47"},{epsg:"4508",projectBounds:"179915.67,1847106.87,820084.33,5001549.83",lngLatBounds:"108.0,16.7,114.0,45.11"},{epsg:"4509",projectBounds:"184047.25,2103881.96,815952.75,5714206.25",lngLatBounds:"114.0,19.02,120.0,51.52"},{epsg:"4510",projectBounds:"196182.08,2726176.89,803817.92,5941131.59",lngLatBounds:"120.0,24.64,126.0,53.56"},{epsg:"4511",projectBounds:"209606.47,3286858.42,790393.53,5855471.68",lngLatBounds:"126.0,29.7,132.0,52.79"},{epsg:"4512",projectBounds:"263541.74,4987192.76,482969.27,5367255.83",lngLatBounds:"132.0,45.02,134.77,48.4"}]},{crs:"CGCS2000",is3DegreeBelt:!0,epsgs:[{epsg:"4534",projectBounds:"375272.5,3964462.46,635574.13,4502787.6",lngLatBounds:"73.62,35.81,76.5,40.65"},{epsg:"4535",projectBounds:"356780.75,3434300.42,643219.25,4633842.66",lngLatBounds:"76.5,31.03,79.5,41.83"},{epsg:"4536",projectBounds:"355189.72,3314570.81,645775.79,5083856.92",lngLatBounds:"79.5,29.95,82.51,45.88"},{epsg:"4537",projectBounds:"352803.51,3127255.35,647196.49,5233908.47",lngLatBounds:"82.5,28.26,85.5,47.23"},{epsg:"4538",projectBounds:"352176.08,3076278.18,647823.92,5450729.14",lngLatBounds:"85.5,27.8,88.5,49.18"},{epsg:"4539",projectBounds:"350541.6,3023088.23,649458.4,5366231.03",lngLatBounds:"88.49,27.32,91.51,48.42"},{epsg:"4540",projectBounds:"352054.43,3066304.78,647945.57,5000486.51",lngLatBounds:"91.5,27.71,94.5,45.13"},{epsg:"4541",projectBounds:"352762.3,3123930.66,648219.41,4930490.22",lngLatBounds:"94.5,28.23,97.51,44.5"},{epsg:"4542",projectBounds:"344482.32,2370686.4,655517.68,4737149.55",lngLatBounds:"97.5,21.43,100.5,42.76"},{epsg:"4543",projectBounds:"344166.57,2337470.19,655833.43,4729373.22",lngLatBounds:"100.5,21.13,103.5,42.69"},{epsg:"4544",projectBounds:"345643.07,2489167.32,655386.14,4676066.76",lngLatBounds:"103.5,22.5,106.51,42.21"},{epsg:"4545",projectBounds:"341298.83,2012011.42,659759.38,4704948.48",lngLatBounds:"106.5,18.19,109.51,42.47"},{epsg:"4546",projectBounds:"341226.58,2003156.85,658773.42,4998263.83",lngLatBounds:"109.5,18.11,112.5,45.11"},{epsg:"4547",projectBounds:"344577.88,2380651.49,655422.12,5036050.38",lngLatBounds:"112.5,21.52,115.5,45.45"},{epsg:"4548",projectBounds:"345754.3,2500241.09,654245.7,5528578.96",lngLatBounds:"115.5,22.6,118.5,49.88"},{epsg:"4549",projectBounds:"347872.25,2702916.03,652127.75,5912395.2",lngLatBounds:"118.5,24.43,121.5,53.33"},{epsg:"4550",projectBounds:"352748.57,3122822.42,647251.43,5937990.42",lngLatBounds:"121.5,28.22,124.5,53.56"},{epsg:"4551",projectBounds:"372262.47,4450625.96,627737.53,5897928.74",lngLatBounds:"124.5,40.19,127.5,53.2"},{epsg:"4552",projectBounds:"374503.76,4581664.56,625496.24,5569731.71",lngLatBounds:"127.5,41.37,130.5,50.25"},{epsg:"4553",projectBounds:"376543.13,4698289.37,623456.87,5417367.63",lngLatBounds:"130.5,42.42,133.5,48.88"},{epsg:"4554",projectBounds:"383491.84,5079439.18,482969.27,5363992.61",lngLatBounds:"133.5,45.85,134.77,48.4"}]},{crs:"NewBeijing54",is3DegreeBelt:!1,epsgs:[{epsg:"4579",projectBounds:"374663.3,3921259.2,773412.18,4552795.68",lngLatBounds:"73.62,35.42,78.01,41.07"},{epsg:"4580",projectBounds:"206111.89,3227060.67,791940.89,5237335.44",lngLatBounds:"77.98,29.16,84.0,47.23"},{epsg:"4581",projectBounds:"202998.73,3023142.02,797001.27,5454076.57",lngLatBounds:"84.0,27.32,90.0,49.18"},{epsg:"4582",projectBounds:"204045.92,3066359.34,796941.12,5311790.16",lngLatBounds:"90.0,27.71,96.01,47.9"},{epsg:"4583",projectBounds:"188248.26,2337511.89,812791.62,4787202.35",lngLatBounds:"96.0,21.13,102.01,43.18"},{epsg:"4584",projectBounds:"189093.41,2381801.2,810906.59,4708290.02",lngLatBounds:"102.0,21.53,108.0,42.47"},{epsg:"4585",projectBounds:"182359.37,2003192.6,817640.63,5001638.03",lngLatBounds:"108.0,18.11,114.0,45.11"},{epsg:"4586",projectBounds:"190411.35,2449346.52,809588.65,5714306.63",lngLatBounds:"114.0,22.14,120.0,51.52"},{epsg:"4587",projectBounds:"200428.12,2914555.26,799571.88,5941235.83",lngLatBounds:"120.0,26.34,126.0,53.56"},{epsg:"4588",projectBounds:"247154.32,4528437.52,752845.68,5855574.46",lngLatBounds:"126.0,40.89,132.0,52.79"},{epsg:"4589",projectBounds:"263537.79,4987280.71,482968.99,5367350.29",lngLatBounds:"132.0,45.02,134.77,48.4"}]},{crs:"NewBeijing54",is3DegreeBelt:!0,epsgs:[{epsg:"4782",projectBounds:"375270.41,3964532.72,635576.4,4502867.2",lngLatBounds:"73.62,35.81,76.5,40.65"},{epsg:"4783",projectBounds:"356778.34,3434361.43,643221.66,4633924.53",lngLatBounds:"76.5,31.03,79.5,41.83"},{epsg:"4784",projectBounds:"355187.29,3314629.72,645778.24,5083946.53",lngLatBounds:"79.5,29.95,82.51,45.88"},{epsg:"4785",projectBounds:"352801.03,3127310.97,647198.97,5234000.65",lngLatBounds:"82.5,28.26,85.5,47.23"},{epsg:"4786",projectBounds:"352173.59,3076332.91,647826.41,5450825.03",lngLatBounds:"85.5,27.8,88.5,49.18"},{epsg:"4787",projectBounds:"350539.08,3023142.02,649460.92,5366325.48",lngLatBounds:"88.49,27.32,91.51,48.42"},{epsg:"4788",projectBounds:"352051.94,3066359.33,647948.06,5000574.69",lngLatBounds:"91.5,27.71,94.5,45.13"},{epsg:"4789",projectBounds:"352759.82,3123986.22,648221.91,4930577.19",lngLatBounds:"94.5,28.23,97.51,44.5"},{epsg:"4790",projectBounds:"344479.7,2370728.67,655520.3,4737233.2",lngLatBounds:"97.5,21.43,100.5,42.76"},{epsg:"4791",projectBounds:"344163.94,2337511.88,655836.06,4729456.73",lngLatBounds:"100.5,21.13,103.5,42.69"},{epsg:"4792",projectBounds:"345640.47,2489211.69,655388.76,4676149.36",lngLatBounds:"103.5,22.5,106.51,42.21"},{epsg:"4793",projectBounds:"341296.15,2012047.34,659762.08,4705031.58",lngLatBounds:"106.5,18.19,109.51,42.47"},{epsg:"4794",projectBounds:"341223.9,2003192.6,658776.1,4998351.97",lngLatBounds:"109.5,18.11,112.5,45.11"},{epsg:"4795",projectBounds:"344575.26,2380693.94,655424.74,5036139.17",lngLatBounds:"112.5,21.52,115.5,45.45"},{epsg:"4796",projectBounds:"345751.7,2500285.66,654248.3,5528676.17",lngLatBounds:"115.5,22.6,118.5,49.88"},{epsg:"4797",projectBounds:"347869.68,2702964.18,652130.32,5912498.95",lngLatBounds:"118.5,24.43,121.5,53.33"},{epsg:"4798",projectBounds:"352746.09,3122877.96,647253.91,5938094.6",lngLatBounds:"121.5,28.22,124.5,53.56"},{epsg:"4799",projectBounds:"372260.33,4450704.66,627739.67,5898032.24",lngLatBounds:"124.5,40.19,127.5,53.2"},{epsg:"4800",projectBounds:"374501.67,4581745.53,625498.33,5569829.63",lngLatBounds:"127.5,41.37,130.5,50.25"},{epsg:"4822",projectBounds:"383489.9,5079528.71,482968.99,5364087.01",lngLatBounds:"133.5,45.85,134.77,48.4"}]}],r=!1;e[0]>=10&&e[0]<180&&e[1]>=10&&e[1]<180&&(r=!0);for(let o of s)for(let s of o.epsgs){if(t&&o.crs!=t)continue;if("boolean"==typeof i&&o.is3DegreeBelt!=i)continue;let a;if(a=r?s.lngLatBounds:s.projectBounds,a=Yb.fromString(`[${a}]`),a.contains(jb(e))){let e,t,i=+s.epsg;if(i>=2338&&i<=2348)t=i-2338,e=`+proj=tmerc +lat_0=0 +lon_0=${75+6*t} +k=1 +x_0=500000 +y_0=0 +ellps=IAU76 +units=m +no_defs +type=crs`;else if(i>=2370&&i<=2390)t=i-2370,e=`+proj=tmerc +lat_0=0 +lon_0=${75+3*t} +k=1 +x_0=500000 +y_0=0 +ellps=IAU76 +units=m +no_defs +type=crs`;else if(i>=2422&&i<=2442){t=i-2422;let n="12.646,-155.176,-80.863,0,0,0,0",s="15.8,-154.4,-82.3,0,0,0,0";e=`+proj=tmerc +lat_0=0 +lon_0=${75+3*t} +k=1 +x_0=500000 +y_0=0 +ellps=krass +towgs84=${[n,s,s,s,s,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n][t]} +units=m +no_defs +type=crs`}else i>=4502&&i<=4512?(t=i-4502,e=`+proj=tmerc +lat_0=0 +lon_0=${75+6*t} +k=1 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs +type=crs`):i>=4534&&i<=4554?(t=i-4534,e=`+proj=tmerc +lat_0=0 +lon_0=${75+3*t} +k=1 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs +type=crs`):i>=4579&&i<=4589?(t=i-4579,e=`+proj=tmerc +lat_0=0 +lon_0=${75+6*t} +k=1 +x_0=500000 +y_0=0 +ellps=krass +units=m +no_defs +type=crs`):i>=4782&&i<=4800?(t=i-4782,e=`+proj=tmerc +lat_0=0 +lon_0=${75+3*t} +k=1 +x_0=500000 +y_0=0 +ellps=krass +units=m +no_defs +type=crs`):4822==i&&(e="+proj=tmerc +lat_0=0 +lon_0=135 +k=1 +x_0=500000 +y_0=0 +ellps=krass +units=m +no_defs +type=crs");n.push({crs:o.crs,is3DegreeBelt:o.is3DegreeBelt,epsg:`EPSG:${s.epsg}`,proj:e})}}}return n}};class Yb{constructor(e,t){this.min=null!=e?e:new Nb(-1/0,-1/0),this.max=null!=t?t:new Nb(1/0,1/0),this.set(this.min,this.max)}static fromArray(e){return new Yb(new Nb(e[0],e[1]),new Nb(e[2],e[3]))}static fromString(e){e.indexOf("[")<0&&e.indexOf("]")<0&&(e="["+e+"]");const t=JSON.parse(e);if(Array.isArray(t)&&4===t.length)return new Yb(new Nb(t[0],t[1]),new Nb(t[2],t[3]));throw Error("param is not array length four string")}static fromDataExtent(e){const t=new Yb,i=[];return Gb.convert(e,(e=>(i.push(new Nb(e[0],e[1])),e))),t.update(i),t}static fromCenterWH(e,t,i){const n=Nb.convert(e);return i=null!=i?i:t,new Yb(new Nb(n.x-t/2,n.y-i/2),new Nb(n.x+t/2,n.y+i/2))}set(e,t){let i=Math.min(e.x,t.x),n=Math.min(e.y,t.y),s=Math.max(e.x,t.x),r=Math.max(e.y,t.y);this.min.x=i,this.min.y=n,this.max.x=s,this.max.y=r}center(){return new Nb((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2)}leftTop(){return new Nb(this.min.x,this.max.y)}leftBottom(){return new Nb(this.min.x,this.min.y)}rightTop(){return new Nb(this.max.x,this.max.y)}rightBottom(){return new Nb(this.max.x,this.min.y)}randomPoint(e=.6,t=.6){const i=this.width()*Math.random()*e,n=this.height()*Math.random()*t,s=this.center();return new Nb(s.x-this.width()*e/2+i,s.y-this.height()*t/2+n)}randomPoints(e,t,i=.6,n=.6){const s=Dv(e,t),r=[];for(let e=0;e<s;e++)r.push(this.randomPoint(i,n));return r}randomGeoJsonPointCollection(e,t=.6,i=.6,n){if(n=null!=n?n:()=>{},1===e){const e=this.randomPoint(t,i);return{type:"Feature",id:1,properties:Object.assign({index:1},n(1)),geometry:{type:"Point",coordinates:[e.x,e.y]}}}{const s={type:"FeatureCollection",features:[]};for(let r=0;r<e;r++){const e=this.randomPoint(t,i),o={type:"Feature",id:r+1,properties:Object.assign({index:r+1},n(r+1)),geometry:{type:"Point",coordinates:[e.x,e.y]}};s.features.push(o)}return s}}randomGeoJsonLineCollection(e,t,i=.6,n=.6,s,r,o){o=null!=o?o:2,s=null!=s?s:()=>{};const a=Dv(r=null!=r?r:1,e),l={type:"FeatureCollection",features:[]};for(let e=0;e<a;e++){const r=Dv(o,t),a=[];for(let e=0;e<r;e++){const e=this.randomPoint(i,n);a.push([e.x,e.y])}const h={type:"Feature",id:e+1,properties:Object.assign({index:e+1},s(e+1)),geometry:{type:"LineString",coordinates:a}};l.features.push(h)}return l}randomGeoJsonPolygonCollection(e,t,i=.6,n=.6,s,r,o){o=null!=o?o:3,s=null!=s?s:()=>{};const a=Dv(r=null!=r?r:1,e),l={type:"FeatureCollection",features:[]};for(let e=0;e<a;e++){const r=Dv(o,t),a=[];for(let e=0;e<r;e++){const e=this.randomPoint(i,n);a.push([e.x,e.y])}a.length>0&&a.push(a[0]);const h={type:"Feature",id:e+1,properties:Object.assign({index:e+1},s(e+1)),geometry:{type:"Polygon",coordinates:[a]}};l.features.push(h)}return l}toArray(){return[this.min.x,this.min.y,this.max.x,this.max.y]}toPointArray(){return[[this.min.x,this.max.y],[this.max.x,this.max.y],[this.max.x,this.min.y],[this.min.x,this.min.y]]}toString(e=6){return`${this.min.toString(e)},${this.max.toString(e)}`}clone(){return new Yb(this.min.clone(),this.max.clone())}square(e){const t=this.center();let i;return i=e?this.width()<this.height()?this.width():this.height():this.width()>this.height()?this.width():this.height(),new Yb(new Nb(t.x-i/2,t.y-i/2),new Nb(t.x+i/2,t.y+i/2))}width(){return this.max.x-this.min.x}height(){return this.max.y-this.min.y}scale(e,t){if(isNaN(e))return this.clone();e=e||1,t||(t=this.center());const i=t.x,n=t.y,s=(this.min.x-i)*e+i,r=(this.min.y-n)*e+n,o=(this.max.x-i)*e+i,a=(this.max.y-n)*e+n;return new Yb(new Nb(s,r),new Nb(o,a))}scaleXY(e,t,i){e=null!=e?e:1,t=null!=t?t:1,i||(i=this.center());const n=i.x,s=i.y,r=(this.min.x-n)*e+n,o=(this.min.y-s)*t+s,a=(this.max.x-n)*e+n,l=(this.max.y-s)*t+s;return new Yb(new Nb(r,o),new Nb(a,l))}translate(e,t){this.min.x+=e,this.min.y+=t,this.max.x+=e,this.max.y+=t}update(e){let t=-1/0,i=-1/0,n=1/0,s=1/0;this.min.x!=1/0&&this.min.y!=-1/0&&(t=this.max.x,i=this.max.y,n=this.min.x,s=this.min.y);for(let r=0;r<e.length;r++){const o=e[r];o.x<n&&(n=o.x),o.x>t&&(t=o.x),o.y<s&&(s=o.y),o.y>i&&(i=o.y)}this.min.x=n,this.min.y=s,this.max.x=t,this.max.y=i}updateByBounds(e){let t,i=-1/0,n=-1/0,s=1/0,r=1/0;this.min.x!=1/0&&this.min.y!=-1/0&&(i=this.max.x,n=this.max.y,s=this.min.x,r=this.min.y),Array.isArray(e)||(e=[e]);for(let o=0;o<e.length;o++)t=e[o],t.min.x<s&&(s=t.min.x),t.min.y<r&&(r=t.min.y),t.max.x>i&&(i=t.max.x),t.max.y>n&&(n=t.max.y);this.min.x=s,this.min.y=r,this.max.x=i,this.max.y=n}intersect(e){const t=Math.max(this.min.x,e.min.x),i=Math.min(this.max.x,e.max.x),n=Math.max(this.min.y,e.min.y),s=i-t,r=Math.min(this.max.y,e.max.y)-n;if(s<0||r<0)return null;const o=new Nb(t,n),a=new Nb(t+s,n+r);return new Yb(o,a)}union(e){const t=new Nb(Math.min(this.min.x,e.min.x),Math.min(this.min.y,e.min.y)),i=new Nb(Math.max(this.max.x,e.max.x),Math.max(this.max.y,e.max.y));return new Yb(t,i)}isIntersect(e){return this.min.x<=e.max.x&&this.max.x>=e.min.x&&this.min.y<=e.max.y&&this.max.y>=e.min.y}isContains(e){return this.min.x<=e.min.x&&this.min.y<=e.min.y&&this.max.x>=e.max.x&&this.max.y>=e.max.y}contains(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}closestInterval(e,t,i=!0){return t<=e.min?{value:e.min,contained:!1}:e.max<=t?{value:e.max,contained:!1}:i?{value:t,contained:!0}:t-e.min<e.max-t?{value:e.min,contained:!0}:{value:e.max,contained:!0}}closestPoint(e,t=!0){const i=this.closestInterval({min:this.min.x,max:this.max.x},e.x,t),n=this.closestInterval({min:this.min.y,max:this.max.y},e.y,t);return i.contained||n.contained?i.contained&&!n.contained?new Nb(e.x,n.value):!i.contained&&n.contained?new Nb(i.value,e.y):t?e:Math.abs(e.x-i.value)<Math.abs(e.y-n.value)?new Nb(i.value,e.y):new Nb(e.x,n.value):new Nb(i.value,n.value)}}function Xb(e,t){return new Yb(e,t)}class Qb{static lngLat2Mercator(e){const t=Nb.convert(e),i=t.x*Qb.EQUATORIAL_SEMIPERIMETER/180;let n=Math.log(Math.tan((90+t.y)*Math.PI/360))/(Math.PI/180);return n=n*Qb.EQUATORIAL_SEMIPERIMETER/180,[i,n]}static mercator2LngLat(e){const t=Nb.convert(e),i=t.x/Qb.EQUATORIAL_SEMIPERIMETER*180;let n=t.y/Qb.EQUATORIAL_SEMIPERIMETER*180;return n=180/Math.PI*(2*Math.atan(Math.exp(n*Math.PI/180))-Math.PI/2),[i,n]}}Qb.EQUATORIAL_SEMIPERIMETER=20037508.3427892,Qb.EARTH_BOUNDS=[-Qb.EQUATORIAL_SEMIPERIMETER,-Qb.EQUATORIAL_SEMIPERIMETER,Qb.EQUATORIAL_SEMIPERIMETER,Qb.EQUATORIAL_SEMIPERIMETER];class qb extends Qb{constructor(e){super(),this._ratio_x=1,this._ratio_y=1,this.mapExtent="string"==typeof e?Yb.fromString(e):e,this.setExtent(this.mapExtent)}setExtent(e){this.mapExtent=e,this._ratio_x=(Qb.EARTH_BOUNDS[2]-Qb.EARTH_BOUNDS[0])/this.mapExtent.width(),this._ratio_y=(Qb.EARTH_BOUNDS[3]-Qb.EARTH_BOUNDS[1])/this.mapExtent.height()}toMercator(e){const t=Nb.convert(e);return[Qb.EARTH_BOUNDS[0]+(t.x-this.mapExtent.min.x)*this._ratio_x,Qb.EARTH_BOUNDS[1]+(t.y-this.mapExtent.min.y)*this._ratio_y]}fromMercator(e){const t=Nb.convert(e);return[this.mapExtent.min.x+(t.x-Qb.EARTH_BOUNDS[0])/this._ratio_x,this.mapExtent.min.y+(t.y-Qb.EARTH_BOUNDS[1])/this._ratio_y]}toLngLat(e){if(Vb(e)){const t=this.toMercator(e);return Qb.mercator2LngLat(t)}return Gb.convert(e,(e=>{const t=this.toMercator(e);return Qb.mercator2LngLat(t)}))}fromLngLat(e){if(Vb(e)){const t=Qb.lngLat2Mercator(e),i=this.fromMercator(t);return new Nb(i[0],i[1])}return Gb.convert(e,(e=>{const t=Qb.lngLat2Mercator(e);return Nb.convert(this.fromMercator(t))}))}getMapExtent(){return this.mapExtent}toMeter(e){return e*Qb.EQUATORIAL_SEMIPERIMETER*2/this.getMapExtent().width()}fromMeter(e){return e*this.getMapExtent().width()/(2*Qb.EQUATORIAL_SEMIPERIMETER)}}class Zb{constructor(e){var t,i,n;this.options=e,(null===(t=this.options.t)||void 0===t?void 0:t.length)>0&&!this.options.useInvDistWeight&&(this.variogram=this.train(e.t,e.x,e.y,e.z,e.model,null!==(i=e.sigma2)&&void 0!==i?i:0,null!==(n=e.alpha)&&void 0!==n?n:100))}invDist(e,t,i){var n;const s=e=>Math.abs(e)<1e-5;let r=0,o=0;for(let a=0;a<this.options.t.length;a++){if(s(e-this.options.x[a])&&s(t-this.options.y[a])&&s(i-this.options.z[a]))return this.options.t[a];const l=Math.sqrt(Math.pow(e-this.options.x[a],2)+Math.pow(t-this.options.y[a],2)+Math.pow(i-this.options.z[a],2)),h=1/Math.pow(l,null!==(n=this.options.power)&&void 0!==n?n:2);r+=h*this.options.t[a],o+=h}return r/o}predict(e,t,i){return this.options.useInvDistWeight?this.invDist(e,t,i):this._predict(e,t,i,this.variogram)}predicts(e){return e.map((e=>this.predict(e.x,e.y,e.z)))}variance(e,t,i){return this._variance(e,t,i,this.variogram)}max(e){return Math.max.apply(null,e)}min(e){return Math.min.apply(null,e)}mean(e){let t=0,i=0;const n=e.length;for(;t<n;t++)i+=e[t];return i/e.length}rep(e,t){const i=[];for(let n=0;n<t;n++)i.push(e);return i}matrixDiag(e,t){let i=0;const n=this.rep(0,t*t);for(;i<t;i++)n[i*t+i]=e;return n}matrixTranspose(e,t,i){let n,s=0;const r=Array(i*t);for(;s<t;s++)for(n=0;n<i;n++)r[n*t+s]=e[s*i+n];return r}matrixAdd(e,t,i,n){let s,r=0;const o=Array(i*n);for(;r<i;r++)for(s=0;s<n;s++)o[r*n+s]=e[r*n+s]+t[r*n+s];return o}matrixMultiply(e,t,i,n,s){let r,o,a=0;const l=Array(i*s);for(;a<i;a++)for(r=0;r<s;r++)for(l[a*s+r]=0,o=0;o<n;o++)l[a*s+r]+=e[a*n+o]*t[o*s+r];return l}matrixChol(e,t){let i,n,s;const r=Array(t);for(i=0;i<t;i++)r[i]=e[i*t+i];for(i=0;i<t;i++){for(n=0;n<i;n++)r[i]-=e[i*t+n]*e[i*t+n];if(r[i]<=0)return!1;for(r[i]=Math.sqrt(r[i]),n=i+1;n<t;n++){for(s=0;s<i;s++)e[n*t+i]-=e[n*t+s]*e[i*t+s];e[n*t+i]/=r[i]}}for(i=0;i<t;i++)e[i*t+i]=r[i];return!0}matrixChol2inv(e,t){let i,n,s,r;for(i=0;i<t;i++)for(e[i*t+i]=1/e[i*t+i],n=i+1;n<t;n++){for(r=0,s=i;s<n;s++)r-=e[n*t+s]*e[s*t+i];e[n*t+i]=r/e[n*t+n]}for(i=0;i<t;i++)for(n=i+1;n<t;n++)e[i*t+n]=0;for(i=0;i<t;i++){for(e[i*t+i]*=e[i*t+i],s=i+1;s<t;s++)e[i*t+i]+=e[s*t+i]*e[s*t+i];for(n=i+1;n<t;n++)for(s=n;s<t;s++)e[i*t+n]+=e[s*t+i]*e[s*t+n]}for(i=0;i<t;i++)for(n=0;n<i;n++)e[i*t+n]=e[n*t+i]}matrixSolve(e,t){const i=t,n=Array(t*t),s=Array(t),r=Array(t),o=Array(t);let a,l,h,c,d,u,p,f,m,g=0,v=0;for(a=0;a<t;a++)for(l=0;l<t;l++)n[a*t+l]=a===l?1:0;for(l=0;l<t;l++)o[l]=0;for(a=0;a<t;a++){for(u=0,l=0;l<t;l++)if(1!==o[l])for(h=0;h<t;h++)0===o[h]&&Math.abs(e[l*t+h])>=u&&(u=Math.abs(e[l*t+h]),v=l,g=h);if(++o[g],v!==g){for(c=0;c<t;c++)m=e[v*t+c],e[v*t+c]=e[g*t+c],e[g*t+c]=m;for(c=0;c<i;c++)m=n[v*t+c],n[v*t+c]=n[g*t+c],n[g*t+c]=m}if(r[a]=v,s[a]=g,0===e[g*t+g])return!1;for(f=1/e[g*t+g],e[g*t+g]=1,c=0;c<t;c++)e[g*t+c]*=f;for(c=0;c<i;c++)n[g*t+c]*=f;for(d=0;d<t;d++)if(d!==g){for(p=e[d*t+g],e[d*t+g]=0,c=0;c<t;c++)e[d*t+c]-=e[g*t+c]*p;for(c=0;c<i;c++)n[d*t+c]-=n[g*t+c]*p}}for(c=t-1;c>=0;c--)if(r[c]!==s[c])for(h=0;h<t;h++)m=e[h*t+r[c]],e[h*t+r[c]]=e[h*t+s[c]],e[h*t+s[c]]=m;return!0}variogramGaussian(e,t,i,n,s){return t+(n-t)/i*(1-Math.exp(-1/s*Math.pow(e/i,2)))}variogramExponential(e,t,i,n,s){return t+(n-t)/i*(1-Math.exp(-1/s*(e/i)))}variogramSpherical(e,t,i,n){return e>i?t+(n-t)/i:t+(n-t)/i*(e/i*1.5-.5*Math.pow(e/i,3))}variogramCircle(e,t,i,n){return e>i?t+(n-t)/i:t+(n-t)/i*(2/Math.PI)*(e/i*Math.sqrt(1-Math.pow(e/i,2))+Math.asin(e/i))}variogramLinear(e,t,i,n){return e>i?t+(n-t)/i:t+(n-t)/i*(e/i)}train(e,t,i,n,s,r,o){s=null!=s?s:"exponential",r=null!=r?r:0,o=null!=o?o:100;const a={t:e,x:t,y:i,z:n,nugget:0,range:0,sill:0,A:1/3,n:0,model:this.variogramExponential,K:[],M:[]};switch(s){case"gaussian":a.model=this.variogramGaussian;break;case"exponential":default:a.model=this.variogramExponential;break;case"spherical":a.model=this.variogramSpherical;break;case"circle":a.model=this.variogramCircle;break;case"linear":a.model=this.variogramLinear}let l,h,c,d,u=e.length;const p=Array((u*u-u)/2);for(l=0,c=0;l<u;l++)for(h=0;h<l;h++,c++)p[c]=Array(2),p[c][0]=Math.sqrt(Math.pow(t[l]-t[h],2)+Math.pow(i[l]-i[h],2)+Math.pow(n[l]-n[h],2)),p[c][1]=Math.abs(e[l]-e[h]);p.sort(((e,t)=>e[0]-t[0])),a.range=p[(u*u-u)/2-1][0];const f=(u*u-u)/2>30?30:(u*u-u)/2,m=a.range/f,g=this.rep(0,f),v=this.rep(0,f);if(f<30)for(d=0;d<f;d++)g[d]=p[d][0],v[d]=p[d][1];else{for(l=0,h=0,c=0,d=0;l<f&&h<(u*u-u)/2;l++,c=0){for(;p[h][0]<=(l+1)*m&&(g[d]+=p[h][0],v[d]+=p[h][1],h++,c++,!(h>=(u*u-u)/2)););c>0&&(g[d]/=c,v[d]/=c,d++)}if(d<2)return a}u=d,a.range=g[u-1]-g[0];const y=this.rep(1,2*u),x=Array(u),{A:w}=a;for(l=0;l<u;l++){switch(s){case"gaussian":y[2*l+1]=1-Math.exp(-1/w*Math.pow(g[l]/a.range,2));break;case"exponential":y[2*l+1]=1-Math.exp(-1/w*g[l]/a.range);break;case"spherical":y[2*l+1]=g[l]/a.range*1.5-.5*Math.pow(g[l]/a.range,3);break;case"circle":y[2*l+1]=2/Math.PI*(g[l]/a.range*Math.sqrt(1-Math.pow(g[l]/a.range,2))+Math.asin(g[l]/a.range));break;case"linear":y[2*l+1]=g[l]/a.range}x[l]=v[l]}const b=this.matrixTranspose(y,u,2);let _=this.matrixMultiply(b,y,2,u,2);_=this.matrixAdd(_,this.matrixDiag(1/o,2),2,2);const S=_.slice(0);this.matrixChol(_,2)?this.matrixChol2inv(_,2):(this.matrixSolve(S,2),_=S);const M=this.matrixMultiply(this.matrixMultiply(_,b,2,2,u),x,2,u,1);a.nugget=M[0],a.sill=M[1]*a.range+a.nugget,a.n=t.length,u=t.length;const C=Array(u*u);for(l=0;l<u;l++){for(h=0;h<l;h++)C[l*u+h]=a.model(Math.sqrt(Math.pow(t[l]-t[h],2)+Math.pow(i[l]-i[h],2)+Math.pow(n[l]-n[h],2)),a.nugget,a.range,a.sill,a.A),C[h*u+l]=C[l*u+h];C[l*u+l]=a.model(0,a.nugget,a.range,a.sill,a.A)}let A=this.matrixAdd(C,this.matrixDiag(r,u),u,u);const E=A.slice(0);this.matrixChol(A,u)?this.matrixChol2inv(A,u):(this.matrixSolve(E,u),A=E);const T=A.slice(0),P=this.matrixMultiply(A,e,u,u,1);return a.K=T,a.M=P,a}_predict(e,t,i,n){let s;const r=Array(n.n);for(s=0;s<n.n;s++)r[s]=n.model(Math.sqrt(Math.pow(e-n.x[s],2)+Math.pow(t-n.y[s],2)+Math.pow(i-n.z[s],2)),n.nugget,n.range,n.sill,n.A);return this.matrixMultiply(r,n.M,1,n.n,1)[0]}_variance(e,t,i,n){let s;const r=Array(n.n);for(s=0;s<n.n;s++)r[s]=n.model(Math.sqrt(Math.pow(e-n.x[s],2)+Math.pow(t-n.y[s],2)+Math.pow(i-n.z[s],2)),n.nugget,n.range,n.sill,n.A);const o=this.matrixMultiply(this.matrixMultiply(r,n.K,1,n.n,n.n),r,1,n.n,1)[0];return n.model(0,n.nugget,n.range,n.sill,n.A)+o}}const Kb={triangulate:function(e,t,i=2){const n=t&&t.length,s=n?t[0]*i:e.length;let r=Jb(e,0,s,i,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,h,c,d,u,p;if(n&&(r=function(e,t,i,n){const s=[];let r,o,a,l,h;for(r=0,o=t.length;r<o;r++)a=t[r]*n,l=r<o-1?t[r+1]*n:e.length,h=Jb(e,a,l,n,!1),h===h.next&&(h.steiner=!0),s.push(h_(h));for(s.sort(r_),r=0;r<s.length;r++)i=o_(s[r],i);return i}(e,t,r,i)),e.length>80*i){a=h=e[0],l=c=e[1];for(let t=i;t<s;t+=i)d=e[t],u=e[t+1],d<a&&(a=d),u<l&&(l=u),d>h&&(h=d),u>c&&(c=u);p=Math.max(h-a,c-l),p=0!==p?32767/p:0}return e_(r,o,i,a,l,p,0),o},flatten:function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,s=0;s<e.length;s++){for(var r=0;r<e[s].length;r++)for(var o=0;o<t;o++)i.vertices.push(e[s][r][o]);s>0&&(n+=e[s-1].length,i.holes.push(n))}return i}};function Jb(e,t,i,n,s){let r,o;if(s===function(e,t,i,n){let s=0;for(let r=t,o=i-n;r<i;r+=n)s+=(e[o]-e[r])*(e[r+1]+e[o+1]),o=r;return s}(e,t,i,n)>0)for(r=t;r<i;r+=n)o=x_(r,e[r],e[r+1],o);else for(r=i-n;r>=t;r-=n)o=x_(r,e[r],e[r+1],o);return o&&p_(o,o.next)&&(w_(o),o=o.next),o}function $b(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!p_(n,n.next)&&0!==u_(n.prev,n,n.next))n=n.next;else{if(w_(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function e_(e,t,i,n,s,r,o){if(!e)return;!o&&r&&function(e,t,i,n){let s=e;do{0===s.z&&(s.z=l_(s.x,s.y,t,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){let t,i,n,s,r,o,a,l,h=1;do{for(i=e,e=null,r=null,o=0;i;){for(o++,n=i,a=0,t=0;t<h&&(a++,n=n.nextZ,n);t++);for(l=h;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:e=s,s.prevZ=r,r=s;i=n}r.nextZ=null,h*=2}while(o>1)}(s)}(e,n,s,r);let a,l,h=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,r?i_(e,n,s,r):t_(e))t.push(a.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),w_(e),e=l.next,h=l.next;else if((e=l)===h){o?1===o?e_(e=n_($b(e),t,i),t,i,n,s,r,2):2===o&&s_(e,t,i,n,s,r):e_($b(e),t,i,n,s,r,1);break}}function t_(e){const t=e.prev,i=e,n=e.next;if(u_(t,i,n)>=0)return!1;const s=t.x,r=i.x,o=n.x,a=t.y,l=i.y,h=n.y,c=s<r?s<o?s:o:r<o?r:o,d=a<l?a<h?a:h:l<h?l:h,u=s>r?s>o?s:o:r>o?r:o,p=a>l?a>h?a:h:l>h?l:h;let f=n.next;for(;f!==t;){if(f.x>=c&&f.x<=u&&f.y>=d&&f.y<=p&&c_(s,a,r,l,o,h,f.x,f.y)&&u_(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function i_(e,t,i,n){const s=e.prev,r=e,o=e.next;if(u_(s,r,o)>=0)return!1;const a=s.x,l=r.x,h=o.x,c=s.y,d=r.y,u=o.y,p=a<l?a<h?a:h:l<h?l:h,f=c<d?c<u?c:u:d<u?d:u,m=a>l?a>h?a:h:l>h?l:h,g=c>d?c>u?c:u:d>u?d:u,v=l_(p,f,t,i,n),y=l_(m,g,t,i,n);let x=e.prevZ,w=e.nextZ;for(;x&&x.z>=v&&w&&w.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==o&&c_(a,c,l,d,h,u,x.x,x.y)&&u_(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,w.x>=p&&w.x<=m&&w.y>=f&&w.y<=g&&w!==s&&w!==o&&c_(a,c,l,d,h,u,w.x,w.y)&&u_(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==o&&c_(a,c,l,d,h,u,x.x,x.y)&&u_(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=y;){if(w.x>=p&&w.x<=m&&w.y>=f&&w.y<=g&&w!==s&&w!==o&&c_(a,c,l,d,h,u,w.x,w.y)&&u_(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function n_(e,t,i){let n=e;do{const s=n.prev,r=n.next.next;!p_(s,r)&&f_(s,n,n.next,r)&&v_(s,r)&&v_(r,s)&&(t.push(s.i/i|0),t.push(n.i/i|0),t.push(r.i/i|0),w_(n),w_(n.next),n=e=r),n=n.next}while(n!==e);return $b(n)}function s_(e,t,i,n,s,r){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&d_(o,e)){let a=y_(o,e);return o=$b(o,o.next),a=$b(a,a.next),e_(o,t,i,n,s,r,0),void e_(a,t,i,n,s,r,0)}e=e.next}o=o.next}while(o!==e)}function r_(e,t){return e.x-t.x}function o_(e,t){const i=function(e,t){let i,n=t,s=-1/0;const r=e.x,o=e.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const e=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s&&(s=e,i=n.x<n.next.x?n:n.next,e===r))return i}n=n.next}while(n!==t);if(!i)return null;const a=i,l=i.x,h=i.y;let c,d=1/0;n=i;do{r>=n.x&&n.x>=l&&r!==n.x&&c_(o<h?r:s,o,l,h,o<h?s:r,o,n.x,n.y)&&(c=Math.abs(o-n.y)/(r-n.x),v_(n,e)&&(c<d||c===d&&(n.x>i.x||n.x===i.x&&a_(i,n)))&&(i=n,d=c)),n=n.next}while(n!==a);return i}(e,t);if(!i)return t;const n=y_(i,e);return $b(n,n.next),$b(i,i.next)}function a_(e,t){return u_(e.prev,e,t.prev)<0&&u_(t.next,e,e.next)<0}function l_(e,t,i,n,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function h_(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function c_(e,t,i,n,s,r,o,a){return(s-o)*(t-a)>=(e-o)*(r-a)&&(e-o)*(n-a)>=(i-o)*(t-a)&&(i-o)*(r-a)>=(s-o)*(n-a)}function d_(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&f_(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(v_(e,t)&&v_(t,e)&&function(e,t){let i=e,n=!1;const s=(e.x+t.x)/2,r=(e.y+t.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(u_(e.prev,e,t.prev)||u_(e,t.prev,t))||p_(e,t)&&u_(e.prev,e,e.next)>0&&u_(t.prev,t,t.next)>0)}function u_(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function p_(e,t){return e.x===t.x&&e.y===t.y}function f_(e,t,i,n){const s=g_(u_(e,t,i)),r=g_(u_(e,t,n)),o=g_(u_(i,n,e)),a=g_(u_(i,n,t));return s!==r&&o!==a||!(0!==s||!m_(e,i,t))||!(0!==r||!m_(e,n,t))||!(0!==o||!m_(i,e,n))||!(0!==a||!m_(i,t,n))}function m_(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function g_(e){return e>0?1:e<0?-1:0}function v_(e,t){return u_(e.prev,e,e.next)<0?u_(e,t,e.next)>=0&&u_(e,e.prev,t)>=0:u_(e,t,e.prev)<0||u_(e,e.next,t)<0}function y_(e,t){const i=new b_(e.i,e.x,e.y),n=new b_(t.i,t.x,t.y),s=e.next,r=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function x_(e,t,i,n){const s=new b_(e,t,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function w_(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function b_(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function __(e,t,i){var n=t[0],s=t[1],r=i[0]-n,o=i[1]-s;if(0!==r||0!==o){var a=((e[0]-n)*r+(e[1]-s)*o)/(r*r+o*o);a>1?(n=i[0],s=i[1]):a>0&&(n+=r*a,s+=o*a)}return(r=e[0]-n)*r+(o=e[1]-s)*o}function S_(e,t,i,n,s){for(var r,o=n,a=t+1;a<i;a++){var l=__(e[a],e[t],e[i]);l>o&&(r=a,o=l)}o>n&&(r-t>1&&S_(e,t,r,n,s),s.push(e[r]),i-r>1&&S_(e,r,i,n,s))}function M_(e,t){var i=e.length-1,n=[e[0]];return S_(e,0,i,t,n),n.push(e[i]),n}function C_(e,t,i){if(e.length<=2)return e;var n=void 0!==t?t*t:1;return e=i?e:function(e,t){for(var i,n,s,r,o,a=e[0],l=[a],h=1,c=e.length;h<c;h++)s=a,(r=(n=i=e[h])[0]-s[0])*r+(o=n[1]-s[1])*o>t&&(l.push(i),a=i);return a!==i&&l.push(i),l}(e,n),M_(e,n)}function A_(e,t){return e[0]*t[0]+e[1]*t[1]}function E_(e,t){const i=t[0],n=t[1],s=Math.sqrt(i*i+n*n)||1;return e[0]=i/s,e[1]=n/s,e}function T_(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e}function P_(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function O_(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function D_(e,t){const i=t[0],n=t[1],s=t[2],r=Math.sqrt(i*i+n*n+s*s)||1;return e[0]=i/r,e[1]=n/r,e[2]=s/r,e}function B_(e,t,i){var n=t[0],s=t[1],r=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-r*a,e[1]=r*o-n*l,e[2]=n*a-s*o,e}const I_=[];function R_(e,t,i,n){const s=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(t,i),r=Math.acos(s)*n;return T_(I_,i,t,-s),function(e,t){const i=t[0],n=t[1],s=t[2],r=Math.sqrt(i*i+n*n+s*s)||1;e[0]=i/r,e[1]=n/r,e[2]=s/r}(I_,I_),function(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}(e,t,Math.cos(r)),T_(e,e,I_,Math.sin(r)),e}function k_(e,t,i,n,s,r,o,a,l,h){const c=o-s,d=a-r,u=(c*(t-r)-d*(e-s))/(d*(i-e)-c*(n-t));return l&&(l[h=h||0]=e+u*(i-e),l[h+1]=t+u*(n-t)),u}function L_(e,t,i){if(i-t<3)return 0;let n=0;for(let s=2*(i-1),r=2*t;r<2*i;){const t=e[s],i=e[s+1],o=e[r],a=e[r+1];s=r,r+=2,n+=t*a-o*i}return n}function z_(e,t,i,n,s,r){return(i-e)*(r-n)-(n-t)*(s-i)}function U_(e,t,i=2){return Kb.triangulate(e,t,i)}function F_(e){return Kb.flatten(e)}const N_=[],j_=[],V_=[];function H_(e,t,i,n,s,r,o,a,l){if(!l){const l=null!=o;let h=s,c=null;l&&(c=new Uint32Array(n-i));for(let s=i;s<n;s++){const d=s===n-1?i:s+1,u=s===i?n-1:s-1,p=e[2*u],f=e[2*u+1],m=e[2*s],g=e[2*s+1],v=e[2*d],y=e[2*d+1];if(N_[0]=m-p,N_[1]=g-f,j_[0]=v-m,j_[1]=y-g,E_(N_,N_),E_(j_,j_),l&&(c[s]=h),a||s!==i)if(a||s!==n-1){P_(V_,j_,N_);const e=V_[1];V_[1]=-V_[0],V_[0]=e,E_(V_,V_);const i=A_(V_,j_),n=Math.sqrt(1-i*i),s=r*Math.min(10,1/n);if(l&&1/n>o&&r*i<0){const e=m+V_[0]*r,i=g+V_[1]*r,s=Math.acos(n)/2,o=Math.tan(s)*Math.abs(r);t[2*h]=e+V_[1]*o,t[2*h+1]=i-V_[0]*o,h++,t[2*h]=e-V_[1]*o,t[2*h+1]=i+V_[0]*o,h++}else t[2*h]=m+V_[0]*s,t[2*h+1]=g+V_[1]*s,h++}else V_[0]=N_[1],V_[1]=-N_[0],E_(V_,V_),t[2*h]=m+V_[0]*r,t[2*h+1]=g+V_[1]*r,h++;else V_[0]=j_[1],V_[1]=-j_[0],E_(V_,V_),t[2*h]=m+V_[0]*r,t[2*h+1]=g+V_[1]*r,h++}return c}const h=null!=o;let c,d,u,p=s,f=null;h&&(f=new Uint32Array(n-i));let m=[];for(let s=i;s<n;s++){const g=s===n-1?i:s+1,v=s===i?n-1:s-1,y=e[2*v],x=e[2*v+1],w=e[2*s],b=e[2*s+1],_=e[2*g],S=e[2*g+1];N_[0]=w-y,N_[1]=b-x,j_[0]=_-w,j_[1]=S-b,E_(N_,N_),E_(j_,j_),h&&(f[s]=p);let M,C,A=!1;if(a||s!==i)if(a||s!==n-1){P_(V_,j_,N_);const e=V_[1];V_[1]=-V_[0],V_[0]=e,E_(V_,V_);const i=A_(V_,j_),n=Math.sqrt(1-i*i),s=r*Math.min(10,1/n);if(h&&1/n>o&&r*i<0){const e=w+V_[0]*r,i=b+V_[1]*r,s=Math.acos(n)/2,o=Math.tan(s)*Math.abs(r);t[2*p]=e+V_[1]*o,t[2*p+1]=i-V_[0]*o,p++,t[2*p]=e-V_[1]*o,t[2*p+1]=i+V_[0]*o,p++}else M=w+V_[0]*s,C=b+V_[1]*s,A=!0;if(A){if(l&&null!=c){const e=k_(y,x,c,d,w,b,M,C,m,0);e>=-.01&&e<=1.01&&(t[2*u]=M=m[0],t[2*u+1]=C=m[1])}c=t[2*p]=M,d=t[2*p+1]=C,u=p,p++}}else V_[0]=N_[1],V_[1]=-N_[0],E_(V_,V_),M=w+V_[0]*r,C=b+V_[1]*r,A=!0;else V_[0]=j_[1],V_[1]=-j_[0],E_(V_,V_),c=t[2*p]=w+V_[0]*r,d=t[2*p+1]=b+V_[1]*r,u=p,p++}return f}function W_(e,t,i,n,s,r,o){const a=null!=n?[]:new Float32Array(e.length);if(H_(e,a,0,t&&t.length?t[0]:e.length/2,0,i,n,s,null==r||r),t)for(let r=0;r<t.length;r++){const l=t[r];H_(e,a,l,t[r+1]||e.length/2,null!=n?a.length/2:l,i,n,s,null!=o&&o)}return a}function G_(e,t,i,n){for(let s=0;s<Math.floor((n-i)/2);s++)for(let r=0;r<t;r++){const o=(s+i)*t+r,a=(n-s-1)*t+r,l=e[o];e[o]=e[a],e[a]=l}return e}function Y_(e,t){let i=e.length/2,n=0,s=t&&t.length?t[0]:i;L_(e,n,s)>0&&G_(e,2,n,s);for(let r=1;r<(t?t.length:0)+1;r++)n=t[r-1],s=t[r]||i,L_(e,n,s)<0&&G_(e,2,n,s)}function X_(e){e.depth=e.depth||1,e.bevelSize=e.bevelSize||0,e.bevelSegments=null==e.bevelSegments?2:e.bevelSegments,e.smoothBevel=e.smoothBevel||!1,e.simplify=e.simplify||0,null==e.smoothSide&&(e.smoothSide="auto"),null==e.smoothSideThreshold&&(e.smoothSideThreshold=.9),"number"==typeof e.depth&&(e.bevelSize=Math.min(e.bevelSegments>0?e.bevelSize:0,e.depth/2)),e.bevelSize>0||(e.bevelSegments=0),e.bevelSegments=Math.round(e.bevelSegments);const t=e.boundingRect;if(e.translate=e.translate||[0,0],e.scale=e.scale||[1,1],e.fitRect){let i=null==e.fitRect.x?t.x||0:e.fitRect.x,n=null==e.fitRect.y?t.y||0:e.fitRect.y,s=e.fitRect.width,r=e.fitRect.height;null==s?null!=r?s=r/t.height*t.width:(s=t.width,r=t.height):null==r&&(r=s/t.width*t.height),e.scale=[s/t.width,r/t.height],e.translate=[(i-t.x)*e.scale[0],(n-t.y)*e.scale[1]]}}const Q_=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];function q_(e,{vertices:t,topVertices:i,splittedMap:n,depth:s,rect:r},o,a,l,h){const c=a-o,d=h.smoothBevel?1:2,u=Math.min(s/2,h.bevelSize),p=h.bevelSegments,f=l.vertex,m=Math.max(r.width,r.height,s),g=n?e=>{const t=(e+1)%c;return n[e+o]===n[t+o]}:e=>!1;if(u>0){const r=[0,0,1],a=[],h=[0,0,-1],v=[];let y=0,x=new Float32Array(c);for(let w=0;w<2;w++){const b=0===w?s-u:u;for(let s=0;s<=p*d;s++){let _,S,M=0;for(let C=0;C<c;C++){const A=2*(C%c+o),E=n?2*n[A/2]:A;a[0]=t[A]-i[E],a[1]=t[A+1]-i[E+1],a[2]=0;const T=Math.sqrt(a[0]*a[0]+a[1]*a[1]);a[0]/=T,a[1]/=T;const P=(Math.floor(s/d)+s%d)/p;0===w?R_(v,r,a,P):R_(v,a,h,P);const O=0===w?P:1-P,D=u*Math.sin(O*Math.PI/2),B=T*Math.cos(O*Math.PI/2),I=u*T/Math.sqrt(D*D+B*B),R=v[0]*I+i[E],k=v[1]*I+i[E+1],L=v[2]*I+b;if(e.position[3*l.vertex]=R,e.position[3*l.vertex+1]=k,e.position[3*l.vertex+2]=L,C>0&&(M+=Math.sqrt((_-R)*(_-R)+(S-k)*(S-k))),s>0||w>0){let t=3*(l.vertex-c),i=e.position[t],n=e.position[t+1],s=e.position[t+2];x[C]+=Math.sqrt((i-R)*(i-R)+(n-k)*(n-k)+(s-L)*(s-L))}if(e.uv[2*l.vertex]=M/m,e.uv[2*l.vertex+1]=x[C]/m,_=R,S=k,l.vertex++,!g(C)&&(d>1&&s%d||1===d&&s>=1))for(let t=0;t<6;t++){const i=(Q_[t][0]+C)%c,n=Q_[t][1]+y;e.indices[l.index++]=(n-1)*c+i+f}}y++}}}else for(let i=0;i<2;i++){const n=0===i?s:0;let r,a,h=0;for(let i=0;i<c;i++){const s=2*(i+o),c=t[s],d=t[s+1],u=3*l.vertex,p=2*l.vertex;e.position[u]=c,e.position[u+1]=d,e.position[u+2]=n,i>0&&(h+=Math.sqrt((r-c)*(r-c)+(a-d)*(a-d))),e.uv[p]=h/m,e.uv[p+1]=n/m,r=c,a=d,l.vertex++}}const v=u>0?p*d+1:1;for(let t=0;t<c;t++)if(!g(t))for(let i=0;i<6;i++){const n=(Q_[i][0]+t)%c,s=Q_[i][1]+v;e.indices[l.index++]=(s-1)*c+n+f}}function Z_({indices:e,topVertices:t,rect:i,depth:n},s,r,o){if(t.length<=4)return;const a=r.vertex,l=e.length;for(let t=0;t<l;t++)s.indices[r.index++]=a+e[t];const h=Math.max(i.width,i.height);for(let e=0;e<(o.excludeBottom?1:2);e++)for(let o=0;o<t.length;o+=2){const a=t[o],l=t[o+1],c=3*r.vertex,d=2*r.vertex;s.position[c]=a,s.position[c+1]=l,s.position[c+2]=(1-e)*n,s.uv[d]=(a-i.x)/h,s.uv[d+1]=(l-i.y)/h,r.vertex++}if(!o.excludeBottom){const i=t.length/2;for(let t=0;t<l;t+=3)for(let n=0;n<3;n++)s.indices[r.index++]=a+i+e[t+2-n]}}function K_(e,t,i,n){const s=null==i||"auto"===i;if(!0===i)return{vertices:e,holes:t};const r=[],o=t&&[],a=e.length/2,l=[],h=[],c=[];let d=0,u=0;const p=(t?t.length:0)+1;for(let i=0;i<p;i++){0===i?u=t&&t.length?t[0]:a:(d=t[i-1],u=t[i]||a);for(let t=d;t<u;t++){const i=e[2*t],o=e[2*t+1],a=t===u-1?d:t+1,p=e[2*a],f=e[2*a+1];if(s){const s=t===d?u-1:t-1,a=e[2*s],m=e[2*s+1];l[0]=a-i,l[1]=m-o,h[0]=p-i,h[1]=f-o,E_(l,l),E_(h,h),1-(.5*A_(l,h)+.5)>n?(r.push(i,o),c.push(t)):(r.push(i,o,i,o),c.push(t,t))}else r.push(i,o,i,o),c.push(t,t)}i<p-1&&o&&o.push(r.length/2)}return{vertices:new Float32Array(r),splittedMap:c,holes:o}}function J_(e,t){var s,r,o;let a=0,l=0;for(let i=0;i<e.length;i++){let{indices:n,vertices:s,splittedMap:r,topVertices:o,holes:h,depth:c}=e[i];const d=Math.min(c/2,t.bevelSize)>0?t.bevelSegments:0;h=h||[],a+=n.length*(t.excludeBottom?1:2),l+=o.length/2*(t.excludeBottom?1:2);const u=2+2*d;let p=0,f=0;for(let e=0;e<h.length+1;e++){0===e?f=h.length?h[0]:s.length/2:(p=h[e-1],f=h[e]||s.length/2),a+=6*((r?r[f-1]+1:f)-(r?r[p]:p))*(u-1);const i=f-p;l+=i*u+(t.smoothBevel?0:d*i*2)}}const h={position:new Float32Array(3*l),indices:new(l>65535?Uint32Array:Uint16Array)(a),uv:new Float32Array(2*l)},c={vertex:0,index:0};for(let i=0;i<e.length;i++)Z_(e[i],h,c,t);for(let i=0;i<e.length;i++){const{holes:n,vertices:s}=e[i],r=s.length/2;let o=0,a=n&&n.length?n[0]:r;if(q_(h,e[i],o,a,c,t),n)for(let s=0;s<n.length;s++)o=n[s],a=n[s+1]||r,q_(h,e[i],o,a,c,t)}for(let e=0;e<h.uv.length;e++){const t=h.uv[e];t>0&&Math.round(t)===t?h.uv[e]=1:h.uv[e]=t%1}if(h.normal=function(e,t){function i(e,t,i,n){e[0]=t,e[1]=i,e[2]=n}const n=[],s=[],r=[],o=[],a=[],l=[],h=e.length,c=new Float32Array(t.length);for(let d=0;d<h;){const h=3*e[d++],u=3*e[d++],p=3*e[d++];i(n,t[h],t[h+1],t[h+2]),i(s,t[u],t[u+1],t[u+2]),i(r,t[p],t[p+1],t[p+2]),O_(o,n,s),O_(a,s,r),B_(l,o,a);for(let e=0;e<3;e++)c[h+e]=c[h+e]+l[e],c[u+e]=c[u+e]+l[e],c[p+e]=c[p+e]+l[e]}for(var d=0;d<c.length;)i(l,c[d],c[d+1],c[d+2]),D_(l,l),c[d++]=l[0],c[d++]=l[1],c[d++]=l[2];return c}(h.indices,h.position),h.boundingRect=e[0]&&e[0].rect,null===(o=null!==(s=null==t?void 0:t.isMapMode)&&void 0!==s?s:null===(r=Cy.app)||void 0===r?void 0:r.isMapMode)||void 0===o||!o){let e=[];for(let t=0;t<h.position.length;t+=3)h.position[t+2],h.position[t+1]=-h.position[t+1],h.position[t+2],e.push(new i(h.position[t],h.position[t+1],h.position[t+2]));let t=new n;t.makeRotationX(-Math.PI/2);let s=e.map((e=>e.applyMatrix4(t).toArray()));for(let e=0;e<s.length;e++)h.position[3*e]=s[e][0],h.position[3*e+1]=s[e][1],h.position[3*e+2]=s[e][2]}const d=new S;return d.setAttribute("position",new M(h.position,3)),d.setAttribute("normal",new M(h.normal,3)),d.setAttribute("uv",new M(h.uv,2)),d.setIndex(new C(h.indices,1)),h.geometry=d,h}function $_(e,t,i){var n,s;const r=i.lineWidth,o=e.length,a=new Float32Array(2*o),l=i.translate||[0,0],h=i.scale||[1,1];for(let t=0,i=0;t<o;t++)a[i++]=e[t][0]*h[0]+l[0],a[i++]=e[t][1]*h[1]+l[1];L_(a,0,o)<0&&G_(a,2,0,o);const c=[],d=[],u=i.miterLimit,p=H_(a,d,0,o,0,-r/2,u,!1,null!==(n=i.removeIntersections)&&void 0!==n&&n);G_(a,2,0,o);const f=H_(a,c,0,o,0,-r/2,u,!1,null!==(s=i.removeIntersections)&&void 0!==s&&s),m=(c.length+d.length)/2,g=new Float32Array(2*m);let v=0;const y=d.length/2;for(let e=0;e<d.length;e++)g[v++]=d[e];for(let e=0;e<c.length;e++)g[v++]=c[e];const x=new(m>65535?Uint32Array:Uint16Array)(3*(2*(o-1)+(m-2*o)));let w=0;for(let e=0;e<o-1;e++){const t=e+1;x[w++]=y-1-p[e],x[w++]=y-1-p[e]-1,x[w++]=f[e]+1+y,x[w++]=y-1-p[e],x[w++]=f[e]+1+y,x[w++]=f[e]+y,f[t]-f[e]==2?(x[w++]=f[e]+2+y,x[w++]=f[e]+1+y,x[w++]=y-p[t]-1):p[t]-p[e]==2&&(x[w++]=f[t]+y,x[w++]=y-1-(p[e]+1),x[w++]=y-1-(p[e]+2))}const b=i.bevelSize>0?W_(g,[],i.bevelSize,null,!0,i.removeIntersections,i.removeIntersectionsHole):g,_=i.boundingRect,S=K_(g,null,i.smoothSide,i.smoothSideThreshold);return{vertices:S.vertices,rawVertices:g,splittedMap:S.splittedMap,indices:x,topVertices:b,rect:{x:_.x*h[0]+l[0],y:_.y*h[1]+l[1],width:_.width*h[0],height:_.height*h[1]},depth:"function"==typeof i.depth?i.depth(t):i.depth,holes:[]}}function eS(e,t){const i=[];for(let n=0;n<e.length;n++){const s=e[n],r=[],o=s.length;let a=s[o-1][0],l=s[o-1][1],h=0;for(let e=0;e<o;e++){let i=s[e][0],n=s[e][1];const o=i-a,c=n-l;h+=Math.sqrt(o*o+c*c),h>t&&(r.push(s[e]),h=0),a=i,l=n}r.length>=3&&i.push(r)}return i.length>0?i:null}function tS(e,t){const i=[];for(let n=0;n<e.length;n++){let s=e[n];s=C_(s,t,!0),s.length>=3&&i.push(s)}return i.length>0?i:null}function iS(e,t){t=Object.assign({},t);const i=[1/0,1/0],n=[-1/0,-1/0];for(let t=0;t<e.length;t++)sS(e[t][0],i,n);t.boundingRect=t.boundingRect||{x:i[0],y:i[1],width:n[0]-i[0],height:n[1]-i[1]},X_(t);const s=[],r=t.translate||[0,0],o=t.scale||[1,1],a=t.boundingRect,l={x:a.x*o[0]+r[0],y:a.y*o[1]+r[1],width:a.width*o[0],height:a.height*o[1]},h=Math.min(a.width,a.height)/1e5;for(let i=0;i<e.length;i++){let n=eS(e[i],h);if(!n)continue;const a=t.simplify/Math.max(o[0],o[1]);if(a>0&&(n=tS(n,a)),!n)continue;const{vertices:c,holes:d,dimensions:u}=F_(n);for(let e=0;e<c.length;)c[e]=c[e++]*o[0]+r[0],c[e]=c[e++]*o[1]+r[1];if(Y_(c,d),2!==u)throw new Error("Only 2D polygon points are supported");const p=t.bevelSize>0?W_(c,d,t.bevelSize,null,!0,t.removeIntersections,t.removeIntersectionsHole):c,f=U_(p,d,u),m=K_(c,d,t.smoothSide,t.smoothSideThreshold);s.push({indices:f,vertices:m.vertices,rawVertices:c,topVertices:p,holes:m.holes,splittedMap:m.splittedMap,rect:l,depth:"function"==typeof t.depth?t.depth(i):t.depth})}return J_(s,t)}function nS(e,t){t=Object.assign({},t);const i=[1/0,1/0],n=[-1/0,-1/0];for(let t=0;t<e.length;t++)sS(e[t],i,n);t.boundingRect=t.boundingRect||{x:i[0],y:i[1],width:n[0]-i[0],height:n[1]-i[1]},X_(t);const s=t.scale||[1,1];null==t.lineWidth&&(t.lineWidth=1),null==t.miterLimit&&(t.miterLimit=2);const r=[];for(let i=0;i<e.length;i++){let n=e[i];const o=t.simplify/Math.max(s[0],s[1]);o>0&&(n=C_(n,o,!0)),r.push($_(n,i,t))}return J_(r,t)}function sS(e,t,i){for(let n=0;n<e.length;n++)t[0]=Math.min(e[n][0],t[0]),t[1]=Math.min(e[n][1],t[1]),i[0]=Math.max(e[n][0],i[0]),i[1]=Math.max(e[n][1],i[1])}function rS(e,t){t=Object.assign({},t);const i=[],n=[],s=[],r=[],o=[1/0,1/0],a=[-1/0,-1/0];"LineString"!==e.type&&"MultiLineString"!==e.type&&"Polygon"!==e.type&&"MultiPolygon"!==e.type||(e={features:[{geometry:e}]});for(let t=0;t<e.features.length;t++){const l=e.features[t].geometry;if(l&&l.coordinates)switch(l.type){case"LineString":i.push(l.coordinates),s.push(t),sS(l.coordinates,o,a);break;case"MultiLineString":for(let e=0;e<l.coordinates.length;e++)i.push(l.coordinates[e]),s.push(t),sS(l.coordinates[e],o,a);break;case"Polygon":n.push(l.coordinates),r.push(t),sS(l.coordinates[0],o,a);break;case"MultiPolygon":for(let e=0;e<l.coordinates.length;e++)n.push(l.coordinates[e]),r.push(t),sS(l.coordinates[e][0],o,a)}}t.boundingRect=t.boundingRect||{x:o[0],y:o[1],width:a[0]-o[0],height:a[1]-o[1]};const l=t.depth;return{polyline:nS(i,Object.assign(t,{depth:function(t){return"function"==typeof l?l(e.features[s[t]]):l}})),polygon:iS(n,Object.assign(t,{depth:function(t){return"function"==typeof l?l(e.features[r[t]]):l}}))}}function oS(e,t,i,n,s,r){return void 0!==s&&void 0!==r?Math.sqrt((e-i)*(e-i)+(t-n)*(t-n)+(s-r)*(s-r)):Math.sqrt(function(e,t,i,n){return(e-i)*(e-i)+(t-n)*(t-n)}(e,t,i,n))}function aS(e,t,i){return Math.sqrt(yS(e,t,i,!0))}function lS(e,t,i){return yS(e,t,i)}const hS=new i,cS=new i,dS=new i;function uS(e,t,n){hS.set(e.x,e.y,e.z),cS.set(t.x,t.y,t.z),dS.set(n.x,n.y,n.z);const s=(new i).subVectors(dS,cS),r=s.dot((new i).subVectors(hS,cS))/s.lengthSq();if(r<=0)return t.clone();if(r>=1)return n.clone();let o=cS.clone().add(s.multiplyScalar(r));return new Nb(o.x,o.y,o.z)}function pS(e,t){let i,n=0,s=0,r=0;for(let o=1;o<t.length;o++){const a=lS(e,t[o-1],t[o]),l=oS(a.x,a.y,e.x,e.y,a.z,e.z);1===o?(n=l,i=a,s=0,r=oS(a.x,a.y,t[o-1].x,t[o-1].y,a.z,t[o-1].z)):l<n&&(n=l,i=a,s=o-1,r=oS(a.x,a.y,t[o-1].x,t[o-1].y,a.z,t[o-1].z))}return{closestLength:n,closestPoint:i,closestIndex:s,closestPrePointDist:r}}function fS(e,t){let i,n=Number.MAX_VALUE,s=0,r=0,o=0;for(let a=0;a<t.length;a++){const l=t[a],h=Yb.fromDataExtent(l).closestPoint(e);if(oS(h.x,h.y,e.x,e.y,h.z,e.z)>n)continue;const c=pS(e,l);c.closestLength<n&&(n=c.closestLength,i=c.closestPoint,s=a,r=c.closestIndex,o=c.closestPrePointDist)}return{closestLength:n,closestPoint:i,closestIndex:s,closestPointIndex:r,closestPrePointDist:o}}function mS(e,t,i,n,s,r,o,a){const l=(a-r)*(i-e)-(o-s)*(n-t),h=(o-s)*(t-r)-(a-r)*(e-s),c=(i-e)*(t-r)-(n-t)*(e-s),d=(e,t)=>e>=-(t=null!=t?t:1e-6)&&e<=t;if(d(l))return d(h)&&d(c)?{result:"COLINEAR",status:!1}:{result:"PARALLEL",status:!1};const u=h/l,p=c/l;return u>=0&&u<=1&&p>=0&&p<=1?{status:!0,x:e+u*(i-e),y:t+u*(n-t),ratio:u}:{result:"NONE",status:!1}}function gS(e,t,i){if(i=null!=i?i:6,e.length<2||t.length<2)return[[...e]];const n=[],s=e=>{let t=0;for(t=0;t<n.length;t++){const i=n[t];if(!(i.closestPointIndex<e.closestPointIndex||i.closestPointIndex===e.closestPointIndex&&i.ratio<e.ratio))break}n.splice(t,0,e)};for(let n=1;n<e.length;n++)for(let r=1;r<t.length;r++){const o=mS(e[n-1].x,e[n-1].y,e[n].x,e[n].y,t[r-1].x,t[r-1].y,t[r].x,t[r].y);if(o.status&&!isZero(o.ratio)&&!isZero(o.ratio-1)){const t=new Nb(o.x,o.y),r=new Nb(e[n-1].x,e[n-1].y),a=new Nb(e[n].x,e[n].y);t.equals(r,i)||t.equals(a,i)||s({point:t,closestPointIndex:n-1,ratio:o.ratio})}}const r=[];if(0===n.length)return[[...e]];{let t=[],i=0;for(let s=0;s<n.length;s++){const o=n[s];for(;!(i>o.closestPointIndex||i>=e.length);)t.push(e[i]),i++;t.push(o.point),r.push(t),t=[],t.push(o.point)}for(let n=i;n<e.length;n++)t.push(e[n]);r.push(t)}return r}function vS(e,t){const i=[],n=e.map((e=>Yb.fromDataExtent(e))),s=new Set;for(let t=0;t<e.length;t++)if(!s.has(t))for(let i=0;i<e.length;i++)if(t!==i&&!s.has(t)&&!s.has(i)&&n[t].isIntersect(n[i])){const r=gS(e[t],e[i]);if(r.length>1){s.add(t),e.push(...r),n.push(...r.map((e=>Yb.fromDataExtent(e))));break}}for(let t=0;t<e.length;t++)s.has(t)||i.push(e[t]);return i}function yS(e,t,i,n){if(void 0!==e.z&&void 0!==t.z&&void 0!==i.z){const s=uS(e,t,i);if(n){const t=e.x-s.x,i=e.y-s.y;let n=0;return void 0!==s.z&&(n=e.z-s.z),t*t+i*i+n*n}return s}let s=t.x,r=t.y,o=i.x-s,a=i.y-r;const l=o*o+a*a;let h;return l>0&&(h=((e.x-s)*o+(e.y-r)*a)/l,h>1?(s=i.x,r=i.y):h>0&&(s+=o*h,r+=a*h)),o=e.x-s,a=e.y-r,n?o*o+a*a:new Nb(s,r)}const xS=2,wS=1.25,bS=32,_S=65535,SS=Math.pow(2,-24),MS=Symbol("SKIP_GENERATION");function CS(e){return function(e){return e.index?e.index.count:e.attributes.position.count}(e)/3}function AS(e){const t=CS(e),i=e.drawRange,n=i.start/3,s=(i.start+i.count)/3,r=Math.max(0,n),o=Math.min(t,s)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function ES(e){if(!e.groups||!e.groups.length)return AS(e);const t=[],i=new Set,n=e.drawRange,s=n.start/3,r=(n.start+n.count)/3;for(const t of e.groups){const e=t.start/3,n=(t.start+t.count)/3;i.add(Math.max(s,e)),i.add(Math.min(r,n))}const o=Array.from(i.values()).sort(((e,t)=>e-t));for(let e=0;e<o.length-1;e++){const i=o[e],n=o[e+1];t.push({offset:Math.floor(i),count:Math.floor(n-i)})}return t}function TS(e,t,i,n,s){let r=1/0,o=1/0,a=1/0,l=-1/0,h=-1/0,c=-1/0,d=1/0,u=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0;for(let n=6*t,s=6*(t+i);n<s;n+=6){const t=e[n+0],i=e[n+1],s=t-i,v=t+i;s<r&&(r=s),v>l&&(l=v),t<d&&(d=t),t>f&&(f=t);const y=e[n+2],x=e[n+3],w=y-x,b=y+x;w<o&&(o=w),b>h&&(h=b),y<u&&(u=y),y>m&&(m=y);const _=e[n+4],S=e[n+5],M=_-S,C=_+S;M<a&&(a=M),C>c&&(c=C),_<p&&(p=_),_>g&&(g=_)}n[0]=r,n[1]=o,n[2]=a,n[3]=l,n[4]=h,n[5]=c,s[0]=d,s[1]=u,s[2]=p,s[3]=f,s[4]=m,s[5]=g}function PS(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function OS(e){let t=-1,i=-1/0;for(let n=0;n<3;n++){const s=e[n+3]-e[n];s>i&&(i=s,t=n)}return t}function DS(e,t){t.set(e)}function BS(e,t,i){let n,s;for(let r=0;r<3;r++){const o=r+3;n=e[r],s=t[r],i[r]=n<s?n:s,n=e[o],s=t[o],i[o]=n>s?n:s}}function IS(e,t,i){for(let n=0;n<3;n++){const s=t[e+2*n],r=t[e+2*n+1],o=s-r,a=s+r;o<i[n]&&(i[n]=o),a>i[n+3]&&(i[n+3]=a)}}function RS(e){const t=e[3]-e[0],i=e[4]-e[1],n=e[5]-e[2];return 2*(t*i+i*n+n*t)}const kS=(e,t)=>e.candidate-t.candidate,LS=new Array(32).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),zS=new Float32Array(6);class US{constructor(){this.boundingData=new Float32Array(6)}}function FS(e,t,i,n,s,r){let o=n,a=n+s-1;const l=r.pos,h=2*r.axis;for(;;){for(;o<=a&&i[6*o+h]<l;)o++;for(;o<=a&&i[6*a+h]>=l;)a--;if(!(o<a))return o;for(let e=0;e<3;e++){let i=t[3*o+e];t[3*o+e]=t[3*a+e],t[3*a+e]=i}for(let e=0;e<6;e++){let t=i[6*o+e];i[6*o+e]=i[6*a+e],i[6*a+e]=t}o++,a--}}function NS(e,t,i,n,s,r){let o=n,a=n+s-1;const l=r.pos,h=2*r.axis;for(;;){for(;o<=a&&i[6*o+h]<l;)o++;for(;o<=a&&i[6*a+h]>=l;)a--;if(!(o<a))return o;{let t=e[o];e[o]=e[a],e[a]=t;for(let e=0;e<6;e++){let t=i[6*o+e];i[6*o+e]=i[6*a+e],i[6*a+e]=t}o++,a--}}}function jS(e,t){return 65535===t[e+15]}function VS(e,t){return t[e+6]}function HS(e,t){return t[e+14]}function WS(e){return e+8}function GS(e,t){return t[e+6]}function YS(e,t){return t[e+7]}let XS,QS,qS,ZS;const KS=Math.pow(2,32);function JS(e){return"count"in e?1:1+JS(e.left)+JS(e.right)}function $S(e,t,i){return XS=new Float32Array(i),QS=new Uint32Array(i),qS=new Uint16Array(i),ZS=new Uint8Array(i),eM(e,t)}function eM(e,t){const i=e/4,n=e/2,s="count"in t,r=t.boundingData;for(let e=0;e<6;e++)XS[i+e]=r[e];if(s){if(t.buffer){const n=t.buffer;ZS.set(new Uint8Array(n),e);for(let t=e,s=e+n.byteLength;t<s;t+=bS)jS(t/2,qS)||(QS[t/4+6]+=i);return e+n.byteLength}{const s=t.offset,r=t.count;return QS[i+6]=s,qS[n+14]=r,qS[n+15]=_S,e+bS}}{const n=t.left,s=t.right,r=t.splitAxis;let o;if(o=eM(e+bS,n),o/4>KS)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return QS[i+6]=o/4,o=eM(o,s),QS[i+7]=r,o}}function tM(e,t){const i=e.geometry;t.indirect&&(e._indirectBuffer=function(e,t){const i=(e.index?e.index.count:e.attributes.position.count)/3,n=i>Math.pow(2,16),s=n?4:2,r=t?new SharedArrayBuffer(i*s):new ArrayBuffer(i*s),o=n?new Uint32Array(r):new Uint16Array(r);for(let e=0,t=o.length;e<t;e++)o[e]=e;return o}(i,t.useSharedArrayBuffer),function(e){if(0===e.groups.length)return!1;const t=CS(e),i=ES(e).sort(((e,t)=>e.offset-t.offset)),n=i[i.length-1];n.count=Math.min(t-n.offset,n.count);let s=0;return i.forEach((({count:e})=>s+=e)),t!==s}(i)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),e._indirectBuffer||function(e,t){if(!e.index){const i=e.attributes.position.count,n=function(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}(i,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new O(n,1));for(let e=0;e<i;e++)n[e]=e}}(i,t);const n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=function(e,t=null,i=null,n=null){const s=e.attributes.position,r=e.index?e.index.array:null,o=CS(e),a=s.normalized;let l;null===t?(l=new Float32Array(6*o*4),i=0,n=o):(l=t,i=i||0,n=n||o);const h=s.array,c=s.offset||0;let d=3;s.isInterleavedBufferAttribute&&(d=s.data.stride);const u=["getX","getY","getZ"];for(let e=i;e<i+n;e++){const t=3*e,i=6*e;let n=t+0,o=t+1,p=t+2;r&&(n=r[n],o=r[o],p=r[p]),a||(n=n*d+c,o=o*d+c,p=p*d+c);for(let e=0;e<3;e++){let t,r,c;a?(t=s[u[e]](n),r=s[u[e]](o),c=s[u[e]](p)):(t=h[n+e],r=h[o+e],c=h[p+e]);let d=t;r<d&&(d=r),c<d&&(d=c);let f=t;r>f&&(f=r),c>f&&(f=c);const m=(f-d)/2,g=2*e;l[i+g+0]=d+m,l[i+g+1]=m+(Math.abs(d)+m)*SS}}return l}(i),r=t.indirect?AS(i):ES(i);e._roots=r.map((i=>{const r=function(e,t,i,n,s){const{maxDepth:r,verbose:o,maxLeafTris:a,strategy:l,onProgress:h,indirect:c}=s,d=e._indirectBuffer,u=e.geometry,p=u.index?u.index.array:null,f=c?NS:FS,m=CS(u),g=new Float32Array(6);let v=!1;const y=new US;return TS(t,i,n,y.boundingData,g),function e(i,n,s,h=null,c=0){if(!v&&c>=r&&(v=!0,o&&(console.warn(`MeshBVH: Max depth of ${r} reached when generating BVH. Consider increasing maxDepth.`),console.warn(u))),s<=a||c>=r)return x(n+s),i.offset=n,i.count=s,i;const m=function(e,t,i,n,s,r){let o=-1,a=0;if(0===r)o=OS(t),-1!==o&&(a=(t[o]+t[o+3])/2);else if(1===r)o=OS(e),-1!==o&&(a=function(e,t,i,n){let s=0;for(let r=t,o=t+i;r<o;r++)s+=e[6*r+2*n];return s/i}(i,n,s,o));else if(2===r){const r=RS(e);let l=wS*s;const h=6*n,c=6*(n+s);for(let e=0;e<3;e++){const n=t[e],d=(t[e+3]-n)/32;if(s<8){const t=[...LS];t.length=s;let n=0;for(let s=h;s<c;s+=6,n++){const r=t[n];r.candidate=i[s+2*e],r.count=0;const{bounds:o,leftCacheBounds:a,rightCacheBounds:l}=r;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0;IS(s,i,o)}t.sort(kS);let d=s;for(let e=0;e<d;e++){const i=t[e];for(;e+1<d&&t[e+1].candidate===i.candidate;)t.splice(e+1,1),d--}for(let n=h;n<c;n+=6){const s=i[n+2*e];for(let e=0;e<d;e++){const r=t[e];s>=r.candidate?IS(n,i,r.rightCacheBounds):(IS(n,i,r.leftCacheBounds),r.count++)}}for(let i=0;i<d;i++){const n=t[i],h=n.count,c=s-n.count,d=n.leftCacheBounds,u=n.rightCacheBounds;let p=0;0!==h&&(p=RS(d)/r);let f=0;0!==c&&(f=RS(u)/r);const m=1+wS*(p*h+f*c);m<l&&(o=e,l=m,a=n.candidate)}}else{for(let e=0;e<32;e++){const t=LS[e];t.count=0,t.candidate=n+d+e*d;const i=t.bounds;for(let e=0;e<3;e++)i[e]=1/0,i[e+3]=-1/0}for(let t=h;t<c;t+=6){let s=~~((i[t+2*e]-n)/d);s>=32&&(s=31);const r=LS[s];r.count++,IS(t,i,r.bounds)}const t=LS[31];DS(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=LS[e],i=LS[e+1];BS(t.bounds,i.rightCacheBounds,t.rightCacheBounds)}let u=0;for(let t=0;t<31;t++){const i=LS[t],n=i.count,h=i.bounds,c=LS[t+1].rightCacheBounds;0!==n&&(0===u?DS(h,zS):BS(h,zS,zS)),u+=n;let d=0,p=0;0!==u&&(d=RS(zS)/r);const f=s-u;0!==f&&(p=RS(c)/r);const m=1+wS*(d*u+p*f);m<l&&(o=e,l=m,a=i.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}(i.boundingData,h,t,n,s,l);if(-1===m.axis)return x(n+s),i.offset=n,i.count=s,i;const y=f(d,p,t,n,s,m);if(y===n||y===n+s)x(n+s),i.offset=n,i.count=s;else{i.splitAxis=m.axis;const r=new US,o=n,a=y-n;i.left=r,TS(t,o,a,r.boundingData,g),e(r,o,a,g,c+1);const l=new US,h=y,d=s-a;i.right=l,TS(t,h,d,l.boundingData,g),e(l,h,d,g,c+1)}return i}(y,i,n,g),y;function x(e){h&&h(e/m)}}(e,s,i.offset,i.count,t),o=JS(r),a=new n(bS*o);return $S(0,r,a),a}))}class iM{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let s=0,r=e.length;s<r;s++){const r=e[s][t];i=r<i?r:i,n=r>n?r:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let s=0,r=t.length;s<r;s++){const r=t[s],o=e.dot(r);i=o<i?o:i,n=o>n?o:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}}iM.prototype.setFromBox=function(){const e=new i;return function(t,i){const n=i.min,s=i.max;let r=1/0,o=-1/0;for(let i=0;i<=1;i++)for(let a=0;a<=1;a++)for(let l=0;l<=1;l++){e.x=n.x*i+s.x*(1-i),e.y=n.y*a+s.y*(1-a),e.z=n.z*l+s.z*(1-l);const h=t.dot(e);r=Math.min(h,r),o=Math.max(h,o)}this.min=r,this.max=o}}();const nM=function(){const e=new i,t=new i,n=new i;return function(i,s,r){const o=i.start,a=e,l=s.start,h=t;n.subVectors(o,l),e.subVectors(i.end,i.start),t.subVectors(s.end,s.start);const c=n.dot(h),d=h.dot(a),u=h.dot(h),p=n.dot(a),f=a.dot(a)*u-d*d;let m,g;m=0!==f?(c*d-p*u)/f:0,g=(c+m*d)/u,r.x=m,r.y=g}}(),sM=function(){const e=new r,t=new i,n=new i;return function(i,s,r,o){nM(i,s,e);let a=e.x,l=e.y;if(a>=0&&a<=1&&l>=0&&l<=1)return i.at(a,r),void s.at(l,o);if(a>=0&&a<=1)return l<0?s.at(0,o):s.at(1,o),void i.closestPointToPoint(o,!0,r);if(l>=0&&l<=1)return a<0?i.at(0,r):i.at(1,r),void s.closestPointToPoint(r,!0,o);{let e,h;e=a<0?i.start:i.end,h=l<0?s.start:s.end;const c=t,d=n;return i.closestPointToPoint(h,!0,t),s.closestPointToPoint(e,!0,n),c.distanceToSquared(h)<=d.distanceToSquared(e)?(r.copy(c),void o.copy(h)):(r.copy(e),void o.copy(d))}}}(),rM=function(){const e=new i,t=new i,n=new c,s=new A;return function(i,r){const{radius:o,center:a}=i,{a:l,b:h,c:c}=r;if(s.start=l,s.end=h,s.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;if(s.start=l,s.end=c,s.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;if(s.start=h,s.end=c,s.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;const d=r.getPlane(n);if(Math.abs(d.distanceToPoint(a))<=o){const e=d.projectPoint(a,t);if(r.containsPoint(e))return!0}return!1}}();function oM(e){return Math.abs(e)<1e-15}class aM extends T{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new i)),this.satBounds=new Array(4).fill().map((()=>new iM)),this.points=[this.a,this.b,this.c],this.sphere=new P,this.plane=new c,this.needsUpdate=!0}intersectsSphere(e){return rM(e,this)}update(){const e=this.a,t=this.b,i=this.c,n=this.points,s=this.satAxes,r=this.satBounds,o=s[0],a=r[0];this.getNormal(o),a.setFromPoints(o,n);const l=s[1],h=r[1];l.subVectors(e,t),h.setFromPoints(l,n);const c=s[2],d=r[2];c.subVectors(t,i),d.setFromPoints(c,n);const u=s[3],p=r[3];u.subVectors(i,e),p.setFromPoints(u,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}aM.prototype.closestPointToSegment=function(){const e=new i,t=new i,n=new A;return function(i,s=null,r=null){const{start:o,end:a}=i,l=this.points;let h,c=1/0;for(let o=0;o<3;o++){const a=(o+1)%3;n.start.copy(l[o]),n.end.copy(l[a]),sM(n,i,e,t),h=e.distanceToSquared(t),h<c&&(c=h,s&&s.copy(e),r&&r.copy(t))}return this.closestPointToPoint(o,e),h=o.distanceToSquared(e),h<c&&(c=h,s&&s.copy(e),r&&r.copy(o)),this.closestPointToPoint(a,e),h=a.distanceToSquared(e),h<c&&(c=h,s&&s.copy(e),r&&r.copy(a)),Math.sqrt(c)}}(),aM.prototype.intersectsTriangle=function(){const e=new aM,t=new Array(3),n=new Array(3),s=new iM,r=new iM,o=new i,a=new i,l=new i,h=new i,c=new i,d=new A,u=new A,p=new A,f=new i;function m(e,t,i){const n=e.points;let s=0,r=-1;for(let e=0;e<3;e++){const{start:o,end:l}=d;o.copy(n[e]),l.copy(n[(e+1)%3]),d.delta(a);const h=oM(t.distanceToPoint(o));if(oM(t.normal.dot(a))&&h){i.copy(d),s=2;break}const c=t.intersectLine(d,f);if(!c&&h&&f.copy(o),(c||h)&&!oM(f.distanceTo(l))){if(s<=1)(1===s?i.start:i.end).copy(f),h&&(r=s);else if(s>=2){(1===r?i.start:i.end).copy(f),s=2;break}if(s++,2===s&&-1===r)break}}return s}return function(i,a=null,d=!1){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);const f=this.plane,g=i.plane;if(Math.abs(f.normal.dot(g.normal))>1-1e-10){const e=this.satBounds,l=this.satAxes;n[0]=i.a,n[1]=i.b,n[2]=i.c;for(let t=0;t<4;t++){const i=e[t],r=l[t];if(s.setFromPoints(r,n),i.isSeparated(s))return!1}const h=i.satBounds,c=i.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){const i=h[e],n=c[e];if(s.setFromPoints(n,t),i.isSeparated(s))return!1}for(let e=0;e<4;e++){const i=l[e];for(let e=0;e<4;e++){const a=c[e];if(o.crossVectors(i,a),s.setFromPoints(o,t),r.setFromPoints(o,n),s.isSeparated(r))return!1}}return a&&(d||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),a.start.set(0,0,0),a.end.set(0,0,0)),!0}{const e=m(this,g,u);if(1===e&&i.containsPoint(u.end))return a&&(a.start.copy(u.end),a.end.copy(u.end)),!0;if(2!==e)return!1;const t=m(i,f,p);if(1===t&&this.containsPoint(p.end))return a&&(a.start.copy(p.end),a.end.copy(p.end)),!0;if(2!==t)return!1;if(u.delta(l),p.delta(h),l.dot(h)<0){let e=p.start;p.start=p.end,p.end=e}const n=u.start.dot(l),s=u.end.dot(l),r=p.start.dot(l),o=p.end.dot(l);return(n===o||r===s||s<r!=n<o)&&(a&&(c.subVectors(u.start,p.start),c.dot(l)>0?a.start.copy(u.start):a.start.copy(p.start),c.subVectors(u.end,p.end),c.dot(l)<0?a.end.copy(u.end):a.end.copy(p.end)),!0)}}}(),aM.prototype.distanceToPoint=function(){const e=new i;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),aM.prototype.distanceToTriangle=function(){const e=new i,t=new i,n=["a","b","c"],s=new A,r=new A;return function(i,o=null,a=null){const l=o||a?s:null;if(this.intersectsTriangle(i,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let h=1/0;for(let t=0;t<3;t++){let s;const r=n[t],l=i[r];this.closestPointToPoint(l,e),s=l.distanceToSquared(e),s<h&&(h=s,o&&o.copy(e),a&&a.copy(l));const c=this[r];i.closestPointToPoint(c,e),s=c.distanceToSquared(e),s<h&&(h=s,o&&o.copy(c),a&&a.copy(e))}for(let l=0;l<3;l++){const c=n[l],d=n[(l+1)%3];s.set(this[c],this[d]);for(let l=0;l<3;l++){const c=n[l],d=n[(l+1)%3];r.set(i[c],i[d]),sM(s,r,e,t);const u=e.distanceToSquared(t);u<h&&(h=u,o&&o.copy(e),a&&a.copy(t))}}return Math.sqrt(h)}}();class lM{constructor(e,t,s){this.isOrientedBox=!0,this.min=new i,this.max=new i,this.matrix=new n,this.invMatrix=new n,this.points=new Array(8).fill().map((()=>new i)),this.satAxes=new Array(3).fill().map((()=>new i)),this.satBounds=new Array(3).fill().map((()=>new iM)),this.alignedSatBounds=new Array(3).fill().map((()=>new iM)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}lM.prototype.update=function(){const e=this.matrix,t=this.min,i=this.max,n=this.points;for(let s=0;s<=1;s++)for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){const a=n[1*s|2*r|4*o];a.x=s?i.x:t.x,a.y=r?i.y:t.y,a.z=o?i.z:t.z,a.applyMatrix4(e)}const s=this.satBounds,r=this.satAxes,o=n[0];for(let e=0;e<3;e++){const t=r[e],i=s[e],a=n[1<<e];t.subVectors(o,a),i.setFromPoints(t,n)}const a=this.alignedSatBounds;a[0].setFromPointsField(n,"x"),a[1].setFromPointsField(n,"y"),a[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},lM.prototype.intersectsBox=function(){const e=new iM;return function(t){this.needsUpdate&&this.update();const i=t.min,n=t.max,s=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(e.min=i.x,e.max=n.x,o[0].isSeparated(e))return!1;if(e.min=i.y,e.max=n.y,o[1].isSeparated(e))return!1;if(e.min=i.z,e.max=n.z,o[2].isSeparated(e))return!1;for(let i=0;i<3;i++){const n=r[i],o=s[i];if(e.setFromBox(n,t),o.isSeparated(e))return!1}return!0}}(),lM.prototype.intersectsTriangle=function(){const e=new aM,t=new Array(3),n=new iM,s=new iM,r=new i;return function(i){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);const o=this.satBounds,a=this.satAxes;t[0]=i.a,t[1]=i.b,t[2]=i.c;for(let e=0;e<3;e++){const i=o[e],s=a[e];if(n.setFromPoints(s,t),i.isSeparated(n))return!1}const l=i.satBounds,h=i.satAxes,c=this.points;for(let e=0;e<3;e++){const t=l[e],i=h[e];if(n.setFromPoints(i,c),t.isSeparated(n))return!1}for(let e=0;e<3;e++){const i=a[e];for(let e=0;e<4;e++){const o=h[e];if(r.crossVectors(i,o),n.setFromPoints(r,t),s.setFromPoints(r,c),n.isSeparated(s))return!1}}return!0}}(),lM.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},lM.prototype.distanceToPoint=function(){const e=new i;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),lM.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map((()=>new A)),n=new Array(12).fill().map((()=>new A)),s=new i,r=new i;return function(i,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(i))return(a||l)&&(i.getCenter(r),this.closestPointToPoint(r,s),i.closestPointToPoint(s,r),a&&a.copy(s),l&&l.copy(r)),0;const h=o*o,c=i.min,d=i.max,u=this.points;let p=1/0;for(let e=0;e<8;e++){const t=u[e];r.copy(t).clamp(c,d);const i=t.distanceToSquared(r);if(i<p&&(p=i,a&&a.copy(t),l&&l.copy(r),i<h))return Math.sqrt(i)}let f=0;for(let i=0;i<3;i++)for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){const o=(i+1)%3,a=(i+2)%3,l=1<<i|s<<o|r<<a,h=u[s<<o|r<<a],p=u[l];t[f].set(h,p);const m=e[i],g=e[o],v=e[a],y=n[f],x=y.start,w=y.end;x[m]=c[m],x[g]=s?c[g]:d[g],x[v]=r?c[v]:d[g],w[m]=d[m],w[g]=s?c[g]:d[g],w[v]=r?c[v]:d[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let i=0;i<=1;i++){r.x=e?d.x:c.x,r.y=t?d.y:c.y,r.z=i?d.z:c.z,this.closestPointToPoint(r,s);const n=r.distanceToSquared(s);if(n<p&&(p=n,a&&a.copy(s),l&&l.copy(r),n<h))return Math.sqrt(n)}for(let e=0;e<12;e++){const i=t[e];for(let e=0;e<12;e++){const t=n[e];sM(i,t,s,r);const o=s.distanceToSquared(r);if(o<p&&(p=o,a&&a.copy(s),l&&l.copy(r),o<h))return Math.sqrt(o)}}return Math.sqrt(p)}}();class hM{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class cM extends hM{constructor(){super((()=>new aM))}}const dM=new cM,uM=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=i=>{t&&e.push(t),t=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}};let pM,fM;const mM=[],gM=new hM((()=>new E));function vM(e,t,i,n,s,r){pM=gM.getPrimitive(),fM=gM.getPrimitive(),mM.push(pM,fM),uM.setBuffer(e._roots[t]);const o=yM(0,e.geometry,i,n,s,r);uM.clearBuffer(),gM.releasePrimitive(pM),gM.releasePrimitive(fM),mM.pop(),mM.pop();const a=mM.length;return a>0&&(fM=mM[a-1],pM=mM[a-2]),o}function yM(e,t,i,n,s=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:h}=uM;let c=2*e;if(jS(c,l)){const p=VS(e,h),f=HS(c,l);return PS(e,a,pM),n(p,f,!1,o,r+e,pM)}{const m=WS(e),g=GS(e,h);let v,y,x,w,b=m,_=g;if(s&&(x=pM,w=fM,PS(b,a,x),PS(_,a,w),v=s(x),y=s(w),y<v)){b=g,_=m;const E=v;v=y,y=E,x=w}x||(x=pM,PS(b,a,x));const S=i(x,jS(2*b,l),v,o+1,r+b);let M;if(S===xS){const T=d(b);M=n(T,u(b)-T,!0,o+1,r+b,x)}else M=S&&yM(b,t,i,n,s,r,o+1);if(M)return!0;w=fM,PS(_,a,w);const C=i(w,jS(2*_,l),y,o+1,r+_);let A;if(C===xS){const P=d(_);A=n(P,u(_)-P,!0,o+1,r+_,w)}else A=C&&yM(_,t,i,n,s,r,o+1);return!!A;function d(e){const{uint16Array:t,uint32Array:i}=uM;let n=2*e;for(;!jS(n,t);)n=2*(e=WS(e));return VS(e,i)}function u(e){const{uint16Array:t,uint32Array:i}=uM;let n=2*e;for(;!jS(n,t);)n=2*(e=GS(e,i));return VS(e,i)+HS(n,t)}}}const xM=new i,wM=new i,bM=new i,_M=new i,SM=new i,MM=new r,CM=new r,AM=new r,EM=new i,TM=new i,PM=new i,OM=new i;function DM(e,t,n,s,o){const a=3*s;let l=a+0,h=a+1,c=a+2;const u=e.index;e.index&&(l=u.getX(l),h=u.getX(h),c=u.getX(c));const{position:p,normal:f,uv:m,uv1:g}=e.attributes,v=function(e,t,n,s,o,a,l,h,c){bM.fromBufferAttribute(t,a),_M.fromBufferAttribute(t,l),SM.fromBufferAttribute(t,h);const u=function(e,t,i,n,s,r){let o;return o=r===d?e.intersectTriangle(n,i,t,!0,s):e.intersectTriangle(t,i,n,r!==I,s),null===o?null:{distance:e.origin.distanceTo(s),point:s.clone()}}(e,bM,_M,SM,OM,c);if(u){s&&(MM.fromBufferAttribute(s,a),CM.fromBufferAttribute(s,l),AM.fromBufferAttribute(s,h),u.uv=T.getInterpolation(OM,bM,_M,SM,MM,CM,AM,new r)),o&&(MM.fromBufferAttribute(o,a),CM.fromBufferAttribute(o,l),AM.fromBufferAttribute(o,h),u.uv1=T.getInterpolation(OM,bM,_M,SM,MM,CM,AM,new r)),n&&(EM.fromBufferAttribute(n,a),TM.fromBufferAttribute(n,l),PM.fromBufferAttribute(n,h),u.normal=T.getInterpolation(OM,bM,_M,SM,EM,TM,PM,new i),u.normal.dot(e.direction)>0&&u.normal.multiplyScalar(-1));const t={a:a,b:l,c:h,normal:new i,materialIndex:0};T.getNormal(bM,_M,SM,t.normal),u.face=t,u.faceIndex=a}return u}(n,p,f,m,g,l,h,c,t);return v?(v.faceIndex=s,o&&o.push(v),v):null}function BM(e,t,i,n){const s=e.a,r=e.b,o=e.c;let a=t,l=t+1,h=t+2;i&&(a=i.getX(a),l=i.getX(l),h=i.getX(h)),s.x=n.getX(a),s.y=n.getY(a),s.z=n.getZ(a),r.x=n.getX(l),r.y=n.getY(l),r.z=n.getZ(l),o.x=n.getX(h),o.y=n.getY(h),o.z=n.getZ(h)}function IM(e,t,i,n,s,r,o){const{geometry:a}=i,{index:l}=a,h=a.attributes.position;for(let i=e,a=t+e;i<a;i++){let e;if(e=i,BM(o,3*e,l,h),o.needsUpdate=!0,n(o,e,s,r))return!0}return!1}function RM(e,t=null){t&&Array.isArray(t)&&(t=new Set(t));const i=e.geometry,n=i.index?i.index.array:null,s=i.attributes.position;let r,o,a,l,h=0;const c=e._roots;for(let e=0,t=c.length;e<t;e++)r=c[e],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,h),h+=r.byteLength;function d(e,i,r=!1){const h=2*e;if(a[h+15]===_S){const t=o[e+6];let i=1/0,r=1/0,c=1/0,d=-1/0,u=-1/0,p=-1/0;for(let e=3*t,o=3*(t+a[h+14]);e<o;e++){let t=n[e];const o=s.getX(t),a=s.getY(t),l=s.getZ(t);o<i&&(i=o),o>d&&(d=o),a<r&&(r=a),a>u&&(u=a),l<c&&(c=l),l>p&&(p=l)}return(l[e+0]!==i||l[e+1]!==r||l[e+2]!==c||l[e+3]!==d||l[e+4]!==u||l[e+5]!==p)&&(l[e+0]=i,l[e+1]=r,l[e+2]=c,l[e+3]=d,l[e+4]=u,l[e+5]=p,!0)}{const n=e+8,s=o[e+6],a=n+i,h=s+i;let c=r,u=!1,p=!1;t?c||(u=t.has(a),p=t.has(h),c=!u&&!p):(u=!0,p=!0);const f=c||p;let m=!1;(c||u)&&(m=d(n,i,c));let g=!1;f&&(g=d(s,i,c));const v=m||g;if(v)for(let t=0;t<3;t++){const i=n+t,r=s+t,o=l[i],a=l[i+3],h=l[r],c=l[r+3];l[e+t]=o<h?o:h,l[e+t+3]=a>c?a:c}return v}}}const kM=new E;function LM(e,t,i,n){return PS(e,t,kM),i.intersectBox(kM,n)}function zM(e,t,i,n,s,r,o){const{geometry:a}=i,{index:l}=a,h=a.attributes.position;for(let a=e,c=t+e;a<c;a++){let e;if(e=i.resolveTriangleIndex(a),BM(o,3*e,l,h),o.needsUpdate=!0,n(o,e,s,r))return!0}return!1}const UM=new i;function FM(e,t,i,n,s){uM.setBuffer(e._roots[t]),NM(0,e,i,n,s),uM.clearBuffer()}function NM(e,t,i,n,s){const{float32Array:r,uint16Array:o,uint32Array:a}=uM,l=2*e;if(jS(l,o))!function(e,t,i,n,s,r){const{geometry:o,_indirectBuffer:a}=e;for(let e=n,a=n+s;e<a;e++)DM(o,t,i,e,r)}(t,i,n,VS(e,a),HS(l,o),s);else{const o=WS(e);LM(o,r,n,UM)&&NM(o,t,i,n,s);const l=GS(e,a);LM(l,r,n,UM)&&NM(l,t,i,n,s)}}const jM=new i,VM=["x","y","z"];function HM(e,t,i,n){uM.setBuffer(e._roots[t]);const s=WM(0,e,i,n);return uM.clearBuffer(),s}function WM(e,t,i,n){const{float32Array:s,uint16Array:r,uint32Array:o}=uM;let a=2*e;if(jS(a,r))return function(e,t,i,n,s){const{geometry:r,_indirectBuffer:o}=e;let a=1/0,l=null;for(let e=n,o=n+s;e<o;e++){let n;n=DM(r,t,i,e),n&&n.distance<a&&(l=n,a=n.distance)}return l}(t,i,n,VS(e,o),HS(a,r));{const r=YS(e,o),a=VM[r],l=n.direction[a]>=0;let h,c;l?(h=WS(e),c=GS(e,o)):(h=GS(e,o),c=WS(e));const d=LM(h,s,n,jM)?WM(h,t,i,n):null;if(d){const e=d.point[a];if(l?e<=s[c+r]:e>=s[c+r+3])return d}const u=LM(c,s,n,jM)?WM(c,t,i,n):null;return d&&u?d.distance<=u.distance?d:u:d||u||null}}const GM=new E,YM=new aM,XM=new aM,QM=new n,qM=new lM,ZM=new lM;function KM(e,t,i,n){uM.setBuffer(e._roots[t]);const s=JM(0,e,i,n);return uM.clearBuffer(),s}function JM(e,t,i,n,s=null){const{float32Array:r,uint16Array:o,uint32Array:a}=uM;let l=2*e;if(null===s&&(i.boundingBox||i.computeBoundingBox(),qM.set(i.boundingBox.min,i.boundingBox.max,n),s=qM),!jS(l,o)){const o=e+8,l=a[e+6];return PS(o,r,GM),!!(s.intersectsBox(GM)&&JM(o,t,i,n,s)||(PS(l,r,GM),s.intersectsBox(GM)&&JM(l,t,i,n,s)))}{const s=t.geometry,h=s.index,c=s.attributes.position,d=i.index,u=i.attributes.position,p=VS(e,a),f=HS(l,o);if(QM.copy(n).invert(),i.boundsTree)return PS(e,r,ZM),ZM.matrix.copy(QM),ZM.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:e=>ZM.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let t=3*p,i=3*(f+p);t<i;t+=3)if(BM(XM,t,h,c),XM.needsUpdate=!0,e.intersectsTriangle(XM))return!0;return!1}});for(let e=3*p,t=3*(f+p);e<t;e+=3){BM(YM,e,h,c),YM.a.applyMatrix4(QM),YM.b.applyMatrix4(QM),YM.c.applyMatrix4(QM),YM.needsUpdate=!0;for(let e=0,t=d.count;e<t;e+=3)if(BM(XM,e,d,u),XM.needsUpdate=!0,YM.intersectsTriangle(XM))return!0}}}const $M=new n,eC=new lM,tC=new lM,iC=new i,nC=new i,sC=new i,rC=new i;function oC(e,t,i,n={},s={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),eC.set(t.boundingBox.min,t.boundingBox.max,i),eC.needsUpdate=!0;const a=e.geometry,l=a.attributes.position,h=a.index,c=t.attributes.position,d=t.index,u=dM.getPrimitive(),p=dM.getPrimitive();let f=iC,m=nC,g=null,v=null;s&&(g=sC,v=rC);let y=1/0,x=null,w=null;return $M.copy(i).invert(),tC.matrix.copy($M),e.shapecast({boundsTraverseOrder:e=>eC.distanceToBox(e),intersectsBounds:(e,t,i)=>i<y&&i<o&&(t&&(tC.min.copy(e.min),tC.max.copy(e.max),tC.needsUpdate=!0),!0),intersectsRange:(e,n)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:e=>tC.distanceToBox(e),intersectsBounds:(e,t,i)=>i<y&&i<o,intersectsRange:(t,s)=>{for(let o=t,a=t+s;o<a;o++){BM(p,3*o,d,c),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let t=e,i=e+n;t<i;t++){BM(u,3*t,h,l),u.needsUpdate=!0;const e=u.distanceToTriangle(p,f,g);if(e<y&&(m.copy(f),v&&v.copy(g),y=e,x=t,w=o),e<r)return!0}}}});for(let s=0,o=CS(t);s<o;s++){BM(p,3*s,d,c),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let t=e,i=e+n;t<i;t++){BM(u,3*t,h,l),u.needsUpdate=!0;const e=u.distanceToTriangle(p,f,g);if(e<y&&(m.copy(f),v&&v.copy(g),y=e,x=t,w=s),e<r)return!0}}}}),dM.releasePrimitive(u),dM.releasePrimitive(p),y===1/0?null:(n.point?n.point.copy(m):n.point=m.clone(),n.distance=y,n.faceIndex=x,s&&(s.point?s.point.copy(v):s.point=v.clone(),s.point.applyMatrix4($M),m.applyMatrix4($M),s.distance=m.sub(s.point).length(),s.faceIndex=w),n)}function aC(e,t=null){t&&Array.isArray(t)&&(t=new Set(t));const i=e.geometry,n=i.index?i.index.array:null,s=i.attributes.position;let r,o,a,l,h=0;const c=e._roots;for(let e=0,t=c.length;e<t;e++)r=c[e],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,h),h+=r.byteLength;function d(i,r,h=!1){const c=2*i;if(a[c+15]===_S){const t=o[i+6];let r=1/0,h=1/0,d=1/0,u=-1/0,p=-1/0,f=-1/0;for(let i=t,o=t+a[c+14];i<o;i++){const t=3*e.resolveTriangleIndex(i);for(let e=0;e<3;e++){let i=t+e;i=n?n[i]:i;const o=s.getX(i),a=s.getY(i),l=s.getZ(i);o<r&&(r=o),o>u&&(u=o),a<h&&(h=a),a>p&&(p=a),l<d&&(d=l),l>f&&(f=l)}}return(l[i+0]!==r||l[i+1]!==h||l[i+2]!==d||l[i+3]!==u||l[i+4]!==p||l[i+5]!==f)&&(l[i+0]=r,l[i+1]=h,l[i+2]=d,l[i+3]=u,l[i+4]=p,l[i+5]=f,!0)}{const e=i+8,n=o[i+6],s=e+r,a=n+r;let c=h,u=!1,p=!1;t?c||(u=t.has(s),p=t.has(a),c=!u&&!p):(u=!0,p=!0);const f=c||p;let m=!1;(c||u)&&(m=d(e,r,c));let g=!1;f&&(g=d(n,r,c));const v=m||g;if(v)for(let t=0;t<3;t++){const s=e+t,r=n+t,o=l[s],a=l[s+3],h=l[r],c=l[r+3];l[i+t]=o<h?o:h,l[i+t+3]=a>c?a:c}return v}}}const lC=new i;function hC(e,t,i,n,s){uM.setBuffer(e._roots[t]),cC(0,e,i,n,s),uM.clearBuffer()}function cC(e,t,i,n,s){const{float32Array:r,uint16Array:o,uint32Array:a}=uM,l=2*e;if(jS(l,o))!function(e,t,i,n,s,r){const{geometry:o,_indirectBuffer:a}=e;for(let e=n,l=n+s;e<l;e++)DM(o,t,i,a?a[e]:e,r)}(t,i,n,VS(e,a),HS(l,o),s);else{const o=WS(e);LM(o,r,n,lC)&&cC(o,t,i,n,s);const l=GS(e,a);LM(l,r,n,lC)&&cC(l,t,i,n,s)}}const dC=new i,uC=["x","y","z"];function pC(e,t,i,n){uM.setBuffer(e._roots[t]);const s=fC(0,e,i,n);return uM.clearBuffer(),s}function fC(e,t,i,n){const{float32Array:s,uint16Array:r,uint32Array:o}=uM;let a=2*e;if(jS(a,r))return function(e,t,i,n,s){const{geometry:r,_indirectBuffer:o}=e;let a=1/0,l=null;for(let e=n,h=n+s;e<h;e++){let n;n=DM(r,t,i,o?o[e]:e),n&&n.distance<a&&(l=n,a=n.distance)}return l}(t,i,n,VS(e,o),HS(a,r));{const r=YS(e,o),a=uC[r],l=n.direction[a]>=0;let h,c;l?(h=WS(e),c=GS(e,o)):(h=GS(e,o),c=WS(e));const d=LM(h,s,n,dC)?fC(h,t,i,n):null;if(d){const e=d.point[a];if(l?e<=s[c+r]:e>=s[c+r+3])return d}const u=LM(c,s,n,dC)?fC(c,t,i,n):null;return d&&u?d.distance<=u.distance?d:u:d||u||null}}const mC=new E,gC=new aM,vC=new aM,yC=new n,xC=new lM,wC=new lM;function bC(e,t,i,n){uM.setBuffer(e._roots[t]);const s=_C(0,e,i,n);return uM.clearBuffer(),s}function _C(e,t,i,n,s=null){const{float32Array:r,uint16Array:o,uint32Array:a}=uM;let l=2*e;if(null===s&&(i.boundingBox||i.computeBoundingBox(),xC.set(i.boundingBox.min,i.boundingBox.max,n),s=xC),!jS(l,o)){const o=e+8,l=a[e+6];return PS(o,r,mC),!!(s.intersectsBox(mC)&&_C(o,t,i,n,s)||(PS(l,r,mC),s.intersectsBox(mC)&&_C(l,t,i,n,s)))}{const s=t.geometry,h=s.index,c=s.attributes.position,d=i.index,u=i.attributes.position,p=VS(e,a),f=HS(l,o);if(yC.copy(n).invert(),i.boundsTree)return PS(e,r,wC),wC.matrix.copy(yC),wC.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:e=>wC.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let i=p,n=f+p;i<n;i++)if(BM(vC,3*t.resolveTriangleIndex(i),h,c),vC.needsUpdate=!0,e.intersectsTriangle(vC))return!0;return!1}});for(let e=p,i=f+p;e<i;e++){const i=t.resolveTriangleIndex(e);BM(gC,3*i,h,c),gC.a.applyMatrix4(yC),gC.b.applyMatrix4(yC),gC.c.applyMatrix4(yC),gC.needsUpdate=!0;for(let e=0,t=d.count;e<t;e+=3)if(BM(vC,e,d,u),vC.needsUpdate=!0,gC.intersectsTriangle(vC))return!0}}}const SC=new n,MC=new lM,CC=new lM,AC=new i,EC=new i,TC=new i,PC=new i;function OC(e,t,i,n={},s={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),MC.set(t.boundingBox.min,t.boundingBox.max,i),MC.needsUpdate=!0;const a=e.geometry,l=a.attributes.position,h=a.index,c=t.attributes.position,d=t.index,u=dM.getPrimitive(),p=dM.getPrimitive();let f=AC,m=EC,g=null,v=null;s&&(g=TC,v=PC);let y=1/0,x=null,w=null;return SC.copy(i).invert(),CC.matrix.copy(SC),e.shapecast({boundsTraverseOrder:e=>MC.distanceToBox(e),intersectsBounds:(e,t,i)=>i<y&&i<o&&(t&&(CC.min.copy(e.min),CC.max.copy(e.max),CC.needsUpdate=!0),!0),intersectsRange:(n,s)=>{if(t.boundsTree){const a=t.boundsTree;return a.shapecast({boundsTraverseOrder:e=>CC.distanceToBox(e),intersectsBounds:(e,t,i)=>i<y&&i<o,intersectsRange:(t,o)=>{for(let b=t,_=t+o;b<_;b++){const t=a.resolveTriangleIndex(b);BM(p,3*t,d,c),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let t=n,i=n+s;t<i;t++){const i=e.resolveTriangleIndex(t);BM(u,3*i,h,l),u.needsUpdate=!0;const n=u.distanceToTriangle(p,f,g);if(n<y&&(m.copy(f),v&&v.copy(g),y=n,x=t,w=b),n<r)return!0}}}})}for(let o=0,a=CS(t);o<a;o++){BM(p,3*o,d,c),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let t=n,i=n+s;t<i;t++){const i=e.resolveTriangleIndex(t);BM(u,3*i,h,l),u.needsUpdate=!0;const n=u.distanceToTriangle(p,f,g);if(n<y&&(m.copy(f),v&&v.copy(g),y=n,x=t,w=o),n<r)return!0}}}}),dM.releasePrimitive(u),dM.releasePrimitive(p),y===1/0?null:(n.point?n.point.copy(m):n.point=m.clone(),n.distance=y,n.faceIndex=x,s&&(s.point?s.point.copy(v):s.point=v.clone(),s.point.applyMatrix4(SC),m.applyMatrix4(SC),s.distance=m.sub(s.point).length(),s.faceIndex=w),n)}const DC=new uM.constructor,BC=new uM.constructor,IC=new hM((()=>new E)),RC=new E,kC=new E,LC=new E,zC=new E;let UC=!1;function FC(e,t,i,n,s,r=0,o=0,a=0,l=0,h=null,c=!1){let d,u;c?(d=BC,u=DC):(d=DC,u=BC);const p=d.float32Array,f=d.uint32Array,m=d.uint16Array,g=u.float32Array,v=u.uint32Array,y=u.uint16Array,x=2*t,w=jS(2*e,m),b=jS(x,y);let _=!1;if(b&&w)_=c?s(VS(t,v),HS(2*t,y),VS(e,f),HS(2*e,m),l,o+t,a,r+e):s(VS(e,f),HS(2*e,m),VS(t,v),HS(2*t,y),a,r+e,l,o+t);else if(b){const h=IC.getPrimitive();PS(t,g,h),h.applyMatrix4(i);const d=WS(e),u=GS(e,f);PS(d,p,RC),PS(u,p,kC);const m=h.intersectsBox(RC),v=h.intersectsBox(kC);_=m&&FC(t,d,n,i,s,o,r,l,a+1,h,!c)||v&&FC(t,u,n,i,s,o,r,l,a+1,h,!c),IC.releasePrimitive(h)}else{const d=WS(t),u=GS(t,v);PS(d,g,LC),PS(u,g,zC);const m=h.intersectsBox(LC),y=h.intersectsBox(zC);if(m&&y)_=FC(e,d,i,n,s,r,o,a,l+1,h,c)||FC(e,u,i,n,s,r,o,a,l+1,h,c);else if(m)if(w)_=FC(e,d,i,n,s,r,o,a,l+1,h,c);else{const t=IC.getPrimitive();t.copy(LC).applyMatrix4(i);const h=WS(e),u=GS(e,f);PS(h,p,RC),PS(u,p,kC);const m=t.intersectsBox(RC),g=t.intersectsBox(kC);_=m&&FC(d,h,n,i,s,o,r,l,a+1,t,!c)||g&&FC(d,u,n,i,s,o,r,l,a+1,t,!c),IC.releasePrimitive(t)}else if(y)if(w)_=FC(e,u,i,n,s,r,o,a,l+1,h,c);else{const t=IC.getPrimitive();t.copy(zC).applyMatrix4(i);const h=WS(e),d=GS(e,f);PS(h,p,RC),PS(d,p,kC);const m=t.intersectsBox(RC),g=t.intersectsBox(kC);_=m&&FC(u,h,n,i,s,o,r,l,a+1,t,!c)||g&&FC(u,d,n,i,s,o,r,l,a+1,t,!c),IC.releasePrimitive(t)}}return _}const NC=new lM,jC=new E,VC={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class HC{static serialize(e,t={}){t=Object.assign({cloneBuffers:!0},t);const i=e.geometry,n=e._roots,s=e._indirectBuffer,r=i.getIndex();let o;return o=t.cloneBuffers?{roots:n.map((e=>e.slice())),index:r.array.slice(),indirectBuffer:s?s.slice():null}:{roots:n,index:r.array,indirectBuffer:s},o}static deserialize(e,t,i={}){i=Object.assign({setIndex:!0,indirect:Boolean(e.indirectBuffer)},i);const{index:n,roots:s,indirectBuffer:r}=e,o=new HC(t,Object.assign(Object.assign({},i),{[MS]:!0}));if(o._roots=s,o._indirectBuffer=r||null,i.setIndex){const i=t.getIndex();if(null===i){const i=new O(e.index,1,!1);t.setIndex(i)}else i.array!==n&&(i.array.set(n),i.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign(Object.assign(Object.assign({},VC),{[MS]:!1}),t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[MS]||(tM(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new E)));const{_indirectBuffer:i}=this;this.resolveTriangleIndex=t.indirect?e=>i[e]:e=>e}refit(e=null){return(this.indirect?aC:RM)(this,e)}traverse(e,t=0){const i=this._roots[t],n=new Uint32Array(i),s=new Uint16Array(i);!function t(r,o=0){const a=2*r,l=s[a+15]===_S;if(l){const t=n[r+6],h=s[a+14];e(o,l,new Float32Array(i,4*r,6),t,h)}else{const s=r+bS/4,a=n[r+6],h=n[r+7];e(o,l,new Float32Array(i,4*r,6),h)||(t(s,o+1),t(a,o+1))}}(0)}raycast(e,t=D){const i=this._roots,n=this.geometry,s=[],r=t.isMaterial,o=Array.isArray(t),a=n.groups,l=r?t.side:t,h=this.indirect?hC:FM;for(let n=0,r=i.length;n<r;n++){const i=o?t[a[n].materialIndex].side:l,r=s.length;if(h(this,n,i,e,s),o){const e=a[n].materialIndex;for(let t=r,i=s.length;t<i;t++)s[t].face.materialIndex=e}}return s}raycastFirst(e,t=D){const i=this._roots,n=this.geometry,s=t.isMaterial,r=Array.isArray(t);let o=null;const a=n.groups,l=s?t.side:t,h=this.indirect?pC:HM;for(let n=0,s=i.length;n<s;n++){const i=h(this,n,r?t[a[n].materialIndex].side:l,e);null!=i&&(null==o||i.distance<o.distance)&&(o=i,r&&(i.face.materialIndex=a[n].materialIndex))}return o}intersectsGeometry(e,t){let i=!1;const n=this._roots,s=this.indirect?bC:KM;for(let r=0,o=n.length;r<o&&(i=s(this,r,e,t),!i);r++);return i}shapecast(e){const t=dM.getPrimitive(),i=this.indirect?zM:IM;let{boundsTraverseOrder:n,intersectsBounds:s,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const e=r;r=(n,s,r,a,l)=>!!e(n,s,r,a,l)||i(n,s,this,o,r,a,t)}else r||(r=o?(e,n,s,r)=>i(e,n,this,o,s,r,t):(e,t,i)=>i);let a=!1,l=0;const h=this._roots;for(let e=0,t=h.length;e<t;e++){const t=h[e];if(a=vM(this,e,s,r,n,l),a)break;l+=t.byteLength}return dM.releasePrimitive(t),a}bvhcast(e,t,i){let{intersectsRanges:s,intersectsTriangles:r}=i;const o=dM.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,h=this.indirect?e=>{const t=this.resolveTriangleIndex(e);BM(o,3*t,a,l)}:e=>{BM(o,3*e,a,l)},c=dM.getPrimitive(),d=e.geometry.index,u=e.geometry.attributes.position,p=e.indirect?t=>{const i=e.resolveTriangleIndex(t);BM(c,3*i,d,u)}:e=>{BM(c,3*e,d,u)};if(r){const e=(e,i,n,s,a,l,d,u)=>{for(let f=n,m=n+s;f<m;f++){p(f),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let t=e,n=e+i;t<n;t++)if(h(t),o.needsUpdate=!0,r(o,c,t,f,a,l,d,u))return!0}return!1};if(s){const t=s;s=function(i,n,s,r,o,a,l,h){return!!t(i,n,s,r,o,a,l,h)||e(i,n,s,r,o,a,l,h)}}else s=e}return function(e,t,i,s){if(UC)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");UC=!0;const r=e._roots,o=t._roots;let a,l=0,h=0;const c=(new n).copy(i).invert();for(let e=0,t=r.length;e<t;e++){DC.setBuffer(r[e]),h=0;const t=IC.getPrimitive();PS(0,DC.float32Array,t),t.applyMatrix4(c);for(let n=0,r=o.length;n<r&&(BC.setBuffer(o[e]),a=FC(0,0,i,c,s,l,h,0,0,t),BC.clearBuffer(),h+=o[n].length,!a);n++);if(IC.releasePrimitive(t),DC.clearBuffer(),l+=r[e].length,a)break}return UC=!1,a}(this,e,t,s)}intersectsBox(e,t){return NC.set(e.min,e.max,t),NC.needsUpdate=!0,this.shapecast({intersectsBounds:e=>NC.intersectsBox(e),intersectsTriangle:e=>NC.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},n={},s=0,r=1/0){return(this.indirect?OC:oC)(this,e,t,i,n,s,r)}closestPointToPoint(e,t={},i=0,n=1/0){return function(e,t,i={},n=0,s=1/0){const r=n*n,o=s*s;let a=1/0,l=null;if(e.shapecast({boundsTraverseOrder:e=>(xM.copy(t).clamp(e.min,e.max),xM.distanceToSquared(t)),intersectsBounds:(e,t,i)=>i<a&&i<o,intersectsTriangle:(e,i)=>{e.closestPointToPoint(t,xM);const n=t.distanceToSquared(xM);return n<a&&(wM.copy(xM),a=n,l=i),n<r}}),a===1/0)return null;const h=Math.sqrt(a);return i.point?i.point.copy(wM):i.point=wM.clone(),i.distance=h,i.faceIndex=l,i}(this,e,t,i,n)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{PS(0,new Float32Array(t),jC),e.union(jC)})),e}}function WC(e,t,i){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(i.ray.origin),e.object=t,e.distance<i.near||e.distance>i.far?null:e)}const GC=new B,YC=new n,XC=h.prototype.raycast;function QC(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;YC.copy(this.matrixWorld).invert(),GC.copy(e.ray).applyMatrix4(YC);const i=this.geometry.boundsTree;if(!0===e.firstHitOnly){const n=WC(i.raycastFirst(GC,this.material),this,e);n&&t.push(n)}else{const n=i.raycast(GC,this.material);for(let i=0,s=n.length;i<s;i++){const s=WC(n[i],this,e);s&&t.push(s)}}}else XC.call(this,e,t)}function qC(e){return this.boundsTree=new HC(this,e),this.boundsTree}function ZC(){this.boundsTree=null}var KC,JC,$C,eA,tA,iA,nA,sA,rA,oA,aA,lA,hA,cA,dA,uA,pA,fA;class mA extends Sy{constructor(e,t){super(e),KC.set(this,void 0),Zv(this,KC,null==t?void 0:t.mesh,"f")}get mesh(){return qv(this,KC,"f")}rawMaterial(){return this.data.rawMaterial}useMaterial(){return this.data.useMaterial}get material(){return this.useMaterial()||(this.data.rawMaterial=qv(this,KC,"f").material,this.data.useMaterial=qv(this,KC,"f").material),this.data.useMaterial==this.data.rawMaterial&&(this.data.useMaterial=TW(this.data.rawMaterial)),this.useMaterial()}addEdges(e,t){if(this.data.meshEdgeLine)return;const i=new R(qv(this,KC,"f").geometry);let n=null!=e?e:{color:65535};const s=new k(Object.assign(Object.assign({},this.app.envConfig.EdgeLineOptions),n)),r=new L(i,s);t?(r.position.copy(this.entity.node.position),r.quaternion.copy(this.entity.node.quaternion),r.scale.copy(this.entity.node.scale),this.entity.node.parent.add(r),this.entity.visible=!1,this.entity.data._addEdgesHide=!0):this.entity.addObjects(r),this.data.meshEdgeLine=r}clearEdges(){var e;this.data.meshEdgeLine&&(null===(e=this.data.meshEdgeLine.parent)||void 0===e||e.remove(this.data.meshEdgeLine),this.data.meshEdgeLine=null,delete this.data.meshEdgeLine),!0===this.entity.data._addEdgesHide&&(delete this.entity.data._addEdgesHide,this.entity.visible=!0)}getEdges(){return this.data.meshEdgeLine}replaceMaterial(e){qv(this,KC,"f").material!=e&&(this.data.rawMaterial||(this.data.rawMaterial=qv(this,KC,"f").material,this.data.useMaterial=qv(this,KC,"f").material),e==this.rawMaterial()?(this.useMaterial()!=this.rawMaterial()&&PW(this.data.useMaterial),this.data.useMaterial=this.data.rawMaterial):e!=this.useMaterial()&&(PW(this.data.useMaterial),this.data.useMaterial=e),this.isHighlight()||(qv(this,KC,"f").material=e))}resetMaterial(){this.clearHighlight(),this.rawMaterial()!=this.useMaterial()&&(PW(this.data.useMaterial),delete this.data.useMaterial,this.data.useMaterial=this.data.rawMaterial),this.data.rawMaterial&&(qv(this,KC,"f").material=this.data.rawMaterial)}setHeatmapDataMaterial(e){var t,n,s,r,o,l,h,c;return Qv(this,void 0,void 0,(function*(){let d="rainbow";e.colorMap&&(d=yv(JSON.stringify(e.colorMap)),d in ColorMapKeywords||(ColorMapKeywords[d]=e.colorMap));let u=this.entity.getBoundingBox(!1),p=new i;u.getSize(p);let f=e.data.map((e=>e.x)),m=e.data.map((e=>e.y)),g=e.data.map((e=>e.z)),v=e.data.map((e=>e.value)),y=null!==(t=e.dataMin)&&void 0!==t?t:Ov(v),x=null!==(n=e.dataMax)&&void 0!==n?n:Pv(v),{worker:w,wrap:b}=yw(Zb);v.length<3&&(null!==(s=e.interpolation)&&void 0!==s||(e.interpolation={}),e.interpolation.useInvDistWeight=!0);let _=yield new b(Object.assign({x:f,y:m,z:g,t:v},e.interpolation)),S=new Ki(d,null!==(r=e.colorCount)&&void 0!==r?r:100);S.setMax(x),S.setMin(y);const M=null!==(o=e.segmentX)&&void 0!==o?o:10,C=null!==(l=e.segmentY)&&void 0!==l?l:10,A=null!==(h=e.segmentZ)&&void 0!==h?h:10,E=new Uint8Array(M*C*A*4);let T=p.x/M,P=p.y/C,O=p.z/A,D=[];for(let e=0;e<A;e+=1)for(let t=0;t<C;t+=1)for(let i=0;i<M;i+=1){let n=i*T+u.min.x,s=t*P+u.min.y,r=e*O+u.min.z;D.push({x:n,y:s,z:r})}let B=yield _.predicts(D);for(let e=0;e<D.length;e++){let t=S.getColor(B[e]);const i=4*e;E[i]=Math.round(255*t.r),E[i+1]=Math.round(255*t.g),E[i+2]=Math.round(255*t.b),E[i+3]=255}w.terminate();let I=((e,t,i,n)=>{const s={data:e,xLength:t,yLength:i,zLength:n},r=new z(s.data,s.xLength,s.yLength,s.zLength);return r.format=U,r.type=F,r.minFilter=r.magFilter=N,r.unpackAlignment=1,r.needsUpdate=!0,r})(E,M,C,A);const R=new a(Object.assign(Object.assign({},null==e?void 0:e.MaterialParameters),{uniforms:{minBox:{value:u.min},maxBox:{value:u.max},map:{value:I},mapSceneMatrixWorld:this.app.commonUniforms.mapSceneMatrixWorld},vertexShader:"\n                #include <common>\n#include <clipping_planes_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\nuniform vec3 minBox;\nuniform vec3 maxBox;\nout vec3 vUv;\n#ifdef ISMAPMODE\nuniform mat4 mapSceneMatrixWorld;\n#endif\nvoid main() {\n    #include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    #ifdef ISMAPMODE\n     vec4 worldMinBox = mapSceneMatrixWorld * vec4( minBox, 1.0 );\n     vec4 worldMaxBox = mapSceneMatrixWorld * vec4( maxBox, 1.0 ) ;\n     vUv = ( worldPosition.xyz - worldMinBox.xyz ) / ( worldMaxBox.xyz - worldMinBox.xyz );\n    #else\n    vUv = ( worldPosition.xyz - minBox ) / ( maxBox - minBox );\n    #endif\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n    #include <fog_vertex>\n}\n                ",fragmentShader:"\n                #include <common>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nprecision highp int;\nprecision highp float;\nprecision highp sampler3D;\nin vec3 vUv;\nuniform sampler3D map;\nvoid main() {\n    #include <clipping_planes_fragment>\n    #include <logdepthbuf_fragment>\n    gl_FragColor = texture(map, vUv);\n    #include <fog_fragment>\n#include <colorspace_fragment>\n    #include <tonemapping_fragment>\n}"}));return this.app.isMapMode&&(null!==(c=R.defines)&&void 0!==c||(R.defines={}),R.defines.ISMAPMODE=""),this.replaceMaterial(R),{lut:S,material:R,reset:()=>this.resetMaterial()}}))}isHighlight(){return!!this.highlightMaterial()}setHighlight(e,t){this.data.rawMaterial||(this.data.rawMaterial=qv(this,KC,"f").material,this.data.useMaterial=qv(this,KC,"f").material),this.clearHighlight();let i=new s;i.set(null!=e?e:this.app?this.app.envConfig.highlightColor:"#ffff00");let n=ib({material:qv(this,KC,"f").material,highlightOpacity:{value:null!=t?t:this.app?this.app.envConfig.highlightOpacity:.4},highlightColor:{value:i}});qv(this,KC,"f").material=n,this.data.highlightMaterial=n}clearHighlight(){this.data.highlightMaterial&&(PW(this.data.highlightMaterial),delete this.data.highlightMaterial,qv(this,KC,"f").material=this.useMaterial())}highlightMaterial(){return this.data.highlightMaterial}setOpacity(e,t){let i=OW(qv(this,KC,"f"),e,{isClone:!0,isAccOpacity:t});this.replaceMaterial(i),this.data.opacityMaterial=i}opacityMaterial(){return this.data.opacityMaterial}onDestroy(){var e;this.resetMaterial(),null===(e=this.entity)||void 0===e||e.removeObjects(qv(this,KC,"f")),this.clearEdges()}toJSON(){var e;return{mesh:{uuid:null===(e=qv(this,KC,"f"))||void 0===e?void 0:e.uuid}}}fromJSON(e,t){(null==e?void 0:e.mesh.uuid)&&Zv(this,KC,t.get(e.mesh.uuid),"f")}setupUiConfig(){return{type:"folder",expanded:!0,label:"模块参数设置",app:this.app,children:[{type:"checkbox",label:"高亮",getValue:()=>this.isHighlight(),setValue:e=>e?this.setHighlight():this.clearHighlight()},{type:"slider",label:"透明度",value:1,bounds:[0,1],stepSize:.01,onChange:e=>{this.setOpacity(e.value)}},{type:"checkbox",label:"模型边框线",value:!1,onChange:e=>{e.value?this.addEdges():this.clearEdges()}},{type:"color",label:"模型边框线颜色",getValue:()=>0,setValue:e=>{this.clearEdges(),0!=e&&this.addEdges({color:e})}}]}}}KC=new WeakMap,mA.moduleName="MeshModule";class gA extends j{constructor(e,t,i){super(e,t,i),this.maxCapacity=0,this.maxCapacity=i}addInstance(e,t,i){if(this.count>=this.maxCapacity)throw Error("InstancedMesh maxCapacity is "+this.maxCapacity);if(this.setMatrixAt(this.count,e),t){if(!this.instanceColor){let e=new s(1,1,1);for(let t=0;t<this.count-1;t++)this.setColorAt(t,e)}this.setColorAt(this.count,t),this.instanceColor.needsUpdate=!0}return this.instanceMatrix.needsUpdate=!0,this.count++,i&&this.computeBoundingSphere(),this.count}removeInstance(e,t){if(e>=this.count)return!1;if(this.count!=e+1){let t=new n;if(this.getMatrixAt(this.count-1,t),this.setMatrixAt(e,t),this.instanceMatrix.needsUpdate=!0,null!==this.instanceColor){let t=new s;this.getColorAt(this.count-1,t),this.setColorAt(e,t),this.instanceColor.needsUpdate=!0}}return this.count--,t&&this.computeBoundingSphere(),!0}}class vA extends Sy{constructor(e,t){var i;super(e),JC.add(this),this.meshList=[],this.uuidList=[],$C.set(this,[]),this.matrixWorldList=[],this.instancedMeshList=[],eA.set(this,void 0),tA.set(this,void 0),iA.set(this,0),nA.set(this,[]),sA.set(this,{}),rA.set(this,void 0),oA.set(this,!1),aA.set(this,void 0),this.instConfig={},this.idIndexMap=new pv({}),this.onInstanceTransformChangedSignal=new cy,Zv(this,eA,t,"f"),qv(this,eA,"f").maxCapacity=Math.max(null!==(i=qv(this,eA,"f").maxCapacity)&&void 0!==i?i:0,qv(this,eA,"f").instances.length),qv(this,eA,"f").mesh.traverse((e=>{e instanceof h&&(this.meshList.push(e),this.uuidList.push(e.uuid),e.geometry.computeBoundingBox(),qv(this,$C,"f").push((new E).copy(e.geometry.boundingBox)))})),qv(this,JC,"m",lA).call(this),qv(this,eA,"f").mesh.updateWorldMatrix(!0,!1),Zv(this,aA,qv(this,eA,"f").mesh.matrixWorld.clone(),"f")}addInstance(e){var t;!1!==(e=null!=e?e:{}).computeBoundingSphere&&(e.computeBoundingSphere=!0);let i=e.id;if(""==i&&(i=qv(this,iA,"f")+"",Zv(this,iA,(t=qv(this,iA,"f"),++t),"f")),void 0!==this.idIndexMap.get(i))return this.setInstance({id:i,position:e.position,rotation:e.rotation,scale:e.scale,color:e.color,computeBoundingSphere:e.computeBoundingSphere});let n=qv(this,JC,"m",cA).call(this,-1,{position:e.position,rotation:e.rotation,scale:e.scale},e.color,!0,e.computeBoundingSphere);return this.idIndexMap.add(i,n-1),qv(this,JC,"m",hA).call(this,i,e.position,e.rotation,e.scale,e.color),i}setInstance(e){!1!==(e=null!=e?e:{}).computeBoundingSphere&&(e.computeBoundingSphere=!0);let t=this.idIndexMap.get(e.id);return void 0===t?this.addInstance(e):(qv(this,JC,"m",cA).call(this,t,{position:e.position,rotation:e.rotation,scale:e.scale},e.color,!1,e.computeBoundingSphere),qv(this,JC,"m",hA).call(this,e.id,e.position,e.rotation,e.scale,e.color),e.id)}removeInstance(e,t){!1!==t&&(t=!0);let i=this.idIndexMap.get(e);if(void 0!==i){for(let e=0;e<this.meshList.length;e++)this.instancedMeshList[e].removeInstance(i);if(this.instancedMeshList.length>0){let t=this.instancedMeshList[0].count;this.idIndexMap.remove(e);let n=this.idIndexMap.getByValue(t);void 0!==n&&this.idIndexMap.add(n,i)}t&&this.getInstancedMeshList().forEach((e=>{e.computeBoundingSphere()})),delete this.instConfig[e]}}getInstancedMeshList(){return this.instancedMeshList}getGroup(){return qv(this,tA,"f")}getIdByIndex(e){return this.idIndexMap.getByValue(e)}getIndexById(e){return this.idIndexMap.get(e)}setInstanceSelected(e,t){if(void 0===this.getIndexById(e))return;let i=this.isInstanceSelected(e);if(t){if(i)return;let t=qv(this,JC,"m",uA).call(this);qv(this,sA,"f")[e]=t,qv(this,JC,"m",pA).call(this,e,t),qv(this,tA,"f").add(t.node),t.visible=!0,t.selected=!0}else{if(!i)return;let t=qv(this,sA,"f")[e];t&&(qv(this,tA,"f").remove(t.node),qv(this,JC,"m",fA).call(this,t))}this.setInstanceAttr(e,"isSelected",t)}isInstanceSelected(e){return this.getInstanceAttr(e,"isSelected")}clearInstanceSelected(){for(let e in this.instConfig)this.instConfig[e].isSelected&&this.setInstanceSelected(e,!1)}setInstanceBloom(e,t){if(void 0===this.getIndexById(e))return;let i=this.isInstanceBloom(e);if(t){if(i)return;let t=qv(this,JC,"m",uA).call(this);qv(this,sA,"f")[e]=t,qv(this,JC,"m",pA).call(this,e,t),qv(this,tA,"f").add(t.node),t.visible=!0,t.bloom=!0}else{if(!i)return;let t=qv(this,sA,"f")[e];t&&(qv(this,tA,"f").remove(t.node),qv(this,JC,"m",fA).call(this,t))}this.setInstanceAttr(e,"isBloom",t)}setInstanceOutline(e,t){if(void 0===this.getIndexById(e))return;let i=this.isInstanceOutline(e);if(t){if(i)return;let t=qv(this,JC,"m",uA).call(this);qv(this,sA,"f")[e]=t,qv(this,JC,"m",pA).call(this,e,t),qv(this,tA,"f").add(t.node),t.visible=!0,t.outline=!0}else{if(!i)return;let t=qv(this,sA,"f")[e];t&&(qv(this,tA,"f").remove(t.node),qv(this,JC,"m",fA).call(this,t))}this.setInstanceAttr(e,"isOutline",t)}clearInstanceOutline(){for(let e in this.instConfig)this.instConfig[e].isOutline&&this.setInstanceOutline(e,!1)}isInstanceBloom(e){return this.getInstanceAttr(e,"isBloom")}isInstanceOutline(e){return this.getInstanceAttr(e,"isOutline")}clearInstanceBloom(){for(let e in this.instConfig)this.instConfig[e].isBloom&&this.setInstanceBloom(e,!1)}setInstanceHighlight(e,t){var i;let n=this.getIndexById(e);if(void 0===n)return;let r=this.isInstanceHighlight(e);if(t){if(r)return;let e=new s;e.set(t),qv(this,JC,"m",cA).call(this,n,void 0,e,!1,!1)}else{if(!r)return;qv(this,JC,"m",cA).call(this,n,void 0,null!==(i=this.instConfig[e].color)&&void 0!==i?i:null,!1,!1)}this.setInstanceAttr(e,"isHighlight",!!t)}isInstanceHighlight(e){return this.getInstanceAttr(e,"isHighlight")}clearInstanceHighlight(){for(let e in this.instConfig)this.instConfig[e].isHighlight&&this.setInstanceHighlight(e,null)}getInstanceAttr(e,t){let i=this.instConfig[e];if(i)return i[t]}setInstanceAttr(e,t,i){this.instConfig[e]=this.instConfig[e]||{},this.instConfig[e][t]=i}getInstanceBox3(e){let t=this.getIndexById(e);if(void 0===t)return;let i=new E;for(let e=0;e<this.meshList.length;e++){let s=new n;this.instancedMeshList[e].getMatrixAt(t,s),i.union(qv(this,$C,"f")[e].clone().applyMatrix4(s))}return i}}$C=new WeakMap,eA=new WeakMap,tA=new WeakMap,iA=new WeakMap,nA=new WeakMap,sA=new WeakMap,rA=new WeakMap,oA=new WeakMap,aA=new WeakMap,JC=new WeakSet,lA=function(){var e,t;Zv(this,tA,new V,"f"),this.entity.node.add(qv(this,tA,"f"));for(let e=0;e<this.meshList.length;e++){let t=this.meshList[e];const i=new gA(t.geometry,t.material,qv(this,eA,"f").maxCapacity);i.castShadow=t.castShadow,i.receiveShadow=t.receiveShadow,i.count=qv(this,eA,"f").instances.length,qv(this,tA,"f").add(i),this.instancedMeshList.push(i),t.updateWorldMatrix(!0,!1),this.matrixWorldList.push(t.matrixWorld.clone())}for(let i=0;i<qv(this,eA,"f").instances.length;i++){let n=qv(this,eA,"f").instances[i];qv(this,JC,"m",cA).call(this,i,{position:n.position,rotation:n.rotation,scale:n.scale},n.color);let s=(null!==(e=n.id)&&void 0!==e?e:i)+"";this.idIndexMap.add(s,i),qv(this,JC,"m",hA).call(this,s,n.position,n.rotation,n.scale,n.color),Zv(this,iA,(t=qv(this,iA,"f"),++t),"f")}this.addDispose((()=>{this.getInstancedMeshList().forEach((e=>{lW(e)})),lW(qv(this,eA,"f").mesh),qv(this,nA,"f").forEach((e=>e.remove()))})),this.addDispose(this.onInstanceTransformChangedSignal.add((e=>{let t=qv(this,sA,"f")[e];t&&qv(this,JC,"m",pA).call(this,e,t)})))},hA=function(e,t,i,n,s){this.instConfig[e]=this.instConfig[e]||{},void 0!==s&&(this.instConfig[e].color=s),t&&(this.instConfig[e].position=t),i&&(this.instConfig[e].rotation=i),n&&(this.instConfig[e].scale=n),(t||i||n)&&this.onInstanceTransformChangedSignal.dispatch(e)},cA=function(e,t,i,r,o){let a,l=this.idIndexMap.getByValue(e);if(void 0!==l&&t){let e=this.instConfig[l]||{};void 0===t.position&&(t.position=e.position),void 0===t.rotation&&(t.rotation=e.rotation),void 0===t.scale&&(t.scale=e.scale)}t&&(a=cW(t));let h=-1;for(let t=0;t<this.meshList.length;t++){let l=this.matrixWorldList[t],c=this.instancedMeshList[t],d=i;if(!c.instanceColor&&d){let e=new s(1,1,1);for(let t=0;t<c.count;t++)c.setColorAt(t,e)}c.instanceColor&&null===i&&(d=new s(1,1,1));let u=a?a.clone().multiply(l):new n;r?h=c.addInstance(u,d,o):(a&&(c.setMatrixAt(e,u),c.instanceMatrix.needsUpdate=!0,o&&c.computeBoundingSphere()),(c.instanceColor||d)&&(c.setColorAt(e,d),c.instanceColor.needsUpdate=!0))}return h},dA=function(e,t){let i;i=hW(e)?Zi.clone(e):e.clone(),t&&i.traverse((e=>{e.isMesh&&(e.material=e.material.clone(),e.material.transparent=!0,e.material.opacity=.001)})),pW(i);let n=Ak(i,!0);return n.app=this.entity.app,n._ownerScene=n.app.scene,n},uA=function(){if(qv(this,rA,"f")||(Zv(this,rA,qv(this,JC,"m",dA).call(this,qv(this,eA,"f").mesh,!0),"f"),Zv(this,oA,!1,"f")),qv(this,oA,"f")){let e=qv(this,JC,"m",dA).call(this,qv(this,rA,"f").node,!1);return qv(this,nA,"f").push(e),e}return Zv(this,oA,!0,"f"),qv(this,nA,"f").push(qv(this,rA,"f")),qv(this,rA,"f")},pA=function(e,t){let n=this.instConfig[e]||{},s=cW({position:n.position,rotation:n.rotation,scale:n.scale});s=s.multiply(qv(this,aA,"f").clone());let r=new i,o=new v,a=new i;s.decompose(r,o,a),t.node.position.copy(r),t.node.quaternion.copy(o),t.node.scale.copy(a)},fA=function(e){e.selected=!1,e.bloom=!1,e.outline=!1,e.visible=!1,e==qv(this,rA,"f")?Zv(this,oA,!1,"f"):e.node.traverse((e=>{e instanceof h&&e.geometry&&e.geometry.dispose()})),hv(qv(this,nA,"f"),e)},vA.moduleName="InstancedMeshModule";class yA extends a{constructor(e){var{color:t,canvasSize:i}=e,n=Yv(e,["color","canvasSize"]);super(Object.assign(Object.assign({},n),{vertexShader:"\n          #include <common>\n          uniform vec2 canvasSize;\n          void main() {\n            vec4 mvPosition = modelViewMatrix * vec4(0., 0., 0., 1.);\n  \n            // Adapted from ShaderLib.sprite\n            vec2 scale;\n            scale.x = length(vec3(modelMatrix[0].xyz));\n            scale.y = length(vec3(modelMatrix[1].xyz));\n  \n            gl_Position = projectionMatrix * mvPosition;\n  \n            // Add position after projection to maintain constant pixel size\n            gl_Position.xy += position.xy / canvasSize * scale * gl_Position.w;\n          }\n        ",fragmentShader:"\n          uniform vec3 color;\n          void main() {\n            gl_FragColor = vec4(color, 1.0);\n          }\n        ",uniforms:{canvasSize:null!=i?i:{value:[1200,900]},color:{value:new s(t)}}}))}}const xA=e=>{let t=new H(qw(e,new H));return t.onBeforeCompile=t=>{var i,n;t.uniforms.borderWidth={value:null!==(i=e.borderWidth)&&void 0!==i?i:0},t.uniforms.borderColor={value:e.borderColor?new s(e.borderColor):new s("#ff0")},t.uniforms.fadeDistance={value:null!==(n=e.fadeDistance)&&void 0!==n?n:0},t.uniforms.shape={value:"circle"===e.shape?1:"triangle"===e.shape?2:0};let r="";e.vertexSize&&(r+="#define USE_VERTEXSIZE \n"),e.vertexBorderColor&&(r+="#define USE_VERTEXBORDERCOLOR \n"),t.vertexShader=r+"\n    #ifdef USE_VERTEXSIZE\n    attribute float vSize;\n    varying float vSize_;\n    #endif\n    #ifdef USE_VERTEXBORDERCOLOR\n    attribute vec3 vBorderColor;\n    varying vec3 vBorderColor_;\n    #endif\n    uniform float borderWidth;"+t.vertexShader,t.vertexShader=t.vertexShader.replace("gl_PointSize = size;","\n    #ifdef USE_VERTEXSIZE\n      gl_PointSize = vSize + borderWidth;\n      vSize_ = vSize;\n    #else\n      gl_PointSize = size + borderWidth;\n    #endif\n    #ifdef USE_VERTEXBORDERCOLOR\n      vBorderColor_ = vBorderColor;\n    #endif\n    "),t.vertexShader=t.vertexShader.replace("#include <color_pars_vertex>","\n#ifndef USE_ALPHAHASH\n    varying vec3 vPosition;\n#endif\n#include <color_pars_vertex>\n    "),t.vertexShader=t.vertexShader.replace("#include <begin_vertex>","vec3 transformed = vec3( position ); \n vPosition = vec3( position ); \n "),t.fragmentShader=r+"\n    #ifdef USE_VERTEXSIZE\n    varying float vSize_;\n    #endif\n    #ifdef USE_VERTEXBORDERCOLOR\n    varying vec3 vBorderColor_;\n    #endif\n    uniform float fadeDistance;\n    uniform int shape;\n    uniform vec3 borderColor;\n    uniform float size;\n    uniform float borderWidth;\n    #ifndef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\n    "+t.fragmentShader,t.fragmentShader=t.fragmentShader.replace("#include <opaque_fragment>","\n  #ifdef OPAQUE\n\tdiffuseColor.a = 1.0;\n\t#endif\n  #ifdef USE_VERTEXSIZE\n  float _size = vSize_;\n  #else\n  float _size = size;\n  #endif\n  #ifdef USE_VERTEXBORDERCOLOR\n   vec3 _borderColor = vBorderColor_;\n  #else\n  vec3 _borderColor = borderColor;\n  #endif\n\t#ifdef USE_TRANSMISSION\n\tdiffuseColor.a *= material.transmissionAlpha;\n\t#endif\n  if (fadeDistance > 0.0 ) {\n    diffuseColor.a = clamp(2.0 * (1.0 - distance(vPosition, cameraPosition) / fadeDistance ) * diffuseColor.a, 0.0, 1.0);\n    if (diffuseColor.a < 0.05) {\n      discard;\n    }\n  }\n  float dist = 0.0;\n  if (shape == 1) {\n    dist = length( 2.0 * gl_PointCoord - 1.0 );\n    if (dist > 1.0) {\n      discard;\n    }\n  } else if (shape == 2) {\n    vec2 pt = 2.0 * gl_PointCoord - 1.0;\n    dist = max(pt.y + 0.5, abs(pt.x) - ((pt.y - 0.6) / sqrt(3.0)));\n    if (dist > 1.0) {\n      discard;\n    }\n  } else {\n    dist = max(abs(2.0 * gl_PointCoord.x - 1.0), abs(2.0 * gl_PointCoord.y - 1.0));\n  }\n  if (borderWidth > 0.0) {\n    float edge = smoothstep(_size - borderWidth - 2.0, _size - borderWidth, ( _size + borderWidth) * dist);\n    gl_FragColor.rgb = ((1.0 - edge ) * outgoingLight.rgb) + (_borderColor * edge);\n    gl_FragColor.a = (1.0 - smoothstep( _size - 2.0, _size, dist * _size)) * diffuseColor.a;\n  } else {\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n  }\n")},!1===t.transparent&&(!e.shape&&"square"!=e.shape||e.fadeDistance>0)&&(t.transparent=!0),t},wA=Zw({color:new s("#ffffff"),time:new y,uvBegin:new r(0,0),uvOffset:new r(0,0),uvScale:new r(1,1),opacity:1,map:new W},"\n    #include <common>\n      #include <fog_pars_vertex>\n\t  #include <logdepthbuf_pars_vertex>\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        #include <logdepthbuf_vertex>\n\t\t#include <fog_vertex>\n      }\n    ","\n      #include <fog_pars_fragment>\n\t  #include <logdepthbuf_pars_fragment>\n      uniform vec3 color;\n      uniform vec4 time;\n      uniform vec2 uvBegin;\n      uniform vec2 uvOffset;\n      uniform vec2 uvScale;\n      uniform sampler2D map;\n      uniform float opacity;\n      varying vec2 vUv;\n      void main() {\n        #include <clipping_planes_fragment>\n        vec4 diffuseColor = vec4( color, opacity );\n        #include <logdepthbuf_fragment>\n\n        vec2 uv = vUv * uvScale;\n        uv.x += uvBegin.x + uvOffset.x * time.x;\n        uv.y += uvBegin.y + uvOffset.y * time.x;\n        diffuseColor *= texture2D(map, uv);\n        gl_FragColor = diffuseColor;\n        #include <tonemapping_fragment>\n\t\t#include <colorspace_fragment>\n\t\t#include <fog_fragment>\n      }\n    "),bA=(e,t)=>{var i;let n=!1===t.autoCanvasSize?null:Gu(t.element),s=IA({autoCanvasSize:!0,sharedCanvas:!1,canvasWidth:!1===t.autoCanvasSize?t.canvasWidth:n.width+100,canvasHeight:!1===t.autoCanvasSize?t.canvasHeight:n.height+100,elements:t.element});t.flowSpeed=null!==(i=t.flowSpeed)&&void 0!==i?i:.02;let o=s.texture({copyData:!0,dispose:!0,expandRect:t.expandRect}),a=o.source.data.width*t.geometryHeight/(t.geometryWidth*o.source.data.height);return"horizon"===t.flowDirection?(o.wrapS=G,o.wrapT=Y,new wA({uvBegin:new r(0,0),uvOffset:new r(t.flowSpeed,0),uvScale:new r(1/a,1),map:o,side:I},{time:e.commonUniforms.time})):(o.wrapS=Y,o.wrapT=G,new wA({uvBegin:new r(0,-a),uvOffset:new r(0,-t.flowSpeed),uvScale:new r(1,a),map:o,side:I},{time:e.commonUniforms.time}))},_A=(e,t)=>{let i=new qd({style:t});return bA(e,Object.assign(Object.assign({},t),{element:i}))},SA="\nuniform int curRunFrameCount;\nuniform int imageWidth;\nuniform int imageHeight;\nuniform int rowCount;\nuniform int colCount;\nuniform int spriteCount;\nuniform int spriteWidth;\nuniform int spriteHeight;\nuniform bool isStop;\nuniform int stopSpriteIndex;\n",MA="\n  if (imageWidth != 0) {\n    int _spriteCount = spriteCount;\n    if (_spriteCount == 0) {\n      _spriteCount = colCount * rowCount;\n    }\n    int curFrameCnt = int(time.z) - curRunFrameCount;\n    if (isStop) {\n      curFrameCnt = stopSpriteIndex;\n    }\n    int curSprite = curFrameCnt % _spriteCount;\n    int curCol =  curSprite % colCount;\n    int curRow = curSprite / colCount; \n    \n    int _spriteWidth = spriteWidth;\n    int _spriteHeight = spriteHeight;\n    if (_spriteWidth == 0) {\n      _spriteWidth = imageWidth / colCount;\n    }\n    if (_spriteHeight == 0) {\n      _spriteHeight = imageHeight / rowCount;\n    }\n    float spriteU = float(curCol * _spriteWidth);\n    float spriteV = float((curRow + 1)* _spriteHeight);\n\n    _newUV.x = (spriteU + _newUV.x * float(_spriteWidth)) / float(imageWidth);\n    _newUV.y = 1.0 - (spriteV - _newUV.y * float(_spriteHeight)) / float(imageHeight);\n  }\n",CA=Zw({color:new s("#ffffff"),time:new y,curRunFrameCount:0,imageWidth:0,imageHeight:0,rowCount:0,colCount:0,spriteCount:0,spriteWidth:0,spriteHeight:0,isStop:!1,stopSpriteIndex:0,opacity:1,map:new W},"\n      #include <common>\n      #include <fog_pars_vertex>\n\t    #include <logdepthbuf_pars_vertex>\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        #include <logdepthbuf_vertex>\n\t\t    #include <fog_vertex>\n      }\n    ",`\n    #include <common>\n      #include <fog_pars_fragment>\n\t  #include <logdepthbuf_pars_fragment>\n      uniform vec3 color;\n      uniform vec4 time;\n      uniform sampler2D map;\n      uniform float opacity;\n      ${SA}\n      varying vec2 vUv;\n      void main() {\n        #include <clipping_planes_fragment>\n        vec4 diffuseColor = vec4( color, opacity );\n        #include <logdepthbuf_fragment>\n\n       \n        vec2 _newUV = vUv;\n        ${MA}\n        diffuseColor *= texture2D(map, _newUV);\n        gl_FragColor = diffuseColor;\n        #include <tonemapping_fragment>\n\t\t    #include <colorspace_fragment>\n\t\t    #include <fog_fragment>\n      }\n    `),AA=(e,t)=>{var i,n,s,r,o,a,l,h,c,d;let u=new b(qw(e,new b)),p={curRunFrameCount:null!==(i=e.curRunFrameCount)&&void 0!==i?i:t.time.frameCount,imageWidth:null!==(n=e.imageWidth)&&void 0!==n?n:0,imageHeight:null!==(s=e.imageHeight)&&void 0!==s?s:0,rowCount:null!==(r=e.rowCount)&&void 0!==r?r:0,colCount:null!==(o=e.colCount)&&void 0!==o?o:0,spriteCount:null!==(a=e.spriteCount)&&void 0!==a?a:0,spriteWidth:null!==(l=e.spriteWidth)&&void 0!==l?l:0,spriteHeight:null!==(h=e.spriteHeight)&&void 0!==h?h:0,isStop:null!==(c=e.isStop)&&void 0!==c&&c,stopSpriteIndex:null!==(d=e.stopSpriteIndex)&&void 0!==d?d:0};return u.onBeforeCompile=e=>{let i=Object.fromEntries(Object.entries(p).map((([e,t])=>[e,{value:t}])));for(let t in i)e.uniforms[t]=i[t];e.uniforms.time=t.commonUniforms.time,e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`\n    #include <map_pars_fragment>\n    uniform vec4 time;\n    ${SA}\n    `),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`\n    #ifdef USE_MAP\n    vec2 _newUV = vMapUv;\n    ${MA}\n\t\tvec4 sampledDiffuseColor = texture2D( map, _newUV );\n\t\t#ifdef DECODE_VIDEO_TEXTURE\n\t\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\t\n\t\t#endif\n\t\tdiffuseColor *= sampledDiffuseColor;\n\t#endif\n    `)},u};class EA extends a{constructor(e=new r){super({uniforms:{inputBuffer:new X(null),depthBuffer:new X(null),resolution:new X(new r),texelSize:new X(new r),halfTexelSize:new X(new r),kernel:new X(0),scale:new X(1),cameraNear:new X(0),cameraFar:new X(1),minDepthThreshold:new X(0),maxDepthThreshold:new X(1),depthScale:new X(0),depthToBlurRatioBias:new X(.25)},fragmentShader:"#include <common>\n        #include <dithering_pars_fragment>   \n        #include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>   \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          #include <clipping_planes_fragment>\n    #include <logdepthbuf_fragment>\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n          #include <encodings_fragment>\n          #include <fog_fragment>\n          #include <colorspace_fragment>\n          #include <tonemapping_fragment>\n        }",vertexShader:"\n      #include <common>\n#include <clipping_planes_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\nuniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          #include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n          #include <fog_vertex>\n        }",blending:Q,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class TA{constructor({gl:e,resolution:t,width:i=500,height:n=500,minDepthThreshold:s=0,maxDepthThreshold:o=1,depthScale:a=0,depthToBlurRatioBias:l=.25}){this.renderToScreen=!1,this.renderTargetA=new q(t,t,{minFilter:N,magFilter:N,stencilBuffer:!1,depthBuffer:!1,type:Z}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new EA,this.convolutionMaterial.setTexelSize(1/i,1/n),this.convolutionMaterial.setResolution(new r(i,n)),this.scene=new K,this.camera=new J,this.convolutionMaterial.uniforms.minDepthThreshold.value=s,this.convolutionMaterial.uniforms.maxDepthThreshold.value=o,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=l,this.convolutionMaterial.defines.USE_DEPTH=a>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),d=new Float32Array([0,0,2,0,0,2]),u=new S;u.setAttribute("position",new O(c,3)),u.setAttribute("uv",new O(d,2)),this.screen=new h(u,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,i){const n=this.scene,s=this.camera,r=this.renderTargetA,o=this.renderTargetB;let a=this.convolutionMaterial,l=a.uniforms;l.depthBuffer.value=t.depthTexture;const h=a.kernel;let c,d,u,p=t;for(d=0,u=h.length-1;d<u;++d)c=0==(1&d)?r:o,l.kernel.value=h[d],l.inputBuffer.value=p.texture,e.setRenderTarget(c),e.render(n,s),p=c;l.kernel.value=h[d],l.inputBuffer.value=p.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(n,s)}}class PA extends ${constructor(e={}){super(qw(e,$)),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;(null===(t=e.defines)||void 0===t?void 0:t.USE_UV)||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;\n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;\n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n\n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n\n      vec4 merge = base;\n\n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n\n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n\n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);\n      ")}get tDiffuse(){var e;return null===(e=this._tDiffuse)||void 0===e?void 0:e.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){var e;return null===(e=this._tDepth)||void 0===e?void 0:e.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){var e;return null===(e=this._distortionMap)||void 0===e?void 0:e.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){var e;return null===(e=this._tDiffuseBlur)||void 0===e?void 0:e.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){var e;return null===(e=this._textureMatrix)||void 0===e?void 0:e.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){var e;return null===(e=this._hasBlur)||void 0===e?void 0:e.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){var e;return null===(e=this._mirror)||void 0===e?void 0:e.value}set mirror(e){this._mirror.value=e}get mixBlur(){var e;return null===(e=this._mixBlur)||void 0===e?void 0:e.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){var e;return null===(e=this._blurStrength)||void 0===e?void 0:e.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){var e;return null===(e=this._minDepthThreshold)||void 0===e?void 0:e.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){var e;return null===(e=this._maxDepthThreshold)||void 0===e?void 0:e.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){var e;return null===(e=this._depthScale)||void 0===e?void 0:e.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){var e;return null===(e=this._depthToBlurRatioBias)||void 0===e?void 0:e.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){var e;return null===(e=this._distortion)||void 0===e?void 0:e.value}set distortion(e){this._distortion.value=e}get mixContrast(){var e;return null===(e=this._mixContrast)||void 0===e?void 0:e.value}set mixContrast(e){this._mixContrast.value=e}}class OA{constructor(e,t,s={}){this.app=e,this.parent=t;let{resolution:r=256,mixBlur:o=0,mixStrength:a=1,blur:l=[0,0],mirror:h=0,ignoreObjects:d=[]}=s;this.ignoreObjects=d,l=Array.isArray(l)?l:[l,l];const u=l[0]+l[1]>0;this.hasBlur=u;const p=this.app.renderer,f=t,m=new c,g=new i,v=new i,x=new i,w=new n,b=new i(0,0,-1),_=new y,S=new i,M=new i,C=new y,A=new n,E=new ee;this.virtualCamera=E;const T=this.app.camera;this.beforeRender=()=>{if(v.setFromMatrixPosition(f.matrixWorld),x.setFromMatrixPosition(T.matrixWorld),w.extractRotation(f.matrixWorld),g.set(0,0,1),g.applyMatrix4(w),S.subVectors(v,x),S.dot(g)>0)return;S.reflect(g).negate(),S.add(v),w.extractRotation(T.matrixWorld),b.set(0,0,-1),b.applyMatrix4(w),b.add(x),M.subVectors(v,b),M.reflect(g).negate(),M.add(v),E.position.copy(S),E.up.set(0,1,0),E.up.applyMatrix4(w),E.up.reflect(g),E.lookAt(M),E.far=T.far,E.updateMatrixWorld(),E.projectionMatrix.copy(T.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(E.projectionMatrix),A.multiply(E.matrixWorldInverse),A.multiply(f.matrixWorld),m.setFromNormalAndCoplanarPoint(g,v),m.applyMatrix4(E.matrixWorldInverse),_.set(m.normal.x,m.normal.y,m.normal.z,m.constant);const e=E.projectionMatrix;C.x=(Math.sign(_.x)+e.elements[8])/e.elements[0],C.y=(Math.sign(_.y)+e.elements[9])/e.elements[5],C.z=-1,C.w=(1+e.elements[10])/e.elements[14],_.multiplyScalar(2/_.dot(C)),e.elements[2]=_.x,e.elements[6]=_.y,e.elements[10]=_.z+1,e.elements[14]=_.w};const P={minFilter:N,magFilter:N,type:Z},O=new q(r,r,P);O.depthBuffer=!0,O.depthTexture=new te(r,r),O.depthTexture.format=ie,O.depthTexture.type=ne;const D=new q(r,r,P),B=new TA({gl:p,resolution:r,width:l[0],height:l[1]}),I={mirror:h,textureMatrix:A,mixBlur:o,tDiffuse:O.texture,tDepth:O.depthTexture,tDiffuseBlur:D.texture,hasBlur:u,mixStrength:a},R={"defines-USE_BLUR":u?"":void 0};this.fbo1=O,this.fbo2=D,this.blurpass=B;const k=new PA(Object.assign(Object.assign({},s),I));k.defines.USE_BLUR=R["defines-USE_BLUR"],this.material=k;const L=this.app.signal.onAppRender.add((()=>{this.update()}));this.material.addEventListener("removed",(()=>L())),this.parent&&this.parent.addEventListener("removed",(()=>L()))}update(){const{parent:e,beforeRender:t,virtualCamera:i,fbo1:n,fbo2:s,blurpass:r,hasBlur:o,ignoreObjects:a}=this,l=this.app.renderer,h=this.app.scene;e.visible=!1,a.forEach((e=>{e.visible=!1}));const c=l.xr.enabled,d=l.shadowMap.autoUpdate;t();let u=l.getRenderTarget();l.xr.enabled=!1,l.shadowMap.autoUpdate=!1,l.setRenderTarget(n),l.state.buffers.depth.setMask(!0),l.autoClear||l.clear(),l.render(h,i),o&&r.render(l,n,s),l.xr.enabled=c,l.shadowMap.autoUpdate=d,e.visible=!0,a.forEach((e=>{e.visible=!0})),l.setRenderTarget(u)}}let DA,BA;const IA=e=>{var t,i,n,s;let r,o,a,l;if(!e.autoCanvasSize||e.canvasWidth||e.render2dObject||(!1===e.sharedCanvas||e.pointerEvents?(r=document.createElement("canvas"),r.width=null!==(n=e.canvasWidth)&&void 0!==n?n:200,r.height=null!==(s=e.canvasHeight)&&void 0!==s?s:200,a=r.getContext("2d",{willReadFrequently:!0}),o=fl(r)):(DA?BA.clear():(DA=document.createElement("canvas"),DA.width=null!==(t=null===window||void 0===window?void 0:window._DEFAULT_CANVAS_W)&&void 0!==t?t:2e3,DA.height=null!==(i=null===window||void 0===window?void 0:window._DEFAULT_CANVAS_H)&&void 0!==i?i:2e3,a=DA.getContext("2d",{willReadFrequently:!0}),BA=fl(DA)),r=DA,o=BA)),e.render2dObject&&(o=e.render2dObject),!o&&!r){if(!e.canvasWidth||!e.canvasHeight)throw Error("canvasWidth or canvasHeigh is null");r=document.createElement("canvas"),r.width=e.canvasWidth,r.height=e.canvasHeight,a=r.getContext("2d",{willReadFrequently:!0}),o=fl(r)}let h=new cl;if(e.elements){let t=e.elements;Array.isArray(t)||(t=[t]),t.forEach((e=>h.add(e)))}o.add(h);let c=r||o.painter.root;a=null!=a?a:c.getContext("2d",{willReadFrequently:!0});const d=(e,t,i)=>{if(!o)return;if(void 0===t&&void 0===i)return"mouseout"==e?void d("mousemove"):void o.handler[e]({zrX:-1e4,zrY:-1e4});let n=t,s=i;if("number"!=typeof t){let e=t.x,i=1-t.y;l?(n=l.width*e,s=l.height*i):(n=r.width*e,s=r.height*i)}l&&(n+=l.x,s+=l.y),o.handler[e]&&o.handler[e]({zrX:n,zrY:s})},u=()=>{o&&o!=BA&&(o.dispose(),o=null),r&&DA!=r&&(r=null)};return{texture:t=>{var i,n,s;if(o){if(o.painter.refresh(),(null==t?void 0:t.outputImageDebug)&&(console.log(c),console.log(c.toDataURL())),e.autoCanvasSize){let s=h.getBoundingRect();l=s;let r=null!==(i=null==t?void 0:t.expandRect)&&void 0!==i?i:0;Array.isArray(r)||(r=[r,r,r,r]);let o=a.getImageData(s.x+r[0],s.y+r[1],s.width+(r[0]+r[2]),s.height+(r[1]+r[3]));(null==t?void 0:t.outputImageDebug)&&console.log(o);let c=new W(o);return c.colorSpace=null!==(n=e.colorSpace)&&void 0!==n?n:se,c.needsUpdate=!0,1==(null==t?void 0:t.dispose)&&u(),c}{let i=a.getImageData(0,0,o.painter.getWidth(),o.painter.getHeight());(null==t?void 0:t.outputImageDebug)&&console.log(i);let n=(null==t?void 0:t.copyData)?new W(i):new W(o.painter.root);return n.colorSpace=null!==(s=e.colorSpace)&&void 0!==s?s:se,n.needsUpdate=!0,l=null,1==(null==t?void 0:t.dispose)&&u(),n}}},update:e=>{if(o)return e({group:h,render:o,canvas:r})},dispatchEvent:d,dispose:u,render:o}};var RA,kA,LA,zA;function UA(e=1024,t=1024,i={samples:0,depth:!1}){var n=e,s=t,r=i,o=r.samples||0,a=r.depth,l=Object.assign({},r);delete l.samples,delete l.depth;var h=new q(n,s,Object.assign({minFilter:N,magFilter:N,type:Z},l));return a&&(h.depthTexture=new te(n,s,re)),h.samples=o,h}class FA{constructor(e,t){var i,n;RA.set(this,0),kA.set(this,0),LA.set(this,!1),zA.set(this,!1),this.signal={onRenderFinsh:new cy,onRenderOne:new cy},this.app=e,t=null!=t?t:{},e.offscreenCanvas&&!t.scene?(this._texture=new w(e.offscreenCanvas),Zv(this,zA,!1!==t.autoDisposeApp,"f")):(this.fbo=UA(t.width,t.height),this.scene=t.scene,this.camera=t.camera,this._texture=this.fbo.texture),this.renderCount=null!==(i=t.renderCount)&&void 0!==i?i:0,this.renderInterval=null!==(n=t.renderInterval)&&void 0!==n?n:0,gv(["update"],this),this.app.signal.onAppAfterRender.add(this.update),this.fbo?this.fbo.addEventListener("dispose",(()=>{this.dispose()})):this._texture.addEventListener("dispose",(()=>{this.dispose()}))}get texture(){return this._texture}update(){var e,t;if(this.renderCount>0){if(qv(this,RA,"f")>this.renderCount)return this.app.signal.onAppAfterRender.remove(this.update),this.signal.onRenderFinsh.dispatch(this),void(this.app&&qv(this,zA,"f")&&(this.app.dispose(),this.app=null));Zv(this,RA,(e=qv(this,RA,"f"),++e),"f")}if(this.renderInterval>0){if(qv(this,kA,"f")!=this.renderInterval)return void Zv(this,kA,(t=qv(this,kA,"f"),t++,t),"f");Zv(this,kA,0,"f")}if(this.fbo){let e=this.app.renderer.getRenderTarget();this.app.renderer.setRenderTarget(this.fbo),this.app.renderer.render(this.scene,this.camera),this.app.renderer.setRenderTarget(e)}this.texture.needsUpdate=!0,qv(this,LA,"f")||(this.signal.onRenderOne.dispatch(this),Zv(this,LA,!0,"f"))}dispose(){this.fbo&&(this.fbo.dispose(),this.fbo=null),this.app&&(this.app.signal.onAppAfterRender.remove(this.update),qv(this,zA,"f")&&(this.app.dispose(),this.app=null))}}RA=new WeakMap,kA=new WeakMap,LA=new WeakMap,zA=new WeakMap;const NA=(e,t,i)=>`\n    #include <common>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n    precision highp float;\n  \n    uniform float iGlobalTime;\n    uniform float iTime;\n    uniform float iTimeDelta;\n    uniform vec3 iResolution;\n    uniform vec4 iMouse;\n    uniform int iFrame;\n    uniform vec4 iDate;\n    uniform float iSampleRate;\n    \n    uniform vec4 iColor;\n    varying vec2 vUv;\n    uniform sampler2D iChannel0;\n    uniform sampler2D iChannel1;\n    uniform sampler2D iChannel2;\n    uniform sampler2D iChannel3;\n    uniform samplerCube iChannel0Cube;\n    uniform samplerCube iChannel1Cube;\n    uniform samplerCube iChannel2Cube;\n    uniform samplerCube iChannel3Cube;\n\n    uniform sampler2D iMap;\n    uniform vec2 uRepeat;\n    uniform float opacity;\n    #ifdef BRIGHT_OPACITY \n    uniform float brightOpacity;\n    #endif\n    #ifdef ADJUST_HSB \n    uniform vec3 hsbOffset;\n    #endif\n    #ifdef ROTATE_UV\n    uniform float uvRotation;\n    uniform vec2 uvRotateCenter;\n    #endif\n    #ifdef SCALE_UV\n    uniform vec2 uvScale;\n    uniform vec2 uvScaleCenter;\n    uniform vec4 uvScaleBgColor; \n    #endif\n    ${null!=t?t:""}\n\n    \n    vec3 rgbtohsb_(vec3 c){\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n      }\n      \n    vec3 hsb2rgb_(vec3 c){\n        vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0), 6.0)-3.0)-1.0, 0.0, 1.0);\n        rgb = rgb * rgb * (3.0 - 2.0 * rgb);\n        return c.z * mix(vec3(1.0), rgb, c.y);\n      }\n      \n      vec2 rotateUV(vec2 uv, float rotation, vec2 mid)\n        {\n            return vec2(\n            cos(rotation) * (uv.x - mid.x) + sin(rotation) * (uv.y - mid.y) + mid.x,\n            cos(rotation) * (uv.y - mid.y) - sin(rotation) * (uv.x - mid.x) + mid.y\n            );\n        }\n\n    void mainImage( out vec4,  vec2 fragCoord );\n    void main () {\n        #include <clipping_planes_fragment>\n        #include <logdepthbuf_fragment>\n        vec4 outfrag;\n        vec2 uv = vUv;\n    #ifdef ROTATE_UV\n        uv = rotateUV(uv, uvRotation, uvRotateCenter);\n    #endif\n        uv = fract(uv * uRepeat);\n    #ifdef SCALE_UV\n        uv = (uv - uvScaleCenter) / uvScale + uvScaleCenter;\n        if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {\n            gl_FragColor = uvScaleBgColor; \n            discard;\n        } \n    #endif\n        mainImage(outfrag,iResolution.xy*uv);\n        gl_FragColor = outfrag;\n       \n        #ifdef BRIGHT_OPACITY \n            vec3 hsb = rgbtohsb_(gl_FragColor.xyz);\n        #endif\n        #ifndef BRIGHT_OPACITY\n            #ifdef ADJUST_HSB \n                vec3 hsb = rgbtohsb_(gl_FragColor.xyz);\n            #endif\n        #endif\n    #ifdef BRIGHT_OPACITY \n        gl_FragColor.a *= brightOpacity > 0.0 ? clamp(brightOpacity * hsb.z, 0., 1.) : clamp(-brightOpacity * (1.0 - hsb.z), 0., 1.);\n    #endif\n        gl_FragColor.a *= opacity;\n        #ifdef ADJUST_HSB \n         hsb = hsb + hsbOffset;\n         ${null!=i?i:""}\n         gl_FragColor.rgb = hsb2rgb_(hsb);\n        #endif \n    `+(e?`\n    if (gl_FragColor.rgb == vec3(${e.r},${e.g},${e.b})) {\n        gl_FragColor.a = 0.0;\n    }\n    `:"")+"\n\n   \n    vec4 c = iColor;\n    if (c.a != 0.) {\n        #ifdef USE_MAP\n        #ifdef USE_COLOR_AS_ALPHA\n        vec4 tex = texture2D( iMap, uv * uRepeat );\n        c *= vec4(tex.rgb, tex.r);\n        #else\n        c *= texture2D( iMap, uv * uRepeat );\n        #endif\n        #endif\n        gl_FragColor = mix(gl_FragColor, c, c.a);\n    }\n    #include <tonemapping_fragment>\n    #include <colorspace_fragment> \n    #include <fog_fragment>\n}\n    ";class jA extends a{constructor(e,t){var n,o,a,l,h,c,d,u,p,f,m,g,v;t=null!=t?t:{};let x=Object.assign({},e.commonUniforms);t.resolution=null!==(n=t.resolution)&&void 0!==n?n:[1e3,1e3],t.mouseInputPos&&(x.iMouse=new X(new y(t.mouseInputPos[0],t.mouseInputPos[1],0,0))),x.iResolution=new X(new i(t.resolution[0],t.resolution[1],0)),x.opacity=new X(null!==(o=t.opacity)&&void 0!==o?o:1);let w=new y(1,1,1,0);if(t.color){let e=new s(t.color);w=new y(e.r,e.g,e.b,null!==(a=t.colorOpacity)&&void 0!==a?a:.5)}x.iColor=new X(w),t.map&&(t.defines=Object.assign(Object.assign({},t.defines),{USE_MAP:""}),x.iMap=new X(t.map)),t.brightOpacity&&(t.defines=Object.assign(Object.assign({},t.defines),{BRIGHT_OPACITY:1}),x.brightOpacity=new X(t.brightOpacity)),t.hsbOffset&&(t.defines=Object.assign(Object.assign({},t.defines),{ADJUST_HSB:1}),x.hsbOffset=new X(new i(...t.hsbOffset))),t.hsbExpr&&(t.defines=Object.assign(Object.assign({},t.defines),{ADJUST_HSB:1})),t.uvRotateAngle&&(t.defines=Object.assign(Object.assign({},t.defines),{ROTATE_UV:1}),x.uvRotation=new X(t.uvRotateAngle*Math.PI/180),null!==(l=t.uvRotateCenter)&&void 0!==l||(t.uvRotateCenter=[.5,.5]),x.uvRotateCenter=new X(new r(...t.uvRotateCenter))),t.uvScale&&(t.defines=Object.assign(Object.assign({},t.defines),{SCALE_UV:1}),x.uvScale=new X(new r(...t.uvScale)),null!==(h=t.uvScaleCenter)&&void 0!==h||(t.uvScaleCenter=[.5,.5]),x.uvScaleCenter=new X(new r(...t.uvScaleCenter)),null!==(c=t.uvScaleBgColor)&&void 0!==c||(t.uvScaleBgColor=[0,0,0,0]),x.uvScaleBgColor=new X(new y(...t.uvScaleBgColor)));let b=t.inputUniforms||[],_="";b.forEach((e=>{x[e.name]=e.value,_+=e.defs+";\r\n"})),t.uniforms=Object.assign(Object.assign({},t.uniforms),x),t.repeat=null!==(d=t.repeat)&&void 0!==d?d:[1,1],t.uniforms.uRepeat=new X(new r(...t.repeat)),t.uniforms.sizeAttenuation=new X(null===(u=t.sizeAttenuation)||void 0===u||u),t.sizeAttScale=null!==(p=t.sizeAttScale)&&void 0!==p?p:1,"number"==typeof t.sizeAttScale&&(t.sizeAttScale=[t.sizeAttScale,t.sizeAttScale,t.sizeAttScale]),t.uniforms.sizeAttScale=new X(new i(.01*t.sizeAttScale[0],.01*t.sizeAttScale[1],.01*t.sizeAttScale[2])),t.vertexShader=null!==(f=t.vertexShader)&&void 0!==f?f:"\n        #include <common>\n#include <clipping_planes_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\n            varying vec2 vUv;\n            uniform bool sizeAttenuation;\n            uniform vec3 sizeAttScale;\n            void main() {\n                #include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n                vUv = uv;\n                if (sizeAttenuation) {\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                } else {\n                    vec4 mvPosition = modelViewMatrix * vec4(0.,0.,0.,1.);\n                    bool isPerspectiveCamera = (projectionMatrix[2][3]==-1.);\n                    vec3 scale = isPerspectiveCamera ? -mvPosition.z*sizeAttScale : vec3(1.);\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(scale*position.xyz, 1.0);\n                }\n                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                #include <fog_vertex>\n            }",void 0===t.opacityColor||t.opacityColor.isColor||(t.opacityColor=new s(t.opacityColor)),t.fragmentShader=null!==(m=t.fragmentShader)&&void 0!==m?m:NA(t.opacityColor,_,t.hsbExpr)+"\n"+(null!==(g=t.common)&&void 0!==g?g:"")+"\n"+(null!==(v=t.shader)&&void 0!==v?v:""),super(qw(t))}}const VA=new s("#ffffff");class HA{set common(e){this.bufferA.common=e,this.bufferB.common=e,this.bufferC.common=e,this.bufferD.common=e,this.image.common=e}get texture(){return this._texture}constructor(e,t){var n,o,a,l,h,c,d,u;this.clock=new oe,this.app=e,this.uniforms=this.app.commonUniforms,this.uniforms=Object.assign({},e.commonUniforms),t.mouseInputPos&&(this.uniforms.iMouse=new X(new y(t.mouseInputPos[0],t.mouseInputPos[1],0,0))),this.uniforms.uRepeat=new X(new r(...null!==(n=t.repeat)&&void 0!==n?n:[1,1])),this.uniforms.opacity=new X(null!==(o=t.opacity)&&void 0!==o?o:1),this.uniforms.brightOpacity=new X(null!==(a=t.brightOpacity)&&void 0!==a?a:0);let p=new y(1,1,1,0);if(t.color){let e=new s(t.color);p=new y(e.r,e.g,e.b,null!==(l=t.colorOpacity)&&void 0!==l?l:.5)}this.uniforms.iColor=new X(p),t.map&&(t.defines=Object.assign(Object.assign({},t.defines),{USE_MAP:""}),this.uniforms.iMap=new X(t.map)),t.brightOpacity&&(t.defines=Object.assign(Object.assign({},t.defines),{BRIGHT_OPACITY:1}),this.uniforms.brightOpacity=new X(t.brightOpacity)),t.hsbOffset&&(t.defines=Object.assign(Object.assign({},t.defines),{ADJUST_HSB:1}),this.uniforms.hsbOffset=new X(new i(...t.hsbOffset))),t.hsbExpr&&(t.defines=Object.assign(Object.assign({},t.defines),{ADJUST_HSB:1})),t.uvRotateAngle&&(t.defines=Object.assign(Object.assign({},t.defines),{ROTATE_UV:1}),this.uniforms.uvRotation=new X(t.uvRotateAngle*Math.PI/180),null!==(h=t.uvRotateCenter)&&void 0!==h||(t.uvRotateCenter=[.5,.5]),this.uniforms.uvRotateCenter=new X(new r(...t.uvRotateCenter))),t.uvScale&&(t.defines=Object.assign(Object.assign({},t.defines),{SCALE_UV:1}),this.uniforms.uvScale=new X(new r(...t.uvScale)),null!==(c=t.uvScaleCenter)&&void 0!==c||(t.uvScaleCenter=[.5,.5]),this.uniforms.uvScaleCenter=new X(new r(...t.uvScaleCenter)),null!==(d=t.uvScaleBgColor)&&void 0!==d||(t.uvScaleBgColor=[0,0,0,0]),this.uniforms.uvScaleBgColor=new X(new y(...t.uvScaleBgColor)));let f=t.inputUniforms||[],m="";f.forEach((e=>{this.uniforms[e.name]=e.value,m+=e.defs+";\r\n"}));let g=t.width,v=t.height;this.uniforms.iResolution={value:new i(g,v,0)},gv(["render"],this),void 0!==t.opacityColor&&(this.opacityColor=new s(t.opacityColor)),this.bufferA=new GA(g,v,this.opacityColor,t.materialParameters,t.renderTargetOptions,m,t.hsbExpr),this.bufferB=new GA(g,v,this.opacityColor,t.materialParameters,t.renderTargetOptions,m,t.hsbExpr),this.bufferC=new GA(g,v,this.opacityColor,t.materialParameters,t.renderTargetOptions,m,t.hsbExpr),this.bufferD=new GA(g,v,this.opacityColor,t.materialParameters,t.renderTargetOptions,m,t.hsbExpr),this.image=new GA(g,v,this.opacityColor,t.materialParameters,t.renderTargetOptions,m,t.hsbExpr),this._texture=this.image.outputBuffer.texture,this.app.signal.onAppAfterRender.add(this.render),this._texture.addEventListener("dispose",(()=>{this.dispose()})),this.common=t.common;const x=(e,t)=>{e.shader=null==t?void 0:t.shader,(null==t?void 0:t.iChannel0)&&(e.iChannel[0]=null==t?void 0:t.iChannel0),(null==t?void 0:t.iChannel1)&&(e.iChannel[1]=null==t?void 0:t.iChannel1),(null==t?void 0:t.iChannel2)&&(e.iChannel[2]=null==t?void 0:t.iChannel2),(null==t?void 0:t.iChannel3)&&(e.iChannel[3]=null==t?void 0:t.iChannel3)};let w;(null==t?void 0:t.shader)&&(t.image=t.image||{},t.image.shader=null!==(u=t.image.shader)&&void 0!==u?u:null==t?void 0:t.shader),t.image&&x(this.image,t.image),t.bufferA&&(x(this.bufferA,t.bufferA),w=this.bufferA),t.bufferB&&(w&&(this.bufferB.iChannel[0]=w),x(this.bufferB,t.bufferB),w=this.bufferB),t.bufferC&&(w&&(this.bufferC.iChannel[0]=w),x(this.bufferC,t.bufferC),w=this.bufferC),t.bufferD&&(w&&(this.bufferD.iChannel[0]=w),x(this.bufferD,t.bufferD),w=this.bufferD),w&&(this.image.iChannel[0]=w),t.defines&&[this.bufferA,this.bufferB,this.bufferC,this.bufferD,this.image].forEach((e=>{e.enabled&&(e.plane.material.defines=Object.assign(Object.assign({},e.plane.material.defines),t.defines),e!=this.image&&(delete e.plane.material.defines.BRIGHT_OPACITY,delete e.plane.material.defines.ADJUST_HSB,delete e.plane.material.defines.USE_MAP))}))}render(){let e=this.app.renderer;[this.bufferA,this.bufferB,this.bufferC,this.bufferD,this.image].forEach((t=>{t.enabled&&(Object.keys(this.uniforms).forEach((e=>{t.uniforms[e]=this.uniforms[e]})),t!==this.image&&(t.uniforms.iColor.value=VA),t.render(e))})),this.image.outputBuffer.texture.needsUpdate=!0}dispose(){this.app.signal.onAppAfterRender.remove(this.render),delete this.image,delete this.bufferA,delete this.bufferB,delete this.bufferC,delete this.bufferD}}const WA=new W;class GA{set shader(e){var t;this.enabled=!0;const i=NA(this.opacityColor,this.uniformsDefs,this.hsbExpr)+"\n"+(null!==(t=this.common)&&void 0!==t?t:"")+"\n"+(null!=e?e:""),n=new a(Object.assign({fragmentShader:i,vertexShader:"\n#include <common>\n#include <clipping_planes_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\nvarying vec2 vUv;\nvoid main() {\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vUv = uv;\n    gl_Position = vec4(position,1.0);\n    #include <fog_vertex>\n}\n",uniforms:this.uniforms},this.materialParameters));this.plane.material=n}constructor(e,t,i,n,r,o,a){this.width=e,this.height=t,this.common="",this.uniformsDefs="",this.hsbExpr="",this.iChannel=[WA,WA,WA,WA],this.uniforms={iChannel0:{value:WA},iChannel1:{value:WA},iChannel2:{value:WA},iChannel3:{value:WA}},this.camera=new f(-1,1,1,-1,-1,1),this.enabled=!1,this.opacityColor=i,this.materialParameters=n,this.uniformsDefs=o,this.hsbExpr=a,this.outputBuffer=new q(e,t,Object.assign({minFilter:N,magFilter:N,format:U,colorSpace:ae,type:re,stencilBuffer:!1},r)),this.readBuffer=this.outputBuffer.clone(),this.scene=new K,this.scene.background=new s(0),this.plane=new h(new l(2,2),new x({color:16711680})),this.scene.add(this.plane)}swap(){const e=this.readBuffer;this.readBuffer=this.outputBuffer,this.outputBuffer=e}getIChannel(e){const t=this.iChannel[e];return t instanceof W?t:t.readBuffer.texture}render(e){this.uniforms.iChannel0.value=this.getIChannel(0),this.uniforms.iChannel1.value=this.getIChannel(1),this.uniforms.iChannel2.value=this.getIChannel(2),this.uniforms.iChannel3.value=this.getIChannel(3);let t=e.getRenderTarget();e.setRenderTarget(this.outputBuffer),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.swap()}}class YA{constructor(e,t,n={}){this.app=e;const{backside:o=!0,samples:l=16,background:h=null,chromaticAberration:c=.5,refraction:d=.25,saturation:u=1.14,lightPosition:p=new i(-1,1,1),diffuse:f=.2,specular:m=15,fresnel:g=8,fresnelColor:v=new s("#ffffff")}=n;this.backside=o,this.background=h,this.parent=t;const y=UA();this.fbo=y;const x=UA();this.fboBack=x;const w=new a({vertexShader:"\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvarying vec3 vNormal;\nvarying vec3 vEyeVector;\n\n#define GLSLIFY 1\nvec4 getWorldPosition(mat4 modelMat,vec3 pos){\n    vec4 worldPosition=modelMat*vec4(pos,1.);\n    return worldPosition;\n}\n\nvec3 getEyeVector(mat4 modelMat,vec3 pos,vec3 camPos){\n    vec4 worldPosition=getWorldPosition(modelMat,pos);\n    vec3 eyeVector=normalize(worldPosition.xyz-camPos);\n    return eyeVector;\n}\n\nvoid main(){\n    vec3 p=position;\n    gl_Position=projectionMatrix*modelViewMatrix*vec4(p,1.);\n    \n    vUv=uv;\n\n    vNormal=normalize(normalMatrix*normal);\n    vEyeVector=getEyeVector(modelMatrix,p,cameraPosition);\n}\n",fragmentShader:"\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nuniform sampler2D uTexture;\nuniform vec2 uFBOResolution;\n\nvarying vec3 vNormal;\nvarying vec3 vEyeVector;\n\nuniform float uChromaticAberration;\nuniform float uRefraction;\nuniform float uSaturation;\nuniform vec3 uLightPosition;\nuniform float uDiffuse;\nuniform float uSpecular;\nuniform float uFresnel;\nuniform vec3 uFresnelColor;\n\nvec3 saturation(vec3 rgb,float adjustment){\n    const vec3 W=vec3(.2125,.7154,.0721);\n    vec3 intensity=vec3(dot(rgb,W));\n    return mix(intensity,rgb,adjustment);\n}\n\nfloat saturate(float a){\n    return clamp(a,0.,1.);\n}\n\nfloat diffuse(vec3 n,vec3 l){\n    float diff=saturate(dot(n,l));\n    return diff;\n}\n\nfloat specular2(vec3 n,vec3 l,float shininess){\n    float spec=pow(saturate(pow(dot(n,l),2.)),shininess);\n    return spec;\n}\n\nfloat lighting(vec3 light,vec3 normal,vec3 eyeVector,float d,float s){\n    vec3 N=normal;\n    vec3 L=normalize(-light);\n    vec3 H=normalize(eyeVector+L);\n    \n    float diff=diffuse(N,L)*d;\n    float spec=specular2(N,H,s);\n    float lin=diff+spec;\n    return lin;\n}\n\nfloat fresnel2(vec3 eyeVector,vec3 worldNormal,float power){\n    float fresnelFactor=abs(dot(eyeVector,worldNormal));\n    float inversefresnelFactor=1.-fresnelFactor;\n    return pow(inversefresnelFactor,power);\n}\n\nvoid main(){\n    vec2 p=gl_FragCoord.xy/uFBOResolution.xy;\n    \n    vec3 col=vec3(0.);\n    \n    float iorR=1.15;\n    float iorY=1.16;\n    float iorG=1.18;\n    float iorC=1.22;\n    float iorB=1.22;\n    float iorP=1.22;\n    \n    float cr=uChromaticAberration;\n    float refra=uRefraction;\n    float sat=uSaturation;\n    \n    vec3 lightPos=uLightPosition;\n    float d=uDiffuse;\n    float s=uSpecular;\n    \n    float fr=uFresnel;\n    vec3 frCol=uFresnelColor;\n    \n    for(int i=0;i<SAMPLES;i++){\n        float slide=float(i)/float(SAMPLES)*.1;\n        \n        vec3 refractVecR=refract(vEyeVector,vNormal,(1./iorR));\n        vec3 refractVecY=refract(vEyeVector,vNormal,(1./iorY));\n        vec3 refractVecG=refract(vEyeVector,vNormal,(1./iorG));\n        vec3 refractVecC=refract(vEyeVector,vNormal,(1./iorC));\n        vec3 refractVecB=refract(vEyeVector,vNormal,(1./iorB));\n        vec3 refractVecP=refract(vEyeVector,vNormal,(1./iorP));\n        \n        float r=texture(uTexture,p+refractVecR.xy*(refra+slide*1.)*cr).x*.5;\n        \n        float y=(texture(uTexture,p+refractVecY.xy*(refra+slide*1.)*cr).x*2.+\n        texture(uTexture,p+refractVecY.xy*(refra+slide*1.)*cr).y*2.-\n        texture(uTexture,p+refractVecY.xy*(refra+slide*1.)*cr).z)/6.;\n        \n        float g=texture(uTexture,p+refractVecG.xy*(refra+slide*2.)*cr).y*.5;\n        \n        float c=(texture(uTexture,p+refractVecC.xy*(refra+slide*2.5)*cr).y*2.+\n        texture(uTexture,p+refractVecC.xy*(refra+slide*2.5)*cr).z*2.-\n        texture(uTexture,p+refractVecC.xy*(refra+slide*2.5)*cr).x)/6.;\n        \n        float b=texture(uTexture,p+refractVecB.xy*(refra+slide*3.)*cr).z*.5;\n        \n        float p=(texture(uTexture,p+refractVecP.xy*(refra+slide*1.)*cr).z*2.+\n        texture(uTexture,p+refractVecP.xy*(refra+slide*1.)*cr).x*2.-\n        texture(uTexture,p+refractVecP.xy*(refra+slide*1.)*cr).y)/6.;\n        \n        float R=r+(2.*p+2.*y-c)/3.;\n        float G=g+(2.*y+2.*c-p)/3.;\n        float B=b+(2.*c+2.*p-y)/3.;\n        \n        col.r+=R;\n        col.g+=G;\n        col.b+=B;\n        \n        col=saturation(col,sat);\n    }\n    \n    col/=float(SAMPLES);\n    \n    float lin=lighting(lightPos,vNormal,vEyeVector,d,s);\n    col+=vec3(lin);\n    \n    float F=fresnel2(vEyeVector,vNormal,fr);\n    col+=vec3(F)*frCol;\n    \n    gl_FragColor=vec4(col,1.);\n}\n",defines:{SAMPLES:l},uniforms:{uTexture:{value:null},uFBOResolution:{value:new r(y.width,y.height)},uChromaticAberration:{value:c},uRefraction:{value:d},uSaturation:{value:u},uLightPosition:{value:p},uDiffuse:{value:f},uSpecular:{value:m},uFresnel:{value:g},uFresnelColor:{value:v}}});this.material=w,this.oldBg=null;const b=this.app.signal.onAppRender.add((()=>{this.update()}));this.material.addEventListener("removed",(()=>b())),this.parent&&this.parent.addEventListener("removed",(()=>b()))}update(){const{fbo:e,fboBack:t}=this;this.oldBg=this.app.scene.background,this.background&&(this.app.scene.background=this.background),this.parent.visible=!1;const i=this.parent.material;let n=this.app.renderer.getRenderTarget();this.backside&&(this.app.renderer.setRenderTarget(t),this.app.renderer.render(this.app.scene,this.app.camera),i.uniforms.uTexture.value=t.texture,i.side=d,this.parent.visible=!0),this.app.renderer.setRenderTarget(e),this.app.renderer.render(this.app.scene,this.app.camera),i.uniforms.uTexture.value=e.texture,i.side=D,this.app.scene.background=this.oldBg,this.app.renderer.setRenderTarget(n),this.parent.visible=!0}}const XA="csm_DiffuseColor",QA="csm_Normal",qA="csm_Roughness",ZA="csm_Metalness",KA="csm_Emissive",JA="csm_AO",$A="csm_Bump",eE="csm_Clearcoat",tE="csm_ClearcoatRoughness",iE="csm_ClearcoatNormal",nE="csm_PointSize",sE="csm_FragColor",rE="csm_DepthAlpha",oE="csm_Position",aE="csm_PositionRaw",lE={[`${oE}`]:"*",[`${aE}`]:"*",[`${QA}`]:"*",[`${nE}`]:["PointsMaterial"],[`${XA}`]:"*",[`${sE}`]:"*",[`${KA}`]:["MeshStandardMaterial","MeshPhysicalMaterial"],[`${qA}`]:["MeshStandardMaterial","MeshPhysicalMaterial"],[`${ZA}`]:["MeshStandardMaterial","MeshPhysicalMaterial"],[`${JA}`]:["MeshStandardMaterial","MeshPhysicalMaterial","MeshBasicMaterial","MeshLambertMaterial","MeshPhongMaterial","MeshToonMaterial"],[`${$A}`]:["MeshLambertMaterial","MeshMatcapMaterial","MeshNormalMaterial","MeshPhongMaterial","MeshPhysicalMaterial","MeshStandardMaterial","MeshToonMaterial","ShadowMaterial"],[`${rE}`]:["MeshDepthMaterial"],[`${eE}`]:["MeshPhysicalMaterial"],[`${tE}`]:["MeshPhysicalMaterial"],[`${iE}`]:["MeshPhysicalMaterial"]},hE={"#include <lights_physical_fragment>":le.lights_physical_fragment},cE={[`${QA}`]:{"#include <beginnormal_vertex>":`\n    vec3 objectNormal = ${QA};\n    #ifdef USE_TANGENT\n\t    vec3 objectTangent = vec3( tangent.xyz );\n    #endif\n    `},[`${oE}`]:{"#include <begin_vertex>":`\n    vec3 transformed = ${oE};\n  `},[`${aE}`]:{"#include <begin_vertex>":`\n    vec4 csm_internal_positionUnprojected = ${aE};\n    mat4x4 csm_internal_unprojectMatrix = projectionMatrix * modelViewMatrix;\n    #ifdef USE_INSTANCING\n      csm_internal_unprojectMatrix = csm_internal_unprojectMatrix * instanceMatrix;\n    #endif\n    csm_internal_positionUnprojected = inverse(csm_internal_unprojectMatrix) * csm_internal_positionUnprojected;\n    vec3 transformed = csm_internal_positionUnprojected.xyz;\n  `},[`${nE}`]:{"gl_PointSize = size;":`\n    gl_PointSize = ${nE};\n    `},[`${XA}`]:{"#include <color_fragment>":`\n    #include <color_fragment>\n    diffuseColor = ${XA};\n  `},[`${sE}`]:{"#include <dithering_fragment>":`\n    #include <dithering_fragment>\n    gl_FragColor  = ${sE};\n  `},[`${KA}`]:{"vec3 totalEmissiveRadiance = emissive;":`\n    vec3 totalEmissiveRadiance = ${KA};\n    `},[`${qA}`]:{"#include <roughnessmap_fragment>":`\n    #include <roughnessmap_fragment>\n    roughnessFactor = ${qA};\n    `},[`${ZA}`]:{"#include <metalnessmap_fragment>":`\n    #include <metalnessmap_fragment>\n    metalnessFactor = ${ZA};\n    `},[`${JA}`]:{"#include <aomap_fragment>":`\n    #include <aomap_fragment>\n    reflectedLight.indirectDiffuse *= 1. - ${JA};\n    `},[`${$A}`]:{"#include <normal_fragment_maps>":`\n    #include <normal_fragment_maps>\n\n    vec3 csm_internal_orthogonal = ${$A} - (dot(${$A}, normal) * normal);\n    vec3 csm_internal_projectedbump = mat3(csm_internal_vModelViewMatrix) * csm_internal_orthogonal;\n    normal = normalize(normal - csm_internal_projectedbump);\n    `},[`${rE}`]:{"gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );":`\n      gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity * ${rE} );\n    `,"gl_FragColor = packDepthToRGBA( fragCoordZ );":`\n      gl_FragColor = packDepthToRGBA( fragCoordZ );\n      gl_FragColor.a *= ${rE};\n    `},[`${eE}`]:{"material.clearcoat = clearcoat;":`material.clearcoat = ${eE};`},[`${tE}`]:{"material.clearcoatRoughness = clearcoatRoughness;":`material.clearcoatRoughness = ${tE};`},[`${iE}`]:{"#include <clearcoat_normal_fragment_begin>":"\n      vec3 csm_coat_internal_orthogonal = csm_ClearcoatNormal - (dot(csm_ClearcoatNormal, nonPerturbedNormal) * nonPerturbedNormal);\n      vec3 csm_coat_internal_projectedbump = mat3(csm_internal_vModelViewMatrix) * csm_coat_internal_orthogonal;\n      vec3 clearcoatNormal = normalize(nonPerturbedNormal - csm_coat_internal_projectedbump);\n    "}},dE={[`${oE}`]:{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( ${oE}, 1.0 );\n  `},[`${aE}`]:{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`\n    gl_Position = ${oE};\n  `},[`${XA}`]:{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`\n    gl_FragColor = ${XA};\n  `},[`${sE}`]:{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`\n    gl_FragColor = ${sE};\n  `}},uE={clearcoat:[eE,iE,tE]},pE=(e,t,i)=>e.split(t).join(i),fE=(e,t)=>{return new RegExp(`\\b${i=t,i.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}\\b`).test(e);var i};function mE(e){const t=e.toString().trim();return 0===t.substring(t.indexOf("{")+1,t.lastIndexOf("}")).trim().length}function gE(e){return e?e.replace(/\s/g,""):void 0}function vE(e){return e.replace(/\/\*\*(.*?)\*\/|\/\/(.*?)\n/gm,"")}class yE extends he{constructor(e){var{baseMaterial:t,fragmentShader:i,vertexShader:n,uniforms:s,patchMap:r,cacheKey:a,silent:l}=e,h=Yv(e,["baseMaterial","fragmentShader","vertexShader","uniforms","patchMap","cacheKey","silent"]);let c;if(function(e){try{new e}catch(e){if(e.message.indexOf("is not a constructor")>=0)return!1}return!0}(t)?c=new t(h):(c=t,Object.assign(c,h)),"RawShaderMaterial"===c.type)throw new Error("CustomShaderMaterial does not support RawShaderMaterial");super(),function(e,t,i=!1){Object.assign(e,t);const n=Object.getPrototypeOf(t);Object.entries(Object.getOwnPropertyDescriptors(n)).filter((e=>{const t="function"==typeof e[1].get,i="function"==typeof e[1].set,n="function"==typeof e[1].value,s="constructor"===e[0];return(t||i||n)&&!s})).forEach((t=>{"function"!=typeof e[t[0]]?Object.defineProperty(e,t[0],t[1]):i||console.warn(`Function ${t[0]} already exists on CSM. Overriding.`)}))}(this,c,l),this.__csm={patchMap:r||{},fragmentShader:i||"",vertexShader:n||"",cacheKey:a,baseMaterial:t,instanceID:o.generateUUID(),type:c.type,isAlreadyExtended:!mE(c.onBeforeCompile),cacheHash:"",silent:l},this.uniforms=Object.assign(Object.assign({},this.uniforms||{}),s||{});{const{fragmentShader:e,vertexShader:t}=this.__csm,i=this.uniforms;this.__csm.cacheHash=this._getCacheHash(),this._generateMaterial(e,t,i)}}update(e={}){this.uniforms=e.uniforms||this.uniforms,Object.assign(this.__csm,e);const{fragmentShader:t,vertexShader:i}=this.__csm,n=this.uniforms,s=this._getCacheHash();this.__csm.cacheHash=s,this._generateMaterial(t,i,n)}clone(){const e={baseMaterial:this.__csm.baseMaterial,fragmentShader:this.__csm.fragmentShader,vertexShader:this.__csm.vertexShader,uniforms:this.uniforms,silent:this.__csm.silent,patchMap:this.__csm.patchMap,cacheKey:this.__csm.cacheKey},t=new this.constructor(e);return Object.assign(this,t),t}_getCacheHash(){const{fragmentShader:e,vertexShader:t}=this.__csm,i=this.uniforms,n=[gE(e),gE(t),i].filter((e=>void 0!==e));return n.length>0?(s=n,yv(Object.keys(s).join(","))):this.customProgramCacheKey();var s}_generateMaterial(e,t,i){this.uniforms=i||{},this.customProgramCacheKey=()=>this.__csm.cacheHash;const n=i=>{try{const n=this._getMaterialDefine();if(e){const t=this._patchShader(vE(e),i.fragmentShader,!0);i.fragmentShader=n+t}if(t){const e=this._patchShader(vE(t),i.vertexShader);i.vertexShader="#define IS_VERTEX;\n"+e,i.vertexShader=n+i.vertexShader}i.uniforms=Object.assign(Object.assign({},i.uniforms),this.uniforms),this.uniforms=i.uniforms}catch(e){console.error(e)}};if(this.__csm.isAlreadyExtended){const e=this.onBeforeCompile;this.onBeforeCompile=(t,i)=>{e(t,i),n(t)}}else this.onBeforeCompile=n;this.needsUpdate=!0}_patchShader(e,t,i){let n=t;const s=Object.assign(Object.assign({},this._getPatchMapForMaterial()),this.__csm.patchMap);Object.entries(uE).forEach((([t,i])=>{const n=i.find((t=>fE(e,t)));if(n&&!this[t])throw new Error(`CSM: Property "${t}" is required to use output "${n}". Shader cannot compile.`)})),Object.entries(hE).forEach((([e,t])=>{n=pE(n,e,t)})),Object.keys(s).forEach((t=>{Object.keys(s[t]).forEach((i=>{const r=lE[t],o=this.__csm.type;if("*"===t||fE(e,t)){if(!(!r||Array.isArray(r)&&r.includes(o)||"*"===r))throw new Error(`CSM: ${t} is not available in ${o}. Shader cannot compile.`);n=pE(n,i,s[t][i])}}))}));const r="csm_main_"+this.__csm.instanceID.replace(/-/g,"_"),o=e.replace(/void\s+main\s*\(\s*\)/g,`void ${r}()`),a=e.includes("void main()"),l=n.includes("// #_CSM_#");return a&&(l&&this.__csm.isAlreadyExtended?(n=n.replace("void main() {",`\n            ${o}\n            \n            void main() {\n          `),n=function(e,t,i){const n=e.lastIndexOf("// #_CSM_#");return-1===n?e:e.substring(0,n)+i+e.substring(n+10)}(n,0,`\n            ${r}();\n            // #_CSM_#\n          `)):n=n.replace("void main() {",`\n            #ifndef CSM_IS_HEAD_DEFAULTS_DEFINED\n              \n    varying mat4 csm_internal_vModelViewMatrix;\n\n              #define CSM_IS_HEAD_DEFAULTS_DEFINED 1\n            #endif\n    \n            \n    \n#ifdef IS_VERTEX\n    vec3 csm_Position;\n    vec4 csm_PositionRaw;\n    vec3 csm_Normal;\n\n    // csm_PointSize\n    #ifdef IS_POINTSMATERIAL\n        float csm_PointSize;\n    #endif\n#else\n    vec4 csm_DiffuseColor;\n    vec4 csm_FragColor;\n\n    // csm_Emissive, csm_Roughness, csm_Metalness\n    #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL\n        vec3 csm_Emissive;\n        float csm_Roughness;\n        float csm_Metalness;\n        \n        #if defined IS_MESHPHYSICALMATERIAL\n            float csm_Clearcoat;\n            float csm_ClearcoatRoughness;\n            vec3 csm_ClearcoatNormal;\n        #endif\n    #endif\n\n    // csm_AO\n    #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL || defined IS_MESHBASICMATERIAL || defined IS_MESHLAMBERTMATERIAL || defined IS_MESHPHONGMATERIAL || defined IS_MESHTOONMATERIAL\n        float csm_AO;\n    #endif\n\n    // csm_Bump\n    #if defined IS_MESHLAMBERTMATERIAL || defined IS_MESHMATCAPMATERIAL || defined IS_MESHNORMALMATERIAL || defined IS_MESHPHONGMATERIAL || defined IS_MESHPHYSICALMATERIAL || defined IS_MESHSTANDARDMATERIAL || defined IS_MESHTOONMATERIAL || defined IS_SHADOWMATERIAL \n        vec3 csm_Bump;\n    #endif\n\n    float csm_DepthAlpha;\n#endif\n\n    \n            ${o}\n            \n            void main() {\n              #ifndef CSM_IS_DEFAULTS_DEFINED\n                \n\n#ifdef IS_VERTEX\n    // csm_Position & csm_PositionRaw\n    #ifdef IS_UNKNOWN\n        csm_Position = vec3(0.0);\n        csm_PositionRaw = vec4(0.0);\n        csm_Normal = vec3(0.0);\n    #else\n        csm_Position = position;\n        csm_PositionRaw = projectionMatrix * modelViewMatrix * vec4(position, 1.);\n        csm_Normal = normal;\n    #endif\n\n    // csm_PointSize\n    #ifdef IS_POINTSMATERIAL\n        csm_PointSize = size;\n    #endif\n#else\n    // csm_DiffuseColor & csm_FragColor\n    #if defined IS_UNKNOWN || defined IS_SHADERMATERIAL || defined IS_MESHDEPTHMATERIAL || defined IS_MESHNORMALMATERIAL || defined IS_SHADOWMATERIAL\n        csm_DiffuseColor = vec4(1.0, 0.0, 1.0, 1.0);\n        csm_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n    #else\n        #ifdef USE_MAP\n            vec4 _csm_sampledDiffuseColor = texture2D(map, vMapUv);\n\n            #ifdef DECODE_VIDEO_TEXTURE\n            _csm_sampledDiffuseColor = vec4(mix(pow(_csm_sampledDiffuseColor.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), _csm_sampledDiffuseColor.rgb * 0.0773993808, vec3(lessThanEqual(_csm_sampledDiffuseColor.rgb, vec3(0.04045)))), _csm_sampledDiffuseColor.w);\n            #endif\n\n            csm_DiffuseColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;\n            csm_FragColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;\n        #else\n            csm_DiffuseColor = vec4(diffuse, opacity);\n            csm_FragColor = vec4(diffuse, opacity);\n        #endif\n    #endif\n\n    // csm_Emissive, csm_Roughness, csm_Metalness\n    #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL\n        csm_Emissive = emissive;\n        csm_Roughness = roughness;\n        csm_Metalness = metalness;\n\n        #if defined IS_MESHPHYSICALMATERIAL\n            #ifdef USE_CLEARCOAT\n                csm_Clearcoat = clearcoat;\n                csm_ClearcoatRoughness = clearcoatRoughness;\n            #else\n                csm_Clearcoat = 0.0;\n                csm_ClearcoatRoughness = 0.0;\n            #endif\n        #endif\n    #endif\n\n    // csm_AO\n    #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL || defined IS_MESHBASICMATERIAL || defined IS_MESHLAMBERTMATERIAL || defined IS_MESHPHONGMATERIAL || defined IS_MESHTOONMATERIAL\n        csm_AO = 0.0;\n    #endif\n\n    // csm_Bump\n    #if defined IS_MESHLAMBERTMATERIAL || defined IS_MESHMATCAPMATERIAL || defined IS_MESHNORMALMATERIAL || defined IS_MESHPHONGMATERIAL || defined IS_MESHPHYSICALMATERIAL || defined IS_MESHSTANDARDMATERIAL || defined IS_MESHTOONMATERIAL || defined IS_SHADOWMATERIAL \n        csm_Bump = vec3(0.0);\n    #endif\n\n    csm_DepthAlpha = 1.0;\n#endif\n\n                #define CSM_IS_DEFAULTS_DEFINED 1\n              #endif\n              \n              #ifndef CSM_IS_MAIN_DEFAULTS_DEFINED\n                ${i?"\n    \n":"\n    csm_internal_vModelViewMatrix = modelViewMatrix;\n"}\n                #define CSM_IS_MAIN_DEFAULTS_DEFINED 1\n              #endif\n  \n              ${r}();\n              // #_CSM_#\n          `)),n}_getMaterialDefine(){const e=this.__csm.type;return e?`#define IS_${e.toUpperCase()};\n`:"#define IS_UNKNOWN;\n"}_getPatchMapForMaterial(){return"ShaderMaterial"===this.__csm.type?dE:cE}}const xE=(e,t)=>{var i,n,r,o,a,l,h,c,d,u,p,f,m,g;let v=t.min,y=t.max;if(null!==(i=t.axis)&&void 0!==i||(t.axis=e.isMapMode?"Z":"Y"),t.object)if(t.object.isMesh){const{geometry:e}=t.object;e.computeBoundingBox(),e.computeBoundingSphere(),y=e.boundingBox.max,v=e.boundingBox.min}else{let i=dW(t.object,null===(n=t.boxinLocalSpace)||void 0===n||n,e);v=i.min,y=i.max}t.opacity=null!==(r=t.opacity)&&void 0!==r?r:.8;let x={};return"Z"==t.axis?x.AXIS_DIR_Z=1:"X"==t.axis&&(x.AXIS_DIR_X=1),new yE(Object.assign({baseMaterial:new ce,vertexShader:"\nvarying vec4 vPosition;\nvoid main(){\n\tvPosition=modelMatrix*vec4(position,1.);\n\tcsm_Position=position*vec3(1.);\n}",fragmentShader:"\nuniform mat4 modelMatrix;\nvarying vec4 vPosition;\nuniform vec3 uMax;\nuniform vec3 uMin;\nuniform float uOpacity;\nuniform float uLightScale;\nuniform vec3 uLightColor;\nuniform vec3 uColor;\nuniform float uCircleTime;\nuniform float uTime;\nuniform vec3 uTopColor;\nuniform bool uGradient;\nuniform float uHeightScale;\nuniform float uHeightOffset;\nuniform float uTopOpacity;\nuniform float uLightCount;\nvec4 uMax_world;\nvec4 uMin_world;\nvoid main(){\n\tuMax_world = modelMatrix*vec4(uMax,1.);\n\tuMin_world = modelMatrix*vec4(uMin,1.);\n\tvec3 mColor=uColor;\n\tfloat tm=uTime-floor(uTime/uCircleTime)*uCircleTime;\n\tfloat rate = tm / uCircleTime;\n   \n    #ifdef AXIS_DIR_Z\n        float vMax_world = uMax_world.z;\n        float vMin_world = uMin_world.z;\n        float vPositionVal = vPosition.z;\n    #else \n        #ifdef AXIS_DIR_X\n            float vMax_world = uMax_world.x;\n            float vMin_world = uMin_world.x;\n            float vPositionVal = vPosition.x;\n        #else\n            float vMax_world = uMax_world.y;\n            float vMin_world = uMin_world.y;\n            float vPositionVal = vPosition.y;\n        #endif\n    #endif\n    float segLen = (vMax_world-vMin_world) / uLightCount;\n    float lightOffset=rate*segLen;\n    float curSeg = floor((vPositionVal - vMin_world)/ segLen);\n    float dist = vMin_world+lightOffset + curSeg * segLen;\n    float lightOffset2 = -(1. - rate)*segLen;\n    float dist2 = vMin_world+lightOffset2 + curSeg * segLen;\n    float lightBorderWidth = uLightScale;\n    if (lightBorderWidth > 0.) {\n        lightBorderWidth = lightBorderWidth *  (vMax_world-vMin_world);\n    } else {\n        lightBorderWidth =-lightBorderWidth;\n    }\n    if(dist<vPositionVal&&dist+lightBorderWidth>vPositionVal || dist2<vPositionVal&&dist2+lightBorderWidth>vPositionVal){\n        csm_DiffuseColor=vec4(uLightColor,uOpacity);\n    }else{\n        csm_DiffuseColor=vec4(mColor,uOpacity);\n    }\n    \n\tif(uGradient){\n        #ifdef AXIS_DIR_Z\n            float rateHight=(vPosition.z-uMin_world.z)/(uMax_world.z-uMin_world.z);\n        #else \n            #ifdef AXIS_DIR_X\n             float rateHight=(vPosition.x-uMin_world.x)/(uMax_world.x-uMin_world.x);\n            #else \n             float rateHight=(vPosition.y-uMin_world.y)/(uMax_world.y-uMin_world.y);\n            #endif\n        #endif\n\t\tfloat mixNumber=clamp(rateHight * uHeightScale + uHeightOffset,0.,1.);\n\t\tvec3 outColor=mix(csm_DiffuseColor.xyz,uTopColor,mixNumber);\n        float alpha = mix(uOpacity, uTopOpacity, rateHight);\n\t\tcsm_DiffuseColor=vec4(outColor,alpha);\n\t}\n}\n",silent:!0,defines:x,uniforms:{uMax:{value:y},uMin:{value:v},uLightScale:{value:null!==(o=t.lightScale)&&void 0!==o?o:.1},uCircleTime:{value:null!==(a=t.circleTime)&&void 0!==a?a:5},uHeightScale:{value:null!==(l=t.heightScale)&&void 0!==l?l:1},uHeightOffset:{value:null!==(h=t.heightOffset)&&void 0!==h?h:0},uLightCount:{value:null!==(c=t.uLightCount)&&void 0!==c?c:1},uColor:{value:new s(null!==(d=t.color)&&void 0!==d?d:"#e523ff")},uOpacity:{value:t.opacity},uTopOpacity:{value:null!==(p=null!==(u=t.topOpacity)&&void 0!==u?u:t.opacity)&&void 0!==p?p:1},uLightColor:{value:new s(null!==(f=t.lightColor)&&void 0!==f?f:"#ffffff")},uTopColor:{value:new s(null!==(m=t.topColor)&&void 0!==m?m:"#ffff00")},uTime:e.commonUniforms.iTime,uGradient:{value:null===(g=t.gradient)||void 0===g||g}},transparent:t.opacity<1,side:I},t))},wE=Zw({uRadius:100,uColor:new s("#ffff00"),uSpeed:2,uSectorAngle:200,uEdge:1,uTime:0},"\n      varying vec3 vPosition;\n\tvoid main() {\n\t\tvPosition = position;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n      ","\n  uniform float uRadius;     \n  uniform float uTime;            \n  uniform float uSpeed; \n  uniform float uEdge;\n  uniform float uSectorAngle; \n  uniform vec3 uColor;\n  varying vec3 vPosition;\n\n  float getAngle(vec3 pos){\n    float sAngle;\n    const vec3 ox = vec3(1,0,0);\n    float vDot = pos.x * ox.x + pos.y*ox.y;\n    float pos_length = length(pos); \n    float ox_length = length(ox);\n    float val = vDot / (pos_length * ox_length);\n    sAngle = acos(val);\n    sAngle = degrees(sAngle);\n    if(pos.y > 0.0) {\n        sAngle = -sAngle + 360.0;\n    }\n    float scanAngle = uTime * uSpeed * 100. - floor(uTime * uSpeed * 100. / 360.0) * 360.0;\n    float angle = scanAngle - sAngle;\n    if(angle < 0.0){\n      angle = angle + 360.0;\n    }\n    return angle;\n  }\n  void main() {\n\t\tif(length(vPosition) == 0.0 || length(vPosition) > uRadius - uEdge){\n\t\t\tgl_FragColor = vec4( uColor, 1.0 );\n\t\t} else {\n\t\t\tfloat angle = getAngle(vPosition);\n\t\t\tif(angle >= uSectorAngle){\n\t\t\t\tgl_FragColor = vec4( uColor, 0.0 ); \n\t\t\t} else {\n                float opacity =  1.0 - angle / uSectorAngle; \n\t\t\t\tgl_FragColor = vec4( uColor, 1.0 * opacity );  \n\t\t\t}\n\t\t}\n\t}\n      ");class bE extends a{constructor(e,t={}){super(),this.vertexShader="\n      #define STANDARD\n      varying vec3 vViewPosition;\n      #ifdef USE_TRANSMISSION\n      varying vec3 vWorldPosition;\n      #endif\n    \n      varying vec2 vUv;\n      varying vec4 vPos;\n      varying vec3 vNormalW;\n      varying vec3 vPositionW;\n\n      #include <common>\n      #include <uv_pars_vertex>\n      #include <envmap_pars_vertex>\n      #include <color_pars_vertex>\n      #include <fog_pars_vertex>\n      #include <morphtarget_pars_vertex>\n      #include <skinning_pars_vertex>\n      #include <logdepthbuf_pars_vertex>\n      #include <clipping_planes_pars_vertex>\n\n      void main() {\n        \n        #include <uv_vertex>\n        #include <color_vertex>\n        #include <morphcolor_vertex>\n      \n        #if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n      \n          #include <beginnormal_vertex>\n          #include <morphnormal_vertex>\n          #include <skinbase_vertex>\n          #include <skinnormal_vertex>\n          #include <defaultnormal_vertex>\n      \n        #endif\n      \n        #include <begin_vertex>\n        #include <morphtarget_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n        #include <logdepthbuf_vertex>\n        #include <clipping_planes_vertex>\n      \n        #include <worldpos_vertex>\n        #include <envmap_vertex>\n        #include <fog_vertex>\n\n        mat4 modelViewProjectionMatrix = projectionMatrix * modelViewMatrix;\n\n        vUv = uv;\n        vPos = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );\n        vPositionW = vec3( vec4( transformed, 1.0 ) * modelMatrix);\n        vNormalW = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );\n        \n        gl_Position = modelViewProjectionMatrix * vec4( transformed, 1.0 );\n\n      }",this.fragmentShader=" \n      varying vec2 vUv;\n      varying vec3 vPositionW;\n      varying vec4 vPos;\n      varying vec3 vNormalW;\n      \n      uniform float time;\n      uniform float fresnelOpacity;\n      uniform float scanlineSize;\n      uniform float fresnelAmount;\n      uniform float signalSpeed;\n      uniform float hologramBrightness;\n      uniform float hologramOpacity;\n      uniform bool blinkFresnelOnly;\n      uniform bool enableBlinking;\n      uniform vec3 hologramColor;\n\n      float flicker( float amt, float time ) {return clamp( fract( cos( time ) * 43758.5453123 ), amt, 1.0 );}\n      float random(in float a, in float b) { return fract((cos(dot(vec2(a,b) ,vec2(12.9898,78.233))) * 43758.5453)); }\n\n      void main() {\n        vec2 vCoords = vPos.xy;\n        vCoords /= vPos.w;\n        vCoords = vCoords * 0.5 + 0.5;\n        vec2 myUV = fract( vCoords );\n\n        vec4 hologramColor = vec4(hologramColor, mix(hologramBrightness, vUv.y, 0.5));\n        float scanlines = 10.;\n        scanlines += 20. * sin(time *signalSpeed * 20.8 - myUV.y * 60. * scanlineSize);\n        scanlines *= smoothstep(1.3 * cos(time *signalSpeed + myUV.y * scanlineSize), 0.78, 0.9);\n        scanlines *= max(0.25, sin(time *signalSpeed) * 1.0);        \n        \n        float r = random(vUv.x, vUv.y);\n        float g = random(vUv.y * 20.2, \tvUv.y * .2);\n        float b = random(vUv.y * .9, \tvUv.y * .2);\n\n        hologramColor += vec4(r*scanlines, b*scanlines, r, 1.0) / 84.;\n        vec4 scanlineMix = mix(vec4(0.0), hologramColor, hologramColor.a);\n\n        vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n        float fresnelEffect = dot(viewDirectionW, vNormalW) * (1.6 - fresnelOpacity/2.);\n        fresnelEffect = clamp(fresnelAmount - fresnelEffect, 0., fresnelOpacity);\n\n        float blinkValue = enableBlinking ? 0.6 - signalSpeed : 1.0;\n        float blink = flicker(blinkValue, time * signalSpeed * .02);\n    \n        vec3 finalColor;\n\n        if(blinkFresnelOnly){\n          finalColor = scanlineMix.rgb + fresnelEffect * blink;\n        }else{\n          finalColor = scanlineMix.rgb * blink + fresnelEffect;\n        }\n\n        gl_FragColor = vec4( finalColor, hologramOpacity);\n\n      }",this.uniforms={time:e.commonUniforms.iTime,fresnelOpacity:new X(void 0!==t.fresnelOpacity?t.fresnelOpacity:1),fresnelAmount:new X(void 0!==t.fresnelAmount?t.fresnelAmount:.45),scanlineSize:new X(void 0!==t.scanlineSize?t.scanlineSize:8),hologramBrightness:new X(void 0!==t.hologramBrightness?t.hologramBrightness:1),signalSpeed:new X(void 0!==t.signalSpeed?t.signalSpeed:1),hologramColor:new X(void 0!==t.hologramColor?new s(t.hologramColor):new s("#00d5ff")),enableBlinking:new X(void 0===t.enableBlinking||t.enableBlinking),blinkFresnelOnly:new X(void 0===t.blinkFresnelOnly||t.blinkFresnelOnly),hologramOpacity:new X(void 0!==t.hologramOpacity?t.hologramOpacity:1)},this.setValues(qw(t)),this.depthTest=void 0!==t.depthTest&&t.depthTest,this.blending=void 0!==t.blendMode?t.blendMode:de,this.transparent=!0,this.side=void 0!==t.side?t.side:D}}var _E="\n\nfloat random(vec2 co) {\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt = dot(co.xy, vec2(a, b));\n    float sn = mod(dt, 3.14);\n    return fract(sin(sn) * c);\n}\n\n\nvec3 dither(vec3 color) {\n    // Calculate grid position\n    float grid_position = random(gl_FragCoord.xy);\n\n    // Shift the individual colors differently, thus making it even harder to see the dithering pattern\n    vec3 dither_shift_RGB = vec3(0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0);\n\n    // Modify shift acording to grid position\n    dither_shift_RGB = mix(2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position);\n\n    // Shift the color by dither_shift\n    return color + dither_shift_RGB;\n}\n";const SE=`\nprecision highp float;\n\nuniform sampler2D tReflect;\nuniform vec3 uColor;\nuniform float uReflectivity;\nuniform float uMirror;\nuniform float uMixStrength;\n\n#ifdef USE_MAP\n    uniform sampler2D tMap;\n#endif\n\n#ifdef USE_NORMALMAP\n    uniform sampler2D tNormalMap;\n    uniform vec2 uNormalScale;\n#endif\n\n#ifdef USE_FOG\n    uniform vec3 uFogColor;\n    uniform float uFogNear;\n    uniform float uFogFar;\n#endif\n\nin vec2 vUv;\nin vec4 vCoord;\nin vec3 vNormal;\nin vec3 vToEye;\n\nout vec4 FragColor;\n\n${_E}\n\nvoid main() {\n    #ifdef USE_MAP\n        vec4 color = texture(tMap, vUv);\n    #else\n        vec4 color = vec4(uColor, 1.0);\n    #endif\n\n    #ifdef USE_NORMALMAP\n        vec4 normalColor = texture(tNormalMap, vUv * uNormalScale);\n        vec3 normal = normalize(vec3(normalColor.r * 2.0 - 1.0, normalColor.b, normalColor.g * 2.0 - 1.0));\n        vec3 coord = vCoord.xyz / vCoord.w;\n        vec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n        vec4 reflectColor = texture(tReflect, uv);\n    #else\n        vec3 normal = vNormal;\n        vec4 reflectColor = textureProj(tReflect, vCoord);\n    #endif\n\n    // Fresnel term\n    vec3 toEye = normalize(vToEye);\n    float theta = max(dot(toEye, normal), 0.0);\n    float reflectance = uReflectivity + (1.0 - uReflectivity) * pow((1.0 - theta), 5.0);\n\n    reflectColor = mix(vec4(0), reflectColor, reflectance);\n\n    FragColor.rgb = color.rgb * ((1.0 - min(1.0, uMirror)) + reflectColor.rgb * uMixStrength);\n\n    #ifdef USE_FOG\n        float fogDepth = gl_FragCoord.z / gl_FragCoord.w;\n        float fogFactor = smoothstep(uFogNear, uFogFar, fogDepth);\n\n        FragColor.rgb = mix(FragColor.rgb, uFogColor, fogFactor);\n    #endif\n\n    #ifdef DITHERING\n        FragColor.rgb = dither(FragColor.rgb);\n    #endif\n\n    FragColor.a = 1.0;\n}\n`;class ME extends ue{constructor({color:e=new s(1052688),map:t=null,normalMap:i=null,normalScale:o=new r(1,1),reflectivity:a=0,mirror:l=0,mixStrength:h=10,fog:c=null,dithering:d=!1}={}){const u={glslVersion:pe,defines:{},uniforms:{tMap:{value:null},tReflect:{value:null},uMapTransform:{value:new fe},uMatrix:{value:new n},uColor:{value:e instanceof s?e:new s(e)},uReflectivity:{value:a},uMirror:{value:l},uMixStrength:{value:h}},vertexShader:"\nin vec3 position;\nin vec3 normal;\nin vec2 uv;\n\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n\nuniform mat3 uMapTransform;\nuniform mat4 uMatrix;\n\nout vec2 vUv;\nout vec4 vCoord;\nout vec3 vNormal;\nout vec3 vToEye;\n\nvoid main() {\n    vUv = (uMapTransform * vec3(uv, 1.0)).xy;\n    vCoord = uMatrix * vec4(position, 1.0);\n    vNormal = normalMatrix * normal;\n\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n    vToEye = cameraPosition - worldPosition.xyz;\n\n    vec4 mvPosition = viewMatrix * worldPosition;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",fragmentShader:SE,blending:Q};t&&(t.updateMatrix(),u.defines=Object.assign(u.defines,{USE_MAP:""}),u.uniforms=Object.assign(u.uniforms,{tMap:{value:t},uMapTransform:{value:t.matrix}})),i&&(u.defines=Object.assign(u.defines,{USE_NORMALMAP:""}),u.uniforms=Object.assign(u.uniforms,{tNormalMap:{value:i},uNormalScale:{value:o}}),t||(i.updateMatrix(),u.uniforms=Object.assign(u.uniforms,{uMapTransform:{value:i.matrix}}))),c&&(u.defines=Object.assign(u.defines,{USE_FOG:""}),u.uniforms=Object.assign(u.uniforms,{uFogColor:{value:c.color},uFogNear:{value:c.near},uFogFar:{value:c.far}})),d&&(u.defines=Object.assign(u.defines,{DITHERING:""})),super(u)}}const CE=`\nprecision highp float;\n\nuniform sampler2D tMap;\nuniform sampler2D tReflect;\nuniform sampler2D tReflectBlur;\nuniform float uReflectivity;\n\nin vec2 vUv;\nin vec4 vCoord;\nin vec3 vNormal;\nin vec3 vToEye;\n\nout vec4 FragColor;\n\n${_E}\n\nvoid main() {\n    vec2 reflectionUv = vCoord.xy / vCoord.w;\n\n    vec4 dudv = texture(tMap, vUv);\n    vec4 color = texture(tReflect, reflectionUv);\n\n    vec4 blur;\n\n    blur = texture(tReflectBlur, reflectionUv + dudv.rg / 256.0);\n    color = mix(color, blur, smoothstep(1.0, 0.1, dudv.g));\n\n    blur = texture(tReflectBlur, reflectionUv);\n    color = mix(color, blur, smoothstep(0.5, 1.0, dudv.r));\n\n    FragColor = color * mix(0.6, 0.75, dudv.g);\n\n    // Fresnel term\n    vec3 toEye = normalize(vToEye);\n    float theta = max(dot(toEye, vNormal), 0.0);\n    float reflectance = uReflectivity + (1.0 - uReflectivity) * pow((1.0 - theta), 5.0);\n\n    FragColor = mix(vec4(0), FragColor, reflectance);\n\n    #ifdef DITHERING\n        FragColor.rgb = dither(FragColor.rgb);\n    #endif\n\n    FragColor.a = 1.0;\n}\n`;class AE extends ue{constructor({map:e=null,reflectivity:t=0,dithering:i=!1}={}){const s={glslVersion:pe,defines:{DITHERING:i},uniforms:{tMap:{value:null},tReflect:{value:null},tReflectBlur:{value:null},uMapTransform:{value:new fe},uMatrix:{value:new n},uReflectivity:{value:t}},vertexShader:"\nin vec3 position;\nin vec3 normal;\nin vec2 uv;\n\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n\nuniform mat3 uMapTransform;\nuniform mat4 uMatrix;\n\nout vec2 vUv;\nout vec4 vCoord;\nout vec3 vNormal;\nout vec3 vToEye;\n\nvoid main() {\n    vUv = (uMapTransform * vec3(uv, 1.0)).xy;\n    vCoord = uMatrix * vec4(position, 1.0);\n    vNormal = normalMatrix * normal;\n\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n    vToEye = cameraPosition - worldPosition.xyz;\n\n    vec4 mvPosition = viewMatrix * worldPosition;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",fragmentShader:CE,blending:Q};e&&(e.updateMatrix(),s.uniforms=Object.assign(s.uniforms,{tMap:{value:e},uMapTransform:{value:e.matrix}})),super(s)}}var EE,TE,PE,OE;const DE=new P,BE=new y,IE=new B,RE=new E,kE=new n,LE=new i;function zE(e,t,i,n){return BE.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),BE.multiplyScalar(1/BE.w),BE.x=i/n.width,BE.y=i/n.height,BE.applyMatrix4(e.projectionMatrixInverse),BE.multiplyScalar(1/BE.w),Math.abs(Math.max(BE.x,BE.y))}class UE extends me{raycast(e,t){var n,s,o,a,l;if(this.isMapMode)return super.raycast(e,t);const{geometry:h,matrixWorld:c}=this,d=e.camera,u=null!==(s=null===(n=e.params.Points)||void 0===n?void 0:n.threshold)&&void 0!==s?s:0,p=(null!==(o=this.userData.RaycasterThreshold)&&void 0!==o?o:6)+u,f=new r(null!==(a=this.userData.resolutionX)&&void 0!==a?a:window.innerWidth,null!==(l=this.userData.resolutionY)&&void 0!==l?l:window.innerHeight);{null===h.boundingSphere&&h.computeBoundingSphere(),DE.copy(h.boundingSphere).applyMatrix4(c);const t=zE(d,Math.max(d.near,DE.distanceToPoint(IE.origin))+DE.radius,p,f);if(DE.radius+=t,!e.ray.intersectsSphere(DE))return}{null===h.boundingBox&&h.computeBoundingBox(),RE.copy(h.boundingBox).applyMatrix4(c);const t=zE(d,Math.max(d.near,RE.distanceToPoint(IE.origin)),p,f);if(RE.max.x+=t,RE.max.y+=t,RE.max.z+=t,RE.min.x-=t,RE.min.y-=t,RE.min.z-=t,!e.ray.intersectsBox(RE))return}kE.copy(c).invert(),IE.copy(e.ray).applyMatrix4(kE);const{attributes:{position:m},drawRange:g}=h;for(let n=Math.max(0,g.start),s=Math.min(m.count,g.start+g.count);n<s;n++){LE.fromBufferAttribute(m,n);const s=zE(d,Math.max(d.near,LE.distanceTo(IE.origin)),p,f),r=s*s,o=IE.distanceSqToPoint(LE);if(o<r){const s=new i;IE.closestPointToPoint(LE,s),s.applyMatrix4(c);const r=e.ray.origin.distanceTo(s);if(r<e.near||r>e.far)return;t.push({distance:r,distanceToRay:Math.sqrt(o),point:s,index:n,object:this})}}}}class FE extends Sy{constructor(e,t){var i,n,s,r;super(e),EE.add(this),TE.set(this,0),PE.set(this,0),this._symbolData=t.data,this.useBvh=null===(i=t.useBvh)||void 0===i||i;let o=t.style||{};o.vertexBorderColor=null===(n=o.vertexBorderColor)||void 0===n||n,o.vertexSize=null===(s=o.vertexSize)||void 0===s||s,o.vertexColors=null===(r=o.vertexColors)||void 0===r||r,this.style=o,this.geometry=new S,qv(this,EE,"m",OE).call(this),this.material=xA(o),!0===t.pixelRaycasting?this.symbol=new UE(this.geometry,this.material):this.symbol=new me(this.geometry,this.material),this.entity.onEntityAwake((e=>{e.isMapMode&&(!0===t.pixelRaycasting&&(this.symbol.isMapMode=!0),this.symbol.pointsThreshold=t=>{if(!this.app)return;let i=this.app.map;return kW(i.pixelToGeoLength(Math.max(qv(this,PE,"f"),t),i.getZoom()),!1,e)})})),e.addObjects(this.symbol),this.addDispose((()=>{e.removeObjects(this.symbol),lW(this.symbol),this.symbol=null}))}get symbolObject(){return this.symbol}getData(){return this._symbolData}setData(e){this._symbolData=null!=e?e:this._symbolData,qv(this,EE,"m",OE).call(this)}updateStyle(e){this.material&&this.material.dispose(),this.material=xA(e),this.symbol.material=this.material}getItemDataByPointIndex(e,t){if(!(e<0||e>=this._symbolData.length))return t?this._symbolData[e]:Object.assign({},this._symbolData[e])}}TE=new WeakMap,PE=new WeakMap,EE=new WeakSet,OE=function(){var e,t,i;const n=[],r=[],o=[],a=[],l=new s;let h=!this.symbol,c=h,d=h,u=h,p=h;Zv(this,PE,Pv(this._symbolData.map((e=>{var t;return null!==(t=e.size)&&void 0!==t?t:0}))),"f");for(let s=0;s<this._symbolData.length;s++){if(!0===this._symbolData[s].hidden)continue;this._symbolData[s].id=null!==(e=this._symbolData[s].id)&&void 0!==e?e:(Zv(this,TE,(i=qv(this,TE,"f"),t=i++,i),"f"),t+"");let h=this._symbolData[s].position;if(n.push(h[0],h[1],h[2]),this.style.vertexColors&&(l.set(this._symbolData[s].highlightColor||this._symbolData[s].color||this.style.color||"#ff0"),r.push(l.r,l.g,l.b)),this.style.vertexBorderColor&&(l.set(this._symbolData[s].highlightBorderColor||this._symbolData[s].borderColor||this.style.borderColor||"#f00"),o.push(l.r,l.g,l.b)),this.style.vertexSize){let e=this._symbolData[s].highlightSize||this._symbolData[s].size||6;a.push(e)}}c||Bv(this.geometry.attributes.position.array,n)||(c=!0),!d&&this.style.vertexColors&&(Bv(this.geometry.attributes.color.array,r)||(d=!0)),!u&&this.style.vertexBorderColor&&(Bv(this.geometry.attributes.vBorderColor.array,o)||(u=!0)),!p&&this.style.vertexSize&&(Bv(this.geometry.attributes.vSize.array,a)||(p=!0)),c&&this.geometry.setAttribute("position",new M(n,3)),d&&this.style.vertexColors&&this.geometry.setAttribute("color",new M(r,3)),u&&this.style.vertexBorderColor&&this.geometry.setAttribute("vBorderColor",new M(o,3)),p&&this.style.vertexSize&&this.geometry.setAttribute("vSize",new M(a,1)),(!this.symbol||c)&&(this.useBvh&&this.geometry.getAttribute("position").array.length>300?this.geometry.computeBoundsTree():(this.geometry.disposeBoundsTree(),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere())),c&&(this.geometry.attributes.position.needsUpdate=!0),d&&this.style.vertexColors&&(this.geometry.attributes.color.needsUpdate=!0),u&&this.style.vertexBorderColor&&(this.geometry.attributes.vBorderColor.needsUpdate=!0),p&&this.style.vertexSize&&(this.geometry.attributes.vSize.needsUpdate=!0)},FE.moduleName="SymbolModule";const NE=1e20;class jE{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:n=.25,fontFamily:s="sans-serif",fontWeight:r="normal",fontStyle:o="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),h=this.ctx=l.getContext("2d",{willReadFrequently:!0});h.font=`${o} ${r} ${e}px ${s}`,h.textBaseline="alphabetic",h.textAlign="left",h.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:s,actualBoundingBoxRight:r}=this.ctx.measureText(e),o=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(r-s))),l=Math.min(this.size-this.buffer,o+Math.ceil(n)),h=a+2*this.buffer,c=l+2*this.buffer,d=Math.max(h*c,0),u=new Uint8ClampedArray(d),p={data:u,width:h,height:c,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:v}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+o);const y=f.getImageData(m,m,a,l);v.fill(NE,0,d),g.fill(0,0,d);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=y.data[4*(e*a+t)+3]/255;if(0===i)continue;const n=(e+m)*h+t+m;if(1===i)v[n]=0,g[n]=NE;else{const e=.5-i;v[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}VE(v,0,0,h,c,h,this.f,this.v,this.z),VE(g,m,m,a,l,h,this.f,this.v,this.z);for(let e=0;e<d;e++){const t=Math.sqrt(v[e])-Math.sqrt(g[e]);u[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}}function VE(e,t,i,n,s,r,o,a,l){for(let h=t;h<t+n;h++)HE(e,i*r+h,r,s,o,a,l);for(let h=i;h<i+s;h++)HE(e,h*r+t,1,n,o,a,l)}function HE(e,t,i,n,s,r,o){r[0]=0,o[0]=-NE,o[1]=NE,s[0]=e[t];for(let a=1,l=0,h=0;a<n;a++){s[a]=e[t+a*i];const n=a*a;do{const e=r[l];h=(s[a]-s[e]+n-e*e)/(a-e)/2}while(h<=o[l]&&--l>-1);l++,r[l]=a,o[l]=h,o[l+1]=NE}for(let a=0,l=0;a<n;a++){for(;o[l+1]<a;)l++;const n=r[l],h=a-n;e[t+a*i]=s[n]+h*h}}class WE extends ge{constructor(e={}){super(),this.options=e,this.alphabet="",this.atlasData={data:new Uint8ClampedArray,width:0,height:0,lineHeight:0,maxAscent:0,charInfo:{}};const t=" ".charCodeAt(0),i="~".charCodeAt(0);let n="�\n";for(let e=t;e<=i;e++)n+=String.fromCodePoint(e);this.update(n)}update(e){var t,i,n;let s=!1;for(const t of e)this.alphabet.includes(t)||(this.alphabet+=t,s=!0);if(!s)return;const r=1024,o=new Uint8ClampedArray(1048576),a=null!==(t=this.options.fontSize)&&void 0!==t?t:48,l=Math.ceil(a/16),h=new jE({fontSize:a,buffer:l,radius:Math.ceil(a/4),fontFamily:null!==(i=this.options.fontFamily)&&void 0!==i?i:"monospace"}),c={};let d=0,u=0,p=0,f=0,m=0;for(const e of this.alphabet){if(null!=c[e])throw new Error(`Duplicate character in alphabet: ${e} (${null!==(n=e.codePointAt(0))&&void 0!==n?n:"undefined"})`);const t=h.draw(e);if(d+t.width>=r&&(d=0,u+=p,p=0),u+t.height>=1024)throw new Error(`Unable to fit all ${this.alphabet.length} characters in font atlas`);p=Math.max(p,t.height),f=Math.max(f,p);for(let e=0;e<t.height;e++)o.set(t.data.subarray(t.width*e,t.width*(e+1)),r*(u+e)+d);c[e]={atlasX:d,atlasY:u,width:t.width,height:t.height,yOffset:t.glyphTop,xAdvance:Math.max(t.glyphAdvance,t.width-l)},m=Math.max(m,t.glyphTop),d+=t.width}this.atlasData={data:o,width:r,height:1024,charInfo:c,maxAscent:m,lineHeight:f},this.dispatchEvent({type:"atlasChange"})}layout(e){var t;const i=[];let n=0,s=0,r=0,o=0;for(const a of e)if("\n"===a)s+=this.atlasData.lineHeight,n=0;else{const e=null!==(t=this.atlasData.charInfo[a])&&void 0!==t?t:this.atlasData.charInfo["�"];i.push({left:n,top:s-e.yOffset+this.atlasData.maxAscent,boxTop:s,boxHeight:this.atlasData.lineHeight,width:e.width,height:e.height,xAdvance:e.xAdvance,atlasX:e.atlasX,atlasY:e.atlasY}),n+=e.xAdvance,r=Math.max(r,n),o=Math.max(o,s+this.atlasData.lineHeight)}return{chars:i,width:r,height:o}}}var GE,YE,XE;const QE=new r;class qE extends ue{constructor(e){var t,i,n,s,r,o;super({glslVersion:pe,vertexShader:"precision highp float;\nprecision highp int;\nuniform mat4 projectionMatrix, modelViewMatrix, modelMatrix;\n\nuniform bool uBillboard;\nuniform bool uSizeAttenuation;\nuniform float uScale;\nuniform vec2 uLabelSize;\nuniform vec2 uTextureSize;\nuniform vec2 uAnchorPoint;\nuniform vec2 uCanvasSize;\n\nin vec2 uv;\nin vec3 position;\nin vec2 instanceBoxPosition, instanceCharPosition;\nin vec2 instanceUv;\nin vec2 instanceBoxSize, instanceCharSize;\nout mediump vec2 vUv;\nout mediump vec2 vInsideChar;\nout mediump vec2 vPosInLabel;\nvoid main() {\n  vec2 boxUv = (uv * instanceBoxSize - (instanceCharPosition - instanceBoxPosition)) / instanceCharSize;\n  vInsideChar = boxUv;\n  vUv = (instanceUv + boxUv * instanceCharSize) / uTextureSize;\n  vec2 vertexPos = (instanceBoxPosition + position.xy * instanceBoxSize - uAnchorPoint * uLabelSize) * uScale;\n  vPosInLabel = (instanceBoxPosition + position.xy * instanceBoxSize);\n\n  if (uBillboard) {\n    if (uSizeAttenuation) {\n      vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n      mvPosition.xy += vertexPos;\n      gl_Position = projectionMatrix * mvPosition;\n    } else {\n      vec4 mvPosition = modelViewMatrix * vec4(0., 0., 0., 1.);\n\n      vec2 scale;\n      scale.x = length(vec3(modelMatrix[0].xyz));\n      scale.y = length(vec3(modelMatrix[1].xyz));\n\n      gl_Position = projectionMatrix * mvPosition;\n\n      gl_Position.xy += vertexPos * 2. / uCanvasSize * scale * gl_Position.w;\n    }\n  } else {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPos, 0.0, 1.0);\n  }\n}\n",fragmentShader:!0===e.picking?"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\nuniform vec4 objectId;\nout vec4 outColor;\nvoid main() {\n  outColor = objectId;\n}\n":`#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\nuniform sampler2D uMap;\nuniform mediump vec4 uColor, uBackgroundColor;\nuniform float uScale;\nuniform vec2 uLabelSize;\nin mediump vec2 vUv;\nin mediump vec2 vPosInLabel;\nin mediump vec2 vInsideChar;\nout vec4 outColor;\n\n${null!==(t=le.colorspace_pars_fragment)&&void 0!==t?t:le.encodings_pars_fragment}\n\nfloat aastep(float threshold, float value) {\n  float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;\n  return smoothstep(threshold - afwidth, threshold + afwidth, value);\n}\n\nvoid main() {\n  float dist = texture(uMap, vUv).a;\n  vec4 color = uBackgroundColor * (1.0 - dist) + uColor * dist;\n  outColor = mix(uBackgroundColor, uColor, aastep(0.75, dist));\n\n  bool insideChar = vInsideChar.x >= 0.0 && vInsideChar.x <= 1.0 && vInsideChar.y >= 0.0 && vInsideChar.y <= 1.0;\n  outColor = insideChar ? outColor : uBackgroundColor;\n  //outColor = LinearTosRGB(outColor); // assumes output encoding is srgb\n}\n`,uniforms:{objectId:{value:[NaN,NaN,NaN,NaN]},uAnchorPoint:{value:[.5,.5]},uBillboard:{value:!1},uSizeAttenuation:{value:!0},uLabelSize:{value:[0,0]},uCanvasSize:{value:[0,0]},uScale:{value:0},uTextureSize:{value:[null!==(n=null===(i=e.atlasTexture)||void 0===i?void 0:i.image.width)&&void 0!==n?n:0,null!==(r=null===(s=e.atlasTexture)||void 0===s?void 0:s.image.height)&&void 0!==r?r:0]},uMap:{value:e.atlasTexture},uColor:{value:[0,0,0,1]},uBackgroundColor:{value:[1,1,1,1]}},side:I,transparent:!1,depthWrite:!0}),this.picking=null!==(o=e.picking)&&void 0!==o&&o}}class ZE extends j{computeBoundingSphere(){var e;this.geometry.computeBoundingSphere();const t=this.geometry.boundingSphere;t&&(null!==(e=this.boundingSphere)&&void 0!==e?e:this.boundingSphere=new P).copy(t)}}class KE extends u{constructor(e){super(),GE.add(this),this.labelPool=e,this.text="",this.lineHeight=1,this._needsUpdateLayout=!1,this.geometry=new ve,this.geometry.setAttribute("position",JE.QUAD_POSITIONS),this.geometry.setAttribute("uv",JE.QUAD_UVS),this.instanceAttrData=new Float32Array,this.instanceAttrBuffer=new ye(this.instanceAttrData,10,1),this.instanceBoxPosition=new xe(this.instanceAttrBuffer,2,0),this.instanceCharPosition=new xe(this.instanceAttrBuffer,2,2),this.instanceUv=new xe(this.instanceAttrBuffer,2,4),this.instanceBoxSize=new xe(this.instanceAttrBuffer,2,6),this.instanceCharSize=new xe(this.instanceAttrBuffer,2,8),this.geometry.setAttribute("instanceBoxPosition",this.instanceBoxPosition),this.geometry.setAttribute("instanceCharPosition",this.instanceCharPosition),this.geometry.setAttribute("instanceUv",this.instanceUv),this.geometry.setAttribute("instanceBoxSize",this.instanceBoxSize),this.geometry.setAttribute("instanceCharSize",this.instanceCharSize),this.material=new qE({atlasTexture:e.atlasTexture}),this.pickingMaterial=new qE({picking:!0}),this.mesh=new ZE(this.geometry,this.material,0),this.mesh.userData.pickingMaterial=this.pickingMaterial,this.mesh.onBeforeRender=(e,t,i,n,s,r)=>{e.getSize(QE),this.material.uniforms.uCanvasSize.value[0]=QE.x,this.material.uniforms.uCanvasSize.value[1]=QE.y,this.pickingMaterial.uniforms.uCanvasSize.value[0]=QE.x,this.pickingMaterial.uniforms.uCanvasSize.value[1]=QE.y},this.add(this.mesh),e.addEventListener("scaleFactorChange",(()=>{this.setLineHeight(this.lineHeight)})),e.addEventListener("atlasChange",(()=>{this._handleAtlasChange()})),this._handleAtlasChange()}_handleAtlasChange(){this.material.uniforms.uTextureSize.value[0]=this.labelPool.atlasTexture.image.width,this.material.uniforms.uTextureSize.value[1]=this.labelPool.atlasTexture.image.height,this.setLineHeight(this.lineHeight),this._needsUpdateLayout=!0,this._updateLayoutIfNeeded()}dispose(){this.geometry.dispose(),this.material.dispose(),this.pickingMaterial.dispose(),this.mesh.dispose()}reallocateAttributeBufferIfNeeded(e){const t=10*e*Float32Array.BYTES_PER_ELEMENT;this.instanceAttrData.byteLength<t&&(this.instanceAttrData=new Float32Array(t),this.instanceAttrBuffer=new ye(this.instanceAttrData,10,1),this.instanceBoxPosition.data=this.instanceAttrBuffer,this.instanceCharPosition.data=this.instanceAttrBuffer,this.instanceUv.data=this.instanceAttrBuffer,this.instanceBoxSize.data=this.instanceAttrBuffer,this.instanceCharSize.data=this.instanceAttrBuffer)}setText(e){e!==this.text&&(this.text=e,this._needsUpdateLayout=!0,this.labelPool.updateAtlas(e),this._updateLayoutIfNeeded())}_updateLayoutIfNeeded(){if(!this._needsUpdateLayout)return;const e=this.labelPool.fontManager.layout(this.text);this.material.uniforms.uLabelSize.value[0]=e.width,this.material.uniforms.uLabelSize.value[1]=e.height,this.pickingMaterial.uniforms.uLabelSize.value[0]=e.width,this.pickingMaterial.uniforms.uLabelSize.value[1]=e.height,this.geometry.instanceCount=this.mesh.count=e.chars.length,this.reallocateAttributeBufferIfNeeded(e.chars.length);let t=0;for(const i of e.chars)this.instanceAttrData[t++]=i.left,this.instanceAttrData[t++]=e.height-i.boxTop-i.boxHeight,this.instanceAttrData[t++]=i.left,this.instanceAttrData[t++]=e.height-i.boxTop-i.boxHeight+i.top-i.boxTop,this.instanceAttrData[t++]=i.atlasX,this.instanceAttrData[t++]=i.atlasY,this.instanceAttrData[t++]=i.xAdvance,this.instanceAttrData[t++]=i.boxHeight,this.instanceAttrData[t++]=i.width,this.instanceAttrData[t++]=i.height;this.instanceAttrBuffer.needsUpdate=!0,this._needsUpdateLayout=!1}setColor(e,t,i,n=1){this.material.uniforms.uColor.value[0]=e,this.material.uniforms.uColor.value[1]=t,this.material.uniforms.uColor.value[2]=i,this.material.uniforms.uColor.value[3]=n,qv(this,GE,"m",YE).call(this)}setBackgroundColor(e,t,i,n=1){this.material.uniforms.uBackgroundColor.value[0]=e,this.material.uniforms.uBackgroundColor.value[1]=t,this.material.uniforms.uBackgroundColor.value[2]=i,this.material.uniforms.uBackgroundColor.value[3]=n,qv(this,GE,"m",YE).call(this)}setBillboard(e){this.material.uniforms.uBillboard.value=e,this.pickingMaterial.uniforms.uBillboard.value=e}setSizeAttenuation(e){this.material.uniforms.uSizeAttenuation.value=e,this.pickingMaterial.uniforms.uSizeAttenuation.value=e}setAnchorPoint(e,t){this.material.uniforms.uAnchorPoint.value[0]=e,this.material.uniforms.uAnchorPoint.value[1]=t,this.pickingMaterial.uniforms.uAnchorPoint.value[0]=e,this.pickingMaterial.uniforms.uAnchorPoint.value[1]=t}setLineHeight(e){this.lineHeight=e;const t=this.lineHeight*this.labelPool.scaleFactor/this.labelPool.fontManager.atlasData.lineHeight;this.material.uniforms.uScale.value=t,this.pickingMaterial.uniforms.uScale.value=t}}GE=new WeakSet,YE=function(){const e=this.material.uniforms.uBackgroundColor.value[3],t=this.material.uniforms.uColor.value[3],i=e<1||t<1;this.material.transparent=i,this.material.depthWrite=!i};class JE extends ge{setScaleFactor(e){this.scaleFactor=e,this.dispatchEvent({type:"scaleFactorChange"})}constructor(e={}){super(),this.availableLabels=[],this.disposed=!1,this.scaleFactor=1,this.fontManager=new WE(e),this.atlasTexture=new we(new Uint8ClampedArray,0,0,U,F,be,Y,Y,N,N),this.fontManager.addEventListener("atlasChange",(()=>{this._updateAtlasTexture()})),this._updateAtlasTexture()}updateAtlas(e){this.fontManager.update(e)}_updateAtlasTexture(){const e=new Uint8ClampedArray(4*this.fontManager.atlasData.data.length);for(let t=0;t<this.fontManager.atlasData.data.length;t++)e[4*t+0]=e[4*t+1]=e[4*t+2]=1,e[4*t+3]=this.fontManager.atlasData.data[t];this.atlasTexture.image={data:e,width:this.fontManager.atlasData.width,height:this.fontManager.atlasData.height},this.atlasTexture.needsUpdate=!0,this.dispatchEvent({type:"atlasChange"})}acquire(){var e;return null!==(e=this.availableLabels.pop())&&void 0!==e?e:new KE(this)}release(e){this.disposed?e.dispose():(e.removeFromParent(),this.availableLabels.push(e))}dispose(){for(const e of this.availableLabels)e.dispose();this.atlasTexture.dispose(),this.disposed=!0}}let $E;XE=JE,JE.QUAD_POINTS=[[0,0,0],[0,1,0],[1,0,0],[1,0,0],[0,1,0],[1,1,0]],JE.QUAD_POSITIONS=new O(new Float32Array(XE.QUAD_POINTS.flat()),3),JE.QUAD_UVS=new O(new Float32Array(XE.QUAD_POINTS.flatMap((([e,t])=>[e,1-t]))),2);const eT=e=>{var t,i,n,r,o,a;let l=e.labelPool;l||($E||($E=new JE),l=$E);let h=l.acquire();h.setSizeAttenuation(null===(t=e.sizeAttenuation)||void 0===t||t),h.setLineHeight(null!==(i=e.lineHeight)&&void 0!==i?i:1);let c=new s(null!==(n=e.color)&&void 0!==n?n:"#0ff");if(h.setColor(c.r,c.g,c.b),e.backgroundColor){let t=new s(e.backgroundColor);h.setBackgroundColor(t.r,t.g,t.b,null!==(r=e.backgroundOpacity)&&void 0!==r?r:1)}else h.setBackgroundColor(0,0,0,0);return h.setAnchorPoint(...null!==(o=e.anchorPoint)&&void 0!==o?o:[0,0]),1!==e.backgroundOpacity&&(h.material.transparent=!0),void 0!==e.transparent&&(h.material.transparent=e.transparent),e.billboard&&h.setBillboard(e.billboard),e.position&&h.position.copy(Vv(e.position)),h.setText(null!==(a=e.text)&&void 0!==a?a:""),h};class tT extends h{constructor(e,t){super(void 0,t),this.pointerWidthRadius=[],this.updateGeometry(e)}computerMatrix(e,t,i){return tT.temp1Matrix4.identity(),tT.temp1Matrix4.multiply(tT.temp2Matrix4.lookAt(tT.temp1Vector3.set(e[0],e[1],e[2]),tT.temp2Vector3.set(t[0],e[1],t[2]),tT.temp3Vector3.set(0,1,0))),tT.temp1Matrix4.scale(tT.temp1Vector3.set(...i)),tT.temp1Matrix4.transpose().toArray()}computerGradient(e,t){e=e.filter((e=>"number"==typeof e));let i=Mv(t,0,1),n=e.length;for(let t=n-1;t>=0;t--){if(i===t/(n-1))return e[t];if(i>t/(n-1))return i-=t/(n-1),i*=1/((t+1)/(n-1)-t/(n-1)),(e[t+1]-e[t])*i+e[t]}return 0}computerPointerWidthRadius(e,t){e.length<2||(e.length<3&&(t=!1),this.pointerWidthRadius=[],e=fv(e),t&&Object.defineProperties(e,{[-1]:{value:e[e.length-1],configurable:!1,enumerable:!1,writable:!1},[e.length]:{value:e[0],configurable:!1,enumerable:!1,writable:!1}}),e.map(((n,s)=>{var r;const{vector3:o,radius:a=.1,segments:l=0,scale:h={x:1,y:1}}=n;if(e[s-1]&&e[s+1]){let t=tT.temp1Vector3.set(...o).sub(tT.tempVector3.set(...e[s-1].vector3)).normalize().clone(),n=tT.temp2Vector3.set(...e[s+1].vector3).sub(tT.tempVector3.set(...o)).normalize().clone(),c=t.clone().multiplyScalar(-1).angleTo(n),d=a/Math.tan(c/2),u=new i(...o).sub(t.clone().multiplyScalar(d)),p=new i(...o).add(n.clone().multiplyScalar(d)).clone().sub(u),f=a/Math.sin(c/2),m=n.clone().add(t).multiplyScalar(.5).sub(t).setLength(f).add(tT.tempVector3.set(...o)),g=tT.temp1Vector3.set(-t.z,0,t.x).angleTo(tT.temp2Vector3.set(n.x,0,n.z))<Math.PI/2;if(0===tT.temp1Vector3.set(t.x,0,t.z).angleTo(tT.temp2Vector3.set(n.x,0,n.z))){let{x:e=1,y:t=1}=h,i=this.pointerWidthRadius[this.pointerWidthRadius.length-1].matrix;this.pointerWidthRadius.push({vector3:o,matrix:tT.temp1Matrix4.identity().extractRotation(tT.temp2Matrix4.set(...i)).multiply(tT.temp3Matrix4.identity().scale(tT.temp1Vector3.set(1,t,e))).transpose().toArray()})}else if(0===l){let{x:e=1,y:t=1}=h;this.pointerWidthRadius.push({vector3:o,matrix:this.computerMatrix(g?m.toArray():o,g?o:m.toArray(),[1,t,e])})}else for(let t=0;t<=l;t++){let i=t*((Math.PI-c)/l),n=Math.PI-i-c/2,o=a*Math.sin(i)/Math.sin(n),d=p.clone().setLength(o).add(u).clone().sub(m).setLength(a).add(m),{x:f=1,y:v=1}=(null===(r=e[s-1])||void 0===r?void 0:r.scale)||{},{x:y=1,y:x=1}=e[s+1].scale||{},{x:w=1,y:b=1}=h;w=this.computerGradient([(f+w)/2,w,(w+y)/2],t/l),b=this.computerGradient([(v+b)/2,b,(b+x)/2],t/l),this.pointerWidthRadius.push({vector3:d.toArray(),matrix:this.computerMatrix(g?m.toArray():d.toArray(),g?d.toArray():m.toArray(),[1,b,w])})}}else if(s===e.length-1)if(t)this.pointerWidthRadius.push(this.pointerWidthRadius[0]);else{let e=this.pointerWidthRadius[this.pointerWidthRadius.length-1],t=tT.temp1Vector3.set(...o).sub(tT.temp3Vector3.set(...e.vector3)).normalize(),i=tT.temp2Vector3.set(t.z,0,-t.x).add(tT.temp3Vector3.set(...o)).toArray(),{x:n=1,y:s=1}=h;this.pointerWidthRadius.push({vector3:o,matrix:this.computerMatrix(o,i,[1,s,n])})}else{let{x:t=1,y:i=1}=h,n=tT.temp1Vector3.set(...e[s+1].vector3).sub(tT.temp2Vector3.set(...o)).normalize(),r=tT.temp1Vector3.set(n.z,0,-n.x).add(tT.temp2Vector3.set(...o)).toArray();this.pointerWidthRadius.push({vector3:o,matrix:this.computerMatrix(o,r,[1,i,t])})}})))}computerPathLength(e){let t=0;return e.map(((i,n)=>{n<e.length-1&&(tT.temp1Vector3.set(...i),tT.temp2Vector3.set(...e[n+1]),t+=tT.temp1Vector3.distanceTo(tT.temp2Vector3))})),t}setExtrudeMesh(e,t,i,n,s,r){let o=this.computerPathLength(r.map((e=>[...e,0]))),a=this.computerPathLength([e,i]),l=[],h=[];return r.map(((c,d)=>{if(d<r.length-1){let u=tT.tempVector3.set(0,c[1],-c[0]).applyMatrix4(tT.temp1Matrix4.set(...t)).add(tT.temp1Vector3.set(...e)).toArray(),p=tT.tempVector3.set(0,r[d+1][1],-r[d+1][0]).applyMatrix4(tT.temp1Matrix4.set(...t)).add(tT.temp1Vector3.set(...e)).toArray(),f=tT.tempVector3.set(0,r[d+1][1],-r[d+1][0]).applyMatrix4(tT.temp1Matrix4.set(...n)).add(tT.temp1Vector3.set(...i)).toArray(),m=tT.tempVector3.set(0,c[1],-c[0]).applyMatrix4(tT.temp1Matrix4.set(...n)).add(tT.temp1Vector3.set(...i)).toArray();l.push(...u,...p,...f,...u,...f,...m);let g=this.computerPathLength([r[0],...r.slice(0,d+1)].map((e=>[...e,0])))/o,v=this.computerPathLength([r[0],...r.slice(0,d+2)].map((e=>[...e,0])))/o,y=[s/o,g],x=[s/o,v],w=[(s+a)/o,v],b=[(s+a)/o,g];h.push(...y,...x,...w,...y,...w,...b)}})),{geometryPoint:l,uvPoint:h}}updateGeometry(e){if(e.isMapMode){e.paths.forEach((e=>{let t=e.vector3[1];e.vector3[1]=e.vector3[2],e.vector3[2]=t}));for(let t=0;t<e.shapePath.length;t++)e.shapePath[t][0]=-e.shapePath[t][0]}const{paths:t,shapePath:i,closed:n}=e;this.computerPointerWidthRadius(t,n);let s=[],r=[];for(let e=0;e<this.pointerWidthRadius.length-1;e++){let t=this.pointerWidthRadius[e],n=this.pointerWidthRadius[e+1],o=this.computerPathLength(this.pointerWidthRadius.slice(0,e+1).map((e=>e.vector3)));const{geometryPoint:a,uvPoint:l}=this.setExtrudeMesh(t.vector3,t.matrix,n.vector3,n.matrix,o,i);s.push(...a),r.push(...l)}let o=new S;if(e.isMapMode)for(let e=0;e<s.length;e+=3){let t=s[e+1];s[e+1]=s[e+2],s[e+2]=t}let a=new Float32Array(s),l=new O(a,3,!1);o.setAttribute("position",l);let h=new Float32Array(r),c=new O(h,2,!1);o.setAttribute("uv",c),o.computeVertexNormals(),this.geometry.dispose(),this.geometry=o,this.dispatchEvent({type:"loaded"})}}var iT,nT,sT,rT,oT,aT,lT,hT,cT,dT,uT,pT,fT,mT,gT,vT;tT.temp1Vector2=new r,tT.temp2Vector2=new r,tT.temp3Vector2=new r,tT.tempVector3=new i,tT.temp1Vector3=new i,tT.temp2Vector3=new i,tT.temp3Vector3=new i,tT.temp1Matrix4=new n,tT.temp2Matrix4=new n,tT.temp3Matrix4=new n;class yT extends S{constructor(){super(...arguments),iT.add(this),this.isMeshLineGeometry=!0,this.type="MeshLineGeometry",nT.set(this,new Float32Array),sT.set(this,new Float32Array),rT.set(this,new Float32Array),oT.set(this,new Float32Array),aT.set(this,new Float32Array),lT.set(this,new Float32Array),hT.set(this,new Uint16Array),cT.set(this,new Float32Array),this.widthCallback=null,dT.set(this,null),uT.set(this,[]),pT.set(this,null),fT.set(this,0),mT.set(this,0)}get points(){return qv(this,uT,"f")}set points(e){this.setPoints(e,this.widthCallback,this.smooth)}setPoints(e,t=null,n=!1,s=!0){var r,o;if(Zv(this,uT,e,"f"),Zv(this,pT,this.widthCallback,"f"),this.widthCallback=t,this.smooth=n,!("length"in e))throw new Error("not a Vector3 Array, or not a number Array or Float32Array with 3 numbers per point");if(!e.length)return this.dispose(),Zv(this,mT,0,"f"),void Zv(this,fT,0,"f");let a=!!((l=e).length&&l[0]instanceof i);var l;let h;if(n){let t=[];if(a)for(let i=0;i<e.length;i++)t.push([e[i].x,e[i].y,e[i].z]);else for(let i=0;i<e.length;i+=3)t.push([e[i],e[i+1],e[i+2]]);let i=[];for(let e=0;e<t.length;e++)if(this.widthCallback){let n=this.widthCallback(e/(t.length-1),e);i.push(n)}h=[];let n=[];t=jv(t,null!==(r=this.curvePointNum)&&void 0!==r?r:5,null!==(o=this.curvePointPosRatio)&&void 0!==o?o:.9,n),e=[];for(let s=0;s<t.length;s++)e.push(t[s][0]),e.push(t[s][1]),e.push(t[s][2]),h.push(i[n[s]]);Zv(this,uT,e,"f"),a=!1}if(a)Zv(this,mT,e.length,"f");else{if(e.length%3!=0)throw new Error("The array should consist of number triplets, 3 number per point.");Zv(this,mT,e.length/3,"f")}const c=qv(this,mT,"f"),d=qv(this,fT,"f")!==c,u=qv(this,pT,"f")!==this.widthCallback;let p;qv(this,dT,"f")&&!d||qv(this,iT,"m",gT).call(this,c),Zv(this,fT,c,"f");let f=0,m=0,g=0,v=0,y=0,x=0,w=0,b=0,_=0,S=0,M=0;if(a)for(let t=0;t<e.length;t++){const i=e[t];if(!i)throw new Error("point missing");({x:f,y:m,z:g}=i),_T(qv(this,nT,"f"),v,f,m,g),v+=6;const n=t/e.length;qv(this,cT,"f")[y+0]=n,qv(this,cT,"f")[y+1]=n,y+=2}else for(let t=0;t<e.length;t+=3){const i=e[t+0],n=e[t+1],s=e[t+2];if(null==i||null==n||null==s)throw new Error("point missing");_T(qv(this,nT,"f"),v,i,n,s),v+=6;const r=t/e.length;qv(this,cT,"f")[y+0]=r,qv(this,cT,"f")[y+1]=r,y+=2}let C=0;if(qv(this,iT,"m",vT).call(this,0,c-1)?(C=6*(c-2),f=qv(this,nT,"f")[C+0],m=qv(this,nT,"f")[C+1],g=qv(this,nT,"f")[C+2]):(C=0,f=qv(this,nT,"f")[C+0],m=qv(this,nT,"f")[C+1],g=qv(this,nT,"f")[C+2]),null==f||null==m||null==g)throw new Error("point missing");_T(qv(this,sT,"f"),x,f,m,g),x+=6;for(let e=0;e<c;e++){if(d&&(wT(qv(this,oT,"f"),b,1,-1),b+=2),(u||d)&&(p=this.widthCallback?n&&h?h[e]:this.widthCallback(e/(c-1),e):1,wT(qv(this,aT,"f"),_,p,p),_+=2),d&&(ST(qv(this,lT,"f"),M,e/(c-1),0,e/(c-1),1),M+=4),e<c-1){if(C=6*e,f=qv(this,nT,"f")[C+0],m=qv(this,nT,"f")[C+1],g=qv(this,nT,"f")[C+2],null==f||null==m||null==g)throw new Error("point missing");if(_T(qv(this,sT,"f"),x,f,m,g),x+=6,d){const t=2*e;bT(qv(this,hT,"f"),S,t+0,t+1,t+2),bT(qv(this,hT,"f"),S+3,t+2,t+1,t+3),S+=6}}if(e>0){if(C=6*e,f=qv(this,nT,"f")[C+0],m=qv(this,nT,"f")[C+1],g=qv(this,nT,"f")[C+2],null==f||null==m||null==g)throw new Error("point missing");_T(qv(this,rT,"f"),w,f,m,g),w+=6}}if(qv(this,iT,"m",vT).call(this,c-1,0)?(C=6,f=qv(this,nT,"f")[C+0],m=qv(this,nT,"f")[C+1],g=qv(this,nT,"f")[C+2]):(C=6*(c-1),f=qv(this,nT,"f")[C+0],m=qv(this,nT,"f")[C+1],g=qv(this,nT,"f")[C+2]),null==f||null==m||null==g)throw new Error("point missing");if(_T(qv(this,rT,"f"),w,f,m,g),!qv(this,dT,"f"))throw new Error("missing attributes");qv(this,dT,"f").position.needsUpdate=!0,qv(this,dT,"f").previous.needsUpdate=!0,qv(this,dT,"f").next.needsUpdate=!0,qv(this,dT,"f").side.needsUpdate=d,qv(this,dT,"f").width.needsUpdate=d,qv(this,dT,"f").uv.needsUpdate=d,qv(this,dT,"f").index.needsUpdate=d,s&&(this.computeBoundingSphere(),this.computeBoundingBox())}advance(e){if(!qv(this,dT,"f"))throw new Error("Call setPoints first.");const t=qv(this,dT,"f").position.array,i=qv(this,dT,"f").previous.array,n=qv(this,dT,"f").next.array,s=t.length;xT(t,0,i,0,s),xT(t,6,t,0,s-6),t[s-6]=e.x,t[s-5]=e.y,t[s-4]=e.z,t[s-3]=e.x,t[s-2]=e.y,t[s-1]=e.z,xT(t,6,n,0,s-6),n[s-6]=e.x,n[s-5]=e.y,n[s-4]=e.z,n[s-3]=e.x,n[s-2]=e.y,n[s-1]=e.z,qv(this,dT,"f").position.needsUpdate=!0,qv(this,dT,"f").previous.needsUpdate=!0,qv(this,dT,"f").next.needsUpdate=!0}}function xT(e,t,i,n,s){if(n+s>i.length)throw new Error("Not enough space to copy from src to dst.");for(let r=0,o=t+s;r+t<o;r++){const s=e[r+t];if(null==s)throw new Error("missing src value");i[r+n]=s}}function wT(e,t,i,n){e[t+0]=i,e[t+1]=n}function bT(e,t,i,n,s){e[t+0]=i,e[t+1]=n,e[t+2]=s}function _T(e,t,i,n,s){e[t+0]=i,e[t+1]=n,e[t+2]=s,e[t+3]=i,e[t+4]=n,e[t+5]=s}function ST(e,t,i,n,s,r){e[t+0]=i,e[t+1]=n,e[t+2]=s,e[t+3]=r}nT=new WeakMap,sT=new WeakMap,rT=new WeakMap,oT=new WeakMap,aT=new WeakMap,lT=new WeakMap,hT=new WeakMap,cT=new WeakMap,dT=new WeakMap,uT=new WeakMap,pT=new WeakMap,fT=new WeakMap,mT=new WeakMap,iT=new WeakSet,gT=function(e){this.dispose(),Zv(this,dT,{position:new O(Zv(this,nT,new Float32Array(6*e),"f"),3),previous:new O(Zv(this,sT,new Float32Array(6*e),"f"),3),next:new O(Zv(this,rT,new Float32Array(6*e),"f"),3),side:new O(Zv(this,oT,new Float32Array(2*e),"f"),1),width:new O(Zv(this,aT,new Float32Array(2*e),"f"),1),uv:new O(Zv(this,lT,new Float32Array(4*e),"f"),2),counters:new O(Zv(this,cT,new Float32Array(2*e),"f"),1),index:new O(Zv(this,hT,new Uint16Array(6*(e-1)),"f"),1)},"f"),this.setAttribute("position",qv(this,dT,"f").position),this.setAttribute("previous",qv(this,dT,"f").previous),this.setAttribute("next",qv(this,dT,"f").next),this.setAttribute("side",qv(this,dT,"f").side),this.setAttribute("width",qv(this,dT,"f").width),this.setAttribute("uv",qv(this,dT,"f").uv),this.setAttribute("counters",qv(this,dT,"f").counters),this.setIndex(qv(this,dT,"f").index)},vT=function(e,t){const i=6*e,n=6*t;return qv(this,nT,"f")[i+0]===qv(this,nT,"f")[n+0]&&qv(this,nT,"f")[i+1]===qv(this,nT,"f")[n+1]&&qv(this,nT,"f")[i+2]===qv(this,nT,"f")[n+2]},le.meshline_vert=`\n\t#include <common>\n\t#include <color_pars_vertex>\n\t#include <fog_pars_vertex>\n\t#include <logdepthbuf_pars_vertex>\n\t\n\tattribute vec3 previous;\n\tattribute vec3 next;\n\tattribute float side;\n\tattribute float width;\n\tattribute float counters;\n\t\n\tuniform vec2 resolution;\n\tuniform float lineWidth;\n\tuniform vec3 color;\n\tuniform float opacity;\n\tuniform float sizeAttenuation;\n\tuniform vec2 offset;\n\t\n\tvarying vec2 vUV;\n\tvarying vec4 vColor;\n\tvarying float vCounters;\n\t\n\tvec2 fix( vec4 i, float aspect ) {\n\t\n\t    vec2 res = i.xy / i.w;\n\t    res.x *= aspect;\n\t\t vCounters = counters;\n\t    return res;\n        \n\t}\n\t\n\tvoid main() {\n\t\n\t    float aspect = resolution.x / resolution.y;\n\t\n\t    vColor = vec4( color, opacity );\n\t\tvUV = uv + offset;\n\t\n\t    mat4 m = projectionMatrix * modelViewMatrix;\n\t    vec4 finalPosition = m * vec4( position, 1.0 );\n\t    vec4 prevPos = m * vec4( previous, 1.0 );\n\t    vec4 nextPos = m * vec4( next, 1.0 );\n\t\n\t    vec2 currentP = fix( finalPosition, aspect );\n\t    vec2 prevP = fix( prevPos, aspect );\n\t    vec2 nextP = fix( nextPos, aspect );\n\t\n\t    float w = lineWidth * width;\n\t\n\t    vec2 dir;\n\t    if( nextP == currentP ) dir = normalize( currentP - prevP );\n\t    else if( prevP == currentP ) dir = normalize( nextP - currentP );\n\t    else {\n\t        vec2 dir1 = normalize( currentP - prevP );\n\t        vec2 dir2 = normalize( nextP - currentP );\n\t        dir = normalize( dir1 + dir2 );\n\t\n\t        vec2 perp = vec2( -dir1.y, dir1.x );\n\t        vec2 miter = vec2( -dir.y, dir.x );\n\t        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );\n\t\n\t    }\n\t\n\t    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;\n\t    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );\n\t    normal.xy *= .5 * w;\n\t    normal *= projectionMatrix;\n\t    if( sizeAttenuation == 0. ) {\n\t        normal.xy *= finalPosition.w;\n\t        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;\n\t    }\n\t\n\t    finalPosition.xy += normal.xy * side;\n\t\n\t    gl_Position = finalPosition;\n\t\n        ${le.logdepthbuf_vertex}\n        ${le.fog_vertex&&"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );"}\n        ${le.fog_vertex}\n\t}\n`,le.meshline_frag=`\n\t#include <common>\n\t#include <dithering_pars_fragment>\n\t#include <color_pars_fragment>\n\t#include <logdepthbuf_pars_fragment>\n\t${le.color_pars_fragment}\n\tuniform sampler2D map;\n\tuniform sampler2D alphaMap;\n\tuniform float useMap;\n\tuniform float useAlphaMap;\n\tuniform float useDash;\n\tuniform float dashArray;\n\tuniform float dashOffset;\n\tuniform float dashRatio;\n\tuniform float visibility;\n\tuniform float alphaTest;\n\tuniform vec2 repeat;\n\tuniform vec4 time;\n\tuniform vec2 speed;\n\n\tvarying vec2 vUV;\n\tvarying vec4 vColor;\n\tvarying float vCounters;\n\t\n\tvoid main() {\n        ${le.logdepthbuf_fragment}\n\n\t    vec4 c = vColor;\n\t\tvec2 uv = vUV * repeat - time.x * speed;\n\t    if( useMap == 1. ) c *= texture2D( map, uv );\n\t    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, uv ).a;\n\t    if( c.a < alphaTest ) discard;\n\t    if( useDash == 1. ){\n\t        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));\n\t    }\n\t    gl_FragColor = c;\n\t    gl_FragColor.a *= step(vCounters, visibility);\n\t\n\t\t${le.colorspace_fragment}\n        ${le.fog_fragment}\n\t}\n`;class MT extends a{constructor(e){super({uniforms:Object.assign({},_e.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:!1},alphaMap:{value:null},useAlphaMap:{value:!1},color:{value:new s(16777215)},opacity:{value:1},resolution:{value:new r(1,1)},sizeAttenuation:{value:!0},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:!1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new r(1,1)},offset:{value:new r(0,0)},time:{value:new y(0,0,0,0)},speed:{value:new r(0,0)}}),vertexShader:le.meshline_vert,fragmentShader:le.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{fogColor:{enumerable:!0,get:()=>this.uniforms.fogColor.value,set:e=>{this.uniforms.fogColor.value=e}},fogDensity:{enumerable:!0,get:()=>this.uniforms.fogDensity.value,set:e=>{this.uniforms.fogDensity.value=e}},fogNear:{enumerable:!0,get:()=>this.uniforms.fogNear.value,set:e=>{this.uniforms.fogNear.value=e}},fogFar:{enumerable:!0,get:()=>this.uniforms.fogFar.value,set:e=>{this.uniforms.fogFar.value=e}},lineWidth:{enumerable:!0,get:()=>this.uniforms.lineWidth.value,set:e=>{this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get:()=>this.uniforms.map.value,set:e=>{this.uniforms.map.value=e}},useMap:{enumerable:!0,get:()=>this.uniforms.useMap.value,set:e=>{this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get:()=>this.uniforms.alphaMap.value,set:e=>{this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get:()=>this.uniforms.useAlphaMap.value,set:e=>{this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get:()=>this.uniforms.color.value,set:e=>{this.uniforms.color.value=e}},opacity:{enumerable:!0,get:()=>this.uniforms.opacity.value,set:e=>{this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:()=>this.uniforms.resolution.value,set:e=>{this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get:()=>this.uniforms.sizeAttenuation.value,set:e=>{this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get:()=>this.uniforms.dashArray.value,set:e=>{this.uniforms.dashArray.value=e,this.useDash=0!==e}},dashOffset:{enumerable:!0,get:()=>this.uniforms.dashOffset.value,set:e=>{this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get:()=>this.uniforms.dashRatio.value,set:e=>{this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get:()=>this.uniforms.useDash.value,set:e=>{this.uniforms.useDash.value=e}},visibility:{enumerable:!0,get:()=>this.uniforms.visibility.value,set:e=>{this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get:()=>this.uniforms.alphaTest.value,set:e=>{this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get:()=>this.uniforms.repeat.value,set:e=>{this.uniforms.repeat.value.copy(e)}},offset:{enumerable:!0,get:()=>this.uniforms.offset.value,set:e=>{this.uniforms.offset.value.copy(e)}},time:{enumerable:!0,get:()=>this.uniforms.time.value,set:e=>{this.uniforms.time.value.copy(e)}},speed:{enumerable:!0,get:()=>this.uniforms.speed.value,set:e=>{this.uniforms.speed.value.copy(e)}}}),(null==e?void 0:e.time)&&"value"in e.time&&(this.uniforms.time=e.time,delete e.time),(null==e?void 0:e.resolution)&&"value"in e.resolution&&(this.uniforms.resolution=e.resolution,delete e.resolution),this.setValues(e)}copy(e){return super.copy(this),this.fogColor=e.fogColor,this.fogDensity=e.fogDensity,this.fogNear=e.fogNear,this.fogFar=e.fogFar,this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this.offset.copy(e.offset),this.speed.copy(e.speed),this}}class CT extends h{constructor(){super(...arguments),this.isMeshLine=!0,this.type="MeshLine"}raycast(e,t){var s;const r=new n,o=new B,a=new P,l=new i,h=this.geometry;if(h.boundingSphere||h.computeBoundingSphere(),a.copy(h.boundingSphere),a.applyMatrix4(this.matrixWorld),!e.ray.intersectSphere(a,l))return;r.copy(this.matrixWorld).invert(),o.copy(e.ray).applyMatrix4(r);const c=new i,d=new i,u=new i,p=this instanceof L?2:1,f=h.index,m=h.attributes;if(null!==f){const i=f.array,n=m.position.array,r=m.width.array;for(let a=0,h=i.length-1;a<h;a+=p){const p=i[a],f=i[a+1];if(null==p||null==f)throw new Error("missing index");c.fromArray(n,3*p),d.fromArray(n,3*f);const m=void 0!==r[Math.floor(a/3)]?r[Math.floor(a/3)]:1;if(null==m)throw new Error("missing width");e.params.Line=null!==(s=e.params.Line)&&void 0!==s?s:{threshold:1};const g=e.params.Line.threshold+this.material.lineWidth*m/2,v=g*g;if(o.distanceSqToSegment(c,d,l,u)>v)continue;l.applyMatrix4(this.matrixWorld);const y=e.ray.origin.distanceTo(l);y<e.near||y>e.far||(t.push({distance:y,point:u.clone().applyMatrix4(this.matrixWorld),index:a,face:null,faceIndex:void 0,object:this}),a=h)}}}}class AT{constructor(){this.pos=new i,this.dir=new i,this.right=new i,this.up=new i,this.dist=0,this.widthScale=1,this.sharp=!1}lerpPathPoints(e,t,i){this.pos.lerpVectors(e.pos,t.pos,i),this.dir.lerpVectors(e.dir,t.dir,i),this.up.lerpVectors(e.up,t.up,i),this.right.lerpVectors(e.right,t.right,i),this.dist=(t.dist-e.dist)*i+e.dist,this.widthScale=(t.widthScale-e.widthScale)*i+e.widthScale}copy(e){this.pos.copy(e.pos),this.dir.copy(e.dir),this.up.copy(e.up),this.right.copy(e.right),this.dist=e.dist,this.widthScale=e.widthScale}}const ET=new i,TT=new i,PT=new i,OT=new n,DT=new Se;class BT{constructor(){this.array=[],this.count=0}set(e,t=.1,n=10,s=null,r=!1){if((e=e.slice(0)).length<2)return console.warn("PathPointList: points length less than 2."),void(this.count=0);r&&!e[0].equals(e[e.length-1])&&e.push((new i).copy(e[0]));for(let i=0,o=e.length;i<o;i++)if(0===i)this._start(e[i],e[i+1],s);else if(i===o-1)if(r){this._corner(e[i],e[1],t,n,s);const r=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=r}else this._end(e[i]);else this._corner(e[i],e[i+1],t,n,s)}distance(){return this.count>0?this.array[this.count-1].dist:0}_getByIndex(e){return this.array[e]||(this.array[e]=new AT),this.array[e]}_start(e,t,i){this.count=0;const n=this._getByIndex(this.count);if(n.pos.copy(e),n.dir.subVectors(t,e),i)n.up.copy(i);else{let e=Number.MAX_VALUE;const t=Math.abs(n.dir.x),i=Math.abs(n.dir.y),s=Math.abs(n.dir.z);t<e&&(e=t,n.up.set(1,0,0)),i<e&&(e=i,n.up.set(0,1,0)),s<e&&n.up.set(0,0,1)}n.right.crossVectors(n.dir,n.up).normalize(),n.up.crossVectors(n.right,n.dir).normalize(),n.dist=0,n.widthScale=1,n.sharp=!1,n.dir.normalize(),this.count++}_end(e){const t=this.array[this.count-1],i=this._getByIndex(this.count);i.pos.copy(e),i.dir.subVectors(e,t.pos);const n=i.dir.length();i.dir.normalize(),i.up.copy(t.up);const s=ET.crossVectors(t.dir,i.dir);if(s.length()>Number.EPSILON){s.normalize();const e=Math.acos(Math.min(Math.max(t.dir.dot(i.dir),-1),1));i.up.applyMatrix4(OT.makeRotationAxis(s,e))}i.right.crossVectors(i.dir,i.up).normalize(),i.dist=t.dist+n,i.widthScale=1,i.sharp=!1,this.count++}_corner(e,t,i,n,s){if(i>0&&n>0){const r=function(e,t,i,n,s,r){const o=ET.subVectors(t,e),a=TT.subVectors(i,t),l=o.length(),h=a.length();o.normalize(),a.normalize();const c=Math.min(.999999*(s?l/2:l),n);r.v0.copy(t).sub(o.multiplyScalar(c)),r.v1.copy(t);const d=Math.min(h/2*.999999,n);return r.v2.copy(t).add(a.multiplyScalar(d)),r}(this.array[this.count-1].pos,e,t,i,this.count-1==0,DT),o=r.getPoints(n);for(let e=0;e<n;e++)this._sharpCorner(o[e],o[e+1],s,0===e?1:0);o[n].equals(t)||this._sharpCorner(o[n],t,s,2)}else this._sharpCorner(e,t,s,0,!0)}_sharpCorner(e,t,i,n=0,s=!1){const r=this.array[this.count-1],o=this._getByIndex(this.count),a=ET.subVectors(e,r.pos),l=TT.subVectors(t,e),h=a.length();if(a.normalize(),l.normalize(),o.pos.copy(e),1===n?o.dir.copy(a):2===n?o.dir.copy(l):(o.dir.addVectors(a,l),o.dir.normalize()),i)1===o.dir.dot(i)?o.right.crossVectors(l,i).normalize():o.right.crossVectors(o.dir,i).normalize(),o.up.crossVectors(o.right,o.dir).normalize();else{o.up.copy(r.up);const e=PT.crossVectors(r.dir,o.dir);if(e.length()>Number.EPSILON){e.normalize();const t=Math.acos(Math.min(Math.max(r.dir.dot(o.dir),-1),1));o.up.applyMatrix4(OT.makeRotationAxis(e,t))}o.right.crossVectors(o.dir,o.up).normalize()}o.dist=r.dist+h;const c=a.dot(l);o.widthScale=Math.min(1/Math.sqrt((1+c)/2),1.415)||1,o.sharp=Math.abs(c-1)>.05&&s,this.count++}}class IT extends S{constructor(e=3e3,t=!1){super(),"object"==typeof e?this._initByData(e.pathPointList,e.options,e.usage,t):this._initByMaxVertex(e,t)}_initByMaxVertex(e,t){this.setAttribute("position",new O(new Float32Array(3*e),3).setUsage(Me)),this.setAttribute("normal",new O(new Float32Array(3*e),3).setUsage(Me)),this.setAttribute("uv",new O(new Float32Array(2*e),2).setUsage(Me)),t&&this.setAttribute("uv2",new O(new Float32Array(2*e),2).setUsage(Me)),this.drawRange.start=0,this.drawRange.count=0,this.setIndex(e>65536?new C(3*e,1):new Ce(3*e,1))}_initByData(e,t={},i,n){const s=RT(e,t,n);s&&0!==s.count?(this.setAttribute("position",new O(new Float32Array(s.position),3).setUsage(i||Ae)),this.setAttribute("normal",new O(new Float32Array(s.normal),3).setUsage(i||Ae)),this.setAttribute("uv",new O(new Float32Array(s.uv),2).setUsage(i||Ae)),n&&this.setAttribute("uv2",new O(new Float32Array(s.uv2),2).setUsage(i||Ae)),this.setIndex(s.position.length/3>65536?new C(s.indices,1):new Ce(s.indices,1))):this._initByMaxVertex(2,n)}update(e,t={}){const i=!!this.getAttribute("uv2"),n=RT(e,t,i);n?(this._updateAttributes(n.position,n.normal,n.uv,i?n.uv2:null,n.indices),this.drawRange.count=n.count):this.drawRange.count=0}_resizeAttribute(e,t){let i=this.getAttribute(e);for(;i.array.length<t;){const t=i.array.length,n=new O(new Float32Array(2*t),i.itemSize,i.normalized);n.name=i.name,n.usage=i.usage,this.setAttribute(e,n),i=n}}_resizeIndex(e){let t=this.getIndex();for(;t.array.length<e;){const e=t.array.length,i=new O(2*e>65535?new Uint32Array(2*e):new Uint16Array(2*e),1);i.name=t.name,i.usage=t.usage,this.setIndex(i),t=i}}_updateAttributes(e,t,i,n,s){this._resizeAttribute("position",e.length);const r=this.getAttribute("position");r.array.set(e,0),r.updateRange.count=e.length,r.needsUpdate=!0,this._resizeAttribute("normal",t.length);const o=this.getAttribute("normal");o.array.set(t,0),o.updateRange.count=t.length,o.needsUpdate=!0,this._resizeAttribute("uv",i.length);const a=this.getAttribute("uv");if(a.array.set(i,0),a.updateRange.count=i.length,a.needsUpdate=!0,n){this._resizeAttribute("uv2",n.length);const e=this.getAttribute("uv2");e.array.set(n,0),e.updateRange.count=n.length,e.needsUpdate=!0}this._resizeIndex(s.length);const l=this.getIndex();l.set(s,0),l.updateRange.count=s.length,l.needsUpdate=!0}}function RT(e,t,n=!1){const s=t.width||.1,r=void 0!==t.progress?t.progress:1,o=void 0===t.arrow||t.arrow,a=void 0!==t.side?t.side:"both",l=s/2,h="both"!==a?s/2:s,c=e.distance(),d=r*c;if(0==c)return null;const u=l/h,p=l/c;let f=0;const m=[],g=[],v=[],y=[],x=[];let w=0;const b=new i,_=new i,S=new i,M=new i,C=new i,A=new i;function E(e){const t=0===m.length,i=e.sharp&&!t,s=e.dist/h,r=e.dist/c,o=e.dir,d=e.up,E=e.right;if("left"!==a?b.copy(E).multiplyScalar(l*e.widthScale):b.set(0,0,0),"right"!==a?_.copy(E).multiplyScalar(-l*e.widthScale):_.set(0,0,0),b.add(e.pos),_.add(e.pos),i){S.fromArray(m,m.length-6).sub(_),M.fromArray(m,m.length-3).sub(b);const e=S.length()-M.length();let t,i;e>0?(t=S,i=_):(t=M,i=b),C.copy(t).setLength(Math.abs(e)).add(i);let a=A.copy(i).sub(C).normalize().dot(o)*A.copy(i).sub(C).length()*2;A.copy(o).setLength(a).add(C),e>0?(m.push(C.x,C.y,C.z,b.x,b.y,b.z,_.x,_.y,_.z,b.x,b.y,b.z,A.x,A.y,A.z,b.x,b.y,b.z),w+=6,x.push(w-6,w-8,w-7,w-6,w-7,w-5,w-4,w-6,w-5,w-2,w-4,w-1),f+=12):(m.push(_.x,_.y,_.z,C.x,C.y,C.z,_.x,_.y,_.z,b.x,b.y,b.z,_.x,_.y,_.z,A.x,A.y,A.z),w+=6,x.push(w-6,w-8,w-7,w-6,w-7,w-5,w-6,w-5,w-3,w-2,w-3,w-1),f+=12),g.push(d.x,d.y,d.z,d.x,d.y,d.z,d.x,d.y,d.z,d.x,d.y,d.z,d.x,d.y,d.z,d.x,d.y,d.z),v.push(s-u,0,s-u,1,s,0,s,1,s+u,0,s+u,1),n&&y.push(r-p,0,r-p,1,r,0,r,1,r+p,0,r+p,1)}else m.push(_.x,_.y,_.z,b.x,b.y,b.z),g.push(d.x,d.y,d.z,d.x,d.y,d.z),v.push(s,0,s,1),n&&y.push(r,0,r,1),w+=2,t||(x.push(w-2,w-4,w-3,w-2,w-3,w-1),f+=6)}const T=new i;let P;if(d>0)for(let t=0;t<e.count;t++){const i=e.array[t];if(i.dist>d){const n=e.array[t-1];P=new AT;const s=(d-n.dist)/(i.dist-n.dist);P.lerpPathPoints(n,i,s),E(P);break}E(i)}else P=e.array[0];return o&&(P=P||e.array[e.count-1],function(e){const t=e.dir,i=e.up,r=e.right,o=e.dist/h,d=e.dist/c;"left"!==a?b.copy(r).multiplyScalar(2*l):b.set(0,0,0),"right"!==a?_.copy(r).multiplyScalar(2*-l):_.set(0,0,0),T.copy(t).setLength(3*l),b.add(e.pos),_.add(e.pos),T.add(e.pos),m.push(_.x,_.y,_.z,b.x,b.y,b.z,T.x,T.y,T.z),g.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z),v.push(o,"both"!==a?"right"!==a?-2:0:-.5,o,"both"!==a?"left"!==a?2:0:1.5,o+1.5,"both"!==a?0:.5),n&&y.push(d,"both"!==a?"right"!==a?-2:0:-.5,d,"both"!==a?"left"!==a?2:0:1.5,d+1.5*s/c,"both"!==a?0:.5),w+=3,x.push(w-1,w-3,w-2),f+=3}(P)),{position:m,normal:g,uv:v,uv2:y,indices:x,count:f}}class kT extends IT{constructor(e=1e3,t=!1){super(e,t),"object"==typeof e&&e.options&&e.options.shape&&(this.options=e.options,this.options.radialSegments=Math.max(2,e.options.radialSegments||8),this.options.circleSegments=Math.max(2,e.options.circleSegments||16))}_initByData(e,t={},i,n){const s=LT(e,t,n);s&&0!==s.count?(this.setAttribute("position",new O(new Float32Array(s.position),3).setUsage(i||Ae)),this.setAttribute("normal",new O(new Float32Array(s.normal),3).setUsage(i||Ae)),this.setAttribute("uv",new O(new Float32Array(s.uv),2).setUsage(i||Ae)),n&&this.setAttribute("uv2",new O(new Float32Array(s.uv2),2).setUsage(i||Ae)),this.setIndex(s.position.length/3>65536?new C(s.indices,1):new Ce(s.indices,1))):this._initByMaxVertex(2,n)}update(e,t={}){const i=!!this.getAttribute("uv2"),n=LT(e,t,i);n?(this._updateAttributes(n.position,n.normal,n.uv,i?n.uv2:null,n.indices),this.drawRange.count=n.count):this.drawRange.count=0}sectDataParam(){let e=this.options.shape;return"arch"==e||"archHalf"==e?{ptCount:12,halfCount:7,halfStartIndex:0,halfEndIndex:5,halfIndex:1,posBaseIndex:[0,10],posLeftIndex:0,posRightIndex:10,posTopIndex:5,posLeftTopIndex:1,posRightTopIndex:9}:"rect"==e||"rectHalf"==e?{ptCount:6,halfCount:4,halfStartIndex:0,halfEndIndex:2,halfIndex:1,posBaseIndex:[0,4],posLeftIndex:0,posRightIndex:4,posTopIndex:2,posLeftTopIndex:1,posRightTopIndex:3}:"rectNoTop"==e||"rectNoTopHalf"==e?{ptCount:6,halfCount:3,halfStartIndex:0,halfEndIndex:1,halfIndex:1,posBaseIndex:[1,2],posLeftIndex:2,posRightIndex:1,posTopIndex:[1,2],posLeftTopIndex:3,posRightTopIndex:0,posHalfBaseIndex:0,posHalfLeftIndex:1,posHalfLeftTopIndex:2,posPtCount:4}:"custom"==e||"customHalf"==e?this.options.customSectDataParam:{ptCount:this.options.circleSegments+2,halfCount:this.options.circleSegments/2+1,halfStartIndex:0,halfEndIndex:this.options.circleSegments/2,halfIndex:0,posBaseIndex:[0,this.options.circleSegments/2],posLeftIndex:this.options.circleSegments/4,posRightIndex:3*this.options.circleSegments/4,posTopIndex:this.options.circleSegments/2,posLeftTopIndex:this.options.circleSegments/4+1,posRightTopIndex:3*this.options.circleSegments/4-1}}}function LT(e,t,n=!1){const s=t.radius||.5,r=void 0!==t.progress?t.progress:1,o=(Math.max(2,t.radialSegments||8),Math.max(2,t.circleSegments||16));let a=t.startRad;const l=2*s*Math.PI,h=e.distance(),c=r*h;if(0==c)return null;let d=0;const u=[],p=[],f=[],m=[],g=[];let v=0;const y=new i;function x(e,i,s,r){var o,c,x,w,b,_,S,M,C,A,E,T,P,O;const D=0===u.length,B=e.dist/l,I=e.dist/h;let R=[],k=[];if("rect"==t.shape){let e=null!==(o=t.rectWidth)&&void 0!==o?o:1,i=null!==(c=t.rectHeight)&&void 0!==c?c:.5;R=[-Math.PI/2,Math.atan(2*i/e)-Math.PI/2,0,Math.atan(2*i/e),Math.PI/2,-Math.PI/2];let n=Math.sqrt(i*i+e*e/4);k=[e/2,n,i,n,e/2,e/2]}else if("rectHalf"==t.shape){let e=null!==(x=t.rectWidth)&&void 0!==x?x:1,i=null!==(w=t.rectHeight)&&void 0!==w?w:.5;R=[-Math.PI/2,-Math.PI/2,Math.atan(2*i/e)-Math.PI/2,0],k=[0,e/2,Math.sqrt(i*i+e*e/4),i]}else if("rectNoTop"==t.shape){let e=null!==(b=t.rectWidth)&&void 0!==b?b:1,i=null!==(_=t.rectHeight)&&void 0!==_?_:.5;R=[Math.atan(2*i/e),Math.PI/2,-Math.PI/2,Math.atan(2*i/e)-Math.PI/2];let n=Math.sqrt(i*i+e*e/4);k=[n,e/2,e/2,n]}else if("rectNoTopHalf"==t.shape){let e=null!==(S=t.rectWidth)&&void 0!==S?S:1,i=null!==(M=t.rectHeight)&&void 0!==M?M:.5;R=[-Math.PI/2,-Math.PI/2,Math.atan(2*i/e)-Math.PI/2],k=[0,e/2,Math.sqrt(i*i+e*e/4)]}else if("arch"==t.shape){let e=8,i=null!==(C=t.rectWidth)&&void 0!==C?C:1,n=null!==(A=t.rectHeight)&&void 0!==A?A:.5;R=[-Math.PI/2,Math.atan(2*n/i)-Math.PI/2];let s=Math.sqrt(n*n+i*i/4);k=[i/2,s];let r=[],o=[];for(let t=1;t<=3;t++){let s=Math.cos(Math.PI*t/e)*i/2,a=Math.sin(Math.PI*t/e)*i/2,l=Math.atan((n+a)/s),h=Math.sqrt(s*s+(n+a)*(n+a));R.push(l-Math.PI/2),k.push(h),r.push(l),o.push(h)}R.push(0),k.push(i);for(let e=r.length-1;e>=0;e--)R.push(Math.PI/2-r[e]),k.push(o[e]);R.push(Math.atan(2*n/i),Math.PI/2,-Math.PI/2),k.push(s,i/2,i/2)}else if("archHalf"==t.shape){let e=null!==(E=t.radialSegments)&&void 0!==E?E:8,i=null!==(T=t.rectWidth)&&void 0!==T?T:1,n=null!==(P=t.rectHeight)&&void 0!==P?P:.5;R=[-Math.PI/2,-Math.PI/2,Math.atan(2*n/i)-Math.PI/2],k=[0,i/2,Math.sqrt(n*n+i*i/4)];for(let t=1;t<=3;t++){let s=Math.cos(Math.PI*t/e)*i/2,r=Math.sin(Math.PI*t/e)*i/2,o=Math.atan((n+r)/s),a=Math.sqrt(s*s+(n+r)*(n+r));R.push(o-Math.PI/2),k.push(a)}R.push(0),k.push(i)}else if("custom"==t.shape||"customHalf"==t.shape)if(t.shapePoints.length,"customHalf"==t.shape)R=t.shapePoints.map((e=>Math.atan(e.y/e.x))),k=t.shapePoints.map((e=>Math.sqrt(e.y*e.y+e.x*e.x)));else{R=t.shapePoints.map((e=>Math.atan(e.y/e.x))),k=t.shapePoints.map((e=>Math.sqrt(e.y*e.y+e.x*e.x)));for(let e=t.shapePoints.length-1;e>=0;e--){let i=t.shapePoints[e];R.push(Math.atan(i.y/-i.x)),k.push(Math.sqrt(i.y*i.y+i.x*i.x))}R.push(R[0]),k.push(k[0])}else if("circleHalf"==t.shape)for(let e=0;e<=r/2;e++)R.push(2*Math.PI*e/r-Math.PI),k.push(i);else for(let e=0;e<=r;e++){let t=e;t==r&&(t=0),R.push(2*Math.PI*t/r-Math.PI),k.push(i),e==r/2&&(R.push(2*Math.PI*t/r-Math.PI),k.push(i))}let L=R.length-1;for(let t=0;t<=L;t++)y.copy(e.up).applyAxisAngle(e.dir,(null!=a?a:0)+R[t]).normalize(),u.push(e.pos.x+y.x*k[t]*e.widthScale,e.pos.y+y.y*k[t]*(null!==(O=e.widthScaleY)&&void 0!==O?O:e.widthScale),e.pos.z+y.z*k[t]*e.widthScale),p.push(y.x,y.y,y.z),f.push(B,t/L),n&&m.push(I,t/L),v++;if(!D){const e=v-2*(L+1),t=v-(L+1);for(let i=0;i<L;i++)g.push(t+i,e+i,e+i+1,t+i,e+i+1,t+i+1),d+=6}}if(c>0)for(let t=0;t<e.count;t++){const i=e.array[t];if(i.dist>c){const n=e.array[t-1],r=new AT,a=(c-n.dist)/(i.dist-n.dist);r.lerpPathPoints(n,i,a),x(r,s,0,o);break}x(i,s,0,o)}return{position:u,normal:p,uv:f,uv2:m,indices:g,count:d}}function zT(e,t){return{type:"folder",label:t+" Sampler",hidden:()=>!e[t],children:[()=>({type:"vec2",label:"Repeat",stepSize:.001,property:[e[t],"repeat"]}),()=>({type:"vec2",label:"Offset",stepSize:.001,property:[e[t],"offset"]}),()=>({type:"vec2",label:"Center",stepSize:.001,property:[e[t],"center"]}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[e[t],"rotation"]}),()=>({type:"dropdown",label:"Color space",property:[e[t],"colorSpace"],children:[["Linear",ae],["sRGB",se]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{const i=e[t];i&&(i.needsUpdate=!0)}]}),()=>({type:"dropdown",label:"UV Channel",property:[e[t],"channel"],children:[0,1,2,3].map((e=>({label:e.toString(),value:e}))),onChange:()=>{const i=e[t];i&&(i.needsUpdate=!0)}}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var i,n;return null!==(n=null===(i=e[t])||void 0===i?void 0:i.flipY)&&void 0!==n&&n},setValue:i=>{var n;const s=e[t];if(s&&s.flipY!==i)if(s.image&&ImageBitmap&&s.image instanceof ImageBitmap){const t=s,n=s.source.data;createImageBitmap(n,{imageOrientation:"flipY"}).then((s=>{var r;n.close&&n.close(),t.flipY=i,t.source.data=s,t.source.needsUpdate=!0,t.needsUpdate=!0,null===(r=null==e?void 0:e.setDirty)||void 0===r||r.call(e)}))}else s.flipY=i,s.needsUpdate=!0,null===(n=null==e?void 0:e.setDirty)||void 0===n||n.call(e)}}),()=>({type:"dropdown",label:"Wrap S",property:[e[t],"wrapS"],children:[["ClampToEdge",Y],["MirroredRepeat",Ee],["Repeat",G]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)}]}),()=>({type:"dropdown",label:"Wrap T",property:[e[t],"wrapT"],children:[["ClampToEdge",Y],["MirroredRepeat",Ee],["Repeat",G]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)}]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[e[t],"anisotropy"],onChange:[()=>{e[t]&&(e[t].needsUpdate=!0),e.needsUpdate=!0}]}),()=>({type:"dropdown",label:"Min Filter",property:[e[t],"minFilter"],children:[["Linear",N],["Nearest",Te],["NearestMipmapNearest",Pe],["NearestMipmapLinear",Oe],["LinearMipmapNearest",De],["LinearMipmapLinear",Be]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)}]}),()=>({type:"dropdown",label:"Mag Filter",property:[e[t],"magFilter"],children:[["Linear",N],["Nearest",Te]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)}]})]}}function UT(e){return{geometries:Object.assign({},null==e?void 0:e.geometries),materials:Object.assign({},null==e?void 0:e.materials),textures:Object.assign({},null==e?void 0:e.textures),images:Object.assign({},null==e?void 0:e.images),shapes:Object.assign({},null==e?void 0:e.shapes),skeletons:Object.assign({},null==e?void 0:e.skeletons),animations:Object.assign({},null==e?void 0:e.animations),extras:Object.assign({},null==e?void 0:e.extras),_context:{}}}const FT={base:e=>[{type:"input",property:[e,"name"]},{type:"checkbox",property:[e,"wireframe"]},{type:"checkbox",property:[e,"vertexColors"]},{type:"color",property:[e,"color"]},void 0!==e.flatShading?{type:"checkbox",property:[e,"flatShading"]}:{},{type:"image",property:[e,"map"]},zT(e,"map")],blending:e=>({type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[e,"opacity"]},{type:"checkbox",property:[e,"transparent"],onChange:t=>null==e?void 0:e.setDirty({uiChangeEvent:t})},{type:"dropdown",property:[e,"depthFunc"],children:[["Never",Ie],["Always",Re],["Less",ke],["LessEqual",Le],["Equal",ze],["GreaterEqual",Ue],["Greater",Fe],["NotEqual",Ne]].map((e=>({label:e[0],value:e[1]})))},{type:"checkbox",property:[e,"depthTest"],onChange:t=>null==e?void 0:e.setDirty({uiChangeEvent:t})},{type:"checkbox",property:[e,"depthWrite"],onChange:t=>null==e?void 0:e.setDirty({uiChangeEvent:t})},{type:"slider",bounds:[0,1],stepSize:.001,property:[e,"alphaTest"]},{type:"checkbox",property:[e,"dithering"]},{type:"dropdown",label:"Blending",property:[e,"blending"],children:[["None",Q],["Normal",je],["Additive",de],["Subtractive",Ve],["Multiply",He]].map((e=>({label:e[0],value:e[1]})))},void 0!==e.alphaMap?{type:"image",property:[e,"alphaMap"]}:{},void 0!==e.alphaMap?zT(e,"alphaMap"):{},{type:"checkbox",label:"Render to Gbuffer",getValue:()=>!0===e.userData.renderToGBuffer,setValue:t=>{e.userData.renderToGBuffer=t||void 0,e.setDirty()}},e.isPhysicalMaterial?{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!e.transparent,getValue:()=>!0===e.userData.inverseAlphaMap,setValue:t=>{e.userData.inverseAlphaMap=t||void 0,e.setDirty()}}:{}]}),polygonOffset:e=>({type:"folder",label:"Polygon Offset",children:[{type:"checkbox",label:"Polygon Offset",property:[e,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[e,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[e,"polygonOffsetUnits"]}]}),aoLightMap:e=>({type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[e,"aoMapIntensity"]},{type:"image",property:[e,"aoMap"]},zT(e,"aoMap"),{type:"slider",bounds:[0,2],property:[e,"lightMapIntensity"]},{type:"image",property:[e,"lightMap"]},zT(e,"lightMap")]}),misc:e=>[()=>{var t;return null===(t=e.materialExtensions)||void 0===t?void 0:t.map((t=>{var i,n;return t.uuid=t.uuid||uv(),e.__matExtUiConfigs=e.__matExtUiConfigs||{},e.__matExtUiConfigs[t.uuid]||(e.__matExtUiConfigs[t.uuid]=null===(i=t.getUiConfig)||void 0===i?void 0:i.call(t,e,null===(n=e.uiConfig)||void 0===n?void 0:n.uiRefresh)),e.__matExtUiConfigs[t.uuid]})).filter((e=>e))},{type:"dropdown",label:"Side",property:[e,"side"],children:[["Front",D],["Back",d],["Double",I]].map((e=>({label:e[0],value:e[1]})))},{type:"input",label:"Mesh count",getValue:()=>{var t,i;return null!==(i=null===(t=e.appliedMeshes)||void 0===t?void 0:t.size)&&void 0!==i?i:0},disabled:!0},{type:"button",label:`Download ${e.constructor.TypeSlug}`,value:()=>{hx(new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"}),`material.${e.constructor.TypeSlug}`)}},{type:"button",label:`Select ${e.constructor.TypeSlug}`,value:()=>{ux(!1,!1,e.constructor.TypeSlug).then((e=>Qv(void 0,void 0,void 0,(function*(){var t;return null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.text()})))).then((t=>{if(!t)return;const i=JSON.parse(t);i.uuid&&delete i.uuid,e.fromJSON(i,UT())}))}}],roughMetal:e=>({type:"folder",label:"Rough/Metal",children:[{type:"slider",bounds:[0,1],property:[e,"roughness"]},{type:"slider",bounds:[0,1],property:[e,"metalness"]},{type:"image",property:[e,"roughnessMap"]},zT(e,"roughnessMap"),{type:"image",property:[e,"metalnessMap"]},zT(e,"metalnessMap")]}),bumpNormal:e=>({type:"folder",label:"Bump/Normal",children:[{type:"slider",bounds:[-.2,.2],stepSize:.001,property:[e,"bumpScale"],hidden:()=>!e.bumpMap},{type:"image",property:[e,"bumpMap"]},zT(e,"bumpMap"),{type:"image",property:[e,"normalMap"]},{type:"vec2",property:[e,"normalScale"],hidden:()=>!e.normalMap},{type:"dropdown",hidden:()=>!e.normalMap,property:[e,"normalMapType"],children:[["TangentSpace",We],["ObjectSpace",Ge]].map((e=>({label:e[0],value:e[1]})))},zT(e,"normalMap"),{type:"input",property:[e,"displacementScale"],hidden:()=>!e.displacementMap},{type:"image",property:[e,"displacementMap"]},zT(e,"displacementMap")]}),emission:e=>({type:"folder",label:"Emission",children:[{type:"color",property:[e,"emissive"]},{type:"slider",bounds:[0,10],property:[e,"emissiveIntensity"]},{type:"image",property:[e,"emissiveMap"]},zT(e,"emissiveMap")]}),transmission:e=>({type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[e,"ior"]},{type:"slider",bounds:[0,1],property:[e,"transmission"]},{type:"slider",bounds:[0,1],stepSize:.001,property:[e,"thickness"]},{type:"image",property:[e,"transmissionMap"]},zT(e,"transmissionMap"),{type:"image",property:[e,"thicknessMap"]},zT(e,"thicknessMap"),{type:"number",property:[e,"attenuationDistance"]},{type:"color",property:[e,"attenuationColor"]}]}),clearcoat:e=>({type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[e,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>e.clearcoat<.001,property:[e,"clearcoatRoughness"]},{type:"image",property:[e,"clearcoatMap"]},zT(e,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[e,"clearcoatRoughness"]},{type:"image",property:[e,"clearcoatRoughnessMap"]},zT(e,"clearcoatRoughnessMap"),{type:"image",property:[e,"clearcoatNormalMap"]},{type:"vec2",property:[e,"clearcoatNormalScale"],hidden:()=>!e.clearcoatNormalMap},zT(e,"clearcoatNormalMap")]}),iridescence:e=>({type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[e,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[e,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[e.iridescenceThicknessRange,"0"],onChange:t=>e.setDirty({uiChangeEvent:t})},{type:"slider",bounds:[0,500],label:"Thickness1",property:[e.iridescenceThicknessRange,"1"],onChange:t=>e.setDirty({uiChangeEvent:t})},{type:"image",property:[e,"iridescenceMap"]},zT(e,"iridescenceMap"),{type:"image",property:[e,"iridescenceThicknessMap"]},zT(e,"iridescenceThicknessMap")]}),sheen:e=>({type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[e,"sheen"]},{type:"color",hidden:()=>e.sheen<.001,property:[e,"sheenColor"]},{type:"image",property:[e,"sheenColorMap"]},zT(e,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[e,"sheenRoughness"]},{type:"image",property:[e,"sheenRoughnessMap"]},zT(e,"sheenRoughnessMap")]})};function NT(e){if(!e)return{};if(e.uiConfig)return e.uiConfig;const t={type:"folder",label:e.type+" Basic UI",uuid:"MBM2_"+e.uuid,expanded:!0,children:[...FT.base(e),FT.blending(e),FT.polygonOffset(e),FT.aoLightMap(e),...FT.misc(e)]};return e.uiConfig=t,t}function jT(e){if(!e)return{};if(e.uiConfig)return e.uiConfig;const t={type:"folder",label:e.type+" Phong UI",uuid:"MBM2_"+e.uuid,expanded:!0,children:[...FT.base(e),FT.blending(e),FT.polygonOffset(e),FT.aoLightMap(e),{type:"folder",label:"Specular",children:[{type:"color",property:[e,"specular"]},{type:"image",property:[e,"specularMap"]},zT(e,"specularMap"),{type:"slider",label:"Shininess",property:[e,"shininess"],bounds:[0,100],stepSize:.1},{type:"slider",label:"Reflectivity",property:[e,"reflectivity"],bounds:[0,1],stepSize:.01},{type:"slider",label:"Refraction Ratio",property:[e,"refractionRatio"],bounds:[0,3],stepSize:.01}]},FT.bumpNormal(e),FT.emission(e),{type:"folder",label:"Env Map",children:[{type:"image",property:[e,"envMap"]},zT(e,"envMap"),{type:"slider",label:"Env Map Intensity",property:[e,"envMapIntensity"],bounds:[0,5],stepSize:.01}]},...FT.misc(e)]};return e.uiConfig=t,t}function VT(e){if(!e)return{};if(e.uiConfig)return e.uiConfig;const t={type:"folder",label:e.type+" Physical UI",uuid:"MPM2_"+e.uuid,expanded:!0,onChange:e=>{e.config&&!e.config.onChange&&t.uiRefresh&&t.uiRefresh(!1)},children:[...FT.base(e),FT.blending(e),FT.polygonOffset(e),FT.aoLightMap(e),FT.roughMetal(e),FT.bumpNormal(e),FT.emission(e),FT.transmission(e),FT.clearcoat(e),FT.iridescence(e),FT.sheen(e),...FT.misc(e)]};return e.uiConfig=t,t}function HT(e,t){let i;if(i=e.type.indexOf("Phong")>=0?jT(e):e.type.indexOf("Physical")>=0||e.type.indexOf("Standard")>=0?VT(e):NT(e),t&&-1==i.children.findIndex((e=>"替换材质类型"==e.label))){let n=[],s={mat:""};n.push({type:"dropdown",label:"替换材质类型",property:[s,"mat"],children:[{label:"",value:""},{label:"BasicMaterial",value:"MeshBasicMaterial"},{label:"StandardMaterial",value:"MeshStandardMaterial"},{label:"PhongMaterial",value:"MeshPhongMaterial"},{label:"PhysicalMaterial",value:"MeshPhysicalMaterial"}],onChange:()=>{var e;return null===(e=null==i?void 0:i.uiRefresh)||void 0===e?void 0:e.call(i,!1)}}),n.push((()=>({type:"button",label:"替换材质",hidden:()=>""==s.mat,onClick:()=>{let i={BasicMaterial:x,StandardMaterial:$,PhongMaterial:ce,PhysicalMaterial:Ye};if(!i[s.mat])return;let n=new i[s.mat]({color:268435455*Math.random()});if(n.type!=e.type){for(let t in e)"type"!=t&&t in n&&(n[t]=e[t]);t.material=n,t.material.needsUpdate=!0}}}))),n.push((()=>({type:"button",label:"刷新材质",onClick:()=>{material.needsUpdate=!0}}))),i.children.push(...n)}return i}function WT(e){if(!e)return{};if(e.uiConfig)return e.uiConfig;const t={label:"Geometry",type:"folder",expanded:!1,children:[{type:"input",property:[e,"uuid"],disabled:!0},{type:"input",property:[e,"name"]},{type:"button",label:"Center Geometry",value:()=>{e.center()}},{type:"button",label:"Compute vertex normals",value:()=>{e.hasAttribute("normal")&&!confirm("Normals already exist, replace with computed normals?")||e.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{e.hasAttribute("tangent")&&!confirm("Tangents already exist, replace with computed tangents?")||e.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{e.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!e.index,value:()=>{var t;if(e.attributes.index)return;const i=parseFloat(null!==(t=prompt("Tolerance","-1"))&&void 0!==t?t:"-1");Ji(e,i)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!e.index,value:()=>{e.attributes.index&&e.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{e.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||e.setAttribute("uv1",e.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!e.hasAttribute("color"),value:()=>{e.hasAttribute("color")?confirm("Remove color attribute?")&&e.deleteAttribute("color"):prompt("No color attribute found")}},{type:"input",label:"Mesh count",getValue:()=>{var t,i;return null!==(i=null===(t=e.appliedMeshes)||void 0===t?void 0:t.size)&&void 0!==i?i:0},disabled:!0}]};return e.uiConfig=t,t}let GT;const YT=new Uint8Array(16);function XT(){if(!GT&&(GT="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!GT))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return GT(YT)}const QT=[];for(let e=0;e<256;++e)QT.push((e+256).toString(16).slice(1));var qT={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ZT(e,t,i){if(qT.randomUUID&&!t&&!e)return qT.randomUUID();const n=(e=e||{}).random||(e.rng||XT)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=n[e];return t}return function(e,t=0){return(QT[e[t+0]]+QT[e[t+1]]+QT[e[t+2]]+QT[e[t+3]]+"-"+QT[e[t+4]]+QT[e[t+5]]+"-"+QT[e[t+6]]+QT[e[t+7]]+"-"+QT[e[t+8]]+QT[e[t+9]]+"-"+QT[e[t+10]]+QT[e[t+11]]+QT[e[t+12]]+QT[e[t+13]]+QT[e[t+14]]+QT[e[t+15]]).toLowerCase()}(n)}class KT{}function JT(e,t,i,n){const s=null==(n=null!=n?n:e[t])?void 0:n.uiConfig;let r;if(s)r=s;else{const i=tP(n);"folder"===i?r=eP(t+"",n):i&&(r={type:i,label:t+"",property:[e,t]})}return i=null!=i?i:t+"",r&&!r.label&&(r.label=i),r}function $T(e,t){var i;if(t){let n={};t=null!=t?t:[];let s={},r=0;for(let o=0;o<t.length;o++){let a=t[o];a.prop&&a.prop in e&&(n[a.prop]=null!==(i=e[a.prop])&&void 0!==i?i:a.value,"number"==typeof n[a.prop]&&(n[a.prop]==1/0?n[a.prop]=Number.MAX_VALUE:n[a.prop]==-1/0&&(n[a.prop]=Number.MIN_VALUE)),s[o]=r++)}let o=$T(n),a=[];for(let i=0;i<t.length;i++)if(i in s){let n=t[i],r=s[i];if(!(r in o)){a.push(t[i]);continue}n.label&&(o[r].label=n.label);let l=n.prop;delete n.prop,delete n.label,delete n.value,o[r]=Object.assign(Object.assign(Object.assign({},o[r]),{onChange:t=>{e[l]=t.value}}),n),a.push(o[r])}else a.push(t[i]);return a}if(!e)return[];let n=e.constructor||Object;n===Array&&(n=Object);const s=[],r=[];for(;n&&n!==Object;)r.push(n),n=Object.getPrototypeOf(n);if(!r.length){const t="object"==typeof e?Object.keys(e):Array.isArray(e)?e.map(((e,t)=>t)):[];for(const i of t){const t=e[i];if(null==t)continue;const n=JT(e,i,i+"",t);n&&s.push(n)}}return r.reverse().forEach((t=>{var i;null===(i=KT.Map.get(t))||void 0===i||i.forEach((({params:t,propKey:i,uiType:n})=>{let r;if(n||(r=JT(e,i)),r||(r={property:[e,i],type:n||"input"}),t){const i="function"==typeof t.params?t.params(e):t.params||{};delete t.params,Object.assign(r,Object.assign(Object.assign({},t),i))}s.push(r)}))})),s}function eP(e,t,i={},n="folder"){return Object.assign({type:n,label:e,children:$T(t),uuid:ZT()},i)}function tP(e){return null==e?null:Array.isArray(e)?"folder":"boolean"==typeof e?"checkbox":"number"==typeof e?"number":"string"==typeof e?"input":"function"==typeof e?"button":"number"==typeof e.x&&"number"==typeof e.y?"vec":"number"==typeof e.r&&"number"==typeof e.g?"color":e.isTexture?"image":"object"==typeof e?"folder":null}function iP(e,t){return i=(i,n,s)=>{const r=s.findIndex((e=>e.propKey===n));if(!(r&&r<0))throw new Error(`Property ${n} already has a uiConfig decorator`);s.push({params:t||{},propKey:n,uiType:e})},(e,t)=>{const n=e.constructor;if(n===Object)throw new Error("Not possible to use uiConfig decorator on an object, use class instead");KT.Map.has(n)||KT.Map.set(n,[]),i(0,t,KT.Map.get(n))};var i}function nP(e,t,i="panel"){return n=>class extends n{constructor(){super(...arguments),this.uiConfig=eP(e,this,t||{},i)}}}function sP(e,t){return iP("monitor",{label:e,params:t})}function rP(e,t,i,n){return iP("slider",{label:e,bounds:t,stepSize:i,params:n})}function oP(e,t,i,n){return iP("vec",{label:e,bounds:t,stepSize:i,params:n})}function aP(e,t,i){return iP("dropdown",{label:e,children:t,params:i})}function lP(e,t){return iP("button",{label:e,params:t})}function hP(e,t){return iP("input",{label:e,params:t})}function cP(e,t){return iP("number",{label:e,params:t})}function dP(e,t){return iP("color",{label:e,params:t})}function uP(e,t){return iP("image",{label:e,params:t})}function pP(e,t){return iP("checkbox",{label:e,params:t})}function fP(e,t){return nP(e,t,"panel")}function mP(e,t){return nP(e,t,"folder")}KT.Map=new Map;class gP{constructor(e){this._renderer=e}getBinding(e){const t=Mx(e.property);return t&&"object"==typeof t[0]&&t[1]?t:[void 0,""]}getValue(e){const[t,i]=this.getBinding(e);return t?t[i]:void 0}dispatchOnChangeSync(e,t,...i){var n,s,r;const o=[{type:"change",last:null===(n=t.last)||void 0===n||n,config:null!==(s=t.config)&&void 0!==s?s:e,configPath:[e,...t.configPath||[]],target:e},...i];"function"==typeof e.onChange?e.onChange(...o):Array.isArray(e.onChange)?e.onChange.flat().forEach((e=>"function"==typeof e&&(null==e?void 0:e(...o)))):e.onChange&&console.error("Invalid onChange type, must be a function or array of functions",e.onChange),null===(r=e.parentOnChange)||void 0===r||r.call(e,...o)}setValue(e,t,i,n){return Qv(this,void 0,void 0,(function*(){return yield this.runAtEvent(e,(()=>{const[s,r]=this.getBinding(e);return!!(s&&t!==s[r]&&Sx(s,r,t,!0,!0)||n)&&(this.dispatchOnChangeSync(e,i),!0)}))}))}dispatchOnChange(e,t){return Qv(this,void 0,void 0,(function*(){return yield this.runAtEvent(e,(()=>{this.dispatchOnChangeSync(e,t)}))}))}getLabel(e){var t;return(null!==(t=Mx(e.label))&&void 0!==t?t:this.getBinding(e)[1])+""}getChildren(e){var t;return(null!==(t=e.children)&&void 0!==t?t:[]).map((e=>Mx(e))).flat(2).filter((e=>e))}clickButton(e,t){return Qv(this,void 0,void 0,(function*(){return yield this.runAtEvent(e,(()=>Qv(this,void 0,void 0,(function*(){var i,n;const s=this.getBinding(e),r=null!==(i=s[0])&&void 0!==i?i:e,o=r[s[1]||"onClick"];"function"==typeof o?o.call(r,...null!==(n=null==t?void 0:t.args)&&void 0!==n?n:[]):o&&console.warn("Invalid action type for button",o),this.dispatchOnChange(e,{})}))))}))}runAtEvent(e,t){var i;return Qv(this,void 0,void 0,(function*(){const n=null!==(i=Mx(e.dispatchMode))&&void 0!==i?i:"postFrame";return"immediate"===n?yield t():yield new Promise((e=>{const i=()=>Qv(this,void 0,void 0,(function*(){this._renderer.removeEventListener(n,i),e(yield t())}));this._renderer.addEventListener(n,i)}))}))}initUiConfig(e){e&&(e.type||(console.warn("No type for config",e),e.type="input"),e.uuid||(e.uuid=ZT()),void 0===e.property&&(e.binding?e.property=e.binding:void 0===e.value&&(e.getValue||e.setValue)&&Object.defineProperty(e,"value",{get:()=>{var t;return null===(t=e.getValue)||void 0===t?void 0:t.call(e)},set:t=>{var i;return null===(i=e.setValue)||void 0===i?void 0:i.call(e,t)}}),void 0===e.property&&void 0!==e.value&&(e.property=[e,"value"])))}}class vP{constructor(e,t){this.isController=!0,this.object=e,this.property=t}onChange(e){return this.callback=t=>{var i;return e((null===(i=t.value)||void 0===i?void 0:i.isColor)?t.value.getHex():t.value)},this}on(e,t){return"change"==e?(this.callback=e=>{var i;return t((null===(i=e.value)||void 0===i?void 0:i.isColor)?e.value.getHex():e.value)},this):this}defaultValue(e){return this._defaultValue=e,this}label(e){return this._label=e,this}name(e){return this._label=e,this}type(e){return this._type=e,this}options(e){let t=[];for(let i of e)"object"==typeof i?t.push(i):t.push({label:i,value:i});return this.children=t,this.type("dropdown"),this}min(e){var t;return this._bounds=null!==(t=this._bounds)&&void 0!==t?t:[e,e],this._bounds[0]=e,this}max(e){var t;return this._bounds=null!==(t=this._bounds)&&void 0!==t?t:[e,e],this._bounds[1]=e,this}step(e){return this.stepSize=e,this}toJson(){var e,t,i,n,s,r;let o=null!==(e=this.object[this.property])&&void 0!==e?e:this._defaultValue,a=tP(o);"number"==a&&2==(null===(t=this._bounds)||void 0===t?void 0:t.length)&&void 0!==this.stepSize&&(a="slider",this.value=null!==(i=this.value)&&void 0!==i?i:o);let l={type:null!==(n=this._type)&&void 0!==n?n:a,label:null!==(s=this._label)&&void 0!==s?s:this.property,property:[this.object,this.property],onChange:this.callback,value:this.value,getValue:this.getValue,setValue:this.setValue,hidden:this.hidden,disabled:this.disabled,readOnly:this.readOnly,tags:this.tags,onClick:this.onClick,bounds:null!==(r=this.bounds)&&void 0!==r?r:this._bounds,stepSize:this.stepSize,expanded:this.expanded,onExpand:this.onExpand,inlinePicker:this.inlinePicker,children:this.children};return Object.assign({},l)}}class yP{constructor(){this.children=[]}add(e,t,i,n,s){let r=new vP(e,t);if(void 0!==i)if(Array.isArray(i))r.options(i);else if("object"==typeof i){let e=[];for(let t in i)e.push({label:t,value:i[t]});r.options(e)}else r.min(i);return void 0!==n&&r.max(n),void 0!==s&&r.step(s),this.children.push(r),r}addBinding(e,t,i){let n=new vP(e,t);if(void 0!==(i=null!=i?i:{}).min&&(n.min(i.min),delete i.min),void 0!==i.max&&(n.max(i.max),delete i.max),void 0!==i.step&&(n.step(i.step),delete i.step),void 0!==i.label&&(n.label(i.label),delete i.label),void 0!==i.type&&(n.type(i.type),delete i.type),void 0!==i.view&&(n.type(i.view),delete i.view),void 0!==i.options){let e=i.options;if("object"==typeof e){let t=[];for(let i in e)t.push({label:i,value:e[i]});e=t}n.options(e),delete i.options}for(let e in i)n[e]=i[e];return this.children.push(n),n}addColor(e,t){let i=new vP(e,t);return this.children.push(i),i}addFolder(e){var t;let i=new yP;return i.isFolder=!0,"object"!=typeof e?i.title=e:(i.title=e.title,i.expanded=null!==(t=e.expanded)&&void 0!==t&&t),this.children.push(i),i}addButton(e,t){return this.add({onclick:()=>t()},"onclick").name(e)}addFunction(e){this.children.push(e)}open(e){return this.expanded=!1!==e,this}show(e){return this.hidden=!e,this}toJson(){return this.children.map((e=>{var t,i;return"function"==typeof e?e:e.isController?e.toJson():e.isFolder?{type:"folder",expanded:null!==(t=e.expanded)&&void 0!==t&&t,hidden:null!==(i=e.hidden)&&void 0!==i&&i,label:e.title,children:e.toJson()}:e.toJson()}))}}class xP extends Fy{constructor(e=document.body,t=!0,i){super(),this.config={type:"panel",label:"Configuration",children:[]},this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this.methods=i||new gP(this);const n=this._createUiContainer();if(e.appendChild(n),t){this.addEventListener("preFrame",(()=>this.refreshQueue("preFrame"))),this.addEventListener("postFrame",(()=>this.refreshQueue("postFrame"))),this.addEventListener("preRender",(()=>this.refreshQueue("preRender"))),this.addEventListener("postRender",(()=>this.refreshQueue("postRender")));const e=()=>{this.dispatchEvent({type:"preFrame"}),this.dispatchEvent({type:"preRender"}),this.dispatchEvent({type:"postRender"}),this.dispatchEvent({type:"postFrame"}),requestAnimationFrame(e)};requestAnimationFrame(e)}}refreshQueue(e){const t=this._refreshQueue[e],i=[],n=jy(),s=n-this._lastModeTime[e];t.forEach((e=>{e[1]>.001?(e[1]-=s,i.push(e)):this._refreshUiConfigObject(e[0])})),this._refreshQueue[e]=i,this._lastModeTime[e]=n}_addToRefreshQueue(e,t,i){const n=t.uuid,s=this._refreshQueue[e],r=s.find((e=>e[2]===n));r?r[1]=Math.max(r[1],i):s.push([t,i,n]),this._refreshQueue[e]=s}dispose(){}appendChild(e){e&&(this.config.children.push(e),this.refreshRoot())}removeChild(e){const t=this.config.children.indexOf(e);-1!==t&&(this.config.children.splice(t,1),this.disposeUiConfig(e),this.refreshRoot())}refreshRoot(e=!0,t="postFrame",i=0){var n,s;null===(s=(n=this.config).uiRefresh)||void 0===s||s.call(n,e,t,i)}disposeUiConfig(e,t=!0){var i,n;e&&(e.uiRef&&(t&&(null===(n=(i=e.uiRef).dispose)||void 0===n||n.call(i)),e.uiRef=void 0),e.uiRefType=void 0,e.uiRefresh=void 0)}addToRefreshQueue(e,t,i,n){const s=i?this._flattenUiConfig(t):[t];for(const t of s)"immediate"===e?Ny(n).then((()=>this._refreshUiConfigObject(t))):this._addToRefreshQueue(e,t,n)}_createUiContainer(){return Wy({id:"uiConfigContainer",addToBody:!1})}_flattenUiConfig(e,t){var i;return t=null!=t?t:[],e&&e.uiRef?(t.push(e),null===(i=e.children)||void 0===i||i.forEach((e=>{"function"!=typeof e&&e&&(Array.isArray(e)?e.forEach((e=>t=this._flattenUiConfig(e,t))):t=this._flattenUiConfig(e,t))})),t):t}}function wP(e){let t=[{prop:"color"},{prop:"intensity"}];return e.isHemisphereLight?t.push({prop:"groundColor"}):e.isPointLight?t.push({prop:"distance"},{prop:"decay"}):e.isRectAreaLight?t.push({prop:"width"},{prop:"height"}):e.isSpotLight&&t.push({prop:"distance"},{prop:"angle"},{prop:"penumbra"},{prop:"decay"}),{type:"folder",expanded:!0,label:"灯光属性",children:[...$T(e,t)]}}const bP=1024e3,_P=.1/180*Math.PI,SP=Math.atan(3/4),MP=6371008.8;var CP,AP,EP,TP,PP,OP={WORLD_SIZE:bP,PROJECTION_WORLD_SIZE:bP/(MP*Math.PI*2),MERCATOR_A:MP,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_RADIUS:MP,EARTH_CIRCUMFERENCE:2*Math.PI*MP,EARTH_CIRCUMFERENCE_EQUATOR:40075017,FOV_ORTHO:_P,FOV:SP,FOV_DEGREES:180*SP/Math.PI,TILE_SIZE:512};function DP(e,t){var i,n,s,r,o,a,l;t=t||{};const h=e.getCanvas().clientHeight,c=e.getCanvas().clientWidth;let d=e.getCanvas().getContext("webgl2")||e.getCanvas().getContext("webgl");t.container=e.getContainer(),t.render=null!==(i=t.render)&&void 0!==i?i:{},t.render.canvas=e.getCanvas(),t.render.context=d,t.render.renderUpdate=!1,t.render.autoClear=!1,t.render.alpha=!0,t.input=null!==(n=t.input)&&void 0!==n?n:{},t.input.interactiveMapObject=e,t.control=null!==(s=t.control)&&void 0!==s?s:{},t.control.enable=!1,t.camera=null!==(r=t.camera)&&void 0!==r?r:{},t.camera.isOrthographicCamera=!1,t.camera.fov=OP.FOV,t.camera.aspect=c/h,t.camera.near=.1,t.camera.far=1e21,t.camera.position=null,t.camera.lookAt=null,t.postProcess=null!==(o=t.postProcess)&&void 0!==o?o:{},t.postProcess.enable=!1,t.postProcess.renderUpdate=!1,null!==(a=t.css2dRender)&&void 0!==a||(t.css2dRender={}),t.css2dRender.parent=e.getCanvas().parentElement,null!==(l=t.css3dRender)&&void 0!==l||(t.css3dRender={}),t.css3dRender.parent=e.getCanvas().parentElement;let u=new KH(e._svc,t);return e.app=u,u}class BP{static makePerspectiveMatrix(e,t,i,s){var r=new n,o=1/Math.tan(e/2),a=1/(i-s),l=[o/t,0,0,0,0,o,0,0,0,0,(s+i)*a,-1,0,0,2*s*i*a,0];return r.elements=l,r}static makeOrthographicMatrix(e,t,i,s,r,o){var a=new n;const l=1/(t-e),h=1/(i-s),c=1/(o-r);var d=[2*l,0,0,0,0,2*h,0,0,0,0,-1*c,0,-(t+e)*l,-(i+s)*h,-r*c,1];return a.elements=d,a}static projectToWorld(e){var t=[-OP.MERCATOR_A*OP.DEG2RAD*e[0]*OP.PROJECTION_WORLD_SIZE,-OP.MERCATOR_A*Math.log(Math.tan(.25*Math.PI+.5*OP.DEG2RAD*e[1]))*OP.PROJECTION_WORLD_SIZE];if(e[2]){var n=this.projectedUnitsPerMeter(e[1]);t.push(e[2]*n)}else t.push(0);return new i(t[0],t[1],t[2])}static projectedUnitsPerMeter(e){return Math.abs(OP.WORLD_SIZE/Math.cos(OP.DEG2RAD*e)/OP.EARTH_CIRCUMFERENCE)}static mercatorZfromAltitude(e,t){return e/(OP.EARTH_CIRCUMFERENCE*Math.cos(t*Math.PI/180))}static unprojectFromWorld(e){var t=[-e.x/(OP.MERCATOR_A*OP.DEG2RAD*OP.PROJECTION_WORLD_SIZE),2*(Math.atan(Math.exp(e.y/(OP.PROJECTION_WORLD_SIZE*-OP.MERCATOR_A)))-Math.PI/4)/OP.DEG2RAD],i=this.projectedUnitsPerMeter(t[1]),n=e.z||0;return t.push(n/i),t}static fitToObject(e,t,i){if(!e||!t)return;let n=dW(t,void 0,e.app);if(isNaN(n.min.x))return;const s=[BP.unprojectFromWorld({x:n.min.x,y:n.min.y,z:n.min.z}),BP.unprojectFromWorld({x:n.max.x,y:n.max.y,z:n.max.z})];e.fitBounds(s,Object.assign({padding:{top:10,bottom:10,left:10,right:10}},i))}static scene2World(e,t){return t||(t=Cy.app),t.scene.worldToLocal(e.clone())}static world2Scene(e,t){return t||(t=Cy.app),t.scene.localToWorld(e.clone())}}function IP(e,t,i){this.map=e,this.camera=t,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=i||new V,this.world.position.x=this.world.position.y=OP.WORLD_SIZE/2,this.world.matrixAutoUpdate=!1,this.state={translateCenter:(new n).makeTranslation(OP.WORLD_SIZE/2,-OP.WORLD_SIZE/2,0),worldSizeRatio:OP.TILE_SIZE/OP.WORLD_SIZE,worldSize:OP.TILE_SIZE*this.map.transform.scale};let s=this;this.map.on("move",(function(){s.updateCamera()})).on("resize",(function(){s.setupCamera()})),this.setupCamera()}BP.WorldResolution=OP.EARTH_CIRCUMFERENCE_EQUATOR/OP.WORLD_SIZE,IP.prototype={setupCamera:function(){const e=this.map.transform;this.camera.aspect=e.width/e.height,this.halfFov=e._fov/2,this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*e.height;const t=e._maxPitch*Math.PI/180;this.acuteAngle=Math.PI/2-t,this.updateCamera()},updateCamera:function(){if(!this.camera)return void console.log("nocamera");const e=this.map.transform;this.camera.aspect=e.width/e.height;const t=e.centerOffset||new i;let s=0,r=0;this.halfFov=e._fov/2;const o=Math.PI/2+e._pitch,a=Math.cos(Math.PI/2-e._pitch);this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*e.height;let l=1;const h=this.worldSize();{l=this.mercatorZfromAltitude(1,e.center.lat)*h;const t=e._fov*(.5+e.centerOffset.y/e.height),i=e.elevation?e.elevation.getMinElevationBelowMSL()*l:0,n=(e._camera.position[2]*h-i)/Math.cos(e._pitch);r=a*(Math.sin(t)*n/Math.sin(Mv(Math.PI-o-t,.01,Math.PI-.01)))+n;const c=n*(1/e._horizonShift);s=Math.min(1.01*r,c)}this.cameraTranslateZ=(new n).makeTranslation(0,0,this.cameraToCenterDistance);const c=e.height/50,d=Math.max(c*a,c),u=e.height,p=e.width;this.camera instanceof f?this.camera.projectionMatrix=BP.makeOrthographicMatrix(p/-2,p/2,u/2,u/-2,d,s):this.camera.projectionMatrix=BP.makePerspectiveMatrix(e._fov,p/u,d,s),this.camera.projectionMatrix.elements[8]=2*-t.x/e.width,this.camera.projectionMatrix.elements[9]=2*t.y/e.height;let m=this.calcCameraMatrix(e._pitch,e.angle);e.elevation&&(m.elements[14]=e._camera.position[2]*h),this.camera.matrixWorld.copy(m);let g=e.scale*this.state.worldSizeRatio,v=new n,y=new n,x=new n;v.makeScale(g,g,g);let w=e.x||e.point.x,b=e.y||e.point.y;y.makeTranslation(-w,b,0),x.makeRotationZ(Math.PI),this.world.matrix=(new n).premultiply(x).premultiply(this.state.translateCenter).premultiply(v).premultiply(y),this.map.fire("CameraSynced",{detail:{scale:g,nearZ:d,farZ:s,pitch:e._pitch,angle:e.angle,furthestDistance:r,cameraToCenterDistance:this.cameraToCenterDistance,t:this.map.transform,tbProjMatrix:this.camera.projectionMatrix.elements,tbWorldMatrix:this.world.matrix.elements,cameraSyn:IP}})},worldSize(){let e=this.map.transform;return e.tileSize*e.scale},worldSizeFromZoom(){let e=this.map.transform;return Math.pow(2,e.zoom)*e.tileSize},mercatorZfromAltitude(e,t){return e/this.circumferenceAtLatitude(t)},mercatorZfromZoom(){return this.cameraToCenterDistance/this.worldSizeFromZoom()},circumferenceAtLatitude:e=>OP.EARTH_CIRCUMFERENCE*Math.cos(e*Math.PI/180),calcCameraMatrix(e,t,i){const s=this.map.transform,r=void 0===e?s._pitch:e,o=void 0===t?s.angle:t,a=void 0===i?this.cameraTranslateZ:i;return(new n).premultiply(a).premultiply((new n).makeRotationX(r)).premultiply((new n).makeRotationZ(o))},updateCameraState(){let e=this.map.transform;if(!e.height)return;const t=e._camera.forward(),i=e.cameraToCenterDistance,n=e.point;e._cameraZoom?e._cameraZoom:e._zoom;const s=this.mercatorZfromZoom(e)-this.mercatorZfromAltitude(e._centerAltitude,e.center.lat),r=e.cameraToCenterDistance/s;return[n.x/this.worldSize()-t[0]*i/r,n.y/this.worldSize()-t[1]*i/r,this.mercatorZfromAltitude(e._centerAltitude,e._center.lat)+-t[2]*i/r]},getWorldToCamera(e,t){let s=this.map.transform;const r=new n,o=new n,a=s._camera._orientation,l=s._camera.position,h=new i(l[0],l[1],l[2]),c=new v;c.set(a[0],a[1],a[2],a[3]);const d=c.conjugate();return h.multiplyScalar(-e),o.makeTranslation(h.x,h.y,h.z),r.makeRotationFromQuaternion(d).premultiply(o),r.elements[1]*=-1,r.elements[5]*=-1,r.elements[9]*=-1,r.elements[13]*=-1,r.elements[8]*=t,r.elements[9]*=t,r.elements[10]*=t,r.elements[11]*=t,r},translate(e,t,i){let n,s,r,o,a,l,h,c,d,u,p,f,m=i[0]||i.x,g=i[1]||i.y,v=i[2]||i.z;return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*v+t[12],e[13]=t[1]*m+t[5]*g+t[9]*v+t[13],e[14]=t[2]*m+t[6]*g+t[10]*v+t[14],e[15]=t[3]*m+t[7]*g+t[11]*v+t[15]):(n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=t[9],p=t[10],f=t[11],e[0]=n,e[1]=s,e[2]=r,e[3]=o,e[4]=a,e[5]=l,e[6]=h,e[7]=c,e[8]=d,e[9]=u,e[10]=p,e[11]=f,e[12]=n*m+a*g+d*v+t[12],e[13]=s*m+l*g+u*v+t[13],e[14]=r*m+h*g+p*v+t[14],e[15]=o*m+c*g+f*v+t[15]),e}};class RP{constructor(e,t){CP.set(this,void 0),AP.set(this,new i(0,0,0)),this.init(e,t)}init(e,t){this.map=e,this.map.mapThreeLayer=this,this.options=null!=t?t:{},this.app=DP(e,t),this.app.project;let n=this.app.unproject;this.app.project=(t,i,n)=>{let s=BP.unprojectFromWorld(t.isVector3?t:{x:t,y:i,z:n}),o=e.projectEx([s[0],s[1]],s[2]);return new r(o.x,o.y)},this.app.unproject=(t,i,s,r)=>{var o,a;if(void 0===s){let e,t=null!==(a=null===(o=this.app.envConfig)||void 0===o?void 0:o.unProjectOptions)&&void 0!==a?a:{};for(let i in t)if("point"!=i)if("none"==i)e=t[i];else if(i.split("+").map((e=>e.trim())).every((e=>this.app.Input.getKeyPressed(e)))){let n=t[i];if(1===n){let i=t.point;e=null!=i?i:qv(this,AP,"f")}else e=2===n?t.value:n;break}s=e}if(void 0!==s&&!1!==s){let e=n(t,i,s,r);if(e)return BP.scene2World(e,this.app)}let l=e.unproject({x:t,y:i});return BP.projectToWorld([l.lng,l.lat,0])},this.app.map=this.map,this.app.camera.getWorldDirection=e=>{const t=this.app.camera.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize().negate()},this.world=new V,this.world.name="world",this.scene=this.app.scene,this.worldEntity=UP.fromObject3d(this.world),this.worldEntity.addTo(this.app),this.app.scene=this.world,this.app.scene.sceneEntity=this.worldEntity;const s=new i,o=new i,a=new v,l=t=>{var i,n,r,l,h,c,d;this.app.scene.updateWorldMatrix(!0,!1);let u=this.app.scene.matrixWorld.invert();u.decompose(s,a,o),null!==(i=e._screenMatrixWorldInvert)&&void 0!==i||(e._screenMatrixWorldInvert={}),e._screenMatrixWorldInvert.translation=s,e._screenMatrixWorldInvert.rotation=a,e._screenMatrixWorldInvert.scale=o,null!==(n=(h=this.app.commonUniforms).mapSceneMatrixWorld)&&void 0!==n||(h.mapSceneMatrixWorld={}),this.app.commonUniforms.mapSceneMatrixWorld.value=this.app.scene.matrixWorld,null!==(r=(c=this.app.commonUniforms).mapSceneMatrixWorldInv)&&void 0!==r||(c.mapSceneMatrixWorldInv={}),this.app.commonUniforms.mapSceneMatrixWorldInv.value=u,null!==(l=(d=this.app.commonUniforms).mapSceneMatrixWorldInvScale)&&void 0!==l||(d.mapSceneMatrixWorldInvScale={}),this.app.commonUniforms.mapSceneMatrixWorldInvScale.value=o,this.app.dispatch("onCameraUpdate",t),this.app.signal.onCameraUpdate.dispatch("onCameraUpdate",t)};e.on("CameraSynced",l),this.cameraSync=new IP(e,this.app.camera,this.world),this.map.transform.fov=OP.FOV,this.app.camera.fov=this.map.transform.fov,this.cameraSync.setupCamera(),[100,300,1e3,3e3].forEach((e=>{setTimeout((()=>{this.cameraSync.updateCamera()}),e)})),this.app.mapRootScene=this.app.scene.parent,Zv(this,CP,(()=>{e.off("CameraSynced",l)}),"f"),e.repaint=!0}update(){this.map.repaint&&(this.map.repaint=!1),this.app.renderer.resetState(),this.app.renderer.render(this.scene,this.app.camera),this.options.passiveRendering||this.map.triggerRepaint()}repaint(){this.map.repaint=!0}onRemove(e,t){qv(this,CP,"f")&&qv(this,CP,"f").call(this),this.app.dispose()}}function kP(e,t=0){const i=[],n=`${"-".repeat(t)}${e.type} ${e.name} ${e.uuid}`;if(i.push(n),e.children&&e.children.length>0)for(const n of e.children){if(!0===n.userData._stealth)continue;const e=kP(n,t+1);i.push(...e)}return i}function LP(e,t){if(!e)return{};if(e.uiConfig)return e.uiConfig;let n={value:""};const s={type:"folder",label:()=>"Object3D "+(e.name||"unnamed"),expanded:!0,onChange:t=>{t.config&&!t.config.onChange&&(s.uiRefresh&&s.uiRefresh(!1),e.dispatchEvent({type:"uiConfigChange",uiChangeEvent:t,needsUpdate:!1,refreshUi:!0}))},children:[{type:"input",label:"类别",property:[e,"type"],readOnly:!0},{type:"input",label:"名称",property:[e,"name"],onChange:t=>{t.last&&(s.uiRefresh(!1),e.dispatchEvent({type:"uiConfigChange",uiChangeEvent:t,refreshScene:!0,frameFade:!1,refreshUi:!0}))}},{type:"input",label:"uuid",property:[e,"uuid"]},{type:"checkbox",label:"可见",property:[e,"visible"]},{type:"checkbox",label:"视锥体剔除",property:[e,"frustumCulled"]},{type:"checkbox",label:"阴影投射",hidden:()=>!e.isMesh,property:[e,"castShadow"]},{type:"checkbox",label:"接受阴影",hidden:()=>!e.isMesh,property:[e,"receiveShadow"]},{type:"vec3",label:"位置",property:[e,"position"]},{type:"vec3",label:"旋转",property:[e,"rotation"]},{type:"vec3",label:"缩放",property:[e,"scale"]},{type:"input",label:"渲染次序",property:[e,"renderOrder"]},{type:"dropdown",label:"子对象",property:[{childrens:""},"childrens"],children:[()=>[{label:"",value:""},...kP(e).map((e=>({label:e,value:e})))]],onChange:t=>Qv(this,void 0,void 0,(function*(){let i=t.value,n=i.substring(i.lastIndexOf(" ")+1),r=e.getObjectByProperty("uuid",n),o=s.app;if(r&&o){const e=yield o.getConfigPane();let t=LP(r);e.appendChild(t)}}))},{type:"button",label:"父对象",value:()=>Qv(this,void 0,void 0,(function*(){let t=s.app,i=e.parent;if(i&&t){const e=yield t.getConfigPane();let n=LP(i);e.appendChild(n)}}))},{type:"button",label:"所属实体",hidden:()=>!e._owner_entity,value:()=>Qv(this,void 0,void 0,(function*(){let t=s.app,i=Ek(e,!0);if(!i)return;const n=yield t.getConfigPane();let r=i.uiConfig;if(r)return void n.appendChild(r);let o=i.node;if(o&&t){let e=LP(o);n.appendChild(e)}}))},{type:"button",label:"创建关联的实体对象",hidden:()=>e._owner_entity,value:()=>Qv(this,void 0,void 0,(function*(){let t=s.app,i=new UP({node:e});i.addTo(t);const n=yield t.getConfigPane();let r=i.uiConfig;r&&n.appendChild(r)}))},{type:"button",label:"所属应用",hidden:()=>"Scene"!==e.type,value:()=>Qv(this,void 0,void 0,(function*(){let e=s.app;if(e){const t=yield e.getConfigPane();let i=e.uiConfig;i&&t.appendChild(i)}}))},{type:"button",label:"适合屏幕",value:()=>{var t;s.app&&((null===(t=s.app)||void 0===t?void 0:t.isMapMode)?BP.fitToObject(s.app.map,e):s.app.Input.getKeyPressed("ControlLeft")?s.app.cameraControl.fitToBox(e,!0):s.app.cameraControl.fitToSphere(e,!0))}},{type:"button",label:"闪烁",value:()=>Qv(this,void 0,void 0,(function*(){if(!s.app)return;if(e.userData._isFlashing)return;e.userData._isFlashing=!0;let t=e.visible;for(let t=0;t<10;t++)e.visible=!e.visible,yield xv(100);e.visible=t,delete e.userData._isFlashing}))},{type:"folder",label:"旋转模型",children:["X +","X -","Y +","Y -","Z +","Z -"].map((t=>({type:"button",label:"Rotate "+t+"10",value:()=>{e.rotateOnAxis(new i(t.includes("X")?1:0,t.includes("Y")?1:0,t.includes("Z")?1:0),Math.PI/18*(t.includes("-")?-1:1)),e.dispatchEvent({type:"uiConfigChange",refreshScene:!0,refreshUi:!1})}})))},{type:"button",label:"控制台输出对象信息",value:()=>{console.log(e)}},{type:"input",label:"搜索的UUID或名称",hidden:()=>!e.isScene,property:[n,"value"]},{type:"button",hidden:()=>!e.isScene,label:"搜索子实体",onClick:()=>Qv(this,void 0,void 0,(function*(){let t,i=n.value;if(i&&(e.traverse((e=>{(e.uuid==i||e.name==i)&&(t||(t=e))})),t||e.traverse((e=>{(e.uuid.indexOf(i)>=0||e.name.indexOf(i)>=0)&&(t||(t=e))})),t)){let e=s.app;const i=yield e.getConfigPane();let n=LP(t);i.appendChild(n)}}))},{type:"button",label:"删除对象",value:()=>Qv(this,void 0,void 0,(function*(){let t=e.parent,i=e._owner_entity;if(i?i.remove():e.parent.remove(e),!s.app)return;const n=yield s.app.getConfigPane();let r=LP(null!=t?t:s.app.scene);r&&n.appendChild(r)}))}]};if((e.isLine||e.isMesh)&&!1!==t){const t=[()=>{const t=Object.entries(e.morphTargetDictionary||{});return t.length?{label:"Morph Targets",type:"folder",children:t.map((([t,i])=>({type:"slider",label:t,bounds:[0,1],stepSize:1e-4,property:[e.morphTargetInfluences,i],onChange:t=>{e.dispatchEvent({type:"uiConfigChange",uiChangeEvent:t,refreshScene:t.last,frameFade:!1,refreshUi:!1})}})))}:void 0},()=>WT(e.geometry),()=>Array.isArray(e.material)?e.material.length<1?void 0:{label:"材质",type:"folder",children:e.material.map((t=>HT(t,e))).filter((e=>e))}:HT(e.material,e)];s.children.push(...t)}let r={ArrowHelper:Xe,AxesHelper:Qe,Box3Helper:qe,BoxHelper:Ze,CameraHelper:Ke,DirectionalLightHelper:Je,GridHelper:_,HemisphereLightHelper:$e,PlaneHelper:et,PointLightHelper:tt,PolarGridHelper:it,SkeletonHelper:nt,SpotLightHelper:st};return e.type.indexOf("Light")>0&&s.children.push({type:"checkbox",label:"lightHelper",hidden:()=>!(e.type+"Helper"in r),getValue:()=>!!s.app&&s.app.scene.children.findIndex((t=>t.type.indexOf("LightHelper")>0&&t.light==e))>=0,setValue:t=>{var i,n;if(t){if(e.type+"Helper"in r){const t=new r[e.type+"Helper"](e,5);null===(i=s.app)||void 0===i||i.scene.add(t)}}else{if(!s.app)return;let t=s.app.scene.children.find((t=>t.type.indexOf("LightHelper")>0&&t.light==e));t&&(null===(n=s.app)||void 0===n||n.scene.remove(t))}}}),e.isLight&&s.children.push(wP(e)),e.uiConfig=s,s}function zP(e){if(!e)return{};if(e.uiConfig)return e.uiConfig;let t=e.isPerspectiveCamera,n=e;const s={type:"folder",expanded:!0,label:()=>n.name||"Camera",onChange:()=>{n.updateProjectionMatrix(),n.updateMatrixWorld()},children:[{type:"slider",label:"fov",bounds:[1,180],stepSize:.01,property:[n,"fov"]},{type:"slider",label:"zoom",bounds:[.001,10],stepSize:.01,property:[n,"zoom"]},{type:"vec3",label:"position",property:[n,"position"]},{type:"vec3",label:"rotation",property:[n,"rotation"]},{type:"vec3",label:"target",getValue:()=>new i(0,0,0),setValue:e=>{n.lookAt(e)}},{type:"number",label:"near",property:[n,"near"],hidden:()=>!t},{type:"number",label:"far",property:[n,"far"],hidden:()=>!t},{type:"number",label:"left",property:[n,"left"],hidden:()=>t},{type:"number",label:"right",property:[n,"right"],hidden:()=>t},{type:"number",label:"top",property:[n,"top"],hidden:()=>t},{type:"number",label:"bottom",property:[n,"bottom"],hidden:()=>t},{type:"input",label:"aspect",property:[n,"aspect"],disabled:!0}]};return e.uiConfig=s,s}CP=new WeakMap,AP=new WeakMap,function(e){e[e.Disable=0]="Disable",e[e.Allow=1]="Allow",e[e.AllowOnlyChilds=2]="AllowOnlyChilds"}(PP||(PP={}));class UP extends Nw{constructor(e){var t,i;super(e),EP.add(this),this.entityType="Entity",this.isEntity=!0,this._childrens=[],this._sceneData={},this.signal={onBeforeAdd:new cy,onAdd:new cy,onBeforeRemove:new cy,onRemove:new cy,onRayIntersect:new cy,onMouseUp:new cy,onMouseMove:new cy,onMouseDown:new cy,onMouseClick:new cy,onMouseDblClick:new cy,onMouseOver:new cy,onMouseOut:new cy,onMouseEnter:new cy,onMouseLeave:new cy,onPointerDown:new cy,onPointerMove:new cy,onPointerUp:new cy,onPointerDownUp:new cy,onPointerCancel:new cy,onMouseWheel:new cy,onKeyDown:new cy,onKeyUp:new cy},(e=null!=e?e:{}).modules=null!==(t=e.modules)&&void 0!==t?t:UP.defaultModules,this.options=null!=e?e:{},this._node=null!==(i=this.options.node)&&void 0!==i?i:new u,this._node._owner_entity=this,this._pointerEventsRef=bg(),this._positionRef=lg(this._node.position),this._rotationRef=lg(this._node.rotation),this._quaternionRef=lg(this._node.quaternion),this._scaleRef=lg(this._node.scale),this._matrixRef=lg(this._node.matrix),this._matrixWorldRef=lg(this._node.matrixWorld),this._visualRef=bg(this._node.visible),this._selectedRef=bg(!1),this._bloomRef=bg(!1),this._outlineRef=bg(!1),this._boxHelperRef=bg(!1),e.node&&(this.node=e.node),e.object3ds&&this.addObjects(e.object3ds),this.effectScope((()=>{ev((()=>this.app),((e,t)=>{t&&this.traverse((e=>{e.modules.forEach((e=>t.moduleManager.removeModule(e)))})),e&&this.traverse((t=>{t.modules.forEach((t=>e.moduleManager.addModule(t)))}))}),{immediate:!0}),ev(this._pointerEventsRef,((e,t)=>{this.app?e?this.app.addPointerEventsObject&&this.app.addPointerEventsObject(this):this.app.removePointerEventsObject&&this.app.removePointerEventsObject(this):this.onSetApp.addOne((()=>{this.pointerEvents&&this.app.addPointerEventsObject&&this.app.addPointerEventsObject(this)}))}))}));for(const t of e.modules)Array.isArray(t)?"string"==typeof t[1]&&t[1]in e?this.addModule(t[0],e[t[1]]):this.addModule(t[0],t[1]):this.addModule(t)}static create(e){return new UP(e)}static fromModule(e,t){return Array.isArray(e)?new UP({modules:e}):new UP({modules:[[e,t]]})}static getOwerEntity(e,t){let i,n=e;for(;n;){let s=n._owner_entity;if(s&&!s.isSceneRootEntity){if(!i&&t)return s;i=s}n=e.parent}return i}get isDisposed(){return this._isDisposed}get visibleRef(){return this._visualRef}get visible(){return this.node.visible}set visible(e){this.node.visible=e,this._visualRef.value=e}get selectedRef(){return this._selectedRef}get selected(){return this._selectedRef.value}set selected(e){e!=this.selectedRef.value&&(this._selectedRef.value=e,this.onEntityAwake((t=>{e?t.addSelectedEntity(this):t.removeSelectEntity(this)})))}get bloomRef(){return this._bloomRef}get bloom(){return this._bloomRef.value}set bloom(e){e!=this._bloomRef.value&&(this._bloomRef.value=e,this.onEntityAwake((t=>{e?t.addBloomEntity(this):t.removeBloomEntity(this)})))}get outlineRef(){return this._outlineRef}get outline(){return this._outlineRef.value}set outline(e){e!=this._outlineRef.value&&(this._outlineRef.value=e,this.onEntityAwake((t=>{e?t.addOutlineEntity(this):t.removeOutlineEntity(this)})))}get boxHelperRef(){return this._boxHelperRef}get boxHelper(){return this._boxHelperRef.value}set boxHelper(e){var t;let i;e&&"boolean"!=typeof e&&(i=e,e=!0),e!=this._boxHelperRef.value&&(this._boxHelperRef.value=!!e,e?this._boxHelperObject||(this._boxHelperObject=new zD(this.node,Object.assign(Object.assign({},null===(t=this.app.envConfig)||void 0===t?void 0:t.boxHelper),i)),this.addObjects(this._boxHelperObject)):this._boxHelperObject&&(this.removeObjects(this._boxHelperObject),this._boxHelperObject.dispose(),delete this._boxHelperObject))}get castShadow(){return this.node.castShadow}set castShadow(e){this.node.castShadow=e}get receiveShadow(){return this.node.receiveShadow}set receiveShadow(e){this.node.receiveShadow=e}get frustumCulled(){return this.node.frustumCulled}set frustumCulled(e){this.node.frustumCulled=e}get position(){return this._positionRef}get scale(){return this._scaleRef}get rotation(){return this._rotationRef}get quaternion(){return this._quaternionRef}get matrix(){return this._matrixRef}get matrixWorld(){return this._matrixWorldRef}get parent(){return this.data.parent}set parent(e){this.data.parent=e}get pointerEvents(){return this._pointerEventsRef.value}get pointerEventsRef(){return this._pointerEventsRef}set pointerEvents(e){this._pointerEventsRef.value=e}get node(){return this._node}set node(e){this._node=e}get rayIntersectRecursive(){var e;return null===(e=this._rayIntersectRecursive)||void 0===e||e}set rayIntersectRecursive(e){this._rayIntersectRecursive=e}get rayQueryType(){var e;return null!==(e=this._rayQueryType)&&void 0!==e?e:PP.Allow}set rayQueryType(e){this._rayQueryType=e}onEntityAwake(e){this.app?e(this.app):this.addDispose(this.onSetApp.addOne((t=>e(t))))}tween(e){return new ky(this).setId(e)}addObjects(e){Array.isArray(e)||(e=[e]),this.node.add(...e)}removeObjects(e){var t;Array.isArray(e)||(e=[e]),null===(t=this.app)||void 0===t||t.callModules("onAppBeforeRemoveObject",e,this);let i=new Set;e.forEach((e=>{var t;null===(t=null==e?void 0:e.parent)||void 0===t||t.remove(e),lW(e),e.traverse((e=>{!e.isMarker2D&&!e.isMarker3D||e.userData.__disposed||i.add(e)}))})),i.forEach((e=>{e.userData.__disposed=!0,e.remove()})),e.forEach((e=>{var t;return null===(t=this.app)||void 0===t?void 0:t.callModules("onAppRemoveObject",e,this)}))}addChildEntity(e){this._childrens.includes(e)||(e.parent&&e.parent!==this&&e.parent.removeChildEntity(e),e.parent=this,e.app=this.app,this._childrens.push(e),this.addObjects(e.node))}removeChildEntity(e){this._childrens.includes(e)&&(this.removeObjects(e.node),hv(this._childrens,e))}addTo(e,t){return qv(this,EP,"m",TP).call(this,e,null,t)}static attchObject(e,t,i,n){if(!0!==i&&e._owner_entity)return e._owner_entity;let s=t?Ak(e,!0):UP.fromObject3d(e);return null!=n||(n=Cy.app),qv(s,EP,"m",TP).call(s,n,!0),s}remove(){var e,t;this.callModules("onBeforeRemove",this),null===(e=this.app)||void 0===e||e.callModules("onAppBeforeRemoveEntity",this),this.selected=!1,this.bloom=!1,this.outline=!1,this.boxHelper=!1,this._childrens.forEach((e=>e.remove())),this.removeAllModules(),this.removeObjects(this.node),this.callModules("onRemove",this),null===(t=this.app)||void 0===t||t.callModules("onAppRemoveEntity",this),this.parent=null,this._isDisposed=!0}get childrens(){return this._childrens||[]}set childrens(e){this._childrens=e||[]}traverse(e,t){const i=n=>{for(let e=0;e<n.childrens.length;e++)i(n.childrens[e]);e&&(t?!0===t(n)&&e(n):e(n))};i(this)}traverseVisible(e,t){const i=n=>{for(let e=0;e<n.childrens.length;e++)i(n.childrens[e]);e&&(t?n.visible&&!0===t(n)&&e(n):e(n))};i(this)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByUuid(e){return this.getObjectByProperty("uuid",e)}getObjectsByName(e){return this.getObjectsByProperty("name",e)}getObjectByProperty(e,t){return this.node.getObjectByProperty(e,t)}getObjectsByProperty(e,t){return this.node.getObjectsByProperty(e,t)}getEntityByName(e){return this.getEntityByProperty("name",e)}getEntityById(e){return this.getEntityByProperty("id",e)}getEntityByUuid(e){return this.getEntityByProperty("uuid",e)}getMeshEntityByProperty(e,t){let i=this.getEntityByProperty(e,t);if(null==i?void 0:i.isLikeMeshEntity())return i}getMeshEntityByName(e){let t=this.getEntityByProperty("name",e);if(null==t?void 0:t.isLikeMeshEntity())return t}getMeshEntityById(e){let t=this.getEntityByProperty("id",e);if(null==t?void 0:t.isLikeMeshEntity())return t}getMeshEntityByUuid(e){let t=this.getEntityByProperty("uuid",e);if(null==t?void 0:t.isLikeMeshEntity())return t}getEntitiesByName(e){return this.getEntitiesByProperty("name",e)}getEntityByProperty(e,t){let i=this.getObjectByProperty(e,t);if(i)return Ek(i)}getEntitiesByProperty(e,t){return this.getObjectsByProperty(e,t).map((e=>Ek(e)))}getObjectPropertyValueCount(e){let t=new Map;return this.node.traverse((i=>{let n=i[e];null!=n&&(t.has(n)?t.set(n,t.get(n)+1):t.set(n,1))})),t}getEntitiesByModule(e){Array.isArray(e)||(e=[e]);let t=[];return this.traverse((e=>t.push(e)),(t=>{for(let i=0;i<e.length;i++)if(!t.getModule(e[i]))return!1;return!0})),t}isLikeMeshEntity(){return this.isMeshEntity&&!!this.getModule(mA)}getMeshEntities(){let e=[];return this.traverse((t=>e.push(t)),(e=>e.isLikeMeshEntity())),e}getLeafEntities(){let e=[];return this.traverse((t=>e.push(t)),(e=>0==e.childrens.length)),e}getPointerEventsEntities(e){let t=[];if(!0!==e)return this.traverse((e=>{t.push(e)}),(e=>!0===e.pointerEvents)),t;let i={},n={};this.traverse((e=>{i[e.uuid]=e.pointerEvents,n[e.uuid]=e}),(e=>0==e.childrens.length));const s=(e,t,i)=>{if(!e)return;let n=e.parent;if(!n)return;if(t.entity)return;let r=!0;n.traverse((e=>{void 0!==e.pointerEvents&&e!=n&&(r=!1)})),r&&(n.traverse((e=>{i.add(e.uuid)})),i.add(n.uuid),!0===n.pointerEvents?t.entity=n:void 0===n.pointerEvents&&s(n.parent,t,i))};for(;0!=Object.keys(n).length;){const e=Object.keys(n),i=e[0];let r=n[i];if(delete n[i],!0===r.pointerEvents)t.push(r);else if(void 0===r.pointerEvents){let i={entity:null},o=new Set;if(s(r,i,o),i.entity){t.push(i.entity);for(let t of e)o.has(t)&&delete n[t]}}}return t}addEdges(e,t){this.getMeshEntities().forEach((i=>i.addEdges(e,t)))}clearEdges(){this.getMeshEntities().forEach((e=>e.clearEdges()))}replaceMaterial(e){this.getMeshEntities().forEach((t=>t.replaceMaterial(e)))}resetMaterial(){this.getMeshEntities().forEach((e=>e.resetMaterial()))}isHighlight(){let e=this.getMeshEntities();if(0==e.length)return!1;let t=!0;return e.forEach((e=>{t&&(t=e.isHighlight())})),t}setHighlight(e,t){this.getMeshEntities().forEach((i=>i.setHighlight(e,t)))}clearHighlight(){this.getMeshEntities().forEach((e=>e.clearHighlight()))}setOpacity(e,t){this.getMeshEntities().forEach((i=>i.setOpacity(e,t)))}isFireEventsByIntersect(e,t){return!1}getBoundingBox(e,t){return dW(this.node,e,this.app,t)}addAction(e,t){let i=this.addModule(lz).addAction(e,t);return()=>{this.removeAction(i)}}removeAction(e){var t;if(this._actionAminateId&&this._actionAminateId[e])null===(t=this.app)||void 0===t||t.tweenManager.stopById(e),delete this._actionAminateId[e];else{let t=this.addModule(lz);null==t||t.removeBehaviorById(e)}}addAnimationAction(e,t,i){var n;let s=zy(Object.assign(Object.assign({id:null!=i?i:uv()},e),{onProgress(e,i,n,s,r,o){null==t||t({entity:this,alpha:r,reversed:o,isComplete:!1,isEnd:!1,isStop:!1})},onComplete:(e,i,n)=>{null==t||t({entity:this,alpha:e.value,reversed:!1,isComplete:!0,isEnd:i,isStop:n}),(n||i)&&setTimeout((()=>{var e;null===(e=this.app)||void 0===e||e.tweenManager.stopById(s.id),this._actionAminateId&&delete this._actionAminateId[s.id]}),10)}}));const r=()=>{var e;this._actionAminateId&&this._actionAminateId[s.id]&&(null===(e=this.app)||void 0===e||e.tweenManager.stopById(s.id),delete this._actionAminateId[s.id])};return null!==(n=this._actionAminateId)&&void 0!==n||(this._actionAminateId={}),this._actionAminateId[s.id]=!0,this.signal.onRemove.addOne((()=>{r()})),{stop:r,animation:zy}}toJSON(){var e;return{metadata:{version:1,type:"Object"},object:{uuid:this.uuid,selected:this.selected,bloom:this.bloom,outline:this.outline,boxHelper:this.boxHelper,rayIntersectRecursive:this.rayIntersectRecursive,node:{uuid:this.node.uuid},modules:this.modules.map((e=>{var t;return{moduleName:e.constructor.moduleName,metadata:{version:1,type:"Module"},module:null===(t=e.toJSON)||void 0===t?void 0:t.call(e)}})),childrens:(null!==(e=this.childrens)&&void 0!==e?e:[]).map((e=>{var t;return null===(t=e.toJSON)||void 0===t?void 0:t.call(e)}))}}}static fromJSON(e,t){var i,n,s;if(!e||!(null==e?void 0:e.object))return;let r,o=e.object,a=null===(i=o.node)||void 0===i?void 0:i.uuid;a&&(r=t.get(a));let l=new UP({node:r});o.selected&&(l.selected=o.selected),o.bloom&&(l.bloom=o.bloom),o.outline&&(l.outline=o.outline),o.boxHelper&&(l.boxHelper=o.boxHelper),o.rayIntersectRecursive&&(l.rayIntersectRecursive=o.rayIntersectRecursive);let h=null!==(n=o.modules)&&void 0!==n?n:[],c=Array.from(KH.registerModules);return h.forEach((e=>{var i;let n=e.moduleName;if(!n)return;let s=c.find((e=>e.moduleName==n));if(!s)return;let r=l.add(s,{});null===(i=null==r?void 0:r.fromJSON)||void 0===i||i.call(r,e.module,t)})),(null!==(s=o.childrens)&&void 0!==s?s:[]).forEach((e=>{let i=UP.fromJSON(e,t);i&&l.addChildEntity(i)})),l}setupUiConfig(){let e=[];return{type:"folder",label:()=>this.entityType||"Entity",expanded:!0,children:[()=>LP(this.node),{type:"folder",expanded:!0,label:()=>"实体属性 - "+this.uuid,children:[{type:"checkbox",label:"选中",property:[this,"selected"]},{type:"checkbox",label:"辉光",property:[this,"bloom"]},{type:"checkbox",label:"描边",property:[this,"outline"]},{type:"checkbox",label:"包围盒",getValue:()=>this.boxHelper,setValue:e=>{this.boxHelper=e?{fillOpacity:0}:e}},{type:"checkbox",label:"高亮",getValue:()=>this.isHighlight(),setValue:e=>e?this.setHighlight():this.clearHighlight()},{type:"checkbox",label:"接收事件",property:[this,"pointerEvents"]},{type:"checkbox",label:"射线相交递归查询",property:[this,"rayIntersectRecursive"]},{type:"slider",label:"透明度",value:1,bounds:[0,1],stepSize:.01,onChange:e=>{this.setOpacity(e.value)}},{type:"checkbox",label:"模型边框线",value:!1,onChange:e=>{e.value?this.addEdges():this.clearEdges()}},{type:"color",label:"模型边框线颜色",getValue:()=>0,setValue:e=>{this.clearEdges(),0!=e&&this.addEdges({color:e})}},{type:"dropdown",label:"子实体",hidden:()=>0==this.childrens.length,property:[{index:-1},"index"],children:[()=>{let e=-1,t=[{label:"",value:e++}];return t.push(...this.childrens.map((t=>({label:t.uuid,value:e++})))),t}],onChange:e=>Qv(this,void 0,void 0,(function*(){let t=e.value;if(t<0||t>=this.childrens.length)return;let i=this.childrens[t];this.app&&(yield this.app.getConfigPane()).appendChild(null==i?void 0:i.uiConfig)}))},{type:"button",label:"父实体",hidden:()=>!this.parent,value:()=>Qv(this,void 0,void 0,(function*(){if(!this.app)return;let e=this.parent;e&&this.app&&(yield this.app.getConfigPane()).appendChild(e.uiConfig)}))}]},()=>{let t=this.modules||[];return{type:"folder",app:this.app,expanded:!0,label:()=>"实体模块",children:[...t.map((t=>({type:"folder",expanded:!1,label:t.constructor.moduleName,children:[{type:"checkbox",label:"启用模块",getValue:()=>this.modules.indexOf(t)>=0,setValue:i=>{var n,s;let r=t.extData.moduleParamerter;if(null==r?void 0:r.cls){i?this.addModule(r.cls,r.param):this.removeModule(r.cls);let o=e.findIndex((e=>e.moduleName==t.constructor.moduleName));i?o>=0&&e.splice(o,1):-1==o?e.push(Object.assign({moduleName:t.constructor.moduleName},r)):e[o]=Object.assign({moduleName:t.constructor.moduleName},r),null===(s=null===(n=this.uiConfig)||void 0===n?void 0:n.uiRefresh)||void 0===s||s.call(n,!1,void 0,1)}}},()=>{let e=t.uiConfig;if(e)return e.hidden=()=>-1==this.modules.indexOf(t),e}]}))),...e.filter((e=>-1==t.findIndex((t=>t.constructor.moduleName==e.moduleName)))).map((t=>({type:"folder",expanded:!1,label:t.moduleName,children:[{type:"checkbox",label:"启用模块",getValue:()=>!1,setValue:i=>{var n,s;i&&(this.addModule(t.cls,t.param),hv(e,t),null===(s=null===(n=this.uiConfig)||void 0===n?void 0:n.uiRefresh)||void 0===s||s.call(n,!1,void 0,1))}}]})))]}},{type:"button",label:"删除实体",value:()=>Qv(this,void 0,void 0,(function*(){let e=this.parent;this.remove();const t=yield this.app.getConfigPane();if(e&&this.app)t.appendChild(e.uiConfig);else{let e=LP(this.app.scene);e&&t.appendChild(e)}}))}]}}}EP=new WeakSet,TP=function(e,t,i){if(!this.node)throw new Error("object is null");let n;return delete this._isDisposed,e&&(e.isApp?(this.app=e,n=this.app.sceneEntity):e.isEntity?(this.app||(this.app=e.app),n=e):e.isObject3D&&(this.app||(this.app=i),n=e)),!this.app&&i&&(this.app=i),this.onEntityAwake((i=>{var s,r;this.traverse((e=>{e.app=i,e.modules.forEach((e=>e.app=i))})),(e.isApp||e.isObject3D)&&(this.callModules("onBeforeAdd",n,this),null===(s=this.app)||void 0===s||s.callModules("onAppBeforeAddEntity",this),t||(e.isObject3D?n.add(this.node):this.app.scene.add(this.node)),this.callModules("onAdd",n,this),null===(r=this.app)||void 0===r||r.callModules("onAppAddEntity",this)),aW(this.node)})),e.isEntity&&(this.callModules("onBeforeAdd",n,this),e.addChildEntity(this),this.callModules("onAdd",n,this)),this},UP.defaultModules=[],UP.fromObject3d=e=>Array.isArray(e)?new UP({object3ds:e}):new UP({node:e}),UP.fromObjectModule=(e,t,i)=>Array.isArray(e)?Array.isArray(t)?new UP({modules:t,object3ds:e}):new UP({modules:[[t,i]],object3ds:e}):Array.isArray(t)?new UP({modules:t,node:e}):new UP({modules:[[t,i]],node:e});class FP extends UP{constructor(e,t){super(Object.assign(Object.assign({},t),{node:e})),this.entityType="MeshEntity",this.isMeshEntity=!0,this.add(mA,{mesh:e}).applyMixinsTo(this,["mesh","rawMaterial","useMaterial","material","addEdges","clearEdges","getEdges","replaceMaterial","resetMaterial","isHighlight","setHighlight","clearHighlight","highlightMaterial","setOpacity","opacityMaterial","setHeatmapDataMaterial"]),(null==t?void 0:t.selected)&&(this.selected=null==t?void 0:t.selected),(null==t?void 0:t.bloom)&&(this.bloom=null==t?void 0:t.bloom),(null==t?void 0:t.outline)&&(this.outline=null==t?void 0:t.outline)}}class NP extends UP{constructor(e){super(Object.assign({},e)),this.entityType="InstancedMeshEntity",this.isInstancedMeshEntity=!0,this.add(vA,e).applyMixinsTo(this)}isFireEventsByIntersect(e,t){return void 0!==e.intersection.instanceId&&void 0!==t.intersection.instanceId&&e.intersection.instanceId!=t.intersection.instanceId}}class jP extends UP{constructor(e){super(Object.assign({},e)),this.entityType="SymbolEntity",this.isSymbolEntity=!0,this.add(FE,e).applyMixinsTo(this)}isFireEventsByIntersect(e,t){return e.intersection.index>=0&&void 0!==t.intersection.index&&e.intersection.index!=t.intersection.index}}class VP extends UP{constructor(e){super(Object.assign({},e)),this.entityType="SpriteAnimatorEntity",this.isSpriteAnimatorEntity=!0,this.add(BL,e).applyMixinsTo(this)}}const HP=new E,WP=new i;class GP extends ve{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new M([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new M([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new ye(t,6,1);return this.setAttribute("instanceStart",new xe(i,3,0)),this.setAttribute("instanceEnd",new xe(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new ye(t,6,1);return this.setAttribute("instanceColorStart",new xe(i,3,0)),this.setAttribute("instanceColorEnd",new xe(i,3,3)),this}setLinewidths(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new ye(t,2,1);return this.setAttribute("instanceLinewidth",new xe(i,1,0)),this}setLineOpacitys(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new ye(t,2,1);return this.setAttribute("instanceLineOpacity",new xe(i,1,0)),this}setDashArguments(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new ye(t,8,1);return this.setAttribute("instanceDashArgs",new xe(i,4,0)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new rt(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new E);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),HP.setFromBufferAttribute(t),this.boundingBox.union(HP))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new P),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let s=0,r=e.count;s<r;s++)WP.fromBufferAttribute(e,s),n=Math.max(n,i.distanceToSquared(WP)),WP.fromBufferAttribute(t,s),n=Math.max(n,i.distanceToSquared(WP));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}_e.line_ext={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new r(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},ot.line_ext={uniforms:at.merge([_e.common,_e.fog,_e.line_ext]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tattribute float instanceLinewidth;\n\t\tattribute float instanceLineOpacity;\n\t\tattribute vec4 instanceDashArgs;\n\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t#endif\n\n\n\t\tvarying vec2 vUv;\n\t\tuniform float dashScale;\n\t\tattribute float instanceDistanceStart;\n\t\tattribute float instanceDistanceEnd;\n\t\tvarying float vLineDistance;\n\n\t\tvarying float v_linewidth;\n\t\tvarying float v_lineOpacity;\n\t\tvarying vec4 v_dashArgs;\n\n\t\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\t\t\tv_linewidth = instanceLinewidth;\n\t\t\tv_lineOpacity = instanceLineOpacity;\n\t\t\tv_dashArgs = instanceDashArgs;\n\t\t\t\n\t\t\tbool useDash= instanceDashArgs.x !=0.;\n\t\t\tfloat a_dashScale = instanceDashArgs.x;\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\tif (useDash) {\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? a_dashScale * instanceDistanceStart : a_dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\t\t\t}\n\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 offset;\n\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t}\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\tif(!useDash) {\n\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\tstart.xyz += - worldDir * instanceLinewidth * 0.5;\n\t\t\t\t\tend.xyz += worldDir * instanceLinewidth * 0.5;\n\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t}\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= instanceLinewidth * 0.5;\n\n\t\t\t\t// set the world position\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= instanceLinewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\tvarying float vLineDistance;\n\t\tvarying float v_linewidth;\n\t\tvarying float v_lineOpacity;\n\t\tvarying vec4 v_dashArgs;\n\n\t\tvarying vec2 vUv;\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t\n\n\t\t\tbool useDash = v_dashArgs.x !=0.;\n\t\t\tfloat a_dashScale = v_dashArgs.x;\n\t\t\tfloat a_dashOffset = v_dashArgs.y;\n\t\t\tfloat a_gapSize = v_dashArgs.z;\n\t\t\tfloat a_dashSize = v_dashArgs.w;\n    \n\t\t\tif (useDash) {\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + a_dashOffset, a_dashSize + a_gapSize ) > a_dashSize ) discard; // todo - FIX\n\n\t\t\t}\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / v_linewidth;\n\n\t\t\t\tif (!useDash) {\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t}\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\tgl_FragColor=vec4(diffuseColor.rgb,alpha * v_lineOpacity);\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <colorspace_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class YP extends a{constructor(e){super({type:"LineMaterial",uniforms:at.clone(ot.line_ext.uniforms),vertexShader:ot.line_ext.vertexShader,fragmentShader:ot.line_ext.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){!0===e!==this.dashed&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(!0===e!==this.alphaToCoverage&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const XP=new i,QP=new i,qP=new y,ZP=new y,KP=new y,JP=new i,$P=new n,eO=new A,tO=new i,iO=new E,nO=new P,sO=new y;let rO,oO;function aO(e,t,i){return sO.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),sO.multiplyScalar(1/sO.w),sO.x=oO/i.width,sO.y=oO/i.height,sO.applyMatrix4(e.projectionMatrixInverse),sO.multiplyScalar(1/sO.w),Math.abs(Math.max(sO.x,sO.y))}class lO extends h{constructor(e=new GP,t=new YP({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let e=0,s=0,r=t.count;e<r;e++,s+=2)XP.fromBufferAttribute(t,e),QP.fromBufferAttribute(i,e),n[s]=0===s?0:n[s-1],n[s+1]=n[s]+XP.distanceTo(QP);const s=new ye(n,2,1);return e.setAttribute("instanceDistanceStart",new xe(s,1,0)),e.setAttribute("instanceDistanceEnd",new xe(s,1,1)),this}raycast(e,t){const n=this.material.worldUnits,s=e.camera;null!==s||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=void 0!==e.params.Line2&&e.params.Line2.threshold||0;rO=e.ray;const a=this.matrixWorld,l=this.geometry,h=this.material;let c,d;oO=h.linewidth+r,null===l.boundingSphere&&l.computeBoundingSphere(),nO.copy(l.boundingSphere).applyMatrix4(a),c=n?.5*oO:aO(s,Math.max(s.near,nO.distanceToPoint(rO.origin)),h.resolution),nO.radius+=c,!1!==rO.intersectsSphere(nO)&&(null===l.boundingBox&&l.computeBoundingBox(),iO.copy(l.boundingBox).applyMatrix4(a),d=n?.5*oO:aO(s,Math.max(s.near,iO.distanceToPoint(rO.origin)),h.resolution),iO.expandByScalar(d),!1!==rO.intersectsBox(iO)&&(n?function(e,t){const n=e.matrixWorld,s=e.geometry,r=s.attributes.instanceStart,o=s.attributes.instanceEnd;for(let a=0,l=Math.min(s.instanceCount,r.count);a<l;a++){eO.start.fromBufferAttribute(r,a),eO.end.fromBufferAttribute(o,a),eO.applyMatrix4(n);const s=new i,l=new i;rO.distanceSqToSegment(eO.start,eO.end,l,s),l.distanceTo(s)<.5*oO&&t.push({point:l,pointOnLine:s,distance:rO.origin.distanceTo(l),object:e,face:null,faceIndex:a,uv:null,uv1:null})}}(this,t):function(e,t,n){const s=t.projectionMatrix,r=e.material.resolution,a=e.matrixWorld,l=e.geometry,h=l.attributes.instanceStart,c=l.attributes.instanceEnd,d=Math.min(l.instanceCount,h.count),u=-t.near;rO.at(1,KP),KP.w=1,KP.applyMatrix4(t.matrixWorldInverse),KP.applyMatrix4(s),KP.multiplyScalar(1/KP.w),KP.x*=r.x/2,KP.y*=r.y/2,KP.z=0,JP.copy(KP),$P.multiplyMatrices(t.matrixWorldInverse,a);for(let t=0,l=d;t<l;t++){if(qP.fromBufferAttribute(h,t),ZP.fromBufferAttribute(c,t),qP.w=1,ZP.w=1,qP.applyMatrix4($P),ZP.applyMatrix4($P),qP.z>u&&ZP.z>u)continue;if(qP.z>u){const e=qP.z-ZP.z,t=(qP.z-u)/e;qP.lerp(ZP,t)}else if(ZP.z>u){const e=ZP.z-qP.z,t=(ZP.z-u)/e;ZP.lerp(qP,t)}qP.applyMatrix4(s),ZP.applyMatrix4(s),qP.multiplyScalar(1/qP.w),ZP.multiplyScalar(1/ZP.w),qP.x*=r.x/2,qP.y*=r.y/2,ZP.x*=r.x/2,ZP.y*=r.y/2,eO.start.copy(qP),eO.start.z=0,eO.end.copy(ZP),eO.end.z=0;const l=eO.closestPointToPointParameter(JP,!0);eO.at(l,tO);const d=o.lerp(qP.z,ZP.z,l),p=d>=-1&&d<=1,f=JP.distanceTo(tO)<.5*oO;if(p&&f){eO.start.fromBufferAttribute(h,t),eO.end.fromBufferAttribute(c,t),eO.start.applyMatrix4(a),eO.end.applyMatrix4(a);const s=new i,r=new i;rO.distanceSqToSegment(eO.start,eO.end,r,s),n.push({point:r,pointOnLine:s,distance:rO.origin.distanceTo(r),object:e,face:null,faceIndex:t,uv:null,uv1:null})}}}(this,s,t)))}}class hO extends GP{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setColors(i),this}setLinewidths(e){const t=e.length-1,i=new Float32Array(2*t);for(let n=0;n<t;n++)i[2*n]=e[n],i[2*n+1]=e[n+1];return super.setLinewidths(i),this}setLineOpacitys(e){const t=e.length-1,i=new Float32Array(2*t);for(let n=0;n<t;n++)i[2*n]=e[n],i[2*n+1]=e[n+1];return super.setLineOpacitys(i),this}setDashArguments(e){const t=e.length-4,i=new Float32Array(2*t);for(let n=0;n<t;n+=4)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5],i[2*n+6]=e[n+6],i[2*n+7]=e[n+7];return super.setDashArguments(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class cO extends lO{constructor(e=new hO,t=new YP({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}const dO=new i,uO=new i;class pO extends h{constructor(e=new GP,t=new YP({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let e=0,s=0,r=t.count;e<r;e++,s+=2)dO.fromBufferAttribute(t,e),uO.fromBufferAttribute(i,e),n[s]=0===s?0:n[s-1],n[s+1]=n[s]+dO.distanceTo(uO);const s=new ye(n,2,1);return e.setAttribute("instanceDistanceStart",new xe(s,1,0)),e.setAttribute("instanceDistanceEnd",new xe(s,1,1)),this}}class fO extends GP{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new rt(e))}}var mO,gO,vO,yO,xO,wO,bO,_O,SO,MO,CO,AO,EO,TO,PO,OO,DO,BO,IO,RO,kO,LO,zO,UO,FO,NO,jO,VO,HO;class WO extends Sy{constructor(e,t){var i,n,s;super(e),mO.add(this),this.highlightIndexMap=new Map,this.facePosIndex=new Map,gO.set(this,0),t.style=null!==(i=t.style)&&void 0!==i?i:{},this.style=Object.assign({color:16777215,linewidth:1,worldUnits:!1,vertexColors:!0,alphaToCoverage:!0,transparent:!0},t.style),this.highlightStyle=Object.assign({color:16777215,linewidth:3,worldUnits:!1,vertexColors:!0,alphaToCoverage:!0,transparent:!0,opacity:.7},t.highlightStyle),this.showVertex=null!==(n=t.showVertex)&&void 0!==n&&n,this.vertexStyle=null!==(s=t.vertexStyle)&&void 0!==s?s:{},this.vertexStyle=Object.assign({color:16777215,pointSize:10,pointColor:"#fbb03b",pointBorderColor:"#73FBFD",shape:"circle",transparent:!0,opacity:1,borderWidth:1,sizeAttenuation:!1,vertexBorderColor:!0,vertexColors:!0,vertexSize:!0},this.vertexStyle),this.setData(t.data),this.effectScope((()=>qv(this,mO,"m",vO).call(this,this.entity.app))),this.addDispose((()=>{this.vertexEntity&&(this.entity.removeChildEntity(this.vertexEntity),this.vertexEntity=null),qv(this,mO,"m",yO).call(this,!1),qv(this,mO,"m",yO).call(this,!0)}))}setupUiConfig(){return{type:"folder",expanded:!0,label:"模块参数设置",app:this.app,children:[{type:"checkbox",label:"显示顶点",getValue:()=>this.isShowVertex(),setValue:e=>{this.setShowVertex(e)}}]}}getPolylines(){return this.polylines}getVertexSymbol(){return this.vertexEntity}updateStyle(e){for(let t in e)this.polylines.material[t]=e[t],this.polylines.material[t].needsUpdate=!0;this.style=Object.assign({},e)}updateHightStyle(e){for(let t in e)this.highlightPolylines.material[t]=e[t],this.highlightPolylines.material[t].needsUpdate=!0;this.style=Object.assign({},e)}setData(e){qv(this,mO,"m",xO).call(this,e,!1),this.setShowVertex(this.showVertex)}isShowVertex(){return this.showVertex}getVertexData(e){let t=[];for(let i=0;i<this.data.length;i++){let n=this.data[i];if(!0!==n.hidden&&(!0===e||!1!==n.showVertex))for(let e=0;e<n.coordinates.length;e++){let s={position:n.coordinates[e]};s.color=this.vertexStyle.pointColor,s.borderColor=this.vertexStyle.pointBorderColor,s.size=this.vertexStyle.pointSize,s.id=`${i}-${e}`,t.push(s)}}return t}setShowVertex(e,t){if(this.showVertex=e,this.showVertex?this.vertexEntity||(this.vertexEntity=new jP(Object.assign({data:[],style:this.vertexStyle,pixelRaycasting:!0},t)),this.vertexEntity.node.renderOrder=1,this.entity.addChildEntity(this.vertexEntity)):this.vertexEntity&&(this.entity.removeChildEntity(this.vertexEntity),this.vertexEntity=null),this.showVertex){let e=this.getVertexData();this.vertexEntity.setData(e)}}getData(){return this.data}getItemDataByFaceIndex(e,t){let i=this.facePosIndex.get(e);if(!i)return;let n=this.data[i.lineIndex];return t?{data:n,positionIndex:i.positionIndex}:Object.assign(Object.assign({},n),{positionIndex:i.positionIndex})}refreshHighlight(){qv(this,mO,"m",xO).call(this,this.highlightData,!0)}setItemHighlight(e,t,i){let n=this.highlightIndexMap.has(e);if(n&&!t){let t=this.highlightData.findIndex((t=>t.id==e));t>=0&&(this.highlightData.splice(this.highlightData.findIndex((t=>t.id==e)),1),this.highlightIndexMap.delete(e))}else if(!n&&t){let t=this.data.findIndex((t=>t.id==e));t>=0&&(this.highlightData.push(this.data[t]),this.highlightIndexMap.set(e,this.highlightIndexMap.size),i||qv(this,mO,"m",xO).call(this,this.highlightData,!0))}}isItemHighlight(e){return this.highlightIndexMap.has(e)}clearHighlight(){qv(this,mO,"m",xO).call(this,[],!0)}}gO=new WeakMap,mO=new WeakSet,vO=function(e){if(!e)return;const{width:t,height:i}=e.containerSize;this.polylines.material.resolution.set(t,i),this.highlightPolylines.material.resolution.set(t,i)},yO=function(e){let t=e?this.highlightPolylines:this.polylines;t&&(this.entity.removeObjects(t),lW(t),t=null)},xO=function e(t,i){var n,r,o,a,l,h,c,d,u;if(i?this.highlightData=t:this.data=t,i){this.highlightIndexMap.clear();for(let e=0;e<t.length;e++)this.highlightIndexMap.set(t[e].id,e)}else this.facePosIndex.clear();let p=i?Object.assign({},this.highlightStyle):Object.assign({},this.style);const f=[],m=[],g=[],v=[],y=[];let x=0,w=new s(i?null!==(n=this.highlightStyle.color)&&void 0!==n?n:1911:16711680),b=[];for(let e=0;e<t.length;e++){let n=t[e];if(!0===n.hidden)continue;n.id=null!==(r=n.id)&&void 0!==r?r:(Zv(this,gO,(u=qv(this,gO,"f"),d=u++,u),"f"),d+"");let p=n.lineWidth||1;p<0&&(p=1),i&&(p+=null!==(o=this.highlightStyle.linewidth)&&void 0!==o?o:3);let _=n.opacity||1,S=[n.dashed?null!==(a=n.dashScale)&&void 0!==a?a:1:0,null!==(l=n.dashOffset)&&void 0!==l?l:0,null!==(h=n.gapSize)&&void 0!==h?h:1,null!==(c=n.dashSize)&&void 0!==c?c:1],M=Array.isArray(n.color);!M&&n.color&&w.set(n.color);for(let t=0;t<n.coordinates.length-1;t++){if(i||this.facePosIndex.set(x++,{lineIndex:e,positionIndex:t}),f.push(n.coordinates[t][0],n.coordinates[t][1],n.coordinates[t][2]),M){let e=new s(n.color[t]);m.push(e.r,e.g,e.b)}else m.push(w.r,w.g,w.b);if(f.push(n.coordinates[t+1][0],n.coordinates[t+1][1],n.coordinates[t+1][2]),M){let e=new s(n.color[t+1]);m.push(e.r,e.g,e.b)}else m.push(w.r,w.g,w.b);g.push(p),g.push(p),v.push(_),v.push(_),y.push(...S),y.push(...S);let r=HW(n.coordinates[t],n.coordinates[t+1]);0==t?b.push(0):b.push(b[b.length-1]),b.push(b[b.length-1]+r)}}let _=new GP;_.setPositions(f),_.setColors(m),_.setLinewidths(g),_.setLineOpacitys(v),_.setDashArguments(y);let S=i?this.highlightPolylines:this.polylines;if(S)S.geometry.dispose(),S.geometry=_;else{let e=new YP(p);S=new lO(_,e),i&&(S.renderOrder=10,pW(S)),this.entity.addObjects(S),i?this.highlightPolylines=S:this.polylines=S,this.entity.onEntityAwake((e=>qv(this,mO,"m",vO).call(this,e)))}const M=new Float32Array(b),C=new ye(M,2,1);if(S.geometry.setAttribute("instanceDistanceStart",new xe(C,1,0)),S.geometry.setAttribute("instanceDistanceEnd",new xe(C,1,1)),!i){let i=[];for(let e=0;e<t.length;e++)this.highlightIndexMap.has(t[e].id)&&i.push(t[e]);qv(this,mO,"m",e).call(this,i,!0)}},WO.moduleName="PolylinesModule";class GO extends UP{constructor(e){super(Object.assign({},e)),this.entityType="PolylinesEntity",this.isPolylinesEntity=!0,this.add(WO,e).applyMixinsTo(this)}isFireEventsByIntersect(e,t){return e.intersection.faceIndex>=0&&void 0!==t.intersection.faceIndex&&e.intersection.faceIndex!=t.intersection.faceIndex}}class YO extends Sy{constructor(e,t){var i,n,s,r,o,a;super(e),wO.add(this),this.highlightIndexMap=new Map,this.facePosIndex=new Map,bO.set(this,new Map),_O.set(this,0),SO.set(this,void 0),t.style=null!==(i=t.style)&&void 0!==i?i:{},Zv(this,SO,null!==(n=t.yOffsetDelta)&&void 0!==n?n:0,"f"),this.isXYPlane=null!==(s=t.isXYPlane)&&void 0!==s?s:CW(),this.useBvh=null===(r=t.useBvh)||void 0===r||r,this.style=Object.assign({color:16777215,side:I,vertexColors:!0,opacity:1,transparent:!0},t.style),this.highlightStyle=Object.assign({vertexColors:!1,color:1911,opacity:.8,transparent:!0,side:I},t.highlightStyle),this.borderStyle=Object.assign({color:16777215,linewidth:2,worldUnits:!1,vertexColors:!0,alphaToCoverage:!0},t.borderStyle),this.showVertex=null!==(o=t.showVertex)&&void 0!==o&&o,this.vertexStyle=null!==(a=t.vertexStyle)&&void 0!==a?a:{},this.vertexStyle=Object.assign({color:16777215,pointSize:10,pointColor:"#fbb03b",pointBorderColor:"#73FBFD",shape:"circle",transparent:!0,opacity:1,borderWidth:1,sizeAttenuation:!1,vertexBorderColor:!0,vertexColors:!0,vertexSize:!0},this.vertexStyle),this.showBorder=t.showBorder,this.setData(t.data),this.effectScope((()=>{qv(this,wO,"m",EO).call(this,this.entity.app)})),this.addDispose((()=>{qv(this,wO,"m",MO).call(this,!1),qv(this,wO,"m",MO).call(this,!0)}))}setupUiConfig(){return{type:"folder",expanded:!0,label:"模块参数设置",app:this.app,children:[{type:"checkbox",label:"显示顶点",getValue:()=>this.isShowVertex(),setValue:e=>{this.setShowVertex(e)}}]}}getPolygons(){return this.polygons}getVertexSymbol(){return this.vertexEntity}getBorderPolyline(){return this.borderPolyline}updateStyle(e){for(let t in e)this.polygons.material[t]=e[t],this.polygons.material[t].needsUpdate=!0;this.style=Object.assign({},e)}updateHightStyle(e){for(let t in e)this.highlightPolygons.material[t]=e[t],this.highlightPolygons.material[t].needsUpdate=!0;this.style=Object.assign({},e)}isShowVertex(){return this.showVertex}getVertexData(e){let t=[];for(let i=0;i<this.data.length;i++){let n=this.data[i];if(!0!==e&&!1===n.showVertex)continue;let s=n.coordinates;if(s.length>0&&s[0].length>0&&Array.isArray(s[0][0])){for(let e=0;e<n.coordinates.length;e++)if(!0!==n.hidden)for(let s=0;s<n.coordinates[e].length;s++){let r={position:[...n.coordinates[e][s]]};r.color=this.vertexStyle.pointColor,r.borderColor=this.vertexStyle.pointBorderColor,r.size=this.vertexStyle.pointSize,r.id=`${i}-${e}-${s}`,t.push(r)}}else for(let e=0;e<n.coordinates.length;e++){if(!0===n.hidden)continue;let s={position:[...n.coordinates[e]]};s.color=this.vertexStyle.pointColor,s.borderColor=this.vertexStyle.pointBorderColor,s.size=this.vertexStyle.pointSize,s.id=`${i}-${e}`,t.push(s)}}return t}setShowVertex(e,t){if(this.showVertex=e,this.showVertex?this.vertexEntity||(this.vertexEntity=new jP(Object.assign({data:[],style:this.vertexStyle,pixelRaycasting:!0},t)),this.vertexEntity.node.renderOrder=1,this.entity.addChildEntity(this.vertexEntity)):this.vertexEntity&&(this.entity.removeChildEntity(this.vertexEntity),this.vertexEntity=null),this.showVertex){let e=this.getVertexData();this.vertexEntity.setData(e)}}setData(e){qv(this,wO,"m",CO).call(this,e,!1),this.setShowVertex(this.showVertex)}getData(){return this.data}getItemDataByFaceIndex(e,t){let i=this.facePosIndex.get(e);if(!i)return;let n=this.data[i.polyIndex];return t?{data:n,face:i.face}:Object.assign(Object.assign({},n),{face:[...i.face]})}refreshHighlight(){qv(this,wO,"m",CO).call(this,this.highlightData,!0)}setItemHighlight(e,t,i){let n=this.highlightIndexMap.has(e);if(n&&!t){let t=this.highlightData.findIndex((t=>t.id==e));t>=0&&(this.highlightData.splice(this.highlightData.findIndex((t=>t.id==e)),1),this.highlightIndexMap.delete(e))}else if(!n&&t){let t=this.data.findIndex((t=>t.id==e));t>=0&&(this.highlightData.push(this.data[t]),this.highlightIndexMap.set(e,this.highlightIndexMap.size),i||qv(this,wO,"m",CO).call(this,this.highlightData,!0))}}isItemHighlight(e){return this.highlightIndexMap.has(e)}clearHighlight(){qv(this,wO,"m",CO).call(this,[],!0)}}bO=new WeakMap,_O=new WeakMap,SO=new WeakMap,wO=new WeakSet,MO=function(e){let t=e?this.highlightPolygons:this.polygons;t&&(this.entity.removeObjects(t),lW(t)),e?this.highlightPolygons=null:(this.polygons=null,this.borderPolyline&&(this.entity.removeObjects(this.borderPolyline),lW(this.borderPolyline),this.borderPolyline=null))},CO=function e(t,n){var o,a,l,c,d,u,p;if(n?this.highlightData=t:this.data=t,n){this.highlightIndexMap.clear();for(let e=0;e<t.length;e++)this.highlightIndexMap.set(t[e].id,e)}else this.facePosIndex.clear();let f=n?Object.assign({},this.highlightStyle):Object.assign({},this.style),m=new s(n?null!==(o=this.highlightStyle.color)&&void 0!==o?o:1911:16711680),g=new s(65535);const v=[],y=[],w=[],b=[],_=[];let C=0,A=0;const T=[],P=[];n||qv(this,bO,"f").clear();let O=new i,D=0;for(let e=0;e<t.length;e++){let i=t[e];if(!0===i.hidden)continue;if(i.id=null!==(a=i.id)&&void 0!==a?a:(Zv(this,_O,(p=qv(this,_O,"f"),u=p++,p),"f"),u+""),Array.isArray(i.color)||m.set(null!==(l=i.color)&&void 0!==l?l:"#ff0000"),n){const e={h:0,s:0,l:0};m.getHSL(e),m.setHSL(e.h,e.s,e.l+.2>1?e.l-.2:e.l+.2)}let o=t[e].coordinates,h=o.length>0&&o[0].length>0&&Array.isArray(o[0][0]),f=[],x=[],S=[];const M=e=>{let t=0,i=0,n=0;for(let s of e)f.push(s[0],s[1],s[2]),t+=s[0],i+=s[1],n+=s[2];O.set(t/e.length,i/e.length,n/e.length);let s=[];for(let t of e)s.push(new r(t[0],t[1]));let o=[];for(let t of e)o.push(new r(t[0],t[2]));let a=[];for(let t of e)a.push(new r(t[1],t[2]));let l=Math.abs(lt.area(s)),h=Math.abs(lt.area(o)),c=Math.abs(lt.area(a)),d=Math.max(l,h,c),u=2;Tv(h,d)?u=1:Tv(c,d)&&(u=0);for(let t of e)2==u?x.push(new r(t[0]-O.x,t[1]-O.y)):1==u?x.push(new r(t[0]-O.x,t[2]-O.z)):x.push(new r(t[1]-O.y,t[2]-O.z));return u},B=(e,t)=>{if(0==e.length)return!0;let i=e[0][t];for(let n=1;n<e.length;n++)if(!Tv(e[n][t],i))return!1;return!0};let I,R=!0,k=new E;if(h){I=M(o[0]),R=B(o,I),k.setFromPoints(o[0].map((e=>Vv(e))));for(let e=1;e<o.length;e++){let t=[];for(let i of o[e])f.push(i[0],i[1],i[2]),2==I?t.push(new r(i[0]-O.x,i[1]-O.y)):1==I?t.push(new r(i[0]-O.x,i[2]-O.z)):t.push(new r(i[1]-O.y,i[2]-O.z));S.push(t)}}else I=M(o),R=B(o,I),k.setFromPoints(o.map((e=>Vv(e))));if(!n&&this.showBorder)if(g.set(null!==(c=i.borderColor)&&void 0!==c?c:"#0x00ffff"),h)for(let e=0;e<o.length;e++)for(let t=0;t<o[e].length-1;t++)3===o[t].length&&(T.push(...o[e][t]),T.push(...o[e][t+1])),P.push(g.r,g.g,g.b),P.push(g.r,g.g,g.b);else for(let e=0;e<o.length-1;e++)3===o[e].length&&(T.push(...o[e]),T.push(...o[e+1])),P.push(g.r,g.g,g.b),P.push(g.r,g.g,g.b);const L=lt.triangulateShape(x,S);let z=lt.isClockWise(x);const U=[];let F=[];for(let e=0;e<L.length;e++){const t=L[e];!1!==i.autoAntiClockwise&&z?U.push(t[0],t[1],t[2]):U.push(t[2],t[1],t[0]),Array.isArray(i.color)&&(F.push(i.color[t[2]>=i.color.length?i.color.length-1:t[2]]),F.push(i.color[t[1]>=i.color.length?i.color.length-1:t[1]]),F.push(i.color[t[0]>=i.color.length?i.color.length-1:t[0]]))}for(let e=0;e<U.length;e++)U[e]+=C;let N=f.length;if(0!=qv(this,SO,"f")&&t.length>0&&R){D++;let e=D*qv(this,SO,"f");for(let t=0;t<f.length;t+=3)f[t+I]-=e}v.push(...U),y.push(...f);for(let e=0;e<N;e+=3){let t,n;if(0==I?(t=(f[e+1]-k.min.y)/(k.max.y-k.min.y),n=(f[e+2]-k.min.z)/(k.max.z-k.min.z)):1==I?(t=(f[e+0]-k.min.x)/(k.max.x-k.min.x),n=(f[e+2]-k.min.z)/(k.max.z-k.min.z)):(t=(f[e+0]-k.min.x)/(k.max.x-k.min.x),n=(f[e+1]-k.min.y)/(k.max.y-k.min.y)),w.push(t,n),Array.isArray(i.color)){let t=new s(F[e]);b.push(t.r),b.push(t.g),b.push(t.b)}else b.push(m.r),b.push(m.g),b.push(m.b);_.push(null!==(d=i.opacity)&&void 0!==d?d:1)}if(C=b.length/3,!n)for(let t=0;t<f.length;t+=3)qv(this,bO,"f").set(A++,e)}let B,I=n?this.highlightPolygons:this.polygons;if(B=I?I.geometry:new S,B.setIndex(v),B.setAttribute("position",new M(y,3)),B.setAttribute("color",new M(b,3)),B.setAttribute("vOpacity",new M(_,1)),B.setAttribute("uv",new M(w,2)),B.computeVertexNormals(),n||qv(this,wO,"m",AO).call(this,B),I)B.index.needsUpdate=!0,B.getAttribute("position").needsUpdate=!0,B.getAttribute("color").needsUpdate=!0,B.getAttribute("vOpacity").needsUpdate=!0,B.getAttribute("uv").needsUpdate=!0,B.computeVertexNormals(),B.computeBoundingBox(),B.computeBoundingSphere();else{let e=new x(f);DW(e);let t=new h(B,e);n&&(t.renderOrder=10,pW(t)),this.entity.addObjects(t),n?this.highlightPolygons=t:this.polygons=t}if(this.showBorder&&!n){this.borderPolyline&&(this.entity.removeObjects(this.borderPolyline),lW(this.borderPolyline),this.borderPolyline=null);let e=new sn;e.setPositions(T),e.setColors(P);let t=new tn(this.borderStyle);this.borderPolyline=new nn(e,t),this.borderPolyline.renderOrder=11,pW(this.borderPolyline),this.entity.addObjects(this.borderPolyline),this.entity.onEntityAwake((e=>qv(this,wO,"m",EO).call(this,e)))}if(!n){let i=[];for(let e=0;e<t.length;e++)this.highlightIndexMap.has(t[e].id)&&i.push(t[e]);qv(this,wO,"m",e).call(this,i,!0)}},AO=function(e){if(!e)return;this.useBvh&&e.getAttribute("position").array.length>300?e.computeBoundsTree():(e.disposeBoundsTree(),e.computeBoundingBox(),e.computeBoundingSphere());let t=0;this.facePosIndex.clear();let i=e.getIndex().array;for(let e=0;e<i.length;e+=3)this.facePosIndex.set(t++,{polyIndex:qv(this,bO,"f").get(i[e]),face:[i[e],i[e+1],i[e+2]]})},EO=function(e){if(!e||!this.borderPolyline)return;const{width:t,height:i}=e.containerSize;this.borderPolyline.material.resolution.set(t,i)},YO.moduleName="PolygonsModule";class XO extends UP{constructor(e){super(Object.assign({},e)),this.entityType="PolygonsEntity",this.isPolygonsEntity=!0,this.add(YO,e).applyMixinsTo(this)}isFireEventsByIntersect(e,t){return e.intersection.faceIndex>=0&&void 0!==t.intersection.faceIndex&&e.intersection.faceIndex!=t.intersection.faceIndex}}class QO extends Sy{constructor(e,t){var i,n,s,r,o;super(e),TO.add(this),this.highlightIndexMap=new Map,this.facePosIndex=new Map,PO.set(this,new Map),OO.set(this,new Map),DO.set(this,0),t.style=null!==(i=t.style)&&void 0!==i?i:{},this.isXYPlane=null!==(n=t.isXYPlane)&&void 0!==n?n:CW(),this.useBvh=null===(s=t.useBvh)||void 0===s||s,this.style=Object.assign({color:16777215,side:I,vertexColors:!0,opacity:1,transparent:!0},t.style),this.highlightStyle=Object.assign({vertexColors:!1,color:1911,opacity:.8,transparent:!0,side:I},t.highlightStyle),this.borderStyle=Object.assign({color:16777215,linewidth:2,worldUnits:!1,vertexColors:!0,alphaToCoverage:!0},t.borderStyle),this.showBorder=t.showBorder,this.showVertex=null!==(r=t.showVertex)&&void 0!==r&&r,this.vertexStyle=null!==(o=t.vertexStyle)&&void 0!==o?o:{},this.vertexStyle=Object.assign({color:16777215,pointSize:10,pointColor:"#fbb03b",pointBorderColor:"#73FBFD",shape:"circle",transparent:!0,opacity:1,borderWidth:1,sizeAttenuation:!1,vertexBorderColor:!0,vertexColors:!0,vertexSize:!0},this.vertexStyle),this.setData(t.data),this.effectScope((()=>{qv(this,TO,"m",kO).call(this,this.entity.app)})),this.addDispose((()=>{qv(this,TO,"m",BO).call(this,!1),qv(this,TO,"m",BO).call(this,!0)}))}setupUiConfig(){return{type:"folder",expanded:!0,label:"模块参数设置",app:this.app,children:[{type:"checkbox",label:"显示顶点",getValue:()=>this.isShowVertex(),setValue:e=>{this.setShowVertex(e)}},{type:"checkbox",label:"显示边框线",value:this.showBorder,onChange:e=>{this.showBorder=e.value,this.setData(this.getData())}}]}}getFillExtrusions(){return this.fillExtrusions}getVertexSymbol(){return this.vertexEntity}getBorderPolyline(){return this.borderPolyline}updateStyle(e){for(let t in e)this.fillExtrusions.material[t]=e[t],this.fillExtrusions.material[t].needsUpdate=!0;this.style=Object.assign({},e)}updateHightStyle(e){for(let t in e)this.highlightFillExtrusions.material[t]=e[t],this.highlightFillExtrusions.material[t].needsUpdate=!0;this.style=Object.assign({},e)}setData(e){qv(this,TO,"m",IO).call(this,e,!1),this.setShowVertex(this.showVertex)}getData(){return this.data}isShowVertex(){return this.showVertex}getVertexData(e){let t=[],i=this.fillExtrusions.geometry.getAttribute("position").array,n=0;for(let s=0;s<i.length/3;s++){n++;let r=this.getItemDataByFaceIndex(n/3);if(!0!==e&&r&&!1===r.showVertex)continue;let o={position:[i[3*s+0],i[3*s+1],i[3*s+2]]};!0!==o.hidden&&(o.color=this.vertexStyle.pointColor,o.borderColor=this.vertexStyle.pointBorderColor,o.size=this.vertexStyle.pointSize,o.id=`${s}`,t.push(o))}return t}setShowVertex(e,t){if(this.showVertex=e,this.showVertex?this.vertexEntity||(this.vertexEntity=new jP(Object.assign({data:[],style:this.vertexStyle,pixelRaycasting:!0},t)),this.vertexEntity.node.renderOrder=1,this.entity.addChildEntity(this.vertexEntity)):this.vertexEntity&&(this.entity.removeChildEntity(this.vertexEntity),this.vertexEntity=null),this.showVertex){let e=this.getVertexData();this.vertexEntity.setData(e)}}getItemDataByFaceIndex(e,t){let i=this.facePosIndex.get(e);if(!i)return;let n=this.data[i.polyIndex];return t?{data:n,face:i.face}:Object.assign(Object.assign({},n),{face:[...i.face]})}setDepths(e){if(!this.fillExtrusions)return;let t=this.fillExtrusions.geometry,i=t.getAttribute("position"),n=t.getAttribute("color"),r=t.getAttribute("vOpacity"),o=new s,a=!1,l=!1,h=!1;for(let t=0;t<e.length;t++){let s=e[t];if(s.index<0||s.index>=this.data.length)continue;let c=qv(this,OO,"f").get(s.index);if(c){s.color2&&o.set(s.color2);for(let e=0;e<c.length;e++){let t=this.isXYPlane?3*c[e]+2:3*c[e]+1;t>=i.array.length||(void 0!==s.depth&&(i.array[t]=s.depth,a=!0),s.color2&&(n[t]=o.r,n[t+1]=o.g,n[t+2]=o.b,l=!0),void 0!==s.opacity&&(r[t]=s.opacity,h=!0))}}}a&&(i.needsUpdate=!0),l&&(n.needsUpdate=!0),h&&(r.needsUpdate=!0)}refreshHighlight(){qv(this,TO,"m",IO).call(this,this.highlightData,!0)}setItemHighlight(e,t,i){let n=this.highlightIndexMap.has(e);if(n&&!t){let t=this.highlightData.findIndex((t=>t.id==e));t>=0&&(this.highlightData.splice(this.highlightData.findIndex((t=>t.id==e)),1),this.highlightIndexMap.delete(e))}else if(!n&&t){let t=this.data.findIndex((t=>t.id==e));t>=0&&(this.highlightData.push(this.data[t]),this.highlightIndexMap.set(e,this.highlightIndexMap.size),i||qv(this,TO,"m",IO).call(this,this.highlightData,!0))}}isItemHighlight(e){return this.highlightIndexMap.has(e)}clearHighlight(){qv(this,TO,"m",IO).call(this,[],!0)}}PO=new WeakMap,OO=new WeakMap,DO=new WeakMap,TO=new WeakSet,BO=function(e){let t=e?this.highlightFillExtrusions:this.fillExtrusions;t&&(this.entity.removeObjects(t),lW(t)),e?this.highlightFillExtrusions=null:(this.fillExtrusions=null,this.borderPolyline&&(this.entity.removeObjects(this.borderPolyline),lW(this.borderPolyline),this.borderPolyline=null))},IO=function e(t,i){var n,o,a,l,c,d,u,p,f,m,g,v,y,x,w;if(i?this.highlightData=t:this.data=t,i){this.highlightIndexMap.clear();for(let e=0;e<t.length;e++)this.highlightIndexMap.set(t[e].id,e)}else this.facePosIndex.clear();let b=i?Object.assign({},this.highlightStyle):Object.assign({},this.style),_=new s(i?null!==(n=this.highlightStyle.color)&&void 0!==n?n:1911:16711680),C=new s(16711680),A=new s(65535),E=new s(65535);const T=[],P=[],O=[],D=[],B=[],I=[],k=e=>{let t=[];for(let i=0;i<e.length;i++)t.push(e[i]);return t};let L=0,z=0;const U=[],F=[];i||(qv(this,PO,"f").clear(),qv(this,OO,"f").clear());let N=!1;for(let e=0;e<t.length;e++){let n=t[e];if(!0===n.hidden)continue;if(n.id=null!==(o=n.id)&&void 0!==o?o:(Zv(this,DO,(w=qv(this,DO,"f"),x=w++,w),"f"),x+""),_.set(null!==(a=n.color)&&void 0!==a?a:"#ff0000"),C.set(null!==(c=null!==(l=n.color2)&&void 0!==l?l:n.color)&&void 0!==c?c:"#ff0000"),i){const e={h:0,s:0,l:0};_.getHSL(e),_.setHSL(e.h,e.s,e.l+.2>1?e.l-.2:e.l+.2)}let s,h=t[e].coordinates;if(h.length>0&&h[0].length>0&&Array.isArray(h[0][0])){s=new ht(h[0].map((e=>new r(e[0],e[1]))));for(let e=1;e<h.length;e++)s.holes.push(new ct(h[e].map((e=>new r(e[0],e[1])))))}else s=new ht(h.map((e=>new r(e[0],e[1]))));n.extrude&&(n.extrude.bevelEnabled=!0===n.extrude.bevelEnabled);let b=null!==(d=n.extrude)&&void 0!==d?d:{bevelEnabled:!1,depth:10,steps:1};0==b.depth&&(b.depth=1e-7);let S=new dt(s,b);if(!i&&null!==(p=null!==(u=this.showBorder)&&void 0!==u?u:n.showBorder)&&void 0!==p&&p){N=!0,A.set(null!==(f=n.borderColor)&&void 0!==f?f:"#0x00ffff"),E.set(null!==(g=null!==(m=n.borderColor2)&&void 0!==m?m:n.borderColor)&&void 0!==g?g:"#0x00ffff");let e=k(new R(S).getAttribute("position").array);for(let t=0;t<e.length;t+=3)e[t+2]>0?F.push(E.r,E.g,E.b):F.push(A.r,A.g,A.b),n.baseHeight&&(e[t+2]+=n.baseHeight),this.isXYPlane||([e[t+1],e[t+2]]=[e[t+2],e[t+1]]);U.push(...e)}let M=[];if(S.getIndex()){let e=S.getIndex().array;for(let t=0;t<e.length;t++)e[t]+=L;M=k(e),T.push(...M)}let j=k(S.getAttribute("position").array),V=j.length;if(n.baseHeight)for(let e=0;e<j.length;e+=3)j[e+2]+=n.baseHeight;P.push(...j),O.push(...k(S.getAttribute("normal").array)),D.push(...k(S.getAttribute("uv").array));for(let e=0;e<V;e+=3)j[e+2]>(null!==(v=n.baseHeight)&&void 0!==v?v:0)?(B.push(C.r),B.push(C.g),B.push(C.b)):(B.push(_.r),B.push(_.g),B.push(_.b)),I.push(null!==(y=n.opacity)&&void 0!==y?y:1);if(L=B.length/3,!i){let t=[];for(let i=0;i<j.length;i+=3)qv(this,PO,"f").set(z,e),Math.abs(j[i+2])>=1e-6&&t.push(z),z++;qv(this,OO,"f").set(e,t)}}if(!this.isXYPlane)for(let e=0;e<P.length;e+=3)[P[e+1],P[e+2]]=[P[e+2],P[e+1]],[O[e],O[e+1]]=[O[e+1],O[e]];let j,V=i?this.highlightFillExtrusions:this.fillExtrusions;if(j=V?V.geometry:new S,T.length>0)j.setIndex(T);else{let e=[];for(let t=0;t<P.length;t+=3)e.push(t/3);j.setIndex(e)}if(j.setAttribute("position",new M(P,3)),j.setAttribute("normal",new M(O,3)),j.setAttribute("color",new M(B,3)),j.setAttribute("uv",new M(D,2)),j.setAttribute("vOpacity",new M(I,1)),i||qv(this,TO,"m",RO).call(this,j),V)j.index.needsUpdate=!0,j.getAttribute("position").needsUpdate=!0,j.getAttribute("normal").needsUpdate=!0,j.getAttribute("color").needsUpdate=!0,j.getAttribute("uv").needsUpdate=!0,j.getAttribute("vOpacity").needsUpdate=!0,j.computeBoundingBox(),j.computeBoundingSphere();else{let e=new ut(b);DW(e);let t=new h(j,e);i&&(t.renderOrder=10,pW(t)),this.entity.addObjects(t),i?this.highlightFillExtrusions=t:this.fillExtrusions=t}if(i||this.borderPolyline&&(this.entity.removeObjects(this.borderPolyline),lW(this.borderPolyline),this.borderPolyline=null),N&&!i){let e=new sn;e.setPositions(U),e.setColors(F);let t=new tn(this.borderStyle);this.borderPolyline=new nn(e,t),this.borderPolyline.renderOrder=11,pW(this.borderPolyline),this.entity.addObjects(this.borderPolyline),this.entity.onEntityAwake((e=>qv(this,TO,"m",kO).call(this,e)))}if(!i){let i=[];for(let e=0;e<t.length;e++)this.highlightIndexMap.has(t[e].id)&&i.push(t[e]);qv(this,TO,"m",e).call(this,i,!0)}},RO=function(e){if(!e)return;this.useBvh&&e.getAttribute("position").array.length>300?e.computeBoundsTree():(e.disposeBoundsTree(),e.computeBoundingBox(),e.computeBoundingSphere());let t=0;this.facePosIndex.clear();let i=e.getIndex().array;for(let e=0;e<i.length;e+=3)this.facePosIndex.set(t++,{polyIndex:qv(this,PO,"f").get(i[e]),face:[i[e],i[e+1],i[e+2]]})},kO=function(e){if(!e||!this.borderPolyline)return;const{width:t,height:i}=e.containerSize;this.borderPolyline.material.resolution.set(t,i)},QO.moduleName="FillExtrusionsModule";class qO extends UP{constructor(e){super(Object.assign({},e)),this.entityType="FillExtrusionsEntity",this.isFillExtrusionsEntity=!0,this.add(QO,e).applyMixinsTo(this)}isFireEventsByIntersect(e,t){return e.intersection.faceIndex>=0&&void 0!==t.intersection.faceIndex&&e.intersection.faceIndex!=t.intersection.faceIndex}}class ZO extends Sy{constructor(e,t){var i,n,s;super(e),LO.add(this),this.highlightIndexMap=new Map,this.posIndex=new Map,zO.set(this,void 0),UO.set(this,0),t.style=null!==(i=t.style)&&void 0!==i?i:{},this.style=Object.assign({color:16777215,vertexColors:!0},t.style),this.highlightStyle=Object.assign({color:65535,vertexColors:!1,opacity:.7},t.highlightStyle),Zv(this,zO,t.dashed,"f"),this.showVertex=null!==(n=t.showVertex)&&void 0!==n&&n,this.vertexStyle=null!==(s=t.vertexStyle)&&void 0!==s?s:{},this.vertexStyle=Object.assign({color:16777215,pointSize:10,pointColor:"#fbb03b",pointBorderColor:"#73FBFD",shape:"circle",transparent:!0,opacity:1,borderWidth:1,sizeAttenuation:!1,vertexBorderColor:!0,vertexColors:!0,vertexSize:!0},this.vertexStyle),this.setData(t.data),this.addDispose((()=>{qv(this,LO,"m",FO).call(this,!1),qv(this,LO,"m",FO).call(this,!0)}))}setupUiConfig(){return{type:"folder",expanded:!0,label:"模块参数设置",app:this.app,children:[{type:"checkbox",label:"显示顶点",getValue:()=>this.isShowVertex(),setValue:e=>{this.setShowVertex(e)}}]}}getGlLines(){return this.gllines}getVertexSymbol(){return this.vertexEntity}updateStyle(e){for(let t in e)this.gllines.material[t]=e[t],this.gllines.material[t].needsUpdate=!0;this.style=Object.assign({},e)}updateHightStyle(e){for(let t in e)this.highlightGlLines.material[t]=e[t],this.highlightGlLines.material[t].needsUpdate=!0;this.style=Object.assign({},e)}setData(e){qv(this,LO,"m",NO).call(this,e,!1),this.setShowVertex(this.showVertex)}isShowVertex(){return this.showVertex}getVertexData(e){let t=[];for(let i=0;i<this.data.length;i++){let n=this.data[i];if(!0===e||!1!==n.showVertex)for(let e=0;e<n.coordinates.length;e++){if(!0===n.hidden)continue;let s={position:n.coordinates[e]};s.color=this.vertexStyle.pointColor,s.borderColor=this.vertexStyle.pointBorderColor,s.size=this.vertexStyle.pointSize,s.id=`${i}-${e}`,t.push(s)}}return t}setShowVertex(e,t){if(this.showVertex=e,this.showVertex?this.vertexEntity||(this.vertexEntity=new jP(Object.assign({data:[],style:this.vertexStyle,pixelRaycasting:!0},t)),this.vertexEntity.node.renderOrder=1,this.entity.addChildEntity(this.vertexEntity)):this.vertexEntity&&(this.entity.removeChildEntity(this.vertexEntity),this.vertexEntity=null),this.showVertex){let e=this.getVertexData();this.vertexEntity.setData(e)}}getData(){return this.data}getItemDataByIndex(e,t){let i=this.posIndex.get(e);if(!i)return;let n=this.data[i.lineIndex];return t?{data:n,positionIndex:i.positionIndex}:Object.assign(Object.assign({},n),{positionIndex:i.positionIndex})}refreshHighlight(){qv(this,LO,"m",NO).call(this,this.highlightData,!0)}setItemHighlight(e,t,i){let n=this.highlightIndexMap.has(e);if(n&&!t){let t=this.highlightData.findIndex((t=>t.id==e));t>=0&&(this.highlightData.splice(this.highlightData.findIndex((t=>t.id==e)),1),this.highlightIndexMap.delete(e))}else if(!n&&t){let t=this.data.findIndex((t=>t.id==e));t>=0&&(this.highlightData.push(this.data[t]),this.highlightIndexMap.set(e,this.highlightIndexMap.size),i||qv(this,LO,"m",NO).call(this,this.highlightData,!0))}}isItemHighlight(e){return this.highlightIndexMap.has(e)}clearHighlight(){qv(this,LO,"m",NO).call(this,[],!0)}}zO=new WeakMap,UO=new WeakMap,LO=new WeakSet,FO=function(e){let t=e?this.highlightGlLines:this.gllines;t&&(this.entity.removeObjects(t),lW(t),t=null)},NO=function e(t,i){var n,r,o,a;if(i?this.highlightData=t:this.data=t,i){this.highlightIndexMap.clear();for(let e=0;e<t.length;e++)this.highlightIndexMap.set(t[e].id,e)}else this.posIndex.clear();let l=i?Object.assign({},this.highlightStyle):Object.assign({},this.style);const h=[],c=[];let d=0,u=new s(i?null!==(n=this.highlightStyle.color)&&void 0!==n?n:1911:16711680);for(let e=0;e<t.length;e++){let n=t[e];if(!0===n.hidden)continue;n.id=null!==(r=n.id)&&void 0!==r?r:(Zv(this,UO,(a=qv(this,UO,"f"),o=a++,a),"f"),o+"");let l=Array.isArray(n.color);!l&&n.color&&u.set(n.color);for(let t=0;t<n.coordinates.length-1;t++){if(i||this.posIndex.set(d++,{lineIndex:e,positionIndex:t}),h.push(n.coordinates[t][0],n.coordinates[t][1],n.coordinates[t][2]),l){let e=new s(n.color[t]);c.push(e.r,e.g,e.b)}else c.push(u.r,u.g,u.b);if(h.push(n.coordinates[t+1][0],n.coordinates[t+1][1],n.coordinates[t+1][2]),l){let e=new s(n.color[t+1]);c.push(e.r,e.g,e.b)}else c.push(u.r,u.g,u.b)}}const p=new Float32Array(h.length);for(let e=0;e<h.length;e++)p[e]=h[e];const f=new Float32Array(c.length);for(let e=0;e<f.length;e++)f[e]=c[e];let m=i?this.highlightGlLines:this.gllines;if(m){if(m.geometry.attributes.position.array.length==p.length)for(let e=0;e<p.length;e++)m.geometry.attributes.position.array[e]=p[e];else m.geometry.setAttribute("position",new O(p,3));if(m.geometry.attributes.position.needsUpdate=!0,m.geometry.attributes.color.array.length==f.length)for(let e=0;e<f.length;e++)m.geometry.attributes.color.array[e]=f[e];else m.geometry.setAttribute("color",new O(f,3));m.geometry.attributes.color.needsUpdate=!0}else{let e=new S;e.setAttribute("position",new O(p,3)),e.setAttribute("color",new O(f,3));let t=qv(this,zO,"f")?new pt(l):new k(l);m=new L(e,t),i&&(m.renderOrder=10,pW(m)),this.entity.addObjects(m),i?this.highlightGlLines=m:this.gllines=m}if(!i){let i=[];for(let e=0;e<t.length;e++)this.highlightIndexMap.has(t[e].id)&&i.push(t[e]);qv(this,LO,"m",e).call(this,i,!0)}},ZO.moduleName="GlLinesModule";class KO extends UP{constructor(e){super(Object.assign({},e)),this.entityType="GlLinesEntity",this.isGlLinesEntity=!0,this.add(ZO,e).applyMixinsTo(this)}isFireEventsByIntersect(e,t){return e.intersection.index>=0&&void 0!==t.intersection.index&&e.intersection.index!=t.intersection.index}}class JO extends UP{constructor(e){super(Object.assign({},e)),this.entityType="SpriteMarkerEntity",this.isSpriteMarkerEntity=!0,this.add(pz,e).applyMixinsTo(this)}setMaterial(e){return this.SpriteMarker.setMaterial(e)}updateRenderTexture(e){return this.SpriteMarker.updateRenderTexture(e)}refreshRenderTexture(){return this.SpriteMarker.refreshRenderTexture()}dispatchRenderTextureEvent(e,t,i){return this.SpriteMarker.dispatchRenderTextureEvent(e,t,i)}setAllowOverlap(e){return this.SpriteMarker.setAllowOverlap(e)}updateScale(){return this.SpriteMarker.updateScale()}updateAnchor(){return this.SpriteMarker.updateAnchor()}getBoundingRect(){return this.SpriteMarker.getBoundingRect()}}class $O extends UP{constructor(e){super(Object.assign({},e)),this.entityType="SpriteImagesEntity",this.isSpriteImagesEntity=!0,this.add(fz,e).applyMixinsTo(this)}getOptions(){return this.SpriteImages.getOptions()}update(){return this.SpriteImages.update()}getData(){return this.SpriteImages.getData()}setItemHighlight(e,t){return this.SpriteImages.setItemHighlight(e,t)}setData(e){return Qv(this,void 0,void 0,(function*(){return this.SpriteImages.setData(e)}))}isFireEventsByIntersect(e,t){return void 0!==e.intersection.object&&void 0!==t.intersection.object&&e.intersection.object.userData.objectDataIndex!=t.intersection.object.userData.objectDataIndex}}class eD extends UP{constructor(e){super(Object.assign({},e)),this.entityType="SpriteTextsEntity",this.isSpriteTextsEntity=!0,this.add(mz,e).applyMixinsTo(this)}getOptions(){return this.SpriteTexts.getOptions()}update(){return this.SpriteTexts.update()}getData(){return this.SpriteTexts.getData()}setItemHighlight(e,t){return this.SpriteTexts.setItemHighlight(e,t)}setData(e){return Qv(this,void 0,void 0,(function*(){return this.SpriteTexts.setData(e)}))}isFireEventsByIntersect(e,t){return void 0!==e.intersection.object&&void 0!==t.intersection.object&&e.intersection.object.userData.objectDataIndex!=t.intersection.object.userData.objectDataIndex}}class tD extends UP{constructor(e){let t=new cD(e);e.node=t.trail,super(Object.assign({},e)),this.entityType="TrailLineEntity",this.isTrailLineEntity=!0,this.trailLine=t,this.onEntityAwake((e=>{t.update(e),this.signal.onBeforeRemove.add(e.signal.onAppUpdate.add((()=>{t.update(e)})))}))}}class iD{constructor(e){jO.add(this),this.options=e,this.update()}coordHash(e){return`${e[0].toFixed(this.options.decimalPrecision)},${e[1].toFixed(this.options.decimalPrecision)},${e[2].toFixed(this.options.decimalPrecision)}`}update(){var e,t,i,n,s,o,a,l,h,c,d,u,p,f,m,g,v,y,x,w,b,_,S,M,C,A,E,T,P;this.topo={tubes:[],nodes:new Map},this.data=[],this.geometries=[],null===(e=this.entity)||void 0===e||e.remove(),this.entity=new UP;let O=2*(null!==(t=this.options.nodeRadius)&&void 0!==t?t:.3),D=null!==(i=this.options.isMapMode)&&void 0!==i?i:null===(n=Cy.app)||void 0===n?void 0:n.isMapMode;null!==(s=(x=this.options).outerMaterial)&&void 0!==s||(x.outerMaterial=new ce({color:8257515,side:I}));let B=[],R=new Map;null!==(o=(w=this.options).decimalPrecision)&&void 0!==o||(w.decimalPrecision=6);const k={};let L=this.options.data;if("nodeEqual"!==this.options.topoStrategy){let e=[];for(let t=0;t<this.options.data.length;t++)e.push(this.options.data[t].paths.map((e=>Vv(e))));let t=AG(e,Math.pow(.1,this.options.decimalPrecision)),i=[];for(let e=0;e<t.lines.length;e++){let n=t.lines[e].map((e=>e.toArray())),s=L[t.indexs[e]];i.push(Object.assign(Object.assign({},s),{paths:n}))}L=i}for(let e=0;e<L.length;e++){let t=L[e].paths,i={paths:t,startId:this.coordHash(t[0]),endId:this.coordHash(t[t.length-1]),dist:WW(t),clipPath:t,data:L[e]};B.push(i);let n=0;R.has(i.startId)&&(n=R.get(i.startId)),R.set(i.startId,n+1),n=0,R.has(i.endId)&&(n=R.get(i.endId)),R.set(i.endId,n+1);let s=yv(i.startId).substring(0,8),r=yv(i.endId).substring(0,8);this.topo.tubes.push({tubeIndex:e,data:L[e],startNodeId:s,endNodeId:r}),this.topo.nodes.has(s)?this.topo.nodes.get(s).push(e):this.topo.nodes.set(s,[e]),this.topo.nodes.has(r)?this.topo.nodes.get(r).push(e):this.topo.nodes.set(r,[e])}const z={};for(let e=0;e<B.length;e++){let t=B[e];2==t.paths.length&&Tv(t.paths[0][0],t.paths[1][0],1e-6)&&Tv(t.paths[0][D?1:2],t.paths[1][D?1:2],1e-6)&&(t.isVerticalLine=!0,t.paths[0][0]+=1e-6)}this.inputData=L,null!==(a=(b=this.options).drawRules)&&void 0!==a||(b.drawRules=[15,4,25,3,35,2]),null!==(l=(_=this.options).maxNodeRadiusRatio)&&void 0!==l||(_.maxNodeRadiusRatio=.5),null!==(h=(S=this.options).verticalShape)&&void 0!==h||(S.verticalShape={shape:"circle",radius:this.options.nodeRadius,clipRadius:this.options.nodeRadius});const U={};if(this.options.drawRules.length>0){for(let e=0;e<B.length;e++){let t=B[e];if(t.isVerticalLine)continue;let i=t.startId,n=t.endId,s=R.get(i),o=R.get(n),a={},l={};if(s>=2&&(a.tubeIndex=e,a.angle=new r(t.paths[1][0],D?t.paths[1][1]:t.paths[1][2]).sub(new r(t.paths[0][0],D?t.paths[0][1]:t.paths[0][2])).angle(),null!==(c=U[M=t.startId])&&void 0!==c||(U[M]=[]),U[t.startId].push(a)),o>=2){l.tubeIndex=e;let i=t.paths.length-1;l.angle=new r(t.paths[i-1][0],D?t.paths[i-1][1]:t.paths[i-1][2]).sub(new r(t.paths[i][0],D?t.paths[i][1]:t.paths[i][2])).angle(),null!==(d=U[C=t.endId])&&void 0!==d||(U[C]=[]),U[t.endId].push(l)}}for(let e in U)U[e].sort(((e,t)=>e.angle-t.angle))}for(let e=0;e<B.length;e++){let t=B[e],i=t.startId,n=t.endId,s=R.get(i),o=R.get(n),a=t.disableMergeNode||t.data.disableMergeNode;if(!0===a||t.isVerticalLine){let i;if(t.isVerticalLine&&(i=this.options.verticalShape,i.clipRadius>0&&!a)){if(s>=2){let e=[];YW(t.paths,i.clipRadius/t.dist,{distance:t.dist,remainingPoints:e}),t.paths=e}if(o>=2){let e=[];t.paths=YW(t.paths,1-i.clipRadius/t.dist,{remainingPoints:e})}}null!==(u=z[A=t.startId])&&void 0!==u||(z[A]=[]),z[t.startId].indexOf(e)<0&&z[t.startId].push(e),null!==(p=z[E=t.endId])&&void 0!==p||(z[E]=[]),z[t.endId].indexOf(e)<0&&z[t.endId].push(e);let n=qv(this,jO,"m",HO).call(this,t.paths,e,O,!1,i);(null==n?void 0:n.geometry)&&this.geometries.push(n.geometry);continue}let l={},h={};if(s>=2){l.tubeIndex=e,l.angle=new r(t.paths[1][0],D?t.paths[1][1]:t.paths[1][2]).sub(new r(t.paths[0][0],D?t.paths[0][1]:t.paths[0][2])).angle();let n=O;if(this.options.drawRules.length>0){let t=U[i],s=t.findIndex((t=>t.tubeIndex==e));if(s>=0&&(l.preConnect=t[s-1<0?t.length-1:s-1],l.nextConnect=t[s+1>t.length-1?0:s+1]),l.nextConnect){let e=l.nextConnect.angle;e<l.angle&&(e+=2*Math.PI);let t=e-l.angle;t=180*t/Math.PI;for(let e=0;e<this.options.drawRules.length;e+=2)if(t<this.options.drawRules[e]){let i=this.options.drawRules[e+1]*O;if(e>=2){let n=this.options.drawRules[e-2];i=Cv(this.options.drawRules[e+1-2]*O,i,(t-n)/(this.options.drawRules[e]-n))}if(n<i){n=i;break}}}if(l.preConnect){let e=l.preConnect.angle;e>l.angle&&(e-=2*Math.PI);let t=l.angle-e;t=180*t/Math.PI;for(let e=0;e<this.options.drawRules.length;e+=2)if(t<this.options.drawRules[e]){let i=this.options.drawRules[e+1]*O;if(e>=2){let n=this.options.drawRules[e-2];i=Cv(this.options.drawRules[e+1-2]*O,i,(t-n)/(this.options.drawRules[e]-n))}if(n<i){n=i;break}}}}this.options.maxNodeRadiusRatio&&this.options.maxNodeRadiusRatio*t.dist<n&&(n=this.options.maxNodeRadiusRatio*t.dist);let s=[];YW(t.paths,n/t.dist,{distance:t.dist,remainingPoints:s}),t.paths=s,null!==(f=k[T=t.startId])&&void 0!==f||(k[T]=[]),l.points=[t.paths[0]],k[t.startId].push(l)}if(o>=2){h.tubeIndex=e;let i=t.paths.length-1;h.angle=new r(t.paths[i-1][0],D?t.paths[i-1][1]:t.paths[i-1][2]).sub(new r(t.paths[i][0],D?t.paths[i][1]:t.paths[i][2])).angle();let s=O;if(this.options.drawRules.length>0){let t=U[n],i=t.findIndex((t=>t.tubeIndex==e));if(i>=0&&(h.preConnect=t[i-1<0?t.length-1:i-1],h.nextConnect=t[i+1>t.length-1?0:i+1]),h.nextConnect){let e=h.nextConnect.angle;e<h.angle&&(e+=2*Math.PI);let t=e-h.angle;t=180*t/Math.PI;for(let e=0;e<this.options.drawRules.length;e+=2)if(t<this.options.drawRules[e]){let i=this.options.drawRules[e+1]*O;if(e>=2){let n=this.options.drawRules[e-2];i=Cv(this.options.drawRules[e+1-2]*O,i,(t-n)/(this.options.drawRules[e]-n))}if(s<i){s=i;break}}}if(h.preConnect){let e=h.preConnect.angle;e>h.angle&&(e-=2*Math.PI);let t=h.angle-e;t=180*t/Math.PI;for(let e=0;e<this.options.drawRules.length;e+=2)if(t<this.options.drawRules[e]){let i=this.options.drawRules[e+1]*O;if(e>=2){let n=this.options.drawRules[e-2];i=Cv(this.options.drawRules[e+1-2]*O,i,(t-n)/(this.options.drawRules[e]-n))}if(s<i){s=i;break}}}}this.options.maxNodeRadiusRatio&&this.options.maxNodeRadiusRatio*t.dist<s&&(s=this.options.maxNodeRadiusRatio*t.dist);let o=[];t.paths=YW(t.paths,1-s/t.dist,{remainingPoints:o}),null!==(m=k[P=t.endId])&&void 0!==m||(k[P]=[]),h.points=[t.paths[t.paths.length-1]],k[t.endId].push(h)}let c=qv(this,jO,"m",HO).call(this,t.paths,e,O);if((null==c?void 0:c.geometry)&&this.geometries.push(c.geometry),"rectNoTop"==(null===(v=null===(g=this.options)||void 0===g?void 0:g.sect)||void 0===v?void 0:v.shape)){let i=t.paths;i.length>=6&&(i=[t.paths[0],t.paths[1],t.paths[2],t.paths[t.paths.length-3],t.paths[t.paths.length-2],t.paths[t.paths.length-1]]),c=qv(this,jO,"m",HO).call(this,i,e,O,!1,{shape:"rect"},!0)}let d=null==c?void 0:c.geometry.sectDataParam();l.sectPoints=c.geometry.attributes.position.array.slice(0,3*d.ptCount),l.isStartNode=!0;let y=c.geometry.attributes.position.array.length-3*d.ptCount;h.sectPoints=c.geometry.attributes.position.array.slice(y,y+3*d.ptCount),h.isStartNode=!1}for(let e in k){let t=e.split(",").map((e=>+e)),i=k[e];i.sort(((e,t)=>e.angle-t.angle));let n=[],s=new Set;for(let e=0;e<i.length;e++){let r=e+1;r==i.length&&(r=0);let o=qv(this,jO,"m",HO).call(this,[i[e].points[0],t,i[r].points[0]],-1,0,!0),a=o.geometry.sectDataParam(),l=o.geometry.attributes.position.array;if("circleHalf"==o.geometry.options.shape){const e=o.geometry.options.radius||.5;l[3*a.halfCount+0]=t[0],l[3*a.halfCount+1]=t[1]-(D?0:e),l[3*a.halfCount+2]=t[2]-(D?e:0)}if(i[e].isStartNode){let t=[],n=a.ptCount-a.halfIndex-1;for(let s=a.halfStartIndex;s<=a.halfEndIndex;s++){let r=n-s;t.push(i[e].sectPoints[3*r]),t.push(i[e].sectPoints[3*r+1]),t.push(i[e].sectPoints[3*r+2])}for(let e=0;e<t.length;e++)l[e+3*a.halfIndex]=t[e]}else for(let t=a.halfStartIndex;t<3*(a.halfEndIndex+1);t++)l[t-a.halfStartIndex+3*a.halfIndex]=i[e].sectPoints[t];if(i[r].isStartNode)for(let e=a.halfStartIndex;e<3*(a.halfEndIndex+1);e++)l[e-a.halfStartIndex+2*a.halfCount*3+3*a.halfIndex]=i[r].sectPoints[e];else{let e=[],t=a.ptCount-a.halfIndex-1;for(let n=a.halfStartIndex;n<3*(a.halfEndIndex+1);n++){let s=t-n;e.push(i[r].sectPoints[3*s]),e.push(i[r].sectPoints[3*s+1]),e.push(i[r].sectPoints[3*s+2])}for(let t=0;t<e.length;t++)l[t+2*a.halfCount*3+3*a.halfIndex]=e[t]}(null==o?void 0:o.geometry)&&this.geometries.push(o.geometry),n.push(o.geometry),s.add(i[e].tubeIndex)}let r=$i(n);qv(this,jO,"m",VO).call(this,r,!0,[...Array.from(s),...null!==(y=z[e])&&void 0!==y?y:[]])}}addTo(e){this.entity.addTo(e)}getSectPoints(e,t){var n,s;let r;if(void 0===t){let t=Vv(e),i=this.data.filter((e=>e.box3d.containsPoint(t))),n=0;for(let t=0;t<i.length;t++){let s=i[t].pathPointList.array.map((e=>new Nb(e.pos.x,e.pos.y,e.pos.z))),o=pS(new Nb(e[0],e[1],e[2]),s);(0==t||o.closestLength<n)&&(n=o.closestLength,r=i[t])}}else r=this.data[t];if(!r)return;let o=r.pathPointList.array.map((e=>new Nb(e.pos.x,e.pos.y,e.pos.z))),a=pS(new Nb(e[0],e[1],e[2]),o),l=r.mesh.geometry.attributes.position.array,h=r.mesh.geometry.sectDataParam(),c=l.slice(3*(null!==(n=h.posPtCount)&&void 0!==n?n:h.ptCount)*a.closestIndex,3*(null!==(s=h.posPtCount)&&void 0!==s?s:h.ptCount)*(a.closestIndex+1)),d=[];for(let e=0;e<c.length;e+=3)d.push(new i(c[e],c[e+1],c[e+2]));const u=(e,t)=>{let i;return i=Array.isArray(e)?d[e[0]].clone().add(t[e[1]].clone()).multiplyScalar(.5):d[e],i};let p=u(h.posBaseIndex,d),f=new i(a.closestPoint.x,a.closestPoint.y,a.closestPoint.z).sub(p);for(let e=0;e<d.length;e++)d[e].add(f);return{points:d,posBase:u(h.posBaseIndex,d),posLeft:u(h.posLeftIndex,d),posRight:u(h.posRightIndex,d),posTop:u(h.posTopIndex,d),posLeftTop:u(h.posLeftTopIndex,d),posRightTop:u(h.posRightTopIndex,d),data:r}}showEdgeLine(e,t){this.removeEdgeLine();let i=this.getEdgeLines(e),n=new KO({data:i.map((t=>{var i;return{coordinates:t,color:null!==(i=null==e?void 0:e.color)&&void 0!==i?i:65535}}))});return n.addTo(null!=t?t:Cy.app),!1!==(null==e?void 0:e.disableRayQuery)&&pW(n.node,!1),this._edgeLineEntity=n,{lineEntity:n,coordinates:i}}removeEdgeLine(){this._edgeLineEntity&&(this._edgeLineEntity.remove(),this._edgeLineEntity=null)}getEdgeLines(e){var t,i;null!=e||(e={}),null!==(t=e.bottom)&&void 0!==t||(e.bottom=!0),null!==(i=e.top)&&void 0!==i||(e.top=!0);let n=[];const s=(e,t,i)=>{if(Array.isArray(e)){let n=[t[i+3*e[0]],t[i+3*e[0]+1],t[i+3*e[0]+2]],s=[t[i+3*e[1]],t[i+3*e[1]+1],t[i+3*e[1]+2]];return[(n[0]+s[0])/2,(n[1]+s[1])/2,(n[2]+s[2])/2]}return[t[i+3*e],t[i+3*e+1],t[i+3*e+2]]};return this.geometries.forEach((t=>{var i,r,o,a;let l=t.attributes.position.array,h=t.sectDataParam(),c=t.options.shape.indexOf("Half")>0,d=c?h.halfCount:null!==(i=h.posPtCount)&&void 0!==i?i:h.ptCount;if(c){if(e.bottom){let e=[],t=null!==(r=h.posHalfLeftIndex)&&void 0!==r?r:h.posLeftIndex;for(let i=0;i<l.length;i+=3*d)e.push(s(t,l,i));n.push(e)}if(e.top){let e=[],t=null!==(o=h.posHalfLeftTopIndex)&&void 0!==o?o:h.posLeftTopIndex;for(let i=0;i<l.length;i+=3*d)e.push(s(t,l,i));n.push(e)}if(e.center){let e=[],t=null!==(a=h.posHalfBaseIndex)&&void 0!==a?a:h.posBaseIndex;for(let i=0;i<l.length;i+=3*d)e.push(s(t,l,i));n.push(e)}}else{if(e.bottom){let e=[];for(let t=0;t<l.length;t+=3*d)e.push(s(h.posLeftIndex,l,t));n.push(e);let t=[];for(let e=0;e<l.length;e+=3*d)t.push(s(h.posRightIndex,l,e));n.push(t)}if(e.top){let e=[];for(let t=0;t<l.length;t+=3*d)e.push(s(h.posLeftTopIndex,l,t));n.push(e);let t=[];for(let e=0;e<l.length;e+=3*d)t.push(s(h.posRightTopIndex,l,e));n.push(t)}if(e.center){let e=[],t=h.posBaseIndex;for(let i=0;i<l.length;i+=3*d)e.push(s(t,l,i));n.push(e)}}})),n}remove(){this.entity&&(this.entity.remove(),this.entity=null)}}jO=new WeakSet,VO=function(e,t,i){var n,s;let r,o=this.options.innerSideMaterial,a=this.options.outerMaterial;if(t&&(o=null!==(n=this.options.nodeInnerSideMaterial)&&void 0!==n?n:o,a=null!==(s=this.options.nodeOuterMaterial)&&void 0!==s?s:a),o){let t=e.getIndex().array.length;e.addGroup(0,t,0),e.addGroup(0,t,1),a.side=D,o.side=d,r=new h(e,[a,o])}else r=new h(e,a);return t?(r.isNode=!0,r.userData.dataIndexs=i):(r.isTube=!0,r.userData.dataIndex=i),!1!==this.options.asEntity?new FP(r).addTo(this.entity):this.entity.addObjects(r),r},HO=function(e,t,n,s,r,o){var a,l,h,c,d,u;let p=null!==(a=this.options.isMapMode)&&void 0!==a?a:null===(l=Cy.app)||void 0===l?void 0:l.isMapMode,f=new BT,m=e.filter((e=>!!e)).map((e=>Vv(e)));if(m.length<2)return;let g=new i(0,p?0:1,p?1:0);s?(f.set(m,0,0,g),f.array[1].widthScaleY=1,f.array[1].up=g):f.set(m,null!=n?n:5,null!==(h=this.options.cornerSplit)&&void 0!==h?h:10,g);let v=new kT({pathPointList:f,options:Object.assign(Object.assign(Object.assign({},this.options.sect),{shape:(null!==(d=null===(c=this.options.sect)||void 0===c?void 0:c.shape)&&void 0!==d?d:"circle")+(s?"Half":"")}),r),usage:this.options.usage});if(s)return{pathPointList:f,geometry:v};if(!0!==o){let e=qv(this,jO,"m",VO).call(this,v,!1,t);if(!s){e.userData._tubeParam={sect:v.options,pathPointList:f};let i=new E;i.setFromPoints(m);let n=2*(null!==(u=this.options.nodeRadius)&&void 0!==u?u:.3);i.expandByScalar(n),this.data[t]=Object.assign(Object.assign({},this.inputData[t]),{sect:v.options,pathPointList:f,mesh:e,box3d:i})}}return{pathPointList:f,geometry:v}};const nD=({object:e,follow:t=!0,lockX:i=!1,lockY:n=!1,lockZ:s=!1,baseOnPreRotation:r=!1})=>{const o={follow:t,lockX:i,lockY:n,lockZ:s,baseOnPreRotation:r},a=e.quaternion.clone();return{object:e,update:function(t){const{follow:i,lockX:n,lockY:s,lockZ:r,baseOnPreRotation:l}=o;if(!i)return;const h=e.rotation.clone();l?(t.getWorldQuaternion(e.quaternion),e.quaternion.premultiply(a)):t.getWorldQuaternion(e.quaternion),n&&(e.rotation.x=h.x),s&&(e.rotation.y=h.y),r&&(e.rotation.z=h.z)},dispose:function(){e.quaternion.copy(a)},updateProps(e){Object.assign(o,e)}}},sD=Zw({color:new s("black"),opacity:1,thickness:.05},"\n   #include <common>\n   #include <morphtarget_pars_vertex>\n   #include <skinning_pars_vertex>\n   uniform float thickness;\n   void main() {\n     #if defined (USE_SKINNING)\n\t   #include <beginnormal_vertex>\n       #include <morphnormal_vertex>\n       #include <skinbase_vertex>\n       #include <skinnormal_vertex>\n       #include <defaultnormal_vertex>\n     #endif\n     #include <begin_vertex>\n\t   #include <morphtarget_vertex>\n\t   #include <skinning_vertex>\n     #include <project_vertex>\n     vec4 transformedNormal_ = vec4(normal, 0.0);\n     vec4 transformedPosition = vec4(transformed, 1.0);\n     #ifdef USE_INSTANCING\n     transformedNormal_ = instanceMatrix * transformedNormal_;\n       transformedPosition = instanceMatrix * transformedPosition;\n     #endif\n     vec3 newPosition = transformedPosition.xyz + transformedNormal_.xyz * thickness;\n     gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); \n   }",`\n   uniform vec3 color;\n   uniform float opacity;\n   void main(){\n     gl_FragColor = vec4(color, opacity);\n     #include <tonemapping_fragment>\n     #include <${parseInt(ft.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>\n   }`);function rD({color:e=new s(16776960),opacity:t=1,transparent:i=!1,thickness:n=.5,angle:r=Math.PI}={}){const o=new V;let a={color:e,opacity:t,transparent:i,thickness:n,angle:r};function l(e){const t=o.parent;if(o.clear(),t&&t.geometry){let i;t.skeleton?(i=new mt,i.material=new sD({side:d}),i.bind(t.skeleton,t.bindMatrix),o.add(i)):t.isInstancedMesh?(i=new j(t.geometry,new sD({side:d}),t.count),i.instanceMatrix=t.instanceMatrix,o.add(i)):(i=new h,i.material=new sD({side:d}),o.add(i)),i.geometry=e?en(t.geometry,e):t.geometry}}function c(e){a=Object.assign(Object.assign({},a),e);const t=o.children[0];if(t){const{transparent:e,thickness:i,color:n,opacity:s}=a;Object.assign(t.material,{transparent:e,thickness:i,color:n,opacity:s})}}return{group:o,updateProps(e){var t;const i=null!==(t=e.angle)&&void 0!==t?t:a.angle;i!==a.angle&&l(i),c(e)},generate(){l(a.angle),c(a)},dispose(){lW(o),o.parent.remove(o)}}}const oD=["onSync","onPreloadEnd","characters"];function aD(e){return Object.keys(e).reduce(((t,i)=>(-1===oD.indexOf(i)&&(t[i]=e[i]),t)),{})}const lD=e=>Qv(void 0,void 0,void 0,(function*(){var{sdfGlyphSize:t=64,anchorX:i="center",anchorY:n="middle",fontSize:s=1}=e,r=Yv(e,["sdfGlyphSize","anchorX","anchorY","fontSize"]);let{troika_three_text:o}=yield Zk.loadPlugin("text3d");const a=Object.assign({sdfGlyphSize:t,anchorX:i,anchorY:n,fontSize:s},r),l=new o.Text;return Object.assign(l,aD(a)),a.font&&a.characters&&o.preloadFont({font:a.font,characters:a.characters},(()=>{a.onPreloadEnd&&a.onPreloadEnd()})),{mesh:l,updateProps(e){Object.assign(l,aD(e)),l.sync((()=>{a.onSync&&a.onSync(l)}))},dispose(){l.dispose()}}})),hD=({startFrame:e,endFrame:t,fps:n,frameName:s,textureDataURL:r,textureImageURL:o,loop:a,numberOfFrames:c,autoPlay:d,animationNames:u,onStart:p,onEnd:f,onLoopEnd:m,onFrame:v,play:y,pause:w,flipX:_,alphaTest:S,asSprite:M})=>{let C={frames:[],meta:{version:"1.0",size:{w:1,h:1},scale:"1"}},A=!1,E=new W;const T=new b({toneMapped:!1,transparent:!0,map:E,alphaTest:null!=S?S:0}),P=new x({toneMapped:!1,side:I,map:E,transparent:!0,alphaTest:null!=S?S:0}),O=new g(T),D=new h(new l(1,1),P);let B=T,R=O;const k=new V;k.add(R);let L=jy(),z=e||0,U=s||"";const F=1e3/(n||30),N=new i(1,1,1),j=e=>{N.copy(e)},H=_?-1:1;null==M||M?(B=T,R=O,k.add(O),k.remove(D)):(B=P,R=D,k.remove(O),k.add(D));const Y=(e,t)=>{const i=t/e;return R.scale.set(1,i,1),R.scale},X=(e,t)=>{if(null===e){if(t&&c){const e=t.image.width,i=t.image.height,n=e/c,s=i;if(C={frames:[],meta:{version:"1.0",size:{w:e,h:i},scale:"1"}},parseInt(n.toString(),10)===n)for(let e=0;e<c;e++)C.frames.push({frame:{x:e*n,y:0,w:n,h:s},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:n,h:s},sourceSize:{w:n,h:i}})}}else if(t){C=e,C.frames=Array.isArray(e.frames)?e.frames:Q();const{w:i,h:n}=Z(e.frames).sourceSize,s=Y(i,n);j(s),B&&(B.map=t)}var i;t.premultiplyAlpha=!1,E=i=t,B&&(B.map=i),q()},Q=()=>{const e={},t=C,i=u;if(i)for(let n=0;n<i.length;n++){e[i[n]]=[];for(const s in t.frames){const r=t.frames[s],o=r.frame,a=o.x,l=o.y,h=o.w,c=o.h,d=r.sourceSize.w,u=r.sourceSize.h;"string"==typeof s&&-1!==s.toLowerCase().indexOf(i[n].toLowerCase())&&e[i[n]].push({x:a,y:l,w:h,h:c,frame:o,sourceSize:{w:d,h:u}})}}return e},q=()=>{if(!C||!B.map)return;const{meta:{size:e},frames:t}=C,{w:i,h:n}=Array.isArray(t)?t[0].sourceSize:s&&t[s]?t[s][0].sourceSize:{w:0,h:0};B.map.wrapS=B.map.wrapT=G,B.map.center.set(0,0),B.map.repeat.set(1*H/(e.w/i),1/(e.h/n));const r=1/((e.h-1)/n);B.map.offset.x=0,B.map.offset.y=1-r,p&&p({currentFrameName:s,currentFrame:z})},Z=e=>Array.isArray(e)?e[0]:"object"==typeof e&&null!==e?e[Object.keys(e)[0]][0]:{w:0,h:0};return{group:k,init:()=>Qv(void 0,void 0,void 0,(function*(){if(r&&o)yield function(e,t,i){return Qv(this,void 0,void 0,(function*(){const n=new gt,s=fetch(e).then((e=>e.json())),r=new Promise((e=>{n.load(t,e)}));yield Promise.all([s,r]).then((e=>{i(e[0],e[1])}))}))}(r,o,X);else if(o){const e=new gt,t=yield e.loadAsync(o);X(null,t)}})),update:()=>{(null==C?void 0:C.frames)&&(null==B?void 0:B.map)&&(w||A||!d&&!y||((()=>{if(!C||!B.map)return;const i=jy(),n=i-L,{meta:{size:r},frames:o}=C,{w:l,h:h}=Z(o).sourceSize,c=Array.isArray(o)?o:s?o[s]:[];let d=0,u=0;const p=t||c.length-1;if(z>p&&(z=a&&null!=e?e:0,a?null==m||m({currentFrameName:s,currentFrame:z}):(null==f||f({currentFrameName:s,currentFrame:z}),A=!0),!a))return;if(n<=F)return;L=i-n%F,Y(l,h);const g=(r.w-1)/l,v=(r.h-1)/h,{frame:{x:y,y:x},sourceSize:{w:w,h:b}}=c[z],_=1/g,S=1/v;d=H>0?_*(y/w):_*(y/w)-B.map.repeat.x,u=Math.abs(1-S)-S*(x/b),B.map.offset.x=d,B.map.offset.y=u,z+=1})(),v&&v({currentFrameName:U,currentFrame:z})))},playAnimation:()=>{y=!0,w=!1},pauseAnimation:()=>{w=!0},setFrameName:e=>{U!==(s=e)&&s&&(z=0,U=s)}}};class cD{constructor(e={}){this.options=null!=e?e:{},this.iconUrl=e.iconUrl?e.iconUrl:null,this._originPositions=e.positions?e.positions:[],this.color=e.color?e.color:new s(0,1,0),this.opacity=e.hasOwnProperty("opacity")?e.opacity:1,this.lineWidth=e.width?e.width:20,this.useAlpha=!!e.hasOwnProperty("useAlpha")&&e.useAlpha,this.showLine=!e.hasOwnProperty("showLine")||e.showLine,this.placeLength=e.hasOwnProperty("placeLength")?e.placeLength:10,this.placeSpace=e.hasOwnProperty("placeSpace")?e.placeSpace:10,this.isAnimate=!!e.isAnimate&&e.isAnimate,this.speed=e.hasOwnProperty("speed")?e.speed:3,this.smooth=!e.hasOwnProperty("smooth")||e.smooth,this.uvOffset=0,this._init()}_init(){let e=this.color,t=this.opacity;this.colorArr=[e.r,e.g,e.b,t],this.smooth&&(this._originPositions=jv(this._originPositions,this.options.curvePointNum,this.options.curvePointPosRatio)),this._process()}setVisible(e){this.trail.visible=e}start(){this.isAnimate=!0}stop(){this.isAnimate=!1}compareV3(e,t){let i=6*e,n=6*t;return this.positions[i]===this.positions[n]&&this.positions[i+1]===this.positions[n+1]&&this.positions[i+2]===this.positions[n+2]}copyV3(e){let t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}_process(){this.positions=[];for(let e=0;e<this._originPositions.length;e++){let t=this._originPositions[e];t instanceof i?(this.positions.push(t.x,t.y,t.z?t.z:0),this.positions.push(t.x,t.y,t.z?t.z:0)):t instanceof Array&&(this.positions.push(t[0],t[1],t[2]),this.positions.push(t[0],t[1],t[2]))}var e,t=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices=[],this.uvs=[];for(var n=0;n<t;n++)this.side.push(1),this.side.push(-1);for(e=this.compareV3(0,t-1)?this.copyV3(t-2):this.copyV3(0),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]),n=0;n<t-1;n++)e=this.copyV3(n),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);for(n=1;n<t;n++)e=this.copyV3(n),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]);for(e=this.compareV3(t-1,0)?this.copyV3(1):this.copyV3(t-1),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]),n=0;n<t-1;n++){var s=2*n;this.indices.push(s,s+2,s+1),this.indices.push(s+2,s+3,s+1)}let o=0;for(n=0;n<t;n++){let e=this.previous[6*n],t=this.previous[6*n+1],i=this.previous[6*n+2],s=this.positions[6*n],r=this.positions[6*n+1],a=this.positions[6*n+2];o+=Math.sqrt((s-e)*(s-e)+(r-t)*(r-t)+(a-i)*(a-i)),this.uvs.push(o,0),this.uvs.push(o,1)}if(this.geometry=new S,this.geometry.setAttribute("position",new O(new Float32Array(this.positions),3)),this.geometry.setAttribute("previous",new O(new Float32Array(this.previous),3)),this.geometry.setAttribute("next",new O(new Float32Array(this.next),3)),this.geometry.setAttribute("side",new O(new Float32Array(this.side),1)),this.geometry.setAttribute("uv",new O(new Float32Array(this.uvs),2)),this.geometry.setIndex(new O(new Uint16Array(this.indices),1)),this.iconUrl){let e=new gt;const t=this;t.texture=e.load(this.iconUrl),t.texture.wrapS=Y,t.texture.wrapT=Y,t.texture.magFilter=Te,t.texture.minFilter=Te}this.material=new a({transparent:!0,side:I,uniforms:{u_lineWidth:{value:this.lineWidth},u_lineColor:{value:this.colorArr},u_pattern:{value:this.texture},u_useAlpha:{value:this.useAlpha},u_showLine:{value:this.showLine},u_placeLength:{value:this.placeLength},u_placeSpace:{value:this.placeSpace},u_uvOffset:{value:this.uvOffset},u_resolution:{value:1},u_mapSize:{value:new r(1,1)}},vertexShader:"    attribute vec3 previous;    attribute vec3 next;    attribute float side;    varying vec2 v_uv;    uniform float u_lineWidth;    uniform float u_resolution;   uniform vec2 u_mapSize;    void main() {        vec2 currentP;        vec2 prevP;        vec2 nextP;        vec4 finalPosition;        float width = u_lineWidth/2.0;           mat4 positionMat = projectionMatrix * modelViewMatrix;           finalPosition = positionMat * vec4(position,1.0);           currentP = (finalPosition.xy/finalPosition.w + vec2(1.0)) * u_mapSize / 2.0;           vec4 prevPos = positionMat * vec4(previous,1.0);           prevP = (prevPos.xy/prevPos.w + vec2(1.0)) * u_mapSize / 2.0;           vec4 nextPos = positionMat * vec4(next,1.0);           nextP = (nextPos.xy/nextPos.w + vec2(1.0)) * u_mapSize / 2.0;        float scale = 1.0;vec2 dir;        if( abs(nextP.x - currentP.x)<=0.000001 && abs(nextP.y - currentP.y)<=0.000001) dir = normalize( currentP - prevP );        else if( abs(prevP.x - currentP.x)<=0.000001 && abs(prevP.y - currentP.y) <=0.000001) dir = normalize( nextP - currentP );        else {            vec2 dir1 = normalize( currentP - prevP );            vec2 dir2 = normalize( nextP - currentP );            dir = normalize( dir1 + dir2 );        }        vec2 planeNormal = vec2(-dir.y, dir.x);        v_uv = vec2(uv.x, uv.y);        v_uv.x = v_uv.x/u_resolution;           vec4 offset = vec4(planeNormal * width * scale * side, 0.0, 1.0);           finalPosition.xy += offset.xy*2.0*finalPosition.w/u_mapSize;           gl_Position = finalPosition;    }",fragmentShader:" varying vec2 v_uv;    uniform vec4 u_lineColor;    uniform float u_placeLength;    uniform float u_placeSpace;    uniform float u_uvOffset;    uniform bool u_showLine;    uniform bool u_useAlpha;    uniform sampler2D u_pattern;            void main() {                vec4 color = u_lineColor;                vec2 outUv = v_uv;                outUv.x = fract(outUv.x/(u_placeLength + u_placeSpace)-u_uvOffset)*(u_placeLength + u_placeSpace)/u_placeLength;                vec4 textureColor = texture2D(u_pattern,outUv);                if(u_showLine){                    if(u_useAlpha){                        color.a *= textureColor.a;                        gl_FragColor = color;                    }else{                        gl_FragColor = color*(1.0 - textureColor.a) + textureColor * textureColor.a;                    }                }else{                    gl_FragColor = textureColor;                }            } "}),this.trail=new h(this.geometry,this.material)}update(e){if(this.isAnimate&&(this.uvOffset+=.01*this.speed,this.uvOffset>1&&this.uvOffset--),this.material.uniforms.u_uvOffset.value=this.uvOffset,e)if(this.material.uniforms.u_mapSize.value.set(e.containerSize.width,e.containerSize.height),e.isMapMode){let t=e.map.unproject([0,e.containerSize.height/2]),i=e.map.unproject([e.containerSize.width,e.containerSize.height/2]),n=BP.projectToWorld([t.lng,t.lat]),s=BP.projectToWorld([i.lng,i.lat]);this.material.uniforms.u_resolution.value=Math.abs(n.x-s.x)/e.containerSize.width}else if(e.camera&&e.cameraControl){let t=new i;e.cameraControl.getTarget(t);let n=e.camera.position,s=(new i).subVectors(t,n).length(),r=e.camera.fov,o=Math.tan(Math.PI*r/360)*s*2/window.innerHeight;this.material.uniforms.u_resolution.value=o}}}var dD,uD,pD,fD,mD,gD,vD,yD,xD,wD,bD,_D,SD,MD,CD,AD,ED;class TD extends g{constructor(e,t){var n,s,r,o;if(super(e.material),dD.add(this),uD.set(this,void 0),this.options=e,this.app=null!=t?t:Cy.app,!e.material&&e.texture)this.material&&this.material.dispose(),this.material=new b({map:e.texture});else if(!e.material&&e.renderTexture){this.material&&this.material.dispose();let t=IA(Object.assign({},e.renderTexture));Zv(this,uD,t,"f");let i=t.texture({expandRect:this.options.expandRect});this.material=new b({map:i})}if(qv(this,dD,"m",pD).call(this),0==e.sizeAttenuation){this.material.sizeAttenuation=!1;let e=null!==(n=this.options.width)&&void 0!==n?n:this.material.map.source.data.width,t=null!==(s=this.options.height)&&void 0!==s?s:this.material.map.source.data.height;this.width=e,this.height=t}else{if(this.width=e.width,this.height=e.height,!this.width&&!this.height)throw Error("width or height is null");this.width?this.height||(this.height=this.width*this.material.map.source.data.height/this.material.map.source.data.width):this.width=this.height*this.material.map.source.data.width/this.material.map.source.data.height}if(this.updateScale(),this.updateAnchor(),e.position){let t=e.position;Array.isArray(e.position)&&(t=new i(...e.position)),this.position.copy(t)}e.rotation&&(this.material.rotation=Wv(e.rotation)),this._refreshRenderTexture=av((()=>{if(!qv(this,uD,"f"))return;let e=qv(this,uD,"f").texture({expandRect:this.options.expandRect});e.needsUpdate=!0,this.material.map.dispose(),this.material.map=e}),null!==(r=e.refreshRenderThrottleTimeout)&&void 0!==r?r:20),0==this.options.sizeAttenuation&&(this.__updateScaleBindFunc=this.updateScale.bind(this),(null===(o=this.app)||void 0===o?void 0:o.isMapMode)?this.app.signal.onCameraUpdate.add(this.__updateScaleBindFunc):this.app.signal.onContainerSizeChange.add(this.__updateScaleBindFunc)),this.addEventListener("added",(()=>this.setAllowOverlap(this.options.allowOverlap))),this.addEventListener("removed",(()=>this.dispose()))}setMaterial(e){this.material=e,qv(this,dD,"m",pD).call(this)}updateRenderTexture(e){qv(this,uD,"f")&&qv(this,uD,"f").update(e)&&this.refreshRenderTexture()}refreshRenderTexture(){qv(this,uD,"f")&&this._refreshRenderTexture()}dispatchRenderTextureEvent(e,t,i){qv(this,uD,"f")&&qv(this,uD,"f").dispatchEvent(e,t,i)}setAllowOverlap(e){!1===e?this.app.addCollideRectObject(this):this.app.removeCollideRectObject(this)}updateScale(){var e;if(0==this.options.sizeAttenuation){let t=null!==(e=this.app.camera.fov)&&void 0!==e?e:45;t=Wv(t);let i=this.width*(2*Math.tan(t/2))/this.app.containerSize.height,n=this.height*(2*Math.tan(t/2))/this.app.containerSize.height;this.app.isMapMode&&(i*=this.app.map._screenMatrixWorldInvert.scale.x,n*=this.app.map._screenMatrixWorldInvert.scale.y),this.scale.set(i,n,1)}else this.scale.set(this.width,this.height,1)}updateAnchor(){let e=.5,t=0;"left"==this.options.anchorX?e=0:"center"==this.options.anchorX?e=.5:"right"==this.options.anchorX?e=1:"number"==typeof this.options.anchorX&&(e=this.options.anchorX),"top"==this.options.anchorY?t=1:"center"==this.options.anchorY?t=.5:"bottom"==this.options.anchorY?t=0:"number"==typeof this.options.anchorY&&(t=this.options.anchorY),this.options.offsetX&&(e-=this.options.offsetX/this.width),this.options.offsetY&&(t+=this.options.offsetY/this.height),this.center=new r(e,t)}getBoundingRect(){var e,t;let n,s,r=this.app.project(this.position);if(0==this.options.sizeAttenuation)n=this.width,s=this.height;else{let e=new i;e.setFromMatrixPosition(this.matrixWorld);let t=(new c).setFromNormalAndCoplanarPoint(wW(this.app),e),o=this.app.unproject(r.x+1e3,r.y,t);if(!o)return;let a=o.distanceTo(this.position)/1e3;if(!a)return;n=this.width/a,s=this.height/a}let o=r.x-this.center.x*n,a=r.y-(1-this.center.y)*s;return{x1:o,y1:a,x2:o+n,y2:a+s,cx:r.x,cy:r.y,rotation:null!==(e=this.options.rotation)&&void 0!==e?e:0,position:this.position,zIndex:null!==(t=this.options.collideZIndex)&&void 0!==t?t:0,id:this.options.collideId,groupName:this.options.collideGroupName,setVisible:e=>this.visible=e}}dispose(){var e;qv(this,uD,"f")&&(qv(this,uD,"f").dispose(),Zv(this,uD,null,"f")),this.__updateScaleBindFunc&&((null===(e=this.app)||void 0===e?void 0:e.isMapMode)?this.app.signal.onCameraUpdate.remove(this.__updateScaleBindFunc):this.app.signal.onContainerSizeChange.remove(this.__updateScaleBindFunc)),this.material&&(this.material.dispose(),this.material=null),this.setAllowOverlap(!0)}}uD=new WeakMap,dD=new WeakSet,pD=function(){var e;if(this.material.transparent=!0,this.material.depthWrite=!1,this.options.materialParameters)for(let e in this.options.materialParameters)this.material[e]=this.options.materialParameters[e];if(0==this.options.sizeAttenuation&&(this.material.sizeAttenuation=!1),!this.options.fadeDistance&&!(null===(e=this.app)||void 0===e?void 0:e.isMapMode))return;let t=this.material.onBeforeCompile;if(t.toString().indexOf("varying vec3 vPosition")>=0)return;const i=(e,n)=>{var s;e.vertexShader.indexOf("varying vec3 vPosition")>=0||(t!=i&&t(e,n),null!==(s=e.defines)&&void 0!==s||(e.defines={}),this.options.fadeDistance&&(e.defines.USE_FADDISTANCE="",e.uniforms.fadeDistance={value:this.options.fadeDistance+0}),e.vertexShader=e.vertexShader.replace("#include <common>","\n             varying vec3 vPosition;\n             #include <common>\n             "),e.vertexShader=e.vertexShader.replace("#include <logdepthbuf_vertex>","\n            vPosition = mvPosition.xyz;\n            #include <logdepthbuf_vertex>\n            "),e.vertexShader=e.vertexShader.replace("if ( isPerspective ) scale *= - mvPosition.z;","\n            if ( isPerspective ) scale *= - mvPosition.z;\n            "),e.fragmentShader=e.fragmentShader.replace("#include <common>","\n            varying vec3 vPosition;\n            #ifdef USE_FADDISTANCE\n            uniform float fadeDistance;\n            #endif\n            #include <common>\n            "),e.fragmentShader=e.fragmentShader.replace("#include <logdepthbuf_fragment>","\n            #ifdef USE_FADDISTANCE\n             if (fadeDistance > 0.0 ) {\n                diffuseColor.a = clamp(2.0 * (1.0 - distance(vPosition, cameraPosition) / fadeDistance ) * diffuseColor.a, 0.0, 1.0);\n                if (diffuseColor.a < 0.05) {\n                    discard;\n                }\n            }\n            #endif\n            #include <logdepthbuf_fragment>\n            "))};this.material.onBeforeCompile=i};class PD extends V{constructor(e,t){super(),fD.set(this,new Map),mD.set(this,new Map),gD.set(this,void 0),Zv(this,gD,e,"f"),this.app=t,this.setData(e.data),this.addEventListener("removed",(()=>this.dispose()))}getOptions(){return qv(this,gD,"f")}update(){this.setData(this.getData())}getData(){return this.data}setItemHighlight(e,t){e<0||e>=this.data.length||this.data[e].highlightMaterial&&(t?this.data[e].object.material!==this.data[e].highlightMaterial&&this.data[e].object.setMaterial(this.data[e].highlightMaterial):this.data[e].object.material!==this.data[e].material&&this.data[e].object.setMaterial(this.data[e].material))}setData(e){return Qv(this,void 0,void 0,(function*(){for(let e=this.children.length-1;e>=0;e--)this.remove(this.children[e]);this.children=[];let t=[];for(let i=0;i<e.length;i++)t.push(Object.assign({},e[i]));this.data=t;let i=[],n=new Set;for(let e=0;e<t.length;e++){let s=t[e].icon;"string"==typeof s&&(qv(this,fD,"f").has(s)?t[e].icon=qv(this,fD,"f").get(s):(n.add(s),i.push(cG(s))));let r=t[e].highlightIcon;r&&"string"==typeof r&&(qv(this,fD,"f").has(r)?t[e].highlightIcon=qv(this,fD,"f").get(r):(n.add(r),i.push(cG(r))))}if(n.size>0){let e=Array.from(n);i=e.map(cG);let t=yield Promise.all(i);for(let i=0;i<e.length;i++)qv(this,fD,"f").set(e[i],t[i])}let s=new Set,r=new Set;const o=(e,t,i)=>{var n,o,a;if("string"==typeof e){if(!qv(this,fD,"f").has(e))throw Error("not load image "+e);s.add(e),e=qv(this,fD,"f").get(e)}let l=e.width,h=e.height;0==qv(this,gD,"f").sizeAttenuation&&(t.width&&(l=t.width),t.height&&(h=t.height)),i=null!==(o=null!=i?i:null===(n=qv(this,gD,"f").materialParameters)||void 0===n?void 0:n.opacity)&&void 0!==o?o:1;let c,d=`${null==e?void 0:e.src}_${l}_${h}_${(null!==(a=t.rotation)&&void 0!==a?a:0).toFixed(6)}_${(null!=i?i:0).toFixed(6)}`;if(r.add(d),qv(this,mD,"f").has(d))c=qv(this,mD,"f").get(d);else{let i=IA({autoCanvasSize:!1,canvasHeight:h,canvasWidth:l,sharedCanvas:!1,elements:[new qh({style:{x:0,y:0,image:e,width:l,height:h}})]}),n=i.texture({copyData:!0,expandRect:qv(this,gD,"f").expandRect});c=new b(Object.assign(Object.assign({},qv(this,gD,"f").materialParameters),{map:n})),t.rotation&&(c.rotation=Wv(t.rotation)),qv(this,mD,"f").set(d,c),i.dispose()}return c};for(let e=0;e<t.length;e++){let i=t[e],n=o(i.icon,i);i.material=n,i.highlightOpacity>0&&!i.highlightIcon&&(i.highlightIcon=i.icon),i.highlightIcon&&(i.highlightMaterial=o(i.highlightIcon,i,i.highlightOpacity),i.highlightOpacity&&(i.highlightMaterial.opacity=i.highlightOpacity));let s=new TD(Object.assign(Object.assign({},i),{sizeAttenuation:qv(this,gD,"f").sizeAttenuation,materialParameters:qv(this,gD,"f").materialParameters,refreshRenderThrottleTimeout:qv(this,gD,"f").refreshRenderThrottleTimeout,fadeDistance:qv(this,gD,"f").fadeDistance,allowOverlap:qv(this,gD,"f").allowOverlap,collideGroupName:qv(this,gD,"f").collideGroupName,material:n}),this.app);i.object=s,s.userData.objectDataIndex=e,this.add(s)}let a=qv(this,fD,"f").keys();for(let e of a)s.has(e)||qv(this,fD,"f").delete(e);let l=qv(this,mD,"f").keys();for(let e of l)r.has(e)||(qv(this,mD,"f").get(e).dispose(),qv(this,mD,"f").delete(e))}))}dispose(){this.setData([]);let e=qv(this,mD,"f").keys();for(let t of e)qv(this,mD,"f").get(t).dispose();qv(this,mD,"f").clear(),qv(this,fD,"f").clear()}}fD=new WeakMap,mD=new WeakMap,gD=new WeakMap;class OD extends V{constructor(e,t){super(),vD.add(this),yD.set(this,new Map),xD.set(this,void 0),wD.set(this,new Map),bD.set(this,void 0),Zv(this,xD,e,"f"),this.app=t,this.setData(e.data),this.addEventListener("removed",(()=>this.dispose()))}getOptions(){return qv(this,xD,"f")}update(){this.setData(this.getData())}getData(){return this.data}setItemHighlight(e,t){e<0||e>=this.data.length||this.data[e].highlightMaterial&&(t?this.data[e].object.material!==this.data[e].highlightMaterial&&this.data[e].object.setMaterial(this.data[e].highlightMaterial):this.data[e].object.material!==this.data[e].material&&this.data[e].object.setMaterial(this.data[e].material))}setData(e){var t;return Qv(this,void 0,void 0,(function*(){let i={sizeAttenuation:qv(this,xD,"f").sizeAttenuation,fadeDistance:qv(this,xD,"f").fadeDistance,allowOverlap:qv(this,xD,"f").allowOverlap,collideGroupName:qv(this,xD,"f").collideGroupName},n=JSON.stringify(i);if(n!=qv(this,bD,"f")){let e=qv(this,wD,"f").keys();for(let t of e){let e=qv(this,wD,"f").get(t);this.remove(e)}qv(this,wD,"f").clear(),Zv(this,bD,n,"f")}let s=[];for(let t=0;t<e.length;t++)s.push(Object.assign({},e[t]));this.data=s;let r=new Set,o=new Set;const a=(e,t,i)=>{let n,s=!1!==i.autoCanvasSize,o=!1!==i.sharedCanvas,a=e+qv(this,vD,"m",_D).call(this,t)+i.autoCanvasSize+(i.rotation||0).toFixed(6);if(r.add(a),qv(this,yD,"f").has(a))n=qv(this,yD,"f").get(a);else{let r=IA({autoCanvasSize:s,canvasHeight:i.width,canvasWidth:i.height,sharedCanvas:o,elements:[new qd({style:Object.assign({text:e},t)})]}),l=r.texture({copyData:!0,expandRect:qv(this,xD,"f").expandRect});n=new b(Object.assign(Object.assign({},qv(this,xD,"f").materialParameters),{map:l})),i.rotation&&(n.rotation=Wv(i.rotation)),qv(this,yD,"f").set(a,n),o||r.dispose()}return n};for(let e=0;e<s.length;e++){let i=s[e];i.id=null!==(t=i.id)&&void 0!==t?t:e+"";let n=i.text,r=a(n,i.style,i);i.material=r,i.highlightStyle&&(i.highlightMaterial=a(n,i.highlightStyle,i));let l=qv(this,vD,"m",SD).call(this,i);if(qv(this,wD,"f").has(l)){o.add(l);continue}let h=new TD(Object.assign(Object.assign({},i),{sizeAttenuation:qv(this,xD,"f").sizeAttenuation,materialParameters:qv(this,xD,"f").materialParameters,refreshRenderThrottleTimeout:qv(this,xD,"f").refreshRenderThrottleTimeout,fadeDistance:qv(this,xD,"f").fadeDistance,allowOverlap:qv(this,xD,"f").allowOverlap,collideGroupName:qv(this,xD,"f").collideGroupName,material:r}),this.app);i.object=h,h.userData.objectDataIndex=e,this.add(h),qv(this,wD,"f").set(l,h),o.add(l)}let l=qv(this,wD,"f").keys();for(let e of l)if(!o.has(e)){let t=qv(this,wD,"f").get(e);this.remove(t)}let h=qv(this,yD,"f").keys();for(let e of h)r.has(e)||(qv(this,yD,"f").get(e).dispose(),qv(this,yD,"f").delete(e))}))}dispose(){this.setData([]);let e=qv(this,yD,"f").keys();for(let t of e)qv(this,yD,"f").get(t).dispose();qv(this,yD,"f").clear(),qv(this,wD,"f").clear()}}function DD(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}yD=new WeakMap,xD=new WeakMap,wD=new WeakMap,bD=new WeakMap,vD=new WeakSet,_D=function(e){var t;if(!e)return"";let i=e.backgroundColor;if(i&&i.image){let n=Object.assign({},e);return delete n.backgroundColor,JSON.stringify(n)+(null===(t=i.image)||void 0===t?void 0:t.src)}return JSON.stringify(e)},SD=function(e){let t={id:e.id,position:e.position,text:e.text,anchorX:e.anchorX,anchorY:e.anchorY,offsetX:e.offsetX,offsetY:e.offsetY,rotation:e.rotation,width:e.width,height:e.height,collideZIndex:e.collideZIndex,collideId:e.collideId,autoCanvasSize:e.autoCanvasSize,sharedCanvas:e.sharedCanvas};return JSON.stringify(t)+qv(this,vD,"m",_D).call(this,e.style)+qv(this,vD,"m",_D).call(this,e.highlightStyle)};class BD{constructor(e){var t;if(MD.add(this),this.animationClips=[],CD.set(this,void 0),this.isAnimator=!0,this.signal={onLoop:new cy,onFinished:new cy},Array.isArray(e.object)){let t=new vt;e.object.forEach((e=>{!0===e.isObject3D?t.add(e):!0===e.isEntity&&t.add(e.node)})),this.animateMixer=new yt(t)}else this.animateMixer=new yt(e.object.isEntity?e.object.node:e.object);let i=null!==(t=e.animations)&&void 0!==t?t:[];Array.isArray(i)||(i=[i]),i.forEach((e=>this.addAnimationClip(e))),this.animateMixer.addEventListener("loop",(e=>{this.signal.onLoop.dispatch(e)})),this.animateMixer.addEventListener("finished",(e=>{this.signal.onFinished.dispatch(e)})),qv(this,MD,"m",AD).call(this)}stopAllAction(){return this.animateMixer.stopAllAction()}getClipNames(){return this.animationClips.map((e=>e.name))}setTime(e){return this.animateMixer.setTime(e)}addAnimationClip(e){if(e)return qv(this,MD,"m",ED).call(this,e)?this.animationClips.push(e):this.animationClips.push(xt.parse(e)),this.animationClips[this.animationClips.length-1]}getAnimateMixer(){return this.animateMixer}getAnimationClips(){return this.animationClips}getClip(e){return"number"!=typeof e?"string"==typeof e?xt.findByName(this.animationClips,e):e:e<this.animationClips.length?this.animationClips[e]:void 0}addAnimationSubclip(e,t,i,n,s){let r=this.getClip(e);r&&this.addAnimationClip(function(e,t,i,n,s=30){const r=e.clone();r.name=t;const o=[];for(let e=0;e<r.tracks.length;++e){const t=r.tracks[e],a=t.getValueSize(),l=[],h=[];for(let e=0;e<t.times.length;++e){const r=t.times[e]*s;if(!(r<i||r>=n)){l.push(t.times[e]);for(let i=0;i<a;++i)h.push(t.values[e*a+i])}}0!==l.length&&(t.times=DD(l,t.times.constructor),t.values=DD(h,t.values.constructor),o.push(t))}r.tracks=o;let a=1/0;for(let e=0;e<r.tracks.length;++e)a>r.tracks[e].times[0]&&(a=r.tracks[e].times[0]);for(let e=0;e<r.tracks.length;++e)r.tracks[e].shift(-1*a);return r.resetDuration(),r}(r,n,t,i,s))}getclipAction(e){let t=this.getClip(e);if(t)return this.animateMixer.clipAction(t)}play(e){var t;return null===(t=this.getclipAction(null!=e?e:0))||void 0===t?void 0:t.play()}stop(e){var t;if(null!=e)return null===(t=this.getclipAction(e))||void 0===t?void 0:t.stop();this.getClipNames().forEach((e=>{var t;return null===(t=this.getclipAction(e))||void 0===t?void 0:t.stop()}))}reset(e){var t;return null===(t=this.getclipAction(e))||void 0===t?void 0:t.reset()}isRunning(e){var t;return null===(t=this.getclipAction(e))||void 0===t?void 0:t.isRunning()}isScheduled(e){var t;return null===(t=this.getclipAction(e))||void 0===t?void 0:t.isScheduled()}setClampWhenFinished(e,t){let i=this.getclipAction(e);i&&(i.clampWhenFinished=t)}setEnable(e,t){let i=this.getclipAction(e);i&&(i.enabled=t)}startAt(e,t){var i;return null===(i=this.getclipAction(e))||void 0===i?void 0:i.startAt(t)}setLoop(e,t,i){var n;return null===(n=this.getclipAction(e))||void 0===n?void 0:n.setLoop(t,i)}setEffectiveWeight(e,t){var i;return null===(i=this.getclipAction(e))||void 0===i?void 0:i.setEffectiveWeight(t)}getEffectiveWeight(e){var t;return null===(t=this.getclipAction(e))||void 0===t?void 0:t.getEffectiveWeight()}fadeIn(e,t){var i;return null===(i=this.getclipAction(e))||void 0===i?void 0:i.fadeIn(t)}fadeOut(e,t){var i;return null===(i=this.getclipAction(e))||void 0===i?void 0:i.fadeOut(t)}crossFadeFrom(e,t,i,n){var s;return null===(s=this.getclipAction(e))||void 0===s?void 0:s.crossFadeFrom(t,i,n)}crossFadeTo(e,t,i,n){var s;return null===(s=this.getclipAction(e))||void 0===s?void 0:s.crossFadeTo(t,i,n)}stopFading(e){var t;return null===(t=this.getclipAction(e))||void 0===t?void 0:t.stopFading()}setEffectiveTimeScale(e,t){var i;return null===(i=this.getclipAction(e))||void 0===i?void 0:i.setEffectiveTimeScale(t)}getEffectiveTimeScale(e){var t;return null===(t=this.getclipAction(e))||void 0===t?void 0:t.getEffectiveTimeScale()}setDuration(e,t){var i;return null===(i=this.getclipAction(e))||void 0===i?void 0:i.setDuration(t)}syncWith(e,t){var i;return null===(i=this.getclipAction(e))||void 0===i?void 0:i.syncWith(t)}halt(e,t){var i;return null===(i=this.getclipAction(e))||void 0===i?void 0:i.halt(t)}warp(e,t,i,n){var s;return null===(s=this.getclipAction(e))||void 0===s?void 0:s.warp(t,i,n)}stopWarping(e){var t;return null===(t=this.getclipAction(e))||void 0===t?void 0:t.stopWarping()}addRotationAnimation(e,t="y",i=null){const n=".rotation["+t+"]",s=new wt(n,[0,e=null!=e?e:180],[0,360]);return this.addAnimationClip(new xt(i||n,e,[s]))}addScaleAxisAnimation(e,t="y",i=null){const n=[0,e=null!=e?e:180];let s=[0,1];"xy"==t?s=[0,0,1,1,1,1]:"xz"==t?s=[0,1,0,1,1,1]:"yz"==t?s=[1,0,0,1,1,1]:"xyz"==t&&(s=[0,0,0,1,1,1]);const r=1==t.length?".scale["+t+"]":".scale",o=1==t.length?new wt(r,n,s):new bt(r,n,s);return this.addAnimationClip(new xt(i||r,e,[o]))}addShakeAnimation(e,t,n=null){e=null!=e?e:180,"number"==typeof(t=null!=t?t:1.2)&&(t=new i(t,t,t));const s=[],r=[],o=new i;for(let i=0;i<10*e;i++)s.push(i/10),o.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(t).toArray(r,r.length);const a=new bt(".position",s,r);return this.addAnimationClip(new xt(n||".shake.animation",e,[a]))}addPulsationAnimation(e,t,n=null){e=null!=e?e:180,t=null!=t?t:1.2;const s=[],r=[],o=new i;for(let i=0;i<10*e;i++){s.push(i/10);const e=Math.random()*t;o.set(e,e,e).toArray(r,r.length)}const a=new bt(".scale",s,r);return this.addAnimationClip(new xt(n||".pulsation.animation",e,[a]))}addVisibilityAnimation(e,t=null){const i=new _t(".visible",[0,(e=null!=e?e:.5)/2,e],[!0,!1,!0]);return i.setInterpolation(St),this.addAnimationClip(new xt(t||".visible.animation",e,[i]))}addMaterialColorAnimation(e,t,i=null){const n=[],s=[],r=(e=null!=e?e:180)/(t=null!=t?t:[{r:1,g:0,b:0},{r:0,g:0,b:0},{r:0,g:0,b:1}]).length;for(let e=0;e<t.length;e++){n.push(e*r);const i=t[e];s.push(i.r,i.g,i.b)}const o=".material.color",a=new Mt(o,n,s);return this.addAnimationClip(new xt(i||o,e,[a]))}update(e){this.animateMixer.update(e)}dispose(){this.animateMixer._root&&this.animateMixer.uncacheRoot(this.animateMixer._root),this.animationClips=[],delete this.animateMixer,delete this.animationClips}addTo(e,t){qv(this,CD,"f")||(!1!==t&&this.play(),Zv(this,CD,e.signal.onAppUpdate.add((e=>this.update(e.deltaTime))),"f"))}remove(){qv(this,CD,"f")&&qv(this,CD,"f").call(this),this.dispose()}}CD=new WeakMap,MD=new WeakSet,AD=function(){let e=this.getClipNames()||[],t={clipName:e.length>0?e[0]:"",addAniName:""};const i=e=>{var t,i;this.stopAllAction();let n=this[e]();this.play(n.name),null===(i=(t=this.uiConfig).uiRefresh)||void 0===i||i.call(t,!1)};this.uiConfig={type:"folder",expanded:!0,label:"Animator",children:[{type:"dropdown",label:"关键帧名称",property:[t,"clipName"],children:[()=>this.getClipNames().map((e=>({label:e,value:e})))]},{type:"button",label:"播放动画",onClick:()=>{this.stopAllAction(),this.play(t.clipName)}},{type:"button",label:"停止动画",onClick:()=>{this.stop(t.clipName)}},{type:"button",label:"重置动画",onClick:()=>{this.reset(t.clipName)}},{type:"dropdown",label:"增加动画",property:[t,"addAniName"],children:[{label:"",value:""},{label:"增加旋转动画",value:"addRotationAnimation"},{label:"增加缩放动画",value:"addScaleAxisAnimation"},{label:"增加晃动动画",value:"addShakeAnimation"},{label:"增加脉动动画",value:"addPulsationAnimation"},{label:"增加闪烁动画",value:"addVisibilityAnimation"},{label:"增加颜色变化动画",value:"addMaterialColorAnimation"}],onChange:e=>{e.value&&i(e.value)}},...$T(this)||[]]}},ED=function(e){return!!e&&"resetDuration"in e},Xv([lP("停止所有动作")],BD.prototype,"stopAllAction",null);const ID="\n#include <common>\n#include <clipping_planes_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\nvarying vec2 vUv;\nvoid main() {\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vUv = uv;\n    gl_Position = vec4(position,1.0);\n    #include <fog_vertex>\n}\n",RD="\nuniform sampler2D map;\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n    fragColor = texture2D( map, uv );\n}";class kD{constructor(e,t={}){var i;let{vertexShader:n=ID,fragmentShader:r=RD,uniforms:o={},opacity:c}=t,d=`\n    \nuniform float iGlobalTime;\nuniform float iTime;\nuniform float iTimeDelta;\nuniform vec3 iResolution;\nuniform vec4 iMouse;\nuniform int iFrame;\nuniform vec4 iDate;\nuniform float iSampleRate;\n\nuniform sampler2D iChannel0;\nuniform sampler2D iChannel1;\nuniform sampler2D iChannel2;\nuniform sampler2D iChannel3;\nuniform samplerCube iChannel0Cube;\nuniform samplerCube iChannel1Cube;\nuniform samplerCube iChannel2Cube;\nuniform samplerCube iChannel3Cube;\n\nuniform float iChannelTime[4];\n\n\n    ${r}\n\n    `;if(void 0!==t.opacityColor){let e=new s(t.opacityColor);d+=`\n      varying vec2 vUv;\n      uniform float opacity;\nvoid main(){\n    mainImage(gl_FragColor, vUv*iResolution.xy);\n    gl_FragColor.a *= opacity;\n    if (gl_FragColor.rgb == vec3(${e.r},${e.g},${e.b})) {\n      gl_FragColor.a = 0.0;\n    }\n    #include <tonemapping_fragment>\n    #include <colorspace_fragment> \n}\n      `}else d+="\nvarying vec2 vUv;\nuniform float opacity;\nvoid main(){\n    mainImage(gl_FragColor, vUv*iResolution.xy);\n    gl_FragColor.a *= opacity;\n    #include <tonemapping_fragment>\n    #include <colorspace_fragment> \n}\n";const u=new l(2,2);let p=Object.assign(Object.assign(Object.assign(Object.assign({},e.commonUniforms),{opacity:{value:null!=c?c:1}}),o),{iMouse:t.mouseInputPos?{value:[t.mouseInputPos[0],t.mouseInputPos[1],0,0]}:e.commonUniforms.iMouse});if(t.map&&(p.map={value:t.map}),t.material)this.material=t.material,this.material.onBeforeCompile=e=>{e.vertexShader.indexOf("#include <project_vertex>")>=0?e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\r\ngl_Position=vec4(position,1.);"):e.vertexShader=ID},this.material.depthWrite=!0===t.depthWrite;else{let e={depthWrite:!0===t.depthWrite,depthTest:null!==(i=t.depthTest)&&void 0!==i&&i};this.material=new a(Object.assign(Object.assign({vertexShader:n,fragmentShader:d,uniforms:p,side:I,transparent:void 0!==c},e),t.materialParam))}const f=new h(u,this.material);f.name="ScreenQuad",void 0!==(null==t?void 0:t.renderOrder)&&(f.renderOrder=null==t?void 0:t.renderOrder),f.frustumCulled=!0===(null==t?void 0:t.frustumCulled),this.mesh=f,vW(f,!1)}}const LD=new E;class zD extends V{constructor(e,t){var i,n,s;super(),this.options=null!=t?t:{};const r=new Float32Array(216),o=new S;o.setAttribute("position",new O(r,3)),this.lineSegs=new L(o,new k(Object.assign({color:null!==(i=this.options.lineColor)&&void 0!==i?i:65280},this.options.lineMaterialParam)));const a=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,0,1,5,0,5,4,2,3,7,2,7,6,0,4,7,0,7,3,1,5,6,1,6,2]),l=new S,c=new Float32Array(24);l.setIndex(new O(a,1)),l.setAttribute("position",new O(c,3));let d,u=null!==(n=this.options.fillOpacity)&&void 0!==n?n:0;this.mesh=new h(l,new x(Object.assign({color:null!==(s=this.options.fillColor)&&void 0!==s?s:65280,side:I,transparent:!0,opacity:u,depthWrite:1!=this.options.fillOpacity,colorWrite:0!==this.options.fillOpacity},this.options.fillMaterialParam))),(null==e?void 0:e.isBox3)?this.box3=e:(this.object=e,d=e),this.type="BoxHelper2",this.matrixAutoUpdate=!1,this.update(),this.add(this.lineSegs),u>.001&&this.add(this.mesh),this.lineSegs.type="BoxHelper2",this.mesh.type="BoxHelper2",vW(this,!1,d?[d]:void 0)}update(){if(void 0!==this.object?LD.setFromObject(this.object):this.box3&&LD.copy(this.box3),LD.isEmpty())return;const e=this.object?this.object.worldToLocal(LD.min):LD.min,t=this.object?this.object.worldToLocal(LD.max):LD.max,i=this.mesh.geometry.attributes.position,n=i.array;n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=e.x,n[4]=t.y,n[5]=t.z,n[6]=e.x,n[7]=e.y,n[8]=t.z,n[9]=t.x,n[10]=e.y,n[11]=t.z,n[12]=t.x,n[13]=t.y,n[14]=e.z,n[15]=e.x,n[16]=t.y,n[17]=e.z,n[18]=e.x,n[19]=e.y,n[20]=e.z,n[21]=t.x,n[22]=e.y,n[23]=e.z,i.needsUpdate=!0,this.mesh.geometry.computeBoundingSphere();const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=this.lineSegs.geometry.attributes.position,o=r.array;let a=0;for(let e=0;e<s.length;e+=2){let t=n[3*s[e]],i=n[3*s[e]+1],r=n[3*s[e]+2],l=n[3*s[e+1]],h=n[3*s[e+1]+1],c=n[3*s[e+1]+2];o[a++]=t,o[a++]=i,o[a++]=r;let d=.1;o[a++]=Cv(t,l,d),o[a++]=Cv(i,h,d),o[a++]=Cv(r,c,d),d=.45,o[a++]=Cv(t,l,d),o[a++]=Cv(i,h,d),o[a++]=Cv(r,c,d),d=.55,o[a++]=Cv(t,l,d),o[a++]=Cv(i,h,d),o[a++]=Cv(r,c,d),d=.9,o[a++]=Cv(t,l,d),o[a++]=Cv(i,h,d),o[a++]=Cv(r,c,d),o[a++]=l,o[a++]=h,o[a++]=c}r.needsUpdate=!0,this.lineSegs.geometry.computeBoundingSphere(),this.lineSegs.computeLineDistances()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this.options=e.options,this}dispose(){lW(this)}}var UD,FD,ND,jD,VD,HD;class WD{constructor(e){UD.add(this),FD.set(this,void 0),this.options=e}create(){var e,t,i;return Qv(this,void 0,void 0,(function*(){if(this.heatmap)return;let n=qv(this,UD,"m",ND).call(this,this.options);this.bounds=n;let s=null!==(e=this.options.canvasSize)&&void 0!==e?e:512;this.size=[s,s*n.height()/n.width()];const{h337:r}=yield Zk.loadLibrary("heatmap",{globalThisUndefined:!0});this.h337=r;let o=document.createElement("div");this.heatmap=r.create(Object.assign({container:o,width:this.size[0],height:this.size[1]},this.options.style));let c=this.options.mode3D?null!==(t=this.options.segment)&&void 0!==t?t:500:1,d=new l(n.width(),n.height(),c,c);d.rotateX(-Math.PI/2),this.texture=new W(this.heatmap._renderer.canvas);let u=this.options.clipPolygon?qv(this,UD,"m",jD).call(this,this.options.clipPolygon):void 0;const p=this.options.mode3D?new a({transparent:!0,side:I,defines:this.options.clipPolygon?{ALPHA_MAP:"1"}:{},uniforms:{heightMap:{value:this.texture},alphaMap:{value:u},heightRatio:{value:null!==(i=this.options.heightRatio)&&void 0!==i?i:10}},vertexShader:"\n            #include <common>\n#include <clipping_planes_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\n            uniform sampler2D heightMap;\n            uniform float heightRatio;\n            varying vec2 vUv;\n            varying float hValue;\n            varying vec3 cl;\n            void main() {\n                #include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n              vUv = uv;\n              vec3 pos = position;\n              cl = texture2D(heightMap, vUv).rgb;\n              hValue = texture2D(heightMap, vUv).r;\n              pos.y = hValue * heightRatio;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(pos,1.0);\n              #include <fog_vertex>\n            }",fragmentShader:"\n            #include <common>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n            varying float hValue;\n            varying vec3 cl;\n            varying vec2 vUv;\n            #ifdef ALPHA_MAP\n            uniform sampler2D alphaMap;\n            #endif\n            void main() {\n                #include <clipping_planes_fragment>\n    #include <logdepthbuf_fragment>\n                float v = abs(hValue - 1.);\n                gl_FragColor = vec4(cl, .8 - v * v*1.1) ; \n                #ifdef ALPHA_MAP\n                gl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n                #endif\n                #include <fog_fragment>\n                #include <colorspace_fragment>\n                    #include <tonemapping_fragment>\n            }"}):new x({map:this.texture,transparent:!0,alphaMap:u});qv(this,UD,"m",VD).call(this,this.options);let f=new h(d,p);return f.position.set(n.center().x,0,n.center().y),this.mesh=f,f}))}setData(e){var t,i;if(this.h337){if(e.bounds){let i=qv(this,UD,"m",ND).call(this,e);this.bounds=i;let n=null!==(t=this.options.canvasSize)&&void 0!==t?t:512;this.size=[n,n*i.height()/i.width()];let s=document.createElement("div");this.heatmap=this.h337.create(Object.assign({container:s,width:this.size[0],height:this.size[1]},this.options.style)),this.texture&&this.texture.dispose(),this.texture=new W(this.heatmap._renderer.canvas),this.options.mode3D&&(this.mesh.material.uniforms.heightMap.value=this.texture),this.mesh.material.map=this.texture}e.clipPolygon&&(this.options.mode3D?this.mesh.material.uniforms.alphaMap.value=qv(this,UD,"m",jD).call(this,e.clipPolygon):(this.mesh.material.alphaMap&&this.mesh.material.alphaMap.displose(),this.mesh.material.alphaMap=qv(this,UD,"m",jD).call(this,e.clipPolygon))),e.data=null!==(i=e.data)&&void 0!==i?i:this.options.data,qv(this,UD,"m",VD).call(this,e)}}getValueByUV(e){let t=e[0]*this.size[0],i=(1-e[1])*this.size[1];return qv(this,UD,"m",HD).call(this,t,i)}getValueByCoord(e){let t=Math.round((e[0]-this.bounds.min.x)*this.size[0]/this.bounds.width()),i=Math.round((e[1]-this.bounds.min.y)*this.size[1]/this.bounds.width());return qv(this,UD,"m",HD).call(this,t,i)}}FD=new WeakMap,UD=new WeakSet,ND=function(e){let t=e.bounds,i=e.boundScale;if(!t){t=[[...e.data[0].point],[...e.data[0].point]];for(let i=1;i<e.data.length;i++)t[0][0]<e.data[i].point[0]&&(t[0][0]=e.data[i].point[0]),t[0][1]<e.data[i].point[1]&&(t[0][1]=e.data[i].point[1]),t[1][0]>e.data[i].point[0]&&(t[1][0]=e.data[i].point[0]),t[1][1]>e.data[i].point[1]&&(t[1][1]=e.data[i].point[1]);i||(i=1.5)}i=null!=i?i:1;let n=Yb.fromDataExtent(t);return i&&n.scale(i),n},jD=function(e){if(!e)return;let t=[],i=e.map((e=>[Math.round((e[0]-this.bounds.min.x)*this.size[0]/this.bounds.width()),Math.round((e[1]-this.bounds.min.y)*this.size[1]/this.bounds.width())]));return Zv(this,FD,i.map((e=>jb(e))),"f"),t.push(new ic({shape:{x:0,y:0,width:this.size[0],height:this.size[1]},style:{fill:"black"}})),t.push(new cc({shape:{points:i},style:{fill:"white"}})),IA({autoCanvasSize:!1,sharedCanvas:!0,canvasWidth:this.size[0],canvasHeight:this.size[1],elements:t}).texture()},VD=function(e){var t,i;let n=e.data.map((e=>({x:Math.round((e.point[0]-this.bounds.min.x)*this.size[0]/this.bounds.width()),y:Math.round((e.point[1]-this.bounds.min.y)*this.size[1]/this.bounds.width()),value:e.value})));this.heatmap.setData({max:null!==(t=e.max)&&void 0!==t?t:Pv(n.map((e=>e.value))),min:null!==(i=e.min)&&void 0!==i?i:Ov(n.map((e=>e.value))),data:n}),this.texture.needsUpdate=!0},HD=function(e,t){if(!this.options.clipPolygon||yG(jb([e,t]),qv(this,FD,"f")))return this.heatmap.getValueAt({x:e,y:t})};class GD extends ue{constructor(){super({glslVersion:pe,uniforms:{tMap:{value:null},uDirection:{value:new r(1,0)},uResolution:{value:new r}},vertexShader:"\nin vec3 position;\nin vec2 uv;\n\nout vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position = vec4(position, 1.0);\n}\n",fragmentShader:"\nprecision highp float;\n\nuniform sampler2D tMap;\nuniform vec2 uDirection;\nuniform vec2 uResolution;\n\nin vec2 vUv;\n\nout vec4 FragColor;\n\n\nfloat smootherstep(float edge0, float edge1, float x) {\n    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);\n}\n\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture(image, uv) * 0.1964825501511404;\n  color += texture(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\n\nvoid main() {\n    FragColor = blur13(tMap, vUv, uResolution, smootherstep(1.0, 0.0, vUv.y) * uDirection);\n}\n",blending:Q,depthTest:!1,depthWrite:!1})}}class YD extends V{constructor({width:e=512,height:t=512,clipBias:s=0,blurIterations:r=8}={}){super(),this.clipBias=s,this.blurIterations=r,this.reflectorPlane=new c,this.normal=new i,this.reflectorWorldPosition=new i,this.cameraWorldPosition=new i,this.rotationMatrix=new n,this.lookAtPosition=new i(0,0,-1),this.clipPlane=new y,this.view=new i,this.target=new i,this.q=new y,this.textureMatrix=new n,this.virtualCamera=new ee,this.textureMatrixUniform={value:this.textureMatrix},this.renderTarget=new q(e,t,{depthBuffer:!1}),this.renderTargetRead=this.renderTarget.clone(),this.renderTargetWrite=this.renderTarget.clone(),this.renderTarget.depthBuffer=!0,this.renderTargetUniform={value:this.blurIterations>0?this.renderTargetRead.texture:this.renderTarget.texture},this.blurMaterial=new GD,this.blurMaterial.uniforms.uResolution.value.set(e,t),this.screenCamera=new f(-1,1,1,-1,0,1),this.screenTriangle=EG(),this.screen=new h(this.screenTriangle,this.blurMaterial),this.screen.frustumCulled=!1}setSize(e,t){this.renderTarget.setSize(e,t),this.renderTargetRead.setSize(e,t),this.renderTargetWrite.setSize(e,t),this.blurMaterial.uniforms.uResolution.value.set(e,t)}update(e,t,i){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(i.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),this.view.dot(this.normal)>0)return;this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(i.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=i.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(i.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);const n=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+n.elements[8])/n.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+n.elements[9])/n.elements[5],this.q.z=-1,this.q.w=(1+n.elements[10])/n.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),n.elements[2]=this.clipPlane.x,n.elements[6]=this.clipPlane.y,n.elements[10]=this.clipPlane.z+1-this.clipBias,n.elements[14]=this.clipPlane.w;const s=e.getRenderTarget(),r=e.xr.enabled,o=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(this.renderTarget),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,this.virtualCamera);const a=this.blurIterations;for(let t=0;t<a;t++){this.blurMaterial.uniforms.tMap.value=0===t?this.renderTarget.texture:this.renderTargetRead.texture;const i=.5*(a-t-1);this.blurMaterial.uniforms.uDirection.value.set(t%2==0?i:0,t%2==0?0:i),e.setRenderTarget(this.renderTargetWrite),!1===e.autoClear&&e.clear(),e.render(this.screen,this.screenCamera);const n=this.renderTargetRead;this.renderTargetRead=this.renderTargetWrite,this.renderTargetWrite=n,this.renderTargetUniform.value=this.renderTargetRead.texture}e.xr.enabled=r,e.shadowMap.autoUpdate=o,e.setRenderTarget(s)}destroy(){this.renderTargetWrite.dispose(),this.renderTargetRead.dispose(),this.renderTarget.dispose(),this.blurMaterial.dispose(),this.screenTriangle.dispose();for(const e in this)this[e]=null;return null}}class XD extends Ct{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const s=At.get(e);if(void 0!==s)return setTimeout((()=>{t&&t(s),this.manager.itemEnd(e)}),0),s;const r=document.createElement("video");return r.preload=XD.preload,r.autoplay=XD.autoplay,r.loop=XD.loop,r.muted=XD.muted,r.src=e,r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.zIndex="-1",document.body.appendChild(r),r.oncanplay=()=>{At.add(e,r),this.manager.itemEnd(e),t&&t(r)},r.onerror=t=>{this.manager.itemEnd(e),n&&n(t)},r}}XD.autoplay=!0,XD.preload="auto",XD.muted=!0,XD.loop=!0;var QD="\n#ifdef SOFT_PARTICLES\n\n    /* #ifdef LOGDEPTH\n    float distSample = linearize_depth_log(sampleDepth, near, far);\n    #else\n    float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);\n    #endif */\n\n    vec2 p2 = projPosition.xy / projPosition.w;\n    \n    p2 = 0.5 * p2 + 0.5;\n\n    float readDepth = texture2D(depthTexture, p2.xy).r;\n    float viewDepth = linearize_depth(readDepth);\n\n    float softParticlesFade = saturate(SOFT_INV_FADE_DISTANCE * ((viewDepth - SOFT_NEAR_FADE) - linearDepth));\n    \n    gl_FragColor *= softParticlesFade;\n\n    //gl_FragColor = vec4(softParticlesFade , 0, 0, 1);\n#endif\n",qD="\n#ifdef SOFT_PARTICLES\n\n    uniform sampler2D depthTexture;\n    uniform vec4 projParams;\n    uniform vec2 softParams;\n\n    varying vec4 projPosition;\n    varying float linearDepth;\n\n    #define SOFT_NEAR_FADE softParams.x\n    #define SOFT_INV_FADE_DISTANCE softParams.y\n\n    #define zNear projParams.x\n    #define zFar projParams.y\n\n    float linearize_depth(float d)\n    {\n        return (zFar * zNear) / (zFar - d * (zFar - zNear));\n    }\n\n#endif\n",ZD="\n#ifdef SOFT_PARTICLES\n    varying vec4 projPosition;\n    varying float linearDepth;\n#endif\n",KD="\n#ifdef SOFT_PARTICLES\n    projPosition = gl_Position;\n    linearDepth = -mvPosition.z;\n#endif\n",JD="\n#ifdef USE_MAP\n    vec4 texelColor = texture2D( map, vUv);\n    #ifdef TILE_BLEND\n        texelColor = mix( texelColor, texture2D( map, vUvNext ), vUvBlend );\n    #endif\n    diffuseColor *= texelColor;\n#endif\n",$D="\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvarying vec2 vUv;\n#ifdef TILE_BLEND\n    varying vec2 vUvNext;\n    varying float vUvBlend;\n#endif\n\n#endif\n#ifdef USE_MAP\n\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#ifdef TILE_BLEND\n    varying vec2 vMapUvNext;\n#endif\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",eB="\n#ifdef UV_TILE\n    attribute float uvTile;\n    uniform vec2 tileCount;\n    \n    mat3 makeTileTransform(float uvTile) {\n        float col = mod(uvTile, tileCount.x);\n        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);\n        \n        return mat3(\n          1.0 / tileCount.x, 0.0, 0.0,\n          0.0, 1.0 / tileCount.y, 0.0, \n          col / tileCount.x, row / tileCount.y, 1.0);\n    }\n#else\n    mat3 makeTileTransform(float uvTile) {\n        return mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvarying vec2 vUv;\n#ifdef TILE_BLEND\n    varying vec2 vUvNext;\n    varying float vUvBlend;\n#endif\n\n#endif\n#ifdef USE_MAP\n\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#ifdef TILE_BLEND\n    varying vec2 vMapUvNext;\n#endif\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",tB="\n#ifdef UV_TILE\n    mat3 tileTransform = makeTileTransform(floor(uvTile));\n    #ifdef TILE_BLEND\n        mat3 nextTileTransform = makeTileTransform(ceil(uvTile));\n        vUvBlend = fract(uvTile);\n    #endif\n#else\n    mat3 tileTransform = makeTileTransform(0.0);\n#endif\n\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\nvUv = (tileTransform *vec3( uv, 1 )).xy;\n#if defined( TILE_BLEND ) && defined( UV_TILE )\n    vUvNext = (nextTileTransform *vec3( uv, 1 )).xy;\n#endif\n\n#endif\n#ifdef USE_MAP\n\nvMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;\n#if defined( TILE_BLEND ) && defined( UV_TILE )\n    vMapUvNext = (nextTileTransform * (mapTransform * vec3( MAP_UV, 1 ))).xy;\n#endif\n\n#endif\n#ifdef USE_ALPHAMAP\n\nvAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;\n    \n#endif\n#ifdef USE_LIGHTMAP\n\nvLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_AOMAP\n\nvAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_BUMPMAP\n\nvBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_NORMALMAP\n\nvNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\nvDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\nvEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_METALNESSMAP\n\nvMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\nvRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\nvAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\nvClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\nvClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\nvClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\nvIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\nvIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\nvSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\nvSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SPECULARMAP\n\nvSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\nvSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\nvSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\nvTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\nvThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;\n\n#endif\n\n";const iB=le;function nB(){iB.tile_pars_vertex=eB,iB.tile_vertex=tB,iB.tile_pars_fragment=$D,iB.tile_fragment=JD,iB.soft_pars_vertex=ZD,iB.soft_vertex=KD,iB.soft_pars_fragment=qD,iB.soft_fragment=QD}class sB extends u{constructor(e){super(),this.type="ParticleEmitter",this.system=e}clone(){const e=this.system.clone();return e.emitter.copy(this,!0),e.emitter}dispose(){}extractFromCache(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}toJSON(e,t={}){const i=this.children;this.children=this.children.filter((e=>"ParticleSystemPreview"!==e.type));const n=super.toJSON(e);return this.children=i,null!==this.system&&(n.object.ps=this.system.toJSON(e,t)),n}}class rB{constructor(e){this.data=e,this.next=null,this.prev=null}hasPrev(){return null!==this.prev}hasNext(){return null!==this.next}}class oB{constructor(){this.length=0,this.head=this.tail=null}isEmpty(){return null===this.head}clear(){this.length=0,this.head=this.tail=null}front(){return null===this.head?null:this.head.data}back(){return null===this.tail?null:this.tail.data}dequeue(){if(this.head){const e=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}}pop(){if(this.tail){const e=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}}queue(e){const t=new rB(e);this.tail||(this.tail=t),this.head&&(this.head.prev=t,t.next=this.head),this.head=t,this.length++}push(e){const t=new rB(e);this.head||(this.head=t),this.tail&&(this.tail.next=t,t.prev=this.tail),this.tail=t,this.length++}insertBefore(e,t){const i=new rB(t);i.next=e,i.prev=e.prev,null!==i.prev&&(i.prev.next=i),i.next.prev=i,e==this.head&&(this.head=i),this.length++}remove(e){if(null===this.head||null===this.tail)return;let t=this.head;for(e===this.head.data&&(this.head=this.head.next),e===this.tail.data&&(this.tail=this.tail.prev);null!==t.next&&t.data!==e;)t=t.next;t.data===e&&(null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.length--)}*values(){let e=this.head;for(;null!==e;)yield e.data,e=e.next}}class aB{constructor(){this.position=new i,this.velocity=new i,this.age=0,this.life=1,this.size=1,this.rotation=0,this.color=new y(1,1,1,1),this.uvTile=0}get died(){return this.age>=this.life}reset(){this.position.set(0,0,0),this.velocity.set(0,0,0),this.age=0,this.life=1,this.size=1,this.rotation=0,this.color.set(1,1,1,1),this.uvTile=0}}class lB{constructor(){this.startSpeed=0,this.startColor=new y,this.startSize=1,this.position=new i,this.velocity=new i,this.age=0,this.life=1,this.size=1,this.speedModifier=1,this.rotation=0,this.color=new y,this.uvTile=0}get died(){return this.age>=this.life}}class hB{constructor(e,t,i){this.position=e,this.size=t,this.color=i}}class cB{constructor(){this.startSpeed=0,this.startColor=new y,this.startSize=1,this.position=new i,this.velocity=new i,this.age=0,this.life=1,this.size=1,this.length=100,this.speedModifier=1,this.color=new y,this.previous=new oB,this.uvTile=0}update(){for(this.age<=this.life?this.previous.push(new hB(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}get died(){return this.age>=this.life}reset(){this.previous.clear()}}class dB{constructor(e,t,i,n){this.p=[e,t,i,n]}genValue(e){const t=e*e,i=e*e*e,n=1-e,s=n*n,r=s*n;return this.p[0]*r+this.p[1]*s*e*3+this.p[2]*n*t*3+this.p[3]*i}derivativeCoefficients(e){const t=[];for(let i=e,n=i.length-1;n>0;n--){const e=[];for(let t=0;t<n;t++){const s=n*(i[t+1]-i[t]);e.push(s)}t.push(e),i=e}return t}getSlope(e){const t=this.derivativeCoefficients(this.p)[0],i=1-e,n=i*e*2,s=e*e;return i*i*t[0]+n*t[1]+s*t[2]}controlCurve(e,t){this.p[1]=e/3+this.p[0],this.p[2]=this.p[3]-t/3}hull(e){let t,i=this.p,n=[],s=0,r=0,o=0;const a=[];for(a[s++]=i[0],a[s++]=i[1],a[s++]=i[2],a[s++]=i[3];i.length>1;){for(n=[],r=0,o=i.length-1;r<o;r++)t=e*i[r]+(1-e)*i[r+1],a[s++]=t,n.push(t);i=n}return a}split(e){const t=this.hull(e);return{left:new dB(t[0],t[4],t[7],t[9]),right:new dB(t[9],t[8],t[6],t[3]),span:t}}clone(){return new dB(this.p[0],this.p[1],this.p[2],this.p[3])}toJSON(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}static fromJSON(e){return new dB(e.p0,e.p1,e.p2,e.p3)}}const uB=e=>({r:e.x,g:e.y,b:e.z,a:e.w}),pB=e=>new y(e.r,e.g,e.b,e.a),fB=(e,t)=>{switch(t){case"Vector3":return new i(e.x,e.y,e.z);case"Vector4":return new y(e.x,e.y,e.z,e.w);case"Color":return new i(e.r,e.g,e.b);default:return e}},mB=(e,t)=>{switch(t){case"Vector3":return{x:e.x,y:e.y,z:e.z};case"Vector4":return{x:e.x,y:e.y,z:e.z,w:e.w};case"Color":return{r:e.x,g:e.y,b:e.z};default:return e}};class gB{constructor(e,t){this.a=e,this.b=t,this.type="value"}genColor(e){const t=Math.random();return e.copy(this.a).lerp(this.b,t)}toJSON(){return{type:"RandomColor",a:uB(this.a),b:uB(this.b)}}static fromJSON(e){return new gB(pB(e.a),pB(e.b))}clone(){return new gB(this.a.clone(),this.b.clone())}}class vB{constructor(e,t){this.a=e,this.b=t,this.type="value"}genColor(e,t){return e.copy(this.a).lerp(this.b,Math.random())}toJSON(){return{type:"ColorRange",a:uB(this.a),b:uB(this.b)}}static fromJSON(e){return new vB(pB(e.a),pB(e.b))}clone(){return new vB(this.a.clone(),this.b.clone())}}class yB{constructor(e,t){this.subType=t,this.type="function",this.keys=e}findKey(e){let t=0,i=0,n=this.keys.length-1;for(;i+1<n;)if(t=Math.floor((i+n)/2),e<this.getStartX(t))n=t-1;else{if(!(e>this.getEndX(t)))return t;i=t+1}for(let t=i;t<=n;t++)if(e>=this.getStartX(t)&&e<=this.getEndX(t))return t;return-1}getStartX(e){return this.keys[e][1]}getEndX(e){return e+1<this.keys.length?this.keys[e+1][1]:1}genValue(e,t){const i=this.findKey(t);return"Number"===this.subType?-1===i?this.keys[0][0]:i+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[i+1][0]-this.keys[i][0])*((t-this.getStartX(i))/(this.getEndX(i)-this.getStartX(i)))+this.keys[i][0]:-1===i?e.copy(this.keys[0][0]):i+1>=this.keys.length?e.copy(this.keys[this.keys.length-1][0]):e.copy(this.keys[i][0]).lerp(this.keys[i+1][0],(t-this.getStartX(i))/(this.getEndX(i)-this.getStartX(i)))}toJSON(){return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map((([e,t])=>({value:mB(e,this.subType),pos:t})))}}static fromJSON(e){return new yB(e.keys.map((t=>[fB(t.value,e.subType),t.pos])),e.subType)}clone(){return"Number"===this.subType?new yB(this.keys.map((([e,t])=>[e,t])),this.subType):new yB(this.keys.map((([e,t])=>[e.clone(),t])),this.subType)}}const xB=new i;class wB{constructor(e=[[new i(0,0,0),0],[new i(1,1,1),0]],t=[[1,0],[1,1]]){this.type="function",this.color=new yB(e,"Color"),this.alpha=new yB(t,"Number")}genColor(e,t){return this.color.genValue(xB,t),e.set(xB.x,xB.y,xB.z,this.alpha.genValue(1,t))}toJSON(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}static fromJSON(e){if(e.functions){const t=e.functions.map((e=>[vB.fromJSON(e.function).a,e.start]));return e.functions.length>0&&t.push([vB.fromJSON(e.functions[e.functions.length-1].function).b,1]),new wB(t.map((e=>[new i(e[0].x,e[0].y,e[0].z),e[1]])),t.map((e=>[e[0].w,e[1]])))}{const t=new wB;return t.alpha=yB.fromJSON(e.alpha),t.color=yB.fromJSON(e.color),t}}clone(){const e=new wB;return e.alpha=this.alpha.clone(),e.color=this.color.clone(),e}}const bB=new y;class _B{constructor(e,t){this.type="memorizedFunction",this.gradient1=e,this.gradient2=t}startGen(e){e.rand=Math.random()}genColor(e,t,i){return this.gradient1.genColor(e,t),this.gradient2.genColor(bB,t),i&&i.rand?e.lerp(bB,i.rand):e.lerp(bB,Math.random()),e}toJSON(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}static fromJSON(e){return new _B(wB.fromJSON(e.gradient1),wB.fromJSON(e.gradient2))}clone(){return new _B(this.gradient1.clone(),this.gradient2.clone())}}class SB{constructor(e){this.color=e,this.type="value"}genColor(e){return e.copy(this.color)}toJSON(){return{type:"ConstantColor",color:uB(this.color)}}static fromJSON(e){return new SB(pB(e.color))}clone(){return new SB(this.color.clone())}}function MB(e){switch(e.type){case"ConstantColor":return SB.fromJSON(e);case"ColorRange":return vB.fromJSON(e);case"RandomColor":return gB.fromJSON(e);case"Gradient":return wB.fromJSON(e);case"RandomColorBetweenGradient":return _B.fromJSON(e);default:return new SB(new y(1,1,1,1))}}class CB{constructor(e){this.value=e,this.type="value"}genValue(){return this.value}toJSON(){return{type:"ConstantValue",value:this.value}}static fromJSON(e){return new CB(e.value)}clone(){return new CB(this.value)}}class AB{constructor(e,t){this.a=e,this.b=t,this.type="value"}genValue(){return o.lerp(this.a,this.b,Math.random())}toJSON(){return{type:"IntervalValue",a:this.a,b:this.b}}static fromJSON(e){return new AB(e.a,e.b)}clone(){return new AB(this.a,this.b)}}class EB{constructor(){this.functions=new Array}findFunction(e){let t=0,i=0,n=this.functions.length-1;for(;i+1<n;)if(t=Math.floor((i+n)/2),e<this.getStartX(t))n=t-1;else{if(!(e>this.getEndX(t)))return t;i=t+1}for(let t=i;t<=n;t++)if(e>=this.functions[t][1]&&e<=this.getEndX(t))return t;return-1}getStartX(e){return this.functions[e][1]}setStartX(e,t){e>0&&(this.functions[e][1]=t)}getEndX(e){return e+1<this.functions.length?this.functions[e+1][1]:1}setEndX(e,t){e+1<this.functions.length&&(this.functions[e+1][1]=t)}insertFunction(e,t){const i=this.findFunction(e);this.functions.splice(i+1,0,[t,e])}removeFunction(e){return this.functions.splice(e,1)[0][0]}getFunction(e){return this.functions[e][0]}setFunction(e,t){this.functions[e][0]=t}get numOfFunctions(){return this.functions.length}}class TB extends EB{constructor(e=[[new dB(0,1/3,1/3*2,1),0]]){super(),this.type="function",this.functions=e}genValue(e=0){const t=this.findFunction(e);return-1===t?0:this.functions[t][0].genValue((e-this.getStartX(t))/(this.getEndX(t)-this.getStartX(t)))}toSVG(e,t){if(t<1)return"";let i=["M",0,this.functions[0][0].p[0]].join(" ");for(let n=1/t;n<=1;n+=1/t)i=[i,"L",n*e,this.genValue(n)].join(" ");return i}toJSON(){return{type:"PiecewiseBezier",functions:this.functions.map((([e,t])=>({function:e.toJSON(),start:t})))}}static fromJSON(e){return new TB(e.functions.map((e=>[dB.fromJSON(e.function),e.start])))}clone(){return new TB(this.functions.map((([e,t])=>[e.clone(),t])))}}function PB(e){switch(e.type){case"ConstantValue":return CB.fromJSON(e);case"IntervalValue":return AB.fromJSON(e);case"PiecewiseBezier":return TB.fromJSON(e);default:return new CB(0)}}class OB{constructor(){this.type="rotation"}genValue(e,t){let i,n,s,r,o,a;do{i=2*Math.random()-1,n=2*Math.random()-1,s=i*i+n*n}while(s>1);do{r=2*Math.random()-1,o=2*Math.random()-1,a=r*r+o*o}while(a>1);const l=Math.sqrt((1-s)/a);return e.set(i,n,l*r,l*o),e}toJSON(){return{type:"RandomQuat"}}static fromJSON(e){return new OB}clone(){return new OB}}class DB{constructor(e,t){this.axis=e,this.angle=t,this.type="rotation"}genValue(e,t){return e.setFromAxisAngle(this.axis,this.angle.genValue(t))}toJSON(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}static fromJSON(e){return new DB(new i(e.axis.x,e.axis.y,e.axis.z),PB(e.angle))}clone(){return new DB(this.axis.clone(),this.angle.clone())}}class BB{constructor(e,i,n,s){this.angleX=e,this.angleY=i,this.angleZ=n,this.type="rotation",this.eular=new t(0,0,0,s)}genValue(e,t){return this.eular.set(this.angleX.genValue(t),this.angleY.genValue(t),this.angleZ.genValue(t)),e.setFromEuler(this.eular)}toJSON(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON(),eulerOrder:this.eular.order}}static fromJSON(e){return new BB(PB(e.angleX),PB(e.angleY),PB(e.angleZ),e.eulerOrder)}clone(){return new BB(this.angleX,this.angleY,this.angleZ,this.eular.order)}}function IB(e){switch(e.type){case"AxisAngle":return DB.fromJSON(e);case"Euler":return BB.fromJSON(e);case"RandomQuat":return OB.fromJSON(e);default:return new OB}}function RB(e){switch(e.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return PB(e);case"AxisAngle":case"RandomQuat":case"Euler":return IB(e);default:return new CB(0)}}class kB{constructor(e){this.color=e,this.type="ColorOverLife"}initialize(e){"memorizedFunction"===this.color.type&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}update(e,t){"memorizedFunction"===this.color.type?this.color.genColor(e.color,e.age/e.life,e.colorOverLifeMemory):this.color.genColor(e.color,e.age/e.life),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}frameUpdate(e){}toJSON(){return{type:this.type,color:this.color.toJSON()}}static fromJSON(e){return new kB(MB(e.color))}clone(){return new kB(this.color.clone())}reset(){}}class LB{constructor(e){this.angularVelocity=e,this.type="RotationOverLife",this.dynamic=!(e instanceof CB||e instanceof AB)}initialize(e){this.dynamic=!(this.angularVelocity instanceof CB||this.angularVelocity instanceof AB),this.dynamic||"number"!=typeof e.rotation||(e.angularVelocity=this.angularVelocity.genValue())}update(e,t){this.dynamic?"number"==typeof e.rotation&&(e.rotation+=t*this.angularVelocity.genValue(e.age/e.life)):"number"==typeof e.rotation&&(e.rotation+=t*e.angularVelocity)}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(e){return new LB(PB(e.angularVelocity))}frameUpdate(e){}clone(){return new LB(this.angularVelocity.clone())}reset(){}}const zB=new v;class UB{constructor(e){this.angularVelocity=e,this.type="Rotation3DOverLife",this.tempQuat=new v,this.dynamic=!(e instanceof OB)}initialize(e){this.dynamic=!(this.angularVelocity instanceof OB),e.rotation instanceof v&&(e.angularVelocity=new v,this.angularVelocity.genValue(e.angularVelocity))}update(e,t){e.rotation instanceof v&&(this.dynamic?(this.angularVelocity.genValue(this.tempQuat,e.age/e.life),this.tempQuat.slerpQuaternions(zB,this.tempQuat,t),e.rotation.multiply(this.tempQuat)):(this.tempQuat.slerpQuaternions(zB,e.angularVelocity,t),e.rotation.multiply(this.tempQuat)))}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(e){return new UB(IB(e.angularVelocity))}frameUpdate(e){}clone(){return new UB(this.angularVelocity.clone())}reset(){}}class FB{initialize(e,t){this.ps=t}constructor(e,t,n){this.x=e,this.y=t,this.z=n,this.type="ForceOverLife",this._temp=new i,this._tempScale=new i,this._tempQ=new v}update(e,t){this._temp.set(this.x.genValue(e.age/e.life),this.y.genValue(e.age/e.life),this.z.genValue(e.age/e.life)),this.ps.worldSpace||this._temp.multiply(this._tempScale).applyQuaternion(this._tempQ),e.velocity.addScaledVector(this._temp,t)}toJSON(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}static fromJSON(e){return new FB(PB(e.x),PB(e.y),PB(e.z))}frameUpdate(e){if(this.ps&&!this.ps.worldSpace){const e=this._temp,t=this._tempQ,i=this._tempScale;this.ps.emitter.matrixWorld.decompose(e,t,i),t.invert(),i.set(1/i.x,1/i.y,1/i.z)}}clone(){return new FB(this.x.clone(),this.y.clone(),this.z.clone())}reset(){}}class NB{initialize(e){}constructor(e){this.size=e,this.type="SizeOverLife"}update(e){e.size=e.startSize*this.size.genValue(e.age/e.life)}toJSON(){return{type:this.type,size:this.size.toJSON()}}static fromJSON(e){return new NB(PB(e.size))}frameUpdate(e){}clone(){return new NB(this.size.clone())}reset(){}}class jB{initialize(e){}constructor(e){this.speed=e,this.type="SpeedOverLife"}update(e){e.speedModifier=this.speed.genValue(e.age/e.life)}toJSON(){return{type:this.type,speed:this.speed.toJSON()}}static fromJSON(e){return new jB(PB(e.speed))}frameUpdate(e){}clone(){return new jB(this.speed.clone())}reset(){}}class VB{constructor(e){this.frame=e,this.type="FrameOverLife"}initialize(e){this.frame instanceof TB||(e.uvTile=this.frame.genValue(0))}update(e,t){this.frame instanceof TB&&(e.uvTile=this.frame.genValue(e.age/e.life))}frameUpdate(e){}toJSON(){return{type:this.type,frame:this.frame.toJSON()}}static fromJSON(e){return new VB(PB(e.frame))}clone(){return new VB(this.frame.clone())}reset(){}}new i(0,0,1);class HB{constructor(e,t=new i(0,1,0)){this.orbitSpeed=e,this.axis=t,this.type="OrbitOverLife",this.temp=new i,this.rotation=new v,this.line=new A}initialize(e){}update(e,t){this.line.set(new i(0,0,0),this.axis),this.line.closestPointToPoint(e.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(e.age/e.life)*t),e.position.sub(this.temp),e.position.applyQuaternion(this.rotation),e.position.add(this.temp)}frameUpdate(e){}toJSON(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}static fromJSON(e){return new HB(PB(e.orbitSpeed),e.axis?new i(e.axis[0],e.axis[1],e.axis[2]):void 0)}clone(){return new HB(this.orbitSpeed.clone())}reset(){}}class WB{initialize(e){}constructor(e){this.width=e,this.type="WidthOverLength"}update(e){if(e instanceof cB){const t=e.previous.values();for(let i=0;i<e.previous.length;i++)t.next().value.size=this.width.genValue((e.previous.length-i)/e.length)}}frameUpdate(e){}toJSON(){return{type:this.type,width:this.width.toJSON()}}static fromJSON(e){return new WB(PB(e.width))}clone(){return new WB(this.width.clone())}reset(){}}class GB{constructor(e,t){this.direction=e,this.magnitude=t,this.type="ApplyForce",this.magnitudeValue=this.magnitude.genValue()}initialize(e){}update(e,t){e.velocity.addScaledVector(this.direction,this.magnitudeValue*t)}frameUpdate(e){this.magnitudeValue=this.magnitude.genValue()}toJSON(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}static fromJSON(e){var t;return new GB(new i(e.direction[0],e.direction[1],e.direction[2]),PB(null!==(t=e.magnitude)&&void 0!==t?t:e.force))}clone(){return new GB(this.direction.clone(),this.magnitude.clone())}reset(){}}class YB{constructor(e,t){this.center=e,this.magnitude=t,this.type="GravityForce",this.temp=new i}initialize(e){}update(e,t){this.temp.copy(this.center).sub(e.position).normalize(),e.velocity.addScaledVector(this.temp,this.magnitude/e.position.distanceToSquared(this.center)*t)}frameUpdate(e){}toJSON(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}static fromJSON(e){return new YB(new i(e.center[0],e.center[1],e.center[2]),e.magnitude)}clone(){return new YB(this.center.clone(),this.magnitude)}reset(){}}new i(0,0,1);class XB{constructor(e){this.angle=e,this.type="ChangeEmitDirection",this._temp=new i,this._q=new v}initialize(e){const t=e.velocity.length();0!=t&&(e.velocity.normalize(),0===e.velocity.x&&0===e.velocity.y?this._temp.set(0,e.velocity.z,0):this._temp.set(-e.velocity.y,e.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(e.velocity),e.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),e.velocity.applyQuaternion(this._q),e.velocity.setLength(t))}update(e,t){}frameUpdate(e){}toJSON(){return{type:this.type,angle:this.angle.toJSON()}}static fromJSON(e){return new XB(PB(e.angle))}clone(){return new XB(this.angle)}reset(){}}const QB=new i(1,1,1),qB=new i(0,0,1);var ZB;!function(e){e[e.Death=0]="Death",e[e.Birth=1]="Birth",e[e.Frame=2]="Frame"}(ZB||(ZB={}));class KB{constructor(e,t,n,s=ZB.Frame,r=1){this.particleSystem=e,this.useVelocityAsBasis=t,this.subParticleSystem=n,this.mode=s,this.emitProbability=r,this.type="EmitSubParticleSystem",this.q_=new v,this.v_=new i,this.v2_=new i,this.subEmissions=new Array,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}initialize(e){}update(e,t){(this.mode===ZB.Frame||this.mode===ZB.Birth&&0===e.age||this.mode===ZB.Death&&e.age+t>=e.life)&&this.emit(e,t)}emit(e,t){if(!this.subParticleSystem)return;if(Math.random()>this.emitProbability)return;const i=new n;this.setMatrixFromParticle(i,e),this.subEmissions.push({burstParticleCount:0,burstParticleIndex:0,isBursting:!1,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:i,travelDistance:0,particle:e})}frameUpdate(e){if(this.subParticleSystem)for(let t=0;t<this.subEmissions.length;t++)if(this.subEmissions[t].time>=this.subParticleSystem.system.duration)this.subEmissions[t]=this.subEmissions[this.subEmissions.length-1],this.subEmissions.length=this.subEmissions.length-1,t--;else{let i=this.subEmissions[t];i.particle&&i.particle.age<i.particle.life?this.setMatrixFromParticle(i.matrix,i.particle):i.particle=void 0,this.subParticleSystem.system.emit(e,i,i.matrix)}}toJSON(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis,mode:this.mode,emitProbability:this.emitProbability}}static fromJSON(e,t){return new KB(t,e.useVelocityAsBasis,e.subParticleSystem,e.mode,e.emitProbability)}clone(){return new KB(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem,this.mode,this.emitProbability)}reset(){}setMatrixFromParticle(e,t){let i;if(void 0===t.rotation||this.useVelocityAsBasis)if(0!==t.velocity.x||0!==t.velocity.y||1!==t.velocity.z&&0!==t.velocity.z){this.v_.copy(qB).cross(t.velocity),this.v2_.copy(t.velocity).cross(this.v_);const i=this.v_.length(),n=this.v2_.length();e.set(this.v_.x/i,this.v2_.x/n,t.velocity.x,t.position.x,this.v_.y/i,this.v2_.y/n,t.velocity.y,t.position.y,this.v_.z/i,this.v2_.z/n,t.velocity.z,t.position.z,0,0,0,1)}else e.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1);else t.rotation instanceof v?i=t.rotation:(this.q_.setFromAxisAngle(qB,t.rotation),i=this.q_),e.compose(t.position,i,QB);this.particleSystem.worldSpace||e.multiplyMatrices(this.particleSystem.emitter.matrixWorld,e)}}const JB=.5*(Math.sqrt(3)-1),$B=(3-Math.sqrt(3))/6,eI=1/6,tI=(Math.sqrt(5)-1)/4,iI=(5-Math.sqrt(5))/20,nI=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),sI=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class rI{constructor(e=Math.random){const t="function"==typeof e?e:function(e){let t=0,i=0,n=0,s=1;const r=function(){let e=4022871197;return function(t){t=t.toString();for(let i=0;i<t.length;i++){e+=t.charCodeAt(i);let n=.02519603282416938*e;e=n>>>0,n-=e,n*=e,e=n>>>0,n-=e,e+=4294967296*n}return 2.3283064365386963e-10*(e>>>0)}}();return t=r(" "),i=r(" "),n=r(" "),t-=r(e),t<0&&(t+=1),i-=r(e),i<0&&(i+=1),n-=r(e),n<0&&(n+=1),function(){const e=2091639*t+2.3283064365386963e-10*s;return t=i,i=n,n=e-(s=0|e)}}(e);this.p=function(e){const t=new Uint8Array(256);for(let e=0;e<256;e++)t[e]=e;for(let i=0;i<255;i++){const n=i+~~(e()*(256-i)),s=t[i];t[i]=t[n],t[n]=s}return t}(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}noise2D(e,t){const i=this.permMod12,n=this.perm;let s=0,r=0,o=0;const a=(e+t)*JB,l=Math.floor(e+a),h=Math.floor(t+a),c=(l+h)*$B,d=e-(l-c),u=t-(h-c);let p,f;d>u?(p=1,f=0):(p=0,f=1);const m=d-p+$B,g=u-f+$B,v=d-1+2*$B,y=u-1+2*$B,x=255&l,w=255&h;let b=.5-d*d-u*u;if(b>=0){const e=3*i[x+n[w]];b*=b,s=b*b*(nI[e]*d+nI[e+1]*u)}let _=.5-m*m-g*g;if(_>=0){const e=3*i[x+p+n[w+f]];_*=_,r=_*_*(nI[e]*m+nI[e+1]*g)}let S=.5-v*v-y*y;if(S>=0){const e=3*i[x+1+n[w+1]];S*=S,o=S*S*(nI[e]*v+nI[e+1]*y)}return 70*(s+r+o)}noise3D(e,t,i){const n=this.permMod12,s=this.perm;let r,o,a,l;const h=.3333333333333333*(e+t+i),c=Math.floor(e+h),d=Math.floor(t+h),u=Math.floor(i+h),p=(c+d+u)*eI,f=e-(c-p),m=t-(d-p),g=i-(u-p);let v,y,x,w,b,_;f>=m?m>=g?(v=1,y=0,x=0,w=1,b=1,_=0):f>=g?(v=1,y=0,x=0,w=1,b=0,_=1):(v=0,y=0,x=1,w=1,b=0,_=1):m<g?(v=0,y=0,x=1,w=0,b=1,_=1):f<g?(v=0,y=1,x=0,w=0,b=1,_=1):(v=0,y=1,x=0,w=1,b=1,_=0);const S=f-v+eI,M=m-y+eI,C=g-x+eI,A=f-w+2*eI,E=m-b+2*eI,T=g-_+2*eI,P=f-1+.5,O=m-1+.5,D=g-1+.5,B=255&c,I=255&d,R=255&u;let k=.6-f*f-m*m-g*g;if(k<0)r=0;else{const e=3*n[B+s[I+s[R]]];k*=k,r=k*k*(nI[e]*f+nI[e+1]*m+nI[e+2]*g)}let L=.6-S*S-M*M-C*C;if(L<0)o=0;else{const e=3*n[B+v+s[I+y+s[R+x]]];L*=L,o=L*L*(nI[e]*S+nI[e+1]*M+nI[e+2]*C)}let z=.6-A*A-E*E-T*T;if(z<0)a=0;else{const e=3*n[B+w+s[I+b+s[R+_]]];z*=z,a=z*z*(nI[e]*A+nI[e+1]*E+nI[e+2]*T)}let U=.6-P*P-O*O-D*D;if(U<0)l=0;else{const e=3*n[B+1+s[I+1+s[R+1]]];U*=U,l=U*U*(nI[e]*P+nI[e+1]*O+nI[e+2]*D)}return 32*(r+o+a+l)}noise4D(e,t,i,n){const s=this.perm;let r,o,a,l,h;const c=(e+t+i+n)*tI,d=Math.floor(e+c),u=Math.floor(t+c),p=Math.floor(i+c),f=Math.floor(n+c),m=(d+u+p+f)*iI,g=e-(d-m),v=t-(u-m),y=i-(p-m),x=n-(f-m);let w=0,b=0,_=0,S=0;g>v?w++:b++,g>y?w++:_++,g>x?w++:S++,v>y?b++:_++,v>x?b++:S++,y>x?_++:S++;const M=w>=3?1:0,C=b>=3?1:0,A=_>=3?1:0,E=S>=3?1:0,T=w>=2?1:0,P=b>=2?1:0,O=_>=2?1:0,D=S>=2?1:0,B=w>=1?1:0,I=b>=1?1:0,R=_>=1?1:0,k=S>=1?1:0,L=g-M+iI,z=v-C+iI,U=y-A+iI,F=x-E+iI,N=g-T+2*iI,j=v-P+2*iI,V=y-O+2*iI,H=x-D+2*iI,W=g-B+3*iI,G=v-I+3*iI,Y=y-R+3*iI,X=x-k+3*iI,Q=g-1+4*iI,q=v-1+4*iI,Z=y-1+4*iI,K=x-1+4*iI,J=255&d,$=255&u,ee=255&p,te=255&f;let ie=.6-g*g-v*v-y*y-x*x;if(ie<0)r=0;else{const e=s[J+s[$+s[ee+s[te]]]]%32*4;ie*=ie,r=ie*ie*(sI[e]*g+sI[e+1]*v+sI[e+2]*y+sI[e+3]*x)}let ne=.6-L*L-z*z-U*U-F*F;if(ne<0)o=0;else{const e=s[J+M+s[$+C+s[ee+A+s[te+E]]]]%32*4;ne*=ne,o=ne*ne*(sI[e]*L+sI[e+1]*z+sI[e+2]*U+sI[e+3]*F)}let se=.6-N*N-j*j-V*V-H*H;if(se<0)a=0;else{const e=s[J+T+s[$+P+s[ee+O+s[te+D]]]]%32*4;se*=se,a=se*se*(sI[e]*N+sI[e+1]*j+sI[e+2]*V+sI[e+3]*H)}let re=.6-W*W-G*G-Y*Y-X*X;if(re<0)l=0;else{const e=s[J+B+s[$+I+s[ee+R+s[te+k]]]]%32*4;re*=re,l=re*re*(sI[e]*W+sI[e+1]*G+sI[e+2]*Y+sI[e+3]*X)}let oe=.6-Q*Q-q*q-Z*Z-K*K;if(oe<0)h=0;else{const e=s[J+1+s[$+1+s[ee+1+s[te+1]]]]%32*4;oe*=oe,h=oe*oe*(sI[e]*Q+sI[e+1]*q+sI[e+2]*Z+sI[e+3]*K)}return 27*(r+o+a+l+h)}}class oI{constructor(e,t,n,s){this.scale=e,this.octaves=t,this.velocityMultiplier=n,this.timeScale=s,this.type="TurbulenceField",this.generator=new rI,this.timeOffset=new i,this.temp=new i,this.temp2=new i,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}initialize(e){}update(e,t){const i=e.position.x/this.scale.x,n=e.position.y/this.scale.y,s=e.position.z/this.scale.z;this.temp.set(0,0,0);let r=1;for(let e=0;e<this.octaves;e++)this.temp2.set(this.generator.noise4D(i*r,n*r,s*r,this.timeOffset.x*r)/r,this.generator.noise4D(i*r,n*r,s*r,this.timeOffset.y*r)/r,this.generator.noise4D(i*r,n*r,s*r,this.timeOffset.z*r)/r),this.temp.add(this.temp2),r*=2;this.temp.multiply(this.velocityMultiplier),e.velocity.addScaledVector(this.temp,t)}toJSON(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}frameUpdate(e){this.timeOffset.x+=e*this.timeScale.x,this.timeOffset.y+=e*this.timeScale.y,this.timeOffset.z+=e*this.timeScale.z}static fromJSON(e){return new oI(new i(e.scale[0],e.scale[1],e.scale[2]),e.octaves,new i(e.velocityMultiplier[0],e.velocityMultiplier[1],e.velocityMultiplier[2]),new i(e.timeScale[0],e.timeScale[1],e.timeScale[2]))}clone(){return new oI(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}reset(){}}function aI(e,t){return Math.floor(Math.random()*(t-e))+e}const lI=[],hI=new i,cI=new v;class dI{constructor(e,t,i=new CB(1),n=new CB(0)){if(this.frequency=e,this.power=t,this.positionAmount=i,this.rotationAmount=n,this.type="Noise",this.duration=0,0===lI.length)for(let e=0;e<100;e++)lI.push(new rI)}initialize(e){e.lastPosNoise=new i,"number"==typeof e.rotation?e.lastRotNoise=0:e.lastRotNoise=new v,e.generatorIndex=[aI(0,100),aI(0,100),aI(0,100),aI(0,100)]}update(e,t){let i=this.frequency.genValue(e.age/e.life),n=this.power.genValue(e.age/e.life),s=this.positionAmount.genValue(e.age/e.life),r=this.rotationAmount.genValue(e.age/e.life);s>0&&void 0!==e.lastPosNoise&&(e.position.sub(e.lastPosNoise),hI.set(lI[e.generatorIndex[0]].noise2D(0,e.age*i)*n*s,lI[e.generatorIndex[1]].noise2D(0,e.age*i)*n*s,lI[e.generatorIndex[2]].noise2D(0,e.age*i)*n*s),e.position.add(hI),e.lastPosNoise.copy(hI)),r>0&&void 0!==e.lastRotNoise&&("number"==typeof e.rotation?(e.rotation-=e.lastRotNoise,e.rotation+=lI[e.generatorIndex[3]].noise2D(0,e.age*i)*Math.PI*n*r):(e.lastRotNoise.invert(),e.rotation.multiply(e.lastRotNoise),cI.set(lI[e.generatorIndex[0]].noise2D(0,e.age*i)*n*r,lI[e.generatorIndex[1]].noise2D(0,e.age*i)*n*r,lI[e.generatorIndex[2]].noise2D(0,e.age*i)*n*r,lI[e.generatorIndex[3]].noise2D(0,e.age*i)*n*r).normalize(),e.rotation.multiply(cI),e.lastRotNoise.copy(cI)))}toJSON(){return{type:this.type,frequency:this.frequency.toJSON(),power:this.power.toJSON(),positionAmount:this.positionAmount.toJSON(),rotationAmount:this.rotationAmount.toJSON()}}frameUpdate(e){this.duration+=e}static fromJSON(e){return new dI(PB(e.frequency),PB(e.power),PB(e.positionAmount),PB(e.rotationAmount))}clone(){return new dI(this.frequency.clone(),this.power.clone(),this.positionAmount.clone(),this.rotationAmount.clone())}reset(){}}class uI{constructor(e=0,t=0,n=new i){this.scaleX=e,this.scaleY=t,this.position=n,this.locations=[]}transform(e,t){e.x=this.locations[t%this.locations.length].x*this.scaleX+this.position.x,e.y=this.locations[t%this.locations.length].y*this.scaleY+this.position.y,e.z=this.position.z}static fromJSON(e){const t=new uI(e.scaleX,e.scaleY,new i(e.position[0],e.position[1],e.position[2]));return t.locations=e.locations.map((e=>new r(e.x,e.y))),t}clone(){const e=new uI(this.scaleX,this.scaleY,this.position.clone());return e.locations=this.locations.map((e=>e.clone())),e}toJSON(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map((e=>({x:e.x,y:e.y})))}}fromImage(e,t){const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");if(!n)return;n.drawImage(e,0,0);const s=n.getImageData(0,0,i.width,i.height,{colorSpace:"srgb"});i.remove(),this.locations.length=0;for(let e=0;e<s.height;e++)for(let i=0;i<s.width;i++)s.data[4*(e*s.width+i)+3]>t&&this.locations.push(new r(i,s.height-e))}}function pI(e){return"TextureSequencer"===e.type?uI.fromJSON(e):new uI}class fI{constructor(e){this.type="ApplySequences",this.sequencers=[],this.time=0,this.index=0,this.pCount=0,this.tempV=new i,this.delay=e}initialize(e){e.id=this.pCount,e.dst=new i,e.begin=new i,e.inMotion=!1,this.pCount++}reset(){this.time=0,this.index=0,this.pCount=0}update(e,t){const i=this.sequencers[this.index],n=e.id*this.delay;this.time>=i[0].a+n&&this.time<=i[0].b+n?(e.inMotion||(e.inMotion=!0,e.begin.copy(e.position),i[1].transform(e.dst,e.id)),e.position.lerpVectors(e.begin,e.dst,fI.BEZIER.genValue((this.time-i[0].a-n)/(i[0].b-i[0].a)))):this.time>i[0].b+n&&(e.inMotion=!1)}frameUpdate(e){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=e}appendSequencer(e,t){this.sequencers.push([e,t])}toJSON(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map((([e,t])=>({range:e.toJSON(),sequencer:t.toJSON()})))}}static fromJSON(e){const t=new fI(e.delay);return e.sequencers.forEach((e=>{t.sequencers.push([PB(e.range),pI(e.sequencer)])})),t}clone(){const e=new fI(this.delay);return e.sequencers=this.sequencers.map((e=>[e[0].clone(),e[1].clone()])),e}}let mI;function gI(e){mI=e}function vI(){return mI}fI.BEZIER=new dB(0,0,1,1);class yI{constructor(e,t){this.resolver=e,this.bounce=t,this.type="ApplyCollision",this.tempV=new i}initialize(e){}update(e,t){this.resolver.resolve(e.position,this.tempV)&&e.velocity.reflect(this.tempV).multiplyScalar(this.bounce)}frameUpdate(e){}toJSON(){return{type:this.type,bounce:this.bounce}}static fromJSON(e){return new yI(vI(),e.bounce)}clone(){return new yI(this.resolver,this.bounce)}reset(){}}class xI{constructor(e,t){this.color=e,this.speedRange=t,this.type="ColorBySpeed"}initialize(e){"memorizedFunction"===this.color.type&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}update(e,t){const i=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);"memorizedFunction"===this.color.type?this.color.genColor(e.color,i,e.colorOverLifeMemory):this.color.genColor(e.color,i),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}frameUpdate(e){}toJSON(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new xI(MB(e.color),AB.fromJSON(e.speedRange))}clone(){return new xI(this.color.clone(),this.speedRange.clone())}reset(){}}class wI{initialize(e){}constructor(e,t){this.size=e,this.speedRange=t,this.type="SizeBySpeed"}update(e){const t=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.size=e.startSize*this.size.genValue(t)}toJSON(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new wI(PB(e.size),AB.fromJSON(e.speedRange))}frameUpdate(e){}clone(){return new wI(this.size.clone(),this.speedRange.clone())}reset(){}}class bI{constructor(e,t){this.angularVelocity=e,this.speedRange=t,this.type="RotationBySpeed",this.tempQuat=new v}initialize(e){}update(e,t){const i=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.rotation+=t*this.angularVelocity.genValue(i)}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new bI(PB(e.angularVelocity),AB.fromJSON(e.speedRange))}frameUpdate(e){}clone(){return new bI(this.angularVelocity.clone(),this.speedRange.clone())}reset(){}}class _I{initialize(e){}constructor(e,t){this.speed=e,this.dampen=t,this.type="LimitSpeedOverLife"}update(e,t){let i=e.velocity.length(),n=this.speed.genValue(e.age/e.life);if(i>n){const s=(i-n)/i;e.velocity.multiplyScalar(1-s*this.dampen*t*20)}}toJSON(){return{type:this.type,speed:this.speed.toJSON(),dampen:this.dampen}}static fromJSON(e){return new _I(PB(e.speed),e.dampen)}frameUpdate(e){}clone(){return new _I(this.speed.clone(),this.dampen)}reset(){}}const SI={ApplyForce:{type:"ApplyForce",constructor:GB,params:[["direction","vec3"],["magnitude","value"]],loadJSON:GB.fromJSON},Noise:{type:"Noise",constructor:dI,params:[["frequency","value"],["power","value"],["positionAmount","value"],["rotationAmount","value"]],loadJSON:dI.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:oI,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:oI.fromJSON},GravityForce:{type:"GravityForce",constructor:YB,params:[["center","vec3"],["magnitude","number"]],loadJSON:YB.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:kB,params:[["color","colorFunc"]],loadJSON:kB.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:LB,params:[["angularVelocity","valueFunc"]],loadJSON:LB.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:UB,params:[["angularVelocity","rotationFunc"]],loadJSON:UB.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:NB,params:[["size","valueFunc"]],loadJSON:NB.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:xI,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:xI.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:bI,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:bI.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:wI,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:wI.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:jB,params:[["speed","valueFunc"]],loadJSON:jB.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:VB,params:[["frame","valueFunc"]],loadJSON:VB.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:FB,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:FB.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:HB,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:HB.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:WB,params:[["width","valueFunc"]],loadJSON:WB.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:XB,params:[["angle","value"]],loadJSON:XB.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:KB,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"],["mode","number"],["emitProbability","number"]],loadJSON:KB.fromJSON},LimitSpeedOverLife:{type:"LimitSpeedOverLife",constructor:_I,params:[["speed","valueFunc"],["dampen","number"]],loadJSON:_I.fromJSON}};function MI(e,t){return SI[e.type].loadJSON(e,t)}var CI;function AI(e,t,i,n){let s;switch(CI.Random===e?t=Math.random():CI.Burst===e&&n.isBursting&&(t=n.burstParticleIndex/n.burstParticleCount),s=i>0?Math.floor(t/i)*i:t,e){case CI.Loop:s%=1;break;case CI.PingPong:s=Math.abs(s%2-1)}return s}!function(e){e[e.Random=0]="Random",e[e.Loop=1]="Loop",e[e.PingPong=2]="PingPong",e[e.Burst=3]="Burst"}(CI||(CI={}));class EI{constructor(e={}){var t,i,n,s,r,o,a;this.type="cone",this.currentValue=0,this.radius=null!==(t=e.radius)&&void 0!==t?t:10,this.arc=null!==(i=e.arc)&&void 0!==i?i:2*Math.PI,this.thickness=null!==(n=e.thickness)&&void 0!==n?n:1,this.angle=null!==(s=e.angle)&&void 0!==s?s:Math.PI/6,this.mode=null!==(r=e.mode)&&void 0!==r?r:CI.Random,this.spread=null!==(o=e.spread)&&void 0!==o?o:0,this.speed=null!==(a=e.speed)&&void 0!==a?a:new CB(1)}update(e,t){CI.Random!=this.mode&&(this.currentValue+=this.speed.genValue(e.emissionState.time/e.duration)*t)}initialize(e,t){const i=AI(this.mode,this.currentValue,this.spread,t),n=o.lerp(1-this.thickness,1,Math.random()),s=i*this.arc,r=Math.sqrt(n),a=Math.sin(s),l=Math.cos(s);e.position.x=r*l,e.position.y=r*a,e.position.z=0;const h=this.angle*r;e.velocity.set(0,0,Math.cos(h)).addScaledVector(e.position,Math.sin(h)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}toJSON(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new EI({radius:e.radius,arc:e.arc,thickness:e.thickness,angle:e.angle,mode:e.mode,speed:e.speed?PB(e.speed):void 0,spread:e.spread})}clone(){return new EI({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class TI{constructor(e={}){var t,i,n,s,r,o;this.type="circle",this.currentValue=0,this.radius=null!==(t=e.radius)&&void 0!==t?t:10,this.arc=null!==(i=e.arc)&&void 0!==i?i:2*Math.PI,this.thickness=null!==(n=e.thickness)&&void 0!==n?n:1,this.mode=null!==(s=e.mode)&&void 0!==s?s:CI.Random,this.spread=null!==(r=e.spread)&&void 0!==r?r:0,this.speed=null!==(o=e.speed)&&void 0!==o?o:new CB(1)}update(e,t){this.currentValue+=this.speed.genValue(e.emissionState.time/e.duration)*t}initialize(e,t){const i=AI(this.mode,this.currentValue,this.spread,t),n=o.lerp(1-this.thickness,1,Math.random()),s=i*this.arc;e.position.x=Math.cos(s),e.position.y=Math.sin(s),e.position.z=0,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*n)}toJSON(){return{type:"circle",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new TI({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?PB(e.speed):void 0,spread:e.spread})}clone(){return new TI({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class PI{constructor(e={}){var t,i,n,s,r,o,a;this.type="donut",this.currentValue=0,this.radius=null!==(t=e.radius)&&void 0!==t?t:10,this.arc=null!==(i=e.arc)&&void 0!==i?i:2*Math.PI,this.thickness=null!==(n=e.thickness)&&void 0!==n?n:1,this.donutRadius=null!==(s=e.donutRadius)&&void 0!==s?s:.2*this.radius,this.mode=null!==(r=e.mode)&&void 0!==r?r:CI.Random,this.spread=null!==(o=e.spread)&&void 0!==o?o:0,this.speed=null!==(a=e.speed)&&void 0!==a?a:new CB(1)}update(e,t){CI.Random!=this.mode&&(this.currentValue+=this.speed.genValue(e.emissionState.time/e.duration)*t)}initialize(e,t){const i=AI(this.mode,this.currentValue,this.spread,t),n=Math.random(),s=o.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,a=n*Math.PI*2,l=Math.sin(r),h=Math.cos(r);e.position.x=this.radius*h,e.position.y=this.radius*l,e.position.z=0,e.velocity.z=this.donutRadius*s*Math.sin(a),e.velocity.x=this.donutRadius*s*Math.cos(a)*h,e.velocity.y=this.donutRadius*s*Math.cos(a)*l,e.position.add(e.velocity),e.velocity.normalize().multiplyScalar(e.startSpeed)}toJSON(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new PI({radius:e.radius,arc:e.arc,thickness:e.thickness,donutRadius:e.donutRadius,mode:e.mode,speed:e.speed?PB(e.speed):void 0,spread:e.spread})}clone(){return new PI({radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class OI{constructor(){this.type="point"}update(e,t){}initialize(e){const t=Math.random(),i=Math.random(),n=t*Math.PI*2,s=Math.acos(2*i-1),r=Math.cbrt(Math.random()),o=Math.sin(n),a=Math.cos(n),l=Math.sin(s),h=Math.cos(s);e.velocity.x=r*l*a,e.velocity.y=r*l*o,e.velocity.z=r*h,e.velocity.multiplyScalar(e.startSpeed),e.position.setScalar(0)}toJSON(){return{type:"point"}}static fromJSON(e){return new OI}clone(){return new OI}}class DI{constructor(e={}){var t,i,n,s,r,o;this.type="sphere",this.currentValue=0,this.radius=null!==(t=e.radius)&&void 0!==t?t:10,this.arc=null!==(i=e.arc)&&void 0!==i?i:2*Math.PI,this.thickness=null!==(n=e.thickness)&&void 0!==n?n:1,this.mode=null!==(s=e.mode)&&void 0!==s?s:CI.Random,this.spread=null!==(r=e.spread)&&void 0!==r?r:0,this.speed=null!==(o=e.speed)&&void 0!==o?o:new CB(1)}update(e,t){CI.Random!=this.mode&&(this.currentValue+=this.speed.genValue(e.emissionState.time/e.duration)*t)}initialize(e,t){const i=AI(this.mode,this.currentValue,this.spread,t),n=Math.random(),s=o.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,a=Math.acos(2*n-1),l=Math.sin(r),h=Math.cos(r),c=Math.sin(a),d=Math.cos(a);e.position.x=c*h,e.position.y=c*l,e.position.z=d,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*s)}toJSON(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new DI({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?PB(e.speed):void 0,spread:e.spread})}clone(){return new DI({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class BI{constructor(e={}){var t,i,n,s,r,o;this.type="sphere",this.currentValue=0,this.radius=null!==(t=e.radius)&&void 0!==t?t:10,this.arc=null!==(i=e.arc)&&void 0!==i?i:2*Math.PI,this.thickness=null!==(n=e.thickness)&&void 0!==n?n:1,this.mode=null!==(s=e.mode)&&void 0!==s?s:CI.Random,this.spread=null!==(r=e.spread)&&void 0!==r?r:0,this.speed=null!==(o=e.speed)&&void 0!==o?o:new CB(1)}update(e,t){CI.Random!=this.mode&&(this.currentValue+=this.speed.genValue(e.emissionState.time/e.duration)*t)}initialize(e,t){const i=AI(this.mode,this.currentValue,this.spread,t),n=Math.random(),s=o.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,a=Math.acos(n),l=Math.sin(r),h=Math.cos(r),c=Math.sin(a),d=Math.cos(a);e.position.x=c*h,e.position.y=c*l,e.position.z=d,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*s)}toJSON(){return{type:"hemisphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new BI({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?PB(e.speed):void 0,spread:e.spread})}clone(){return new BI({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class II{constructor(e={}){var t,i,n,s;this.type="grid",this.width=null!==(t=e.width)&&void 0!==t?t:1,this.height=null!==(i=e.height)&&void 0!==i?i:1,this.column=null!==(n=e.column)&&void 0!==n?n:10,this.row=null!==(s=e.row)&&void 0!==s?s:10}initialize(e){const t=Math.floor(Math.random()*this.row),i=Math.floor(Math.random()*this.column);e.position.x=i*this.width/this.column-this.width/2,e.position.y=t*this.height/this.row-this.height/2,e.position.z=0,e.velocity.set(0,0,e.startSpeed)}toJSON(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}static fromJSON(e){return new II(e)}clone(){return new II({width:this.width,height:this.height,column:this.column,row:this.row})}update(e,t){}}class RI{get geometry(){return this._geometry}set geometry(e){if(this._geometry=e,void 0===e)return;if("string"==typeof e)return;const t=new T;this._triangleIndexToArea.length=0;let i=0;if(!e.getIndex())return;const n=e.getIndex().array,s=n.length/3;this._triangleIndexToArea.push(0);for(let r=0;r<s;r++)t.setFromAttributeAndIndices(e.getAttribute("position"),n[3*r],n[3*r+1],n[3*r+2]),i+=t.getArea(),this._triangleIndexToArea.push(i);e.userData.triangleIndexToArea=this._triangleIndexToArea}constructor(e){this.type="mesh_surface",this._triangleIndexToArea=[],this._tempA=new i,this._tempB=new i,this._tempC=new i,e&&(this.geometry=e)}initialize(e){const t=this._geometry;if(!t||null===t.getIndex())return e.position.set(0,0,0),void e.velocity.set(0,0,1).multiplyScalar(e.startSpeed);const i=this._triangleIndexToArea.length-1;let n=0,s=i;const r=Math.random()*this._triangleIndexToArea[i];for(;n+1<s;){const e=Math.floor((n+s)/2);r<this._triangleIndexToArea[e]?s=e:n=e}let o=Math.random(),a=Math.random();o+a>1&&(o=1-o,a=1-a);const l=t.getIndex().array[3*n],h=t.getIndex().array[3*n+1],c=t.getIndex().array[3*n+2],d=t.getAttribute("position");this._tempA.fromBufferAttribute(d,l),this._tempB.fromBufferAttribute(d,h),this._tempC.fromBufferAttribute(d,c),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,o).addScaledVector(this._tempC,a),e.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),e.velocity.copy(this._tempA).normalize().multiplyScalar(e.startSpeed)}toJSON(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}static fromJSON(e,t){return new RI(t.geometries[e.geometry])}clone(){return new RI(this._geometry)}update(e,t){}}const kI={circle:{type:"circle",params:[["radius","number"],["arc","radian"],["thickness","number"],["mode","emitterMode"],["spread","number"],["speed","valueFunc"]],constructor:TI,loadJSON:TI.fromJSON},cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"],["mode","emitterMode"],["spread","number"],["speed","valueFunc"]],constructor:EI,loadJSON:EI.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["donutRadius","number"],["mode","emitterMode"],["spread","number"],["speed","valueFunc"]],constructor:PI,loadJSON:PI.fromJSON},point:{type:"point",params:[],constructor:OI,loadJSON:OI.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"],["mode","emitterMode"],["spread","number"],["speed","valueFunc"]],constructor:DI,loadJSON:DI.fromJSON},hemisphere:{type:"hemisphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"],["mode","emitterMode"],["spread","number"],["speed","valueFunc"]],constructor:BI,loadJSON:BI.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:II,loadJSON:II.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:RI,loadJSON:RI.fromJSON}};function LI(e,t){return kI[e.type].loadJSON(e,t)}var zI;!function(e){e[e.BillBoard=0]="BillBoard",e[e.StretchedBillBoard=1]="StretchedBillBoard",e[e.Mesh=2]="Mesh",e[e.Trail=3]="Trail",e[e.HorizontalBillBoard=4]="HorizontalBillBoard",e[e.VerticalBillBoard=5]="VerticalBillBoard"}(zI||(zI={}));class UI extends h{constructor(e){super(),this.type="VFXBatch",this.maxParticles=1e3,this.systems=new Set;const t=new Et;t.mask=e.layers.mask;const i=e.material.clone();i.defines={},Object.assign(i.defines,e.material.defines),this.settings={instancingGeometry:e.instancingGeometry,renderMode:e.renderMode,renderOrder:e.renderOrder,material:i,uTileCount:e.uTileCount,vTileCount:e.vTileCount,blendTiles:e.blendTiles,softParticles:e.softParticles,softNearFade:e.softNearFade,softFarFade:e.softFarFade,layers:t},this.frustumCulled=!1,this.renderOrder=this.settings.renderOrder}addSystem(e){this.systems.add(e)}removeSystem(e){this.systems.delete(e)}applyDepthTexture(e){const t=this.material.uniforms.depthTexture;t&&t.value!==e&&(t.value=e,this.material.needsUpdate=!0)}}const FI=new i(0,0,1),NI=new v,jI=new i,VI=new i;new i;const HI=new l(1,1,1,1);class WI{set time(e){this.emissionState.time=e}get time(){return this.emissionState.time}get layers(){return this.rendererSettings.layers}get texture(){return this.rendererSettings.material.map}set texture(e){this.rendererSettings.material.map=e,this.neededToUpdateRender=!0}get material(){return this.rendererSettings.material}set material(e){this.rendererSettings.material=e,this.neededToUpdateRender=!0}get uTileCount(){return this.rendererSettings.uTileCount}set uTileCount(e){this.rendererSettings.uTileCount=e,this.neededToUpdateRender=!0}get vTileCount(){return this.rendererSettings.vTileCount}set vTileCount(e){this.rendererSettings.vTileCount=e,this.neededToUpdateRender=!0}get blendTiles(){return this.rendererSettings.blendTiles}set blendTiles(e){this.rendererSettings.blendTiles=e,this.neededToUpdateRender=!0}get softParticles(){return this.rendererSettings.softParticles}set softParticles(e){this.rendererSettings.softParticles=e,this.neededToUpdateRender=!0}get softNearFade(){return this.rendererSettings.softNearFade}set softNearFade(e){this.rendererSettings.softNearFade=e,this.neededToUpdateRender=!0}get softFarFade(){return this.rendererSettings.softFarFade}set softFarFade(e){this.rendererSettings.softFarFade=e,this.neededToUpdateRender=!0}get instancingGeometry(){return this.rendererSettings.instancingGeometry}set instancingGeometry(e){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=e,this.neededToUpdateRender=!0}get renderMode(){return this.rendererSettings.renderMode}set renderMode(e){if((this.rendererSettings.renderMode!=zI.Trail&&e===zI.Trail||this.rendererSettings.renderMode==zI.Trail&&e!==zI.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==e)switch(e){case zI.Trail:this.rendererEmitterSettings={startLength:new CB(30),followLocalOrigin:!1};break;case zI.Mesh:this.rendererEmitterSettings={geometry:new l(1,1)},this.startRotation=new DB(new i(0,1,0),new CB(0));break;case zI.StretchedBillBoard:this.rendererEmitterSettings={speedFactor:0,lengthFactor:2},this.rendererSettings.renderMode===zI.Mesh&&(this.startRotation=new CB(0));break;case zI.BillBoard:case zI.VerticalBillBoard:case zI.HorizontalBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===zI.Mesh&&(this.startRotation=new CB(0))}this.rendererSettings.renderMode=e,this.neededToUpdateRender=!0}get renderOrder(){return this.rendererSettings.renderOrder}set renderOrder(e){this.rendererSettings.renderOrder=e,this.neededToUpdateRender=!0}get blending(){return this.rendererSettings.material.blending}set blending(e){this.rendererSettings.material.blending=e,this.neededToUpdateRender=!0}constructor(e){var t,n,s,r,o,a,l,h,c,d,u,p,f,m,g,v,x,w,b,_,S,M,C,A,E,T;if(this.signal={onRestart:new cy,onPlay:new cy,onPause:new cy,onEnd:new cy},this.temp=new i,this.travelDistance=0,this.normalMatrix=new fe,this.firstTimeUpdate=!0,this.autoDestroy=void 0!==e.autoDestroy&&e.autoDestroy,this.duration=null!==(t=e.duration)&&void 0!==t?t:1,this.looping=void 0===e.looping||e.looping,this.prewarm=void 0!==e.prewarm&&e.prewarm,this.startLife=null!==(n=e.startLife)&&void 0!==n?n:new CB(5),this.startSpeed=null!==(s=e.startSpeed)&&void 0!==s?s:new CB(0),this.startRotation=null!==(r=e.startRotation)&&void 0!==r?r:new CB(0),this.startSize=null!==(o=e.startSize)&&void 0!==o?o:new CB(1),this.startColor=null!==(a=e.startColor)&&void 0!==a?a:new SB(new y(1,1,1,1)),this.emissionOverTime=null!==(l=e.emissionOverTime)&&void 0!==l?l:new CB(10),this.emissionOverDistance=null!==(h=e.emissionOverDistance)&&void 0!==h?h:new CB(0),this.emissionBursts=null!==(c=e.emissionBursts)&&void 0!==c?c:[],this.onlyUsedByOther=null!==(d=e.onlyUsedByOther)&&void 0!==d&&d,this.emitterShape=null!==(u=e.shape)&&void 0!==u?u:new DI,this.simulations=null!==(p=e.simulations)&&void 0!==p?p:new Array,this.worldSpace=null!==(f=e.worldSpace)&&void 0!==f&&f,this.rendererEmitterSettings=null!==(m=e.rendererEmitterSettings)&&void 0!==m?m:{},e.renderMode===zI.StretchedBillBoard){const t=this.rendererEmitterSettings;void 0!==e.speedFactor&&(t.speedFactor=e.speedFactor),t.speedFactor=null!==(g=t.speedFactor)&&void 0!==g?g:0,t.lengthFactor=null!==(v=t.lengthFactor)&&void 0!==v?v:0}this.rendererSettings={instancingGeometry:null!==(x=e.instancingGeometry)&&void 0!==x?x:HI,renderMode:null!==(w=e.renderMode)&&void 0!==w?w:zI.BillBoard,renderOrder:null!==(b=e.renderOrder)&&void 0!==b?b:0,material:e.material,uTileCount:null!==(_=e.uTileCount)&&void 0!==_?_:1,vTileCount:null!==(S=e.vTileCount)&&void 0!==S?S:1,blendTiles:null!==(M=e.blendTiles)&&void 0!==M&&M,softParticles:null!==(C=e.softParticles)&&void 0!==C&&C,softNearFade:null!==(A=e.softNearFade)&&void 0!==A?A:0,softFarFade:null!==(E=e.softFarFade)&&void 0!==E?E:0,layers:null!==(T=e.layers)&&void 0!==T?T:new Et},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new CB(0),this.emitter=new sB(this),this.paused=!1,this.particleNum=0,this.emissionState={isBursting:!1,burstParticleIndex:0,burstParticleCount:0,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,travelDistance:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}pause(){this.paused=!0,this.signal.onPause.dispatch(this)}play(){this.paused=!1,this.signal.onPlay.dispatch(this)}spawn(e,t,n){NI.setFromRotationMatrix(n);const s=jI,r=NI,o=VI;n.decompose(s,r,o);for(let s=0;s<e;s++){for(t.burstParticleIndex=s,this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===zI.Trail?this.particles.push(new cB):this.particles.push(new lB);const e=this.particles[this.particleNum-1];if(e.speedModifier=1,this.startColor.genColor(e.startColor,this.emissionState.time,{}),e.color.copy(e.startColor),e.startSpeed=this.startSpeed.genValue(t.time/this.duration),e.life=this.startLife.genValue(t.time/this.duration),e.age=0,e.startSize=this.startSize.genValue(t.time/this.duration),e.uvTile=this.startTileIndex.genValue(),e.size=e.startSize,this.rendererSettings.renderMode===zI.Mesh||this.rendererSettings.renderMode===zI.BillBoard||this.rendererSettings.renderMode===zI.VerticalBillBoard||this.rendererSettings.renderMode===zI.HorizontalBillBoard||this.rendererSettings.renderMode===zI.StretchedBillBoard){const i=e;this.rendererSettings.renderMode===zI.Mesh?(i.rotation instanceof v||(i.rotation=new v),"rotation"===this.startRotation.type?this.startRotation.genValue(i.rotation,t.time/this.duration):i.rotation.setFromAxisAngle(FI,this.startRotation.genValue(t.time/this.duration))):"rotation"===this.startRotation.type?i.rotation=0:i.rotation=this.startRotation.genValue(t.time/this.duration)}else this.rendererSettings.renderMode===zI.Trail&&(e.length=this.rendererEmitterSettings.startLength.genValue(t.time/this.duration));if(this.emitterShape.initialize(e,t),this.rendererSettings.renderMode===zI.Trail&&this.rendererEmitterSettings.followLocalOrigin){const t=e;t.localPosition=(new i).copy(t.position)}this.worldSpace?(e.position.applyMatrix4(n),e.startSize=e.startSize*(Math.abs(o.x)+Math.abs(o.y)+Math.abs(o.z))/3,e.size=e.startSize,e.velocity.multiply(o).applyMatrix3(this.normalMatrix),e.rotation&&e.rotation instanceof v&&e.rotation.multiplyQuaternions(NI,e.rotation)):this.onlyUsedByOther&&(e.parentMatrix=n);for(let t=0;t<this.simulations.length;t++)this.simulations[t].initialize(e,this)}}endEmit(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}dispose(){this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter),this._renderer&&this._renderer.deleteSystem(this)}restart(){this.signal.onRestart.dispatch(this),this.paused=!1,this.particleNum=0,this.emissionState.isBursting=!1,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.simulations.forEach((e=>{e.reset()})),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}update(e){if(this.paused)return;let t=this.emitter;for(;t.parent;)t=t.parent;if("Scene"===t.type){if(this.firstTimeUpdate&&(this.firstTimeUpdate=!1,this.emitter.updateWorldMatrix(!0,!1)),this.emitEnded&&0===this.particleNum)return this.signal.onEnd.dispatch(this),void(this.markForDestroy&&this.emitter.parent&&this.dispose());if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(let e=0;e<60*this.duration;e++)this.update(1/60)}e>.1&&(e=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(e,this.emissionState,this.emitter.matrixWorld),this.emitterShape.update(this,e);for(let t=0;t<this.simulations.length;t++){this.simulations[t].frameUpdate(e);for(let i=0;i<this.particleNum;i++)this.particles[i].died||this.simulations[t].update(this.particles[i],e)}for(let t=0;t<this.particleNum;t++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[t].localPosition?(this.particles[t].position.copy(this.particles[t].localPosition),this.particles[t].parentMatrix?this.particles[t].position.applyMatrix4(this.particles[t].parentMatrix):this.particles[t].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[t].position.addScaledVector(this.particles[t].velocity,e*this.particles[t].speedModifier),this.particles[t].age+=e;if(this.rendererSettings.renderMode===zI.Trail)for(let e=0;e<this.particleNum;e++)this.particles[e].update();for(let e=0;e<this.particleNum;e++){const t=this.particles[e];!t.died||t instanceof cB&&0!==t.previous.length||(this.particles[e]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=t,this.particleNum--,e--)}}else this.dispose()}emit(e,t,n){t.time>this.duration&&(this.looping?(t.time-=this.duration,t.burstIndex=0,this.simulations.forEach((e=>{e.reset()}))):this.emitEnded||this.onlyUsedByOther||this.endEmit()),this.normalMatrix.getNormalMatrix(n);const s=Math.ceil(t.waitEmiting);for(this.spawn(s,t,n),t.waitEmiting-=s;t.burstIndex<this.emissionBursts.length&&this.emissionBursts[t.burstIndex].time<=t.time;){if(Math.random()<this.emissionBursts[t.burstIndex].probability){const e=this.emissionBursts[t.burstIndex].count.genValue(this.time);t.isBursting=!0,t.burstParticleCount=e,this.spawn(e,t,n),t.isBursting=!1}t.burstIndex++}if(!this.emitEnded&&(t.waitEmiting+=e*this.emissionOverTime.genValue(t.time/this.duration),null!=t.previousWorldPos)){this.temp.set(n.elements[12],n.elements[13],n.elements[14]),t.travelDistance+=t.previousWorldPos.distanceTo(this.temp);const e=this.emissionOverDistance.genValue(t.time/this.duration);if(t.travelDistance*e>0){const i=Math.floor(t.travelDistance*e);t.travelDistance-=i/e,t.waitEmiting+=i}}void 0===t.previousWorldPos&&(t.previousWorldPos=new i),t.previousWorldPos.set(n.elements[12],n.elements[13],n.elements[14]),t.time+=e}toJSON(e,t={}){var i;if((void 0===e||"string"==typeof e)&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),e.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(e),t.useUrlForImage&&void 0!==(null===(i=this.texture)||void 0===i?void 0:i.source)){const t=this.texture.source;e.images[t.uuid]={uuid:t.uuid,url:this.texture.image.url}}let n;n=this.renderMode===zI.Trail?{startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===zI.Mesh?{}:this.renderMode===zI.StretchedBillBoard?{speedFactor:this.rendererEmitterSettings.speedFactor,lengthFactor:this.rendererEmitterSettings.lengthFactor}:{};const s=this.rendererSettings.instancingGeometry;return e.geometries&&!e.geometries[s.uuid]&&(e.geometries[s.uuid]=s.toJSON()),{version:"3.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts.map((e=>({time:e.time,count:e.count.toJSON(),probability:e.probability,interval:e.interval,cycle:e.cycle}))),onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:n,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.rendererSettings.softParticles,softFarFade:this.rendererSettings.softFarFade,softNearFade:this.rendererSettings.softNearFade,simulations:this.simulations.map((e=>e.toJSON())),worldSpace:this.worldSpace}}static fromJSON(e,t,i){var n,s;const r=LI(e.shape,t);let o;if(e.renderMode===zI.Trail){let t=e.rendererEmitterSettings;o={startLength:null!=t.startLength?PB(t.startLength):new CB(30),followLocalOrigin:t.followLocalOrigin}}else e.renderMode===zI.Mesh?o={}:e.renderMode===zI.StretchedBillBoard?(o=e.rendererEmitterSettings,null!=e.speedFactor&&(o.speedFactor=e.speedFactor)):o={};const a=new Et;e.layers&&(a.mask=e.layers);const l=new WI({autoDestroy:e.autoDestroy,looping:e.looping,prewarm:e.prewarm,duration:e.duration,shape:r,startLife:PB(e.startLife),startSpeed:PB(e.startSpeed),startRotation:RB(e.startRotation),startSize:PB(e.startSize),startColor:MB(e.startColor),emissionOverTime:PB(e.emissionOverTime),emissionOverDistance:PB(e.emissionOverDistance),emissionBursts:null===(n=e.emissionBursts)||void 0===n?void 0:n.map((e=>({time:e.time,count:"number"==typeof e.count?new CB(e.count):PB(e.count),probability:e.probability,interval:e.interval,cycle:e.cycle}))),onlyUsedByOther:e.onlyUsedByOther,instancingGeometry:t.geometries[e.instancingGeometry],renderMode:e.renderMode,rendererEmitterSettings:o,renderOrder:e.renderOrder,layers:a,material:e.material?t.materials[e.material]:e.texture?new x({map:t.textures[e.texture],transparent:null===(s=e.transparent)||void 0===s||s,blending:e.blending,side:I}):new x({color:16777215,transparent:!0,blending:de,side:I}),startTileIndex:"number"==typeof e.startTileIndex?new CB(e.startTileIndex):PB(e.startTileIndex),uTileCount:e.uTileCount,vTileCount:e.vTileCount,blendTiles:e.blendTiles,softParticles:e.softParticles,softFarFade:e.softFarFade,softNearFade:e.softNearFade,simulations:[],worldSpace:e.worldSpace});return l.simulations=e.simulations.map((e=>{const t=MI(e,l);return"EmitSubParticleSystem"===t.type&&(i[e.subParticleSystem]=t),t})),l}addSimulation(e){this.simulations.push(e)}getRendererSettings(){return this.rendererSettings}clone(){const e=[];for(const t of this.emissionBursts){const i={};Object.assign(i,t),e.push(i)}const t=[];for(const e of this.simulations)t.push(e.clone());let i;i=this.renderMode===zI.Trail?{startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:{};const n=new Et;return n.mask=this.layers.mask,new WI({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:e,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:i,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.softParticles,softFarFade:this.softFarFade,softNearFade:this.softNearFade,simulations:t,worldSpace:this.worldSpace,layers:n})}}var GI="\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <alphatest_pars_fragment>\n\n#include <tile_pars_fragment>\n#include <soft_pars_fragment>\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n    \n    vec3 outgoingLight = vec3( 0.0 );\n    vec4 diffuseColor = vColor;\n    \n    #include <logdepthbuf_fragment>\n    \n    #include <tile_fragment>\n    #include <alphatest_fragment>\n\n    outgoingLight = diffuseColor.rgb;\n    \n    #ifdef USE_COLOR_AS_ALPHA\n    gl_FragColor = vec4( outgoingLight, diffuseColor.r );\n    #else\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    #endif\n    \n    #include <soft_fragment>\n    #include <tonemapping_fragment>\n}\n";function YI(e){return 0===e?"uv":`uv${e}`}new i(0,0,1);class XI extends UI{constructor(e){super(e),this.vector_=new i,this.vector2_=new i,this.vector3_=new i,this.quaternion_=new v,this.quaternion2_=new v,this.quaternion3_=new v,this.rotationMat_=new fe,this.rotationMat2_=new fe,this.maxParticles=1e3,this.setupBuffers(),this.rebuildMaterial()}buildExpandableBuffers(){this.offsetBuffer=new Tt(new Float32Array(3*this.maxParticles),3),this.offsetBuffer.setUsage(Me),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new Tt(new Float32Array(4*this.maxParticles),4),this.colorBuffer.setUsage(Me),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===zI.Mesh?(this.rotationBuffer=new Tt(new Float32Array(4*this.maxParticles),4),this.rotationBuffer.setUsage(Me),this.geometry.setAttribute("rotation",this.rotationBuffer)):this.settings.renderMode!==zI.BillBoard&&this.settings.renderMode!==zI.HorizontalBillBoard&&this.settings.renderMode!==zI.VerticalBillBoard&&this.settings.renderMode!==zI.StretchedBillBoard||(this.rotationBuffer=new Tt(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Me),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new Tt(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(Me),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new Tt(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Me),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===zI.StretchedBillBoard&&(this.velocityBuffer=new Tt(new Float32Array(4*this.maxParticles),4),this.velocityBuffer.setUsage(Me),this.geometry.setAttribute("velocity",this.velocityBuffer))}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new ve,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}expandBuffers(e){for(;e>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){let e;this.layers.mask=this.settings.layers.mask;const t={};if("MeshStandardMaterial"===this.settings.material.type||"MeshPhysicalMaterial"===this.settings.material.type){const t=this.settings.material;e=at.merge([_e.common,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.roughnessmap,_e.metalnessmap,_e.fog,_e.lights,{emissive:{value:new s(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),e.diffuse.value=t.color,e.opacity.value=t.opacity,e.emissive.value=t.emissive,e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.envMap&&(e.envMap.value=t.envMap,e.envMapIntensity.value=t.envMapIntensity),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value=t.normalScale),t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.map&&(e.map=new X(t.map))}else e={},e.map=new X(this.settings.material.map);this.settings.material.alphaTest&&(t.USE_ALPHATEST="",e.alphaTest=new X(this.settings.material.alphaTest)),t.USE_UV="";const i=this.settings.uTileCount,n=this.settings.vTileCount;let o;if((i>1||n>1)&&(t.UV_TILE="",e.tileCount=new X(new r(i,n))),this.settings.material.defines&&void 0!==this.settings.material.defines.USE_COLOR_AS_ALPHA&&(t.USE_COLOR_AS_ALPHA=""),this.settings.material.normalMap&&(t.USE_NORMALMAP="",t.NORMALMAP_UV=YI(this.settings.material.normalMap.channel),e.normalMapTransform=new X((new fe).copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(t.USE_MAP="",this.settings.blendTiles&&(t.TILE_BLEND=""),t.MAP_UV=YI(this.settings.material.map.channel),e.mapTransform=new X((new fe).copy(this.settings.material.map.matrix))),t.USE_COLOR_ALPHA="",this.settings.softParticles){t.SOFT_PARTICLES="";const i=this.settings.softNearFade,n=1/(this.settings.softFarFade-this.settings.softNearFade);e.softParams=new X(new r(i,n)),e.depthTexture=new X(null);const s=e.projParams=new X(new y);o=(e,t,i)=>{s.value.set(i.near,i.far,0,0)}}let l=!1;if(this.settings.renderMode===zI.BillBoard||this.settings.renderMode===zI.VerticalBillBoard||this.settings.renderMode===zI.HorizontalBillBoard||this.settings.renderMode===zI.Mesh){let i,n;this.settings.renderMode===zI.Mesh?"MeshStandardMaterial"===this.settings.material.type||"MeshPhysicalMaterial"===this.settings.material.type?(t.USE_COLOR="",i="\n#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n\nattribute vec3 offset;\nattribute vec4 rotation;\nattribute float size;\n#include <tile_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    #include <tile_vertex>\n    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;\n    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;\n    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;\n    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;\n    float sx = size, sy = size, sz = size;\n\n    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column\n                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column\n                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column\n                      offset.x, offset.y, offset.z, 1.0);\n\n#include <color_vertex>\n#include <morphinstance_vertex>\n#include <morphcolor_vertex>\n#include <batching_vertex>\n\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n\n\t// replace defaultnormal_vertex\n\tvec3 transformedNormal = objectNormal;\n    mat3 m = mat3( particleMatrix );\n    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n    transformedNormal = m * transformedNormal;\n    transformedNormal = normalMatrix * transformedNormal;\n    #ifdef FLIP_SIDED\n        transformedNormal = - transformedNormal;\n    #endif\n    #ifdef USE_TANGENT\n        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n        #ifdef FLIP_SIDED\n        transformedTangent = - transformedTangent;\n        #endif\n    #endif\n\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\n\t// replace include <project_vertex>\n  vec4 mvPosition = vec4( transformed, 1.0 );\n  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t\n\tvViewPosition = - mvPosition.xyz;\n\t\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n    vWorldPosition = worldPosition.xyz;\n#endif\n}\n",n="\n#define STANDARD\n\n#ifdef PHYSICAL\n#define IOR\n#define USE_SPECULAR\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef IOR\nuniform float ior;\n#endif\n\n#ifdef USE_SPECULAR\nuniform float specularIntensity;\nuniform vec3 specularColor;\n\n#ifdef USE_SPECULAR_COLORMAP\nuniform sampler2D specularColorMap;\n#endif\n\n#ifdef USE_SPECULAR_INTENSITYMAP\nuniform sampler2D specularIntensityMap;\n#endif\n#endif\n\n#ifdef USE_CLEARCOAT\nuniform float clearcoat;\nuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_DISPERSION\nuniform float dispersion;\n#endif\n\n#ifdef USE_IRIDESCENCE\nuniform float iridescence;\nuniform float iridescenceIOR;\nuniform float iridescenceThicknessMinimum;\nuniform float iridescenceThicknessMaximum;\n#endif\n\n#ifdef USE_SHEEN\nuniform vec3 sheenColor;\nuniform float sheenRoughness;\n\n#ifdef USE_SHEEN_COLORMAP\nuniform sampler2D sheenColorMap;\n#endif\n\n#ifdef USE_SHEEN_ROUGHNESSMAP\nuniform sampler2D sheenRoughnessMap;\n#endif\n#endif\n\n#ifdef USE_ANISOTROPY\nuniform vec2 anisotropyVector;\n\n#ifdef USE_ANISOTROPYMAP\nuniform sampler2D anisotropyMap;\n#endif\n#endif\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\nvec4 diffuseColor = vec4( diffuse, opacity );\n#include <clipping_planes_fragment>\n\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveRadiance = emissive;\n\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <alphahash_fragment>\n#include <roughnessmap_fragment>\n#include <metalnessmap_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <clearcoat_normal_fragment_begin>\n#include <clearcoat_normal_fragment_maps>\n#include <emissivemap_fragment>\n\n// accumulation\n#include <lights_physical_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n\n// modulation\n#include <aomap_fragment>\n\nvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\nvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\n#include <transmission_fragment>\n\nvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\n#ifdef USE_SHEEN\n\n// Sheen energy compensation approximation calculation can be found at the end of\nfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\noutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\n#endif\n\n#ifdef USE_CLEARCOAT\n\nfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\nvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\noutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\n#endif\n\n#include <opaque_fragment>\n#include <tonemapping_fragment>\n#include <colorspace_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",l=!0):(i="\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <tile_pars_vertex>\n#include <soft_pars_vertex>\n\nattribute vec3 offset;\nattribute vec4 rotation;\nattribute float size;\n// attribute vec4 color;\n\nvoid main() {\n\n    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;\n    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;\n    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;\n    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;\n    float sx = size, sy = size, sz = size;\n    \n    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column\n                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column\n                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column\n                      offset.x, offset.y, offset.z, 1.0);\n    \n    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));\n\n\tvColor = color;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n    #include <tile_vertex>\n    #include <soft_vertex>\n}\n",n=GI):(i="\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#include <tile_pars_vertex>\n#include <soft_pars_vertex>\n\nattribute vec3 offset;\nattribute float rotation;\nattribute float size;\n\nvoid main() {\n\t\n    vec2 alignedPosition = ( position.xy ) * size;\n    \n    vec2 rotatedPosition;\n    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n#ifdef HORIZONTAL\n    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );\n    mvPosition.x += rotatedPosition.x;\n    mvPosition.z -= rotatedPosition.y;\n    mvPosition = viewMatrix * mvPosition;\n#elif defined(VERTICAL)\n    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );\n    mvPosition.y += rotatedPosition.y;\n    mvPosition = viewMatrix * mvPosition;\n    mvPosition.x += rotatedPosition.x;\n#else\n    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );\n    mvPosition.xy += rotatedPosition;\n#endif\n\n\tvColor = color;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\n\t#include <clipping_planes_vertex>\n\n\t#include <tile_vertex>\n\t#include <soft_vertex>\n}\n",n=GI),this.settings.renderMode===zI.VerticalBillBoard?t.VERTICAL="":this.settings.renderMode===zI.HorizontalBillBoard&&(t.HORIZONTAL=""),this.material=new a({uniforms:e,defines:t,vertexShader:i,fragmentShader:n,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:l})}else{if(this.settings.renderMode!==zI.StretchedBillBoard)throw new Error("render mode unavailable");e.speedFactor=new X(1),this.material=new a({uniforms:e,defines:t,vertexShader:"\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#include <tile_pars_vertex>\n#include <soft_pars_vertex>\n\nattribute vec3 offset;\nattribute float rotation;\nattribute float size;\nattribute vec4 velocity;\n\nuniform float speedFactor;\n\nvoid main() {\n    float lengthFactor = velocity.w;\n#ifdef USE_SKEW\n    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );\n    vec3 viewVelocity = normalMatrix * velocity.xyz;\n\n    vec3 scaledPos = vec3(position.xy * size, position.z);\n    float vlength = length(viewVelocity);\n    vec3 projVelocity =  dot(scaledPos, viewVelocity) * viewVelocity / vlength;\n    mvPosition.xyz += scaledPos + projVelocity * (speedFactor / size + lengthFactor / vlength);\n#else\n    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );\n    vec3 viewVelocity = normalMatrix * velocity.xyz;\n    float vlength = length(viewVelocity); \n    mvPosition.xyz += position.y * normalize(cross(mvPosition.xyz, viewVelocity)) * size; // switch the cross to  match unity implementation\n    mvPosition.xyz -= (position.x + 0.5) * viewVelocity * (1.0 + lengthFactor / vlength) * size; // minus position.x to match unity implementation\n#endif\n\tvColor = color;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <tile_vertex>\n\t#include <soft_vertex>\n}\n",fragmentShader:GI,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest})}this.material&&o&&(this.material.onBeforeRender=o)}update(){let e=0,t=0;this.systems.forEach((e=>{t+=e.particleNum})),t>this.maxParticles&&this.expandBuffers(t),this.systems.forEach((t=>{const i=t.particles,n=t.particleNum,s=this.quaternion2_,r=this.vector2_,o=this.vector3_;t.emitter.matrixWorld.decompose(r,s,o),this.rotationMat_.setFromMatrix4(t.emitter.matrixWorld);for(let r=0;r<n;r++,e++){const n=i[r];if(this.settings.renderMode===zI.Mesh){let i;if(t.worldSpace)i=n.rotation;else{let e;e=n.parentMatrix?this.quaternion3_.setFromRotationMatrix(n.parentMatrix):s,i=this.quaternion_,i.copy(e).multiply(n.rotation)}this.rotationBuffer.setXYZW(e,i.x,i.y,i.z,i.w)}else this.settings.renderMode!==zI.StretchedBillBoard&&this.settings.renderMode!==zI.VerticalBillBoard&&this.settings.renderMode!==zI.HorizontalBillBoard&&this.settings.renderMode!==zI.BillBoard||this.rotationBuffer.setX(e,n.rotation);let a;if(t.worldSpace?a=n.position:(a=this.vector_,n.parentMatrix?a.copy(n.position).applyMatrix4(n.parentMatrix):a.copy(n.position).applyMatrix4(t.emitter.matrixWorld)),this.offsetBuffer.setXYZ(e,a.x,a.y,a.z),this.colorBuffer.setXYZW(e,n.color.x,n.color.y,n.color.z,n.color.w),t.worldSpace||n.parentMatrix?this.sizeBuffer.setX(e,n.size):this.sizeBuffer.setX(e,n.size*(Math.abs(o.x)+Math.abs(o.y)+Math.abs(o.z))/3),this.uvTileBuffer.setX(e,n.uvTile),this.settings.renderMode===zI.StretchedBillBoard&&this.velocityBuffer){let i=t.rendererEmitterSettings.speedFactor;0===i&&(i=.001);const s=t.rendererEmitterSettings.lengthFactor;let r;t.worldSpace?r=n.velocity:(r=this.vector_,n.parentMatrix?(this.rotationMat2_.setFromMatrix4(n.parentMatrix),r.copy(n.velocity).applyMatrix3(this.rotationMat2_)):r.copy(n.velocity).applyMatrix3(this.rotationMat_)),this.velocityBuffer.setXYZW(e,r.x*i,r.y*i,r.z*i,s)}}})),this.geometry.instanceCount=e;const i=(e,t,i=0)=>{e.addUpdateRange?e.addUpdateRange(i,t):(e.updateRange.count=t,i>0&&(e.updateRange.offset=i))};e>0&&(i(this.offsetBuffer,3*e),this.offsetBuffer.needsUpdate=!0,i(this.sizeBuffer,e),this.sizeBuffer.needsUpdate=!0,i(this.colorBuffer,4*e),this.colorBuffer.needsUpdate=!0,i(this.uvTileBuffer,e),this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===zI.StretchedBillBoard&&this.velocityBuffer&&(i(this.velocityBuffer,4*e),this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===zI.Mesh?(i(this.rotationBuffer,4*e),this.rotationBuffer.needsUpdate=!0):this.settings.renderMode!==zI.StretchedBillBoard&&this.settings.renderMode!==zI.HorizontalBillBoard&&this.settings.renderMode!==zI.VerticalBillBoard&&this.settings.renderMode!==zI.BillBoard||(i(this.rotationBuffer,e),this.rotationBuffer.needsUpdate=!0))}dispose(){this.geometry.dispose()}}new i(0,0,1);class QI extends UI{constructor(e){super(e),this.vector_=new i,this.vector2_=new i,this.vector3_=new i,this.quaternion_=new v,this.maxParticles=1e4,this.setupBuffers(),this.rebuildMaterial()}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new S,this.indexBuffer=new O(new Uint32Array(6*this.maxParticles),1),this.indexBuffer.setUsage(Me),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new O(new Float32Array(6*this.maxParticles),3),this.positionBuffer.setUsage(Me),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new O(new Float32Array(6*this.maxParticles),3),this.previousBuffer.setUsage(Me),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new O(new Float32Array(6*this.maxParticles),3),this.nextBuffer.setUsage(Me),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new O(new Float32Array(2*this.maxParticles),1),this.widthBuffer.setUsage(Me),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new O(new Float32Array(2*this.maxParticles),1),this.sideBuffer.setUsage(Me),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new O(new Float32Array(4*this.maxParticles),2),this.uvBuffer.setUsage(Me),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new O(new Float32Array(8*this.maxParticles),4),this.colorBuffer.setUsage(Me),this.geometry.setAttribute("color",this.colorBuffer)}expandBuffers(e){for(;e>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){this.layers.mask=this.settings.layers.mask;const e={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new r(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0}},t={USE_UV:"",USE_COLOR_ALPHA:""};if(this.settings.material.map&&(t.USE_MAP="",t.MAP_UV=YI(this.settings.material.map.channel),e.map=new X(this.settings.material.map),e.mapTransform=new X((new fe).copy(this.settings.material.map.matrix))),this.settings.material.defines&&void 0!==this.settings.material.defines.USE_COLOR_AS_ALPHA&&(t.USE_COLOR_AS_ALPHA=""),this.settings.renderMode!==zI.Trail)throw new Error("render mode unavailable");this.material=new a({uniforms:e,defines:t,vertexShader:"\n#include <common>\n#include <tile_pars_vertex>\n#include <color_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\n\nattribute vec3 previous;\nattribute vec3 next;\nattribute float side;\nattribute float width;\n\nuniform vec2 resolution;\nuniform float lineWidth;\nuniform float sizeAttenuation;\n    \nvec2 fix(vec4 i, float aspect) {\n    vec2 res = i.xy / i.w;\n    res.x *= aspect;\n    return res;\n}\n    \nvoid main() {\n\n    #include <tile_vertex>\n    \n    float aspect = resolution.x / resolution.y;\n\n    vColor = color;\n\n    mat4 m = projectionMatrix * modelViewMatrix;\n    vec4 finalPosition = m * vec4( position, 1.0 );\n    vec4 prevPos = m * vec4( previous, 1.0 );\n    vec4 nextPos = m * vec4( next, 1.0 );\n\n    vec2 currentP = fix( finalPosition, aspect );\n    vec2 prevP = fix( prevPos, aspect );\n    vec2 nextP = fix( nextPos, aspect );\n\n    float w = lineWidth * width;\n\n    vec2 dir;\n    if( nextP == currentP ) dir = normalize( currentP - prevP );\n    else if( prevP == currentP ) dir = normalize( nextP - currentP );\n    else {\n        vec2 dir1 = normalize( currentP - prevP );\n        vec2 dir2 = normalize( nextP - currentP );\n        dir = normalize( dir1 + dir2 );\n\n        vec2 perp = vec2( -dir1.y, dir1.x );\n        vec2 miter = vec2( -dir.y, dir.x );\n        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );\n\n    }\n\n    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;\n    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );\n    normal.xy *= .5 * w;\n    normal *= projectionMatrix;\n    if( sizeAttenuation == 0. ) {\n        normal.xy *= finalPosition.w;\n        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;\n    }\n\n    finalPosition.xy += normal.xy * side;\n\n    gl_Position = finalPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    \n\t#include <fog_vertex>\n}",fragmentShader:"\n\n#include <common>\n#include <tile_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nuniform sampler2D alphaMap;\nuniform float useAlphaMap;\nuniform float visibility;\nuniform float alphaTest;\n\nvarying vec4 vColor;\n    \nvoid main() {\n    #include <clipping_planes_fragment>\n    #include <logdepthbuf_fragment>\n\n    vec4 diffuseColor = vColor;\n    \n    #ifdef USE_MAP\n    #include <tile_fragment>\n    #ifndef USE_COLOR_AS_ALPHA\n    #endif\n    #endif\n    if( useAlphaMap == 1. ) diffuseColor.a *= texture2D( alphaMap, vUv).a;\n    if( diffuseColor.a < alphaTest ) discard;\n    gl_FragColor = diffuseColor;\n\n    #include <fog_fragment>\n    #include <tonemapping_fragment>\n}",transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||de})}update(){let e=0,t=0,i=0;this.systems.forEach((e=>{for(let t=0;t<e.particleNum;t++)i+=2*e.particles[t].previous.length})),i>this.maxParticles&&this.expandBuffers(i),this.systems.forEach((i=>{const n=this.quaternion_,s=this.vector2_,r=this.vector3_;i.emitter.matrixWorld.decompose(s,n,r);const o=i.particles,a=i.particleNum,l=this.settings.uTileCount,h=this.settings.vTileCount,c=1/l,d=1/h;for(let n=0;n<a;n++){const s=o[n],a=s.uvTile%h,l=Math.floor(s.uvTile/h+.001),u=s.previous.values();let p,f=u.next(),m=f.value,g=m;f.done||(f=u.next()),p=void 0!==f.value?f.value:g;for(let n=0;n<s.previous.length;n++,e+=2){if(this.positionBuffer.setXYZ(e,g.position.x,g.position.y,g.position.z),this.positionBuffer.setXYZ(e+1,g.position.x,g.position.y,g.position.z),i.worldSpace?(this.positionBuffer.setXYZ(e,g.position.x,g.position.y,g.position.z),this.positionBuffer.setXYZ(e+1,g.position.x,g.position.y,g.position.z)):(s.parentMatrix?this.vector_.copy(g.position).applyMatrix4(s.parentMatrix):this.vector_.copy(g.position).applyMatrix4(i.emitter.matrixWorld),this.positionBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.positionBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),i.worldSpace?(this.previousBuffer.setXYZ(e,m.position.x,m.position.y,m.position.z),this.previousBuffer.setXYZ(e+1,m.position.x,m.position.y,m.position.z)):(s.parentMatrix?this.vector_.copy(m.position).applyMatrix4(s.parentMatrix):this.vector_.copy(m.position).applyMatrix4(i.emitter.matrixWorld),this.previousBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.previousBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),i.worldSpace?(this.nextBuffer.setXYZ(e,p.position.x,p.position.y,p.position.z),this.nextBuffer.setXYZ(e+1,p.position.x,p.position.y,p.position.z)):(s.parentMatrix?this.vector_.copy(p.position).applyMatrix4(s.parentMatrix):this.vector_.copy(p.position).applyMatrix4(i.emitter.matrixWorld),this.nextBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.nextBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),this.sideBuffer.setX(e,-1),this.sideBuffer.setX(e+1,1),i.worldSpace)this.widthBuffer.setX(e,g.size),this.widthBuffer.setX(e+1,g.size);else if(s.parentMatrix)this.widthBuffer.setX(e,g.size),this.widthBuffer.setX(e+1,g.size);else{const t=(Math.abs(r.x)+Math.abs(r.y)+Math.abs(r.z))/3;this.widthBuffer.setX(e,g.size*t),this.widthBuffer.setX(e+1,g.size*t)}this.uvBuffer.setXY(e,(n/s.previous.length+a)*c,(h-l-1)*d),this.uvBuffer.setXY(e+1,(n/s.previous.length+a)*c,(h-l)*d),this.colorBuffer.setXYZW(e,g.color.x,g.color.y,g.color.z,g.color.w),this.colorBuffer.setXYZW(e+1,g.color.x,g.color.y,g.color.z,g.color.w),n+1<s.previous.length&&(this.indexBuffer.setX(3*t,e),this.indexBuffer.setX(3*t+1,e+1),this.indexBuffer.setX(3*t+2,e+2),t++,this.indexBuffer.setX(3*t,e+2),this.indexBuffer.setX(3*t+1,e+1),this.indexBuffer.setX(3*t+2,e+3),t++),m=g,g=p,f.done||(f=u.next(),void 0!==f.value&&(p=f.value))}}})),this.positionBuffer.addUpdateRange(0,3*e),this.positionBuffer.needsUpdate=!0,this.previousBuffer.addUpdateRange(0,3*e),this.previousBuffer.needsUpdate=!0,this.nextBuffer.addUpdateRange(0,3*e),this.nextBuffer.needsUpdate=!0,this.sideBuffer.addUpdateRange(0,e),this.sideBuffer.needsUpdate=!0,this.widthBuffer.addUpdateRange(0,e),this.widthBuffer.needsUpdate=!0,this.uvBuffer.addUpdateRange(0,2*e),this.uvBuffer.needsUpdate=!0,this.colorBuffer.addUpdateRange(0,4*e),this.colorBuffer.needsUpdate=!0,this.indexBuffer.addUpdateRange(0,3*t),this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,3*t)}dispose(){this.geometry.dispose()}}class qI extends u{constructor(){super(),this.batches=[],this.systemToBatchIndex=new Map,this.type="BatchedRenderer",this.depthTexture=null}static equals(e,t){return e.material.side===t.material.side&&e.material.blending===t.material.blending&&e.material.transparent===t.material.transparent&&e.material.type===t.material.type&&e.material.alphaTest===t.material.alphaTest&&e.material.map===t.material.map&&e.renderMode===t.renderMode&&e.blendTiles===t.blendTiles&&e.softParticles===t.softParticles&&e.softFarFade===t.softFarFade&&e.softNearFade===t.softNearFade&&e.uTileCount===t.uTileCount&&e.vTileCount===t.vTileCount&&e.instancingGeometry===t.instancingGeometry&&e.renderOrder===t.renderOrder&&e.layers.mask===t.layers.mask}addSystem(e){var t,i;e._renderer=this;const n=e.getRendererSettings();for(let s=0;s<this.batches.length;s++)if(qI.equals(null===(t=this.batches[s])||void 0===t?void 0:t.settings,n))return null===(i=this.batches[s])||void 0===i||i.addSystem(e),void this.systemToBatchIndex.set(e,s);let s;switch(n.renderMode){case zI.Trail:s=new QI(n);break;case zI.Mesh:case zI.BillBoard:case zI.VerticalBillBoard:case zI.HorizontalBillBoard:case zI.StretchedBillBoard:s=new XI(n)}this.depthTexture&&s.applyDepthTexture(this.depthTexture),s.addSystem(e),this.batches.push(s),this.systemToBatchIndex.set(e,this.batches.length-1),this.add(s)}deleteSystem(e){var t;const i=this.systemToBatchIndex.get(e);null!=i&&(null===(t=this.batches[i])||void 0===t||t.removeSystem(e),this.systemToBatchIndex.delete(e))}setDepthTexture(e){this.depthTexture=e;for(const t of this.batches)t.applyDepthTexture(e)}updateSystem(e){this.deleteSystem(e),this.addSystem(e)}update(e){var t;this.systemToBatchIndex.forEach(((t,i)=>{i.update(e)}));for(let e=0;e<this.batches.length;e++)null===(t=this.batches[e])||void 0===t||t.update()}}class ZI extends Pt{constructor(e){super(null==e?void 0:e.manager),this.onData=null==e?void 0:e.onData}linkReference(e){const t={};e.traverse((function(e){t[e.uuid]=e})),e.traverse((function(e){if("ParticleEmitter"===e.type){const i=e.system;i.emitterShape;for(let e=0;e<i.simulations.length;e++)i.simulations[e]instanceof KB&&(i.simulations[e].subParticleSystem=t[i.simulations[e].subParticleSystem])}}))}parse(e,t){if(this.onData){let t=this.onData(e);t&&(e=t)}const i=super.parse(e,t);return this.linkReference(i),i}parseObject(e,t,i,n,r){let o,a,l;function c(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function d(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let n=0,s=e.length;n<s;n++){const s=e[n];void 0===i[s]&&console.warn("THREE.ObjectLoader: Undefined material",s),t.push(i[s])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}function p(e){return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),n[e]}const m={textures:n,geometries:t,materials:i},v={};switch(e.type){case"ParticleEmitter":o=WI.fromJSON(e.ps,m,v).emitter;break;case"Scene":o=new K,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new s(e.background):o.background=p(e.background)),void 0!==e.environment&&(o.environment=p(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new Vt(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new Ht(e.fog.color,e.fog.density)),""!==e.fog.name&&(o.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(o.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(o.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&o.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(o.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new ee(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new f(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new jt(e.color,e.intensity);break;case"DirectionalLight":o=new Nt(e.color,e.intensity);break;case"PointLight":o=new Ft(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new Ut(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new zt(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new Lt(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new kt).fromJSON(e);break;case"SkinnedMesh":a=c(e.geometry),l=d(e.material),o=new mt(a,l),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":a=c(e.geometry),l=d(e.material),o=new h(a,l);break;case"InstancedMesh":a=c(e.geometry),l=d(e.material);const t=e.count,i=e.instanceMatrix,n=e.instanceColor;o=new j(a,l,t),o.instanceMatrix=new Tt(new Float32Array(i.array),16),void 0!==n&&(o.instanceColor=new Tt(new Float32Array(n.array),n.itemSize));break;case"BatchedMesh":a=c(e.geometry),l=d(e.material),o=new Rt(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,l),o.geometry=a,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map((e=>{const t=new E;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);const i=new P;return i.radius=e.sphereRadius,i.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:i}})),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=p(e.matricesTexture.uuid);break;case"LOD":o=new It;break;case"Line":o=new Bt(c(e.geometry),d(e.material));break;case"LineLoop":o=new Dt(c(e.geometry),d(e.material));break;case"LineSegments":o=new L(c(e.geometry),d(e.material));break;case"PointCloud":case"Points":o=new me(c(e.geometry),d(e.material));break;case"Sprite":o=new g(d(e.material));break;case"Group":o=new V;break;case"Bone":o=new Ot;break;default:o=new u}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&(o.matrix.decompose(o.position,o.quaternion,o.scale),isNaN(o.quaternion.x)&&o.quaternion.set(0,0,0,1))):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.up&&o.up.fromArray(e.up),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)o.add(this.parseObject(s[e],t,i,n,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const i=t[e];o.animations.push(r[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const i=t[e],n=o.getObjectByProperty("uuid",i.object);void 0!==n&&o.addLevel(n,i.distance)}}return o}}const KI=[];function JI(e){if(!KI.find((t=>t.id===e.id))){e.initialize();for(const t of e.emitterShapes)kI[t.type]||(kI[t.type]=t);for(const t of e.simulations)SI[t.type]||(SI[t.type]=t)}}function $I(e){const t=KI.find((t=>t.id===e));if(t){for(const e of t.emitterShapes)kI[e.type]&&delete kI[e.type];for(const e of t.simulations)SI[e.type]&&delete SI[e.type]}}var eR;!function(e){e[e.Number=0]="Number",e[e.Vec2=1]="Vec2",e[e.Vec3=2]="Vec3",e[e.Vec4=3]="Vec4",e[e.Boolean=4]="Boolean",e[e.AnyType=5]="AnyType",e[e.NullableAnyType=6]="NullableAnyType",e[e.EventStream=7]="EventStream"}(eR||(eR={}));const tR=e=>{switch(e){case eR.Boolean:case eR.Number:return 4;case eR.Vec2:return 8;case eR.Vec3:case eR.Vec4:return 16;case eR.AnyType:case eR.NullableAnyType:default:return 0}},iR=e=>{switch(e){case eR.Boolean:return 1;case eR.Number:return 4;case eR.Vec2:return 8;case eR.Vec3:return 12;case eR.Vec4:return 16;case eR.AnyType:case eR.NullableAnyType:default:return 0}},nR=e=>{switch(e){case eR.Boolean:return!1;case eR.Number:return 0;case eR.Vec2:return new r;case eR.Vec3:return new i;case eR.Vec4:return new y;case eR.AnyType:return 0;case eR.NullableAnyType:return}};class sR{constructor(e,t=-1,i={}){this.inputs=[],this.outputs=[],this.signatureIndex=-1,this.position=new r,this.outputValues=[],this.id=""+Math.round(1e5*Math.random()),this.definition=e,this.signatureIndex=t,this.data=i;const n=-1===t?0:t;for(let t=0;t<e.nodeTypeSignatures[n].inputTypes.length;t++)this.inputs.push(void 0);for(let t=0;t<e.nodeTypeSignatures[n].outputTypes.length;t++)this.outputs.push([])}get inputTypes(){const e=-1===this.signatureIndex?0:this.signatureIndex;return this.definition.nodeTypeSignatures[e].inputTypes}get outputTypes(){const e=-1===this.signatureIndex?0:this.signatureIndex;return this.definition.nodeTypeSignatures[e].outputTypes}func(e,t,i){const n=-1===this.signatureIndex?0:this.signatureIndex;this.definition.nodeTypeSignatures[n].func(e,this.data,t,i)}}class rR{constructor(e,t,i,n){this.input=e,this.inputIndex=t,this.input.outputs[t].push(this),this.output=i,this.outputIndex=n,this.output.inputs[n]=this}}class oR{constructor(e,t,i,n){if(this.type=e,this.node=i,this.isInput=t,this.paramIndex=n,t)switch(e){case eR.Vec2:this.inputs=[void 0,void 0],this.outputs=[];break;case eR.Vec3:this.inputs=[void 0,void 0,void 0],this.outputs=[];break;case eR.Vec4:this.inputs=[void 0,void 0,void 0,void 0],this.outputs=[];break;default:this.inputs=[void 0],this.outputs=[]}else switch(e){case eR.Vec2:this.inputs=[],this.outputs=[[],[]];break;case eR.Vec3:this.inputs=[],this.outputs=[[],[],[]];break;case eR.Vec4:this.inputs=[],this.outputs=[[],[],[],[]];break;default:this.inputs=[],this.outputs=[[]]}}}class aR{constructor(){this.visited=new Set,this.debug=!1,aR.Instance=this}buildExecutionOrder(e,t){e.nodesInOrder.length=0,this.visited.clear();for(let i=0;i<e.outputNodes.length;i++){const n=e.outputNodes[i];void 0!==n.inputs[0]&&this._traverse(n,e,t)}e.compiled=!0}_traverseWire(e,t,i){}_traverse(e,t,i){this.visited.add(e.id);for(let n=0;n<e.inputs.length;n++)if(e.inputs[n]instanceof rR){const s=e.inputs[n].input;s instanceof sR?this.visited.has(s.id)||this._traverse(s,t,i):s instanceof oR&&(s.isInput||this._traverse(s.node,t,i))}else if(e.inputs[n]instanceof oR){const s=e.inputs[n];for(let e=0;e<s.inputs.length;e++){const n=s.inputs[e];void 0!==n&&(n.input instanceof sR?this.visited.has(n.input.id)||this._traverse(n.input,t,i):this.visited.has(n.input.node.id)||this._traverse(n.input.node,t,i))}}t.nodesInOrder.push(e)}}class lR extends aR{constructor(){super()}executeCompiledGraph(e,t){const i=e.nodesInOrder;for(let e=0;e<i.length;e++){const n=[],s=i[e];this.debug&&console.log("Node:",s);for(let e=0;e<s.inputs.length;e++)s.inputs[e]instanceof rR?s.inputs[e].input instanceof sR&&n.push(s.inputs[e].input.outputValues[s.inputs[e].inputIndex]):s.inputs[e]instanceof oR||(void 0!==s.inputs[e]?n.push(s.inputs[e].getValue(t)):n.push(void 0));if(0===s.outputValues.length){const e=s.signatureIndex<0?0:s.signatureIndex;for(let t=0;t<s.definition.nodeTypeSignatures[e].outputTypes.length;t++)s.outputValues.push(nR(s.definition.nodeTypeSignatures[e].outputTypes[t])),void 0===s.outputValues[t]&&(s.outputValues[t]=nR(s.data.type))}s.func(t,n,s.outputValues)}}run(e,t){e.compiled||this.buildExecutionOrder(e,t),this.executeCompiledGraph(e,t)}build(e,t){return""}}var hR;!function(e){e[e.Variable=0]="Variable",e[e.Expression=1]="Expression",e[e.Storage=2]="Storage",e[e.Function=3]="Function"}(hR||(hR={}));class cR{constructor(e,t){this.nodeTypeSignatures=[],this.name=e,this.type=t}addSignature(e,t,i){this.nodeTypeSignatures.push({inputTypes:e,outputTypes:t,func:i})}}class dR extends cR{constructor(e){const t=[];for(let i=0;i<e.inputNodes.length;i++)"input"===e.inputNodes[i].definition.name&&t.push(e.inputNodes[i].data.type);const i=[];for(let t=0;t<e.outputNodes.length;t++)"output"===e.outputNodes[t].definition.name&&i.push(e.outputNodes[t].data.type);super(e.name,hR.Expression),this.addSignature(t,i,((t,i,n,s)=>{t.inputs=n,t.outputs=s,lR.Instance.run(e,t)})),this.nodeGraph=e}}const uR={},pR=new cR("add",hR.Expression);pR.addSignature([eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=i[0]+i[1]})),pR.addSignature([eR.Vec2,eR.Vec2],[eR.Vec2],((e,t,i,n)=>{n[0].addVectors(i[0],i[1])})),pR.addSignature([eR.Vec3,eR.Vec3],[eR.Vec3],((e,t,i,n)=>{n[0].addVectors(i[0],i[1])})),pR.addSignature([eR.Vec4,eR.Vec4],[eR.Vec4],((e,t,i,n)=>{n[0].addVectors(i[0],i[1])})),uR.add=pR;const fR=new cR("sub",hR.Expression);fR.addSignature([eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=i[0]-i[1]})),fR.addSignature([eR.Vec2,eR.Vec2],[eR.Vec2],((e,t,i,n)=>{n[0].subVectors(i[0],i[1])})),fR.addSignature([eR.Vec3,eR.Vec3],[eR.Vec3],((e,t,i,n)=>{n[0].subVectors(i[0],i[1])})),fR.addSignature([eR.Vec4,eR.Vec4],[eR.Vec4],((e,t,i,n)=>{n[0].subVectors(i[0],i[1])})),uR.sub=fR;const mR=new cR("mul",hR.Expression);mR.addSignature([eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=i[0]*i[1]})),mR.addSignature([eR.Vec2,eR.Number],[eR.Vec2],((e,t,i,n)=>{n[0].copy(i[0]).multiplyScalar(i[1])})),mR.addSignature([eR.Vec3,eR.Number],[eR.Vec3],((e,t,i,n)=>{n[0].copy(i[0]).multiplyScalar(i[1])})),mR.addSignature([eR.Vec4,eR.Number],[eR.Vec4],((e,t,i,n)=>{n[0].copy(i[0]).multiplyScalar(i[1])})),uR.mul=mR;const gR=new cR("div",hR.Expression);gR.addSignature([eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=i[0]/i[1]})),gR.addSignature([eR.Vec2,eR.Number],[eR.Vec2],((e,t,i,n)=>{n[0].copy(i[0]).divideScalar(i[1])})),gR.addSignature([eR.Vec3,eR.Number],[eR.Vec3],((e,t,i,n)=>{n[0].copy(i[0]).divideScalar(i[1])})),gR.addSignature([eR.Vec4,eR.Number],[eR.Vec4],((e,t,i,n)=>{n[0].copy(i[0]).divideScalar(i[1])})),uR.div=gR;const vR=new cR("sin",hR.Expression);vR.addSignature([eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=Math.sin(i[0])})),uR.sin=vR;const yR=new cR("cos",hR.Expression);yR.addSignature([eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=Math.cos(i[0])})),uR.cos=yR;const xR=new cR("tan",hR.Expression);xR.addSignature([eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=Math.tan(i[0])})),uR.tan=xR;const wR=new cR("abs",hR.Expression);wR.addSignature([eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=Math.abs(i[0])})),uR.abs=wR;const bR=new cR("min",hR.Expression);bR.addSignature([eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=Math.min(i[0],i[1])})),uR.min=bR;const _R=new cR("max",hR.Expression);_R.addSignature([eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=Math.max(i[0],i[1])})),uR.max=_R;const SR=new cR("dot",hR.Expression);SR.addSignature([eR.Vec2,eR.Vec2],[eR.Number],((e,t,i,n)=>{n[0]=i[0].dot(i[1])})),SR.addSignature([eR.Vec3,eR.Vec3],[eR.Number],((e,t,i,n)=>{n[0]=i[0].dot(i[1])})),SR.addSignature([eR.Vec4,eR.Vec4],[eR.Number],((e,t,i,n)=>{n[0]=i[0].dot(i[1])})),uR.dot=SR;const MR=new cR("cross",hR.Expression);MR.addSignature([eR.Vec3,eR.Vec3],[eR.Vec3],((e,t,i,n)=>{n[0].crossVectors(i[0],i[1])})),uR.cross=MR;const CR=new cR("length",hR.Expression);CR.addSignature([eR.Vec2],[eR.Number],((e,t,i,n)=>{n[0]=i[0].length()})),CR.addSignature([eR.Vec3],[eR.Number],((e,t,i,n)=>{n[0]=i[0].length()})),CR.addSignature([eR.Vec4],[eR.Number],((e,t,i,n)=>{n[0]=i[0].length()})),uR.length=CR;const AR=new cR("lengthSq",hR.Expression);AR.addSignature([eR.Vec2],[eR.Number],((e,t,i,n)=>{n[0]=i[0].lengthSq()})),AR.addSignature([eR.Vec3],[eR.Number],((e,t,i,n)=>{n[0]=i[0].lengthSq()})),AR.addSignature([eR.Vec4],[eR.Number],((e,t,i,n)=>{n[0]=i[0].lengthSq()})),uR.lengthSq=AR;const ER=new cR("normalize",hR.Expression);ER.addSignature([eR.Vec2],[eR.Vec2],((e,t,i,n)=>{n[0].copy(i[0]).normalize()})),ER.addSignature([eR.Vec3],[eR.Vec3],((e,t,i,n)=>{n[0].copy(i[0]).normalize()})),ER.addSignature([eR.Vec4],[eR.Vec4],((e,t,i,n)=>{n[0].copy(i[0]).normalize()})),uR.normalize=ER;const TR=new cR("distance",hR.Expression);TR.addSignature([eR.Vec2,eR.Vec2],[eR.Number],((e,t,i,n)=>{n[0]=i[0].distanceTo(i[1])})),TR.addSignature([eR.Vec3,eR.Vec3],[eR.Number],((e,t,i,n)=>{n[0]=i[0].distanceTo(i[1])})),uR.distance=TR;const PR=new cR("and",hR.Expression);PR.addSignature([eR.Boolean,eR.Boolean],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0]&&i[1]})),uR.and=PR;const OR=new cR("or",hR.Expression);OR.addSignature([eR.Boolean,eR.Boolean],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0]||i[1]})),uR.or=OR;const DR=new cR("not",hR.Expression);DR.addSignature([eR.Boolean],[eR.Boolean],((e,t,i,n)=>{n[0]=!i[0]})),uR.not=DR;const BR=new cR("equal",hR.Expression);BR.addSignature([eR.Number,eR.Number],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0]===i[1]})),BR.addSignature([eR.Vec2,eR.Vec2],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0].equals(i[1])})),BR.addSignature([eR.Vec3,eR.Vec3],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0].equals(i[1])})),BR.addSignature([eR.Vec4,eR.Vec4],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0].equals(i[1])})),uR.equal=BR;const IR=new cR("lessThan",hR.Expression);IR.addSignature([eR.Number,eR.Number],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0]<i[1]})),uR.lessThan=IR;const RR=new cR("greaterThan",hR.Expression);RR.addSignature([eR.Number,eR.Number],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0]>i[1]})),uR.greaterThan=RR;const kR=new cR("lessThanOrEqual",hR.Expression);kR.addSignature([eR.Number,eR.Number],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0]<=i[1]})),uR.lessThanOrEqual=kR;const LR=new cR("greaterThanOrEqual",hR.Expression);LR.addSignature([eR.Number,eR.Number],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0]>=i[1]})),uR.greaterThanOrEqual=LR;const zR=new cR("if",hR.Expression);zR.addSignature([eR.Boolean,eR.AnyType,eR.AnyType],[eR.AnyType],((e,t,i,n)=>{n[0]=i[0]?i[1]:i[2]})),uR.if=zR;const UR=new cR("number",hR.Expression);UR.addSignature([],[eR.Number],((e,t,i,n)=>{n[0]=t.value})),uR.number=UR;const FR=new cR("vec2",hR.Expression);FR.addSignature([eR.Number,eR.Number],[eR.Vec2],((e,t,i,n)=>{n[0].x=i[0],n[0].y=i[1]})),uR.vec2=FR;const NR=new cR("vec3",hR.Expression);NR.addSignature([eR.Number,eR.Number,eR.Number],[eR.Vec3],((e,t,i,n)=>{n[0].x=i[0],n[0].y=i[1],n[0].z=i[2]})),uR.vec3=NR;const jR=new cR("vec4",hR.Expression);jR.addSignature([eR.Number,eR.Number,eR.Number,eR.Number],[eR.Vec4],((e,t,i,n)=>{n[0].x=i[0],n[0].y=i[1],n[0].z=i[2],n[0].w=i[3]})),uR.vec4=jR;const VR=new cR("bool",hR.Expression);VR.addSignature([],[eR.Boolean],((e,t,i,n)=>{n[0]=t.value})),uR.bool=VR;const HR=new cR("particleProperty",hR.Storage);HR.addSignature([eR.NullableAnyType],[eR.NullableAnyType],((e,t,i,n)=>{void 0!==i[0]&&(t.type!==eR.Number?e.particle[t.property].copy(i[0]):e.particle[t.property]=i[0]),void 0!==e.particle[t.property]&&(t.type!==eR.Number?n[0].copy(e.particle[t.property]):n[0]=e.particle[t.property])})),uR.particleProperty=HR;const WR=new cR("emit",hR.Function);WR.addSignature([eR.EventStream],[],((e,t,i,n)=>{const s=i[0];for(let t=0;t<s.length;t++)e.signal(t,s[t])})),uR.emit=WR;const GR=new cR("graphProperty",hR.Storage);GR.addSignature([eR.NullableAnyType],[eR.NullableAnyType],((e,t,i,n)=>{void 0!==i[0]&&(t.type!==eR.Number?e.graph[t.property].copy(i[0]):e.graph[t.property]=i[0]),void 0!==e.graph[t.property]&&(t.type!==eR.Number?n[0].copy(e.graph[t.property]):n[0]=e.graph[t.property])})),uR.graphProperty=GR;const YR=new cR("startEvent",hR.Expression);YR.addSignature([],[eR.EventStream],((e,t,i,n)=>{n[0]=[{type:"start"}]})),uR.startEvent=YR;const XR=new cR("repeater",hR.Expression);XR.addSignature([eR.EventStream,eR.Number],[eR.EventStream],((e,t,i,n)=>{const s=i[0],r=i[1],o=[];for(let e=0;e<s.length;e++)for(let t=0;t<r;t++)o.push(s[e]);n[0]=o})),uR.repeater=XR;const QR=new cR("time",hR.Expression);QR.addSignature([],[eR.Number],((e,t,i,n)=>{n[0]=e.emissionState.time})),uR.time=QR;const qR=new cR("delta",hR.Expression);qR.addSignature([],[eR.Number],((e,t,i,n)=>{n[0]=e.delta})),uR.delta=qR;const ZR=new cR("output",hR.Storage);ZR.addSignature([eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=i[0]})),ZR.addSignature([eR.Vec2],[eR.Vec2],((e,t,i,n)=>{n[0]=i[0]})),ZR.addSignature([eR.Vec3],[eR.Vec3],((e,t,i,n)=>{n[0]=i[0]})),ZR.addSignature([eR.Vec4],[eR.Vec4],((e,t,i,n)=>{n[0]=i[0]})),ZR.addSignature([eR.Boolean],[eR.Boolean],((e,t,i,n)=>{n[0]=i[0]})),uR.output=ZR;const KR=new cR("lerp",hR.Expression);KR.addSignature([eR.Number,eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=i[0]*(1-i[2])+i[1]*i[2]})),KR.addSignature([eR.Vec2,eR.Vec2,eR.Number],[eR.Vec2],((e,t,i,n)=>{n[0].lerpVectors(i[0],i[1],i[2])})),KR.addSignature([eR.Vec3,eR.Vec3,eR.Number],[eR.Vec3],((e,t,i,n)=>{n[0].lerpVectors(i[0],i[1],i[2])})),KR.addSignature([eR.Vec4,eR.Vec4,eR.Number],[eR.Vec4],((e,t,i,n)=>{n[0].lerpVectors(i[0],i[1],i[2])})),uR.lerp=KR;const JR=new cR("normDistrib",hR.Expression);JR.addSignature([eR.Number],[eR.Number],((e,t,i,n)=>{var s;n[0]=(s=i[0],1/Math.sqrt(2*Math.PI)*Math.exp(s*s*-.5))})),uR.normDistrib=JR;const $R=new cR("normcdf",hR.Expression);$R.addSignature([eR.Number],[eR.Number],((e,t,i,n)=>{let s=i[0],r=1;s<0&&(r=-1),s=Math.abs(s)/Math.sqrt(2);const o=1/(1+.3275911*s),a=1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-s*s);n[0]=.5*(1+r*a)})),uR.normcdf=$R;const ek=new cR("normcdfInv",hR.Expression),tk=e=>{const t=[2.515517,.802853,.010328],i=[1.432788,.189269,.001308];return e-((t[2]*e+t[1])*e+t[0])/(((i[2]*e+i[1])*e+i[0])*e+1)},ik=e=>e<.5?-tk(Math.sqrt(-2*Math.log(e))):tk(Math.sqrt(-2*Math.log(1-e)));ek.addSignature([eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=ik(i[0])})),uR.normcdfInv=ek;const nk=new cR("clamp",hR.Expression);nk.addSignature([eR.Number,eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=Math.max(Math.min(i[0],i[2]),i[1])})),uR.clamp=nk;const sk=new cR("smoothstep",hR.Expression);sk.addSignature([eR.Number,eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{const s=Math.max(Math.min(i[0],i[2]),i[1]);n[0]=s*s*(3-2*s)})),uR.smoothstep=sk;const rk=new cR("random",hR.Expression);rk.addSignature([eR.Number,eR.Number],[eR.Number],((e,t,i,n)=>{n[0]=Math.random()*(i[1]-i[0])+i[0]})),rk.addSignature([eR.Vec2,eR.Vec2],[eR.Vec2],((e,t,i,n)=>{let s=Math.random();n[0].lerpVectors(i[0],i[1],s)})),rk.addSignature([eR.Vec3,eR.Vec3],[eR.Vec3],((e,t,i,n)=>{let s=Math.random();n[0].lerpVectors(i[0],i[1],s)})),rk.addSignature([eR.Vec4,eR.Vec4],[eR.Vec4],((e,t,i,n)=>{let s=Math.random();n[0].lerpVectors(i[0],i[1],s)})),uR.random=rk;const ok=new cR("vrand",hR.Expression);ok.addSignature([],[eR.Vec2],((e,t,i,n)=>{let s=ik(Math.random()),r=ik(Math.random());const o=Math.sqrt(s*s+r*r);n[0].set(s/o,r/o)})),ok.addSignature([],[eR.Vec3],((e,t,i,n)=>{let s=ik(Math.random()),r=ik(Math.random()),o=ik(Math.random());const a=Math.sqrt(s*s+r*r+o*o);n[0].set(s/a,r/a,o/a)})),ok.addSignature([],[eR.Vec4],((e,t,i,n)=>{let s=ik(Math.random()),r=ik(Math.random()),o=ik(Math.random()),a=ik(Math.random());const l=Math.sqrt(s*s+r*r+o*o+a*a);n[0].set(s/l,r/l,o/l,a/l)})),uR.vrand=ok;const ak=new cR("bsdf",hR.Storage);ak.addSignature([eR.Vec3,eR.Vec3,eR.Vec3,eR.Number],[],((e,t,i,n)=>{})),uR.bsdf=ak;const lk=new Set(["output","particleProperty","graphProperty","emit"]);class hk{constructor(e){this.inputNodes=[],this.outputNodes=[],this.allNodes=new Map,this.wires=[],this.compiled=!1,this.nodesInOrder=[],this.version="1.0",this.uuid=o.generateUUID(),this.name=e,this.revision=0}addWire(e){this.wires.push(e),this.revision++}addNode(e){this.allNodes.set(e.id,e),e.definition===uR.input?this.inputNodes.push(e):lk.has(e.definition.name)&&this.outputNodes.push(e),this.revision++}getNode(e){return this.allNodes.get(e)}deleteNode(e){this.allNodes.delete(e.id),this.revision++}deleteWire(e){let t=e.input.outputs[e.inputIndex].indexOf(e);-1!==t&&e.input.outputs[e.inputIndex].splice(t,1),e.output.inputs[e.outputIndex]=void 0,t=this.wires.indexOf(e),-1!=t&&(this.wires[t]=this.wires[this.wires.length-1],this.wires.pop()),this.revision++}toJSON(){throw new Error("not implemented")}clone(){throw new Error("not implemented")}}new i(0,0,1);const ck=new v,dk=new i,uk=new i,pk=new l(1,1,1,1);class fk{set time(e){this.emissionState.time=e}get time(){return this.emissionState.time}get layers(){return this.rendererSettings.layers}get texture(){return this.rendererSettings.material.map}set texture(e){this.rendererSettings.material.map=e,this.neededToUpdateRender=!0}get material(){return this.rendererSettings.material}set material(e){this.rendererSettings.material=e,this.neededToUpdateRender=!0}get instancingGeometry(){return this.rendererSettings.instancingGeometry}set instancingGeometry(e){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=e,this.neededToUpdateRender=!0}get renderMode(){return this.rendererSettings.renderMode}set renderMode(e){if((this.rendererSettings.renderMode!=zI.Trail&&e===zI.Trail||this.rendererSettings.renderMode==zI.Trail&&e!==zI.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==e)switch(e){case zI.Trail:this.rendererEmitterSettings={startLength:30,followLocalOrigin:!1};break;case zI.Mesh:this.rendererEmitterSettings={geometry:new l(1,1)};break;case zI.BillBoard:case zI.VerticalBillBoard:case zI.HorizontalBillBoard:case zI.StretchedBillBoard:this.rendererEmitterSettings={}}this.rendererSettings.renderMode=e,this.neededToUpdateRender=!0}get renderOrder(){return this.rendererSettings.renderOrder}set renderOrder(e){this.rendererSettings.renderOrder=e,this.neededToUpdateRender=!0}get blending(){return this.rendererSettings.material.blending}set blending(e){this.rendererSettings.material.blending=e,this.neededToUpdateRender=!0}constructor(e){var t,n,s,r,o,a,l;this.signal={onRestart:new cy,onPlay:new cy,onPause:new cy,onEnd:new cy},this.temp=new i,this.travelDistance=0,this.normalMatrix=new fe,this.speedFactor=0,this.autoDestroy=void 0!==e.autoDestroy&&e.autoDestroy,this.duration=null!==(t=e.duration)&&void 0!==t?t:1,this.looping=void 0===e.looping||e.looping,this.prewarm=void 0!==e.prewarm&&e.prewarm,this.worldSpace=null!==(n=e.worldSpace)&&void 0!==n&&n,this.rendererEmitterSettings=null!==(s=e.rendererEmitterSettings)&&void 0!==s?s:{},this.emissionGraph=e.emissionGraph,this.updateGraph=e.updateGraph,this.interpreter=new lR,this.rendererSettings={instancingGeometry:null!==(r=e.instancingGeometry)&&void 0!==r?r:pk,renderMode:null!==(o=e.renderMode)&&void 0!==o?o:zI.BillBoard,renderOrder:null!==(a=e.renderOrder)&&void 0!==a?a:0,material:e.material,layers:null!==(l=e.layers)&&void 0!==l?l:new Et,uTileCount:1,vTileCount:1,blendTiles:!1,softParticles:!1,softNearFade:0,softFarFade:0},this.neededToUpdateRender=!0,this.particles=new Array,this.emitter=new sB(this),this.paused=!1,this.particleNum=0,this.emissionState={time:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}pause(){this.paused=!0}play(){this.paused=!1}spawn(e,t){ck.setFromRotationMatrix(t);const n=dk,s=ck,r=uk;for(t.decompose(n,s,r),this.particleNum++;this.particles.length<this.particleNum;)this.particles.push(new aB);const o=this.particles[this.particleNum-1];if(o.reset(),this.interpreter.run(this.updateGraph,{particle:o,emissionState:this.emissionState}),this.rendererSettings.renderMode===zI.Trail&&this.rendererEmitterSettings.followLocalOrigin){const e=o;e.localPosition=(new i).copy(e.position)}this.worldSpace&&(o.position.applyMatrix4(t),o.size*=(Math.abs(r.x)+Math.abs(r.y)+Math.abs(r.z))/3,o.velocity.multiply(r).applyMatrix3(this.normalMatrix),o.rotation&&o.rotation instanceof v&&o.rotation.multiplyQuaternions(ck,o.rotation))}endEmit(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}dispose(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}restart(){this.paused=!1,this.particleNum=0,this.emissionState.time=0,this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}update(e){if(this.paused)return;let t=this.emitter;for(;t.parent;)t=t.parent;if("Scene"!==t.type)return void this.dispose();if(this.emitEnded&&0===this.particleNum)return void(this.markForDestroy&&this.emitter.parent&&this.dispose());if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(let e=0;e<60*this.duration;e++)this.update(1/60)}e>.1&&(e=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.emit(e,this.emissionState,this.emitter.matrixWorld);const i={particle:void 0,emissionState:this.emissionState,delta:e};for(let e=0;e<this.particleNum;e++)i.particle=this.particles[e],this.interpreter.run(this.updateGraph,i);for(let t=0;t<this.particleNum;t++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[t].localPosition?(this.particles[t].position.copy(this.particles[t].localPosition),this.particles[t].parentMatrix?this.particles[t].position.applyMatrix4(this.particles[t].parentMatrix):this.particles[t].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[t].position.addScaledVector(this.particles[t].velocity,e),this.particles[t].age+=e;if(this.rendererSettings.renderMode===zI.Trail)for(let e=0;e<this.particleNum;e++)this.particles[e].update();for(let e=0;e<this.particleNum;e++){const t=this.particles[e];!t.died||t instanceof cB&&0!==t.previous.length||(this.particles[e]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=t,this.particleNum--,e--)}}emit(e,t,n){t.time>this.duration&&(this.looping?t.time-=this.duration:this.emitEnded||this.endEmit()),this.normalMatrix.getNormalMatrix(n);const s={signal:()=>{this.spawn(t,n)},emissionState:t,delta:e};this.emitEnded||this.interpreter.run(this.emissionGraph,s),void 0===this.previousWorldPos&&(this.previousWorldPos=new i),this.emitter.getWorldPosition(this.previousWorldPos),t.time+=e}toJSON(e,t={}){return{}}getRendererSettings(){return this.rendererSettings}clone(){return this}}const mk={number:{buildBySigIndex:[(e,t,i)=>`${t[0]}`]},vec2:{buildBySigIndex:[(e,t,i)=>`vec2<f32>(${t[0]}, ${t[1]})`]},vec3:{buildBySigIndex:[(e,t,i)=>`vec3<f32>(${t[0]}, ${t[1]}, ${t[2]})`]},vec4:{buildBySigIndex:[(e,t,i)=>`vec4<f32>(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`]},add:{buildBySigIndex:[(e,t,i)=>`(${t[0]} + ${t[1]})`,(e,t,i)=>`(${t[0]} + ${t[1]})`,(e,t,i)=>`(${t[0]} + ${t[1]})`,(e,t,i)=>`(${t[0]} + ${t[1]})`]},subtract:{buildBySigIndex:[(e,t,i)=>`(${t[0]} - ${t[1]})`,(e,t,i)=>`(${t[0]} - ${t[1]})`,(e,t,i)=>`(${t[0]} - ${t[1]})`,(e,t,i)=>`(${t[0]} - ${t[1]})`]},mul:{buildBySigIndex:[(e,t,i)=>`(${t[0]} * ${t[1]})`,(e,t,i)=>`(${t[0]} * ${t[1]})`,(e,t,i)=>`(${t[0]} * ${t[1]})`,(e,t,i)=>`(${t[0]} * ${t[1]})`]},div:{buildBySigIndex:[(e,t,i)=>`(${t[0]} / ${t[1]})`,(e,t,i)=>`(${t[0]} / ${t[1]})`,(e,t,i)=>`(${t[0]} / ${t[1]})`,(e,t,i)=>`(${t[0]} / ${t[1]})`]},power:{buildBySigIndex:[(e,t,i)=>`pow(${t[0]}, ${t[1]})`]},sqrt:{buildBySigIndex:[(e,t,i)=>`sqrt(${t[0]})`]},sin:{buildBySigIndex:[(e,t,i)=>`sin(${t[0]})`]},cos:{buildBySigIndex:[(e,t,i)=>`cos(${t[0]})`]},tan:{buildBySigIndex:[(e,t,i)=>`tan(${t[0]})`]},asin:{buildBySigIndex:[(e,t,i)=>`asin(${t[0]})`]},acos:{buildBySigIndex:[(e,t,i)=>`acos(${t[0]})`]},atan:{buildBySigIndex:[(e,t,i)=>`atan(${t[0]})`]},atan2:{buildBySigIndex:[(e,t,i)=>`atan(${t[0]}, ${t[1]})`]},abs:{buildBySigIndex:[(e,t,i)=>`abs(${t[0]})`]},floor:{buildBySigIndex:[(e,t,i)=>`floor(${t[0]})`]},ceil:{buildBySigIndex:[(e,t,i)=>`ceil(${t[0]})`]},round:{buildBySigIndex:[(e,t,i)=>`round(${t[0]})`]},min:{buildBySigIndex:[(e,t,i)=>`min(${t[0]}, ${t[1]})`,(e,t,i)=>`min(${t[0]}, ${t[1]})`,(e,t,i)=>`min(${t[0]}, ${t[1]})`,(e,t,i)=>`min(${t[0]}, ${t[1]})`]},max:{buildBySigIndex:[(e,t,i)=>`max(${t[0]}, ${t[1]})`,(e,t,i)=>`max(${t[0]}, ${t[1]})`,(e,t,i)=>`max(${t[0]}, ${t[1]})`,(e,t,i)=>`max(${t[0]}, ${t[1]})`]},clamp:{buildBySigIndex:[(e,t,i)=>`clamp(${t[0]}, ${t[1]}, ${t[2]})`,(e,t,i)=>`clamp(${t[0]}, ${t[1]}, ${t[2]})`,(e,t,i)=>`clamp(${t[0]}, ${t[1]}, ${t[2]})`,(e,t,i)=>`clamp(${t[0]}, ${t[1]}, ${t[2]})`]},mix:{buildBySigIndex:[(e,t,i)=>`mix(${t[0]}, ${t[1]}, ${t[2]})`,(e,t,i)=>`mix(${t[0]}, ${t[1]}, ${t[2]})`,(e,t,i)=>`mix(${t[0]}, ${t[1]}, ${t[2]})`,(e,t,i)=>`mix(${t[0]}, ${t[1]}, ${t[2]})`]},step:{buildBySigIndex:[(e,t,i)=>`step(${t[0]}, ${t[1]})`,(e,t,i)=>`step(${t[0]}, ${t[1]})`,(e,t,i)=>`step(${t[0]}, ${t[1]})`,(e,t,i)=>`step(${t[0]}, ${t[1]})`]},smoothstep:{buildBySigIndex:[(e,t,i)=>`smoothstep(${t[0]}, ${t[1]}, ${t[2]})`,(e,t,i)=>`smoothstep(${t[0]}, ${t[1]}, ${t[2]})`,(e,t,i)=>`smoothstep(${t[0]}, ${t[1]}, ${t[2]})`,(e,t,i)=>`smoothstep(${t[0]}, ${t[1]}, ${t[2]})`]},length:{buildBySigIndex:[(e,t,i)=>`length(${t[0]})`,(e,t,i)=>`length(${t[0]})`,(e,t,i)=>`length(${t[0]})`]},delta:{buildBySigIndex:[(e,t,i)=>"sim_params.delta"]},particleProperty:{buildBySigIndex:[(e,t,i)=>`particle.${e.data.property}`]}};class gk extends aR{run(e,t){throw new Error("Method not implemented.")}constructor(){super(),this.nodeResult=new Map,this.particleInstanceByteSize=0,this.hasRandom=!1}calculateMemoryLayout(e){let t=0;for(let i=0;i<e.length;i++){const n=e[i],s=tR(n),r=iR(n);t=Math.ceil(t/s)*s,t+=r}return t=16*Math.ceil(t/16),t}buildPredefinedStructs(e,t,i){e.push("struct SimulationParams {"),e.push("    delta : f32,"),e.push("    seed : vec4<f32>,"),e.push("}"),e.push("struct Particle {"),e.push("    color: vec4<f32>,"),e.push("    position: vec3<f32>,");const n=t.outputNodes.filter((e=>"particleProperty"===e.definition.name&&"position"!==e.data.property&&"color"!==e.data.property&&"life"!==e.data.property&&"size"!==e.data.property&&"rotation"!==e.data.property&&"age"!==e.data.property)).sort(((e,t)=>iR(e.data.type)-iR(t.data.type)));this.particleInstanceByteSize=this.calculateMemoryLayout([eR.Vec4,eR.Vec3].concat(n.map((e=>e.data.type))).concat([eR.Number,eR.Number,eR.Number,eR.Number])),n.forEach((t=>{e.push(`    ${t.data.property}: ${this.getTypeFromNodeType(t.data.type)},`)})),e.push("    size: f32,"),e.push("    rotation: f32,"),e.push("    life: f32,"),e.push("    age: f32,"),e.push("}"),e.push("struct Particles {"),e.push("    particles : array<Particle>,"),e.push("}")}buildHeader(e,t,i){e.push(xk),this.buildPredefinedStructs(e,t,i),e.push("@binding(0) @group(0) var<uniform> sim_params : SimulationParams;"),e.push("@binding(1) @group(0) var<storage, read_write> data : Particles;"),e.push("@binding(2) @group(0) var<storage, read_write> indexList : array<u32>;"),e.push("@compute @workgroup_size(64)"),e.push("fn simulate(@builtin(global_invocation_id) global_invocation_id : vec3<u32>) {"),e.push("  let invo_id = global_invocation_id.x;"),e.push("  let idx = indexList[invo_id];"),this.hasRandom&&e.push("  init_rand(invo_id, sim_params.seed);"),e.push("  var particle = data.particles[idx];")}buildFooter(e,t,i){e.push("  particle.age += sim_params.delta;"),e.push("  data.particles[idx] = particle;"),e.push("}")}buildWebGPUCode(e,t){const i=[];return this.buildHeader(i,e,t),this.buildDataFlow(e,i,t),this.buildFooter(i,e,t),i.join("\n")}buildDataFlow(e,t,i){for(let n=0;n<e.nodesInOrder.length;n++){const s=e.nodesInOrder[n],r=mk[s.definition.name];if(void 0===r)throw new Error(`Node ${s.id} ${s.definition.name} has no builder`);let o=r.buildBySigIndex[s.signatureIndex];const a=[];for(let e=0;e<s.inputs.length;e++)if(s.inputs[e]instanceof rR){const n=s.inputs[e].input;n instanceof sR?a.push(this.nodeResult.get(n)):a.push(this.buildFromAdapter(n,t,i))}else if(s.inputs[e]instanceof oR);else if(void 0!==s.inputs[e])a.push(this.buildFromValue(s.inputs[e].getValue(i)));else if(s.definition.type!==hR.Storage)throw new Error(`Node ${s.id} misses input on index ${e}`);const l=o(s,a,i);1===s.outputs.length?s.definition.type===hR.Storage?(a.length>0&&t.push(`${l} = ${a[0]};`),this.nodeResult.set(s,l)):s.outputs[0].length>1?(t.push(`let v${t.length} = ${l};`),this.nodeResult.set(s,"v"+(t.length-1))):s.outputs[0].length>0&&this.nodeResult.set(s,l):s.outputs.length}}build(e,t){return e.compiled||this.buildExecutionOrder(e,t),this.buildWebGPUCode(e,t)}buildFromValue(e){if("number"==typeof e)return""+e;if(e instanceof r)return`vec2<f32>(${e.x}, ${e.y})`;if(e instanceof i)return`vec3<f32>(${e.x}, ${e.y}, ${e.z})`;if(e instanceof y)return`vec4<f32>(${e.x}, ${e.y}, ${e.z}, ${e.w})`;throw new Error("Unknown value type "+typeof e)}getTypeFromNodeType(e){switch(e){case eR.Number:return"f32";case eR.Vec2:return"vec<f32>";case eR.Vec3:return"vec3<f32>";case eR.Vec4:return"vec4<f32>";default:throw new Error(`Unknown node value type ${e}`)}}buildFromAdapter(e,t,i){if(e.isInput)switch(e.node.definition.type){case hR.Storage:for(let n=0;n<vk.get(e.type);n++)if(e.inputs[n]instanceof rR){const s=mk[e.node.definition.name].buildBySigIndex[e.node.signatureIndex];i.param=yk[n],t.push(s(e.node,[this.getResult(e.inputs[n])],i))}break;case hR.Variable:case hR.Expression:let n="";for(let t=0;t<vk.get(e.type)-1;t++)n=this.getResult(e.inputs[t])+", ";n+=this.getResult(e.inputs[vk.get(e.type)-1]),t.push(`${this.getTypeFromNodeType(e.type)}(${n})`)}return""}getResult(e){const t=e.input;if(t instanceof oR){if(t.isInput)throw new Error(`node ${t.node.id}'s output adapter has to be output`);return this.nodeResult.get(t.node)+"."+yk[t.outputs.findIndex((t=>t.includes(e)))]}return this.nodeResult.get(t)}}const vk=new Map([[eR.Vec2,2],[eR.Vec3,3],[eR.Vec4,4]]),yk=["x","y","z","w"],xk="\nvar<private> rand_seed : vec2<f32>;\n\nfn init_rand(invocation_id : u32, seed : vec4<f32>) {\n  rand_seed = seed.xz;\n  rand_seed = fract(rand_seed * cos(35.456+f32(invocation_id) * seed.yw));\n  rand_seed = fract(rand_seed * cos(41.235+f32(invocation_id) * seed.xw));\n}\n\nfn rand() -> f32 {\n  rand_seed.x = fract(cos(dot(rand_seed, vec2<f32>(23.14077926, 232.61690225))) * 136.8168);\n  rand_seed.y = fract(cos(dot(rand_seed, vec2<f32>(54.47856553, 345.84153136))) * 534.7645);\n  return rand_seed.y;\n}\n";class wk{constructor(e={}){var t,i,n,s,r,o;this.type="cube",this.currentValue=0,this.width=null!==(t=e.width)&&void 0!==t?t:10,this.height=null!==(i=e.height)&&void 0!==i?i:10,this.thickness=null!==(n=e.thickness)&&void 0!==n?n:10,this.mode=null!==(s=e.mode)&&void 0!==s?s:CI.Random,this.spread=null!==(r=e.spread)&&void 0!==r?r:0,this.speed=null!==(o=e.speed)&&void 0!==o?o:new CB(1),this.emissionState=e.emissionState}update(e,t){CI.Random!=this.mode&&(this.currentValue+=this.speed.genValue(e.emissionState.time/e.duration)*t)}initialize(e){const t=AI(this.mode,this.currentValue,this.spread,this.emissionState);e.position.x=t,e.position.y=Math.random(),e.position.z=Math.random(),e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.x=(2*e.position.x-1)*this.width,e.position.y=(2*e.position.y-1)*this.height,e.position.z=(2*e.position.z-1)*this.thickness}toJSON(){return{type:"cube",width:this.width,height:this.height,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new wk({width:e.width,height:e.height,thickness:e.thickness,mode:e.mode,speed:e.speed?PB(e.speed):void 0,spread:e.spread})}clone(){return new wk({width:this.width,height:this.height,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class bk{constructor(e){var t,i,n,s;this.type="path",this.paths=null!==(t=e.paths)&&void 0!==t?t:[[0,0,0],[10,0,0]],this.mode=null!==(i=e.mode)&&void 0!==i?i:CI.Random,this.spread=null!==(n=e.spread)&&void 0!==n?n:0,this.speed=null!==(s=e.speed)&&void 0!==s?s:new CB(1)}update(e,t){}initialize(e){let t=o.randInt(0,this.paths.length),n=new i(...this.paths[t]);t+1>=this.paths.length&&(t-=1);let s=new i(...this.paths[t+1]);e.position.copy(n.lerp(s,Math.random())),e.velocity.set(0,0,e.startSpeed)}toJSON(){return{type:"path",paths:this.paths,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new bk({paths:e.paths,mode:e.mode,speed:e.speed?PB(e.speed):void 0,spread:e.spread})}clone(){return new bk({paths:this.paths,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}new i(0,0,1);class _k{constructor(e){this.type="SetEmitDirection",this._temp=new i,this._q=new v,this.opts=e,this.velocityX=e.velocityX?e.velocityX.genValue():0,this.velocityY=e.velocityY?e.velocityY.genValue():0,this.velocityZ=e.velocityZ?e.velocityZ.genValue():0}initialize(e){e.velocity.set(this.velocityX,this.velocityY,this.velocityZ)}update(e,t){}frameUpdate(e){}toJSON(){return{type:this.type,velocity:{velocityX:this.velocityX,velocityY:this.velocityY,velocityZ:this.velocityZ}}}static fromJSON(e){return new _k(e.velocity)}clone(){return new _k(this.opts)}reset(){}}class Sk{constructor(e,t){this.type="ApplyRoute",this._allDistance=0,this._segmentDist=[],this._nextPoint=[0,0,0],this._time=0,this._curtime=0,this.paths=e,this._time=null!=t?t:0;for(let e=0;e<this.paths.length-1;e++){let t=HW(this.paths[e],this.paths[e+1]);this._allDistance+=t,this._segmentDist.push(t)}}initialize(e){this._time=this._time||e.life,this.update(e,0)}update(e,t){let i=e.__routePtIndex||0,n=this._curtime/this._time,s={nextPoint:this._nextPoint,distance:this._allDistance,segmentDist:this._segmentDist,curRetIndex:0},r=YW(this.paths,n,s),o=r[r.length-1];i!=s.curRetIndex&&(o=r[s.curRetIndex]),e.position.set(...o),e.velocity.set(this._nextPoint[0]-o[0],this._nextPoint[1]-o[1],this._nextPoint[2]-o[2]),e.__routePtIndex=s.curRetIndex}frameUpdate(e){this._curtime+=e,this._curtime>this._time&&this._time>0&&(this._curtime=this._curtime%this._time)}toJSON(){return{type:this.type,paths:this.paths,time:this._time}}static fromJSON(e){return new Sk(e.paths,e.time)}clone(){return new Sk(this.paths,this._time)}reset(){this._curtime=0}}var Mk;nB(),function(e){e[e.NoExist=0]="NoExist",e[e.Loading=1]="Loading",e[e.LoadFinish=2]="LoadFinish",e[e.LoadError=3]="LoadError"}(Mk||(Mk={}));class Ck{constructor(e){this.path="",this.loaderUrlPath="",this.signal={beforeLoad:new cy,loading:new cy,detailLoading:new cy,detailLoaded:new cy,loaded:new cy},this.imageLoader=new Wt,this.videoLoader=new XD,this.gltfLoader=new zi,this.objLoader=new Ui,this.mtlLoader=new Hi,this.videlLoader=new XD,this.hdrLoader=new Gi,this.fbxLoader=new ki,this.ddsLoader=new Ni,this.dracoLoader=new ji,this.ktx2Loader=new Vi,this.svgLoader=new Wi,this.fileLoader=new Gt,this.particleLoader=new ZI,this.resourceMap=new Map,this.loadDetailMap={},this.gltfLoader.setDRACOLoader(this.dracoLoader),this.gltfLoader.setKTX2Loader(this.ktx2Loader),this.gltfLoader.setMeshoptDecoder(Fi),this.loaderMap={webp:this.imageLoader,jpg:this.imageLoader,png:this.imageLoader,jpeg:this.imageLoader,obj:this.objLoader,mtl:this.mtlLoader,mp4:this.videoLoader,webm:this.videoLoader,ogg:this.videoLoader,hdr:this.hdrLoader,gltf:this.gltfLoader,glb:this.gltfLoader,fbx:this.fbxLoader,dds:this.ddsLoader,svg:this.svgLoader,particle:this.particleLoader,img:this.imageLoader,json:this.fileLoader,ktx2:this.ktx2Loader},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}setPath(e){return this.path=e,this}setRequestHeader(e){return Object.values(this.loaderMap).forEach((t=>{t.setRequestHeader(e)})),this}setResponseType(e){return Object.values(this.loaderMap).forEach((t=>{t.setResponseType&&t.setResponseType(e)})),this}getLoader(e){if(this.loaderMap[e]){let t=this.loaderMap[e];return t&&t.setPath(this.path),t}return null}load(e,t,i,n,s,r){var o,a,l;let h=e;const c=Array.isArray(h);Array.isArray(h)||(h=[h]);const d=this.resourceMap,u=this.loaderMap,p=this.loadDetailMap,f=[],m=[],g=[];h.forEach((()=>{f.push(void 0),m.push(void 0),g.push(void 0)}));const v=h.length;let y=0,x=0;const w=(e,t,i)=>v===y+x&&(this.signal.loaded.dispatch({url:e,detail:t,index:i,loadTotal:v,loadSuccessCount:y,loadErrorCount:x,context:{events:f,errors:m,resources:g}}),!0),b=(e,t,i,n)=>{t.message=`url: ${e} fetch error.`+n,t.error=!0,p[e]=t,m[i]=t.message,x+=1,this.signal.detailLoaded.dispatch({url:e,detail:t,index:i,loadTotal:v,loadSuccessCount:y,loadErrorCount:x,context:{events:f,errors:m,resources:g}}),this.signal.loading.dispatch({url:e,detail:t,index:i,loadTotal:v,loadSuccessCount:y,loadErrorCount:x,context:{events:f,errors:m,resources:g}}),w(e,t,i)&&s&&s(c?m:m[0])},_=(e,t,n,s)=>{t.progress=1,p[e]=t,y+=1,g[n]=s,this.signal.detailLoaded.dispatch({url:e,detail:t,index:n,loadTotal:v,loadSuccessCount:y,loadErrorCount:x,context:{events:f,errors:m,resources:g}}),this.signal.loading.dispatch({url:e,detail:t,index:n,loadTotal:v,loadSuccessCount:y,loadErrorCount:x,context:{events:f,errors:m,resources:g}}),w(e,t,n)&&i(i&&c?g:g[0])};for(let e=0;e<h.length;e++){const i=h[e];let s,w;"string"==typeof i?(s=i,w=(null===(o=s.split(".").pop())||void 0===o?void 0:o.toLocaleLowerCase())||""):(s=i.url,w=i.ext.toLocaleLowerCase(),w.startsWith(".")&&(w=w.slice(1))),"string"==typeof r?w=r:Array.isArray(r)&&r.length>=h.length&&(w=r[e]);const S={url:s,progress:0,error:!1,message:s};if(this.signal.beforeLoad.dispatch({url:s,detail:S,index:e,loadTotal:v,loadSuccessCount:y,loadErrorCount:x,context:{events:f,errors:m,resources:g}}),p[s]=S,t&&d.has(s)){_(s,S,e,d[s]);continue}if(!w){b(s,S,e,`url: ${s} file ext is empty.`);continue}const M=u[w];if(!M){b(s,S,e,`url: ${s} not support this format。`);continue}const C=s.replace(/\\/g,"/").split("/"),A=C.pop(),E=this.path+C.join("/")+"/";M!=this.ktx2Loader&&M!=this.gltfLoader||(null===(a=null==Cy?void 0:Cy.app)||void 0===a?void 0:a.renderer)&&!this.ktx2Loader.workerConfig&&this.ktx2Loader.detectSupport(null===(l=null==Cy?void 0:Cy.app)||void 0===l?void 0:l.renderer),M.loadAsync(E+A,(t=>{f[e]=t,S.progress=Number((t.loaded/t.total).toFixed(2)),this.signal.detailLoading.dispatch({url:s,detail:S,index:e,loadTotal:v,loadSuccessCount:y,loadErrorCount:x,context:{events:f,errors:m,resources:g}}),n&&n(c?f:t[0])})).then((i=>{t&&this.resourceMap.set(s,i),_(s,S,e,i)})).catch((t=>{b(s,S,e,JSON.stringify(t))}))}return this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getResourceStatus(e){const t=this.loadDetailMap[e];return t?t.error?Mk.LoadError:1===t.progress?Mk.LoadFinish:Mk.Loading:Mk.NoExist}getLoadDetail(e){return this.loadDetailMap[e]}getLoadDetailMap(){return this.loadDetailMap}setLoaderPath(e){var t,i,n;this.loaderUrlPath=e,this.dracoLoader.setDecoderPath(this.loaderUrlPath+"draco/gltf/"),this.ktx2Loader.setTranscoderPath(this.loaderUrlPath+"basis/"),(null===(t=null==Cy?void 0:Cy.app)||void 0===t?void 0:t.renderer)&&!this.ktx2Loader.workerConfig&&this.ktx2Loader.detectSupport(null===(i=null==Cy?void 0:Cy.app)||void 0===i?void 0:i.renderer);for(let e in this.loaderMap){let t=this.loaderMap[e];if(t&&t.userData&&t.userData.libraryPath){let e=t.userData.libraryPath.split(":");2==e.length&&e[0]in t&&t[e[0]](this.loaderUrlPath+e[1])}else t&&"ifc"==e&&(null===(n=null==t?void 0:t.ifcManager)||void 0===n?void 0:n.setWasmPath)&&t.ifcManager.setWasmPath(this.loaderUrlPath+"web-ifc/",!0)}}dispose(){return this.resourceMap.clear(),this}loadExtensionLoader(){return Qv(this,void 0,void 0,(function*(){let e=yield Zk.loadPlugin("loader");if(!e)return;let t={},i=["Rhino3dmLoader","3dm","setLibraryPath","rhino3dm/","FontLoader","font","","","LUT3dlLoader","lut3dl","","","TiltLoader","tilt","","","ThreeMFLoader","3mf","","","GCodeLoader","gcode","","","LUTCubeLoader","lutcube","","","MaterialXLoader","materialx","","","RGBELoader","hdr","","","USDZLoader","usdz","","","AMFLoader","amf","","","LWOLoader","lwo","","","NRRDLoader","nrrd","","","STLLoader","stl","","","VOXLoader","vox","","","BVHLoader","bvh","","","HDRCubeTextureLoader","hdrcube","","","LogLuvLoader","logluv","","","OBJLoader","obj","","","VRMLLoader","wrl","","","ColladaLoader","dae","","","IESLoader","ies","","","LottieLoader","lottie","","","PCDLoader","pcd","","","TDSLoader","3ds","","","VTKLoader","vtk","","","KMZLoader","kmz","","","MD2Loader","md2","","","PDBLoader","pdb","","","TGALoader","tga","","","XYZLoader","xyz","","","MDDLoader","mdd","","","PLYLoader","ply","","","TIFFLoader","tif","","","EXRLoader","exr","","","LDrawLoader","mpd","","","MMDLoader","mmd","","","PVRLoader","pvr","","","TTFLoader","ttf","",""];for(let n=0;n<i.length;n+=4){let s=i[n],r=i[n+1];if(e[s]&&r&&!(r in t)){let o=new e[s],a=i[n+2],l=i[n+3];a&&l&&a in o&&(o[a](this.loaderUrlPath+l),o.userData={libraryPath:`${a}:${l}`}),"IFCLoader"==s&&(yield o.ifcManager.setWasmPath(this.loaderUrlPath+"web-ifc/",!0),yield o.ifcManager.parser.setupOptionalCategories({3856911033:!1}),yield o.ifcManager.applyWebIfcConfig({USE_FAST_BOOLS:!0})),t[r]=o}}for(let e in t)this.loaderMap[e]=t[e]}))}loadExtensionIfcLoader(e){return Qv(this,void 0,void 0,(function*(){let t=yield Zk.loadPlugin("ifcloader");if(!t)return;let i={},n=["IFCLoader","ifc","",""];for(let s=0;s<n.length;s+=4){let r=n[s],o=n[s+1];if(t[r]&&o&&!(o in i)){let n=new t[r];yield n.ifcManager.setWasmPath(this.loaderUrlPath+"web-ifc/",!0),yield n.ifcManager.parser.setupOptionalCategories(Object.assign({3856911033:!1},null==e?void 0:e.setupOptionalCategoriesOpts)),yield n.ifcManager.applyWebIfcConfig(Object.assign({USE_FAST_BOOLS:!0},null==e?void 0:e.applyWebIfcConfigOpts)),i[o]=n}}for(let e in i)this.loaderMap[e]=i[e]}))}}function Ak(e,t,i){if(!e)return;const n=e.isMesh;if(!0!==t){if(n)return new FP(e);if(!0===i&&e.isGroup&&1==e.children.length&&e.children[0].isMesh){let t=e.children[0];return t.quaternion.premultiply(e.quaternion),t.scale.multiply(e.scale),t.position.add(e.position),new FP(t)}return UP.fromObject3d(e)}let s=n?new FP(e):UP.fromObject3d(e);const r=[...e.children],o=r.length;for(let e=0;e<o;e++){const n=Ak(r[e],t,i);n&&s.addChildEntity(n)}return s}const Ek=(e,t)=>{for(;;){if(e._owner_entity){if(!t)return e._owner_entity;if(!e._owner_entity.parent&&"Scene"!==e._owner_entity.node.type)return e._owner_entity}if(!e.parent)return;e=e.parent}};function Tk(e){if(e.isObject3D&&(e=Ek(e)),e){if(e._ownerScene)return e._ownerScene;for(;e&&e.parent;)if((e=e.parent)._ownerScene)return e._ownerScene}}const Pk=e=>{let t=[];for(;e.parent;)t.push(e),e=e.parent;return t},Ok=function(){var e,t,i={};void 0===i.btoa&&(i.btoa=(e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),function(t){var i,n,s,r,o,a,l;for(n=s=0,r=t.length,a=(r-=o=r%3)/3<<2,o>0&&(a+=4),i=new Array(a);n<r;)l=t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<8|t.charCodeAt(n++),i[s++]=e[l>>18]+e[l>>12&63]+e[l>>6&63]+e[63&l];return 1==o?(l=t.charCodeAt(n++),i[s++]=e[l>>2]+e[(3&l)<<4]+"=="):2==o&&(l=t.charCodeAt(n++)<<8|t.charCodeAt(n++),i[s++]=e[l>>10]+e[l>>4&63]+e[(15&l)<<2]+"="),i.join("")})),void 0===i.atob&&(i.atob=(t=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],function(e){var i,n,s,r,o,a,l,h,c,d;if((l=e.length)%4!=0)return"";if(/[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\+\/\=]/.test(e))return"";for(c=l,(h="="==e.charAt(l-2)?1:"="==e.charAt(l-1)?2:0)>0&&(c-=4),c=3*(c>>2)+h,d=new Array(c),o=a=0;o<l&&-1!=(i=t[e.charCodeAt(o++)])&&-1!=(n=t[e.charCodeAt(o++)])&&(d[a++]=String.fromCharCode(i<<2|(48&n)>>4),-1!=(s=t[e.charCodeAt(o++)]))&&(d[a++]=String.fromCharCode((15&n)<<4|(60&s)>>2),-1!=(r=t[e.charCodeAt(o++)]));)d[a++]=String.fromCharCode((3&s)<<6|r);return d.join("")}));var n=2654435769;function s(e,t){var i=e.length,n=i<<2;if(t){var s=e[i-1];if(s<(n-=4)-3||s>n)return null;n=s}for(var r=0;r<i;r++)e[r]=String.fromCharCode(255&e[r],e[r]>>>8&255,e[r]>>>16&255,e[r]>>>24&255);var o=e.join("");return t?o.substring(0,n):o}function r(e,t){var i,n=e.length,s=n>>2;0!=(3&n)&&++s,t?(i=new Array(s+1))[s]=n:i=new Array(s);for(var r=0;r<n;++r)i[r>>2]|=e.charCodeAt(r)<<((3&r)<<3);return i}function o(e){return 4294967295&e}function a(e,t,i,n,s,r){return(i>>>5^t<<2)+(t>>>3^i<<4)^(e^t)+(r[3&n^s]^i)}function l(e){return e.length<4&&(e.length=4),e}function h(e){if(/^[\x00-\x7f]*$/.test(e))return e;for(var t=[],i=e.length,n=0,s=0;n<i;++n,++s){var r=e.charCodeAt(n);if(r<128)t[s]=e.charAt(n);else if(r<2048)t[s]=String.fromCharCode(192|r>>6,128|63&r);else{if(!(r<55296||r>57343)){if(n+1<i){var o=e.charCodeAt(n+1);if(r<56320&&56320<=o&&o<=57343){var a=65536+((1023&r)<<10|1023&o);t[s]=String.fromCharCode(240|a>>18&63,128|a>>12&63,128|a>>6&63,128|63&a),++n;continue}}throw new Error("Malformed string")}t[s]=String.fromCharCode(224|r>>12,128|r>>6&63,128|63&r)}}return t.join("")}function c(e,t){return(null==t||t<0)&&(t=e.length),0===t?"":/^[\x00-\x7f]*$/.test(e)||!/^[\x00-\xff]*$/.test(e)?t===e.length?e:e.substr(0,t):t<32767?function(e,t){for(var i=new Array(t),n=0,s=0,r=e.length;n<t&&s<r;n++){var o=e.charCodeAt(s++);switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i[n]=o;break;case 12:case 13:if(!(s<r))throw new Error("Unfinished UTF-8 octet sequence");i[n]=(31&o)<<6|63&e.charCodeAt(s++);break;case 14:if(!(s+1<r))throw new Error("Unfinished UTF-8 octet sequence");i[n]=(15&o)<<12|(63&e.charCodeAt(s++))<<6|63&e.charCodeAt(s++);break;case 15:if(!(s+2<r))throw new Error("Unfinished UTF-8 octet sequence");var a=((7&o)<<18|(63&e.charCodeAt(s++))<<12|(63&e.charCodeAt(s++))<<6|63&e.charCodeAt(s++))-65536;if(!(0<=a&&a<=1048575))throw new Error("Character outside valid Unicode range: 0x"+a.toString(16));i[n++]=a>>10&1023|55296,i[n]=1023&a|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+o.toString(16))}}return n<t&&(i.length=n),String.fromCharCode.apply(String,i)}(e,t):function(e,t){for(var i=[],n=new Array(32768),s=0,r=0,o=e.length;s<t&&r<o;s++){var a=e.charCodeAt(r++);switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n[s]=a;break;case 12:case 13:if(!(r<o))throw new Error("Unfinished UTF-8 octet sequence");n[s]=(31&a)<<6|63&e.charCodeAt(r++);break;case 14:if(!(r+1<o))throw new Error("Unfinished UTF-8 octet sequence");n[s]=(15&a)<<12|(63&e.charCodeAt(r++))<<6|63&e.charCodeAt(r++);break;case 15:if(!(r+2<o))throw new Error("Unfinished UTF-8 octet sequence");var l=((7&a)<<18|(63&e.charCodeAt(r++))<<12|(63&e.charCodeAt(r++))<<6|63&e.charCodeAt(r++))-65536;if(!(0<=l&&l<=1048575))throw new Error("Character outside valid Unicode range: 0x"+l.toString(16));n[s++]=l>>10&1023|55296,n[s]=1023&l|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+a.toString(16))}if(s>=32766){var h=s+1;n.length=h,i[i.length]=String.fromCharCode.apply(String,n),t-=h,s=-1}}return s>0&&(n.length=s,i[i.length]=String.fromCharCode.apply(String,n)),i.join("")}(e,t)}function d(e,t){return null==e||0===e.length?e:(e=h(e),t=h(t),s(function(e,t){var i,s,r,l,h,c,d=e.length,u=d-1;for(s=e[u],r=0,c=0|Math.floor(6+52/d);c>0;--c){for(l=(r=o(r+n))>>>2&3,h=0;h<u;++h)i=e[h+1],s=e[h]=o(e[h]+a(r,i,s,h,l,t));i=e[0],s=e[u]=o(e[u]+a(r,i,s,u,l,t))}return e}(r(e,!0),l(r(t,!1))),!1))}function u(e,t){return null==e||0===e.length?e:(t=h(t),c(s(function(e,t){var i,s,r,l,h,c=e.length,d=c-1;for(i=e[0],r=o(Math.floor(6+52/c)*n);0!==r;r=o(r-n)){for(l=r>>>2&3,h=d;h>0;--h)s=e[h-1],i=e[h]=o(e[h]-a(r,i,s,h,l,t));s=e[d],i=e[0]=o(e[0]-a(r,i,s,0,l,t))}return e}(r(e,!1),l(r(t,!1))),!0)))}return{utf8Encode:h,utf8Decode:c,encrypt:d,encryptToBase64:function(e,t){return i.btoa(d(e,t))},encryptToBase64Url:function(e,t){return i.btoa(d(e,t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},decrypt:u,decryptFromBase64:function(e,t){return null==e||0===e.length?e:u(i.atob(e),t)},decryptFromBase64Url:function(e,t){return null==e||0===e.length?e:u(i.atob(((n=e)+"===".slice((n.length+3)%4)).replace(/-/g,"+").replace(/_/g,"/")),t);var n}}}(),Dk=[35,94,118,106,109,97,112,95,99,111,109,42,64].map((e=>String.fromCodePoint(e))).join("");function Bk(e){return Ok.encryptToBase64Url(e,Dk)}function Ik(e){return Ok.decryptFromBase64Url(e,Dk)}var Rk;!function(e){e.Memory="Memory",e.GeomRender="GeomRender"}(Rk||(Rk={}));const kk={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",PATCH:"PATCH",OPTIONS:"OPTIONS",HEAD:"HEAD"},Lk={READY_STATE_CHANGE:"readystatechange",LOAD_START:"loadstart",PROGRESS:"progress",ABORT:"abort",ERROR:"error",LOAD:"load",TIMEOUT:"timeout",LOAD_END:"loadend"},zk={method:kk.GET,data:void 0,headers:{Accept:"application/json","Content-Type":"application/json"},dump:JSON.stringify,load:JSON.parse,xmlHttpRequest:()=>new XMLHttpRequest,promise:e=>new Promise(e),withCredentials:!1},Uk=(e,t)=>({status:e.status,response:e.response,data:t,xhr:e});let Fk=Object.assign({},zk);const Nk=e=>((e,t)=>(e&&e.promise?e.promise:Fk.promise||zk.promise)(t))(e,((t,i)=>{const n=Object.assign(Object.assign(Object.assign({},zk),Fk),e),s=n.xmlHttpRequest();if(n.abort&&"function"==typeof e.abort&&e.abort((()=>{i(Uk(s)),s.abort()})),void 0===n.url)throw new Error("No URL defined");s.open(n.method,n.params?`${n.url.split("?")[0]}?${new URLSearchParams(n.params)}`:n.url,!0),s.withCredentials=n.withCredentials,s.addEventListener(Lk.LOAD,(()=>{if(s.status>=200&&s.status<300){let e;s.responseText&&(e=!0===n.raw?s.responseText:n.load(s.responseText)),t(Uk(s,e))}else i(Uk(s))})),s.addEventListener(Lk.ABORT,(()=>i(Uk(s)))),s.addEventListener(Lk.ERROR,(()=>i(Uk(s)))),s.addEventListener(Lk.TIMEOUT,(()=>i(Uk(s))));for(const e in n.headers)({}).hasOwnProperty.call(n.headers,e)&&s.setRequestHeader(e,n.headers[e]);if(n.events)for(const e in n.events)({}).hasOwnProperty.call(n.events,e)&&s.addEventListener(e,n.events[e].bind(null,s),!1);const r="object"!=typeof n.data||n.raw?n.data:n.dump(n.data);void 0!==r?s.send(r):s.send()})),jk={configure:e=>{Fk=Object.assign(Object.assign({},Fk),e)},event:Lk,methods:kk,rqeust:Nk,get:(e,t,i)=>Nk(Object.assign({url:e,method:kk.GET,params:t},i)),put:(e,t,i)=>Nk(Object.assign({url:e,method:kk.PUT,data:t},i)),post:(e,t,i)=>Nk(Object.assign({url:e,method:kk.POST,data:t},i)),patch:(e,t,i)=>Nk(Object.assign({url:e,method:kk.PATCH,data:t},i)),del:(e,t)=>Nk(Object.assign({url:e,method:kk.DELETE},t)),options:(e,t)=>Nk(Object.assign({url:e,method:kk.OPTIONS},t))};class Vk{constructor(e,t,i){this.serverUrl="",this.accessToken="",this._reqImpl=jk,this._svr_url_map="",this._svr_url_service="","/"!==e.slice(-1)&&(e+="/"),this.serverUrl=e,this.accessToken=null!=t?t:"",this._svr_url_service=this.serverUrl+"service/",0!=e.indexOf("/api")&&(this._svr_url_map=this.serverUrl+"map/"),i&&"function"==typeof i.get&&"function"==typeof i.post&&"function"==typeof i.del&&(this._reqImpl=i);let n=!0;4==arguments.length&&"object"==typeof arguments[3]&&!1===arguments[3].getSprite&&(n=!1),"object"==typeof window&&n&&(window.__has_getsprite||(window.__has_getsprite=!0,setTimeout((()=>Qv(this,void 0,void 0,(function*(){var e,t,i,n;if(window.navigator&&window.navigator.onLine)try{let s={};const r=`${this._url("activate")}/user`;if(s=yield this._get(r,{}),s&&"data"in s){let r=s.data;if(r&&r.uid){let s=null!==(e=r.uid)&&void 0!==e?e:"",o=null!==(t=r.pid)&&void 0!==t?t:"",a=null!==(i=r.tid)&&void 0!==i?i:"",l=null!==(n=r.trial)&&void 0!==n&&n,h="";"object"==typeof document&&document.title&&(h=document.title.substr(0,16));let c=Bk(`u:${s}__p:${o}__m:${a}__r:${l}__t:${h}`);const d=new Image(1,1);let u="";[104,116,116,112,115,58,47,47,118,106,109,97,112,46,99,111,109,47,115,101,114,118,101,114,47,115,112,114,105,116,101,46,112,110,103].forEach((e=>{u+=String.fromCharCode(e)})),d.src=u+"?id="+c}}}catch(e){}}))),12e5)))}_url(e){return`${this._svr_url_map}${e}`}clone(e){var t;let i=new Vk(this.serverUrl,this.accessToken,this._reqImpl);return i._secretKeys=this._secretKeys,!1!==e&&i.switchWorkspace(null!==(t=this._workspaceName)&&void 0!==t?t:""),i}serviceUrl(e){return`${this._svr_url_service}${e}`}switchWorkspace(e){e=e.trim(),this._workspaceName=e,this._svr_url_map=""!=e?this.serverUrl+"workspace/"+e+"/":this.serverUrl+"map/"}getCurWorkspaceName(){var e;return null!==(e=this._workspaceName)&&void 0!==e?e:""}getWorkspaces(){return Qv(this,void 0,void 0,(function*(){let e=this.serviceUrl("getWorkspace"),t={};if(t=yield this._get(e),t&&"data"in t)return t.data}))}workspaceCreate(e){var t,i,n;return Qv(this,void 0,void 0,(function*(){let s=this.serviceUrl("workspaceCreate"),r=yield this._post(s,{name:e.name,alias:null!==(t=e.alias)&&void 0!==t?t:"",workDir:null!==(i=e.workDir)&&void 0!==i?i:"",isPublic:null===(n=e.isPublic)||void 0===n||n});if(r&&"data"in r)return r.data}))}workspaceModify(e){var t,i;return Qv(this,void 0,void 0,(function*(){let n=this.serviceUrl("workspaceModify"),s=yield this._post(n,{name:e.name,alias:null!==(t=e.alias)&&void 0!==t?t:"",isPublic:null===(i=e.isPublic)||void 0===i||i});if(s&&"data"in s)return s.data}))}workspaceDelete(e){return Qv(this,void 0,void 0,(function*(){let t=this.serviceUrl(`workspaceDelete/${e}`),i={};if(i=yield this._del(t),i&&"data"in i)return i.data}))}pwdToSecretKey(e){return""==e||18==e.length&&"ak"==e.substr(0,2)?e:this.strMd5(this.strMd5(this.strMd5(this.strMd5(e)))).substr(0,16)}addSecretKey(e){if(18==e.length&&"ak"==e.substr(0,2))return this.addAccessKey(e);if(e.length<16&&(e=this.pwdToSecretKey(e)),this._secretKeys=this._secretKeys||new Set,""!=e){if(this._secretKeys.size>=100){let e=Array.from(this._secretKeys);this._secretKeys.delete(e[0])}this._secretKeys.add(e)}return this._secretKeys}removeSecretKey(e){if(18!=e.length||"ak"!=e.substr(0,2))return e.length<16&&(e=this.pwdToSecretKey(e)),this._secretKeys=this._secretKeys||new Set,""!=e?this._secretKeys.delete(e):null==e&&this._secretKeys.clear(),this._secretKeys;this.removeSecretKey(e)}addAccessKey(e){if(this._accessKeys=this._accessKeys||new Set,""!=e){if(this._accessKeys.size>=100){let e=Array.from(this._accessKeys);this._accessKeys.delete(e[0])}this._accessKeys.add(e)}return this._accessKeys}removeAccessKey(e){this._accessKeys=this._accessKeys||new Set,""!=e?this._accessKeys.delete(e):null==e&&this._accessKeys.clear()}_to_layer_string(e){return"string"==typeof e?e:Array.isArray(e)?0===e.length?"[]":JSON.stringify(e):""}_addTokenHeader(e){var t,i,n;return this.accessToken&&((e=null!=e?e:{}).headers=null!==(t=e.headers)&&void 0!==t?t:{},e.headers.Accept="application/json",e.headers["Content-Type"]="application/json",e.headers.token=this.accessToken),this._secretKeys&&this._secretKeys.size>0&&((e=null!=e?e:{}).headers=null!==(i=e.headers)&&void 0!==i?i:{},e.headers.secretKey=Array.from(this._secretKeys).join("_;_")),this._accessKeys&&this._accessKeys.size>0&&((e=null!=e?e:{}).headers=null!==(n=e.headers)&&void 0!==n?n:{},e.headers.accessKey=Array.from(this._accessKeys).join("_;_")),e}_get(e,t,i){return i=this._addTokenHeader(i),this._reqImpl.get(e,t,i)}_post(e,t,i){return i=this._addTokenHeader(i),this._reqImpl.post(e,t,i)}_del(e,t){return t=this._addTokenHeader(t),this._reqImpl.del(e,t)}toLayerIndex(e,t){const i=[];for(const n of e)i.push(t.findIndex((e=>e.name===n)));return i}_waitOpenMap(e,t,i){var n,s,r,o,a,l;return Qv(this,void 0,void 0,(function*(){if(t&&"data"in t){if(403==t.data.status){e.secretKey&&this.removeSecretKey(e.secretKey),e.accessKey&&this.removeAccessKey(e.accessKey);let n=t.data.isPasswordError;e.tryPasswordCount=(e.tryPasswordCount||0)+1;let s="";return"function"==typeof e.cbInputPassword?s=yield e.cbInputPassword({mapid:e.mapid,isPasswordError:n,tryPasswordCount:e.tryPasswordCount,result:t}):e.tryPasswordCount<=3&&(s=prompt(`请输入图 ${e.mapid} 的密码或AccessKey:`,"")),s&&""!=s?(18==s.length&&"ak"==s.substr(0,2)?e.accessKey=s:e.secretKey=this.pwdToSecretKey(s),!0===e._isupdatemap?yield this.updateMap(e,i):yield this.openMap(e,i)):t.data}if(delete e._isupdatemap,e.secretKey&&this.addSecretKey(e.secretKey),e.accessKey&&this.addAccessKey(e.accessKey),this._cur_map_param=null!==(n=t.data)&&void 0!==n?n:{},this._cur_map_param.mapopenway=null!==(s=null==e?void 0:e.mapopenway)&&void 0!==s?s:Rk.GeomRender,this._cur_map_param.darkMode=e.style&&0===e.style.backcolor,i&&this._cur_map_param.mapopenway===Rk.GeomRender&&"working"===(null===(r=t.data)||void 0===r?void 0:r.status)){const t=yield this.waitMapOpenFinish(this._cur_map_param.mapid,this._cur_map_param.version,null!==(o=e.openFinishTryInterval)&&void 0!==o?o:5,null!==(a=e.openFinishMaxTryCount)&&void 0!==a?a:120);if(!t.error)return e.version=null!==(l=e.version)&&void 0!==l?l:t.version,yield this.openMap(e,!1);this._cur_map_param=Object.assign(Object.assign({},this._cur_map_param),t)}return this._cur_map_param}return t}))}setCurrentMapParam(e){var t;return this._cur_map_param=null!==(t=this._cur_map_param)&&void 0!==t?t:{},vv(this._cur_map_param,e),this.currentMapParam()}currentMapParam(){var e;if(!this._cur_map_param)return null;let t=[],i=[];try{Array.isArray(this._cur_map_param.styles)?t=this._cur_map_param.styles:this._cur_map_param.styles&&(t=JSON.parse(this._cur_map_param.styles))}catch(e){}try{Array.isArray(this._cur_map_param.layers)?i=this._cur_map_param.layers:this._cur_map_param.layers&&(i=JSON.parse(this._cur_map_param.layers))}catch(e){}let n={};if(this._cur_map_param.initCenterX&&this._cur_map_param.initCenterY&&this._cur_map_param.bounds){let e=Yb.fromString(this._cur_map_param.bounds),t=new qb(e);if(n.center=t.toLngLat([+this._cur_map_param.initCenterX,+this._cur_map_param.initCenterY]),this._cur_map_param.initZoom){let e=+this._cur_map_param.initZoom;e>=0&&e<=20&&(n.zoom=e)}this._cur_map_param.initBearing&&(n.bearing=+this._cur_map_param.initBearing)}let s=this._cur_map_param.dbBounds?Yb.fromString(this._cur_map_param.dbBounds):null;if(!s){let e=this._cur_map_param.bounds?Yb.fromString(this._cur_map_param.bounds):null;e&&(s=e.scale(this._cur_map_param.initViewScale?+this._cur_map_param.initViewScale:.7,e.center()))}return{mapid:this._cur_map_param.mapid,version:this._cur_map_param.version,layer:this._cur_map_param.layer,mapopenway:"true"===this._cur_map_param.geom?Rk.GeomRender:Rk.Memory,dbid:this._cur_map_param.dbid,fileid:this._cur_map_param.fileid,filename:this._cur_map_param.filename,ucsorg:this._cur_map_param.ucsorg,bounds:this._cur_map_param.bounds?Yb.fromString(this._cur_map_param.bounds):null,mapBounds:this._cur_map_param.mapBounds?Yb.fromString(this._cur_map_param.mapBounds):null,dbBounds:s,drawBounds:this._cur_map_param.drawBounds?Yb.fromString(this._cur_map_param.drawBounds):null,initViewScale:this._cur_map_param.initViewScale?+this._cur_map_param.initViewScale:.7,styles:t,layers:i,status:this._cur_map_param.status,maptype:null!==(e=this._cur_map_param.maptype)&&void 0!==e?e:"",type:this._cur_map_param.type,lineWidthDisplay:void 0!==this._cur_map_param.lineWidthDisplay?"true"===this._cur_map_param.lineWidthDisplay:void 0,uploadname:this._cur_map_param.uploadname,layouts:this._cur_map_param.layouts?this._cur_map_param.layouts.split(", "):null,mapfrom:this._cur_map_param.mapfrom?this._cur_map_param.mapfrom.split("||").map((e=>e.split("&&"))):null,mapdependencies:this._cur_map_param.mapdependencies?this._cur_map_param.mapdependencies.split("||"):null,subfrom:this._cur_map_param.subfrom?this._cur_map_param.subfrom.split("||").map((e=>e.split("&&"))):null,subdependencies:this._cur_map_param.subdependencies?this._cur_map_param.subdependencies.split("||"):null,description:this._cur_map_param.description,renderAccuracy:this._cur_map_param.renderAccuracy,darkMode:this._cur_map_param.darkMode,maxzoom:this._cur_map_param.maxzoom,imageWidth:this._cur_map_param.imageWidth,imageHeight:this._cur_map_param.imageHeight,imageLeft:this._cur_map_param.imageLeft,imageTop:this._cur_map_param.imageTop,imageResolution:this._cur_map_param.imageResolution,createTime:this._cur_map_param.createTime,geomRecordCount:this._cur_map_param.geomRecordCount,isMap3d:"true"===this._cur_map_param.map_is3d||!0===this._cur_map_param.map_is3d,view:n}}openMap(e,t=!0){var i,n,s,r,o,a,l,h,c,d,u,p,f,m,g,v,y,x,w,b;return Qv(this,void 0,void 0,(function*(){const _=!(e.mapopenway===Rk.Memory);let S={};const M=`${this._url("openmap")}/${e.mapid}`;let C=!(!e.fileid&&e.filedoc);if(C){let t=e.style&&null!==(i=e.style.expression)&&void 0!==i?i:"";t&&t.length>100&&(C=!1)}!0===e.httpUsePost&&(C=!1);const A={version:null!==(n=e.version)&&void 0!==n?n:"",layer:null!==(s=e.layer)&&void 0!==s?s:"",geom:_,fileid:null!==(o=null!==(r=e.fileid)&&void 0!==r?r:e.filedoc)&&void 0!==o?o:"",imageLeft:e.imageLeft,imageTop:e.imageTop,imageResolution:e.imageResolution,uploadname:null!==(l=null!==(a=e.uploadname)&&void 0!==a?a:e.filename)&&void 0!==l?l:"",mapfrom:null!==(c=null!==(h=e.mapfrom)&&void 0!==h?h:e.mapfrom)&&void 0!==c?c:"",mapdependencies:null!==(u=null!==(d=e.mapdependencies)&&void 0!==d?d:e.mapdependencies)&&void 0!==u?u:"",subfrom:null!==(f=null!==(p=e.subfrom)&&void 0!==p?p:e.subfrom)&&void 0!==f?f:"",subdependencies:null!==(g=null!==(m=e.subdependencies)&&void 0!==m?m:e.subdependencies)&&void 0!==g?g:"",stylename:e.style&&null!==(v=e.style.name)&&void 0!==v?v:"",layeron:e.style&&null!==(y=this._to_layer_string(e.style.layeron))&&void 0!==y?y:"",layeroff:e.style&&null!==(x=this._to_layer_string(e.style.layeroff))&&void 0!==x?x:"",clipbounds:e.style&&e.style.clipbounds?JSON.stringify("number"==typeof e.style.clipbounds?[e.style.clipbounds,0,0,0]:e.style.clipbounds):"",bkcolor:e.style&&null!==(w=e.style.backcolor)&&void 0!==w?w:"",lineweight:e.style&&e.style.lineweight?JSON.stringify(e.style.lineweight):"",expression:e.style&&null!==(b=e.style.expression)&&void 0!==b?b:""};if(e.renderAccuracy&&(A.renderAccuracy=e.renderAccuracy),e.cadVersion&&(A.cadVersion=e.cadVersion),void 0!==e.open3dview&&(A.map_is3d=!!e.open3dview),e.extData&&(A.extData=JSON.stringify(e.extData,null,0)),e.line_smoothing&&(A.line_smoothing=!0===e.line_smoothing||void 0),e.secretKey&&(A.secretKey=e.secretKey),e.accessKey&&(A.accessKey=e.accessKey),e.layoutIndex&&(A.layoutIndex=e.layoutIndex),e.notUseDefaultTtfFont&&(A.defaultFontName="_default.shx"),e.notUseDefaultShxFont&&(A.defaultShxName="_default_.ttc"),e.notReplaceLineType&&(A.isLoadLineTypes=!1),"object"==typeof e.fontReplaceRule)A.fontReplaceRule=JSON.stringify(e.fontReplaceRule,null,0);else if(e.fontReplaceRule&&"string"==typeof e.fontReplaceRule)try{JSON.parse(e.fontReplaceRule),A.fontReplaceRule=e.fontReplaceRule}catch(e){}return S=C?yield this._get(M,A):yield this._post(M,A),yield this._waitOpenMap(e,S,t)}))}updateMap(e,t=!0){var i,n,s,r,o,a,l,h,c,d,u;return Qv(this,void 0,void 0,(function*(){let p={};const f=`${this._url("updatemap")}/${e.mapid}`;let m=!(!e.fileid&&e.filedoc);if(m){let t=e.style&&null!==(i=e.style.expression)&&void 0!==i?i:"";t&&t.length>100&&(m=!1)}!0===e.httpUsePost&&(m=!1);const g={geom:!(e.mapopenway===Rk.Memory),fileid:null!==(s=null!==(n=e.fileid)&&void 0!==n?n:e.filedoc)&&void 0!==s?s:"",imageLeft:e.imageLeft,imageTop:e.imageTop,imageResolution:e.imageResolution,uploadname:null!==(o=null!==(r=e.uploadname)&&void 0!==r?r:e.filename)&&void 0!==o?o:"",stylename:e.style&&null!==(a=e.style.name)&&void 0!==a?a:"",layeron:e.style&&null!==(l=this._to_layer_string(e.style.layeron))&&void 0!==l?l:"",layeroff:e.style&&null!==(h=this._to_layer_string(e.style.layeroff))&&void 0!==h?h:"",clipbounds:e.style&&e.style.clipbounds?JSON.stringify("number"==typeof e.style.clipbounds?[e.style.clipbounds,0,0,0]:e.style.clipbounds):"",bkcolor:e.style&&null!==(c=e.style.backcolor)&&void 0!==c?c:"",lineweight:e.style&&e.style.lineweight?JSON.stringify(e.style.lineweight):"",renderAccuracy:e.renderAccuracy,expression:e.style&&null!==(d=e.style.expression)&&void 0!==d?d:"",deleteOldVersion:null!==(u=e.deleteOldVersion)&&void 0!==u&&u};return e.renderAccuracy&&(g.renderAccuracy=e.renderAccuracy),e.cadVersion&&(g.cadVersion=e.cadVersion),void 0!==e.open3dview&&(g.map_is3d=!!e.open3dview),e.extData&&(g.extData=JSON.stringify(e.extData,null,0)),e.line_smoothing&&(g.line_smoothing=!0===e.line_smoothing||void 0),e.secretKey&&(g.secretKey=e.secretKey),e.accessKey&&(g.accessKey=e.accessKey),e.notUseDefaultTtfFont&&(g.defaultFontName="_default.shx"),e.notUseDefaultShxFont&&(g.defaultShxName="_default_.ttc"),e.notReplaceLineType&&(g.isLoadLineTypes=!1),"object"==typeof e.fontReplaceRule&&(g.fontReplaceRule=JSON.stringify(e.fontReplaceRule,null,0)),p=m?yield this._get(f,g):yield this._post(f,g),e._isupdatemap=!0,yield this._waitOpenMap(e,p,t)}))}glyphsUrl(){return`${this._svr_url_service}fonts/{fontstack}/{range}.pbf?token=${this.accessToken}`}baseUrl(){let e=this._svr_url_service,t=e.indexOf("api/");return t>0&&(e=e.substr(0,t)),e}spriteUrl(e){return`${this.baseUrl()}sprite/${e}`}setSprite(e){return this._spriteUrl="",e.indexOf(":")>0?this._spriteUrl=e:this._spriteUrl=this.spriteUrl(e),this._spriteUrl}blankTileUrl(){return`${this._svr_url_service}map/tile/blank?token=${this.accessToken}`}qrcodeUrl(e,t){return`${this._svr_url_service}qrcode?content=${encodeURIComponent(e)}&size=${t||""}&token=${this.accessToken}`}rasterTileUrl(e={}){var t,i,n,s,r,o,a,l,h,c;const d=null!==(t=null==e?void 0:e.mapid)&&void 0!==t?t:null===(i=this._cur_map_param)||void 0===i?void 0:i.mapid,u=null!==(r=null!==(n=null==e?void 0:e.version)&&void 0!==n?n:null===(s=this._cur_map_param)||void 0===s?void 0:s.version)&&void 0!==r?r:"v1",p=null!==(o=null==e?void 0:e.layer)&&void 0!==o?o:null===(a=this._cur_map_param)||void 0===a?void 0:a.layer,f=null!==(c=null!==(l=null==e?void 0:e.fileid)&&void 0!==l?l:null===(h=this._cur_map_param)||void 0===h?void 0:h.fileid)&&void 0!==c?c:"";return`${this._url("tile")}/${d}/${u}/${p}/{z}/{x}/{y}?tag=${f}&token=${this.accessToken}`}vectorTileUrl(e={}){var t,i,n,s,r,o,a,l,h,c,d;const u=null!==(t=null==e?void 0:e.mapid)&&void 0!==t?t:null===(i=this._cur_map_param)||void 0===i?void 0:i.mapid,p=null!==(r=null!==(n=null==e?void 0:e.version)&&void 0!==n?n:null===(s=this._cur_map_param)||void 0===s?void 0:s.version)&&void 0!==r?r:"v1",f=null!==(l=null!==(o=null==e?void 0:e.layer)&&void 0!==o?o:null===(a=this._cur_map_param)||void 0===a?void 0:a.layer)&&void 0!==l?l:"main",m=null!==(d=null!==(h=null==e?void 0:e.fileid)&&void 0!==h?h:null===(c=this._cur_map_param)||void 0===c?void 0:c.fileid)&&void 0!==d?d:"";return`${this._url("tile")}/${u}/${p}/${f}/{z}/{x}/{y}.mvt?tag=${m}&token=${this.accessToken}`}checkFileHasUpload(e){return Qv(this,void 0,void 0,(function*(){const t=yield this._get(this._url("mapfile"),{md5:e});return t&&"data"in t?t.data:t}))}uploadUrl(){return this._url("uploads")+`?token=${this.accessToken}`}strMd5(e){return ov.hash(e)}styleVersion(){return 8}fileMd5(e){return new Promise(((t,i)=>{const n=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,s=2097152,r=Math.ceil(e.size/s);let o=0;const a=new ov.ArrayBuffer,l=new FileReader;function h(){var t=o*s,i=t+s>=e.size?e.size:t+s;l.readAsArrayBuffer(n.call(e,t,i))}l.onload=function(e){if(a.append(e.target.result),o++,o<r)h();else{var i=a.end();t(i)}},l.onerror=function(){i("file reader error")},h()}))}uploadMap(e){return new Promise(((t,i)=>Qv(this,void 0,void 0,(function*(){try{const r=yield this.fileMd5(e),o=yield this.checkFileHasUpload(r);if(!0===o.result)o.uploadname=e.name,t(o);else{var n=new FormData;n.append("fileToUpload",e);var s=new XMLHttpRequest;s.addEventListener("load",(i=>{const n=JSON.parse(i.target.responseText);n&&n.uploadname&&(n.uploadname=e.name),t(n)}),!1),s.addEventListener("error",(e=>i(e)),!1),s.addEventListener("abort",(e=>i(e)),!1),s.open("POST",this.uploadUrl()),s.send(n)}}catch(e){i(e)}}))))}execCommand(e,t,i,n,s){var r,o,a,l,h;return Qv(this,void 0,void 0,(function*(){if(i=null!=i?i:null===(r=this._cur_map_param)||void 0===r?void 0:r.mapid,(n=null!==(l=null!=n?n:i==(null===(o=this._cur_map_param)||void 0===o?void 0:o.mapid)?null===(a=this._cur_map_param)||void 0===a?void 0:a.version:"_")&&void 0!==l?l:"_")||(n="_"),!["listmaps"].includes(e)){const e="true"===(null===(h=this._cur_map_param)||void 0===h?void 0:h.geom);!t||"geom"in t&&void 0!==t.geom||(t.geom=e)}let c={};const d=`${this._url("cmd")}/${e}/${i}/${n}`;return c=!0===s?yield this._get(d,t):yield this._post(d,t),c&&"data"in c?c.data:c}))}metadata(e,t){var i,n,s,r;return Qv(this,void 0,void 0,(function*(){e=null!=e?e:null===(i=this._cur_map_param)||void 0===i?void 0:i.mapid,t=null!==(r=null!=t?t:e==(null===(n=this._cur_map_param)||void 0===n?void 0:n.mapid)?null===(s=this._cur_map_param)||void 0===s?void 0:s.version:"_")&&void 0!==r?r:"_";const o=yield this.execCommand("metadata",{},e,t,!0);if(o.styles)try{o.styles=JSON.parse(o.styles)}catch(e){}if(o.layers)try{o.layers=JSON.parse(o.layers)}catch(e){}return o}))}updateMetadata(e,t,i){var n,s,r,o;return Qv(this,void 0,void 0,(function*(){return t=null!=t?t:null===(n=this._cur_map_param)||void 0===n?void 0:n.mapid,i=null!==(o=null!=i?i:t==(null===(s=this._cur_map_param)||void 0===s?void 0:s.mapid)?null===(r=this._cur_map_param)||void 0===r?void 0:r.version:"_")&&void 0!==o?o:"_",yield this.execCommand("updateMetadata",e,t,i,!1)}))}listMaps(e="_",t="_"){return Qv(this,void 0,void 0,(function*(){if(t=t||"_","string"==typeof(e=e||"_")){const i=yield this.execCommand("listmaps",{},e,t,!0);if("_"!==e){const n=i[e];return"*"!==t&&Array.isArray(n)&&1===n.length?n[0]:n}return i}return Array.isArray(e)?yield this.execCommand("listmaps",{mapIds:e},"_",t,!1):yield this.execCommand("listmaps",e,"_",t,!("mapIds"in e))}))}waitMapOpenFinish(e,t,i=5,n=120){return new Promise(((s,r)=>Qv(this,void 0,void 0,(function*(){if("_"===e||""===e||"*"===t)return void s({error:"param error, mapid is empty",status:"error"});let r=1,o=!1;const a=setInterval((()=>Qv(this,void 0,void 0,(function*(){try{if(o)return;if(r++,r>=n)return clearInterval(a),void s({error:"try max times",status:"error"});o=!0;const i=yield this.listMaps(e,t);if(o=!1,!0!==i.geom)return clearInterval(a),void s({error:"is not GeomRender type map",status:"error",version:i.version});if("runerror"===i.status||"error"===i.status)return clearInterval(a),void s({error:i.errmsg,status:"error",version:i.version});"finish"===i.status&&(clearInterval(a),s({status:"finish",version:i.version}))}catch(e){clearInterval(a),s({error:e,status:"error"})}}))),1e3*i)}))))}processQueryResult(e,t){return this._processQueryResult(e,t)}_processQueryResult(e,t){var i,n;const s=e.result,r=e.isgeocoord;let o=null,a=null;const l=this.currentMapParam();if(l&&(o=new qb(l.bounds),!r&&l.mapBounds&&(a=new qb(l.mapBounds))),!r&&Array.isArray(null===(i=e.metadata)||void 0===i?void 0:i.mapBounds)&&(a=new qb(Yb.fromArray(null===(n=e.metadata)||void 0===n?void 0:n.mapBounds)),o=a),s&&s.length>0)for(let i=0;i<s.length;i++){if(!s[i].geojson)continue;const n=s[i];if(!0===n.isMapCoordinate)continue;const l=JSON.parse(n.geojson);let h=!1,c=!1;for(const e in l.geometries)if(Array.isArray(l.geometries[e]))for(const i in l.geometries[e]){const n=l.geometries[e][i];for(const e in n){if(t){let i=t([n[e][0],n[e][1]]);if(i){n[e]=i;continue}}r?o&&(n[e]=o.toLngLat([n[e][0],n[e][1]])):n[e]=a&&o?o.toLngLat(a.fromMercator([n[e][0],n[e][1]])):Qb.mercator2LngLat([n[e][0],n[e][1]])}}else if("Polygon"===l.geometries[e].type)for(let i=0;i<l.geometries[e].coordinates.length;i++){const n=l.geometries[e].coordinates[i];for(const e in n){if(t){let i=t([n[e][0],n[e][1]]);if(i){n[e]=i;continue}}r?o&&(n[e]=o.toLngLat([n[e][0],n[e][1]])):n[e]=a&&o?o.toLngLat(a.fromMercator([n[e][0],n[e][1]])):Qb.mercator2LngLat([n[e][0],n[e][1]])}}else if("Point"===l.geometries[e].type){c=!0;const i=l.geometries[e].coordinates;if(t){let n=t([i[0],i[1]]);if(n){l.geometries[e].coordinates=n;continue}}r?o&&(l.geometries[e].coordinates=o.toLngLat([i[0],i[1]])):l.geometries[e].coordinates=a&&o?o.toLngLat(a.fromMercator([i[0],i[1]])):Qb.mercator2LngLat([i[0],i[1]])}else{h=!0;const i=l.geometries[e].coordinates;for(const e in i){if(t){let n=t([i[e][0],i[e][1]]);if(n){i[e]=n;continue}}r?o&&(i[e]=o.toLngLat([i[e][0],i[e][1]])):i[e]=a&&o?o.toLngLat(a.fromMercator([i[e][0],i[e][1]])):Qb.mercator2LngLat([i[e][0],i[e][1]])}}!h&&n.isEnvelop&&(h=!0),e.result[i].geom=l,e.result[i].isline=h,e.result[i].isPoint=c,!1===e.result[i].isline&&!1===e.result[i].isline&&(e.result[i].isPolygon=!0)}return e}pointQueryFeature(e,t){var i,n,s,r,o,a,l,h,c,d,u;return Qv(this,void 0,void 0,(function*(){const p=yield this.execCommand("queryFeatures",{querytype:"point",zoom:null!==(i=e.zoom)&&void 0!==i?i:1,pixelToGeoLength:null!==(n=e.pixelToGeoLength)&&void 0!==n?n:void 0,layername:null!==(s=null==e?void 0:e.layer)&&void 0!==s?s:null===(r=this._cur_map_param)||void 0===r?void 0:r.layer,x:e.x,y:e.y,pixelsize:null!==(o=e.pixelsize)&&void 0!==o?o:5,condition:null!==(a=e.condition)&&void 0!==a?a:void 0,maxReturnCount:null!==(l=e.limit)&&void 0!==l?l:void 0,maxGeomBytesSize:null!==(h=e.maxGeomBytesSize)&&void 0!==h?h:void 0,fields:null!==(c=e.fields)&&void 0!==c?c:"",geom:null!==(d=e.geom)&&void 0!==d?d:void 0,simplifyTolerance:null!==(u=e.simplifyTolerance)&&void 0!==u?u:void 0,useCache:e.useCache,toMapCoordinate:e.toMapCoordinate},e.mapid,e.version);return this._processQueryResult(p,t)}))}rectQueryFeature(e,t){var i,n,s,r,o,a,l,h,c;return Qv(this,void 0,void 0,(function*(){const d=yield this.execCommand("queryFeatures",{querytype:"rect",zoom:null!==(i=e.zoom)&&void 0!==i?i:1,layername:null!==(n=null==e?void 0:e.layer)&&void 0!==n?n:null===(s=this._cur_map_param)||void 0===s?void 0:s.layer,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,condition:null!==(r=e.condition)&&void 0!==r?r:void 0,maxReturnCount:null!==(o=e.limit)&&void 0!==o?o:void 0,maxGeomBytesSize:null!==(a=e.maxGeomBytesSize)&&void 0!==a?a:void 0,fields:null!==(l=e.fields)&&void 0!==l?l:"",geom:null!==(h=e.geom)&&void 0!==h?h:void 0,simplifyTolerance:null!==(c=e.simplifyTolerance)&&void 0!==c?c:void 0,useCache:e.useCache,toMapCoordinate:e.toMapCoordinate},e.mapid,e.version);return this._processQueryResult(d,t)}))}exprQueryFeature(e,t){var i,n,s,r,o,a,l,h,c;return Qv(this,void 0,void 0,(function*(){const d=yield this.execCommand("queryFeatures",{querytype:"expresion",zoom:null!==(i=e.zoom)&&void 0!==i?i:1,layername:null!==(n=null==e?void 0:e.layer)&&void 0!==n?n:null===(s=this._cur_map_param)||void 0===s?void 0:s.layer,expr:e.expr,beginpos:e.beginpos,maxReturnCount:null!==(r=e.limit)&&void 0!==r?r:void 0,limit:null!==(o=e.limit)&&void 0!==o?o:void 0,fields:null!==(a=e.fields)&&void 0!==a?a:"",useCache:null!==(l=e.useCache)&&void 0!==l&&l,geom:null!==(h=e.geom)&&void 0!==h?h:void 0,simplifyTolerance:null!==(c=e.simplifyTolerance)&&void 0!==c?c:void 0,toMapCoordinate:e.toMapCoordinate},e.mapid,e.version);return this._processQueryResult(d,t)}))}conditionQueryFeature(e,t){var i,n,s,r,o,a,l,h,c,d,u;return Qv(this,void 0,void 0,(function*(){const p=yield this.execCommand("queryFeatures",{querytype:"condition",zoom:null!==(i=e.zoom)&&void 0!==i?i:1,layername:null!==(n=null==e?void 0:e.layer)&&void 0!==n?n:null===(s=this._cur_map_param)||void 0===s?void 0:s.layer,condition:e.condition,beginpos:e.beginpos,maxReturnCount:null!==(r=e.limit)&&void 0!==r?r:void 0,limit:null!==(o=e.limit)&&void 0!==o?o:void 0,includegeom:null!==(a=e.includegeom)&&void 0!==a?a:void 0,realgeom:null!==(l=e.realgeom)&&void 0!==l?l:void 0,isContains:null!==(h=e.isContains)&&void 0!==h?h:void 0,fields:null!==(c=e.fields)&&void 0!==c?c:"",bounds:e.bounds?JSON.stringify(e.bounds):"",geom:null!==(d=e.geom)&&void 0!==d?d:void 0,simplifyTolerance:null!==(u=e.simplifyTolerance)&&void 0!==u?u:void 0,useCache:e.useCache,toMapCoordinate:e.toMapCoordinate},e.mapid,e.version);return this._processQueryResult(p,t)}))}getMapLayers(){var e;let t=null===(e=this._cur_map_param)||void 0===e?void 0:e.layers;if(!t)throw Error("调用此函数前，请确保已通过 openMap 函数打开了地图。");t=JSON.parse(t);const i=[];for(const e of t)i.push({name:e.name,color:e.color,index:e.index,isFrozen:e.isFrozen,isLocked:e.isLocked,isOff:e.isOff,lineWeight:e.lineWeight,linetype:e.linetype||""});return i}cmdSwitchLayers(e,t){return Qv(this,void 0,void 0,(function*(){const i=this.currentMapParam(),n=i&&i.darkMode,s=yield this.execCommand("switchlayer",{visibleLayer:e,darkMode:n,expression:t});return this._cur_map_param&&(this._cur_map_param.layer=s.layerid),s}))}cmdUpdateStyle(e){var t,i,n,s,r,o,a,l,h,c,d,u;return Qv(this,void 0,void 0,(function*(){const p=yield this.execCommand("updateStyle",{stylename:e&&null!==(t=e.name)&&void 0!==t?t:"",layeron:e&&null!==(i=this._to_layer_string(e.layeron))&&void 0!==i?i:"",layeroff:e&&null!==(n=this._to_layer_string(e.layeroff))&&void 0!==n?n:"",clipbounds:e&&e.clipbounds?JSON.stringify("number"==typeof e.clipbounds?[e.clipbounds,0,0,0]:e.clipbounds):"",bkcolor:e&&null!==(s=e.backcolor)&&void 0!==s?s:"",lineweight:e&&e.lineweight?JSON.stringify(e.lineweight):"",expression:e&&null!==(r=e.expression)&&void 0!==r?r:""},null!==(o=e.mapid)&&void 0!==o?o:null===(a=this._cur_map_param)||void 0===a?void 0:a.mapid,null!==(d=null!==(l=e.version)&&void 0!==l?l:e.mapid==(null===(h=this._cur_map_param)||void 0===h?void 0:h.mapid)?null===(c=this._cur_map_param)||void 0===c?void 0:c.version:"_")&&void 0!==d?d:"_");return this._cur_map_param&&(this._cur_map_param.layer=p.layerid),e.mapid&&e.mapid!=(null===(u=this._cur_map_param)||void 0===u?void 0:u.mapid)||void 0!==e.backcolor&&(this._cur_map_param.darkMode=0===e.backcolor),p}))}cmdSliceLayer(e){var t,i,n,s,r,o,a,l;return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("slicelayer",{layer:null!==(t=null==e?void 0:e.layer)&&void 0!==t?t:null===(i=this._cur_map_param)||void 0===i?void 0:i.layer,zoom:e.zoom,ismvt:e.ismvt,iscancel:e.iscancel,isAllCancel:e.isAllCancel,batchnum:e.batchNum,idle_batch_sleepms:e.idleBatchSleepMs,busy_batch_sleepms:e.busyBatchSleepMs},null!==(n=e.mapid)&&void 0!==n?n:null===(s=this._cur_map_param)||void 0===s?void 0:s.mapid,null!==(l=null!==(r=e.version)&&void 0!==r?r:e.mapid==(null===(o=this._cur_map_param)||void 0===o?void 0:o.mapid)?null===(a=this._cur_map_param)||void 0===a?void 0:a.version:"_")&&void 0!==l?l:"_")}))}createStyle(e,t,i,n){var s,r,o,a;return Qv(this,void 0,void 0,(function*(){return n=null==n||n,t=null!=t?t:null===(s=this._cur_map_param)||void 0===s?void 0:s.mapid,i=null!==(a=null!=i?i:t==(null===(r=this._cur_map_param)||void 0===r?void 0:r.mapid)?null===(o=this._cur_map_param)||void 0===o?void 0:o.version:"_")&&void 0!==a?a:"_",Array.isArray(e.layeron)&&(e.layeron=`(${e.layeron.join(",")})`),Array.isArray(e.layeroff)&&(e.layeroff=`(${e.layeroff.join(",")})`),yield this.execCommand("createMapStyle",Object.assign({geom:n},e),t,i)}))}getSliceCacheZoom(e){var t,i,n,s,r,o,a,l;return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("getSliceCacheZoom",{layer:null!==(t=null==e?void 0:e.layer)&&void 0!==t?t:null===(i=this._cur_map_param)||void 0===i?void 0:i.layer,ismvt:e.ismvt},null!==(n=e.mapid)&&void 0!==n?n:null===(s=this._cur_map_param)||void 0===s?void 0:s.mapid,null!==(l=null!==(r=e.version)&&void 0!==r?r:e.mapid==(null===(o=this._cur_map_param)||void 0===o?void 0:o.mapid)?null===(a=this._cur_map_param)||void 0===a?void 0:a.version:"_")&&void 0!==l?l:"_")}))}cmdGetDrawBounds(e,t){var i,n,s,r;return Qv(this,void 0,void 0,(function*(){let o=yield this.execCommand("getDataBounds",{},null!=e?e:null===(i=this._cur_map_param)||void 0===i?void 0:i.mapid,null!==(r=null!=t?t:e==(null===(n=this._cur_map_param)||void 0===n?void 0:n.mapid)?null===(s=this._cur_map_param)||void 0===s?void 0:s.version:"_")&&void 0!==r?r:"_");return o&&o.bounds?Yb.fromString(o.bounds):null}))}getStyleLayerName(e,t,i,n){return Qv(this,void 0,void 0,(function*(){let s=yield this.metadata(e,t);if(!n){i=null==i||i;for(let e=0;e<s.styles.length;e++)if(s.styles[e].isgeom==i&&s.styles[e].issys)return s.styles[e].layername;for(let e=0;e<s.styles.length;e++)if(s.styles[e].isgeom==i)return s.styles[e].layername;return s.styles.length>0?s.styles[0].layername:""}for(let e=0;e<s.styles.length;e++)if(s.styles[e].name==n)return s.styles[e].layername}))}thumbnailUrl(e,t,i,n,s){var r,o,a,l;e=null!=e?e:null===(r=this._cur_map_param)||void 0===r?void 0:r.mapid,t=null!==(l=null!=t?t:e==(null===(o=this._cur_map_param)||void 0===o?void 0:o.mapid)?null===(a=this._cur_map_param)||void 0===a?void 0:a.version:"_")&&void 0!==l?l:"_",i=null!=i?i:100,n=null!=n?n:100;const h=!0===s?"&darkTheme=true":"";return`${this._url("cmd")}/thumbnail/${e}/${t}/?width=${i}&height=${n}${h}&token=${this.accessToken}`}wmsTileUrl(e){var t,i,n,s,r,o,a,l,h,c,d,u,p,f,m,g;const v=null!==(t=e.mapid)&&void 0!==t?t:null===(i=this._cur_map_param)||void 0===i?void 0:i.mapid,y=null!==(o=null!==(n=e.version)&&void 0!==n?n:e.mapid==(null===(s=this._cur_map_param)||void 0===s?void 0:s.mapid)?null===(r=this._cur_map_param)||void 0===r?void 0:r.version:"_")&&void 0!==o?o:"_",x=null!==(a=e.layers)&&void 0!==a?a:null===(l=this._cur_map_param)||void 0===l?void 0:l.layer,w=null!==(h=e.bbox)&&void 0!==h?h:"{bbox-epsg-3857}",b=null!==(c=e.srs)&&void 0!==c?c:"EPSG:3857";let _=null!==(d=e.crs)&&void 0!==d?d:"";_.indexOf("+")>=0&&(_=encodeURIComponent(_));const S=null!==(u=e.mapbounds)&&void 0!==u?u:"",M=null!==(p=e.width)&&void 0!==p?p:256,C=null!==(f=e.height)&&void 0!==f?f:256,A=null===(m=e.transparent)||void 0===m||m,E=null!==(g=e.fourParameter)&&void 0!==g?g:"",T=!0===e.isInverseFourParamter?"&isInverseFourParamter=true":"",P=!0===e.mvt?".mvt":"",O=!0===e.useImageRotate?"&useImageRotate=true":"",D="number"==typeof e.imageProcessAlg?`&imageProcessAlg=${e.imageProcessAlg}`:"",B=e.webMapType?`&webMapType=${e.webMapType}`:"",I=e.backgroundColor&&!A?`&backgroundColor=${e.backgroundColor}`:"";if(Array.isArray(v)){let e=v,t=Array.isArray(y)&&y.length==e.length?y:e.map((e=>null!=y?y:"_")),i=Array.isArray(x)&&x.length==e.length?x:e.map((e=>null!=x?x:"")),n=Array.isArray(_)&&_.length==e.length?_:e.map((e=>null!=_?_:"")),s=Array.isArray(E)&&E.length==e.length?E:e.map((e=>null!=E?E:"")),r=Array.isArray(T)&&T.length==e.length?T:e.map((e=>null!=T?T:"")),o=`bbox=${w}&mapbounds=${S}&format=image/png&service=WMS&request=GetMap&srs=${b}&transparent=${A}&width=${M}&height=${C}`,a=`mapid=${e.join("_,")}&version=${t.join("_,")}&layers=${i.join("_,")}&crs=${n.join("_,")}&fourParameter=${s.join("_,")}&isInverseFourParamter=${r.join("_,")}`;return 1==e.length?`${this._url("cmd")}/wms/${e[0]}/${t[0]}${P}?mapbounds=${S}${w?"&bbox=":""}${w}&format=image/png&service=WMS&request=GetMap&srs=${b}&transparent=${A}&width=${M}&height=${C}&layers=${i[0]}&crs=${n[0]}&fourParameter=${s[0]}&isInverseFourParamter=${r[0]}${O}${D}${B}${I}&token=${this.accessToken}`:`${this._svr_url_service}wms?${o}&${a}${O}${D}${B}${I}&token=${this.accessToken}`}return`${this._url("cmd")}/wms/${v}/${y}${P}?mapbounds=${S}${w?"&bbox=":""}${w}&format=image/png&service=WMS&request=GetMap&srs=${b}&transparent=${A}&width=${M}&height=${C}&layers=${x}&crs=${_}&fourParameter=${E}${T}${O}${D}${B}${I}&token=${this.accessToken}`}cmdDeleteMap(e,t,i){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("deletemap",{retainVersionMaxCount:i},e,t)}))}cmdGetAccessKey(e,t){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("permission",{opName:"GetAccessKey",key:t},e,"_")}))}cmdResetAccessKey(e,t){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("permission",{opName:"ResetAccessKey",key:t},e,"_")}))}cmdSetMapPassword(e,t,i){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("permission",{opName:"ModifyPassword",key:t,newKey:i},e,"_")}))}cmdRenameMap(e,t){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("renamemap",{newMapId:t},e,"_")}))}cmdClearMapCache(e,t){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("clearCacheTiles",{},e,t)}))}cmdClearTileCache(e,t){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("clearCacheStyles",{},e,t)}))}cmdDeleteStyle(e){var t,i,n,s,r,o,a,l;return Qv(this,void 0,void 0,(function*(){const h=null!==(t=e.mapid)&&void 0!==t?t:null===(i=this._cur_map_param)||void 0===i?void 0:i.mapid,c=null!==(o=null!==(n=e.version)&&void 0!==n?n:e.mapid==(null===(s=this._cur_map_param)||void 0===s?void 0:s.mapid)?null===(r=this._cur_map_param)||void 0===r?void 0:r.version:"_")&&void 0!==o?o:"_";return yield this.execCommand("deletestyle",{styleid:null!==(a=e.styleid)&&void 0!==a?a:"",onlycleardata:null!==(l=e.onlycleardata)&&void 0!==l&&l},h,c)}))}cmdDeleteCache(e){var t,i,n,s,r,o,a;return Qv(this,void 0,void 0,(function*(){const l=null!==(t=e.mapid)&&void 0!==t?t:null===(i=this._cur_map_param)||void 0===i?void 0:i.mapid,h=null!==(o=null!==(n=e.version)&&void 0!==n?n:e.mapid==(null===(s=this._cur_map_param)||void 0===s?void 0:s.mapid)?null===(r=this._cur_map_param)||void 0===r?void 0:r.version:"_")&&void 0!==o?o:"_";return yield this.execCommand("deletecache",{key:null!==(a=e.key)&&void 0!==a?a:""},l,h)}))}cmdDeleteMapFile(e){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("clearUnuseMapFiles",{mapfileNames:Array.isArray(e)?e.join(";"):e,tilesType:0})}))}cmdRunStatus(e){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("runstatus",{detail:null!=e&&e})}))}cmdGetSupportFormat(){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("supportFormat",{})}))}getConstData(){return Qv(this,void 0,void 0,(function*(){return this._constdata||(this._constdata=yield this.execCommand("constData",{})),this._constdata}))}rasterBlankStyle(e,t,i){const n=null!=i?i:"rasterBlank";return this.rasterStyle(this.blankTileUrl(),e,t,n)}rasterLayerId(e){return`${null!=e?e:"raster"}-layer`}rasterSourceId(e){return`${null!=e?e:"raster"}-source`}rasterStyle(e,t,i,n){const s=null!=n?n:"raster";e=null!=e?e:this.rasterTileUrl();let r={};return this._spriteUrl&&(r.sprite=this._spriteUrl),Object.assign({version:8,sources:{[`${s}-source`]:{type:"raster",tiles:[e],tileSize:256,minzoom:null!=t?t:0,maxzoom:null!=i?i:24}},glyphs:this.glyphsUrl(),layers:[{id:`${s}-layer`,type:"raster",source:`${s}-source`,minzoom:null!=t?t:0,maxzoom:null!=i?i:24,layout:{visibility:"visible"}}]},r)}vectorStyle(e,t,i,n,s,r,o,a,l,h,c){var d,u,p,f;let m=1,g="#000000",v="#FFFFFF";if(e&&"object"==typeof e){let y=Object.assign({},e);t=y.minzoom,i=y.maxzoom,n=y.prefix,s=y.hoverColor,r=y.hoverOpacity,o=y.hoverLineWidth,a=y.customColorCaseExpr,l=y.customOpacityCaseExpr,h=y.customLineWidthCaseExpr,e=y.tileUrl,m=null!==(d=y.hoverLineBlur)&&void 0!==d?d:m,g=null!==(u=y.darkBackColor)&&void 0!==u?u:g,v=null!==(p=y.lightBackColor)&&void 0!==p?p:v,c=null!==(f=y.disableHover)&&void 0!==f&&f}const y=null!=n?n:"vector";e=null!=e?e:this.vectorTileUrl(),a=null!=a?a:[],l=null!=l?l:[],h=null!=h?h:[];const x=this.currentMapParam(),w=x&&x.darkMode,b=["case",["==",["get","color"],"#757675"],w?"#FFFFFF":"#000000",["==",["get","color"],"#fefffe"],w?g:v,["get","color"]];let _=w?[220,220,220]:[20,20,20],S=.5,M=a.length>0?["case",...a,b]:b;const C=["case",!0!==c&&["boolean",["feature-state","hover"],!1],s=null!=s?s:["let","rgba",["to-rgba",["to-color",M]],["let","r",["at",0,["var","rgba"]],"g",["at",1,["var","rgba"]],"b",["at",2,["var","rgba"]],"a",["at",3,["var","rgba"]],["let","desat_r",["+",["*",S,_[0]],["*",["-",1,S],["var","r"]]],"desat_g",["+",["*",S,_[1]],["*",["-",1,S],["var","g"]]],"desat_b",["+",["*",S,_[2]],["*",["-",1,S],["var","b"]]],["rgba",["var","desat_r"],["var","desat_g"],["var","desat_b"],["var","a"]]]]],...a,b];let A={};return this._spriteUrl&&(A.sprite=this._spriteUrl),Object.assign(Object.assign({version:8,sources:{[`${y}-source`]:{type:"vector",tiles:[e],maxzoom:null!=i?i:25,minzoom:null!=t?t:0}},glyphs:this.glyphsUrl()},A),{layers:[{id:`${y}-layer-polygons-border`,type:"line",source:`${y}-source`,"source-layer":"polygons",paint:{"line-color":C,"line-opacity":["case",!0!==c&&["boolean",["feature-state","hover"],!1],null!=r?r:.9,...l,["case",["has","alpha"],["get","alpha"],1]],"line-width":["case",!0!==c&&["boolean",["feature-state","hover"],!1],null!=o?o:4,1]}},{id:`${y}-layer-polygons`,type:"fill",source:`${y}-source`,"source-layer":"polygons",paint:{"fill-color":C,"fill-antialias":!1,"fill-outline-color":C,"fill-opacity":["case",!0!==c&&["boolean",["feature-state","hover"],!1],null!=r?r:.9,...l,["case",["has","alpha"],["get","alpha"],1]]},layout:{}},{id:`${y}-layer-lines`,type:"line",source:`${y}-source`,"source-layer":"lines",layout:{"line-cap":"round"},paint:{"line-color":C,"line-blur":["case",!0!==c&&["boolean",["feature-state","hover"],!1],null!=m?m:1,0],"line-opacity":["case",!0!==c&&["boolean",["feature-state","hover"],!1],null!=r?r:.9,...l,["case",["has","alpha"],["get","alpha"],1]],"line-width":["case",!0!==c&&["boolean",["feature-state","hover"],!1],null!=o?o:4,...h,["case",["has","linewidth"],["get","linewidth"],1]]}},{id:`${y}-layer-points`,type:"circle",source:`${y}-source`,"source-layer":"points",paint:{"circle-radius":["case",!0!==c&&["boolean",["feature-state","hover"],!1],4,...h,1],"circle-color":C,"circle-stroke-color":C,"circle-opacity":["case",!0!==c&&["boolean",["feature-state","hover"],!1],null!=r?r:.9,...l,["case",["has","alpha"],["get","alpha"],1]]}}]})}getFontsCapacity(){return Qv(this,void 0,void 0,(function*(){let e={};const t=this.serviceUrl("capacity/fonts");return e=yield this._get(t,{}),e&&"data"in e?e.data:e}))}clearCache(e=""){return Qv(this,void 0,void 0,(function*(){let t={};const i=this.serviceUrl("clearCache");return t=yield this._get(i,{prefix:e}),t&&"data"in t?t.data:t}))}webMapUrl(e){Array.isArray(e.tileUrl)?e.tileUrl=encodeURIComponent(e.tileUrl.join("____|_")):e.tileUrl=encodeURIComponent(e.tileUrl),Array.isArray(e.tileToken)&&(e.tileToken=e.tileToken.join("__"));const t=Object.keys(e).reduce(((t,i)=>t+i+"="+e[i]+"&"),"");return`${this._svr_url_service}map/tile/web/{z}/{x}/{y}?${t}token=${this.accessToken}`}composeNewMap(e){return Qv(this,void 0,void 0,(function*(){Array.isArray(e)||(e=[e]);let t={};e.length>1&&(t.count=e.length);for(let i=0;i<e.length;i++){let n=0===i?"":i+1+"";t["mapid"+n]=e[i].mapid,t["version"+n]=e[i].version,t["clipBounds"+n]=Array.isArray(e[i].clipbounds)?JSON.stringify(e[i].clipbounds):void 0,t["selByCrossing"+n]=e[i].selByCrossing,t["fourParameter"+n]=Array.isArray(e[i].fourParameter)?JSON.stringify(e[i].fourParameter):void 0,t["isInverseFourParamter"+n]=!0===e[i].isInverseFourParamter||void 0,t["layers"+n]=Array.isArray(e[i].layers)?JSON.stringify(e[i].layers):void 0,t["layerPrefix"+n]=e[i].layerPrefix,t["layerSuffix"+n]=e[i].layerSuffix,t["savefilename"+n]=e[i].savefilename,t["purge"+n]=e[i].purge,e[i].cadVersion&&(t["cadVersion"+n]=e[i].cadVersion),!1===e[i].isRenameBlockNameIfExist&&(t["isRenameBlockNameIfExist"+n]=e[i].isRenameBlockNameIfExist),!0===e[i].isZoomExtents&&(t["isZoomExtents"+n]=e[i].isZoomExtents)}return yield this.execCommand("composeNewMap",t,"_null","v1",!1)}))}cmdMapDiff(e){return Qv(this,void 0,void 0,(function*(){let t=yield this.execCommand("mapDiff",e,"_null","v1",!1);if(t.status){const e=e=>""==e?[]:e.split(";").map((e=>Yb.fromString(e).toPointArray()));t.modify&&(t.modify=e(t.modify)),t.new&&(t.new=e(t.new)),t.del&&(t.del=e(t.del))}return t}))}cmdExportLayout(e){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("exportLayout",e,"_null","v1",!1)}))}cmdMatchObject(e){var t,i,n,s,r,o,a,l;return Qv(this,void 0,void 0,(function*(){return e.size=null!==(t=e.size)&&void 0!==t?t:1e4,e.method=null!==(i=e.method)&&void 0!==i?i:"matchTemplate",e.maxCount=null!==(n=e.maxCount)&&void 0!==n?n:200,e.score=null!==(s=e.score)&&void 0!==s?s:.6,e.minReduceArea=null!==(r=e.minReduceArea)&&void 0!==r?r:256,e.canOverlap=null!==(o=e.canOverlap)&&void 0!==o&&o,e.maxOverlap=null!==(a=e.maxOverlap)&&void 0!==a?a:.3,e.toleranceAngle=null!==(l=e.toleranceAngle)&&void 0!==l?l:180,yield this.execCommand("objectMatch",e,"_null","v1",!1)}))}cmdCreateEntitiesGeomData(e,t){var i;return Qv(this,void 0,void 0,(function*(){let n=yield this.execCommand("createEntityGeoData",{mapdata:e.filedoc,mapExtent:e.mapBounds?JSON.stringify(e.mapBounds):"",renderAccuracy:e.renderAccuracy,excludeAttribute:!1!==e.excludeAttribute,useZip:null===(i=e.useZip)||void 0===i||i},"_null","v1",!1);return this._processQueryResult(n,t)}))}cmdTransform(e,t,i,n,s){return Qv(this,void 0,void 0,(function*(){let r=i;Array.isArray(i)||(r=[i]),Array.isArray(n)&&(n=n.join(","));let o=yield this.execCommand("coordtransform",{srs:e,crs:t,points:r.map((e=>e.x+","+e.y)).join(";"),fourParameter:n,isInverseFourParamter:!0===s||void 0},"_","_");return null==o?void 0:o.points}))}cmdPrjWktToPrj4(e,t){return Qv(this,void 0,void 0,(function*(){return yield this.execCommand("prjWktToPrj4Str",{wkt:e,from:null!=t?t:""},"_","_",!1)}))}saveCustomData(e,t,i,n){return Qv(this,void 0,void 0,(function*(){let s={};if(Array.isArray(e)){let t=this.serviceUrl("datas");if(s=yield this._post(t,e.map((e=>({key:e.key,value:JSON.stringify(e.value),prop:JSON.stringify(e.prop),ttl:e.ttl})))),s&&"data"in s)return s.data}else{let r=this.serviceUrl(`data/${e}`);if(n&&(r+="?ttl="+n),s=yield this._post(r,{value:JSON.stringify(t),prop:JSON.stringify(i)}),s&&"data"in s)return s.data}return s}))}getCustomData(e,t){var i,n;return Qv(this,void 0,void 0,(function*(){const s=Array.isArray(e);s&&(e=e.join(";;"));let r={},o=null!==(i=null==t?void 0:t.retDataType)&&void 0!==i?i:"",a=null!==(n=null==t?void 0:t.contentType)&&void 0!==n?n:"";const l=this.serviceUrl(`data/${e}?retDataType=${o}&contentType=${a}`);if(r=yield this._get(l),r&&"data"in r){let e,t=r.data;return"data"in t&&(s?(t.values=[t.data?JSON.parse(t.data):void 0],delete t.data,e=!0):t.data=t.data?JSON.parse(t.data):void 0),"prop"in t&&(s?(t.props=[t.prop?JSON.parse(t.prop):void 0],delete t.prop,e=!0):t.prop=t.prop?JSON.parse(t.prop):void 0),e&&(t.status=[t.status]),"values"in t&&(t.values=t.values.map((e=>{try{return e?JSON.parse(e):e}catch(t){return e}}))),"props"in t&&(t.props=t.props.map((e=>{try{return e?JSON.parse(e):e}catch(t){return e}}))),t}return r}))}getCustomDataKeysByPrefix(e){return Qv(this,void 0,void 0,(function*(){let t={};const i=this.serviceUrl(`datakeys?prefix=${e||""}`);return t=yield this._get(i),t&&"data"in t?t.data:t}))}deleteCustomData(e,t){return Qv(this,void 0,void 0,(function*(){Array.isArray(e)&&(e=e.join(";;"));let i={},n=this.serviceUrl(`data/${e}`);return t&&(n+="?isPrefix=true"),i=yield this._del(n),i&&"data"in i?i.data:i}))}toDbDoc(e){const t={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var i,n,s,r,o,a,l,h="",c=0;for(e=t._utf8_encode(e);c<e.length;)r=(i=e.charCodeAt(c++))>>2,o=(3&i)<<4|(n=e.charCodeAt(c++))>>4,a=(15&n)<<2|(s=e.charCodeAt(c++))>>6,l=63&s,isNaN(n)?a=l=64:isNaN(s)&&(l=64),h=h+this._keyStr.charAt(r)+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(l);return h},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}};return"data:application/dwg;base64,"+t.encode("string"==typeof e?e:JSON.stringify(e))}}function Hk(){return{backcolor:0}}function Wk(){return{backcolor:16777215}}var Gk,Yk,Xk,Qk;class qk{constructor(){Gk.add(this),this.cacheResult=new Map,Yk.set(this,new Map),this.loaderUrlPath="",Xk.set(this,[])}loadPlugin(e,t){return Qv(this,void 0,void 0,(function*(){return qv(this,Gk,"m",Qk).call(this,e,t,!1)}))}loadLibrary(e,t){return Qv(this,void 0,void 0,(function*(){return qv(this,Gk,"m",Qk).call(this,e,t,!0)}))}setLoaderPath(e,t){this.loaderUrlPath=e,Zv(this,Xk,t||[],"f")}}Yk=new WeakMap,Xk=new WeakMap,Gk=new WeakSet,Qk=function(t,i,n){return Qv(this,void 0,void 0,(function*(){let s=t+yv(JSON.stringify(null!=i?i:{}));if(this.cacheResult.has(s))return this.cacheResult.get(s);if(qv(this,Yk,"f").has(s))return qv(this,Yk,"f").get(s);if(!0!==(null==i?void 0:i.isAbsPath)){"/"!=t[t.length-1]&&(t+="/");const e=e=>qv(this,Xk,"f").find((t=>t==e||0==t.indexOf(e+"__v")))||e;t=this.loaderUrlPath+e(n?"lib":"plugin")+"/"+t}let r=new Promise(((r,o)=>{var a;if(void 0!==(null==i?void 0:i.strategy))vG(Object.assign(Object.assign({},i),{src:t})).then((e=>{this.cacheResult.set(s,e),qv(this,Yk,"f").delete(s),r(e)})).catch((e=>{qv(this,Yk,"f").delete(s),o(e)}));else{let l={};l.raw=null===(a=l.raw)||void 0===a||a,jk.get(t,void 0,l).then((t=>{let a=t.data;try{let t=null==i?void 0:i.globalThisUndefined;void 0===t&&(t=!n);let l=null==i?void 0:i.context;if(void 0===l)if(n)l={};else{let t=Object.assign(Object.assign(Object.assign(Object.assign({},e),Li),Li),ln);l={vjmap3d:Object.assign(Object.assign({},hn),{THREE:t,three:t}),THREE:t,three:t}}let h,c=Object.keys(l||{}),d=Object.assign({},l),u=d;c.length>0&&(u=Object.assign({},d[c[0]]));try{t?!1!==(null==i?void 0:i.globalThisReplace)?(a=ix(a,"globalThis.","globalThis_."),h=new Function("globalThis_","globalThis",a).bind(l),h({})):(h=new Function("globalThis",a).bind(l),h()):(h=new Function(a).bind(l),h())}catch(e){console.error(e),o(e)}let p=l||{};c.length>0&&(p=l[c[0]]);let f={};for(let e in p)e in u||(f[e]=p[e]);0==Object.keys(f).length&&(f=l),this.cacheResult.set(s,f),qv(this,Yk,"f").delete(s),r(f)}catch(e){qv(this,Yk,"f").delete(s),o(e)}})).catch((e=>{qv(this,Yk,"f").delete(s),o(e)}))}}));return qv(this,Yk,"f").set(s,r),r}))};let Zk=new qk;const Kk=()=>Qv(void 0,void 0,void 0,(function*(){return yield Zk.loadPlugin("algorithm")})),Jk=()=>Qv(void 0,void 0,void 0,(function*(){return yield Zk.loadPlugin("3dtiles")}));var $k;const eL=new Ck;class tL{constructor(e){this.useCacheResMap=new Map,$k.set(this,[]),this.loaderManager=null!=e?e:eL,this.defaultError=e=>{console.error(e)}}setServiceUrlPath(e,t){this.serviceAasserUrlPath=e,Zv(this,$k,t||[],"f")}svrUrl(e,t){return e?(-1==(t=(e=>qv(this,$k,"f").find((t=>t==e||0==t.indexOf(e+"__v")))||e)(t=t||"assert")).indexOf("/")&&(t+="/"),this.serviceAasserUrlPath+t+e):this.serviceAasserUrlPath}loadRes(e,t,i){return new Promise(((n,s)=>{const r=this.loaderManager.getResourceStatus(e);if(!0!==t||r===Mk.NoExist)this.loaderManager.load(e,t,(e=>{n(e)}),null,(e=>s(e)),i);else if(r===Mk.LoadFinish)n(this.loaderManager.getResource(e));else if(r===Mk.LoadError)s(this.loaderManager.getLoadDetail(e).message);else if(r===Mk.Loading){const t=i=>{i.url===e&&(this.loaderManager.signal.loaded.remove(t),i.error?s(i.message):n(this.loaderManager.getResource(e)))};this.loaderManager.signal.loaded.add(t)}}))}loadTextureLinear(e,t=!0,i,n){return this.loadTexture(e,t,i,n,ae)}loadTextureLinearSync(e,t=!0,i,n){return this.loadTextureSync(e,t,i,ae)}loadTexture(e,t=!0,i,n,s){if(n=null!=n?n:this.defaultError,!0===t&&this.useCacheResMap.has(e))return this.useCacheResMap.get(e);const r=new W;return this.loadRes(e,t,null!=i?i:"img").then((i=>{r.image=i,r.needsUpdate=!0,r.colorSpace=null!=s?s:se,!0===t&&(this.useCacheResMap.set(e,r),aW(r))})).catch((e=>{n&&n(e)})),r}loadTextureSync(e,t=!0,i,n){return new Promise(((s,r)=>{if(!0===t&&this.useCacheResMap.has(e)){let t=this.useCacheResMap.get(e);s(t)}const o=new W;this.loadRes(e,t,null!=i?i:"img").then((i=>{o.image=i,o.needsUpdate=!0,o.colorSpace=null!=n?n:se,!0===t&&(this.useCacheResMap.set(e,o),aW(o)),s(o)})).catch((e=>{r(e)}))}))}loadModelRes(e,t={}){return t.toEntity=!1,this.loadModel(e,t)}addModel(e,t,n={}){var s,r,o;n.onLoad&&n.onLoad(e);let a=null!==(s=e.scene)&&void 0!==s?s:e;if(n.useCache&&(this.useCacheResMap.has(t)||(this.useCacheResMap.set(t,a),aW(a)),a=hW(a)?Zi.clone(a):a.clone()),void 0===n.isMapMode&&(n.isMapMode=null===(r=Cy.app)||void 0===r?void 0:r.isMapMode),n.rotation){let e=Vv(n.rotation);a.rotation.set(e.x,e.y,e.z)}else!0===n.isMapMode&&(a.rotateX(Math.PI/2),a.rotateY(Math.PI));let l=new i(0,0,0);if(n.position||n.size||n.anchor||n.offset){let e,s,r;e=hW(a)?Zi.clone(a):a.clone(),this.useCacheResMap.has("__size__"+t)?r=this.useCacheResMap.get("__size__"+t):(r=(new E).setFromObject(e),this.useCacheResMap.set("__size__"+t,r)),s=r.getSize(new i);let h=Math.max(s.x,s.y,s.z),c=n.size?[n.size/h,n.size/h,n.size/h]:n.scale?Vv(n.scale).toArray():[1,1,1];if(n.anchor=null!==(o=n.anchor)&&void 0!==o?o:"default",l=null,"default"!==n.anchor)if(n.modelCenter)l=n.modelCenter;else{l=new i(0,0,0);let e=r.getCenter(new i),t=r.getSize(new i);t.multiplyScalar(c[0]),(new E).setFromCenterAndSize(e,t).containsPoint(l)||(l=null)}l||(l=r.getCenter(new i).multiply((new i).fromArray(c))),!0===n.isMapMode?(n.anchor.indexOf("front")>=0?l.y+=s.y*c[1]/2:n.anchor.indexOf("back")>=0&&(l.y-=s.y*c[1]/2),n.anchor.indexOf("left")>=0?l.x+=s.x*c[0]/2:n.anchor.indexOf("right")>=0&&(l.x-=s.x*c[0]/2),n.anchor.indexOf("top")>=0?l.z+=s.z*c[2]/2:n.anchor.indexOf("bottom")>=0&&(l.z-=s.z*c[2]/2)):(n.anchor.indexOf("front")>=0?l.z+=s.z*c[2]/2:n.anchor.indexOf("back")>=0&&(l.z-=s.z*c[2]/2),n.anchor.indexOf("left")>=0?l.x-=s.x*c[0]/2:n.anchor.indexOf("right")>=0&&(l.x+=s.x*c[0]/2),n.anchor.indexOf("top")>=0?l.y+=s.y*c[1]/2:n.anchor.indexOf("bottom")>=0&&(l.y-=s.y*c[1]/2)),n.offset&&l.add(Vv(n.offset).multiplyScalar(-1)),n.size&&a.scale.multiplyScalar(n.size/h)}if(!n.size&&n.scale&&a.scale.copy(Vv(n.scale)),!1===n.toEntity)return a.position.copy(l).multiplyScalar(-1),n.position&&a.position.add(Vv(n.position)),n.useCache&&a.addEventListener("added",(()=>{a.userData&&delete a.userData.__disposed})),a;{let t=Ak(a,n.splitSubEntity,n.autoAsMeshEntity);if(n.useCache&&t.onEntityAwake((e=>{t.node&&t.node.userData&&delete t.node.userData.__disposed})),!1!==n.asEntityGroup){let i=new V;i.position.copy(l).multiplyScalar(-1),n.position&&i.position.add(Vv(n.position));let s=new UP({node:i});return s.addChildEntity(t),e.animations&&e.animations.length>0&&s.add(vz,{object:t.node,animations:e.animations}),s}return e.animations&&e.animations.length>0&&t.add(vz,{animations:e.animations}),t}}loadModel(e,t={}){return new Promise(((i,n)=>{iL.loadRes(e,t.useCache,t.fileType).then((n=>{i(this.addModel(n,e,t))})).catch((e=>n(e)))}))}loadResources(e){var t,i,n,s,r,o,a;let l=[],h=[];for(let h=0;h<e.length;h++){let c=e[h];"texture"==c.type?l.push(this.loadTextureSync(c.url,null!==(t=c.useCache)&&void 0!==t?t:null===(i=c.options)||void 0===i?void 0:i.useCache,null===(n=c.options)||void 0===n?void 0:n.fileType)):"model"==c.type?l.push(this.loadModel(c.url,Object.assign({useCache:c.useCache},c.options))):"extensionLoader"==c.type?l.push(this.loadExtensionLoader()):"extensionIfcLoader"==c.type?l.push(this.loadExtensionIfcLoader()):"plugin"==c.type?l.push(Zk.loadPlugin(c.url,c.options)):"library"==c.type?l.push(Zk.loadLibrary(c.url,c.options)):"custom"==c.type?"function"==typeof c.options?l.push(c.options(c,e)):console.warn("loadResources type is custom, options is not function"):l.push(this.loadRes(c.url,null!==(s=c.useCache)&&void 0!==s?s:null===(r=c.options)||void 0===r?void 0:r.useCache,null!==(a=null===(o=c.options)||void 0===o?void 0:o.fileType)&&void 0!==a?a:c.type))}h.length=l.length;let c=[],d=!1;const u=()=>{if(d)return c;d=!0;for(let t=0;t<e.length;t++)c.push(Object.assign(Object.assign({},e[t]),{resource:h[t]}));return c},p=e=>{var t;return null===(t=u().find((t=>t.name===e)))||void 0===t?void 0:t.resource};return{promises:function(e){let t=0;for(let i=0;i<l.length;i++)l[i].then((n=>{h[i]=n,t++;const s=100*t/l.length;null==e||e(s)})).catch((n=>{h[i]=n,t++,null==e||e(-1,n)}));return Promise.all(l)},getResouces:u,getResource:p,getTexture:e=>p(e),getModel:e=>p(e),cloneModel:(e,t)=>{var i;let n=u().find((t=>t.name===e));if(!n)return;let s=eL.getResource(n.url);return s?(null!=t||(t={}),null!==(i=t.useCache)&&void 0!==i||(t.useCache=!0),this.addModel(s,n.url,null!=t?t:{})):void 0}}}clearResourceCache(){var e,t;this.loaderManager.dispose();for(let i in this.useCacheResMap)aW(this.useCacheResMap[i],-1),rW(this.useCacheResMap[i])||(null===(e=this.useCacheResMap[i])||void 0===e?void 0:e.dispose)&&(null===(t=this.useCacheResMap[i])||void 0===t||t.dispose());this.useCacheResMap.clear()}loadExtensionLoader(){return Qv(this,void 0,void 0,(function*(){return this.loaderManager.loadExtensionLoader()}))}loadExtensionIfcLoader(e){return Qv(this,void 0,void 0,(function*(){return this.loaderManager.loadExtensionIfcLoader(e)}))}getLoader(e){return this.loaderManager.getLoader(e)}dispose(){this.clearResourceCache()}}$k=new WeakMap;const iL=new tL;function nL(e,t,i,n){const o=new YD;let a;null!=t||(t={}),"string"==typeof t.map&&(t.map=iL.loadTexture(t.map),t.map.wrapS=G,t.map.wrapT=G),"string"==typeof t.normalMap&&(t.normalMap=iL.loadTexture(t.normalMap),t.normalMap.wrapS=G,t.normalMap.wrapT=G);let l,c,d=null==t?void 0:t.reflectorMaterialType;a="ReflectorDudvMaterial"==d?new AE(Object.assign({reflectivity:.5},t)):new ME(Object.assign({reflectivity:6,mirror:.1,mixStrength:3,color:new s("#fff"),map:t.map,normalMap:t.normalMap,normalScale:new r(1,1),dithering:!0},t)),a.uniforms.tReflect=o.renderTargetUniform,a.uniforms.uMatrix=o.textureMatrixUniform,a.uniforms.tReflectBlur=o.renderTargetUniform,n&&n.length>0&&(l=new K,n.forEach((e=>l.add(e))));const u=(e,t)=>{c||(c=e.material,e.material=a,t&&(c.map&&(a.map=c.map),c.normalMap&&(a.normalMap=c.normalMap),c.color&&(a.color=c.color)),e.add(o),null!=i||(i=[]),e.onBeforeRender=(t,n,s)=>{e.visible=!1;let r=i.map((e=>e.visible));i.forEach((e=>e.visible=!1)),o.update(t,l||n,s),e.visible=!0;for(let e=0;e<r.length;e++)i[e].visible=r[e]})};let p;return e&&(p=new h(e,a),p.name="reflectorShaderMesh",u(p)),{mesh:p,material:a,attachMesh:u,detachMesh:e=>{c&&(e.material=c,e.remove(o),delete e.onBeforeRender,c=null)}}}const sL=(e,t,n,s,r,o)=>{let a=(new i).copy(t).sub(e),l=(new i).copy(e).sub(t),h=(new i).copy(n).sub(e),c=o?n:(new i).crossVectors(a,h).normalize(),d=(new i).crossVectors(c,r?l:a).normalize().multiplyScalar(s);return(new i).copy(e).add(d)},rL=(e,t,n)=>{let s=(new i).copy(t).sub(e).normalize().multiplyScalar(n);return(new i).copy(e).add(s)},oL=(e,t,s,r,o)=>{let a=(new i).copy(t).sub(e).normalize(),l=(new i).copy(s).sub(e).normalize(),h=r?s:(new i).crossVectors(a,l).normalize(),c=(new i).crossVectors(a,h).normalize();const d=(new n).makeBasis(a,h,c);let u=(new v).setFromRotationMatrix(d);const p=-Math.PI/2,f=new i(1,0,0);let m=new v;if(m.setFromAxisAngle(f,p),u.multiply(m),o){let n=o(e,t,u);if(Array.isArray(n))for(let e of n){let t=e.axis;"x"==e.axis?t=f:"y"==e.axis?t=new i(0,1,0):"z"==e.axis&&(t=new i(0,0,1));let n=new v;n.setFromAxisAngle(t,e.angle),u.multiply(n)}}return u.clone()},aL=(e,t)=>{var n,s,r,o,a,l,h;let c=new UP,d="ruler_"+uv(),u=e.getDrawLayer(d,{parentEntity:c}),p=Vv(t.startPoint),f=Vv(t.endPoint),m=!1,g=Vv(null!==(n=t.planePoint)&&void 0!==n?n:[0,0,0]),v=e.isMapMode?"z":"y",y=Tv(p[v],f[v]);!t.planePoint&&Tv(p[v],f[v])&&(m=!0,g=new i(0,e.isMapMode?0:1,e.isMapMode?1:0));let x=p.distanceTo(f),w=x*(null!==(s=t.distRatio)&&void 0!==s?s:1/15),b=null!==(r=t.sideLineLength)&&void 0!==r?r:w,_="#0ff";if(b){let e=b/2,i=sL(p,f,g,e,!1,m),n=sL(p,f,g,e,!0,m);u.addPolylineData(Object.assign({coordinates:[i.toArray(),n.toArray()],color:_},t.sideLineStyle));let s=sL(f,p,g,e,!1,m),r=sL(f,p,g,e,!0,m);u.addPolylineData(Object.assign({coordinates:[s.toArray(),r.toArray()],color:_},t.sideLineStyle))}let S,M,C=null!==(o=t.arrowLineLength)&&void 0!==o?o:w,A=null!==(a=t.arrowLineHeight)&&void 0!==a?a:w/4;if(C&&A){S=rL(p,f,C);let e=sL(S,f,g,A,!1,m),i=sL(S,f,g,A,!0,m);u.addPolygonData(Object.assign({coordinates:[e.toArray(),i.toArray(),p.toArray(),e.toArray()],color:_},t.arrowStyle)),M=rL(f,p,C);let n=sL(M,p,g,A,!1,m),s=sL(M,p,g,A,!0,m);u.addPolygonData(Object.assign({coordinates:[n.toArray(),s.toArray(),f.toArray(),n.toArray()],color:_},t.arrowStyle))}let E=null!=S?S:p,T=null!=M?M:f;u.addPolylineData(Object.assign({coordinates:[E.toArray(),T.toArray()],color:_},t.rulerLineStyle));const P=p.clone().add(f).multiplyScalar(.5);if(!1!==t.autoFromWorld){let t=new i(...IW(p.toArray(),e)),n=new i(...IW(f.toArray(),e));x=t.distanceTo(n)}let O=`${x.toFixed(null!==(l=t.fractionDigits)&&void 0!==l?l:2)}`;if(t.showTextCb){let e=t.showTextCb(p,f,x,null!==(h=t.fractionDigits)&&void 0!==h?h:2);void 0!==e&&(O=e)}let D,B=eT(Object.assign({position:P,text:O,sizeAttenuation:!0,lineHeight:w,anchorPoint:[.5,0]},t.textStyle));if(y||t.planePoint)D=oL(p,f,g,m,t.textAngleCb);else{let e=sL(p,f,g,1,!1,m);D=oL(p,f,e,!1,t.textAngleCb)}return B.quaternion.copy(D),c.addObjects(B),c.addTo(e),c};var lL,hL;class cL{constructor(e,t){lL.set(this,void 0),hL.set(this,void 0),this.app=e;const{resolution:i=256,near:n=1,far:s=1e3,scene:r=null,renderOptions:o={},textureType:a=Z,ignoreObjects:l=[]}=t;this.ignoreObjects=l;const h=new Yt(i,o);h.texture.type=a,this.fbo=h;const c=new Xt(n,s,h);let d;this.cubeCamera=c;let u=[];r.isScene?d=r:Array.isArray(r)&&(u=r);const p=d||new K;this.virtualScene=p,u.forEach((e=>this.add(e))),Zv(this,hL,!1,"f"),Zv(this,lL,this.app.signal.onAppAfterUpdate.add((()=>this.update())),"f")}pause(){Zv(this,hL,!0,"f")}start(){Zv(this,hL,!1,"f")}update(){qv(this,hL,"f")||(this.ignoreObjects.forEach((e=>{e.visible=!1})),this.cubeCamera.update(this.app.renderer,this.virtualScene),this.ignoreObjects.forEach((e=>{e.visible=!0})))}add(e){this.virtualScene.add(e)}get texture(){return this.fbo.texture}dispose(){var e;null===(e=qv(this,lL,"f"))||void 0===e||e.call(this)}}function dL(e){const t=Object.assign({},e);return"defines"in e&&(t.defines=Object.assign({},e.defines)),"uniforms"in e&&(t.uniforms=at.clone(e.uniforms)),t}lL=new WeakMap,hL=new WeakMap;const uL={defines:{X_IS_EVEN:1,Y_IS_EVEN:1},uniforms:{map:{value:null},originalMapSize:{value:new r},parentMapSize:{value:new r},parentLevel:{value:0}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\n\t\t\t#include <begin_vertex>\n\t\t\t#include <project_vertex>\n\t\t\tvUv = uv;\n\n\t\t}\n\t",fragmentShader:'\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D map;\n\t\tuniform int parentLevel;\n\t\tuniform vec2 parentMapSize;\n\t\tuniform vec2 originalMapSize;\n\n\t\t\n\n\t// Without original size argument for power of two targets\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, int level ) {\n\n\t\t// the fraction of the uv space used by the target mip\n\t\tfloat targetSubview = 1.0 / pow( 2.0, float( level ) );\n\t\tfloat widthRatio = 2.0 / 3.0;\n\t\tvec2 scaledDimensions = vec2( targetSubview * widthRatio, targetSubview );\n\n\t\t// all levels > 0 are on the right third of the texture\n\t\t// y is offset from the bottom\n\t\tvec2 offset = vec2(\n\t\t\tlevel > 0 ? widthRatio : 0.0,\n\t\t\tlevel > 0 ? targetSubview : 0.0\n\t\t);\n\n\t\tvec2 samplePoint = mix( offset, offset + scaledDimensions, uv );\n\t\treturn texture2D( tex, samplePoint );\n\n\t}\n\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, float level ) {\n\n\t\tfloat ratio = mod( level, 1.0 );\n\t\tint minLevel = int( floor( level ) );\n\t\tint maxLevel = int( ceil( level ) );\n\n\t\tvec4 minValue = packedTexture2DLOD( tex, uv, minLevel );\n\t\tvec4 maxValue = packedTexture2DLOD( tex, uv, maxLevel );\n\n\t\treturn mix( minValue, maxValue, ratio );\n\n\t}\n\n\t// With original size argument\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, int level, vec2 originalPixelSize ) {\n\n\t\tfloat floatLevel = float( level );\n\t\tvec2 atlasSize;\n\t\tatlasSize.x = floor( originalPixelSize.x * 1.5 );\n\t\tatlasSize.y = originalPixelSize.y;\n\n\t\t// we stop making mip maps when one dimension == 1\n\t\tfloat maxLevel = min( floor( log2( originalPixelSize.x ) ), floor( log2( originalPixelSize.y ) ) );\n\t\tfloatLevel = min( floatLevel, maxLevel );\n\n\t\t// use inverse pow of 2 to simulate right bit shift operator\n\t\tvec2 currentPixelDimensions = floor( originalPixelSize / pow( 2.0, floatLevel ) );\n\t\tvec2 pixelOffset = vec2(\n\t\t\tfloatLevel > 0.0 ? originalPixelSize.x : 0.0,\n\t\t\tfloatLevel > 0.0 ? currentPixelDimensions.y : 0.0\n\t\t);\n\n\t\t// "minPixel / atlasSize" samples the top left piece of the first pixel\n\t\t// "maxPixel / atlasSize" samples the bottom right piece of the last pixel\n\t\tvec2 minPixel = pixelOffset;\n\t\tvec2 maxPixel = pixelOffset + currentPixelDimensions;\n\t\tvec2 samplePoint = mix( minPixel, maxPixel, uv );\n\t\tsamplePoint /= atlasSize;\n\n\t\tvec2 halfPixelSize = 1.0 / ( 2.0 * atlasSize );\n\t\tsamplePoint = min( samplePoint, maxPixel / atlasSize - halfPixelSize );\n\t\tsamplePoint = max( samplePoint, minPixel / atlasSize + halfPixelSize );\n\n\t\treturn texture2D( tex, samplePoint );\n\n\t}\n\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, float level, vec2 originalPixelSize ) {\n\n\t\tfloat ratio = mod( level, 1.0 );\n\t\tint minLevel = int( floor( level ) );\n\t\tint maxLevel = int( ceil( level ) );\n\n\t\tvec4 minValue = packedTexture2DLOD( tex, uv, minLevel, originalPixelSize );\n\t\tvec4 maxValue = packedTexture2DLOD( tex, uv, maxLevel, originalPixelSize );\n\n\t\treturn mix( minValue, maxValue, ratio );\n\n\t}\n\n\n\n\t\t#if X_IS_EVEN && Y_IS_EVEN\n\n\t\t#define SAMPLES 4\n\t\t#define WIDTH 2\n\t\t#define HEIGHT 2\n\n\t\t#elif X_IS_EVEN\n\n\t\t#define SAMPLES 6\n\t\t#define WIDTH 2\n\t\t#define HEIGHT 3\n\n\t\t#elif Y_IS_EVEN\n\n\t\t#define SAMPLES 6\n\t\t#define WIDTH 3\n\t\t#define HEIGHT 2\n\n\t\t#else\n\n\t\t#define SAMPLES 9\n\t\t#define WIDTH 3\n\t\t#define HEIGHT 3\n\n\t\t#endif\n\n\t\tvec4 sampleAt( vec2 uv ) {\n\n\t\t\treturn packedTexture2DLOD( map, uv, parentLevel, originalMapSize );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec2 childMapSize = parentMapSize / 2.0;\n\t\t\t// vec2 childPixelSize = 1.0 / childMapSize;\n\t\t\t// vec2 halfChildPixelSize = childPixelSize / 2.0;\n\t\t\tvec2 childPixelPos = floor( vUv * childMapSize );\n\n\t\t\tvec2 parentPixelSize = 1.0 / parentMapSize;\n\t\t\tvec2 halfParentPixelSize = parentPixelSize / 2.0;\n\t\t\tvec2 parentPixelPos = childPixelPos * 2.0;\n\n\t\t\tvec2 baseUv = ( parentPixelPos / parentMapSize ) + halfParentPixelSize;\n\n\t\t\tvec4 samples[ SAMPLES ];\n\t\t\tfloat weights[ SAMPLES ];\n\n\t\t\t#if X_IS_EVEN && Y_IS_EVEN\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = 0.25;\n\t\t\tweights[ 1 ] = 0.25;\n\t\t\tweights[ 2 ] = 0.25;\n\t\t\tweights[ 3 ] = 0.25;\n\n\t\t\t#elif X_IS_EVEN\n\n\t\t\tfloat wx0 = 0.5;\n\t\t\tfloat wx1 = 0.5;\n\n\t\t\tfloat yden = 2.0 * parentMapSize.y + 1.0;\n\t\t\tfloat wy0 = ( parentMapSize.y - parentPixelPos.y ) / yden;\n\t\t\tfloat wy1 = ( parentMapSize.y ) / yden;\n\t\t\tfloat wy2 = ( parentPixelPos.y + 1.0 ) / yden;\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tsamples[ 4 ] = sampleAt( baseUv + vec2( 0.0, 2.0 * parentPixelSize.y ) );\n\t\t\tsamples[ 5 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 2.0 * parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = wx0 * wy0;\n\t\t\tweights[ 1 ] = wx1 * wy0;\n\n\t\t\tweights[ 2 ] = wx0 * wy1;\n\t\t\tweights[ 3 ] = wx1 * wy1;\n\n\t\t\tweights[ 4 ] = wx0 * wy2;\n\t\t\tweights[ 5 ] = wx1 * wy2;\n\n\t\t\t#elif Y_IS_EVEN\n\n\t\t\tfloat xden = 2.0 * parentMapSize.x + 1.0;\n\t\t\tfloat wx0 = ( parentMapSize.x - parentPixelPos.x ) / xden;\n\t\t\tfloat wx1 = ( parentMapSize.x ) / xden;\n\t\t\tfloat wx2 = ( parentPixelPos.x + 1.0 ) / xden;\n\n\t\t\tfloat wy0 = 0.5;\n\t\t\tfloat wy1 = 0.5;\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, 0.0 ) );\n\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 4 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\t\t\tsamples[ 5 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = wx0 * wy0;\n\t\t\tweights[ 1 ] = wx1 * wy0;\n\t\t\tweights[ 2 ] = wx2 * wy0;\n\n\t\t\tweights[ 3 ] = wx0 * wy1;\n\t\t\tweights[ 4 ] = wx1 * wy1;\n\t\t\tweights[ 5 ] = wx2 * wy1;\n\n\t\t\t#else\n\n\t\t\tfloat xden = 2.0 * parentMapSize.x + 1.0;\n\t\t\tfloat wx0 = ( parentMapSize.x - parentPixelPos.x ) / xden;\n\t\t\tfloat wx1 = ( parentMapSize.x ) / xden;\n\t\t\tfloat wx2 = ( parentPixelPos.x + 1.0 ) / xden;\n\n\t\t\tfloat yden = 2.0 * parentMapSize.y + 1.0;\n\t\t\tfloat wy0 = ( parentMapSize.y - parentPixelPos.y ) / yden;\n\t\t\tfloat wy1 = ( parentMapSize.y ) / yden;\n\t\t\tfloat wy2 = ( parentPixelPos.y + 1.0 ) / yden;\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, 0.0 ) );\n\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 4 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\t\t\tsamples[ 5 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tsamples[ 6 ] = sampleAt( baseUv + vec2( 0.0, 2.0 * parentPixelSize.y ) );\n\t\t\tsamples[ 7 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 2.0 * parentPixelSize.y ) );\n\t\t\tsamples[ 8 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, 2.0 * parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = wx0 * wy0;\n\t\t\tweights[ 1 ] = wx1 * wy0;\n\t\t\tweights[ 2 ] = wx2 * wy0;\n\n\t\t\tweights[ 3 ] = wx0 * wy1;\n\t\t\tweights[ 4 ] = wx1 * wy1;\n\t\t\tweights[ 5 ] = wx2 * wy1;\n\n\t\t\tweights[ 6 ] = wx0 * wy2;\n\t\t\tweights[ 7 ] = wx1 * wy2;\n\t\t\tweights[ 8 ] = wx2 * wy2;\n\n\t\t\t#endif\n\n\t\t\t<mipmap_logic>\n\n\t\t}\n\t'};class pL{constructor(e){this.camera=new f(-1,1,1,-1,0,1),this.geometry=new l(2,2),this.mesh=new h(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}const fL=new s,mL={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")};class gL{constructor(e=""){e||(e="\n\n\t\t\t\t#pragma unroll_loop\n\t\t\t\tfor ( int i = 0; i < SAMPLES; i ++ ) {\n\n\t\t\t\t\tgl_FragColor += samples[ i ] * weights[ i ];\n\n\t\t\t\t}\n\n\t\t\t");const t=dL(uL);t.fragmentShader=t.fragmentShader.replace(/<mipmap_logic>/g,e);const i=new Array(4);i[0]=new a(dL(t)),i[0].defines.X_IS_EVEN=0,i[0].defines.Y_IS_EVEN=0,i[1]=new a(dL(t)),i[1].defines.X_IS_EVEN=1,i[1].defines.Y_IS_EVEN=0,i[2]=new a(dL(t)),i[2].defines.X_IS_EVEN=0,i[2].defines.Y_IS_EVEN=1,i[3]=new a(dL(t)),i[3].defines.X_IS_EVEN=1,i[3].defines.Y_IS_EVEN=1;const n=new q;n.texture.minFilter=Te,n.texture.magFilter=Te,this._swapTarget=n,this._copyQuad=new pL(new a(mL)),this._mipQuad=new pL(null),this._mipMaterials=i}update(e,t,i,n=!1){e.isWebGLRenderTarget&&(e=e.texture);const s=i.autoClear,r=i.getClearAlpha(),a=i.getRenderTarget();i.getClearColor(fL);const l=this._copyQuad,h=this._mipQuad,c=this._swapTarget,d=this._mipMaterials;let u,p;n?(u=o.floorPowerOfTwo(e.image.width),p=o.floorPowerOfTwo(e.image.height)):(u=Math.floor(e.image.width),p=Math.floor(e.image.height));const f=Math.floor(1.5*u),m=Math.floor(p);t.setSize(f,m),c.texture.type!==t.texture.type?(c.dispose(),c.copy(t),c.texture.image=Object.assign({},c.texture.image)):c.setSize(f,m),i.autoClear=!1,i.setClearColor(0),i.setClearAlpha(),l.material.uniforms.tDiffuse.value=e,l.camera.setViewOffset(u,p,0,0,f,m),i.setRenderTarget(t),i.clear(),l.render(i),i.setRenderTarget(c),i.clear(),l.render(i);let g=u,v=p,y=0;for(;g>1&&v>1;){const e=d[(g%2==0?1:0)|(v%2==0?2:0)];e.uniforms.map.value=c.texture,e.uniforms.parentLevel.value=y,e.uniforms.parentMapSize.value.set(g,v),e.uniforms.originalMapSize.value.set(u,p),h.material=e,g=Math.floor(g/2),v=Math.floor(v/2);const n=m-2*v;i.setRenderTarget(t),h.camera.setViewOffset(g,v,-u,-n,f,m),h.render(i),i.setRenderTarget(c),e.uniforms.map.value=t.texture,h.render(i),y++}return i.setRenderTarget(a),i.setClearAlpha(r),i.setClearColor(fL),i.autoClear=s,y+1}dispose(){this._swapTarget.dispose(),this._mipQuad.dispose(),this._copyQuad.dispose(),this._mipMaterials.forEach((e=>e.dispose()))}}var vL;class yL{constructor(e,t={}){vL.set(this,void 0),this.app=e;const{envmap1:i,envmap2:n}=t,s=null==i?void 0:i.source.data,r=UA(s.width,s.height,{minFilter:N,magFilter:N,type:Z});this.fbo=r,this.texture.mapping=Qt;const o=new a({vertexShader:"\nvarying vec2 vUv;\n\nvoid main(){\n    vec3 p=position;\n    gl_Position=vec4(p,1.);\n    vUv=uv;\n}\n",fragmentShader:"\nvarying vec2 vUv;\n\nuniform sampler2D uEnvmap1;\nuniform sampler2D uEnvmap2;\nuniform float uWeight;\nuniform float uIntensity;\n\nvoid main(){\n    vec2 uv=vUv;\n    vec3 envmap1=texture(uEnvmap1,uv).xyz;\n    vec3 envmap2=texture(uEnvmap2,uv).xyz;\n    vec3 col=mix(envmap1,envmap2,uWeight)*uIntensity;\n    gl_FragColor=vec4(col,1.);\n}\n",uniforms:{uEnvmap1:{value:i},uEnvmap2:{value:n},uWeight:{value:0},uIntensity:{value:1}}});this.material=o;const l=new pL(o);this.quad=l,Zv(this,vL,e.signal.onAppUpdate.add((()=>{this.update()})),"f")}dispose(){var e;null===(e=qv(this,vL,"f"))||void 0===e||e.call(this)}update(){this.app.renderer.setRenderTarget(this.fbo),this.quad.render(this.app.renderer),this.app.renderer.setRenderTarget(null)}get texture(){return this.fbo.texture}setWeight(e){this.material.uniforms.uWeight.value=e}setIntensity(e){this.material.uniforms.uIntensity.value=e}lerpWeight(e,t){new ky(this.material.uniforms.uWeight).to(t,{value:e}).start()}lerpIntensity(e,t){new ky(this.material.uniforms.uIntensity).to(t,{value:e}).start()}}vL=new WeakMap;const xL=(e,t)=>{e.source=Vv(e.source),e.target=Vv(e.target),null!=t||(t=Cy.app);const{source:n,target:r,height:o,size:l,color:h,color2:c,count:d,range:u,opacity:p}=e,f=[],m=[],g=[],v=[],y=new i(n.x,n.y,n.z),x=new i(r.x,r.y,r.z),w=x.clone().lerp(y,.5);t.isMapMode?w.z+=o||0:w.y+=o||0;const b=new Se(y,w,x);let _=d||1e3;b.getPoints(d).forEach(((e,t)=>{const i=t/(_-1);f.push({x:e.x,y:e.y,z:e.z}),g.push(i),v.push(t)})),f.forEach((e=>{m.push(e.x,e.y,e.z)}));const C=new S;C.setAttribute("position",new M(m,3)),C.setAttribute("index",new M(g,1)),C.setAttribute("current",new M(v,1));const A=new a({transparent:!0,depthWrite:!1,depthTest:!1,uniforms:{uColor:{value:new s(h)},uColor2:{value:new s(c||h)},uRange:{value:u||500},uSize:{value:l||(t.isMapMode?2e3:20)},uOpacity:{value:p||1},uTotal:{value:_},time:{value:0}},vertexShader:"\n    attribute float index;\n    attribute float current;\n    uniform float time;\n    uniform float uSize;\n    uniform float uOpacity;\n    uniform float uRange; // 展示区间\n    uniform float uTotal; // 粒子总数\n    uniform vec3 uColor; \n    uniform vec3 uColor2; \n    varying vec3 vColor;\n    varying float vOpacity;\n    void main() {\n        // 需要当前显示的索引\n        float size = uSize;\n        float showNumber = uTotal * mod(time, 1.1);\n        if (showNumber > current && showNumber < current + uRange) {\n            float uIndex = ((current + uRange) - showNumber) / uRange;\n            size *= uIndex;\n            vOpacity = uOpacity * uIndex;\n            vColor = mix(uColor, uColor2, uIndex);\n        } else {\n            vOpacity = 0.0;\n            vColor = uColor;\n        }\n        // 顶点着色器计算后的Position\n        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n        gl_Position = projectionMatrix * mvPosition; \n        // 大小\n        gl_PointSize = size  / (-mvPosition.z);\n    }",fragmentShader:"\n    varying vec3 vColor; \n    varying float vOpacity;\n    void main() {\n        gl_FragColor = vec4(vColor, vOpacity);\n    }"}),E=new me(C,A);let T=UP.fromObject3d(E);return T.addAction((({timeDelta:t})=>{var i;E&&E.material&&(E.material.uniforms.time.value+=t*(null!==(i=null==e?void 0:e.speed)&&void 0!==i?i:1),E.material.uniforms.time.value>60&&(E.material.uniforms.time.value=0))})),T.addTo(t),T};class wL extends Sy{constructor(e,t){super(e),this.options=null!=t?t:{},this.billboard=nD(Object.assign({object:e.node},t)),this.addDispose((()=>{this.billboard.dispose()}))}setupUiConfig(){var e,t,i,n,s;let r={follow:null===(e=this.options.follow)||void 0===e||e,lockX:null!==(t=this.options.lockX)&&void 0!==t&&t,lockY:null!==(i=this.options.lockY)&&void 0!==i&&i,lockZ:null!==(n=this.options.lockZ)&&void 0!==n&&n,baseOnPreRotation:null!==(s=this.options.baseOnPreRotation)&&void 0!==s&&s};return{type:"folder",expanded:!0,app:this.app,label:"参数",children:$T(r),onChange:e=>{this.billboard.updateProps(r)}}}onAppUpdate(e){this.app.camera&&this.billboard.update(this.app.camera)}}wL.moduleName="BillboardModule";const bL=new s;class _L extends Sy{constructor(e,t){super(e),this.outlines=[],t=null!=t?t:{},this.options=Object.assign({color:new s(16776960),opacity:1,transparent:!1,thickness:1,angle:Math.PI,pulsePeriod:3},t);let i=[];e.node.traverse((e=>{(e.skeleton||e.isInstancedMesh||e.isMesh)&&-1==e.type.indexOf("Helper")&&i.push(e)})),i.forEach((e=>{let t=rD(this.options);e.add(t.group),t.generate(),this.outlines.push(t)})),this.addDispose((()=>{this.outlines.forEach((e=>{e.dispose()})),this.outlines=[]}))}onAppUpdate(e){if(!this.app.camera)return;if(!this.options.pulsePeriod)return;bL.copy(this.options.color);const t=.625+.75*Math.cos(.01*performance.now()/this.options.pulsePeriod)/2;bL.multiplyScalar(t),this.outlines.forEach((e=>{e.updateProps({color:bL})}))}}var SL,ML,CL,AL,EL,TL,PL,OL,DL;_L.moduleName="OutlineModule";class BL extends Sy{constructor(e,t){super(e),SL.set(this,void 0),Zv(this,SL,hD(t),"f"),qv(this,SL,"f").init().then((t=>{e.addObjects(qv(this,SL,"f").group),this.isLoaded=!0,this.dispatch("onLoaded",qv(this,SL,"f"))})).catch((e=>{console.error(e)})),this.addDispose((()=>{e.removeObjects(qv(this,SL,"f").group)}))}setupUiConfig(){return{type:"folder",expanded:!0,label:"模块参数设置",app:this.app,children:$T(this)}}get spriteAnimator(){return qv(this,SL,"f")}onAppUpdate(e){this.isLoaded&&qv(this,SL,"f")&&qv(this,SL,"f").update()}pauseAnimation(){this.isLoaded&&qv(this,SL,"f")&&qv(this,SL,"f").pauseAnimation()}playAnimation(){this.isLoaded&&qv(this,SL,"f")&&qv(this,SL,"f").playAnimation()}setFrameName(e){this.isLoaded&&this.spriteAnimator&&this.spriteAnimator.setFrameName(e)}}SL=new WeakMap,BL.moduleName="SpriteAnimatorModule",Xv([lP("暂停动画")],BL.prototype,"pauseAnimation",null),Xv([lP("开始动画")],BL.prototype,"playAnimation",null),function(e){e[e.Initial=0]="Initial",e[e.Running=1]="Running",e[e.Succeeded=2]="Succeeded",e[e.Failed=3]="Failed",e[e.Suspended=4]="Suspended",e[e.Invalid=5]="Invalid"}(ML||(ML={}));class IL{constructor(){this.context=null,this.onInitialized=new cy,this.onFinalized=new cy}tick(e){throw new Error("Abstract method, needs to be overridden")}initialize(e){this.context=e,this.onInitialized.dispatch(this,e)}finalize(){this.onFinalized.dispatch(this)}}IL.prototype.isBehavior=!0,IL.prototype.typeName="Behavior";class RL extends IL{constructor(){super(),this.__source=null,this.isDecoratorBehavior=!0,this.typeName="AbstractDecoratorBehavior"}getSource(){return this.__source}setSource(e){this.__source=e}initialize(e){this.__source.initialize(e),super.initialize(e)}finalize(){this.__source.finalize(),super.finalize()}}class kL extends RL{constructor(){super(),this.typeName="ConditionalBehavior",this.condition=null}setCondition(e){this.condition=e}tick(e){const t=this.condition;t.initialize(this.context);const i=t.tick(e);return i===ML.Succeeded?(t.finalize(),this.__source.tick(e)):i===ML.Failed?(t.finalize(),i):i}finalize(){super.finalize(),this.condition.finalize()}static from(e,t){const i=new kL;return i.setCondition(e),i.setSource(t),i}}class LL extends IL{constructor(e=""){super(),this.typeName="LogMessageBehavior",this.message=e}static from(e){return new LL(e)}tick(e){return console.log(this.message),ML.Succeeded}}class zL extends IL{constructor(){super(),this.typeName="SendEventBehavior",this.event="",this.data={},this.target=null}fromJSON({event:e,data:t={},target:i=null}){this.event=e,this.data=t,this.target=i}static fromJSON(e){const t=new zL;return t.fromJSON(e),t}tick(e){return(this.target?this.target:this.context.entity).dispatch(this.event,this.data),ML.Succeeded}}class UL extends IL{constructor(e,t){super(),CL.set(this,void 0),this.typeName="ActionBehavior",this.__action=e,Zv(this,CL,null!=t?t:{},"f"),void 0===qv(this,CL,"f").context?this.__context=this:this.__context=qv(this,CL,"f").context}tick(e){var t,i;try{this.context.timeDelta=e,null!==(t=(i=this.context).elapsed)&&void 0!==t||(i.elapsed=0),this.context.elapsed+=e;let n=this.__action.call(this.__context,this.context);return"number"==typeof n&&n>=0&&n<5?n:qv(this,CL,"f").isRepeat?ML.Running:ML.Succeeded}catch(e){return console.warn(e),ML.Failed}}}CL=new WeakMap;class FL extends IL{constructor(){super(),this.typeName="DelayBehavior",this.value=0,this.elapsed=0}fromJSON({value:e,elapsed:t=0}){this.value=e,this.elapsed=t}static fromJSON(e){const t=new FL;return t.fromJSON(e),t}static from(e){const t=new FL;return t.value=e,t}initialize(e){super.initialize(e),this.elapsed=0}tick(e){return this.elapsed+=e,this.elapsed>=this.value?ML.Succeeded:ML.Running}}class NL extends IL{constructor(){super(),this.__children=[],this.typeName="CompositeBehavior"}addChild(e){this.__children.push(e)}addChildren(e){const t=e.length;for(let i=0;i<t;i++){const t=e[i];this.addChild(t)}}getChildren(){return this.__children}removeChild(e){const t=this.__children.indexOf(e);return-1!==t&&(this.__children.splice(t,1),!0)}clearChildren(){this.__children=[]}}!function(e){e[e.RequireOne=0]="RequireOne",e[e.RequireAll=1]="RequireAll"}(AL||(AL={}));class jL extends NL{constructor(e,t){super(),this.typeName="ParallelBehavior",this.successPolicy=e,this.failurePolicy=t,this.activeSet=new ZW,this.successCount=0,this.failureCount=0,this.isParallelBehavior=!0,this.typeName="ParallelBehavior"}getSuccessPolicy(){return this.successPolicy}setSuccessPolicy(e){this.successPolicy=e}getFailurePolicy(){return this.failurePolicy}setFailurePolicy(e){this.failurePolicy=e}tick(e){const t=this.activeSet,i=this.__children,n=i.length;let s;for(s=0;s<n;s++){if(!t.get(s))continue;const n=i[s],r=n.tick(e);if(r===ML.Succeeded){if(t.set(s,!1),this.successCount++,n.finalize(),this.successPolicy===AL.RequireOne)return this.__finalizeActiveChildren(),ML.Succeeded}else if(r===ML.Failed){if(t.set(s,!1),this.failureCount++,n.finalize(),this.failurePolicy===AL.RequireOne)return this.__finalizeActiveChildren(),ML.Failed;if(this.successPolicy===AL.RequireAll)return this.__finalizeActiveChildren(),ML.Failed}}return this.successCount===n&&this.successPolicy===AL.RequireAll?ML.Succeeded:this.failureCount===n&&this.failurePolicy===AL.RequireAll||this.failureCount+this.successCount===n?ML.Failed:ML.Running}initialize(e){this.successCount=0,this.failureCount=0;const t=this.__children,i=t.length;for(let n=0;n<i;n++)t[n].initialize(e),this.activeSet.set(n,!0);super.initialize(e)}__finalizeActiveChildren(){const e=this.__children,t=this.activeSet;for(let i=t.nextSetBit(0);-1!==i;i=t.nextSetBit(i+1))e[i].finalize()}finalize(){this.__finalizeActiveChildren(),super.finalize()}static from(e,t=AL.RequireAll,i=AL.RequireOne){const n=new jL(t,i);return n.addChildren(e),n}}class VL extends NL{constructor(){super(),this.typeName="SequenceBehavior",this.__currentBehaviourIndex=-1,this.__currentBehaviourState=ML.Initial,this.__currentBehaviour=void 0,this.isSequenceBehavior=!0}initialize(e){this.__currentBehaviourIndex=0,this.__currentBehaviour=this.__children[0],this.__currentBehaviour.initialize(e),this.__currentBehaviourState=ML.Running,super.initialize(e)}tick(e){const t=this.__currentBehaviour,i=t.tick(e);return this.__currentBehaviourState=i,i!==ML.Succeeded?i:(t.finalize(),this.__currentBehaviourState=ML.Initial,this.__currentBehaviourIndex++,this.__currentBehaviourIndex<this.__children.length?(this.__currentBehaviour=this.__children[this.__currentBehaviourIndex],this.__currentBehaviour.initialize(this.context),this.__currentBehaviourState=ML.Running,ML.Running):ML.Succeeded)}finalize(){const e=this.__children.length;this.__currentBehaviourIndex!==e&&void 0!==this.__currentBehaviour&&this.__currentBehaviourState!==ML.Initial&&this.__currentBehaviour.finalize(),this.__currentBehaviour=void 0,this.__currentBehaviourIndex=e,super.finalize()}static from(e){const t=new VL;return t.addChildren(e),t}}class HL extends IL{constructor(){super(),this.typeName="DestoryBehavior"}static create(){return new HL}tick(e){if(!this.context)return ML.Succeeded;const t=this.context.entity;return t?(t.remove(),ML.Succeeded):ML.Succeeded}}class WL extends IL{constructor(e){super(),this.typeName="PromiseBehavior",this.__factory=e,this.__promise=null,this.__promise_state=ML.Running}initialize(e){super.initialize(e),this.__promise=this.__factory(),this.__promise_state=ML.Running,this.__promise.then((()=>{this.__promise_state=ML.Succeeded}),(()=>{this.__promise_state=ML.Failed}))}tick(e){return this.__promise_state}}class GL extends IL{constructor(e=0){super(),this.delayTicks=e,this.typeName="SucceedingBehavior"}tick(e){return 0===this.delayTicks?ML.Succeeded:(this.delayTicks--,ML.Running)}}GL.INSTANCE=new GL;class YL extends IL{constructor(e=0){super(),this.delayTicks=e,this.typeName="FailingBehavior"}tick(e){return 0===this.delayTicks?ML.Failed:(this.delayTicks--,ML.Running)}}YL.INSTANCE=new YL;class XL extends RL{constructor(e,t=1/0){super(),this.typeName="RepeatBehavior",this.limit=t,this.__iterator=0,this.setSource(e),this.typeName="RepeatBehavior"}setCount(e){this.limit=e}getCount(){return this.limit}static from(e,t=1/0){return new XL(e,t)}initialize(e){this.__iterator=0,super.initialize(e)}tick(e){const t=this.__source,i=t.tick(e);return i!==ML.Succeeded&&i!==ML.Failed?i:(this.__iterator++,this.__iterator>=this.limit?ML.Succeeded:(t.initialize(this.context),ML.Running))}}class QL extends IL{constructor(){super(),EL.set(this,void 0),this.event="",this.detected=!1,this.target=null,this.typeName="WaitForEventBehavior"}fromJSON(e){this.event=e.event,this.target=e.target}static fromJSON(e){const t=new QL;return t.fromJSON(e),t}tick(e){return this.detected?ML.Succeeded:ML.Running}listener(){this.detected=!0;const e=this.target?this.target:this.context.entity;qv(this,EL,"f")&&e.off(this.event,qv(this,EL,"f"))}initialize(e){super.initialize(e),this.detected=!1;const t=this.target?this.target:this.context.entity;Zv(this,EL,this.listener.bind(this),"f"),t.on(this.event,qv(this,EL,"f"))}finalize(){super.finalize(),(this.target?this.target:this.context.entity).off(this.event,this.listener)}}EL=new WeakMap;const qL=new GL;class ZL extends IL{constructor(){super(),TL.set(this,qL),PL.set(this,qL),OL.set(this,qL),DL.set(this,null),this.typeName="BranchBehavior"}static from(e,t=qL,i=qL){const n=new ZL;return Zv(n,OL,e,"f"),Zv(n,TL,t,"f"),Zv(n,PL,i,"f"),n}initialize(e){super.initialize(e),Zv(this,DL,qv(this,OL,"f"),"f"),qv(this,DL,"f").initialize(e)}tick(e){const t=qv(this,DL,"f").tick(e);return t!==ML.Succeeded&&t!==ML.Failed||qv(this,DL,"f")!==qv(this,OL,"f")?t:(qv(this,DL,"f").finalize(),t===ML.Succeeded?Zv(this,DL,qv(this,TL,"f"),"f"):Zv(this,DL,qv(this,PL,"f"),"f"),qv(this,DL,"f").initialize(this.context),qv(this,DL,"f").tick(e))}finalize(){super.finalize(),null!==qv(this,DL,"f")&&qv(this,DL,"f").finalize()}}TL=new WeakMap,PL=new WeakMap,OL=new WeakMap,DL=new WeakMap;class KL extends VL{constructor(){super(),this.typeName="FilterBehavior"}static from(e,t){const i=new KL;return e&&e.forEach((e=>i.addCondition(e))),t&&t.forEach((e=>i.addAction(e))),i}addChild(e){throw new Error("Direct injection of children is not allowed, use addCodition and addAction isntead")}addCondition(e){this.__children.unshift(e)}addAction(e){this.__children.push(e)}}class JL extends RL{constructor(e,t=1/0){super(),this.typeName="RepeatUntilFailureBehavior",this.__limit=t,this.__iterator=0,this.setSource(e)}static from(e,t=1/0){return new JL(e,t)}tick(e){const t=this.__source.tick(e);return t===ML.Failed?ML.Succeeded:t===ML.Running?t:(this.__iterator++,this.__iterator>=this.__limit?ML.Failed:(this.__source.initialize(this.context),ML.Running))}}class $L extends RL{IgnoreFailureBehavior(){this.typeName="IgnoreFailureBehavior"}static from(e){const t=new $L;return t.setSource(e),t}tick(e){const t=this.__source.tick(e);return t===ML.Failed?ML.Succeeded:t}}class ez extends RL{constructor(e,t=1/0){super(),this.typeName="RepeatUntilSuccessBehavior",this.__limit=t,this.__source=e,this.__iterator=0}static from(e,t=1/0){return new ez(e,t)}tick(e){const t=this.__source.tick(e);return t===ML.Succeeded||t===ML.Running?t:(this.__iterator++,this.__iterator>=this.__limit?ML.Failed:(this.__source.initialize(this.context),ML.Running))}}class tz extends IL{constructor(e){super(),this.typeName="ConditionBehavior",this.__accessor=e}tick(e){return this.__accessor()?ML.Succeeded:ML.Failed}}class iz extends RL{constructor(e){super(),this.setSource(e),this.typeName="InverterBehavior"}static from(e){return new iz(e)}tick(e){let t=this.__source.tick(e);return t===ML.Succeeded?t=ML.Failed:t===ML.Failed&&(t=ML.Succeeded),t}}class nz extends NL{constructor(){super(),this.typeName="SelectorBehavior",this.__currentBehaviour=null,this.__currentBehaviourIndex=-1}static from(e){const t=new nz;return e.forEach(t.addChild,t),t}tick(e){if(this.__children.length<1)return ML.Failed;for(;;){const t=this.__currentBehaviour.tick(e);if(t!==ML.Failed)return t;this.__currentBehaviour.finalize();const i=this.__children;if(this.__currentBehaviourIndex++,this.__currentBehaviourIndex>=i.length)return this.__currentBehaviour=null,ML.Failed;this.__currentBehaviour=i[this.__currentBehaviourIndex],this.__currentBehaviour.initialize(this.context)}}finalize(){null!==this.__currentBehaviour&&(this.__currentBehaviour.finalize(),this.__currentBehaviour=null),super.finalize()}initialize(e){const t=this.__children;t.length>0?(this.__currentBehaviourIndex=0,this.__currentBehaviour=t[0],this.__currentBehaviour.initialize(e)):(this.__currentBehaviourIndex=-1,this.__currentBehaviour=null),super.initialize(e)}}class sz extends IL{constructor(){super(),this.typeName="RotationBehavior",this.axis=new i,this.speed=1,this.angle=0,this.__offset=new v}static fromJSON(e){const t=new sz;return t.fromJSON(e),t}fromJSON(e){var t,n,s,r;this.axis=null!==(t=e.axis)&&void 0!==t?t:new i(0,1,0),this.speed=null!==(n=e.speed)&&void 0!==n?n:1,this.angle=null!==(s=e.angle)&&void 0!==s?s:0,this.resetWhenFinalize=null!==(r=e.resetWhenFinalize)&&void 0!==r&&r}initialize(e){super.initialize(e);const t=e.entity;this.__offset.copy(t.quaternion)}tick(e){const t=this.context.entity,i=this.speed*e;this.angle+=i;const n=t.quaternion;return n.setFromAxisAngle(this.axis,this.angle),n.multiplyQuaternions(n,this.__offset),ML.Running}finalize(){if(this.resetWhenFinalize&&this.context){const e=this.context.entity;e&&e.quaternion.copy(this.__offset)}super.finalize()}}class rz{constructor(e,t,i){this.track=e,this.position=e.timeStart,this.updateCallback=t,this.updateTraget=i,this.__lastKeyIndex=0,this.__lastTransitionIndex=0,this.__nextKeyIndex=0,this.__nextKeyTime=0,this.__loop=!1,this.__valueBuffer=new Float64Array(e.propertyCount),this.on={ended:new cy},this.setPosition(0)}promiseEnded(){return this.position>=this.track.timeEnd?Promise.resolve():new Promise(((e,t)=>{this.on.ended.add(e)}))}setLoop(e){this.__loop=e}isLoop(){return this.__loop}reset(){this.setPosition(this.track.timeStart)}setPosition(e){this.position=e;const t=this.track,i=t.transitionIndexAt(e);this.__lastTransitionIndex=i,this.__lastKeyIndex=-1!==i?t.transitionKeys[i]:t.keyLowerBoundIndexAt(e);const n=t.keyTimes.length;this.__nextKeyIndex=n>1?Fv(this.__lastKeyIndex+1,n-1):this.__lastKeyIndex,this.__nextKeyTime=t.keyTimes[this.__nextKeyIndex]}advanceKey(){const e=this.track,t=e.keyTimes.length;if(this.__lastKeyIndex===t-1){if(!this.__loop)return this.__lastTransitionIndex=-1,this.on.ended.dispatch(),!1;this.__lastKeyIndex=-1}this.__lastKeyIndex=this.__lastKeyIndex+1,this.__nextKeyTime=e.keyTimes[Math.min(this.__lastKeyIndex+1,t-1)];const i=e.transitionKeys,n=i.length;for(let e=this.__lastTransitionIndex+1;e<n;e++){const t=i[e];if(t===this.__lastKeyIndex){this.__lastTransitionIndex=e;break}if(t>this.__lastKeyIndex){this.__lastTransitionIndex=-1;break}}return!0}advance(e){let t=this.position+e;e<0?this.setPosition(t):t>this.__nextKeyTime?(t>=this.track.timeEnd&&(this.__loop?t%=this.track.timeEnd:this.on.ended.dispatch()),this.setPosition(t)):this.position=t,this.update()}update(){var e;this.readCurrentValues(this.__valueBuffer),this.updateCallback&&this.updateCallback.apply(null!==(e=this.updateTraget)&&void 0!==e?e:this,this.__valueBuffer)}readCurrentValues(e){const t=this.track,i=this.__lastKeyIndex;if(-1!==this.__lastTransitionIndex){const n=this.__nextKeyTime,s=t.keyTimes[i],r=n-s,o=(this.position-s)/r,a=(0,t.transitionFunctions[this.__lastTransitionIndex])(o),l=t.propertyCount,h=t.keyValues,c=i*l,d=c+l;for(let t=0;t<l;t++){const i=h[t+c],n=a*(h[t+d]-i)+i;e[t]=n}}else t.readKeyValues(i,e)}}class oz{constructor(e){this.properties=e,this.propertyCount=e.length,this.keyValues=[],this.keyTimes=[],this.timeStart=Number.POSITIVE_INFINITY,this.timeEnd=Number.NEGATIVE_INFINITY,this.transitionKeys=[],this.transitionFunctions=[]}optimize(){const e=this.keyValues.length,t=this.keyTimes.length,i=new ArrayBuffer(4*t+8*e),n=new Float32Array(i,0,t),s=new Float64Array(i,4*t,e);s.set(this.keyValues,0),this.keyValues=s,n.set(this.keyTimes,0),this.keyTimes=n}addKey(e,t){if(t.length!==this.propertyCount)throw new Error("Number of supplied values("+t.length+") does not match number of track properties("+this.propertyCount+")");if(0===this.keyTimes.length)this.timeStart=e;else{if(e<this.timeEnd)throw new Error("Attempted to insert key in the past. Keys must be sequential");if(e===this.timeEnd)throw new Error("Attempted to insert key at the same time as already existing key")}this.timeEnd=e,Array.prototype.push.apply(this.keyValues,t),this.keyTimes.push(e)}addTransition(e,t){this.transitionKeys.push(e),this.transitionFunctions.push(t)}keyLowerBoundIndexAt(e){const t=this.keyTimes,i=t.length;for(let n=0,s=i;n<s;n++)if(t[n]>e)return n-1;return i-1}transitionIndexAt(e){const t=this.transitionKeys,i=t.length,n=this.keyTimes;for(let s=0,r=i;s<r;s++){const i=t[s];if(!(n[i+1]<e))return n[i]<=e?s:-1}return-1}readKeyValues(e,t){const i=this.propertyCount,n=i*e,s=this.keyValues;for(let e=0;e<i;e++)t[e]=s[e+n]}}class az extends IL{constructor(e){super(),this.animation=e,this.typeName="AnimationBehavior"}tick(e){return this.animation.advance(e),this.animation.position>=this.animation.track.timeEnd&&!this.animation.isLoop()?ML.Succeeded:ML.Running}initialize(){this.animation.setPosition(this.animation.track.timeStart)}}class lz extends Sy{constructor(e,t){super(e),t=null!=t?t:[],this.behaviors=Array.isArray(t)?t:[t],this.behaviors.forEach((e=>e.initialize({entity:this.entity}))),this.ids=this.behaviors.map((e=>{var t;return null!==(t=e.uuid)&&void 0!==t?t:uv()}))}addBehavior(e,t){var i;let n=this.behaviors.indexOf(e);return n>=0?this.ids[n]:(e.initialize({entity:this.entity}),this.behaviors.push(e),null!=t||(t=null!==(i=e.uuid)&&void 0!==i?i:uv()),this.ids.push(t),t)}addAction(e,t){let i=new UL(e,{isRepeat:!0});return this.addBehavior(i,t)}removeBehavior(e){const t=this.behaviors.indexOf(e);t>=0&&(this.behaviors.splice(t,1),this.ids.splice(t,1)),e.finalize()}removeBehaviorByTypeName(e){this.behaviors.filter((t=>t.typeName==e)).forEach((e=>this.removeBehavior(e)))}removeBehaviorById(e){let t=this.ids.indexOf(e);t>=0&&t<this.behaviors.length&&this.removeBehavior(this.behaviors[t])}getBehaviorById(e){let t=this.ids.indexOf(e);if(t>=0&&t<this.behaviors.length)return this.behaviors[t]}getBehaviors(){return this.behaviors}onAppUpdate(e){this.entity.app&&this.behaviors.forEach(((t,i)=>{let n=t.tick(e.deltaTime);n!=ML.Initial&&n!=ML.Running&&(this.behaviors.splice(i,1),this.ids.splice(i,1),t.finalize())}))}setupUiConfig(){return{type:"folder",expanded:!0,label:"所有行为",children:[()=>this.behaviors.map((e=>({type:"folder",expanded:!1,app:this.app,label:e.typeName,children:[{type:"checkbox",label:"启用",getValue:()=>this.behaviors.indexOf(e)>=0,setValue:t=>{t?this.addBehavior(e):this.removeBehavior(e)}}]})))]}}}var hz,cz,dz,uz;lz.moduleName="BehaviorModule";class pz extends Sy{constructor(e,t){super(e),hz.set(this,void 0),e.onEntityAwake((i=>{Zv(this,hz,new TD(t,i),"f"),e.addObjects(qv(this,hz,"f"))})),this.addDispose((()=>{qv(this,hz,"f")&&(qv(this,hz,"f").dispose(),e.removeObjects(qv(this,hz,"f")))}))}get SpriteMarker(){return qv(this,hz,"f")}setupUiConfig(){return{type:"folder",expanded:!0,label:"模块参数设置",app:this.app,children:[{type:"button",label:"允许重叠",onClick:()=>{qv(this,hz,"f").setAllowOverlap(!0)}},{type:"button",label:"不允许重叠",onClick:()=>{qv(this,hz,"f").setAllowOverlap(!1)}}]}}}hz=new WeakMap,pz.moduleName="SpriteMarkerModule";class fz extends Sy{constructor(e,t){super(e),cz.set(this,void 0),e.onEntityAwake((i=>{Zv(this,cz,new PD(t,i),"f"),e.addObjects(qv(this,cz,"f"))})),this.addDispose((()=>{qv(this,cz,"f")&&(qv(this,cz,"f").dispose(),e.removeObjects(qv(this,cz,"f")))}))}get SpriteImages(){return qv(this,cz,"f")}}cz=new WeakMap,fz.moduleName="SpriteImagesModule";class mz extends Sy{constructor(e,t){super(e),dz.set(this,void 0),e.onEntityAwake((i=>{Zv(this,dz,new OD(t,i),"f"),e.addObjects(qv(this,dz,"f"))})),this.addDispose((()=>{qv(this,dz,"f")&&(qv(this,dz,"f").dispose(),e.removeObjects(qv(this,dz,"f")))}))}get SpriteTexts(){return qv(this,dz,"f")}}dz=new WeakMap,mz.moduleName="SpriteTextsModule";class gz extends Sy{constructor(e,t){super(e),uz.set(this,[]),t=null!=t?t:[],Array.isArray(t)||(t=[t]),t.forEach((e=>this.addParticle(e)))}getParticles(e){if(void 0===e)return qv(this,uz,"f");{let t=[];for(let i=qv(this,uz,"f").length-1;i>=0;i--)qv(this,uz,"f")[i].name==e&&t.push(qv(this,uz,"f")[i]);return t}}addParticle(e){this.entity.onEntityAwake((t=>{e.resource?qv(this,uz,"f").push(t.loadParticleFromRes(!1!==e.isCloneRes?e.resource.clone():e.resource,Object.assign(Object.assign({},e),{parent:this.entity.node}))):qv(this,uz,"f").push(t.addParticle(Object.assign(Object.assign({},e),{parent:this.entity.node})))}))}removeParticle(e){if(void 0===e)qv(this,uz,"f").forEach((e=>this.app.removeParticle(e))),Zv(this,uz,[],"f");else for(let t=qv(this,uz,"f").length-1;t>=0;t--)qv(this,uz,"f")[t].name==e&&(this.app.removeParticle(qv(this,uz,"f")[t]),hv(qv(this,uz,"f"),qv(this,uz,"f")[t]))}}uz=new WeakMap,gz.moduleName="ParticleModule";class vz extends Sy{constructor(e,t){if(super(e),this.animators=[],(t=null!=t?t:{}).isAnimator)this.animators.push(t);else{let i=t;i.object=e.node,this.animators.push(new BD({object:i.object,animations:i.animations}))}this.addDispose((()=>{this.animators.forEach((e=>e.dispose()))}))}setupUiConfig(){let e={index:1};return{type:"folder",expanded:!0,app:this.app,label:"动画参数",children:[()=>({type:"slider",label:`动画索引(${e.index}/${this.animators.length})`,property:[e,"index"],bounds:[1,this.animators.length],stepSize:1,onChange:t=>{e.index=t.value,this.uiConfig.uiRefresh(!1)}}),()=>this.getAnimator(e.index-1).uiConfig]}}getAnimator(e){if((e=null!=e?e:0)<this.animators.length)return this.animators[e]}addAnimator(e){let t=new BD(e);return this.animators.push(t),t}removeAnimator(e){"number"==typeof e&&e<this.animators.length?this.animators.splice(e,1):hv(this.animators,e)}onAppUpdate(e){this.app.camera&&this.animators.forEach((t=>t.update(e.deltaTime)))}}vz.moduleName="AnimatorModule";class yz extends Sy{constructor(e,t){super(e),this.signal={onLoad:new cy,onError:new cy},iL.loadModel(t.url,Object.assign(Object.assign({},t),{toEntity:!0})).then((t=>{this.modelEntity=t,e.addChildEntity(t),this.signal.onLoad.dispatch(this.modelEntity)})).catch((e=>{this.signal.onError.dispatch(this.modelEntity)})),this.addDispose((()=>{this.modelEntity&&this.modelEntity.remove()}))}getMeshEntities(){let e=[];return this.modelEntity&&this.modelEntity.traverse((t=>e.push(t)),(e=>e.isMeshEntity)),e}}yz.moduleName="ModelModule";const xz={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},wz={center:"50% 50%",top:"50% 0","top-left":"0 0","top-right":"100% 0",bottom:"50% 100%","bottom-left":"0 100%","bottom-right":"100% 100%",left:"0 50%",right:"100% 50%"};class bz{static create(e,t,i){const n=window.document.createElement(e);return void 0!==t&&(n.className=t),i&&i.appendChild(n),n}static createNS(e,t){return window.document.createElementNS(e,t)}static isMobile(){const e=navigator.userAgent.toLowerCase();return["android","iphone","ipad","ipod","windows phone"].some((t=>e.includes(t)))}static setTransform(e,t){e.style.transform=t}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static createStyledDiv(e,t){let i=document.createElement("div");if(i.innerHTML=e,t){let e=document.createElement("style");e.textContent=t,i.appendChild(e)}return i}}class _z{constructor(e,t){this.editor=e,this.transition=(e,t={})=>{var i;const n=e.split(".");let s=this;for(let e=0;e<n.length;e++){const r=n[e],o=s.getCurrent(),a=null===(i=s.children)||void 0===i?void 0:i[r];if(!a)throw Error(`${s.id} - no child state exists with the id ${r}.`);if((null==o?void 0:o.id)!==a.id&&(null==o||o.exit(t,r),s._current.value=a,a.enter(t,(null==o?void 0:o.id)||"initial"),!a.getIsActive()))break;s=a}return this},this.handleEvent=e=>{var t;const i=e.name,n=this.getCurrent();null===(t=this[i])||void 0===t||t.call(this,e),this.getCurrent()===n&&this.getIsActive()&&(null==n||n.handleEvent(e))},this.enter=(e,t)=>{var i,n;if(this._isActive.value=!0,e.onInteractionEnd&&(null===(i=this.parent)||void 0===i||i.setCurrentToolIdMask(e.onInteractionEnd)),e.onEnterCallBack&&e.onEnterCallBack(this,e,t),null===(n=this.onEnter)||void 0===n||n.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.value=i,i.enter(e,t)}},this.exit=(e,t)=>{var i,n,s;this._isActive.value=!1,e.onInteractionEnd&&(null===(i=this.parent)||void 0===i||i.setCurrentToolIdMask(void 0)),null===(n=this.onExit)||void 0===n||n.call(this,e,t),e.onExitCallBack&&e.onExitCallBack(this,e),this.getIsActive()||null===(s=this.getCurrent())||void 0===s||s.exit(e,t)},this._currentToolIdMask=bg("");const{id:i,children:n,initial:s}=this.constructor;this.app=e,this.id=i,this._isActive=bg(!1),this._current=bg(void 0),this.parent=t,this.parent?n&&s?(this.type="branch",this.initial=s,this.children=Object.fromEntries(n().map((e=>[e.id,new e(this.editor,this)]))),this._current.value=this.children[this.initial]):this.type="leaf":(this.type="root",n&&s&&(this.initial=s,this.children=Object.fromEntries(n().map((e=>[e.id,new e(this.editor,this)]))),this._current.value=this.children[this.initial]))}getPath(){const e=this.getCurrent();return this.id+(e?`.${e.getPath()}`:"")}getCurrent(){return this._current.value}getIsActive(){return this._isActive.value}setIsActive(e){this._isActive.value=e}getCurrentToolIdMask(){return this._currentToolIdMask.value}setCurrentToolIdMask(e){this._currentToolIdMask.value=e}}let Sz=class extends _z{};Sz.id="idle";class Mz extends _z{}var Cz,Az,Ez,Tz,Pz,Oz,Dz,Bz,Iz,Rz,kz,Lz,zz,Uz,Fz,Nz,jz,Vz,Hz,Wz,Gz,Yz,Xz,Qz,qz,Zz,Kz,Jz,$z,eU;Mz.id="default",Mz.initial="idle",Mz.children=()=>[Sz];class tU extends _z{constructor(){super(...arguments),Cz.add(this),this.snapSymbolData=[],Az.set(this,void 0),Ez.set(this,void 0),this.onPointerUp=e=>Qv(this,void 0,void 0,(function*(){if(!JW(e))return;if(this.app.Input.isDragging())return;let t,n=[],s=!1;this.highLightSymbolEntity&&(n=this.highLightSymbolEntity.getData(),n.length>0&&(t=new i(...n[0].position),s=!0)),yield qv(this,Cz,"m",Tz).call(this,t,e,s,n)})),this.onPointerMove=e=>Qv(this,void 0,void 0,(function*(){var t,i,n,s;let r=hG(e.event.originalEvent),o=yield this.app.unprojectAsync(r.x,r.y,this.drawOptions.unprojectOpts);if(!o)return;if(null===(t=this.drawOptions)||void 0===t?void 0:t.beforeUpdateCoordinate){let t=yield this.drawOptions.beforeUpdateCoordinate(o,!0,e,!1);t&&(o=t)}if(!this.polylines)return void((null===(i=this.drawOptions)||void 0===i?void 0:i.updateCoordinate)&&(yield this.drawOptions.updateCoordinate(o,!0,this.data)));let a=this.data.coordinates;if(a[a.length-1]=o.toArray(),!0===(null===(n=this.drawOptions)||void 0===n?void 0:n.isClosed)&&a.length>2){let e=Object.assign({},this.data);e.coordinates=[...e.coordinates,e.coordinates[0]],this.polylines.setData([e])}else this.polylines.setData([this.data]);(null===(s=this.drawOptions)||void 0===s?void 0:s.updateCoordinate)&&(yield this.drawOptions.updateCoordinate(o,!0,this.data,this.polylines))})),this.onMouseDblClick=e=>{JW(e)&&(this.complete(!0),lG(e))},this.onKeyUp=e=>{rG(e)&&!1!==e.enterKeyComplete?this.complete():oG(e)&&!1!==e.escKeyCancel?qv(this,Cz,"m",Oz).call(this):aG(e)&&!1!==e.deleteKeyDelPoint?qv(this,Cz,"m",Pz).call(this):this.drawOptions.onKeyUp&&this.drawOptions.onKeyUp(e,{complete:this.complete.bind(this),cancel:()=>qv(this,Cz,"m",Oz).call(this),data:this.data,polygons:this.polylines,addPoint:qv(this,Cz,"m",Tz).bind(this),delPoint:qv(this,Cz,"m",Pz).bind(this)})},this.onContextMenu=e=>{if(this.drawOptions.onContextMenu)this.drawOptions.onContextMenu(e,{complete:this.complete.bind(this),cancel:()=>qv(this,Cz,"m",Oz).call(this),data:this.data,polygons:this.polylines,addPoint:qv(this,Cz,"m",Tz).bind(this),delPoint:qv(this,Cz,"m",Pz).bind(this)});else if(!0!==this.drawOptions.disableUnProjectMenu)return IG(e.event.originalEvent,this.drawOptions,void 0,this.app)},this.onEnter=e=>{var t,i,n,s,r,o,a,l,h,c,d,u,p,f,m,g,v,y,x,w,b,_,S,M,C,A,E,T,P,O,D,B,I,R,k,L;if(this.drawOptions=Object.assign({},e),!1!==this.drawOptions.autoFocus&&this.app.setFocus(),this.app.setCursor("crosshair"),!1!==this.drawOptions.isSnap){if(!1!==this.drawOptions.snapDrawLayerPoint){let e=null!==(t=this.drawOptions.drawLayerName)&&void 0!==t?t:"draw";null!==(i=(L=this.app).drawLayer)&&void 0!==i||(L.drawLayer={}),(null===(n=this.app.drawLayer[e])||void 0===n?void 0:n.symbol)&&this.snapSymbolData.push(...null===(s=this.app.drawLayer[e])||void 0===s?void 0:s.symbol.getData()),(null===(r=this.app.drawLayer[e])||void 0===r?void 0:r.polylines)&&this.snapSymbolData.push(...null===(o=this.app.drawLayer[e])||void 0===o?void 0:o.polylines.getVertexData(!0)),(null===(a=this.app.drawLayer[e])||void 0===a?void 0:a.polygons)&&this.snapSymbolData.push(...null===(l=this.app.drawLayer[e])||void 0===l?void 0:l.polygons.getVertexData(!0))}this.drawOptions.snapData&&this.snapSymbolData.push(...this.drawOptions.snapData.map((e=>({position:e})))),this.snapSymbolEntity=new jP({data:this.snapSymbolData,style:this.drawOptions.snapStylePointOpacity?{size:null!==(h=this.drawOptions.snapStylePixelSize)&&void 0!==h?h:5,color:null!==(u=null===(d=null===(c=this.app)||void 0===c?void 0:c.envConfig)||void 0===d?void 0:d.snapSymbolColor)&&void 0!==u?u:"#C0C0C0",borderColor:null!==(m=null===(f=null===(p=this.app)||void 0===p?void 0:p.envConfig)||void 0===f?void 0:f.snapBorderColor)&&void 0!==m?m:"#39107B",shape:null!==(y=null===(v=null===(g=this.app)||void 0===g?void 0:g.envConfig)||void 0===v?void 0:v.snapShape)&&void 0!==y?y:void 0,transparent:!0,opacity:this.drawOptions.snapStylePointOpacity,borderWidth:2,sizeAttenuation:!1,vertexBorderColor:!1,vertexColors:!1,vertexSize:!1}:{size:null!==(x=this.drawOptions.snapStylePixelSize)&&void 0!==x?x:5,transparent:!0,opacity:0,sizeAttenuation:!1,vertexBorderColor:!1,vertexColors:!1,vertexSize:!1,colorWrite:!1,depthTest:!1},pixelRaycasting:!0}),this.snapSymbolEntity.symbolObject.userData.RaycasterThreshold=null!==(w=this.drawOptions.snapStylePixelSize)&&void 0!==w?w:5,this.snapSymbolEntity.symbolObject.userData.pointsThreshold=this.snapSymbolEntity.symbolObject.userData.RaycasterThreshold,this.snapSymbolEntity.addTo(this.app),this.highLightSymbolEntity=new jP({data:[],style:{size:null!==(S=null===(_=null===(b=this.app)||void 0===b?void 0:b.envConfig)||void 0===_?void 0:_.snapHighlightSymbolSize)&&void 0!==S?S:15,color:null!==(A=null===(C=null===(M=this.app)||void 0===M?void 0:M.envConfig)||void 0===C?void 0:C.snapHighlightSymbolColor)&&void 0!==A?A:"#EB3324",borderColor:null!==(P=null===(T=null===(E=this.app)||void 0===E?void 0:E.envConfig)||void 0===T?void 0:T.snapHighlightSymbolBorderColor)&&void 0!==P?P:"#73FBFD",shape:null!==(B=null===(D=null===(O=this.app)||void 0===O?void 0:O.envConfig)||void 0===D?void 0:D.snapHighlightSymboShape)&&void 0!==B?B:"circle",transparent:!0,opacity:null!==(k=null===(R=null===(I=this.app)||void 0===I?void 0:I.envConfig)||void 0===R?void 0:R.snapHighlightSymbolOpacity)&&void 0!==k?k:1,borderWidth:2,sizeAttenuation:!1,vertexBorderColor:!1,vertexColors:!1,vertexSize:!1}}),this.highLightSymbolEntity.addTo(this.app),this.highLightSymbolEntity.node.renderOrder=100,this.snapSymbolEntity.pointerEvents=!0,this.snapSymbolEntity.signal.onMouseOver.add((e=>{if(e.intersection.index>=0){let t=this.snapSymbolEntity.getData();this.app.project(...t[e.intersection.index].position),this.highLightSymbolEntity.setData([t[e.intersection.index]])}})),this.snapSymbolEntity.signal.onMouseOut.add((e=>{this.highLightSymbolEntity&&this.highLightSymbolEntity.setData([])}))}},this.onExit=(e,t)=>{var i;this.app.setCursor(""),this.polylines&&(this.polylines.remove(),this.polylines=null),this.snapSymbolEntity&&(this.snapSymbolEntity.remove(),this.snapSymbolEntity.signal.onMouseOut.removeAll(),this.snapSymbolEntity.signal.onMouseOver.removeAll(),this.snapSymbolEntity=null),this.highLightSymbolEntity&&(this.highLightSymbolEntity.remove(),this.highLightSymbolEntity.signal.onMouseOut.removeAll(),this.highLightSymbolEntity.signal.onMouseOver.removeAll(),this.highLightSymbolEntity=null),(null===(i=this.drawOptions)||void 0===i?void 0:i.onComplete)&&this.drawOptions.onComplete(!qv(this,Az,"f"),qv(this,Ez,"f")),Zv(this,Az,!1,"f"),Zv(this,Ez,null,"f"),this.snapSymbolData=[]}}complete(e){var t,i,n,s;e&&this.data.coordinates.length>=3&&(this.data.coordinates.length=this.data.coordinates.length-2),!0===(null===(t=this.drawOptions)||void 0===t?void 0:t.isClosed)&&this.data.coordinates.length>2&&this.data.coordinates.push(this.data.coordinates[0]);let r=Object.assign({},this.data);(null===(i=this.drawOptions)||void 0===i?void 0:i.dashed)?r.dashed=!0:r.dashed=!1,delete r.id;let o=this.drawOptions.isAddToApp;if(null!=o||(o=!0!==this.drawOptions.isActionDraw),Zv(this,Az,!0,"f"),Zv(this,Ez,r,"f"),(null===(n=this.drawOptions)||void 0===n?void 0:n.onAddData)&&(o=!1!==this.drawOptions.onAddData(r)),o){let e=null!==(s=this.drawOptions.drawLayerName)&&void 0!==s?s:"draw";this.app.getDrawLayer(e,{}).addPolylineData(r,this.drawOptions.addToCommand)}qv(this,Cz,"m",Oz).call(this)}}Az=new WeakMap,Ez=new WeakMap,Cz=new WeakSet,Tz=function(e,t,i,n){var s,r,o,a;return Qv(this,void 0,void 0,(function*(){if(n=null!=n?n:[],!e){let i=hG(t.event.originalEvent);if(!(e=yield this.app.unprojectAsync(i.x,i.y,this.drawOptions.unprojectOpts)))return}if(null===(s=this.drawOptions)||void 0===s?void 0:s.beforeUpdateCoordinate){let n=yield this.drawOptions.beforeUpdateCoordinate(e,!1,t,i);n&&(e=n)}if(this.polylines){let t=this.data.coordinates;if(t[t.length-1]=e.toArray(),t.push(e.toArray()),!0===(null===(r=this.drawOptions)||void 0===r?void 0:r.isClosed)&&t.length>2){let e=Object.assign({},this.data);e.coordinates=[...e.coordinates,e.coordinates[0]],this.polylines.setData([e])}else this.polylines.setData([this.data])}else this.data=Object.assign(Object.assign({color:"#00ff00",lineWidth:2,dashed:!0},this.drawOptions),{coordinates:[e.toArray(),e.toArray()]}),this.polylines=new GO({data:[this.data],showVertex:!0}),this.polylines.addTo(this.app);(null===(o=this.drawOptions)||void 0===o?void 0:o.updateCoordinate)&&(yield this.drawOptions.updateCoordinate(e,!1,this.data,this.polylines)),0==n.length&&!1!==this.drawOptions.isSnap&&(!1!==this.drawOptions.snapDrawPoint&&this.snapSymbolData.push({position:e.toArray()}),null===(a=this.snapSymbolEntity)||void 0===a||a.setData(this.snapSymbolData)),this.app.envConfig.unProjectOptions.point=e,this.drawOptions.pointMaxCount==this.data.coordinates.length-1&&this.complete(!1)}))},Pz=function(){var e;return Qv(this,void 0,void 0,(function*(){if(!this.polylines)return;let t=this.data.coordinates;if(t.length>0&&(t.length=t.length-1),!0===(null===(e=this.drawOptions)||void 0===e?void 0:e.isClosed)&&t.length>2){let e=Object.assign({},this.data);e.coordinates=[...e.coordinates,e.coordinates[0]],this.polylines.setData([e])}else this.polylines.setData([this.data]);0==t.length&&this.polylines&&(this.polylines.remove(),this.polylines=null)}))},Oz=function(){var e;this.drawOptions.isExitToDefaultTool||!this.parent?this.app.setCurrentTool():null===(e=this.parent)||void 0===e||e.transition("idle")},tU.id="drawline";class iU extends _z{constructor(){super(...arguments),Dz.add(this),this.snapSymbolData=[],Bz.set(this,void 0),Iz.set(this,void 0),this.onPointerUp=e=>Qv(this,void 0,void 0,(function*(){if(!JW(e))return;if(this.app.Input.isDragging())return;let t,n=[],s=!1;if(this.highLightSymbolEntity&&(n=this.highLightSymbolEntity.getData(),n.length>0&&(t=new i(...n[0].position),s=!0)),!t){let i=hG(e);if(t=yield this.app.unprojectAsync(i.x,i.y,this.drawOptions.unprojectOpts),!t)return}yield qv(this,Dz,"m",Rz).call(this,t,e,s,n)})),this.onPointerMove=e=>Qv(this,void 0,void 0,(function*(){var t,i;let n=hG(e),s=yield this.app.unprojectAsync(n.x,n.y,this.drawOptions.unprojectOpts);if(s){if(null===(t=this.drawOptions)||void 0===t?void 0:t.beforeUpdateCoordinate){let t=yield this.drawOptions.beforeUpdateCoordinate(s,!0,e,!1);t&&(s=t)}(null===(i=this.drawOptions)||void 0===i?void 0:i.updateCoordinate)&&(yield this.drawOptions.updateCoordinate(s,!0,this.data,this.symbol))}})),this.onKeyUp=e=>{oG(e)&&!1!==e.escKeyCancel?qv(this,Dz,"m",kz).call(this):this.drawOptions.onKeyUp&&this.drawOptions.onKeyUp(e,{complete:this.complete.bind(this),cancel:()=>qv(this,Dz,"m",kz).call(this),data:this.data,polygons:this.symbol,addPoint:qv(this,Dz,"m",Rz).bind(this)})},this.onContextMenu=e=>{if(this.drawOptions.onContextMenu)this.drawOptions.onContextMenu(e,{complete:this.complete.bind(this),cancel:()=>qv(this,Dz,"m",kz).call(this),data:this.data,symbol:this.symbol,addPoint:qv(this,Dz,"m",Rz).bind(this)});else if(!0!==this.drawOptions.disableUnProjectMenu)return IG(e.event.originalEvent,this.drawOptions,void 0,this.app)},this.onEnter=e=>{var t,i,n,s,r,o,a,l,h,c,d,u,p,f,m,g,v,y,x,w,b,_,S,M,C,A,E,T,P,O,D,B,I,R,k,L;if(this.drawOptions=Object.assign({},e),this.app.setCursor("crosshair"),!1!==this.drawOptions.autoFocus&&this.app.setFocus(),!1!==this.drawOptions.isSnap){if(!1!==this.drawOptions.snapDrawLayerPoint){let e=null!==(t=this.drawOptions.drawLayerName)&&void 0!==t?t:"draw";null!==(i=(L=this.app).drawLayer)&&void 0!==i||(L.drawLayer={}),(null===(n=this.app.drawLayer[e])||void 0===n?void 0:n.symbol)&&this.snapSymbolData.push(...null===(s=this.app.drawLayer[e])||void 0===s?void 0:s.symbol.getData()),(null===(r=this.app.drawLayer[e])||void 0===r?void 0:r.polylines)&&this.snapSymbolData.push(...null===(o=this.app.drawLayer[e])||void 0===o?void 0:o.polylines.getVertexData(!0)),(null===(a=this.app.drawLayer[e])||void 0===a?void 0:a.polygons)&&this.snapSymbolData.push(...null===(l=this.app.drawLayer[e])||void 0===l?void 0:l.polygons.getVertexData(!0))}this.drawOptions.snapData&&this.snapSymbolData.push(...this.drawOptions.snapData.map((e=>({position:e})))),this.snapSymbolEntity=new jP({data:this.snapSymbolData,style:this.drawOptions.snapStylePointOpacity?{size:null!==(h=this.drawOptions.snapStylePixelSize)&&void 0!==h?h:5,color:null!==(u=null===(d=null===(c=this.app)||void 0===c?void 0:c.envConfig)||void 0===d?void 0:d.snapSymbolColor)&&void 0!==u?u:"#C0C0C0",borderColor:null!==(m=null===(f=null===(p=this.app)||void 0===p?void 0:p.envConfig)||void 0===f?void 0:f.snapBorderColor)&&void 0!==m?m:"#39107B",shape:null!==(y=null===(v=null===(g=this.app)||void 0===g?void 0:g.envConfig)||void 0===v?void 0:v.snapShape)&&void 0!==y?y:void 0,transparent:!0,opacity:this.drawOptions.snapStylePointOpacity,borderWidth:2,sizeAttenuation:!1,vertexBorderColor:!1,vertexColors:!1,vertexSize:!1}:{size:null!==(x=this.drawOptions.snapStylePixelSize)&&void 0!==x?x:5,transparent:!0,opacity:0,sizeAttenuation:!1,vertexBorderColor:!1,vertexColors:!1,vertexSize:!1,colorWrite:!1,depthTest:!1},pixelRaycasting:!0}),this.snapSymbolEntity.symbolObject.userData.RaycasterThreshold=null!==(w=this.drawOptions.snapStylePixelSize)&&void 0!==w?w:5,this.snapSymbolEntity.symbolObject.userData.pointsThreshold=this.snapSymbolEntity.symbolObject.userData.RaycasterThreshold,this.snapSymbolEntity.addTo(this.app),this.highLightSymbolEntity=new jP({data:[],style:{size:null!==(S=null===(_=null===(b=this.app)||void 0===b?void 0:b.envConfig)||void 0===_?void 0:_.snapHighlightSymbolSize)&&void 0!==S?S:16,color:null!==(A=null===(C=null===(M=this.app)||void 0===M?void 0:M.envConfig)||void 0===C?void 0:C.snapHighlightSymbolColor)&&void 0!==A?A:"#EB3324",borderColor:null!==(P=null===(T=null===(E=this.app)||void 0===E?void 0:E.envConfig)||void 0===T?void 0:T.snapHighlightSymbolBorderColor)&&void 0!==P?P:"#73FBFD",shape:null!==(B=null===(D=null===(O=this.app)||void 0===O?void 0:O.envConfig)||void 0===D?void 0:D.snapHighlightSymboShape)&&void 0!==B?B:"circle",transparent:!0,opacity:null!==(k=null===(R=null===(I=this.app)||void 0===I?void 0:I.envConfig)||void 0===R?void 0:R.snapHighlightSymbolOpacity)&&void 0!==k?k:1,borderWidth:2,sizeAttenuation:!1,vertexBorderColor:!1,vertexColors:!1,vertexSize:!1}}),this.highLightSymbolEntity.addTo(this.app),this.highLightSymbolEntity.node.renderOrder=100,this.snapSymbolEntity.pointerEvents=!0,this.snapSymbolEntity.signal.onMouseOver.add((e=>{if(e.intersection.index>=0){let t=this.snapSymbolEntity.getData();this.app.project(...t[e.intersection.index].position),this.highLightSymbolEntity.setData([t[e.intersection.index]])}})),this.snapSymbolEntity.signal.onMouseOut.add((e=>{this.highLightSymbolEntity&&this.highLightSymbolEntity.setData([])}))}},this.onExit=(e,t)=>{var i;this.app.setCursor(""),this.symbol&&(this.symbol.remove(),this.symbol=null),this.snapSymbolEntity&&(this.snapSymbolEntity.remove(),this.snapSymbolEntity.signal.onMouseOut.removeAll(),this.snapSymbolEntity.signal.onMouseOver.removeAll(),this.snapSymbolEntity=null),this.highLightSymbolEntity&&(this.highLightSymbolEntity.remove(),this.highLightSymbolEntity.signal.onMouseOut.removeAll(),this.highLightSymbolEntity.signal.onMouseOver.removeAll(),this.highLightSymbolEntity=null),(null===(i=this.drawOptions)||void 0===i?void 0:i.onComplete)&&this.drawOptions.onComplete(!qv(this,Bz,"f"),qv(this,Iz,"f")),Zv(this,Bz,!1,"f"),Zv(this,Iz,null,"f"),this.snapSymbolData=[]}}complete(e){var t,i;let n=Object.assign({},this.data);delete n.id;let s=this.drawOptions.isAddToApp;if(null!=s||(s=!0!==this.drawOptions.isActionDraw),Zv(this,Bz,!0,"f"),Zv(this,Iz,n,"f"),(null===(t=this.drawOptions)||void 0===t?void 0:t.onAddData)&&(s=!1!==this.drawOptions.onAddData(n)),s){let e=null!==(i=this.drawOptions.drawLayerName)&&void 0!==i?i:"draw";this.app.getDrawLayer(e,{}).addPointData(n,this.drawOptions.addToCommand)}qv(this,Dz,"m",kz).call(this)}}Bz=new WeakMap,Iz=new WeakMap,Dz=new WeakSet,Rz=function(e,t,i,n){var s,r,o;return Qv(this,void 0,void 0,(function*(){if(n=null!=n?n:[],null===(s=this.drawOptions)||void 0===s?void 0:s.beforeUpdateCoordinate){let n=yield this.drawOptions.beforeUpdateCoordinate(e,!1,t,i);n&&(e=n)}let a;this.symbol||(this.data=Object.assign(Object.assign({size:16,color:"#fbb03b",borderColor:"#73FBFD"},this.drawOptions),{position:e.toArray()}),this.symbol=new jP({data:[this.data],style:{size:16,color:"#fbb03b",borderColor:"#73FBFD",shape:"circle",transparent:!0,opacity:1,borderWidth:2,sizeAttenuation:!1,vertexBorderColor:!0,vertexColors:!0,vertexSize:!0},pixelRaycasting:!0}),this.symbol.addTo(this.app),a=!0),0==n.length&&!1!==this.drawOptions.isSnap&&(!1!==this.drawOptions.snapDrawPoint&&this.snapSymbolData.push({position:e.toArray()}),null===(r=this.snapSymbolEntity)||void 0===r||r.setData(this.snapSymbolData)),this.app.envConfig.unProjectOptions.point=e,a&&((null===(o=this.drawOptions)||void 0===o?void 0:o.updateCoordinate)&&(yield this.drawOptions.updateCoordinate(e,!1,this.data,this.symbol)),this.complete())}))},kz=function(){var e;this.drawOptions.isExitToDefaultTool||!this.parent?this.app.setCurrentTool():null===(e=this.parent)||void 0===e||e.transition("idle")},iU.id="drawpoint";class nU extends _z{constructor(){super(...arguments),Lz.add(this),this.snapSymbolData=[],zz.set(this,void 0),Uz.set(this,void 0),this.onPointerUp=e=>Qv(this,void 0,void 0,(function*(){if(!JW(e))return;if(this.app.Input.isDragging())return;let t,n=[],s=!1;if(this.highLightSymbolEntity&&(n=this.highLightSymbolEntity.getData(),n.length>0&&(t=new i(...n[0].position),s=!0)),!t){let i=hG(e);if(t=yield this.app.unprojectAsync(i.x,i.y,this.drawOptions.unprojectOpts),!t)return}qv(this,Lz,"m",Fz).call(this,t,e,s,n)})),this.onPointerMove=e=>Qv(this,void 0,void 0,(function*(){var t,i,n;let s=hG(e),r=yield this.app.unprojectAsync(s.x,s.y,this.drawOptions.unprojectOpts);if(!r)return;if(null===(t=this.drawOptions)||void 0===t?void 0:t.beforeUpdateCoordinate){let t=yield this.drawOptions.beforeUpdateCoordinate(r,!0,e,!1);t&&(r=t)}if(!this.polygons)return void((null===(i=this.drawOptions)||void 0===i?void 0:i.updateCoordinate)&&(yield this.drawOptions.updateCoordinate(r,!0,this.data)));let o=this.data.coordinates;if(o[o.length-1]=r.toArray(),this.polygons.setData([this.data]),this.polyEdge){let e=this.polyEdge.getData();e[0].coordinates[o.length-1]=r.toArray(),this.polyEdge.setData(e)}(null===(n=this.drawOptions)||void 0===n?void 0:n.updateCoordinate)&&(yield this.drawOptions.updateCoordinate(r,!0,this.data,this.polygons))})),this.onMouseDblClick=e=>{JW(e)&&(this.complete(!0),lG(e))},this.onKeyUp=e=>{rG(e)&&!1!==e.enterKeyComplete?this.complete():oG(e)&&!1!==e.escKeyCancel?qv(this,Lz,"m",Nz).call(this):aG(e)&&!1!==e.deleteKeyDelPoint?qv(this,Lz,"m",jz).call(this):this.drawOptions.onKeyUp&&this.drawOptions.onKeyUp(e,{complete:this.complete.bind(this),cancel:()=>qv(this,Lz,"m",Nz).call(this),data:this.data,polygons:this.polygons,addPoint:qv(this,Lz,"m",Fz).bind(this),delPoint:qv(this,Lz,"m",jz).bind(this)})},this.onContextMenu=e=>{if(this.drawOptions.onContextMenu)this.drawOptions.onContextMenu(e,{complete:this.complete.bind(this),cancel:()=>qv(this,Lz,"m",Nz).call(this),data:this.data,polygons:this.polygons,addPoint:qv(this,Lz,"m",Fz).bind(this),delPoint:qv(this,Lz,"m",jz).bind(this)});else if(!0!==this.drawOptions.disableUnProjectMenu)return IG(e.event.originalEvent,this.drawOptions,void 0,this.app)},this.onEnter=e=>{var t,i,n,s,r,o,a,l,h,c,d,u,p,f,m,g,v,y,x,w,b,_,S,M,C,A,E,T,P,O,D,B,I,R,k,L;if(this.drawOptions=Object.assign({},e),this.app.setCursor("crosshair"),!1!==this.drawOptions.autoFocus&&this.app.setFocus(),!1!==this.drawOptions.isSnap){if(!1!==this.drawOptions.snapDrawLayerPoint){let e=null!==(t=this.drawOptions.drawLayerName)&&void 0!==t?t:"draw";null!==(i=(L=this.app).drawLayer)&&void 0!==i||(L.drawLayer={}),(null===(n=this.app.drawLayer[e])||void 0===n?void 0:n.symbol)&&this.snapSymbolData.push(...null===(s=this.app.drawLayer[e])||void 0===s?void 0:s.symbol.getData()),(null===(r=this.app.drawLayer[e])||void 0===r?void 0:r.polylines)&&this.snapSymbolData.push(...null===(o=this.app.drawLayer[e])||void 0===o?void 0:o.polylines.getVertexData(!0)),(null===(a=this.app.drawLayer[e])||void 0===a?void 0:a.polygons)&&this.snapSymbolData.push(...null===(l=this.app.drawLayer[e])||void 0===l?void 0:l.polygons.getVertexData(!0))}this.drawOptions.snapData&&this.snapSymbolData.push(...this.drawOptions.snapData.map((e=>({position:e})))),this.snapSymbolEntity=new jP({data:this.snapSymbolData,style:this.drawOptions.snapStylePointOpacity?{size:null!==(h=this.drawOptions.snapStylePixelSize)&&void 0!==h?h:5,color:null!==(u=null===(d=null===(c=this.app)||void 0===c?void 0:c.envConfig)||void 0===d?void 0:d.snapSymbolColor)&&void 0!==u?u:"#C0C0C0",borderColor:null!==(m=null===(f=null===(p=this.app)||void 0===p?void 0:p.envConfig)||void 0===f?void 0:f.snapBorderColor)&&void 0!==m?m:"#39107B",shape:null!==(y=null===(v=null===(g=this.app)||void 0===g?void 0:g.envConfig)||void 0===v?void 0:v.snapShape)&&void 0!==y?y:void 0,transparent:!0,opacity:this.drawOptions.snapStylePointOpacity,borderWidth:2,sizeAttenuation:!1,vertexBorderColor:!1,vertexColors:!1,vertexSize:!1}:{size:null!==(x=this.drawOptions.snapStylePixelSize)&&void 0!==x?x:5,transparent:!0,opacity:0,sizeAttenuation:!1,vertexBorderColor:!1,vertexColors:!1,vertexSize:!1,colorWrite:!1,depthTest:!1},pixelRaycasting:!0}),this.snapSymbolEntity.symbolObject.userData.RaycasterThreshold=null!==(w=this.drawOptions.snapStylePixelSize)&&void 0!==w?w:5,this.snapSymbolEntity.symbolObject.userData.pointsThreshold=this.snapSymbolEntity.symbolObject.userData.RaycasterThreshold,this.snapSymbolEntity.addTo(this.app),this.highLightSymbolEntity=new jP({data:[],style:{size:null!==(S=null===(_=null===(b=this.app)||void 0===b?void 0:b.envConfig)||void 0===_?void 0:_.snapHighlightSymbolSize)&&void 0!==S?S:15,color:null!==(A=null===(C=null===(M=this.app)||void 0===M?void 0:M.envConfig)||void 0===C?void 0:C.snapHighlightSymbolColor)&&void 0!==A?A:"#EB3324",borderColor:null!==(P=null===(T=null===(E=this.app)||void 0===E?void 0:E.envConfig)||void 0===T?void 0:T.snapHighlightSymbolBorderColor)&&void 0!==P?P:"#73FBFD",shape:null!==(B=null===(D=null===(O=this.app)||void 0===O?void 0:O.envConfig)||void 0===D?void 0:D.snapHighlightSymboShape)&&void 0!==B?B:"circle",transparent:!0,opacity:null!==(k=null===(R=null===(I=this.app)||void 0===I?void 0:I.envConfig)||void 0===R?void 0:R.snapHighlightSymbolOpacity)&&void 0!==k?k:1,borderWidth:2,sizeAttenuation:!1,vertexBorderColor:!1,vertexColors:!1,vertexSize:!1}}),this.highLightSymbolEntity.addTo(this.app),this.highLightSymbolEntity.node.renderOrder=100,this.snapSymbolEntity.pointerEvents=!0,this.snapSymbolEntity.signal.onMouseOver.add((e=>{if(e.intersection.index>=0){let t=this.snapSymbolEntity.getData();this.app.project(...t[e.intersection.index].position),this.highLightSymbolEntity.setData([t[e.intersection.index]])}})),this.snapSymbolEntity.signal.onMouseOut.add((e=>{this.highLightSymbolEntity&&this.highLightSymbolEntity.setData([])}))}},this.onExit=(e,t)=>{var i;this.app.setCursor(""),this.polygons&&(this.polygons.remove(),this.polygons=null),this.polyEdge&&(this.polyEdge.remove(),this.polyEdge=null),this.snapSymbolEntity&&(this.snapSymbolEntity.remove(),this.snapSymbolEntity.signal.onMouseOut.removeAll(),this.snapSymbolEntity.signal.onMouseOver.removeAll(),this.snapSymbolEntity=null),this.highLightSymbolEntity&&(this.highLightSymbolEntity.remove(),this.highLightSymbolEntity.signal.onMouseOut.removeAll(),this.highLightSymbolEntity.signal.onMouseOver.removeAll(),this.highLightSymbolEntity=null),(null===(i=this.drawOptions)||void 0===i?void 0:i.onComplete)&&this.drawOptions.onComplete(!qv(this,zz,"f"),qv(this,Uz,"f")),Zv(this,zz,!1,"f"),Zv(this,Uz,null,"f"),this.snapSymbolData=[]}}complete(e){var t,i,n;e&&this.data.coordinates.length>=3&&(this.data.coordinates.length=this.data.coordinates.length-2);let s=Object.assign({},this.data);(null===(t=this.drawOptions)||void 0===t?void 0:t.dashed)?s.dashed=!0:s.dashed=!1,delete s.id;let r=this.drawOptions.isAddToApp;if(null!=r||(r=!0!==this.drawOptions.isActionDraw),Zv(this,zz,!0,"f"),Zv(this,Uz,s,"f"),(null===(i=this.drawOptions)||void 0===i?void 0:i.onAddData)&&(r=!1!==this.drawOptions.onAddData(s)),r){let e=null!==(n=this.drawOptions.drawLayerName)&&void 0!==n?n:"draw";this.app.getDrawLayer(e,{}).addPolygonData(s,this.drawOptions.addToCommand)}qv(this,Lz,"m",Nz).call(this)}}zz=new WeakMap,Uz=new WeakMap,Lz=new WeakSet,Fz=function(e,t,i,n){var s,r,o,a;return Qv(this,void 0,void 0,(function*(){if(n=null!=n?n:[],null===(s=this.drawOptions)||void 0===s?void 0:s.beforeUpdateCoordinate){let n=yield this.drawOptions.beforeUpdateCoordinate(e,!1,t,i);n&&(e=n)}if(this.polygons){let t=this.data.coordinates;if(t[t.length-1]=e.toArray(),t.push(e.toArray()),this.polygons.setData([this.data]),this.polyEdge){let i=this.polyEdge.getData();i[0].coordinates[t.length-1]=e.toArray(),this.polyEdge.setData(i)}}else this.data=Object.assign(Object.assign({color:"#00ff00"},this.drawOptions),{coordinates:[e.toArray(),e.toArray()]}),this.polygons=new XO({data:[this.data],showVertex:!0,isXYPlane:this.app.isMapMode}),this.polygons.addTo(this.app),!1!==this.drawOptions.showEdge&&(this.polyEdge=new GO({data:[Object.assign(Object.assign({color:"#ffff00",lineWidth:2,dashed:!0},null===(r=this.drawOptions)||void 0===r?void 0:r.edgeStyle),{coordinates:[e.toArray(),e.toArray()]})],showVertex:!1}),this.polyEdge.addTo(this.app));(null===(o=this.drawOptions)||void 0===o?void 0:o.updateCoordinate)&&(yield this.drawOptions.updateCoordinate(e,!1,this.data,this.polygons)),0==n.length&&!1!==this.drawOptions.isSnap&&(!1!==this.drawOptions.snapDrawPoint&&this.snapSymbolData.push({position:e.toArray()}),null===(a=this.snapSymbolEntity)||void 0===a||a.setData(this.snapSymbolData)),this.app.envConfig.unProjectOptions.point=e,this.drawOptions.pointMaxCount==this.data.coordinates.length-1&&this.complete(!1)}))},Nz=function(){var e;this.drawOptions.isExitToDefaultTool||!this.parent?this.app.setCurrentTool():null===(e=this.parent)||void 0===e||e.transition("idle")},jz=function(){return Qv(this,void 0,void 0,(function*(){if(!this.polygons)return;let e=this.data.coordinates;if(e.length>0&&(e.length=e.length-1),this.polygons.setData([this.data]),this.polyEdge){let e=this.polyEdge.getData();e[0].coordinates.length>0&&(e[0].coordinates.length=e[0].coordinates.length-1,this.polyEdge.setData(e))}0==e.length&&(this.polygons&&(this.polygons.remove(),this.polygons=null),this.polyEdge&&(this.polyEdge.remove(),this.polyEdge=null))}))},nU.id="drawpolygon";class sU{redo(){this.execute()}}class rU extends sU{constructor(e,t,i,n){super(),this.material=e,this.mapName=t,this.newMap=i,this.materialSlot=n,this.oldMap=this.material[t]}execute(){this.material[this.mapName]=this.newMap,this.material.needsUpdate=!0}undo(){this.material[this.mapName]=this.oldMap,this.material.needsUpdate=!0}redo(){this.execute()}}class oU extends sU{constructor(e,t,i,n){super(),this.object=e,this.attributeName=t,this.newValue=i,this.oldValue=void 0!==n?n:e[t]}execute(){this.object[this.attributeName]=this.newValue}undo(){this.object[this.attributeName]=this.oldValue}redo(){this.execute()}}class aU extends sU{constructor(e,t,i,n){super(),this.object=e,this.attributeName=t,this.newValue=i,this.oldValue=void 0!==n?n:e[t]}execute(){var e;this.object[this.attributeName]=this.newValue,null===(e=this.object)||void 0===e||e.update()}undo(){var e;this.object[this.attributeName]=this.oldValue,null===(e=this.object)||void 0===e||e.update()}redo(){this.execute()}}class lU extends sU{constructor(e,t,i,n,s){super(),this.target=e,this.executeFn=t,this.executeArgs=i,this.undoFn=n,this.undoArgs=s}execute(){var e;null===(e=this.executeFn)||void 0===e||e.apply(this.target,this.executeArgs)}undo(){var e;null===(e=this.undoFn)||void 0===e||e.apply(this.target,this.undoArgs)}redo(){this.execute()}}class hU extends sU{constructor(e,t){super(),this.object=e,this.attributes=t,this.oldValues={};for(const i in t)t.hasOwnProperty(i)&&(this.oldValues[i]=e[i])}execute(){Object.assign(this.object,this.attributes)}undo(){Object.assign(this.object,this.oldValues)}redo(){this.execute()}}class cU extends sU{constructor(e){super(),this.commands=e}execute(){this.commands.forEach((e=>e.execute()))}undo(){this.commands.forEach((e=>e.undo()))}redo(){this.commands.forEach((e=>e.redo()))}addCommand(e){Array.isArray(e)||(e=[e]),this.commands.forEach((e=>{var t;return e.autoExecute=null!==(t=e.autoExecute)&&void 0!==t&&t})),this.commands.push(...e)}execCommand(e){Array.isArray(e)||(e=[e]),this.commands.forEach((e=>{var t;return e.autoExecute=null===(t=e.autoExecute)||void 0===t||t})),this.commands.push(...e)}getCommands(){return this.commands}}class dU{constructor(e){Vz.set(this,!1),this.undos=[],this.redos=[],this.MaxHistroyLength=100,this.app=e}get debug(){return qv(this,Vz,"f")}set debug(e){Zv(this,Vz,e,"f")}clear(){this.debug&&console.debug("clear history"),this.undos.splice(0,this.undos.length),this.redos.splice(0,this.redos.length)}execute(e){var t;e.app=this.app,e.owerScene||(e.owerScene=null===(t=this.app)||void 0===t?void 0:t.scene),this.debug&&console.debug("execute ",e),this.undos.push(e),this.undos.length>this.MaxHistroyLength&&this.undos.splice(0,1),!1!==e.autoExecute&&(e.execute(),e.callbacks&&e.callbacks.onExecute()),this.redos.splice(0,this.redos.length)}executeAll(e){this.execute(new cU(e))}executeMany(...e){this.execute(new cU(e))}undo(){if(this.undos.length>0){let e=null;for(let t=this.undos.length-1;t>=0;t++)if(this.undos[t].owerScene==this.app.scene){e=this.undos[t],hv(this.undos,e);break}if(!e)return;this.debug&&console.debug("undo ",e),e.undo(),e.callbacks&&e.callbacks.onUndo(),this.redos.push(e)}else this.debug&&console.debug("nothing to undo ")}redo(){if(this.redos.length>0){let e=null;for(let t=this.redos.length-1;t>=0;t++)if(this.redos[t].owerScene==this.app.scene){e=this.redos[t],hv(this.redos,e);break}if(!e)return;this.debug&&console.debug("redo ",e),e.redo(),e.callbacks&&e.callbacks.onRedo(),this.undos.push(e)}else this.debug&&console.debug("nothing to redo ")}}Vz=new WeakMap;class uU extends sU{constructor(e,t,i=null){super(),this.object=e,this.newRotation=t,this.optionalOldRotation=i,this.newRotation=t.clone(),this.oldRotation=i?i.clone():e.rotation.clone()}execute(){var e;(null===(e=this.object)||void 0===e?void 0:e.parent)&&(this.object.rotation.copy(this.newRotation),this.object.updateMatrixWorld(!0))}undo(){var e;(null===(e=this.object)||void 0===e?void 0:e.parent)&&(this.object.rotation.copy(this.oldRotation),this.object.updateMatrixWorld(!0))}redo(){this.execute()}}class pU extends sU{constructor(e,t,i=null){super(),this.object=e,this.newPosition=t,this.newPosition=t.clone(),this.oldPosition=i?i.clone():e.position.clone()}execute(){var e,t,i;(null===(e=this.object)||void 0===e?void 0:e.parent)&&(null===(t=this.object)||void 0===t||t.position.copy(this.newPosition),null===(i=this.object)||void 0===i||i.updateMatrixWorld(!0))}undo(){var e,t,i;(null===(e=this.object)||void 0===e?void 0:e.parent)&&(null===(t=this.object)||void 0===t||t.position.copy(this.oldPosition),null===(i=this.object)||void 0===i||i.updateMatrixWorld(!0))}redo(){this.execute()}}class fU extends sU{constructor(e,t){super(),this.container=e,this.object=t}execute(){this.container.push(this.object)}undo(){const e=this.container.indexOf(this.object);e>-1&&this.container.splice(e,1)}redo(){this.execute()}}class mU extends sU{constructor(e,t,i){super(),this.object=e,this.newScale=t,this.optionalOldScale=i,this.newScale=t.clone(),this.oldScale=i?i.clone():e.scale.clone()}execute(){var e;(null===(e=this.object)||void 0===e?void 0:e.parent)&&(this.object.scale.copy(this.newScale),this.object.updateMatrixWorld(!0))}undo(){var e;(null===(e=this.object)||void 0===e?void 0:e.parent)&&(this.object.scale.copy(this.oldScale),this.object.updateMatrixWorld(!0))}redo(){this.execute()}}class gU extends sU{constructor(e,t,i,n){super(),this.autoExecute=n,e&&(this.object=e),this.newData=fv(t||this.object.getData()),this.oldData=fv(i||this.object.getData())}execute(){var e;this.newData&&(null===(e=this.object)||void 0===e||e.setData(this.newData))}undo(){var e;this.oldData&&(null===(e=this.object)||void 0===e||e.setData(this.oldData))}redo(){this.execute()}}class vU extends sU{constructor(e){super(),this.object=e}execute(){if(!this.object&&this.json){let e=new Pt;this.object=e.parse(this.json)}this.object&&this.app.scene.add(this.object)}undo(){this.object&&(this.json=this.object.toJSON(),this.object.parent.remove(this.object),this.object=null)}redo(){this.execute()}}class yU extends _z{constructor(){super(...arguments),Hz.add(this),Wz.set(this,void 0),Gz.set(this,void 0),Yz.set(this,void 0),Xz.set(this,void 0),Qz.set(this,void 0),qz.set(this,void 0),Zz.set(this,void 0),Kz.set(this,void 0),this.onPointerDown=e=>{var t,n,s,r,o,a;Zv(this,Zz,!1,"f");let l=this.queryEntities(e,this.editOptions.queryEntities);if(l&&l.target){if((null===(t=this.editOptions)||void 0===t?void 0:t.onBeforeSelectEntity)&&!0===this.editOptions.onBeforeSelectEntity(l))return;let h=l.target.isSymbolEntity;if(h||l.target.isPolygonsEntity||l.target.isPolylinesEntity)if(lG(e),void 0!==(null===(n=l.intersection)||void 0===n?void 0:n.faceIndex)){let t=l.target,i=t.getItemDataByFaceIndex(null===(s=l.intersection)||void 0===s?void 0:s.faceIndex);if(!i)return;let n=this.app.unproject(e.event.originalEvent.x,e.event.originalEvent.y);if(!n)return;if(Zv(this,Qz,n,"f"),Zv(this,Wz,fv(i),"f"),Zv(this,Gz,l.target,"f"),Zv(this,qz,fv(qv(this,Gz,"f").getData()),"f"),this.editOptions.useTransformControl||tG(e)){let e={target:n,pressEKeyModeRotate:!1,pressRKeyModeScale:!1,clickEntityAttach:!1,clickNoSelfEntityExit:!0,editAsCommand:!1,pressYKeyShowY:!1,clickIsEqualObject:e=>{var i,n;let s=t.getItemDataByFaceIndex(null===(i=l.intersection)||void 0===i?void 0:i.faceIndex),r=t.getItemDataByFaceIndex(null===(n=e.intersection)||void 0===n?void 0:n.faceIndex);return s.id==r.id},onInteractionEnd:"draw.drawedit",dragCallBack:e=>{var i;if(e.isReset){let e=t.getItemDataByFaceIndex(null===(i=l.intersection)||void 0===i?void 0:i.faceIndex);e&&Zv(this,Wz,fv(e),"f")}let n=qv(this,Gz,"f").getData();if(!n)return;let s=n.find((e=>e.id==qv(this,Wz,"f").id));if(!s)return;let r=e.deltaPosition.x,o=e.deltaPosition.y,a=e.deltaPosition.z;qv(this,Hz,"m",Jz).call(this,s,n,r,o,a)}};this.app.setCurrentTool("transform.edit",e)}}else if(void 0!==(null===(r=l.intersection)||void 0===r?void 0:r.index)){let t;if(t=h?l.target.getData()[null===(o=null==l?void 0:l.intersection)||void 0===o?void 0:o.index]:l.target.getVertexSymbol().getItemDataByPointIndex(null===(a=null==l?void 0:l.intersection)||void 0===a?void 0:a.index),t){Zv(this,Wz,t,"f"),Zv(this,Gz,l.target,"f"),Zv(this,qz,fv(qv(this,Gz,"f").getData()),"f");let n=+qv(this,Wz,"f").id.split("-")[0];if(this.editOptions.useVertTransformControl||tG(e)){let e={target:new i(...t.position),pressEKeyModeRotate:!1,pressRKeyModeScale:!1,clickEntityAttach:!1,clickNoSelfEntityExit:!0,editAsCommand:!1,pressYKeyShowY:!1,onInteractionEnd:"draw.drawedit",onInteractionEndContext:Object.assign(Object.assign({},this.editOptions),{editEntity:l.target,editIndex:n,isSelectExit:!1}),dragCallBack:e=>{let t=qv(this,Gz,"f").getData();qv(this,Hz,"m",$z).call(this,e.position,t,h)}};this.app.setCurrentTool("transform.edit",e)}}}}},this.onPointerMove=e=>{var t,i,n,s;if(qv(this,Wz,"f")){if(qv(this,Gz,"f"))if(Zv(this,Zz,!0,"f"),qv(this,Qz,"f")){let t=this.app.unproject(e.event.originalEvent.x,e.event.originalEvent.y);if(!t)return;let i=qv(this,Gz,"f").getData();if(!i)return;let n=i.find((e=>e.id==qv(this,Wz,"f").id));if(!n)return;let s=t.x-qv(this,Qz,"f").x,r=t.y-qv(this,Qz,"f").y,o=t.z-qv(this,Qz,"f").z;qv(this,Hz,"m",Jz).call(this,n,i,s,r,o)}else{let t=this.app.unproject(e.event.originalEvent.x,e.event.originalEvent.y);if(!t)return;let i=qv(this,Gz,"f").getData(),n=qv(this,Xz,"f").isSymbolEntity;qv(this,Hz,"m",$z).call(this,t,i,n)}}else if(qv(this,Xz,"f")){let r=this.queryEntities(e,qv(this,Xz,"f"));if(r&&void 0!==(null===(t=r.intersection)||void 0===t?void 0:t.index)){let e=r.target.isSymbolEntity,t=e?r.target.getData()[null===(i=null==r?void 0:r.intersection)||void 0===i?void 0:i.index]:r.target.getVertexSymbol().getItemDataByPointIndex(null===(n=null==r?void 0:r.intersection)||void 0===n?void 0:n.index,!0);t&&(t.highlightColor=16711680,e?r.target.setData():r.target.getVertexSymbol().setData(),Zv(this,Kz,t,"f"))}else qv(this,Kz,"f")&&(delete qv(this,Kz,"f").highlightColor,qv(this,Xz,"f").isSymbolEntity?qv(this,Xz,"f").setData():null===(s=qv(this,Xz,"f").getVertexSymbol())||void 0===s||s.setData(),Zv(this,Kz,null,"f"))}},this.onKeyUp=e=>{var t,i;if(aG(e)){if(qv(this,Yz,"f")&&qv(this,Xz,"f")){if((null===(t=this.editOptions)||void 0===t?void 0:t.onBeforeDeleteEntity)&&!0===this.editOptions.onBeforeDeleteEntity(qv(this,Xz,"f"),qv(this,Yz,"f")))return;let e=qv(this,Xz,"f").getData();e=e.filter((e=>e.id!==qv(this,Yz,"f").id)),qv(this,Xz,"f").setData(e),(null===(i=this.editOptions)||void 0===i?void 0:i.onDeleteEntity)&&this.editOptions.onDeleteEntity(qv(this,Xz,"f"),qv(this,Yz,"f"),{complete:()=>this.complete(!0)})}}else oG(e)?this.complete():this.editOptions.onKeyUp&&this.editOptions.onKeyUp(e,{complete:()=>this.complete(!0)})},this.onContextMenu=e=>{this.editOptions.onContextMenu&&this.editOptions.onContextMenu(e,{complete:()=>this.complete(!0)})},this.onPointerUp=e=>{var t,i,n,s,r;qv(this,Gz,"f")?qv(this,Zz,"f")&&this.app.executeCommand(new gU(qv(this,Gz,"f"),null,qv(this,qz,"f"),!1)):this.clearSelection(),Zv(this,Wz,null,"f"),Zv(this,Gz,null,"f"),Zv(this,Qz,null,"f"),Zv(this,Zz,!1,"f");let o=this.queryEntities(e,this.editOptions.queryEntities);if(o&&o.target){let e=null===(t=o.intersection)||void 0===t?void 0:t.index;o.target.isSymbolEntity||void 0!==(null===(i=o.intersection)||void 0===i?void 0:i.faceIndex)||(e=void 0),qv(this,Hz,"m",eU).call(this,o.target,e,null===(n=o.intersection)||void 0===n?void 0:n.faceIndex),(null===(s=this.editOptions)||void 0===s?void 0:s.onBeginEditEntity)&&this.editOptions.onBeginEditEntity(o.target,e,null===(r=o.intersection)||void 0===r?void 0:r.faceIndex)}},this.onMouseDblClick=e=>{!1!==this.editOptions.dblClickExitEdit&&this.complete()},this.onEnter=e=>{this.editOptions=Object.assign({},e),Zv(this,Wz,null,"f"),Zv(this,Gz,null,"f"),Zv(this,Qz,null,"f"),Zv(this,Zz,!1,"f"),!1!==this.editOptions.autoFocus&&this.app.setFocus(),e.editEntity&&qv(this,Hz,"m",eU).call(this,e.editEntity,e.editIndex),e.isSelectExit&&this.onPointerDown(e)},this.onExit=(e,t)=>{var i;let n="draw.drawedit"==(null==e?void 0:e.onInteractionEnd);this.clearSelection(n),Zv(this,Yz,null,"f"),Zv(this,Xz,null,"f"),n||(null===(i=this.editOptions)||void 0===i?void 0:i.onComplete)&&this.editOptions.onComplete(e,t),e.isExitToDefaultTool&&this.app.setCurrentTool()}}queryEntities(e,t){var i,n,s,r,o,a,l,h,c;let d=[];if(t)d=Array.isArray(t)?[...t]:[t];else{let e=null!==(i=this.editOptions.drawLayerName)&&void 0!==i?i:"draw";null!==(n=(c=this.app).drawLayer)&&void 0!==n||(c.drawLayer={}),(null===(s=this.app.drawLayer[e])||void 0===s?void 0:s.polylines)&&d.push(null===(r=this.app.drawLayer[e])||void 0===r?void 0:r.polylines),(null===(o=this.app.drawLayer[e])||void 0===o?void 0:o.polygons)&&d.push(null===(a=this.app.drawLayer[e])||void 0===a?void 0:a.polygons),(null===(l=this.app.drawLayer[e])||void 0===l?void 0:l.symbol)&&d.push(null===(h=this.app.drawLayer[e])||void 0===h?void 0:h.symbol)}if(0!=d.length)return this.app.queryEntitiesByScreenPos(e.event.originalEvent.x,e.event.originalEvent.y,{entities:d})}complete(e){e?setTimeout((()=>this.app.setCurrentTool()),10):this.app.setCurrentTool()}clearSelection(e){var t,i,n;if(!qv(this,Xz,"f"))return;let s=qv(this,Xz,"f").getData();if(qv(this,Xz,"f").isSymbolEntity){for(let e=0;e<s.length;e++)delete s[e].highlightColor;qv(this,Xz,"f").setData()}else{for(let e=0;e<s.length;e++)s[e].showVertex=!1;null===(i=(t=qv(this,Xz,"f")).setShowVertex)||void 0===i||i.call(t,!1)}!e&&(null===(n=this.editOptions)||void 0===n?void 0:n.onUnEditEntity)&&this.editOptions.onUnEditEntity(qv(this,Xz,"f"),{complete:()=>this.complete(!0)})}}Wz=new WeakMap,Gz=new WeakMap,Yz=new WeakMap,Xz=new WeakMap,Qz=new WeakMap,qz=new WeakMap,Zz=new WeakMap,Kz=new WeakMap,Hz=new WeakSet,Jz=function(e,t,i,n,s){var r,o;if(!(null===(r=this.editOptions)||void 0===r?void 0:r.onBeforeMoveEntity)||!0!==this.editOptions.onBeforeMoveEntity(qv(this,Gz,"f"),e,{dx:i,dy:n,dz:s})){for(let t=0;t<e.coordinates.length;t++){let r=[qv(this,Wz,"f").coordinates[t][0]+i,qv(this,Wz,"f").coordinates[t][1]+n,qv(this,Wz,"f").coordinates[t][2]+s];qv(this,Gz,"f").isPolygonsEntity||qv(this,Gz,"f").isPolylinesEntity?e.coordinates[t]=r:e.position=r}qv(this,Gz,"f").setData(t),(null===(o=this.editOptions)||void 0===o?void 0:o.onMoveEntity)&&this.editOptions.onMoveEntity(qv(this,Gz,"f"),e,{dx:i,dy:n,dz:s},{complete:()=>this.complete(!0)})}},$z=function(e,t,i){var n,s;let r=qv(this,Wz,"f").id.split("-"),o=i?1:2;if(r.length<o)return;let a=+r[0],l=i?0:+r[1];if(!(a<0&&a>=t.length)&&(i||!(l<0||l>=t[a].coordinates.length))){if((null===(n=this.editOptions)||void 0===n?void 0:n.onBeforeMoveVertex)&&!0===this.editOptions.onBeforeMoveVertex(qv(this,Gz,"f"),t,e,a,l))return;qv(this,Gz,"f").isPolygonsEntity||qv(this,Gz,"f").isPolylinesEntity?t[a].coordinates[l]=e.toArray():t[a].position=e.toArray(),qv(this,Gz,"f").setData(t),(null===(s=this.editOptions)||void 0===s?void 0:s.onMoveVertex)&&this.editOptions.onMoveVertex(qv(this,Gz,"f"),t,e,a,l,{complete:()=>this.complete(!0)})}},eU=function(e,t,i){let n=e.isSymbolEntity;if(n||e.isPolygonsEntity||e.isPolylinesEntity){let s,r=e;if(void 0!==i?s=r.getItemDataByFaceIndex(i):void 0!==t&&(s=r.getData()[t]),s){if(s.disableEdit)return;if(qv(this,Xz,"f")&&!qv(this,Xz,"f").isSymbolEntity){let e=qv(this,Xz,"f").getData();for(let t=0;t<e.length;t++)e[t].showVertex=!1;qv(this,Xz,"f").setShowVertex(!1)}if(!n){let e=r.getData();for(let t=0;t<e.length;t++)e[t].id==s.id?e[t].showVertex=!0:e[t].showVertex=!1;!1!==this.editOptions.editShowVertex&&r.setShowVertex(!0)}Zv(this,Yz,s,"f"),Zv(this,Xz,e,"f")}}},yU.id="drawedit";let xU=class extends _z{constructor(){super(...arguments),this.onPointerDown=e=>{this.parent.transition("drawedit",e)},this.onEnter=()=>{}}};xU.id="idle";class wU extends _z{constructor(){super(...arguments),this.onExit=()=>{}}}wU.id="draw",wU.initial="idle",wU.children=()=>[xU,yU,iU,tU,nU];class bU extends u{constructor(e,t,n){super(),this.isTransformControls=!0,this.visible=!1,this.raycaster=new p,this.tempVector=new i,this.tempVector2=new i,this.tempQuaternion=new v,this.unit={X:new i(1,0,0),Y:new i(0,1,0),Z:new i(0,0,1)},this.pointStart=new i,this.pointEnd=new i,this.offset=new i,this.rotationAxis=new i,this.startNorm=new i,this.endNorm=new i,this.rotationAngle=0,this.cameraPosition=new i,this.cameraQuaternion=new v,this.cameraScale=new i,this.parentPosition=new i,this.parentQuaternion=new v,this.parentQuaternionInv=new v,this.parentScale=new i,this.worldPositionStart=new i,this.worldQuaternionStart=new v,this.worldScaleStart=new i,this.worldPosition=new i,this.worldQuaternion=new v,this.worldQuaternionInv=new v,this.worldScale=new i,this.eye=new i,this.positionStart=new i,this.quaternionStart=new v,this.scaleStart=new i,this.enabled=!0,this.axis=null,this.mode="translate",this.translationSnap=null,this.rotationSnap=null,this.scaleSnap=null,this.space="world",this.size=1,this.dragging=!1,this.showX=!0,this.showY=!0,this.showZ=!0,this.changeEvent={type:"change"},this.mouseDownEvent={type:"mouseDown",mode:this.mode},this.mouseUpEvent={type:"mouseUp",mode:this.mode},this.objectChangeEvent={type:"objectChange"},this.intersectObjectWithRay=(e,t,i)=>{const n=t.intersectObject(e,!0);for(let e=0;e<n.length;e++)if(n[e].object.visible||i)return n[e];return!1},this.attach=e=>(this.object=e,this.visible=!0,this),this.detach=()=>(this.object=void 0,this.visible=!1,this.axis=null,this),this.reset=()=>this.enabled?(this.dragging&&void 0!==this.object&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this,this.updateMatrixWorld=()=>{void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()},this.pointerHover=e=>{if(void 0===this.object||!0===this.dragging)return;this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);this.axis=t?t.object.name:null},this.pointerDown=e=>{if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(t){let e=this.space;if("scale"===this.mode?e="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(e="world"),"local"===e&&"rotate"===this.mode){const e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}},this.pointerMove=e=>{const t=this.axis,i=this.mode,n=this.object;let s=this.space;if("scale"===i?s="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(s="world"),void 0===n||null===t||!1===this.dragging||-1!==e.button)return;this.raycaster.setFromCamera(e,this.camera);const r=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),"translate"===i)this.offset.copy(this.pointEnd).sub(this.pointStart),"local"===s&&"XYZ"!==t&&this.offset.applyQuaternion(this.worldQuaternionInv),-1===t.indexOf("X")&&(this.offset.x=0),-1===t.indexOf("Y")&&(this.offset.y=0),-1===t.indexOf("Z")&&(this.offset.z=0),"local"===s&&"XYZ"!==t?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),n.position.copy(this.offset).add(this.positionStart),this.translationSnap&&("local"===s&&(n.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this.quaternionStart)),"world"===s&&(n.parent&&n.position.add(this.tempVector.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(this.tempVector.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),this.tempVector2.set(e,e,e)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),-1===t.search("X")&&(this.tempVector2.x=1),-1===t.search("Y")&&(this.tempVector2.y=1),-1===t.search("Z")&&(this.tempVector2.z=1);n.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(-1!==t.search("X")&&(this.object.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this.offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(this.unit[t]),this.tempVector.copy(this.unit[t]),"local"===s&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===s&&"E"!==t&&"XYZE"!==t?(n.quaternion.copy(this.quaternionStart),n.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),n.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}},this.pointerUp=e=>{0===e.button&&(this.dragging&&null!==this.axis&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)},this.getPointer=e=>{var t;if(this.domElement&&(null===(t=this.domElement.ownerDocument)||void 0===t?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};{const t=e.changedTouches?e.changedTouches[0]:e,i=this.domElement.getBoundingClientRect();return{x:(t.clientX-i.left)/i.width*2-1,y:-(t.clientY-i.top)/i.height*2+1,button:e.button}}},this.onPointerHover=e=>{if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(e))}},this.onPointerDown=e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(e)),this.pointerDown(this.getPointer(e)))},this.onPointerMove=e=>{this.enabled&&this.pointerMove(this.getPointer(e))},this.onPointerUp=e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(e)))},this.getMode=()=>this.mode,this.setMode=e=>{this.mode=e},this.setTranslationSnap=e=>{this.translationSnap=e},this.setRotationSnap=e=>{this.rotationSnap=e},this.setScaleSnap=e=>{this.scaleSnap=e},this.setSize=e=>{this.size=e},this.setSpace=e=>{this.space=e},this.update=()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")},this.connect=e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)},this.dispose=()=>{var e,t,i,n,s,r;null===(e=this.domElement)||void 0===e||e.removeEventListener("pointerdown",this.onPointerDown),null===(t=this.domElement)||void 0===t||t.removeEventListener("pointermove",this.onPointerHover),null===(n=null===(i=this.domElement)||void 0===i?void 0:i.ownerDocument)||void 0===n||n.removeEventListener("pointermove",this.onPointerMove),null===(r=null===(s=this.domElement)||void 0===s?void 0:s.ownerDocument)||void 0===r||r.removeEventListener("pointerup",this.onPointerUp),this.traverse((e=>{const t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))},this.app=n,this.domElement=t,this.camera=e,this.gizmo=new _U,this.add(this.gizmo),this.plane=new SU,this.add(this.plane);const s=(e,t)=>{let i=t;Object.defineProperty(this,e,{get:function(){return void 0!==i?i:t},set:function(t){i!==t&&(i=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),this[e]=t,this.plane[e]=t,this.gizmo[e]=t};s("camera",this.camera),s("object",this.object),s("enabled",this.enabled),s("axis",this.axis),s("mode",this.mode),s("translationSnap",this.translationSnap),s("rotationSnap",this.rotationSnap),s("scaleSnap",this.scaleSnap),s("space",this.space),s("size",this.size),s("dragging",this.dragging),s("showX",this.showX),s("showY",this.showY),s("showZ",this.showZ),s("worldPosition",this.worldPosition),s("worldPositionStart",this.worldPositionStart),s("worldQuaternion",this.worldQuaternion),s("worldQuaternionStart",this.worldQuaternionStart),s("cameraPosition",this.cameraPosition),s("cameraQuaternion",this.cameraQuaternion),s("pointStart",this.pointStart),s("pointEnd",this.pointEnd),s("rotationAxis",this.rotationAxis),s("rotationAngle",this.rotationAngle),s("eye",this.eye),void 0!==t&&this.connect(t)}}class _U extends u{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo",this.tempVector=new i(0,0,0),this.tempEuler=new t,this.alignVector=new i(0,1,0),this.zeroVector=new i(0,0,0),this.lookAtMatrix=new n,this.tempQuaternion=new v,this.tempQuaternion2=new v,this.identityQuaternion=new v,this.unitX=new i(1,0,0),this.unitY=new i(0,1,0),this.unitZ=new i(0,0,1),this.rotationAxis=new i,this.cameraPosition=new i,this.worldPositionStart=new i,this.worldQuaternionStart=new v,this.worldPosition=new i,this.worldQuaternion=new v,this.eye=new i,this.camera=null,this.enabled=!0,this.axis=null,this.mode="translate",this.space="world",this.size=1,this.dragging=!1,this.showX=!0,this.showY=!0,this.showZ=!0,this.updateMatrixWorld=()=>{let e=this.space;"scale"===this.mode&&(e="local");const t="local"===e?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let e=0;e<i.length;e++){const n=i[e];let r;if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),r=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/7),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,i=.2,s=0;"X"!==n.name&&"XYZX"!==n.name||Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye)<s?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye)<s?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye)<s?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===this.mode&&(this.tempQuaternion2.copy(t),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(t).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),"X"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion)),"Y"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion)),"Z"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material.tempOpacity=n.material.tempOpacity||n.material.opacity,n.material.tempColor=n.material.tempColor||n.material.color.clone(),n.material.color.copy(n.material.tempColor),n.material.opacity=n.material.tempOpacity,this.enabled?this.axis&&(n.name===this.axis||this.axis.split("").some((function(e){return n.name===e}))?(n.material.opacity=1,n.material.color.lerp(new s(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new s(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new s(1,1,1),.5))}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),n.quaternion.multiply(this.tempQuaternion),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(this.tempVector),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}super.updateMatrixWorld()};const e=new x({depthTest:!1,depthWrite:!1,transparent:!0,side:I,fog:!1,toneMapped:!1}),r=new k({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),o=e.clone();o.opacity=.15;const a=e.clone();a.opacity=.33;const c=e.clone();c.color.set(16711680);const d=e.clone();d.color.set(65280);const p=e.clone();p.color.set(255);const f=e.clone();f.opacity=.25;const g=f.clone();g.color.set(16776960);const y=f.clone();y.color.set(65535);const w=f.clone();w.color.set(16711935),e.clone().color.set(16776960);const b=r.clone();b.color.set(16711680);const _=r.clone();_.color.set(65280);const C=r.clone();C.color.set(255);const A=r.clone();A.color.set(65535);const E=r.clone();E.color.set(16711935);const T=r.clone();T.color.set(16776960);const P=r.clone();P.color.set(7895160);const O=T.clone();O.opacity=.25;const D=new qt(0,.05,.2,12,1,!1),B=new m(.125,.125,.125),R=new S;R.setAttribute("position",new M([0,0,0,1,0,0],3));const L=(e,t)=>{const i=new S,n=[];for(let i=0;i<=64*t;++i)n.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return i.setAttribute("position",new M(n,3)),i},z={X:[[new h(D,c),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new h(D,c),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new Bt(R,b)]],Y:[[new h(D,d),[0,1,0],null,null,"fwd"],[new h(D,d),[0,1,0],[Math.PI,0,0],null,"bwd"],[new Bt(R,_),null,[0,0,Math.PI/2]]],Z:[[new h(D,p),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new h(D,p),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new Bt(R,C),null,[0,-Math.PI/2,0]]],XYZ:[[new h(new Zt(.1,0),f.clone()),[0,0,0],[0,0,0]]],XY:[[new h(new l(.295,.295),g.clone()),[.15,.15,0]],[new Bt(R,T),[.18,.3,0],null,[.125,1,1]],[new Bt(R,T),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new h(new l(.295,.295),y.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new Bt(R,A),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new Bt(R,A),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new h(new l(.295,.295),w.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new Bt(R,E),[.18,0,.3],null,[.125,1,1]],[new Bt(R,E),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},U={X:[[new h(new qt(.2,0,1,4,1,!1),o),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new h(new qt(.2,0,1,4,1,!1),o),[0,.6,0]]],Z:[[new h(new qt(.2,0,1,4,1,!1),o),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new h(new Zt(.2,0),o)]],XY:[[new h(new l(.4,.4),o),[.2,.2,0]]],YZ:[[new h(new l(.4,.4),o),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new h(new l(.4,.4),o),[.2,0,.2],[-Math.PI/2,0,0]]]},F={START:[[new h(new Zt(.01,2),a),null,null,null,"helper"]],END:[[new h(new Zt(.01,2),a),null,null,null,"helper"]],DELTA:[[new Bt((()=>{const e=new S;return e.setAttribute("position",new M([0,0,0,1,1,1],3)),e})(),a),null,null,null,"helper"]],X:[[new Bt(R,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Bt(R,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Bt(R,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},N={X:[[new Bt(L(1,.5),b)],[new h(new Zt(.04,0),c),[0,0,.99],null,[1,3,1]]],Y:[[new Bt(L(1,.5),_),null,[0,0,-Math.PI/2]],[new h(new Zt(.04,0),d),[0,0,.99],null,[3,1,1]]],Z:[[new Bt(L(1,.5),C),null,[0,Math.PI/2,0]],[new h(new Zt(.04,0),p),[.99,0,0],null,[1,3,1]]],E:[[new Bt(L(1.25,1),O),null,[0,Math.PI/2,0]],[new h(new qt(.03,0,.15,4,1,!1),O),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new h(new qt(.03,0,.15,4,1,!1),O),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new h(new qt(.03,0,.15,4,1,!1),O),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new h(new qt(.03,0,.15,4,1,!1),O),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new Bt(L(1,1),P),null,[0,Math.PI/2,0]]]},j={AXIS:[[new Bt(R,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},V={X:[[new h(new Kt(1,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new h(new Kt(1,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new h(new Kt(1,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new h(new Kt(1.25,.1,2,24),o)]],XYZE:[[new h(new Jt(.7,10,8),o)]]},H={X:[[new h(B,c),[.8,0,0],[0,0,-Math.PI/2]],[new Bt(R,b),null,null,[.8,1,1]]],Y:[[new h(B,d),[0,.8,0]],[new Bt(R,_),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new h(B,p),[0,0,.8],[Math.PI/2,0,0]],[new Bt(R,C),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new h(B,g),[.85,.85,0],null,[2,2,.2]],[new Bt(R,T),[.855,.98,0],null,[.125,1,1]],[new Bt(R,T),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new h(B,y),[0,.85,.85],null,[.2,2,2]],[new Bt(R,A),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new Bt(R,A),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new h(B,w),[.85,0,.85],null,[2,.2,2]],[new Bt(R,E),[.855,0,.98],null,[.125,1,1]],[new Bt(R,E),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new h(new m(.125,.125,.125),f.clone()),[1.1,0,0]]],XYZY:[[new h(new m(.125,.125,.125),f.clone()),[0,1.1,0]]],XYZZ:[[new h(new m(.125,.125,.125),f.clone()),[0,0,1.1]]]},W={X:[[new h(new qt(.2,0,.8,4,1,!1),o),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new h(new qt(.2,0,.8,4,1,!1),o),[0,.5,0]]],Z:[[new h(new qt(.2,0,.8,4,1,!1),o),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new h(B,o),[.85,.85,0],null,[3,3,.2]]],YZ:[[new h(B,o),[0,.85,.85],null,[.2,3,3]]],XZ:[[new h(B,o),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new h(new m(.2,.2,.2),o),[1.1,0,0]]],XYZY:[[new h(new m(.2,.2,.2),o),[0,1.1,0]]],XYZZ:[[new h(new m(.2,.2,.2),o),[0,0,1.1]]]},G={X:[[new Bt(R,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Bt(R,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Bt(R,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Y=e=>{const t=new u;for(let i in e)for(let n=e[i].length;n--;){const s=e[i][n][0].clone(),r=e[i][n][1],o=e[i][n][2],a=e[i][n][3],l=e[i][n][4];s.name=i,s.tag=l,r&&s.position.set(r[0],r[1],r[2]),o&&s.rotation.set(o[0],o[1],o[2]),a&&s.scale.set(a[0],a[1],a[2]),s.updateMatrix();const h=s.geometry.clone();h.applyMatrix4(s.matrix),s.geometry=h,s.renderOrder=1/0,s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),t.add(s)}return t};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Y(z)),this.add(this.gizmo.rotate=Y(N)),this.add(this.gizmo.scale=Y(H)),this.add(this.picker.translate=Y(U)),this.add(this.picker.rotate=Y(V)),this.add(this.picker.scale=Y(W)),this.add(this.helper.translate=Y(F)),this.add(this.helper.rotate=Y(j)),this.add(this.helper.scale=Y(G)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class SU extends h{constructor(){super(new l(1e5,1e5,2,2),new x({visible:!1,wireframe:!0,side:I,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane",this.unitX=new i(1,0,0),this.unitY=new i(0,1,0),this.unitZ=new i(0,0,1),this.tempVector=new i,this.dirVector=new i,this.alignVector=new i,this.tempMatrix=new n,this.identityQuaternion=new v,this.cameraQuaternion=new v,this.worldPosition=new i,this.worldQuaternion=new v,this.eye=new i,this.axis=null,this.mode="translate",this.space="world",this.updateMatrixWorld=()=>{let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),this.unitX.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0)}break;default:this.dirVector.set(0,0,0)}0===this.dirVector.length()?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()}}}let MU=class extends _z{constructor(){super(...arguments),this.onPointerDownUp=e=>{if(!JW(e))return;let t=hG(e),i=this.app.queryEntitiesByScreenPos(t.x,t.y,this.info.queryOptions);(null==i?void 0:i.target)&&this.parent.transition("edit",Object.assign(Object.assign({},this.info),{target:i.target.node}))},this.onEnter=e=>{this.info=e},this.onKeyUp=e=>{oG(e)&&this.app.setCurrentTool()}}};var CU,AU,EU,TU,PU,OU,DU;MU.id="idle";class BU extends _z{constructor(){super(...arguments),CU.add(this),AU.set(this,void 0),this.onPointerDownUp=e=>{var t,i;if(eG(e))!0===this.info.rightClickConfirmExit&&this.exitEdit();else if(!($W(e)||(null===(t=this.tranformControls)||void 0===t?void 0:t.dragging)||!1===this.info.clickNoEntityExit&&!1===this.info.clickEntityAttach)){let t=hG(e),n=this.app.queryEntitiesByScreenPos(t.x,t.y,this.info.queryOptions);(null==n?void 0:n.target)?this.info.clickNoSelfEntityExit?"function"==typeof this.info.clickIsEqualObject?this.info.clickIsEqualObject(n)||this.exitEdit(e):n.target.node!==(null!==(i=this.info.clickIsEqualObject)&&void 0!==i?i:this.tranformControls.object)&&this.exitEdit(e):!1!==this.info.clickEntityAttach&&this.tranformControls.attach(n.target.node):!1===this.info.clickNoEntityExit&&!0!==this.info.clickNoSelfEntityExit||this.exitEdit(e)}},this.onEnter=e=>{var t,i;this.info=e;let n,s=null===(t=this.app.cameraControl)||void 0===t?void 0:t.getStatus();if(this.tranformControls=new bU(this.app.camera,this.app.domElement,this.app),e.target.isObject3D)n=e.target;else{if(!e.target.isVector3)throw Error("not support type"+(null===(i=e.target)||void 0===i?void 0:i.type));{const t=new S,i=[0,0,0];t.setAttribute("position",new M(i,3)),Zv(this,AU,new me(t,new H({color:8947848})),"f"),qv(this,AU,"f").position.copy(e.target),n=qv(this,AU,"f"),this.app.scene.add(qv(this,AU,"f"))}}this.tranformControls.attach(n),e.axis&&(this.tranformControls.axis=e.axis),e.mode&&this.tranformControls.setMode(e.mode),qv(this,CU,"m",EU).call(this,"showX"),qv(this,CU,"m",EU).call(this,"showY"),qv(this,CU,"m",EU).call(this,"showZ"),void 0!==e.translationSnap&&!1===e.pressShiftKeySnap&&this.tranformControls.setTranslationSnap(e.translationSnap),void 0!==e.rotationSnap&&!1===e.pressShiftKeySnap&&this.tranformControls.setRotationSnap(e.rotationSnap),void 0!==e.scaleSnap&&!1===e.pressShiftKeySnap&&this.tranformControls.setScaleSnap(e.scaleSnap),e.space&&this.tranformControls.setSpace(e.space),e.transformSize&&this.tranformControls.setSize(e.transformSize),this.app.isMapMode?this.app.scene.parent.add(this.tranformControls):this.app.scene.add(this.tranformControls),this.tranformControls.addEventListener("mouseDown",(()=>{null==s||s.push(),this.app.isMapMode&&(this.app.map.dragPan.disable(),this.app.map.dragRotate.disable()),this.oldObjectStatus={position:n.position.clone(),scale:n.scale.clone(),rotation:n.rotation.clone()},this.info.dragCallBack&&this.info.dragCallBack({isReset:!0,isOnceFinish:!1,position:n.position,scale:n.scale,rotation:n.rotation,deltaPosition:n.position.clone().sub(this.oldObjectStatus.position),deltaScale:n.scale.clone().sub(this.oldObjectStatus.scale),oldRotation:this.oldObjectStatus.rotation})})),this.tranformControls.addEventListener("mouseUp",(()=>{let t;null==s||s.pop(),this.app.isMapMode&&(this.app.map.dragPan.enable(),this.app.map.dragRotate.enable()),t=new cU([]),!1!==e.editAsCommand&&(this.oldObjectStatus.position.equals(n.position)||t.addCommand(new pU(n,n.position,this.oldObjectStatus.position)),this.oldObjectStatus.scale.equals(n.scale)||t.addCommand(new mU(n,n.scale,this.oldObjectStatus.scale)),this.oldObjectStatus.rotation.equals(n.rotation)||t.addCommand(new uU(n,n.rotation,this.oldObjectStatus.rotation))),this.info.dragCallBack&&this.info.dragCallBack({isReset:!1,isOnceFinish:!0,position:n.position,scale:n.scale,rotation:n.rotation,deltaPosition:n.position.clone().sub(this.oldObjectStatus.position),deltaScale:n.scale.clone().sub(this.oldObjectStatus.scale),oldRotation:this.oldObjectStatus.rotation,command:t}),t.getCommands().length>0&&this.app.addCommand(t),delete this.oldObjectStatus}))},this.onMouseMove=e=>{if(this.oldObjectStatus&&this.info.dragCallBack&&this.tranformControls){let e=this.tranformControls.object;this.info.dragCallBack&&this.info.dragCallBack({isReset:!1,isOnceFinish:!1,position:e.position,scale:e.scale,rotation:e.rotation,deltaPosition:e.position.clone().sub(this.oldObjectStatus.position),deltaScale:e.scale.clone().sub(this.oldObjectStatus.scale),oldRotation:this.oldObjectStatus.rotation})}},this.onExit=(e,t)=>{var i,n;this.tranformControls.detach(),null===(i=this.tranformControls.parent)||void 0===i||i.remove(this.tranformControls),qv(this,AU,"f")&&(null===(n=qv(this,AU,"f").parent)||void 0===n||n.remove(qv(this,AU,"f")))},this.onKeyDown=e=>{var t,i,n;let s=sG(e),r=this.tranformControls;if(!r)return;16===s&&!1!==this.info.pressShiftKeySnap&&(r.setTranslationSnap(null!==(t=this.info.translationSnap)&&void 0!==t?t:10),r.setRotationSnap(null!==(i=this.info.rotationSnap)&&void 0!==i?i:Wv(15)),r.setScaleSnap(null!==(n=this.info.scaleSnap)&&void 0!==n?n:.25));let o=tG(e),a=iG(e),l=nG(e);if(!(o||a||l))switch(s){case 81:!1!==this.info.pressQKeySwitchSpace&&r.setSpace("local"===r.space?"world":"local");break;case 87:!1!==this.info.pressWKeyModeTranslate&&(r.setMode("translate"),qv(this,CU,"m",EU).call(this,"showX"),qv(this,CU,"m",EU).call(this,"showY"),qv(this,CU,"m",EU).call(this,"showZ"));break;case 69:!1!==this.info.pressEKeyModeRotate&&(r.setMode("rotate"),qv(this,CU,"m",EU).call(this,"showX"),qv(this,CU,"m",EU).call(this,"showY"),qv(this,CU,"m",EU).call(this,"showZ"));break;case 82:!1!==this.info.pressRKeyModeScale&&(r.setMode("scale"),qv(this,CU,"m",EU).call(this,"showX"),qv(this,CU,"m",EU).call(this,"showY"),qv(this,CU,"m",EU).call(this,"showZ"));break;case 88:!1!==this.info.pressXKeyShowX&&(r.showX=!r.showX);break;case 89:!1!==this.info.pressYKeyShowY&&(r.showY=!r.showY);break;case 90:!1!==this.info.pressZKeyShowZ&&(r.showZ=!r.showZ);break;case 27:r.dragging&&r.reset()}},this.onKeyUp=e=>{let t=this.tranformControls;t&&((oG(e)&&!t.dragging&&!1!==this.info.enterEscConfirmExit||rG(e)&&!t.dragging&&!1!==this.info.enterEscConfirmExit)&&this.exitEdit(),16===sG(e))&&!1!==this.info.pressShiftKeySnap&&(t.setTranslationSnap(null),t.setRotationSnap(null),t.setScaleSnap(null))}}exitEdit(e){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,Object.assign(Object.assign(Object.assign(Object.assign({},this.info),e),{isSelectExit:!0}),this.info.onInteractionEndContext)):this.parent.transition("idle",this.info)}}AU=new WeakMap,CU=new WeakSet,EU=function(e,t){let i=this.tranformControls.getMode();"boolean"==typeof this.info[e]?this.tranformControls[e]=info[e]:Array.isArray(this.info[e])&&(this.tranformControls[e]=this.info[e].indexOf(i)>=0)},BU.id="edit";class IU extends _z{}IU.id="transform",IU.initial="idle",IU.children=()=>[MU,BU];class RU extends _z{constructor(){super(...arguments),this.onPointerDownUp=e=>{if(!JW(e))return;let t=hG(e),i=this.app.queryEntitiesByScreenPos(t.x,t.y,this.info.queryOptions);(null==i?void 0:i.target)&&this.parent.transition("select",Object.assign(Object.assign({},this.info),{target:i}))},this.onEnter=e=>{this.info=e},this.onKeyUp=e=>{oG(e)&&this.app.setCurrentTool()}}}RU.id="idle";class kU extends _z{constructor(){super(...arguments),TU.set(this,void 0),PU.set(this,void 0),OU.set(this,void 0),this.onPointerDownUp=e=>{var t;if(eG(e))!0===this.info.rightClickConfirmExit&&this.exitPick();else if(!$W(e)&&(!1!==this.info.clickNoEntityExit||!1!==this.info.clickEntityAttach)){let i=hG(e),n=this.app.queryEntitiesByScreenPos(i.x,i.y,this.info.queryOptions);(null==n?void 0:n.target)?this.info.clickNoSelfEntityExit?"function"==typeof this.info.clickIsEqualObject?this.info.clickIsEqualObject(n)||this.exitPick(e):n.target.node!==(null!==(t=this.info.clickIsEqualObject)&&void 0!==t?t:this.tranformControls.object)&&this.exitPick(e):!1!==this.info.clickEntitySelected&&this.selectObject(n):!1===this.info.clickNoEntityExit&&!0!==this.info.clickNoSelfEntityExit||this.exitPick(e)}},this.onPointerMove=e=>{if(!this.info.onPointerMove)return;let t=hG(e),i=this.app.queryEntitiesByScreenPos(t.x,t.y,this.info.queryOptions);this.info.onPointerMove(e,{complete:e=>this.exitPick(e)},qv(this,OU,"f"),i),Zv(this,OU,i,"f")},this.onEnter=e=>{var t;this.info=e,!1!==(null===(t=this.info)||void 0===t?void 0:t.autoFocus)&&this.app.setFocus(),Zv(this,TU,null,"f"),this.selectObject(this.info.target)},this.onExit=(e,t)=>{this.selectObject()},this.onKeyUp=e=>{oG(e)&&!1!==this.info.enterEscConfirmExit?this.exitPick():rG(e)&&!1!==this.info.enterEscConfirmExit?this.exitPick(void 0,!0):this.info.onKeyUp&&this.info.onKeyUp(e,{complete:e=>this.exitPick(e)})},this.onContextMenu=e=>{this.info.onContextMenu&&this.info.onContextMenu(e,{complete:e=>this.exitPick(e)})}}selectObject(e){const t=e=>!0===this.info.highlightUseBoxHelper?e.boxHelper:e.isHighlight();qv(this,TU,"f")&&(t(qv(this,TU,"f").target)&&(e=>{!0===this.info.highlightUseBoxHelper?e.boxHelper=!1:e.clearHighlight()})(qv(this,TU,"f").target),Zv(this,TU,null,"f"));let i=qv(this,TU,"f");Zv(this,TU,e,"f"),e&&(t(e.target)||((e,t,i)=>{!0===this.info.highlightUseBoxHelper?e.boxHelper={lineColor:t,fillColor:t,fillOpacity:i}:e.setHighlight(null!=t?t:this.app.envConfig.highlightColor,null!=i?i:this.app.envConfig.highlightOpacity)})(e.target,this.info.highlightColor,this.info.highlightOpacity)),this.info.pickCallBack&&this.info.pickCallBack({oldPick:i,curPick:e}),e&&Zv(this,PU,e,"f")}exitPick(e,t){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,Object.assign(Object.assign(Object.assign(Object.assign({},this.info),e),{isSelectExit:!0}),this.info.onInteractionEndContext)):this.info.isExitToDefaultTool||!this.parent?this.app.setCurrentTool():this.parent.transition("idle",this.info),this.info.onComplete&&this.info.onComplete(!!t,e,qv(this,PU,"f"))}}TU=new WeakMap,PU=new WeakMap,OU=new WeakMap,kU.id="select";class LU extends _z{}LU.id="pick",LU.initial="idle",LU.children=()=>[RU,kU];const zU=e=>{var t,i;let n=e&&e.anchor||"center";if(e&&e.element){if(e.rotation){let t=bz.create("div");return e.element.style.transform=`rotate(${e.rotation}deg)`,e.element.style.transformOrigin=`${wz[n]} `,t.style.transformOrigin=`${wz[n]} `,t.appendChild(e.element),t}return e.element}if(e&&e.image){let n=e.image,s=document.createElement("div");return s.className="marker",0==n.src.toLowerCase().indexOf("<svg")&&(n.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(n.src)))),s.style.backgroundImage=`url("${n.src}")`,s.style.width=(null!==(t=n.width)&&void 0!==t?t:40)+"px",s.style.height=(null!==(i=n.height)&&void 0!==i?i:40)+"px",s.style.backgroundSize="100%",e.element=s,e.element}let s=bz.create("div");s.setAttribute("aria-label","Map marker");const r=bz.createNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height","41px"),r.setAttributeNS(null,"width","27px"),r.setAttributeNS(null,"viewBox","0 0 27 41");const o=bz.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const a=bz.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=bz.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const h=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of h){const t=bz.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),l.appendChild(t)}const c=bz.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"fill",e&&e.color||"#3FB1CE");const d=bz.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),c.appendChild(d);const u=bz.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"opacity","0.25"),u.setAttributeNS(null,"fill","#000000");const p=bz.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),u.appendChild(p);const f=bz.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=bz.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=bz.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const v=bz.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#FFFFFF"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(v),a.appendChild(l),a.appendChild(c),a.appendChild(u),a.appendChild(f),a.appendChild(m),r.appendChild(a);let y=e&&e.scale||1;return r.setAttributeNS(null,"height",41*y+"px"),r.setAttributeNS(null,"width",27*y+"px"),s.appendChild(r),e&&(e._defaultMarker=!0,e.rotation&&(r.style.transform=`rotate(${e.rotation}deg)`,r.style.transformOrigin=`${wz[n]} `,s.style.transformOrigin=`${wz[n]} `)),s};class UU extends Yi{constructor(e){var t,i,n,s,r;super(zU(e)),DU.set(this,void 0),this.signal={dragstart:new cy,drag:new cy,dragend:new cy,click:new cy,occlusion:new cy,elementSizeReady:new cy,onAdd:new cy,onRemove:new cy},this.isMarker2D=!0,this._options=null!=e?e:{},this._options.fadeDistance=null!==(t=this._options.fadeDistance)&&void 0!==t?t:0,this._options.occlusionOpacity=null!==(i=this._options.occlusionOpacity)&&void 0!==i?i:1,gv(["_onMove","_onUp","_addDragHandler","_onMapClick"],this),this._unProjectOpts=this._options.dragUnProjectOpts,this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._rotation=e&&e.rotation||0,this._allowOverlap=!1!==(null==e?void 0:e.allowOverlap),this._options.disableOpacity=null!==(n=null==e?void 0:e.disableOpacity)&&void 0!==n?n:.1,this._element=this.element,this._opacity=this._element.style.opacity,e&&!e._defaultMarker||(this._defaultMarker=!0,this._anchor=e&&e.anchor||"bottom"),this._element.classList.add("vjmap3d-marker2d");const o=(e,t)=>{"top"==this._anchor?this.center.set(.5+e,0+t):"bottom"==this._anchor?this.center.set(.5+e,1+t):"left"==this._anchor?this.center.set(0+e,.5+t):"right"==this._anchor?this.center.set(1+e,.5+t):"top-left"==this._anchor?this.center.set(0+e,0+t):"top-right"==this._anchor?this.center.set(1+e,0+t):"bottom-left"==this._anchor?this.center.set(0+e,1+t):"bottom-right"==this._anchor?this.center.set(1+e,1+t):this.center.set(.5+e,.5+t),(0!=e||0!=t&&this._element.children.length>0)&&(this._element.style.transformOrigin=`${100*this.center.x}% ${100*this.center.y}%`)};if(e&&e.offset&&(0!==e.offset[0]||0!==e.offset[1])){if("function"==typeof ResizeObserver){let t=this._element.style.visibility;this._element.style.visibility="hidden";const i=new ResizeObserver((i=>{let n=i[0].contentRect,r=n.width,a=n.height;r>0&&a>0&&(setTimeout((()=>{this._element.style.visibility=t,this._options.isHide&&this.hide()}),10),setTimeout(s,5e3),setTimeout((()=>{o(-e.offset[0]/r,-e.offset[1]/a),this.signal.elementSizeReady.dispatch(this),this.app&&this.app.setCollideRectDirty()}),0))}));i.observe(this._element);let n=!1;const s=()=>{n||(n=!0,i.unobserve(this._element))};this.addEventListener("removed",s)}}else o(0,0),this.signal.elementSizeReady.dispatch(this);this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()})),this._popup=null,(null===(s=this._options)||void 0===s?void 0:s.position)&&this.setPosition(null===(r=this._options)||void 0===r?void 0:r.position)}isShow(){return this.visible}show(){this.visible=!0}hide(){this.visible=!1}getPosition(){return this.position}setPosition(e,t,i){3==arguments.length?this.position.set(e,t,i):Array.isArray(e)?this.position.set(...e):this.position.copy(e),this._popup&&this._popup.setPosition(this.position),this.app&&this.app.signal.onCustomEvent.dispatch("setMarker2dDirty")}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this.app),this):this}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=43.9,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[n,-1*(t-i+n)],"bottom-right":[-n,-1*(t-i+n)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,this._popup.setPosition(this.position),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}addTo(e,t){if(this.app)return;const i=e=>{var t;e.dispatch("onMarker2D",this,!0),e.on("click",this._onMapClick),this.signal.onAdd.dispatch(this),this.addEventListener("removed",(()=>{e.off("pointerdown",this._addDragHandler),e.off("pointerup",this._onUp),e.off("pointermove",this._onMove),e.off("click",this._onMapClick),e.dispatch("onMarker2D",this,!1),this.signal.onRemove.dispatch(this),this._popup&&this._popup.remove(),delete this.app})),this.setDraggable(this._draggable),this.setAllowOverlap(null===(t=this._options)||void 0===t?void 0:t.allowOverlap)};if(e.isApp)this.app=e,this.app.scene.add(this),i(this.app);else if(e.isEntity){let t=e;t.node.add(this),t.onEntityAwake((e=>{this.app=e,i(this.app)}))}else{if(e.add(this),!t)throw Error("cur app is null");this.app=t,i(this.app)}return this}getElement(){return this._rotation&&this.element.children.length>0?this._element.children[0]:this._element}getOpacity(){var e;return this._element?""==this._element.style.opacity?1:+(null!==(e=this._element.style.opacity)&&void 0!==e?e:1):0}setOpacity(e){""==e&&0!==e&&(e="1"),this._element.style.opacity=e+"",this._popup&&this._popup.setOpacity(`${e}`)}_onMapClick(e){if(this.getOpacity()<this._options.disableOpacity)return;const t=e.originalEvent.target,i=this.getElement();(t===i||i.contains(t))&&(this.togglePopup(),this.signal.click.dispatch(this,e))}_onMove(e){var t,i,n,s,o;if(!(this.getOpacity()<this._options.disableOpacity)){if(!this._isDragging){const a=null!==(t=this._options.clickTolerance)&&void 0!==t?t:5;this._isDragging=!0;let l=new r(null!==(n=null===(i=e.originalEvent)||void 0===i?void 0:i.x)&&void 0!==n?n:0,null!==(o=null===(s=e.originalEvent)||void 0===s?void 0:s.y)&&void 0!==o?o:0);this._isDragging=l.distanceTo(this._pointerdownPos)>=a}if(this._isDragging){if(lG(e),this.app){let t=hG(e),i=this._unProjectOpts;void 0===i&&(this.app.Input.getKeyPressed("ControlLeft")?i=this.position:this.app.Input.getKeyPressed("ShiftLeft")&&(i=!0));let n=this.app.unproject(t.x,t.y,i);n&&this.setPosition(n)}this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.signal.dragstart.dispatch(this)),this.signal.drag.dispatch(this)}}}_onUp(){this._element.style.pointerEvents="auto",this._pointerdownPos=null,this._isDragging=!1,this.app&&this.app.off("pointermove",this._onMove),"active"===this._state&&(!1===this._options.dragAsCommand&&this.app.executeCommand(new pU(this,this.position,qv(this,DU,"f"))),this.signal.dragend.dispatch(this)),this._state="inactive"}_addDragHandler(e){var t,i,n,s;this.getOpacity()<this._options.disableOpacity||this._element.contains(e.originalEvent.target)&&(lG(e),Zv(this,DU,this.position.clone(),"f"),this._pointerdownPos=new r(null!==(i=null===(t=e.originalEvent)||void 0===t?void 0:t.x)&&void 0!==i?i:0,null!==(s=null===(n=e.originalEvent)||void 0===n?void 0:n.y)&&void 0!==s?s:0),this._state="pending",this.app&&(this.app.on("pointermove",this._onMove),this.app.once("pointerup",this._onUp)))}setAllowOverlap(e){this._allowOverlap=e,!1===e?this.app.addCollideRectObject(this):this.app.removeCollideRectObject(this)}getBoundingRect(){var e;let t=this.getElement().getBoundingClientRect(),i=t.left,n=t.right,s=t.top,r=t.bottom;if(this.getOpacity()<this._options.disableOpacity)return null;if(0==t.width||0==t.height)return null;if(!1!==this._options.collideIncludePopup&&this._popup&&this._popup.getElement()){let e=this._popup.getElement().getBoundingClientRect();i=Math.min(i,e.left),s=Math.min(s,e.top),n=Math.max(n,e.right),r=Math.max(r,e.bottom)}return{x1:i,y1:s,x2:n,y2:r,cx:(i+n)/2,cy:(s+r)/2,rotation:0,position:this.position,zIndex:null!==(e=this._options.collideZIndex)&&void 0!==e?e:0,id:this._options.collideId,groupName:this._options.collideGroupName,setVisible:e=>{this._element.style.visibility=e?"visible":"hidden",this._popup&&this._popup.element&&(this._popup.element.style.visibility=e?"visible":"hidden")}}}isAllowOverlap(){return this._allowOverlap}setDraggable(e){return this._draggable=!!e,this.app&&(e?this.app.on("pointerdown",this._addDragHandler):this.app.off("pointerdown",this._addDragHandler)),this}isDraggable(){return this._draggable}remove(...e){var t;return 0==e.length?(null===(t=this.parent)||void 0===t||t.remove(this),this):(super.remove(...e),this)}setAnimation(e){const t=this.getElement();if(t&&t.children&&t.children[0])switch(this._animationType=e,e){case"MAP_ANIMATION_NONE":default:t.children[0].classList.remove("map3dmarkerKeyframesImgAnimation"),t.children[0].classList.remove("map3dmarkerKeyframesAnimationDrop");break;case"MAP_ANIMATION_BOUNCE":t.children[0].classList.remove("map3dmarkerKeyframesAnimationDrop"),t.children[0].classList.add("map3dmarkerKeyframesImgAnimation");break;case"MAP_ANIMATION_DROP":t.children[0].classList.remove("map3dmarkerKeyframesImgAnimation"),t.children[0].classList.add("map3dmarkerKeyframesAnimationDrop"),"none"===t.children[0].style.display&&setTimeout((()=>{t.children[0].style.display="block"}),10)}}setCursor(e){var t;this.getElement()&&(null===(t=this.getElement().style)||void 0===t||(t.cursor=e))}}var FU;DU=new WeakMap;const NU={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jU=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),VU=new r;class HU extends Yi{constructor(e){if(super(bz.create("div","vjmap3d-popup")),this.isPopup2D=!0,this.signal={open:new cy,close:new cy,elementSizeReady:new cy},FU.set(this,((e,t)=>{"top"==this._anchor?this.center.set(.5+e,0+t):"bottom"==this._anchor?this.center.set(.5+e,1+t):"left"==this._anchor?this.center.set(0+e,.5+t):"right"==this._anchor?this.center.set(1+e,.5+t):"top-left"==this._anchor?this.center.set(0+e,0+t):"top-right"==this._anchor?this.center.set(1+e,0+t):"bottom-left"==this._anchor?this.center.set(0+e,1+t):"bottom-right"==this._anchor?this.center.set(1+e,1+t):this.center.set(.5+e,.5+t)})),this.options=vv(Object.create(NU),e),gv(["update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[]),"function"==typeof ResizeObserver){let e=this.element.style.visibility;this.element.style.visibility="hidden";const t=new ResizeObserver((t=>{let i=t[0].contentRect,s=i.width,r=i.height;s>0&&r>0&&(setTimeout((()=>{this.element.style.visibility=e,this.options.isHide&&this.hide()}),10),setTimeout(n,5e3),setTimeout((()=>{this.update(),this.signal.elementSizeReady.dispatch(this),this.app&&this.app.setCollideRectDirty()}),0))}));t.observe(this.element);let i=!1;const n=()=>{i||(i=!0,t.unobserve(this.element))};this.addEventListener("removed",n)}!1===this.options.showArrow&&this.element.style.setProperty("--border-top-width","0px")}addTo(e,t){if(this.app)return;const i=e=>{var t,i;this.setColor(null!==(t=this.options.backgroundColor)&&void 0!==t?t:this.app.envConfig.popupBackgroundColor,null!==(i=this.options.buttonColor)&&void 0!==i?i:this.app.envConfig.popupButtonColor),this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("onCameraUpdate",this._onClose),e.dispatch("onPopup2D",this,!0),e.on("remove",this.remove),this.update(),this._focusFirstElement(),e.on("onCameraUpdate",this.update),this.signal.open.dispatch(this)};if(e.isApp)this.app=e,this.app.scene.add(this),i(this.app);else if(e.isEntity){let t=e;t.node.add(this),t.onEntityAwake((e=>{this.app=e,i(this.app)}))}else{if(e.add(this),!t)throw Error("cur app is null");this.app=t,i(this.app)}return this}isOpen(){return!!this.app}remove(){var e;return this._content&&bz.remove(this._content),this._tip&&(bz.remove(this._tip),delete this._tip),this._container&&(bz.remove(this._container),delete this._container),this.app&&(null===(e=this.parent)||void 0===e||e.remove(this),this.app.off("onCameraUpdate",this.update),this.app.off("onCameraUpdate",this._onClose),this.app.off("click",this._onClose),this.app.off("remove",this.remove),this.app.off("mousemove",this._onMouseMove),this.app.off("mouseup",this._onMouseUp),this.app.off("drag",this._onDrag),this.app.dispatch("onPopup2D",this,!1),delete this.app),this.signal.close.dispatch(this),this}getPosition(){return this.position}setPosition(e,t,i){return 3==arguments.length?this.position.set(e,t,i):Array.isArray(e)?this.position.set(...e):this.position.copy(e),this._pos=null,this.update(),this.app&&(this.app.on("onCameraUpdate",this.update),this.app.off("mousemove",this._onMouseMove),this.app.container.classList.remove("vjmap3d-track-pointer")),this}getElement(){return this._container}isShow(){return this.visible}show(){this.visible=!0}hide(){this.visible=!1}setText(e){return this.setDOMContent(window.document.createTextNode(e))}setHTML(e){const t=window.document.createDocumentFragment(),i=window.document.createElement("body");let n;for(i.innerHTML=e;n=i.firstChild,n;)t.appendChild(n);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this.update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=bz.create("div","vjmap3d-popup-content",this._container),this.setColor(this.options.backgroundColor,this.options.buttonColor);return this._content.appendChild(e),this._createCloseButton(),this.update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._container&&this.updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._container&&this.updateClassList(),this}setOffset(e){return this.options.offset=e,this.update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._container&&this.updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=bz.create("button","vjmap3d-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(e){this.update(hG(e).toArray())}_onMouseMove(e){this.update(hG(e).toArray())}_onDrag(e){this.update(hG(e).toArray())}_getAnchor(e){var t,i;if(this.options.anchor)return this.options.anchor;if(this.app&&this.app.isMapMode)return"bottom";const n={x:this._pos[0],y:this._pos[1]};let s=this.app.container.getBoundingClientRect();n.x-=null!==(t=s.left)&&void 0!==t?t:0,n.y-=null!==(i=s.top)&&void 0!==i?i:0;const r=this._container.offsetWidth,o=this._container.offsetHeight;let a;return a=n.y+e.bottom[1]<o?["top"]:n.y>this.app.containerSize.height-o?["bottom"]:[],n.x<r/2?a.push("left"):n.x>this.app.containerSize.width-r/2&&a.push("right"),0===a.length?"bottom":a.join("-")}updateClassList(){const e=[...this._classList];e.push("vjmap3d-popup"),this._anchor&&e.push(`vjmap3d-popup-anchor-${this._anchor}`),this._container.className=e.join(" ")}setColor(e,t){e&&this.element.style.setProperty("--background-color",e),t&&this.element.style.setProperty("--close_color",t)}update(e){if(this.app&&this._content){this._container||(this._container=this.element,this._tip||(this._tip=bz.create("div","vjmap3d-popup-tip",this._container),this._container.appendChild(this._content),this.setColor(this.options.backgroundColor,this.options.buttonColor),this._content&&this._content.style.opacity&&!this._tip.style.opacity&&(this._tip.style.opacity=this._content.style.opacity))),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth);{this._pos=this.app.project(this.position).toArray();const e=HU.normalizeOffset(this.options.offset),t=this._anchor=this._getAnchor(e);VU.set(e[t][0],e[t][1]);const i=VU.round(),n=this._container.offsetWidth,s=this._container.offsetHeight;n>0&&s>0&&qv(this,FU,"f").call(this,-i.x/n,-i.y/s)}this.updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(jU);e&&e.focus&&e.focus()}_onClose(){this.remove()}setOpacity(e){e=""+e,this._content&&(this._content.style.opacity=e),this._tip&&(this._tip.style.opacity=e)}static normalizeOffset(e){if(e||(e=[0,0]),"number"==typeof e){const t=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{center:[0,0],top:[0,e],"top-left":[t,t],"top-right":[-t,t],bottom:[0,-e],"bottom-left":[t,-t],"bottom-right":[-t,-t],left:[e,0],right:[-e,0]}}return Array.isArray(e)?{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}:{center:e.center||[0,0],top:e.top||[0,0],"top-left":e["top-left"]||[0,0],"top-right":e["top-right"]||[0,0],bottom:e.bottom||[0,0],"bottom-left":e["bottom-left"]||[0,0],"bottom-right":e["bottom-right"]||[0,0],left:e.left||[0,0],right:e.right||[0,0]}}}var WU;FU=new WeakMap;class GU extends u{constructor(e){var t,i,n,s,r,o;super(),this.pixelWidth=0,this.pixelHeight=0,WU.set(this,void 0),this.signal={click:new cy,occlusion:new cy,elementSizeReady:new cy,onAdd:new cy,onRemove:new cy},this.isMarker3D=!0;let a=Object.assign(Object.assign({},e),{rotation:0}),l=zU(a);if(e&&!a._defaultMarker||(this._defaultMarker=!0),this._options=e||{},this._options.disableOpacity=null!==(t=null==e?void 0:e.disableOpacity)&&void 0!==t?t:.1,this._options.fadeDistance=null!==(i=this._options.fadeDistance)&&void 0!==i?i:0,this._options.occlusionOpacity=null!==(n=this._options.occlusionOpacity)&&void 0!==n?n:1,this._defaultMarker&&(this._options.anchor=null!==(s=this._options.anchor)&&void 0!==s?s:"bottom",this._options.popupAnchor=null!==(r=this._options.popupAnchor)&&void 0!==r?r:"top"),gv(["_onMapClick"],this),this.pixelWidth=this._options.pixelWidth,this.pixelHeight=this._options.pixelHeight,this._options.width=null!==(o=this._options.width)&&void 0!==o?o:this.pixelWidth,this._options.asSprite?this.css3dObject=new Xi(l):this.css3dObject=new Qi(l),this.css3dObject.element.classList.add("vjmap3d-marker3d"),this.add(this.css3dObject),null==e.pixelWidth||void 0===e.pixelHeight){if("function"==typeof ResizeObserver){let e,t=this.getElement().style.visibility;this.getElement().style.visibility="hidden",this._popup&&this._popup.getElement()&&(e=this._popup.getElement().style.visibility,this._popup.getElement().style.visibility="hidden");const i=new ResizeObserver((i=>{let n=i[0].contentRect,r=n.width,o=n.height;r>0&&o>0&&(setTimeout((()=>{this.getElement().style.visibility=t,this._options.isHide&&this.hide(),this._popup&&(this._popup.getElement()&&(this._popup.getElement().style.visibility=e),this._options.isHide&&this._popup.hide())}),10),setTimeout(s,5e3),setTimeout((()=>{this.pixelWidth=r,this.pixelHeight=o,this.updateSize(),this.signal.elementSizeReady.dispatch(this)}),0))}));i.observe(this.getElement());let n=!1;const s=()=>{n||(n=!0,i.unobserve(this.getElement()))};this.addEventListener("removed",s)}}else this.updateSize(),this.signal.elementSizeReady.dispatch(this);this._options.rotation&&this.rotation.fromArray(this._options.rotation),this._opacity=this.getElement().style.opacity}isShow(){return this.visible}show(){this.visible=!0}hide(){this.visible=!1}getElement(){return this.css3dObject.element}updateSize(e,t){if(void 0===e&&(e=this.pixelWidth),void 0===t&&(t=this.pixelHeight),0==e||0==t)return;let i=this._options.width;i||(i=this._options.height?this._options.height*e/t:e);let n=this._options.height,s=i/e,r=1;n?r=this._options.height/t:(n=t*i/e,r=s*t/e);let o=this._options.anchor,a=i/2,l=n/2,h=qv(this,WU,"f")?"z":"y";"top"==o?this.position[h]-=l:"bottom"==o?this.position[h]+=l:"left"==o?this.position.x-=a:"right"==o?this.position.x+=a:"top-left"==o?(this.position[h]-=l,this.position.x-=a):"top-right"==o?(this.position[h]-=l,this.position.x+=a):"bottom-left"==o?(this.position[h]+=l,this.position.x-=a):"bottom-right"==o&&(this.position[h]+=l,this.position.x+=a),this._options.width||!this._options.height?this.scale.set(s,s,1):this.scale.set(r,r,1),this.pixelWidth&&this.pixelHeight&&this.maskMesh&&this.maskMesh.scale.set(this.pixelWidth,this.pixelHeight,1),this.updatePopupPosition()}getPosition(){return this.position}setPosition(e,t,i){3==arguments.length?this.position.set(e,t,i):Array.isArray(e)?this.position.set(...e):this.position.copy(e),this._popup&&this.updatePopupPosition(),this.app&&this.app.signal.onCustomEvent.dispatch("setMarker3dDirty")}updatePopupPosition(){if(!this._popup)return;if(!this.pixelWidth||!this.pixelHeight)return;let e,t=this.pixelWidth/2,n=this.pixelHeight/2;if(this._options.asSprite){if(e=this.localToWorld(new i(0,0,0)),this._popup.position.copy(e),!this.getElement())return;let t=this._options.popupOffset,n=HU.normalizeOffset(t),s=this.getElement().getBoundingClientRect(),r=s.width/2,o=s.height/2,a=0,l=0;"top-left"==this._options.popupAnchor?(a=-r,l=-o):"top"==this._options.popupAnchor?l=-o:"top-right"==this._options.popupAnchor?(a=r,l=-o):"left"==this._options.popupAnchor?a=-r:"right"==this._options.popupAnchor?a=r:"bottom-right"==this._options.popupAnchor?(a=-r,l=o):"bottom"==this._options.popupAnchor?l=o:"bottom-left"==this._options.popupAnchor&&(a=r,l=o);for(let e in n)n[e]=[n[e][0]+a,n[e][1]+l];this._popup.options.offset=n,this._popup.update()}else e="top-left"==this._options.popupAnchor?this.localToWorld(new i(t,n,0)):"top"==this._options.popupAnchor?this.localToWorld(new i(0,n,0)):"top-right"==this._options.popupAnchor?this.localToWorld(new i(-t,n,0)):"left"==this._options.popupAnchor?this.localToWorld(new i(t,0,0)):"right"==this._options.popupAnchor?this.localToWorld(new i(-t,0,0)):"bottom-right"==this._options.popupAnchor?this.localToWorld(new i(t,-n,0)):"bottom"==this._options.popupAnchor?this.localToWorld(new i(0,-n,0)):"bottom-left"==this._options.popupAnchor?this.localToWorld(new i(-t,-n,0)):this.localToWorld(new i(0,0,0)),this._popup.position.copy(e)}addTo(e,t){if(this.app)return;const i=e=>{var t,i,n;if(e){if(Zv(this,WU,e.isMapMode,"f"),e.isMapMode&&0==this.rotation.x&&0==this.rotation.y&&0==this.rotation.z){let e=null!==(t=this._options.rotation)&&void 0!==t?t:[Math.PI/2,0,0];e&&this.rotation.fromArray(e)}e.setCss3dObjectCanOcclude(this.css3dObject,this._options.occlude),e.on("click",this._onMapClick),e.dispatch("onMarker3D",this,!0),this.signal.onAdd.dispatch(this);const r=()=>{e.off("click",this._onMapClick),e.dispatch("onMarker3D",this,!1),this.signal.onRemove.dispatch(this),this.remove(...this.children),this._popup&&this._popup.remove(),delete this.app};this.addEventListener("removed",r);let o=this._options.createMaskObject;if(void 0===o&&(o=!!this._options.occlude),o){let e=null!==(i=this._options.occludeMaterial)&&void 0!==i?i:{name:this._options.asSprite?"SpriteMaterial":"MeshStandardMaterial",opacity:0,color:new s(0),blending:Q,side:I},t={MeshBasicMaterial:x,MeshStandardMaterial:$,MeshPhongMaterial:ce,MeshPhysicalMaterial:Ye}[null!==(n=e.name)&&void 0!==n?n:"MeshStandardMaterial"];if(!t)throw Error(e.name+" material class is not exist");delete e.name;let r=new t(e);if(this._options.asSprite){let e=new g(r);e.scale.set(1,1,1),this.add(e),this.maskMesh=e}else{let e=new l(1,1),t=new h(e,r);this.add(t),this.maskMesh=t}this.pixelWidth&&this.pixelHeight&&this.maskMesh.scale.set(this.pixelWidth,this.pixelHeight,1)}}};if(e.isApp)this.app=e,this.app.scene.add(this),i(e);else if(e.isEntity){let t=e;t.node.add(this),t.onEntityAwake((e=>{this.app=e,i(e)}))}else{if(e.add(this),!t)throw Error("cur app is null");this.app=t,i(this.app)}}isCss3dSprite(){return!!this._options.asSprite}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this.app),this):this}getOpacity(){var e,t,i,n;return(null===(e=this.css3dObject)||void 0===e?void 0:e.element)?""==(null===(t=this.css3dObject)||void 0===t?void 0:t.element.style.opacity)?1:+(null!==(n=null===(i=this.css3dObject)||void 0===i?void 0:i.element.style.opacity)&&void 0!==n?n:1):0}setOpacity(e){""==e&&0!==e&&(e="1"),this.css3dObject&&this.css3dObject.element&&(this.css3dObject.element.style.opacity=e+"",this._popup&&this._popup.setOpacity(`${e}`))}_onMapClick(e){if(this.getOpacity()<this._options.disableOpacity)return;const t=e.originalEvent.target,i=this.getElement();(t===i||i.contains(t))&&(this.togglePopup(),this.signal.click.dispatch(this,e))}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}setPopup(e){return this._popup&&(this._popup.remove(),this._popup=null,this.getElement().removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this.getElement().removeAttribute("tabindex")),e&&("offset"in e.options||(e.options.offset=this._options.popupOffset),this._popup=e,this.pixelWidth&&this.pixelHeight&&this.updatePopupPosition(),this._originalTabIndex=this.getElement().getAttribute("tabindex"),this._originalTabIndex||this.getElement().setAttribute("tabindex","0"),this.getElement().addEventListener("keypress",this._onKeyPress)),this}remove(...e){var t;return 0==e.length?(null===(t=this.parent)||void 0===t||t.remove(this),this):(super.remove(...e),this)}setAnimation(e){const t=this.getElement();if(t&&t.children&&t.children[0])switch(this._animationType=e,e){case"MAP_ANIMATION_NONE":default:t.children[0].classList.remove("map3dmarkerKeyframesImgAnimation"),t.children[0].classList.remove("map3dmarkerKeyframesAnimationDrop");break;case"MAP_ANIMATION_BOUNCE":t.children[0].classList.remove("map3dmarkerKeyframesAnimationDrop"),t.children[0].classList.add("map3dmarkerKeyframesImgAnimation");break;case"MAP_ANIMATION_DROP":t.children[0].classList.remove("map3dmarkerKeyframesImgAnimation"),t.children[0].classList.add("map3dmarkerKeyframesAnimationDrop"),"none"===t.children[0].style.display&&setTimeout((()=>{t.children[0].style.display="block"}),10)}}setCursor(e){var t;this.getElement()&&(null===(t=this.getElement().style)||void 0===t||(t.cursor=e))}}WU=new WeakMap;class YU{constructor(e,t){var i,n;this.options=null!=t?t:{},this.markersElement=[],this.features="features"in e?e:{type:"FeatureCollection",features:[{type:"Feature",geometry:{coordinates:e.position},properties:{name:null!==(i=e.text)&&void 0!==i?i:""}}]},this.options.textField=null!==(n=this.options.textField)&&void 0!==n?n:"name"}setFeatures(e){this.markersElement=[],this.features=e,this.features&&this._createMarker()}getMarkersElement(){return this.markersElement}getElement(e){return e=e||0,this.markersElement[e]}getPosition(e){var t,i;return e=e||0,null===(i=null===(t=this.features.features[e])||void 0===t?void 0:t.geometry)||void 0===i?void 0:i.coordinates}createMarker2d(e,t){(e=e||{}).element=this.getElement(t);let i=new UU(e);return i.setPosition(this.getPosition(t)),i.userData.elementObject=this,i}createMarker3d(e,t){(e=e||{}).element=this.getElement(t);let i=new GU(e);return i.setPosition(this.getPosition(t)),i.userData.elementObject=this,i}setMarkersTextField(e){if(!this.features||"{}"===JSON.stringify(this.features))return;this.options.textField=e;let t=this.features.features;for(let i=0;i<t.length;i++){let n=t[i]&&t[i].properties;n&&n[e]?this.setMarkersText(n[e],i):this.setMarkersText("",i)}}setMarkersText(e,t){let i=this.getElement(t).getElementsByClassName("vjmap3d-animate-marker__name");0==i.length&&(i=this.getElement(t).getElementsByClassName("vjmap3d-animate-marker__text"));for(let t=0;t<i.length;t++)i[t].innerHTML=e}setMarkersTextFontSize(e,t){this.options.textFontSize=e;let i=this.getElement(t).getElementsByClassName("vjmap3d-animate-marker__name-container");for(let t=0;t<i.length;t++)i[t].style.fontSize=e+"px"}setMarkersTextColor(e,t){this.options.textColor=e;let i=this.getElement(t).getElementsByClassName("vjmap3d-animate-marker__name-container");for(let t=0;t<i.length;t++)i[t].style.color=e}_getColorWithOpacity(e,t){return this.getColorWithOpacity(e,t)}_getTextContainer(e,t){let i;if(e.properties&&0!==Object.keys(e.properties).length&&this.options.textField&&(i=e.properties[this.options.textField]),void 0===i)return null;let n=document.createElement("div");n.className="vjmap3d-animate-marker__name-container vjmap3d-animate-marker__name-container--".concat(t),this.options.textColor&&(n.style.color=this.options.textColor),this.options.textFontSize&&(n.style.fontSize=this.options.textFontSize+"px");let s=document.createElement("span");return s.className="vjmap3d-animate-marker__".concat(t," vjmap3d-animate-marker__name"),s.innerHTML=i||"",n.appendChild(s),n}set16ToRgb(e){if(!/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(e))return e;let t=e.toLowerCase().replace(/\#/g,""),i=t.length;if(3==i){let e="";for(var n=0;n<i;n++)e+=t.slice(n,n+1).concat(t.slice(n,n+1));t=e}let s=[];for(let e=0;e<6;e+=2){let i=t.slice(e,e+2);s.push(parseInt("0x"+i))}return"rgb("+s.join(",")+")"}getColorWithOpacity(e,t){if(e.indexOf("rgba")>-1)return e.substring(0,e.lastIndexOf(",")+1)+t+")";let i=e;return 0==e.indexOf("#")&&(i=this.set16ToRgb(e)),"rgba"+i.substring(3,i.length-1)+",".concat(t,")")}}class XU extends YU{constructor(e,t){super(e,t),this.markersElement=[],this.features&&this._createMarker()}_createMarker(){this.features.features.forEach((e=>{let t=document.createElement("div");t.className="vjmap3d-animate-marker--breathing-aperture";let i,n=document.createElement("span");n.className="vjmap3d-animate-marker__dot-point",this.options.colors&&this.options.colors.length&&this.options.colors.length>0&&(i=this.options.colors),i&&(n.style.background=i[0]),t.appendChild(n),this._createMakerElement(3,"span",["vjmap3d-animate-marker__delay","vjmap3d-animate-marker__pulse"]).forEach((e=>{i&&(e.style.borderColor=i[0],e.style.boxShadow="0 0 12px ".concat(i[1],", 0 0 20px ").concat(i[1]," inset")),this._setBreathingApertureWidth(e.style),t.appendChild(e)}));let s=this._getTextContainer(e,"breathing-aperture-name");s&&t.appendChild(s),this.markersElement.push(t)}))}_createMakerElement(e,t,i){let n=[];for(let s=1;s<e+1;s++){let e=document.createElement(t);e.className="".concat(i[0],"-0").concat(s," ").concat(i[1]),n.push(e)}return n}setMarkersWidth(e,t){this.options.width=e;let i=this.getElement(t).getElementsByClassName("vjmap3d-animate-marker__pulse");for(let e=0;e<i.length;e++)this._setBreathingApertureWidth(i[e].style)}_setBreathingApertureWidth(e,t){let i=null!=t?t:this.options.width;i&&(e.width=i+"px",e.height=i+"px",e.top=-i/2+"px",e.left=-i/2+"px",e.borderRadius=i/2+"px")}setDotSize(e,t){let i=this.getElement(t).getElementsByClassName("vjmap3d-animate-marker__dot-point");for(let t=0;t<i.length;t++)this._setBreathingApertureWidth(i[t].style,e)}setMarkersColors(e,t){if(this.options.colors=e,e&&e.length&&e.length>0){let e=this.getElement(t).getElementsByClassName("vjmap3d-animate-marker__dot-point");for(let t=0;t<e.length;t++)e[t].style.background=this.options.colors[0];let i=this.getElement(t).getElementsByClassName("vjmap3d-animate-marker__pulse");for(let e=0;e<i.length;e++){let t=i[e].style;t.borderColor=this.options.colors[0],t.boxShadow="0 0 12px ".concat(this.options.colors[1],", 0 0 20px ").concat(this.options.colors[1]," inset")}}}}class QU extends YU{constructor(e,t){super(e,t),this.markersElement=[],this.features&&this._createMarker()}setMarkersWidth(e,t){this.options.width=e;let i=this.getElement(t);i&&i.style.setProperty("--container-width",e+"px")}setMarkersColors(e,t){if(this.options.colors=e,e&&e.length&&e.length>0){let e=this.getElement(t);if(!e)return;let i=e.style;i.setProperty("--background-color",this.options.colors[0]),i.setProperty("--box-shadow-color",this.options.colors[1]||this.options.colors[0])}}_createMarker(){this.features.features.forEach((e=>{let t=document.createElement("div");t.className="vjmap3d-animate-marker--diffused-aperture";let i=document.createElement("div");i.className="vjmap3d-animate-marker__diffused-aperture-wrapper";let n=document.createElement("div");n.className="vjmap3d-animate-marker__bg",i.appendChild(n);let s=document.createElement("div");s.className="vjmap3d-animate-marker__circle",i.appendChild(s),t.appendChild(i);let r=this._getTextContainer(e,"diffused-aperture-name");r&&t.appendChild(r),this.options.width&&t.style.setProperty("--container-width",this.options.width+"px"),this.options.colors&&this.options.colors.length&&this.options.colors.length>0&&(t.style.setProperty("--background-color",this.options.colors[0]),t.style.setProperty("--box-shadow-color",this.options.colors[1]||this.options.colors[0])),this.markersElement.push(t)}))}}class qU extends YU{constructor(e,t){super(e,t),this.markersElement=[],this.features&&this._createMarker()}setMarkersWidth(e,t){this.options.width=e;let i=this.getElement(t);i&&this._setFluorescenceWidth(i.style)}setMarkersColors(e,t){if(this.options.colors=e,e&&e.length&&e.length>0){let e=this.getElement(t);if(!e)return;this._setFluorescenceColor(e.style)}}_createMarker(){this.features.features.forEach((e=>{let t=document.createElement("div");t.className="vjmap3d-animate-marker--fluorescence";let i=document.createElement("div");i.className="vjmap3d-animate-marker__fluorescence",t.appendChild(i);let n=this._getTextContainer(e,"fluorescence-name");n&&t.appendChild(n),this._setFluorescenceWidth(t.style),this._setFluorescenceColor(t.style),this.markersElement.push(t)}))}_setFluorescenceWidth(e){this.options.width&&(e.setProperty("--container-width",this.options.width/3+"px"),e.setProperty("--box-shadow-width",this.options.width+"px"))}_setFluorescenceColor(e){this.options.colors&&this.options.colors.length>0&&(e.setProperty("--box-shadow-color",this.options.colors[0]),e.setProperty("--light-color",this.options.colors[1]))}}class ZU extends YU{constructor(e,t){super(e,t),this.markersElement=[],this.features&&this._createMarker()}setMarkersWidth(e,t){this.options.width=e;let i=this.getElement(t);if(!i)return;let n=i.style;n.setProperty("--halo-width",this.options.width+"px"),n.setProperty("--halo-left",-this.options.width/2+"px"),n.setProperty("--box-shadow-width-1",this.options.width/10+"px"),n.setProperty("--box-shadow-width-2",this.options.width/4+"px")}setMarkersColors(e,t){if(this.options.colors=e,e&&e.length&&e.length>0){let e=this.getElement(t);if(!e)return;let i=e.style;i.setProperty("--color-1",this._getColorWithOpacity(this.options.colors[0],.3)),i.setProperty("--color-1-transparent",this._getColorWithOpacity(this.options.colors[0],.1)),i.setProperty("--color-2",this._getColorWithOpacity(this.options.colors[1],.3)),i.setProperty("--color-2-transparent",this._getColorWithOpacity(this.options.colors[1],.1))}}_createMarker(){this.features.features.forEach((e=>{let t=document.createElement("div");t.className="vjmap3d-animate-marker--halo-ring",this._createMakerElement(8,"div",["vjmap3d-animate-marker__ring","vjmap3d-animate-marker__halo"]).forEach((function(e){t.appendChild(e)}));let i=this._getTextContainer(e,"halo-ring-name");i&&t.appendChild(i),this.options.width&&(t.style.setProperty("--halo-width",this.options.width+"px"),t.style.setProperty("--halo-left",-this.options.width/2+"px"),t.style.setProperty("--box-shadow-width-1",this.options.width/10+"px"),t.style.setProperty("--box-shadow-width-2",this.options.width/4+"px")),this.options.colors&&this.options.colors.length&&this.options.colors.length>0&&(t.style.setProperty("--color-1",this._getColorWithOpacity(this.options.colors[0],.3)),t.style.setProperty("--color-1-transparent",this._getColorWithOpacity(this.options.colors[0],.1)),t.style.setProperty("--color-2",this._getColorWithOpacity(this.options.colors[1],.3)),t.style.setProperty("--color-2-transparent",this._getColorWithOpacity(this.options.colors[1],.1))),this.markersElement.push(t)}))}_createMakerElement(e,t,i){let n=[];for(let s=1;s<e+1;s++){let e=document.createElement(t);e.className="".concat(i[0],"-0").concat(s," ").concat(i[1]),n.push(e)}return n}}class KU extends YU{constructor(e,t){super(e,t),this.markersElement=[],this.features&&this._createMarker()}setMarkersWidth(e,t){if(this.options.width=e,!this.options.width||this.options.width<40)return;let i=this.getElement(t);if(!i)return;i.style.setProperty("--container-width","".concat(this.options.width,"px"));let n=i.children[0],s=i.children[1],r=i.children[2];n.setAttribute("style",this._getDotsStyleObj(this.options.width-32)),s.setAttribute("style",this._getDotsStyleObj(this.options.width-16)),r.setAttribute("style",this._getDotsStyleObj(this.options.width))}setMarkersColors(e,t){if(this.options.colors=e,e&&e.length&&e.length>0){let e=this.getElement(t);if(!e)return;let i=e.style;i.setProperty("--light-color",this.options.colors[1]),i.setProperty("--color",this.options.colors[0]),i.setProperty("--line-color",this._getColorWithOpacity(this.options.colors[0],.2))}}_createMarker(){this.features.features.forEach((e=>{let t=this.options.width&&this.options.width>=40?this.options.width:50,i=document.createElement("div");i.className="vjmap3d-animate-marker--rotating-aperture",this._createMakerElement(3,"div",["vjmap3d-animate-marker__dots","vjmap3d-animate-marker__dots"]).forEach(((e,n)=>{let s;0===n&&(s=t-32),1===n&&(s=t-16),2===n&&(s=t),e.setAttribute("style",this._getDotsStyleObj(s)),i.appendChild(e)}));let n=this._getTextContainer(e,"rotating-aperture-name");n&&i.appendChild(n),this.options.colors&&this.options.colors.length&&this.options.colors.length>0&&(i.style.setProperty("--color",this.options.colors[0]),i.style.setProperty("--line-color",this._getColorWithOpacity(this.options.colors[0],.2)),i.style.setProperty("--light-color",this.options.colors[1])),i.style.setProperty("--container-width",t+"px"),this.markersElement.push(i)}))}_createMakerElement(e,t,i){let n=[];for(let s=1;s<e+1;s++){let e=document.createElement(t);e.className="".concat(i[0],"-0").concat(s," ").concat(i[1]),n.push(e)}return n}_getDotsStyleObj(e){return"--dots-width: ".concat(e,"px;\n      --dots-height: ").concat(e,"px;\n      --dots-box-shadow-x: ").concat(e/2+6,"px;\n      --dots-box-shadow-x-negative: -").concat(e/2+6,"px;\n      --dots-box-shadow-radius1: ").concat(e/2-2,"px;\n      --dots-box-shadow-radius1-negative: -").concat(e/2-2,"px;\n      --dots-box-shadow-radius2: ").concat(e/2-3,"px;\n      --dots-box-shadow-radius2-negative: -").concat(e/2-3,"px;")}}class JU extends YU{constructor(e,t){super(e,t),this.markersElement=[],this.features&&this._createMarker()}setMarkersWidth(e){this.options.width=e,this._setMarkerContainerProperty({"--clip-width-1":e+e/10+"px","--clip-width-2":e+e/10-2+"px","--boder-width":e+"px","--text-left-position":-e/2+"px"})}setMarkersHeight(e){this.options.height=e,this._setMarkerContainerProperty({"--clip-height-1":e+e/10+"px","--clip-height-2":e+e/10-2+"px","--boder-height":e+"px"})}setMarkersTextField(e,t){if(!this.features||"{}"===JSON.stringify(this.features))return;this.options.textField=e;let i=this.getElement(t).getElementsByClassName("vjmap3d-animate-marker__text"),n=this.features.features;for(let t=0;t<i.length;t++){let s=n[t]&&n[t].properties;s&&s[e]?i[t].innerHTML=s[e]:i[t].innerHTML=""}}setMarkersTextColor(e,t){this.options.textColor=e,this._setMarkerContainerProperty({"--text-color":e})}setMarkersTextFontSize(e,t){this.options.textFontSize=e,this._setMarkerContainerProperty({"--text-font-size":e+"px"},t)}setMarkersColors(e,t){this.options.colors=e,e&&e.length&&e.length>0&&this._setMarkerContainerProperty({"--border-color":e[0],"--box-shadow-color":e[1]},t)}_createMarker(){this.features.features.forEach((e=>{let t=document.createElement("div");t.className="vjmap3d-animate-marker--text-boder";let i=document.createElement("div");i.className="vjmap3d-animate-marker__boder";let n,s=Object.keys(e.properties||{});(e.properties||0!==Object.keys(e.properties).length)&&(n=e.properties[this.options.textField]||e.properties[s[0]]);let r=document.createElement("span");r.className="vjmap3d-animate-marker__text",r.innerHTML=n||"",i.appendChild(r),this.options.colors&&this.options.colors.length&&this.options.colors.length>0&&(t.style.setProperty("--border-color",this.options.colors[0]),t.style.setProperty("--box-shadow-color",this.options.colors[1])),this.options.textColor&&t.style.setProperty("--text-color",this.options.textColor),this.options.textFontSize&&t.style.setProperty("--text-font-size",this.options.textFontSize+"px"),this.options.width&&(t.style.setProperty("--clip-width-1",this.options.width+this.options.width/10+"px"),t.style.setProperty("--clip-width-2",this.options.width+this.options.width/10-2+"px"),t.style.setProperty("--boder-width",this.options.width+"px"),t.style.setProperty("--text-left-position",-this.options.width/2+"px")),this.options.height&&(t.style.setProperty("--clip-height-1",this.options.height+this.options.width/10+"px"),t.style.setProperty("--clip-height-2",this.options.height+this.options.width/10-2+"px"),t.style.setProperty("--boder-height",this.options.height+"px")),(this.options.width||100)>(this.options.width||200)?t.style.setProperty("--animation-name","clipMe2"):t.style.setProperty("--animation-name","clipMe1"),t.appendChild(i),this.markersElement.push(t)}))}_setMarkerContainerProperty(e,t){let i=this.getElement(t);if(!i)return;let n=i.style;Object.keys(e).forEach((function(t){n.setProperty(t,e[t])})),(this.options.height||100)>(this.options.width||200)?n.setProperty("--animation-name","clipMe2"):n.setProperty("--animation-name","clipMe1")}}const $U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAANpJREFUOE9jZKAQMFKon2FgDKjZHVHf4rqiEeR6kl1QuzOyn+E/4/lmj2WLSDagekdkASMjg1aL+/I0WNgR7YLaHRG2/xgZYlrdV6QjBzzRBtTsijzzl4nVvd1l0VucBtTsjlz5/z/jt1a3ZYnIimp2RZ7//+9fQ6vHyo3o0Q53Qc32CAcGpv88DIxMxQyMDB9aXJcHghTX7IxcyMjAeLTZfdksbGkGqxdqdkUuZ2BgkPjPyDCFgeG/W6srqr+JCoPqXZG9jAwM9iyszy0aHA/8wZViiQ7EYWwAAPShQBF/1IlVAAAAAElFTkSuQmCC";class eF{constructor(e){var t;iF.CloseMenu(),this.options=e||{},this.options.theme=this.options.theme||"","dark"==this.options.theme&&(this.options.theme=""),""!=this.options.theme&&(this.options.theme="_"+this.options.theme),this.position=null!=e.isSticky&&e.isSticky,this.menuControl=iF.CreateEl(`<ul class='vj3dContextJs vj3dContextMenu${this.options.theme}'></ul>`),this.menuControl.style.width=null!=e.width?e.width:"150px",this.menuControl.oncontextmenu=function(){return!1},e.items.forEach((e=>{let t=new tF(e,this.options);this.menuControl.appendChild(t.element)})),(null===(t=this.options.event)||void 0===t?void 0:t.stopPropagation)&&this.options.event.stopPropagation(),document.body.appendChild(this.menuControl),iF.PositionMenu(this.position,this.options.event,this.menuControl,this.options,this.options.position);let i=new Date;document.onclick=e=>{null==this.options.event&&i.getTime()-i.getTime()<200||e.target.classList.contains("vj3dContextJs")||iF.CloseMenu()},document.onmousedown=e=>{null==this.options.event&&i.getTime()-i.getTime()<200||e.target.classList.contains("vj3dContextJs")||iF.CloseMenu()}}add(e){this.menuControl.appendChild(e.element)}show(){var e;(null===(e=this.options.event)||void 0===e?void 0:e.stopPropagation)&&this.options.event.stopPropagation(),document.body.appendChild(this.menuControl),iF.PositionMenu(this.position,this.options.event,this.menuControl,this.options)}hide(){var e;(null===(e=this.options.event)||void 0===e?void 0:e.stopPropagation)&&this.options.event.stopPropagation(),iF.CloseMenu()}toggle(){var e;(null===(e=this.options.event)||void 0===e?void 0:e.stopPropagation)&&this.options.event.stopPropagation(),this.menuControl.parentElement!=document.body?(document.body.appendChild(this.menuControl),iF.PositionMenu(this.position,this.options.event,this.menuControl,this.options)):iF.CloseMenu()}}class tF{constructor(e,t){switch(this.options=t||{},e.type){case"seperator":this.seperator();break;case"custom":this.custom(e.markup);break;case"multi":this.multiButton(e.items);break;case"submenu":this.subMenu(e.label,e.items,void 0!==e.icon?e.icon:"",void 0!==e.cssIcon?e.cssIcon:"",void 0===e.enabled||e.enabled);break;case"hovermenu":this.hoverMenu(e.label,e.items,void 0!==e.icon?e.icon:"",void 0!==e.cssIcon?e.cssIcon:"",void 0===e.enabled||e.enabled);break;default:this.button(e.label,e.onClick,void 0!==e.shortcut?e.shortcut:"",void 0!==e.icon?e.icon:"",void 0!==e.cssIcon?e.cssIcon:"",void 0===e.enabled||e.enabled)}}button(e,t,i="",n="",s="",r=!0){"checked"==n&&(n=$U),this.element=iF.CreateEl(`\n            <li class='vj3dContextJs vj3dContextMenuItemOuter${this.options.theme}'>\n                <div class='vj3dContextJs vj3dContextMenuItem${this.options.theme}' ${1==r?"":"disabled"}'>\n                    ${""!=n?`<img src='${n}' class='vj3dContextJs vj3dContextMenuItemIcon${this.options.theme}'/>`:`<div class='vj3dContextJs vj3dContextMenuItemIcon${this.options.theme} ${""!=s?s:""}'></div>`}\n                    <span class='vj3dContextJs vj3dContextMenuItemTitle${this.options.theme}'>${null==e?"No label":e}</span>\n                    <span class='vj3dContextJs vj3dContextMenuItemTip${this.options.theme}'>${""==i?"":i}</span>\n                </div>\n            </li>`),1==r&&this.element.addEventListener("click",(()=>{var e;(null===(e=this.options.event)||void 0===e?void 0:e.stopPropagation)&&this.options.event.stopPropagation(),void 0!==t&&t(),iF.CloseMenu()}),!1)}custom(e){this.element=iF.CreateEl(`<li class='vj3dContextJs ContextMenuCustomEl${this.options.theme}'>${e}</li>`)}hoverMenu(e,t,i="",n="",s=!0){"checked"==i&&(i=$U),this.element=iF.CreateEl(`\n            <li class='vj3dContextJs vj3dContextHoverMenuOuter${this.options.theme}'>\n                <div class='vj3dContextJs vj3dContextHoverMenuItem${this.options.theme} ${1==s?"":"disabled"}'>\n                    ${""!=i?`<img src='${i}' class='vj3dContextJs vj3dContextMenuItemIcon${this.options.theme}'/>`:`<div class='vj3dContextJs vj3dContextMenuItemIcon${this.options.theme} ${""!=n?n:""}'></div>`}\n                    <span class='vj3dContextJs vj3dContextMenuItemTitle${this.options.theme}'>${null==e?"No label":e}</span>\n                    <span class='vj3dContextJs vj3dContextMenuItemOverflow${this.options.theme}'>></span>\n                </div>\n                <ul class='vj3dContextJs vj3dContextHoverMenu${this.options.theme}'>\n                </ul>\n            </li>\n        `);let r=this.element.querySelector(`.vj3dContextHoverMenu${this.options.theme}`),o=this.element.querySelector(`.vj3dContextHoverMenuItem${this.options.theme}`);void 0!==t&&t.forEach((e=>{let t=new tF(e,this.options);r.appendChild(t.element)})),1==s&&(o.addEventListener("mouseenter",(e=>{var t,i,n,s;let a=o.getBoundingClientRect(),l=r.getBoundingClientRect(),h=null!==(i=null===(t=this.options)||void 0===t?void 0:t.innerWidth)&&void 0!==i?i:window.innerWidth,c=null!==(s=null===(n=this.options)||void 0===n?void 0:n.innerHeight)&&void 0!==s?s:window.innerHeight;l.right>h&&(r.style.left=h-a.left-l.width+"px"),l.bottom>c&&(r.style.top=c-a.top-l.height+"px")})),o.addEventListener("mouseleave",(e=>{})))}multiButton(e){this.element=iF.CreateEl(`\n            <li class='vj3dContextJs vj3dContextMultiItem${this.options.theme}'>\n            </li>\n        `),e.forEach((e=>{let t=new tF(e,this.options);this.element.appendChild(t.element)}))}subMenu(e,t,i="",n="",s=!0){"checked"==i&&(i=$U),this.element=iF.CreateEl(`\n            <li class='vj3dContextJs vj3dContextMenuItemOuter${this.options.theme}'>\n                <div class='vj3dContextJs vj3dContextMenuItem${this.options.theme} ${1==s?"":"disabled"}'>\n                    ${""!=i?`<img src='${i}' class='vj3dContextJs vj3dContextMenuItemIcon${this.options.theme}'/>`:`<div class='vj3dContextJs vj3dContextMenuItemIcon${this.options.theme} ${""!=n?n:""}'></div>`}\n                    <span class='vj3dContextJs vj3dContextMenuItemTitle${this.options.theme}'>${null==e?"No label":e}</span>\n                    <span class='vj3dContextJs vj3dContextMenuItemOverflow${this.options.theme}'>\n                        <span class='vj3dContextJs vj3dContextMenuItemOverflowLine${this.options.theme}'></span>\n                        <span class='vj3dContextJs vj3dContextMenuItemOverflowLine${this.options.theme}'></span>\n                        <span class='vj3dContextJs vj3dContextMenuItemOverflowLine${this.options.theme}'></span>\n                    </span>\n                </div>\n                <ul class='vj3dContextJs vj3dContextSubMenu${this.options.theme} vj3dContextMenuHidden${this.options.theme}'>\n                </ul>\n            </li>`);let r=this.element.querySelector(`.vj3dContextSubMenu${this.options.theme}`),o=this.element.querySelector(`.vj3dContextMenuItem${this.options.theme}`);void 0!==t&&t.forEach((e=>{let t=new tF(e,this.options);r.appendChild(t.element)})),1==s&&o.addEventListener("click",(()=>{o.classList.toggle(`vj3dSubMenuActive${this.options.theme}`),r.classList.toggle(`vj3dContextMenuHidden${this.options.theme}`)}),!1)}seperator(e,t){this.element=iF.CreateEl(`<li class='vj3dContextJs vj3dContextMenuSeperator${this.options.theme}'><span></span></li>`)}}const iF={PositionMenu:(e,t,i,n,s)=>{var r,o,a,l;let h=null!==(r=null==n?void 0:n.innerWidth)&&void 0!==r?r:window.innerWidth,c=null!==(o=null==n?void 0:n.innerHeight)&&void 0!==o?o:window.innerHeight;e&&t?(i.style.left=t.target.offsetLeft+i.offsetWidth>=h?t.target.offsetLeft-i.offsetWidth+t.target.offsetWidth+"px":t.target.offsetLeft+"px",i.style.top=t.target.offsetTop+i.offsetHeight>=c?t.target.offsetTop-i.offsetHeight+"px":t.target.offsetHeight+t.target.offsetTop+"px"):(s=s||[null!==(a=t.clientX)&&void 0!==a?a:t.touches&&t.touches.length>0?t.touches[0].clientX:0,null!==(l=t.clientY)&&void 0!==l?l:t.touches&&t.touches.length>0?t.touches[0].clientY:0],i.style.left=s[0]+i.offsetWidth>=h?s[0]-i.offsetWidth+"px":s[0]+"px",i.style.top=s[1]+i.offsetHeight>=c?s[1]-i.offsetHeight+"px":s[1]+"px")},CloseMenu:()=>{let e=document.querySelector(".vj3dContextMenu:not(.vj3dContextMenuHidden)");null!=e&&document.body.removeChild(e);let t=document.querySelector(".vj3dContextMenu_light:not(.vj3dContextMenuHidden_light)");null!=t&&document.body.removeChild(t)},CreateEl:e=>{var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}};class nF{constructor(e){this.options=e}_insertControl(){var e,t,i;this.container=document.createElement("div"),this.container.classList.add("vjmap3d-ctrl"),this.panel=document.createElement("div"),this.panel.style.display="flex",this.options.direction=null!==(e=this.options.direction)&&void 0!==e?e:"column",this.panel.style.flexDirection=this.options.direction,this.panel.classList.add("mapstopprop","button-bar","button-bar-direction-"+this.options.direction);const n=this.options.buttons;let s;for(const e of n){const n=Wy({innerHTML:null!==(t=e.icon)&&void 0!==t?t:e.html,id:e.id,classList:["mapstopprop","button-bar-button","util-button",...null!==(i=e.classList)&&void 0!==i?i:[],...e.round?["round-button"]:[]],addToBody:!1});if(e.style)for(let t in e.style)n.style[t]=e.style[t];e.title&&(n.title=e.title),e.checked&&n.classList.toggle("button-bar-selected-box"),n.onclick=t=>{e.toggle&&n.classList.toggle("button-bar-selected-box"),s&&s!=n?(s.classList.remove("button-bar-selected"),n.classList.add("button-bar-selected"),s=n):(n.classList.add("button-bar-selected"),s=n),e.onclick&&e.onclick(t,n)},this.panel.appendChild(n),this.options.barSelectMode&&this.options.barCurSelectId&&!s&&n.id==this.options.barCurSelectId&&(n.classList.add("button-bar-selected"),s=n)}this.container.appendChild(this.panel),this.options.lightTheme&&this.setTheme(this.options.lightTheme)}onAdd(e){return this.app=e,this._insertControl(),this.container}onRemove(){var e,t;null===(t=null===(e=this.container)||void 0===e?void 0:e.parentNode)||void 0===t||t.removeChild(this.container)}setTheme(e){e?this.container.classList.add("vjTheme-white"):this.container.classList.remove("vjTheme-white")}getDefaultPosition(){return"bottom-left"}}var sF,rF,oF,aF,lF,hF,cF;class dF{constructor(e={}){var t,i,n,s;sF.set(this,0),rF.set(this,void 0),this.digits=null!==(t=e.digits)&&void 0!==t?t:5,this.trackCenter=null!==(i=e.trackCenter)&&void 0!==i&&i,this.labelFormat=null!==(n=e.labelFormat)&&void 0!==n?n:this.defaultLabelFormat,this.unProjectModes=e.UnProjectModes,this.style=null!==(s=e.style)&&void 0!==s?s:{backgroundColor:"hsla(0,0%,100%,.75)",border:"1px solid #333"}}insertControl(){this.container=document.createElement("div"),this.container.classList.add("vjmap3d-ctrl","mapstopprop"),this.container.style.border=this.style.border,this.container.style.backgroundColor=this.style.backgroundColor,this.panel=document.createElement("div"),this.panel.style.color="black",this.trackCenter?this.onMouseMove():this.panel.innerHTML=this.labelFormat(0,0,0,this),this.container.appendChild(this.panel),this.container.addEventListener("click",(()=>{var e;Zv(this,sF,(e=qv(this,sF,"f"),++e),"f"),this.onMouseMove(qv(this,rF,"f"))}))}defaultLabelFormat(e,t,i){let n="";return n=`${e.toFixed(this.digits)}, ${t.toFixed(this.digits)}, ${i.toFixed(this.digits)}`,n}onMouseMove(e){var t;return Qv(this,void 0,void 0,(function*(){Zv(this,rF,e,"f");let i,n={};if(this.trackCenter)n.x=this.app.containerSize.width/2,n.y=this.app.containerSize.height/2;else{if(!e)return;n=hG(e)}let s=null!==(t=this.unProjectModes)&&void 0!==t?t:[void 0,!1],r=s[qv(this,sF,"f")%s.length],o={};if(void 0===r||"depth"==r){let e=yield this.app.getDepth(n.x,n.y);i=this.app.unproject(n.x,n.y,e,o)}else i=this.app.unproject(n.x,n.y,r,o);i&&(this.panel.innerHTML=this.labelFormat(i.x,i.y,i.z,this,o))}))}onAdd(e){return this.app=e,this.insertControl(),this.onMouseMove_func=this.trackCenter?throttle(this.onMouseMove.bind(this),500):this.onMouseMove.bind(this),this.trackCenter?this.app.signal.onCameraUpdate.add(this.onMouseMove_func):this.app.signal.onMouseMove.add(this.onMouseMove_func),this.container}onRemove(){var e;this.trackCenter?this.app.signal.onCameraUpdate.remove(this.onMouseMove_func):this.app.signal.onMouseMove.remove(this.onMouseMove_func),null===(e=this.container.parentNode)||void 0===e||e.removeChild(this.container)}getDefaultPosition(){return"bottom-left"}}sF=new WeakMap,rF=new WeakMap;class uF{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof window.HTMLElement?this._container=e.container:console.warn("Full screen control 'container' must be a DOM element.")),gv(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._app=e,this._container||(this._container=this._app.container),this._controlContainer=bz.create("div","vjmap3d-ctrl vjmap3d-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",console.warn("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){bz.remove(this._controlContainer),this._app=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!window.document.fullscreenEnabled&&!window.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=bz.create("button","vjmap3d-ctrl-fullscreen",this._controlContainer);bz.create("span","vjmap3d-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._isFullscreen()?"退出全屏":"进入全屏"}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("vjmap3d-ctrl-shrink"),this._fullscreenButton.classList.toggle("vjmap3d-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}}class pF{constructor(e={}){var t,i,n;this.mapRotateZ=0,this.options=e,this.style=null!==(t=e.bkDivStyle)&&void 0!==t?t:{backgroundColor:"#0c0707bf",border:"1px solid #333"},this.mapRotateZ=null!==(i=this.options.mapRotateZ)&&void 0!==i?i:0,this.mapSyncRotateZ=null!==(n=this.options.mapSyncRotateZ)&&void 0!==n&&n,this.followTarget=this.options.followTarget}setFollowTarget(e){this.followTarget=e}insertControl(){var e,t,i,n,s,r,o,a,l,h,c,d,u,p,m;this.container=document.createElement("div"),this.container.classList.add("vjmap3d-ctrl","mapstopprop"),this.container.style.border=this.style.border,this.container.style.backgroundColor=this.style.backgroundColor;const g=new $t(Object.assign({alpha:!0},this.options.rendererParameters));let v=null!==(e=this.options.mapRenderSize)&&void 0!==e?e:200;if(g.setSize(v,v),!1!==this.options.shadowMapEnabled&&(g.shadowMap.enabled=!0,g.shadowMap.type=ei),this._miniMapRenderer=g,g.domElement.style.transform=`rotateZ(${this.mapRotateZ}deg)`,g.domElement.style.pointerEvents="none",this.options.mapDivStyle)for(let e in this.options.mapDivStyle)g.domElement.style[e]=this.options.mapDivStyle[e];this._miniMapDomEl=g.domElement;let y=null!==(t=this.options.mapSize)&&void 0!==t?t:10,x=null!==(i=this.options.cameraOption)&&void 0!==i?i:{};const w=!1!==x.isOrthographicCamera?new f(null!==(n=x.left)&&void 0!==n?n:-y/2,null!==(s=x.right)&&void 0!==s?s:y/2,null!==(r=x.top)&&void 0!==r?r:y/2,null!==(o=x.bottom)&&void 0!==o?o:-y/2,null!==(a=x.near)&&void 0!==a?a:1,null!==(l=x.far)&&void 0!==l?l:1e3):new ee(null!==(h=x.fov)&&void 0!==h?h:45,null!==(c=x.aspect)&&void 0!==c?c:1,null!==(d=x.near)&&void 0!==d?d:.1,null!==(u=x.far)&&void 0!==u?u:1e3);if(this._miniMapCamera=w,this.followTarget)this.updateCamera();else{let e=null!==(p=x.position)&&void 0!==p?p:[0,10,0];this._miniMapCamera.position.copy(Vv(e));let t=null!==(m=x.lookAt)&&void 0!==m?m:[0,0,0];this._miniMapCamera.lookAt(Vv(t))}this.container.appendChild(this._miniMapDomEl)}updateCamera(){var e;if(this.mapSyncRotateZ){let e=Gv(this.followTarget.rotation.y);this._miniMapDomEl.style.transform=`rotateZ(${this.mapRotateZ+e}deg)`}if((!this.options.cameraUpdate||!0!==this.options.cameraUpdate(this._miniMapCamera,this.followTarget,this))&&this.followTarget){let t=this.followTarget.position;this._miniMapCamera.position.set(t.x,t.y+(null!==(e=this.options.followTargetCameraHeight)&&void 0!==e?e:10),t.z),this._miniMapCamera.lookAt(t.x,t.y,t.z)}}onAdd(e){return this.app=e,this.insertControl(),this.onUpdate_func=this.options.throttleTime?av(this.onUpdate.bind(this),this.options.throttleTime):this.onUpdate.bind(this),this.app.signal.onAppAfterRender.add(this.onUpdate_func),this.container}onUpdate(){var e;this.updateCamera(),this._miniMapRenderer.render(null!==(e=this.options.scene)&&void 0!==e?e:this.app.scene,this._miniMapCamera)}onRemove(){var e;this.app.signal.onAppAfterRender.remove(this.onUpdate_func),null===(e=this.container.parentNode)||void 0===e||e.removeChild(this.container)}getDefaultPosition(){return"bottom-right"}}class fF extends Sy{constructor(e,t){super(e),oF.set(this,0),aF.set(this,new Map),lF.set(this,void 0),hF.set(this,void 0),e.pointerEvents=!0,this.addEvent(t),this.addDispose((()=>{for(let e=0;e<qv(this,oF,"f");e++)this.removeEvent(e);qv(this,lF,"f")&&(qv(this,lF,"f").remove(),Zv(this,lF,null,"f")),qv(this,hF,"f")&&(qv(this,hF,"f").remove(),Zv(this,hF,null,"f"))}))}addEvent(e){var t,i;(e=e||{}).popupAnchor=e.popupAnchor||"middle-top",e.popupOptions=e.popupOptions||{},e.popupOptions.anchor="bottom";const n=t=>!0===e.highlightUseBoxHelper?t.boxHelper:t.isHighlight(),s=(t,i,n)=>{!0===e.highlightUseBoxHelper?t.boxHelper={lineColor:i,fillColor:i,fillOpacity:n}:t.setHighlight(null!=i?i:this.app.envConfig.highlightColor,null!=n?n:this.app.envConfig.highlightOpacity)},r=t=>{!0===e.highlightUseBoxHelper?t.boxHelper=!1:t.clearHighlight()};let o=[];for(let t in e)t in this.entity.signal&&o.push(this.entity.signal[t].add(e[t]));const a=(e,t)=>Qv(this,void 0,void 0,(function*(){"string"==typeof t?e.setHTML(t):e.setHTML(yield t(this.entity))}));return(e.clickSelect||e.clickHighlight||e.clickHtmlText||e.clickCallback)&&this.entity.onEntityAwake((()=>{o.push(this.entity.app.signal.onMouseClick.add(((t,i)=>{var o;if(!0===e.enableWhenActiveTool||!this.entity.app.isInteracting())if((null==i?void 0:i.target)==this.entity){if(e.clickSelect&&!this.entity.selected&&(this.entity.selected=!0),e.clickHighlight&&!n(this.entity)&&s(this.entity,e.highlightColor,e.highlightOpacity),e.clickCallback&&e.clickCallback(this.entity,!0,i),e.clickHtmlText)if(qv(this,lF,"f"))a(qv(this,lF,"f"),e.clickHtmlText);else{let t=Object.assign({},e.popupOptions);t.closeButton=null===(o=e.popupOptions.closeButton)||void 0===o||o,Zv(this,lF,new HU(Object.assign({},t)),"f"),a(qv(this,lF,"f"),e.clickHtmlText).then((()=>{var t,n;if(qv(this,lF,"f")){qv(this,lF,"f").setPosition(uW(this.entity.node,e.popupAnchor,null===(t=e.popupAsEntityChild)||void 0===t||t,this.app));let s=!1;if(null==e?void 0:e.popupCallback){let t=null==e?void 0:e.popupCallback(this.entity,qv(this,lF,"f"),!1,i);t&&(t.isEntity?(qv(this,lF,"f").addTo(this.entity),s=!0):t.isObject3D&&(qv(this,lF,"f").addTo(UP.attchObject(t.isObject3D)),s=!0))}s||(null===(n=e.popupAsEntityChild)||void 0===n||n?qv(this,lF,"f").addTo(this.entity):qv(this,lF,"f").addTo(this.app))}}))}}else{let t=e.cancelSelectMode;"inherit"!=t&&void 0!==t||(t=this.entity.app.envConfig.cancelSelectMode);let s=e.cancelHighlight;"inherit"!=s&&void 0!==s||(s=this.entity.app.envConfig.cancelHighlight),("clickOtherPosition"==t||"clickOtherEntity"==t&&(null==i?void 0:i.target))&&this.entity.selected&&(this.entity.selected=!1),("clickOtherPosition"==s||"clickOtherEntity"==s&&(null==i?void 0:i.target))&&n(this.entity)&&r(this.entity),("clickOtherPosition"==t||"clickOtherEntity"==t&&(null==i?void 0:i.target))&&qv(this,lF,"f")&&(qv(this,lF,"f").remove(),Zv(this,lF,null,"f")),e.clickCallback&&e.clickCallback(this.entity,!1,i)}})))})),(e.hoverSelect||e.hoverHighlight||e.hoverHtmlText||e.hoverCallback)&&this.entity.onEntityAwake((()=>{o.push(this.entity.signal.onMouseOver.add(((t,i)=>{var r;if((!0===e.enableWhenActiveTool||!this.entity.app.isInteracting())&&!this.entity.isDisposed&&(e.hoverSelect&&!this.entity.selected&&(this.entity.selected=!0),e.hoverHighlight&&!n(this.entity)&&s(this.entity,e.highlightColor,e.highlightOpacity),e.hoverCallback&&e.hoverCallback(this.entity,!0,i),e.hoverHtmlText))if(qv(this,hF,"f"))a(qv(this,hF,"f"),e.hoverHtmlText);else{let t=Object.assign({},e.popupOptions);t.closeButton=null!==(r=e.popupOptions.closeButton)&&void 0!==r&&r,Zv(this,hF,new HU(Object.assign({},t)),"f"),a(qv(this,hF,"f"),e.hoverHtmlText).then((()=>{var t,n;if(qv(this,hF,"f")){qv(this,hF,"f").setPosition(uW(this.entity.node,e.popupAnchor,null===(t=e.popupAsEntityChild)||void 0===t||t,this.app));let s=!1;if(null==e?void 0:e.popupCallback){let t=null==e?void 0:e.popupCallback(this.entity,qv(this,hF,"f"),!0,i);t&&(t.isEntity?(qv(this,hF,"f").addTo(this.entity),s=!0):t.isObject3D&&(qv(this,hF,"f").addTo(UP.attchObject(t)),s=!0))}s||(null===(n=e.popupAsEntityChild)||void 0===n||n?qv(this,hF,"f").addTo(this.entity):qv(this,hF,"f").addTo(this.app))}}))}}))),o.push(this.entity.signal.onMouseOut.add(((t,i)=>{!0!==e.enableWhenActiveTool&&this.entity.app.isInteracting()||(e.hoverSelect&&this.entity.selected&&(this.entity.selected=!1),e.hoverHighlight&&n(this.entity)&&r(this.entity),qv(this,hF,"f")&&(qv(this,hF,"f").remove(),Zv(this,hF,null,"f")),e.hoverCallback&&e.hoverCallback(this.entity,!1,i))})))})),qv(this,aF,"f").set(qv(this,oF,"f"),o),Zv(this,oF,(i=qv(this,oF,"f"),t=i++,i),"f"),t}removeEvent(e){var t;e=null!=e?e:0,qv(this,aF,"f").has(e)&&(null!==(t=qv(this,aF,"f").get(e))&&void 0!==t?t:[]).forEach((e=>e()))}}oF=new WeakMap,aF=new WeakMap,lF=new WeakMap,hF=new WeakMap,fF.moduleName="EventModule";class mF extends Sy{constructor(e,t){super(e),this.physics=this.app.addPhysicsBody(Object.assign({mesh:this.entity},t)),this.addDispose((()=>this.app.removePhysicsObject(this.entity)))}getBody(){return this.physics.body}removePhysics(){this.app.removePhysicsObject(this.entity)}}mF.moduleName="PhysicsModule";class gF extends Sy{constructor(e,t){var i,n,s,r;super(e),cF.set(this,void 0),this.options=null!=t?t:{},null!==(i=(r=this.options).animation)&&void 0!==i||(r.animation={}),Zv(this,cF,null!==(s=null===(n=this.options.animation)||void 0===n?void 0:n.id)&&void 0!==s?s:uv(),"f"),t&&this.start(t),this.addDispose((()=>{var e,t;this.tween&&(this.options.autoCompleteWhenExit?null===(e=this.tween.runningTween)||void 0===e||e.complete():null===(t=this.tween.runningTween)||void 0===t||t.stop())}))}start(e){var t,i,n;return this.options=null!==(t=null!=e?e:this.options)&&void 0!==t?t:{},null!==(i=(n=this.options).animation)&&void 0!==i||(n.animation={}),new Promise(((e,t)=>{var i,n,s,r,o,a,l,h;try{let t=null!==(i=this.app)&&void 0!==i?i:Cy.app,c=void 0===this.options.target?this.entity.node:this.options.target;this.options.paths.length<2&&e({target:c,isEnd:!0,isStop:!0,error:!0});let d,u=[],p=null!==(n=this.options.discretePointsNum)&&void 0!==n?n:300;for(let e=0;e<p;e++)u.push(xG(this.options.paths,e/p));if(c&&!this.options.followDist){let e=dW(c,!1,t);d=(e.max.y-e.min.y)*((null==t?void 0:t.isMapMode)?10:5),(d==-1/0||d==1/0||isNaN(d))&&(console.warn("followDist is invalid"),d=10)}this.lookAt(u[0],u[1],c,{euler:this.options.euler,followDist:d,followAngle:this.options.followAngle,cameraFollow:this.options.cameraFollow,tQuat:this.options.quatLerpT,offsetAngle:this.options.offsetAngle});let f,m=null===(s=this.options.isAutoChangeDir)||void 0===s||s;if(void 0!==this.options.startAimatorClipName){let e=this.entity.getModule(vz);e&&(f=e.getAnimator(null!==(r=this.options.animatorIndex)&&void 0!==r?r:0),""===this.options.startAimatorClipName?f.stopAllAction():f.play(this.options.startAimatorClipName))}null!==(o=(l=this.options).animation)&&void 0!==o||(l.animation={}),null!==(a=(h=this.options.animation).duration)&&void 0!==a||(h.duration=5e3),this.tween=zy(Object.assign(Object.assign({easing:"linear"},this.options.animation),{id:qv(this,cF,"f"),onProgress:(e,t,i,n,s,r)=>{var o,a;let l=s*u.length,h=Math.floor(l),p=l%1,f=!1;r&&m&&(f=!0);let g=h+(f?-1:1);g<0&&(g=0),g>u.length-1&&(g=u.length-1),this.lookAt(u[h],u[g],c,{tPosition:f?1-p:p,euler:this.options.euler,followDist:d,followAngle:this.options.followAngle,cameraFollow:this.options.cameraFollow,tQuat:this.options.quatLerpT,offsetAngle:this.options.offsetAngle}),(null===(o=this.options.animation)||void 0===o?void 0:o.onProgress)&&(null===(a=this.options.animation)||void 0===a||a.onProgress(c,t,i,n,s,r))},onComplete:(t,i,n)=>{var s,r;(null===(s=this.options.animation)||void 0===s?void 0:s.onComplete)&&(null===(r=this.options.animation)||void 0===r||r.onComplete(t,i,n)),i&&(void 0!==this.options.stopAimatorClipName&&f&&(""===this.options.stopAimatorClipName?f.stopAllAction():f.play(this.options.stopAimatorClipName)),e({target:t,isEnd:i,isStop:n,error:!1}))}}))}catch(e){t(e)}}))}lookAt(e,s,r,o){var a,l,h,c,d,u;null!=o||(o={}),null!=s||(s=e);let p=null!==(a=this.app)&&void 0!==a?a:Cy.app;if(e&&s){let a=null!==(l=o.tPosition)&&void 0!==l?l:1,f=e.clone().lerp(s,a);if(r&&r.position.set(f.x,f.y,f.z),f.equals(s))return;if(r){let i=s,a=null!==(h=o.offsetAngle)&&void 0!==h?h:0,l=new n;if(l.lookAt(r.position,i,r.up),null==p?void 0:p.isMapMode){let s=new t(Math.PI/2,(i.x>e.x?1:-1)*Math.PI/2,0);l.multiply((new n).makeRotationFromEuler(s))}l.multiply((new n).makeRotationFromEuler(new t(0,(null==p?void 0:p.isMapMode)?0:Wv(a),(null==p?void 0:p.isMapMode)?Wv(a):0))),o.euler&&l.multiply((new n).makeRotationFromEuler(o.euler));let d=(new v).setFromRotationMatrix(l),u=null!==(c=o.tQuat)&&void 0!==c?c:1;r.quaternion.slerp(d,u)}if(o.cameraFollow){let e=null!==(d=o.followDist)&&void 0!==d?d:10,t=null!==(u=o.followAngle)&&void 0!==u?u:35,n=e*Math.tan(Wv(t));const r=f.clone().sub(s).clone().normalize().multiplyScalar(e),a=f.clone().add(r),l=a.x,h=a.y+((null==p?void 0:p.isMapMode)?0:n),c=a.z+((null==p?void 0:p.isMapMode)?n:0),m=f.x,g=f.y,v=f.z;p&&p.setCameraLookAt(new i(l,h,c),new i(m,g,v))}}}setupUiConfig(){var e,t,i,n,s,r,o,a,l,h,c,d,u,p,f,m,g,v,y,x,w,b;null!==(e=(d=this.options).cameraFollow)&&void 0!==e||(d.cameraFollow=!1),null!==(t=(u=this.options).followDist)&&void 0!==t||(u.followDist=0),null!==(i=(p=this.options).followAngle)&&void 0!==i||(p.followAngle=35),null!==(n=(f=this.options).offsetAngle)&&void 0!==n||(f.offsetAngle=0),null!==(s=(m=this.options).animation)&&void 0!==s||(m.animation={}),null!==(r=(g=this.options.animation).duration)&&void 0!==r||(g.duration=5e3),null!==(o=(v=this.options.animation).yoyoForever)&&void 0!==o||(v.yoyoForever=!1),null!==(a=(y=this.options.animation).yoyoTimes)&&void 0!==a||(y.yoyoTimes=0),null!==(l=(x=this.options.animation).repeatForever)&&void 0!==l||(x.repeatForever=!1),null!==(h=(w=this.options.animation).repeatTimes)&&void 0!==h||(w.repeatTimes=0),null!==(c=(b=this.options.animation).delay)&&void 0!==c||(b.delay=0);const _=e=>{let t=e.value;"number"==typeof t&&(t=Math.round(t)),this.options.animation[e.config.label]=t,this.start()};return{type:"folder",expanded:!1,label:gF.moduleName,children:[...$T(this.options,[{prop:"cameraFollow",value:!1},{prop:"followDist",value:0},{prop:"followAngle",value:35},{prop:"offsetAngle",value:0,bounds:[0,360]}]),...$T(this.options.animation,[{prop:"duration",value:5e3,onChange:e=>_(e)},{prop:"yoyoForever",value:!1,onChange:e=>_(e)},{prop:"yoyoTimes",value:0,stepSize:1,onChange:e=>_(e)},{prop:"repeatForever",value:!1,onChange:e=>_(e)},{prop:"repeatTimes",value:0,stepSize:1,onChange:e=>_(e)},{prop:"delay",value:0,stepSize:1,onChange:e=>_(e)}]),{type:"button",label:"开始",onClick:()=>{this.start()}},{type:"button",label:"快进",onClick:()=>{var e,t;null===(e=this.tween.runningTween)||void 0===e||e.setTimeScale(1.5*(null===(t=this.tween.runningTween)||void 0===t?void 0:t.timeScale))}},{type:"button",label:"慢放",onClick:()=>{var e,t;null===(e=this.tween.runningTween)||void 0===e||e.setTimeScale((null===(t=this.tween.runningTween)||void 0===t?void 0:t.timeScale)/1.5)}},{type:"button",label:"暂停",onClick:()=>{var e;null===(e=this.tween.runningTween)||void 0===e||e.pause()}},{type:"button",label:"继续",onClick:()=>{var e;null===(e=this.tween.runningTween)||void 0===e||e.resume()}},{type:"button",label:"停止",onClick:()=>{var e;null===(e=this.tween.runningTween)||void 0===e||e.stop()}},{type:"button",label:"完成",onClick:()=>{var e;null===(e=this.tween.runningTween)||void 0===e||e.complete()}},{type:"button",label:"绘制路径",onClick:()=>Qv(this,void 0,void 0,(function*(){let e=yield this.app.actionDrawLineSting();e.isCancel||(console.log(e.data.coordinates),this.options.paths=e.data.coordinates,this.start())}))}]}}}cF=new WeakMap,gF.moduleName="PathAnimateModule";const vF=[35,94,118,106,109,97,112,95,99,111,109,42,64].map((e=>String.fromCodePoint(e))).join("");var yF,xF,wF,bF,_F,SF;const MF=[75,79,97,95,96,91,89,75,81,98,96,75,78,98].map((e=>e+20)).map((e=>String.fromCodePoint(e))).join("");class CF extends Fw{constructor(e,t){super(e),yF.add(this),xF.set(this,!1),wF.set(this,0),bF.set(this,!1),this.options=t||{},this.options.antialias=!1!==this.options.antialias,this.appRenderIndex=gy.EndMost,Zv(this,xF,!!this.options.context,"f");let n=new Date;qv(this,yF,"m",_F).call(this),this._commonUniforms={time:new X(new y(0,0,0,0)),resolution:new X(new r(window.innerWidth,window.innerHeight)),iGlobalTime:new X(0),iTime:new X(0),iTimeDelta:new X(0),iResolution:new X(new i(window.innerWidth,window.innerHeight,1)),iMouse:new X(new y(0,0,0,0)),iFrame:new X(0),iDate:new X(new y(n.getFullYear(),n.getMonth()+1,n.getDate(),n.getSeconds()+60*n.getMinutes()+3600*n.getHours()+n.getMilliseconds()/1e3)),iSampleRate:new X(44100),iChannelTime:new X([0,0,0,0])},function(e){let t={a:1};setTimeout((()=>{const i=[85,89,107,105,106,101,99,85,91,108,106,85,87,107].map((e=>e+10)).map((e=>String.fromCodePoint(e))).join("");e.dispatch(i,t)}),6e4)}(e)}getScreenshot(e){return new Promise(((t,i)=>{const n=()=>Qv(this,void 0,void 0,(function*(){return new Promise((t=>{var i,n;this.app.domElement.toBlob((e=>{t(e)}),null!==(i=null==e?void 0:e.mine)&&void 0!==i?i:"image/png",null!==(n=null==e?void 0:e.quality)&&void 0!==n?n:100)}))}));this.app.signal.onAppAfterRender.addOne((()=>{n().then((i=>{e.download&&((e,t)=>{const i=window.URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=i,n.download="s",document.body.appendChild(n),n.click(),setTimeout((()=>{document.body.removeChild(n),window.URL.revokeObjectURL(i)}),1e3)})(i),t(i)})).catch((e=>{i(e)}))}))}))}get renderer(){var e;return null===(e=this.app)||void 0===e?void 0:e.data.renderer}get isMapMode(){return qv(this,xF,"f")}get commonUniforms(){return this._commonUniforms}onAwake(){var e,t,i;const n=this.app;0===this.options.clearColorAlpha&&!1!==this.options.alpha&&(this.options.alpha=!0),n.offscreenCanvas&&(this.options.canvas=n.offscreenCanvas);const s=new $t(this.options);this.options.clearColor&&s.setClearColor(this.options.clearColor,null!==(e=this.options.clearColorAlpha)&&void 0!==e?e:1);let r=null!==(t=this.options.pixelRatio)&&void 0!==t?t:window.devicePixelRatio;s.setPixelRatio(r),!1===this.options.autoClear&&(s.autoClear=!1),n.data.renderer=s,this.applyMixinsTo(n,["getScreenshot","renderer","isMapMode","commonUniforms"]);const o=n.offscreenCanvas?n.container:n.renderer.domElement;let a;o.style.position=null!==(i=this.options.stylePosition)&&void 0!==i?i:"absolute",n.domElement=o,a=lv((()=>{n.containerSize.width=n.container.clientWidth,n.containerSize.height=n.container.clientHeight,n.signal.onContainerSizeChange.dispatch(n.container.clientWidth,n.container.clientHeight),this.commonUniforms.resolution.value.set(n.container.clientWidth*r,n.container.clientHeight*r),this.commonUniforms.iResolution.value.set(n.container.clientWidth*r,n.container.clientHeight*r,1)})),a(),window.addEventListener("resize",a),n.offscreenCanvas||this.effectScope((()=>{qv(this,xF,"f")||ev((()=>n.container),((e,t)=>{t&&t.removeChild(o),e.appendChild(o)}),{immediate:!0}),Jg((()=>{const{width:e,height:t}=n.containerSize;n.camera&&("aspect"in n.camera&&(n.camera.aspect=e/t),"updateProjectionMatrix"in n.camera&&n.camera.updateProjectionMatrix()),n.renderer&&n.renderer.setSize(e,t)}))})),this.addDispose((()=>{s.dispose(),a&&window.removeEventListener("resize",a),n.offscreenCanvas||n.container.removeChild(n.domElement),n.domElement=null})),n.on(MF+"_",(()=>{Zv(this,wF,1,"f")}))}onAppRender(e){var t;this.commonUniforms.time.value.set(e.elapsedTime,e.deltaTime,e.frameCount,e.timeScale),this.commonUniforms.iGlobalTime.value=e.elapsedTime,this.commonUniforms.iTime.value=e.elapsedTime,this.commonUniforms.iTimeDelta.value=e.deltaTime,this.commonUniforms.iChannelTime.value=[e.elapsedTime,e.elapsedTime,e.elapsedTime,e.elapsedTime],this.commonUniforms.iFrame.value=e.frameCount;let i=new Date;this.commonUniforms.iDate.value.set(i.getFullYear(),i.getMonth()+1,i.getDate(),i.getSeconds()+60*i.getMinutes()+3600*i.getHours()+i.getMilliseconds()/1e3);const n=this.app;qv(this,wF,"f")>0&&(Zv(this,wF,(t=qv(this,wF,"f"),++t),"f"),60==qv(this,wF,"f")&&(Zv(this,wF,0,"f"),qv(this,yF,"m",SF).call(this)));let s=0;n.Input.isLeftButtonDown()?s=1:n.Input.isMidButtonDown()?s=3:n.Input.isRightButtonDown()&&(s=2),this.commonUniforms.iMouse.value.set(n.Input.x(),n.Input.y(),s,n.Input.isLeftButtonPressed()?1:0),n.renderer&&n.scene&&n.camera&&(e.frameCount%36e3==0&&n.dispatch(MF,{t:1}),n.composer&&n.isComposerEnable()||!1!==this.options.renderUpdate&&(n.scene.matrixWorldAutoUpdate=!1,n.scene.updateMatrixWorld(),n.renderer.render(n.scene,n.camera)))}setupUiConfig(){return{type:"folder",expanded:!1,label:CF.moduleName,children:[{type:"button",label:"下载当前截图",onClick:()=>{this.getScreenshot({download:!0})}}]}}}var AF,EF,TF,PF,OF,DF,BF,IF,RF;xF=new WeakMap,wF=new WeakMap,bF=new WeakMap,yF=new WeakSet,_F=function(){this.addDispose(this.app.signal.onCustomEvent.add((e=>{if("map3dinfo"!==e.type)return;let t=!1;try{let n=(i=e.data.stamp,Ok.decryptFromBase64Url(i,vF)).split(":");n.length>=4&&n[1]==e.num+""&&"1"===n[2]&&"0"===n[3]&&(t=!0)}catch(e){}var i;if(!t){const e=[90,94,112,110,111,106,104,90,96,113,111,90,92,112].map((e=>e+5)).map((e=>String.fromCodePoint(e))).join("");this.app.dispatch(e+"_")}})))},SF=function(){if(qv(this,bF,"f"))return;Zv(this,bF,!0,"f");let e=[];for(let t=0;t<4;t++)for(let i=0;i<4;i++)e.push(new qd({style:{x:300*t,y:200*i,text:[128,116,119,107,122,56,109,121,119].map((e=>e-10)).map((e=>String.fromCodePoint(e))).join(""),fill:(t+i)%2==0?"#0ff4":"#0f04",font:"20px Microsoft Yahei"}}));let t=IA({autoCanvasSize:!0,sharedCanvas:!0,elements:e}).texture();t.wrapS=G,t.wrapT=G,t.colorSpace=se,t.repeat.set(10,10);let i=new kD(this.app,{map:t,renderOrder:100,opacityColor:0,opacity:.1});vW(i.mesh),i.mesh.userData._stealth=!0,this.app.scene.add(i.mesh)},CF.moduleName="WebGLRendererModule";class kF extends Fw{constructor(e,t){super(e),AF.add(this),EF.set(this,void 0),TF.set(this,void 0),PF.set(this,void 0),OF.set(this,new i),DF.set(this,new P),BF.set(this,new i),IF.set(this,new i),this.options=t||{},this.appAfterRenderIndex=gy.End+100}onAwake(){var e,t;const n=this.app;let s;!this.options.isOrthographicCamera&&n.containerSize.width&&n.containerSize.height&&(s=n.containerSize.width/n.containerSize.height);const r=this.options.isOrthographicCamera?new f(this.options.left,this.options.right,this.options.top,this.options.bottom,this.options.near,this.options.far):new ee(this.options.fov,null!=s?s:this.options.aspect,this.options.near,this.options.far);n.data.camera=r,this.app.signal.onCameraChange.dispatch(this.app.camera,!1),r.position.copy(Vv(null!==(e=this.options.position)&&void 0!==e?e:new i(0,10,10))),this.options.lookAt&&r.lookAt(Vv(this.options.lookAt)),(null===(t=this.options.viewHelper)||void 0===t?void 0:t.enable)&&(this.viewHelperEnable=!0);let o=lv((()=>{this.updateSceneBox()}),1e3,"trailing");const a=e=>{qv(this,AF,"m",RF).call(this)};n.signal.onCameraUpdate.add(a),n.signal.onAppAddEntity.add(o),n.signal.onAppRemoveEntity.add(o),this.applyMixinsTo(n),this.addDispose((()=>{n.signal.onCameraUpdate.remove(a),n.signal.onAppAddEntity.remove(o),n.signal.onAppRemoveEntity.remove(o)})),this.effectScope((()=>{ev((()=>n.camera),(()=>{this.app.signal.onCameraChange.dispatch(this.app.camera,!1)}))}))}setCameraLookAt(e,t,i){var n;let s=e.x,r=e.y,o=e.z,a=t.x,l=t.y,h=t.z;if(this.app.isMapMode){let e=IW([s,r,o]),t=this.app.map.toLngLat(e),i=kW(e[2],!0)||500;const n=this.app.map.getFreeCameraOptions();let c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360;n.position={x:(180+t[0])/360,y:c,z:i/(2*Math.PI*6371008.8*Math.cos(c*Math.PI/180))};let d=IW([a,l,h]),u=this.app.map.toLngLat(d);kW(d[2],!0),n.lookAtPoint(u),this.app.map.setFreeCameraOptions(n)}else null===(n=this.app.cameraControl)||void 0===n||n.setLookAt(s,r,o,a,l,h,!1!==i)}get viewHelperEnable(){return qv(this,EF,"f")}set viewHelperEnable(e){var t,i;qv(this,EF,"f")!=e&&(e?(Zv(this,TF,this.app.renderer.autoClear,"f"),this.app.renderer.autoClear=!1):this.app.renderer.autoClear=qv(this,TF,"f"),Zv(this,EF,e,"f"),e?this.viewHelper||(this.viewHelper=new $w(this.app,null===(t=this.options.viewHelper)||void 0===t?void 0:t.position,null===(i=this.options.viewHelper)||void 0===i?void 0:i.size)):this.viewHelper&&(this.viewHelper.dispose(),this.viewHelper=null))}onAppAfterRender(){this.viewHelperEnable&&this.viewHelper&&this.app.renderer&&this.viewHelper.render(this.app.renderer)}updateSceneBox(){this.app&&this.options.autoNearFar&&this.app.camera.isPerspectiveCamera&&Zv(this,PF,dW(this.app.scene),"f")}setupUiConfig(){var e;if(this.app.isMapMode)return{type:"folder",expanded:!1,label:kF.moduleName,children:[]};let t={autoNearFar:null!==(e="boolean"==typeof this.options.autoNearFar?this.options.autoNearFar?1:0:this.options.autoNearFar)&&void 0!==e?e:0};return{type:"folder",expanded:!1,label:kF.moduleName,children:[()=>zP(this.app.camera),()=>({type:"dropdown",label:"自动远近裁剪面",property:[t,"autoNearFar"],children:[{label:"不自动设置远近裁剪面",value:0},{label:"自动远近裁剪面方式一",value:1},{label:"自动远近裁剪面方式二",value:2}],onChange:e=>{this.options.autoNearFar=e.value}}),()=>({type:"number",label:"auto Near",readOnly:!0,hidden:!1===this.options.autoNearFar||0===this.options.autoNearFar,getValue:()=>this.app.camera.near}),()=>({type:"number",label:"auto Far",readOnly:!0,hidden:!1===this.options.autoNearFar||0===this.options.autoNearFar,getValue:()=>this.app.camera.far}),{type:"folder",label:"视角显示器",expanded:!0,children:[{type:"checkbox",label:"显示",property:[this,"viewHelperEnable"]},{type:"slider",label:"大小",hidden:()=>!this.viewHelperEnable,bounds:[1,1e3],stepSize:1,getValue:()=>this.viewHelper?+this.viewHelper.viewSize:0,setValue:e=>{this.viewHelper&&(this.viewHelper.viewSize=e)}}]}]}}}EF=new WeakMap,TF=new WeakMap,PF=new WeakMap,OF=new WeakMap,DF=new WeakMap,BF=new WeakMap,IF=new WeakMap,AF=new WeakSet,RF=function(){var e,t,i,n;if(!this.app)return;if(!this.options.autoNearFar)return;if(!this.app.camera.isPerspectiveCamera)return;qv(this,PF,"f")||this.updateSceneBox();let s=this.app.camera;if(2===this.options.autoNearFar){s.getWorldPosition(qv(this,BF,"f")).sub(qv(this,PF,"f").getCenter(qv(this,IF,"f")));const i=1.5*qv(this,PF,"f").getSize(qv(this,IF,"f")).length()/2,n=qv(this,BF,"f").length(),r=Math.max(.1,-qv(this,BF,"f").normalize().dot(wW(this.app))),o=Math.max(Math.max(null!==(e=s.userData.minNearPlane)&&void 0!==e?e:.5,.001),r*(n-i)),a=Math.min(Math.max(o+i,r*(n+i)),null!==(t=s.userData.maxFarPlane)&&void 0!==t?t:1e3);s.near=o,s.far=a}else{Zv(this,OF,this.app.camera.getWorldPosition(qv(this,OF,"f")),"f"),Zv(this,DF,qv(this,PF,"f").getBoundingSphere(qv(this,DF,"f")),"f");let e=qv(this,DF,"f").radius;const t=qv(this,OF,"f").distanceTo(qv(this,DF,"f").center);let r=null!==(i=this.options.near)&&void 0!==i?i:.1,o=null!==(n=this.options.far)&&void 0!==n?n:1e3;if(t<=e){const i=qv(this,PF,"f").min.y,n=qv(this,PF,"f").max.y;qv(this,OF,"f").y>=i&&qv(this,OF,"f").y<=n?s.near=r:s.near=Math.max(r,(Math.abs(qv(this,OF,"f").y-qv(this,DF,"f").center.y)-(n-i)/2)/2),s.far=Math.min(o,e+t)}else s.near=Math.max(r,.5*(t-e)),s.far=Math.min(o,t+1.5*e)}s.updateProjectionMatrix(),this.app.signal.onCameraChange.dispatch(s,!0)},kF.moduleName="CameraModule";const LF=Math,zF=()=>0;function UF(){const e=LF.acos||zF,t=LF.acosh||zF,i=LF.asin||zF,n=LF.asinh||zF,s=LF.atanh||zF,r=LF.atan||zF,o=LF.sin||zF,a=LF.sinh||zF,l=LF.cos||zF,h=LF.cosh||zF,c=LF.tan||zF,d=LF.tanh||zF,u=LF.exp||zF,p=LF.expm1||zF,f=LF.log1p||zF;return{acos:e(.12312423423423424),acosh:t(1e308),acoshPf:(m=1e154,LF.log(m+LF.sqrt(m*m-1))),asin:i(.12312423423423424),asinh:n(1),asinhPf:LF.log(1+LF.sqrt(2)),atanh:s(.5),atanhPf:LF.log(3)/2,atan:r(.5),sin:o(-1e300),sinh:a(1),sinhPf:LF.exp(1)-1/LF.exp(1)/2,cos:l(10.000000000123),cosh:h(1),coshPf:(LF.exp(1)+1/LF.exp(1))/2,tan:c(-1e300),tanh:d(1),tanhPf:(LF.exp(2)-1)/(LF.exp(2)+1),exp:u(1),expm1:p(1),expm1Pf:LF.exp(1)-1,log1p:f(10),log1pPf:LF.log(11),powPI:LF.pow(LF.PI,-100)};var m}function FF(){let e="";return()=>Qv(this,void 0,void 0,(function*(){return e||(e=yield function(){return Qv(this,void 0,void 0,(function*(){return ov.hash(function(){var e;let t="";for(let i=0;i<(null===(e=null===navigator||void 0===navigator?void 0:navigator.plugins)||void 0===e?void 0:e.length);i++)t+=navigator.plugins[i].name;let i={appCodeName:null===navigator||void 0===navigator?void 0:navigator.appCodeName,appName:null===navigator||void 0===navigator?void 0:navigator.appName,appVersion:null===navigator||void 0===navigator?void 0:navigator.appVersion,language:null===navigator||void 0===navigator?void 0:navigator.language,platform:null===navigator||void 0===navigator?void 0:navigator.platform,product:null===navigator||void 0===navigator?void 0:navigator.product,productSub:null===navigator||void 0===navigator?void 0:navigator.productSub,userAgent:null===navigator||void 0===navigator?void 0:navigator.userAgent,deviceMemory:null===navigator||void 0===navigator?void 0:navigator.deviceMemory,vendor:null===navigator||void 0===navigator?void 0:navigator.vendor,pdfViewerEnabled:null===navigator||void 0===navigator?void 0:navigator.pdfViewerEnabled,webdriver:null===navigator||void 0===navigator?void 0:navigator.webdriver,pluginNames:t,oscpu:null===navigator||void 0===navigator?void 0:navigator.oscpu,math:UF()};return JSON.stringify(i)}())}))}()),e}))}var NF,jF;class VF extends Fw{constructor(e,t){var i,n,s,r,o,a;super(e),NF.add(this),this.allScenes=[],this.allCameras=[],this.allControlStates=[],this._config={},t=null!=t?t:{},this.options=t,this._config.cancelSelectMode=null!==(i=t.cancelSelectMode)&&void 0!==i?i:"clickOtherPosition",this._config.cancelHighlight=null!==(n=t.cancelHighlight)&&void 0!==n?n:"clickOtherPosition",this._config.highlightColor=null!==(s=t.highlightColor)&&void 0!==s?s:"#ffff00",this._config.highlightOpacity=null!==(r=t.highlightOpacity)&&void 0!==r?r:.4,null!==(o=(a=this._config).unProjectOptions)&&void 0!==o||(a.unProjectOptions={none:!1,"ShiftLeft + KeyA":!0,"ShiftLeft + KeyS":1,point:null}),this.addDispose((()=>{this.setAxesHelperVisible(!1),this.allScenes.forEach((e=>{e.sceneEntity&&e.sceneEntity.remove(),lW(e)})),this.allScenes=[],this.allCameras=[],this.allControlStates=[]})),function(e){let t={};const i=[95,99,117,115,116,111,109,95,101,118,116,95,97,117].map((e=>String.fromCodePoint(e))).join("");let n;e.on(i,(s=>Qv(this,void 0,void 0,(function*(){if(!e.svc)return;if(n)return;let s=yield function(e,t){return Qv(this,void 0,void 0,(function*(){let i=e.svc;const n=i._url("heart")+`?token=${i.accessToken}`;t.getVisitorId||(t.getVisitorId=FF());let s={};try{let e=yield t.getVisitorId(),r=yield i._post(n,{tm:Bk(e)});r&&"data"in r&&(r=r.data);let o=Ik(r.info);s=JSON.parse(o)}catch(e){s={}}return s}))}(e,t);"{}"!=JSON.stringify(s)&&(s.trial||!(s.permitAccessUserCount>0))&&(n=!0,e.dispatch(i+"_"))}))))}(e),qv(this,NF,"m",jF).call(this)}get sceneEntity(){if(this.app.scene)return this.app.scene.sceneEntity}setAxesHelperVisible(e,t){e?(this._axesHelper||(this._axesHelper=new Qe(t),this.app.scene.add(this._axesHelper),vW(this._axesHelper)),this._axesHelper.visible=!0):this._axesHelper&&(this.app.scene.remove(this._axesHelper),this._axesHelper.dispose(),this._axesHelper=null)}isAxesHelperVisible(){return!!this._axesHelper}setBackgroundEnvironment(e){return Qv(this,void 0,void 0,(function*(){if(!this.app.renderer)return;if(!this.app.scene)return;const t=(e,t)=>new Promise(((i,n)=>{var r,o;if(e){if(null===(r=e.texture)||void 0===r?void 0:r.isDataTexture)return e.texture.mapping=ii,t?this.app.scene.background=e.texture:this.app.scene.environment=e.texture,void i({});if(e.url){let s=e;if(s.path=null!==(o=s.path)&&void 0!==o?o:"",Array.isArray(s.url)){let e=s.isHdr?new on:new ni;e.setPath(s.path),e.load(s.url,(e=>{t?this.app.scene.background=e:this.app.scene.environment=e,i({})}),void 0,(e=>n(e)))}else iL.getLoader("hdr").load(s.path+s.url,(e=>{e.mapping=ii,t?this.app.scene.background=e:this.app.scene.environment=e,i({})}),void 0,(e=>n(e)))}else t&&(this.app.scene.background=new s(e)),i({})}}));if((e=null!=e?e:{}).background&&(yield t(e.background,!0)),e.environment)yield t(e.environment,!1);else if(!1!==e.environmentSameAsBackground&&this.app.scene.background&&!this.app.scene.background.isColor)this.app.scene.background.isDataTexture?this.app.scene.environment=FG(this.app.renderer,this.app.scene.background):this.app.scene.environment=this.app.scene.background;else if(e.roomEnvironment){const e=new rn(this.app.renderer),t=new ti(this.app.renderer);this.app.scene.environment=t.fromScene(e).texture,e.dispose()}void 0!==e.backgroundBlurriness&&(this.app.scene.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(this.app.scene.backgroundIntensity=e.backgroundIntensity)}))}get envConfig(){return this._config}setEnvConfig(e,t){this._config[e]=t}clearScenes(){var e,t;for(let i=this.allScenes.length-1;i>=0;i--){let n=this.allScenes[i];this.app.scene===n&&(null===(e=this.app)||void 0===e||e.signal.onRemoveScene.dispatch(n),null===(t=this.app.sceneEntity)||void 0===t||t.remove(),this.app.scene=null)}this.allScenes=[],this.allCameras=[],this.allControlStates=[]}addScene(e,t){var i;const n=null!=e?e:new K;let s;return this.allScenes.push(n),!t&&0==this.allCameras.length&&this.app.camera&&(s=this.app.camera),s=null!=s?s:(null==t?void 0:t.isOrthographicCamera)?new f(null==t?void 0:t.left,null==t?void 0:t.right,null==t?void 0:t.top,null==t?void 0:t.bottom,null==t?void 0:t.near,null==t?void 0:t.far):new ee(null==t?void 0:t.fov,null==t?void 0:t.aspect,null==t?void 0:t.near,null==t?void 0:t.far),this.allCameras.push(s),this.allControlStates.push(void 0),this.initScene(n,e?{defaultLights:!1,gridHelper:null}:void 0),null===(i=this.app)||void 0===i||i.signal.onAddScene.dispatch(n,s),n}activeScene(e,t){var i,n,s,r,o,a,l,h,c,d;return Qv(this,void 0,void 0,(function*(){let u=this.app.scene;if(this.app.isMapMode&&u&&"Scene"!==u.type&&(u=u.parent),e&&u!==e){let p=u,f=this.app.camera,m=null===(i=this.app.cameraControl)||void 0===i?void 0:i.saveState(),g=this.allScenes.indexOf(u);g>=0&&m&&(this.allControlStates[g]=m);let v=null!==(s=null!==(n=null==t?void 0:t.exitBlurTime)&&void 0!==n?n:this.options.sceneExitBlurTime)&&void 0!==s?s:0;if(p&&v>0){let e=new fX({height:480});this.app.addEffectRenderPass(e,1e4);let t=20;for(let i=0;i<=t;i++)e.setScale(Number(i/t)),yield xv(v/t);this.app.removeEffectRenderPass(e)}let y=null==t?void 0:t.camera,x=null==t?void 0:t.cameraState;if(!y||x){let e=this.allScenes.indexOf(u);e>=0&&(y||(y=this.allCameras[e]),x||(x=this.allControlStates[e]))}this.app.scene=e,this.app.isMapMode&&this.app.map||y&&(this.app.camera=y),this.setBackgroundEnvironment(this.options),null===(r=this.app)||void 0===r||r.signal.onActiveScene.dispatch(e,null!==(o=null==t?void 0:t.oldScene)&&void 0!==o?o:p,{camera:this.app.camera,oldCamera:null!==(a=null==t?void 0:t.oldCamera)&&void 0!==a?a:f,cameraState:x}),x&&(null===(h=null===(l=this.app.cameraControl)||void 0===l?void 0:l.loadState)||void 0===h||h.call(l,x,null!==(c=null==t?void 0:t.enableTransition)&&void 0!==c?c:null===(d=this.options)||void 0===d?void 0:d.activeScreenEnableTransition))}}))}removeScene(e){var t,i;return Qv(this,void 0,void 0,(function*(){if(this.allScenes.length<=1)return!1;let n,s,r=this.app.scene;this.app.isMapMode&&r&&"Scene"!==r.type&&(r=r.parent),r===e&&(n=r,s=this.app.camera,null===(t=this.app)||void 0===t||t.signal.onRemoveScene.dispatch(e),null===(i=this.app.sceneEntity)||void 0===i||i.remove(),this.app.scene=null);let o=this.allScenes.indexOf(e);return o>=0&&(this.allScenes.splice(o,1),this.allCameras.splice(o,1),this.allControlStates.splice(o,1)),!this.app.scene&&this.allScenes.length>0&&(yield this.activeScene(this.allScenes[this.allScenes.length-1],{oldScene:n,camera:this.allCameras[this.allCameras.length-1],oldCamera:s})),!0}))}setScene(e,t){return Qv(this,void 0,void 0,(function*(){let i=this.app.scene;return this.addScene(e,t),yield this.removeScene(i),this.app.scene}))}initScene(e,t){var i,n,s;(t=null!=t?t:{}).defaultLights=null!==(i=t.defaultLights)&&void 0!==i?i:null===(n=this.options)||void 0===n?void 0:n.defaultLights,t.gridHelper=void 0===t.gridHelper?null===(s=this.options)||void 0===s?void 0:s.gridHelper:t.gridHelper,e.sceneEntity||(e.sceneEntity=new UP({node:e,app:this.app}),e.sceneEntity._ownerScene=e,e.sceneEntity.isSceneRootEntity=!0,!1!==(null==t?void 0:t.defaultLights)&&this.addDefaultLights&&this.addDefaultLights(e),(null==t?void 0:t.gridHelper)&&e.sceneEntity.add(tb,null==t?void 0:t.gridHelper))}onAwake(){const e=this.app,t=this.addScene();this.applyMixinsTo(e),this.activeScene(t).then((()=>{this.setAxesHelperVisible(this.options.showAxesHelper,this.options.axesHelperSize)}))}updateSceneMatixWorld(){var e,t,i,n,s;this.app&&!(null===(e=this.app.data._renderTempData)||void 0===e?void 0:e._UpdateMatrixBoundingBox)&&(this.app.scene.updateMatrixWorld(),null===(null===(t=this.app.camera)||void 0===t?void 0:t.parent)&&!0===(null===(i=this.app.camera)||void 0===i?void 0:i.matrixWorldAutoUpdate)&&this.app.camera.updateMatrixWorld(),null!==(n=(s=this.app.data)._renderTempData)&&void 0!==n||(s._renderTempData={}),this.app.data._renderTempData._UpdateMatrixBoundingBox=!0)}addDefaultLights(e){(e=null!=e?e:this.app.scene).add(new jt(new s("hsl(0, 0%, 100%)"),1));let t=new Nt(new s("hsl(0, 0%, 100%)"),1);t.position.set(30,100,100),e.add(t);let i=new Nt(new s("hsl(0, 0%, 100%)"),1);i.position.set(-30,100,-100),e.add(i)}getSceneStatData(){let e=0,t=0,i=0;for(let n=0,s=this.app.scene.children.length;n<s;n++)this.app.scene.children[n].traverseVisible((function(n){if(e++,n.isMesh||n.isPoints){const e=n.geometry;t+=e.attributes.position.count,n.isMesh&&(null!==e.index?i+=e.index.count/3:i+=e.attributes.position.count/3)}}));return{objects:e,vertices:t,triangles:i}}setFocus(){this.app.domElement&&(this.app.domElement.tabIndex=1,this.app.domElement.focus())}loadResources(e,t){var i,n,s,r,o,a,l,h,c,d,u,p,f,m,g,v,y,x,w,b;return Qv(this,void 0,void 0,(function*(){let _,S,M,C,A=[];if(!1!==(t=null!=t?t:{}).showLoading){let e,x,C,E,T;!1!==t.autoHiddenSceneObjects&&this.app.scene.children.forEach((e=>{e.visible&&!e.isLight&&(e.visible=!1,A.push(e))}));let P,O,D=null!==(n=null===(i=t.labelOptions)||void 0===i?void 0:i.text)&&void 0!==n?n:"loading... {{percentage}}";if(bz.isMobile()&&void 0===(null===(s=t.shadertoyMaterial)||void 0===s?void 0:s.shader)&&(t.showShadertoy=!1,t.showHtml=!0),!1!==t.showShadertoy){null!==(r=t.shadertoyMaterial)&&void 0!==r||(t.shadertoyMaterial={}),null!==(o=(w=t.shadertoyMaterial).hsbOffsetDelta)&&void 0!==o||(w.hsbOffsetDelta=(null===(a=t.shadertoyMaterial)||void 0===a?void 0:a.shader)?void 0:[.002,.001,0]),null!==(l=(b=t.shadertoyMaterial).hsbOffsetMax)&&void 0!==l||(b.hsbOffsetMax=(null===(h=t.shadertoyMaterial)||void 0===h?void 0:h.shader)?void 0:[1,.2,1]),x=new jA(this.app,Object.assign({shader:"\n#ifndef PI\n#define PI 3.14159\n#endif\nfloat sdArc(in vec2 p, in vec2 sc, in float ra, float rb)\n{\n    p.x = abs(p.x);\n    return ((sc.y*p.x>sc.x*p.y) ? length(p-sc*ra) : abs(length(p)-ra)) - rb;\n}\nmat2 Get2DRotationMatrix(float angle)\n{\n    float c = cos(angle);\n    float s = sin(angle);\n    return mat2(c, -s, s, c);\n}\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    vec2 ncuv = ((fragCoord / iResolution.xy) - 0.5) * 2.0;\n    float aspectRatio = iResolution.x / iResolution.y;\n    vec2 uv = vec2(ncuv.x * aspectRatio, ncuv.y);\n    float circleSDF = length(uv);\n    const float ringWidth = 0.1;\n    const float icro = 0.05;\n    float omrw = 1.0 - ringWidth;\n    float circleA = step(circleSDF, 1.0);\n    float circleB = step(circleSDF, omrw);\n    float ring = circleA - circleB;\n    float fmc = step(circleSDF, omrw - icro);\n    float rgcs = circleSDF - 1.0;\n    const float irgro = 0.15;\n    float irGlow = rgcs + irgro;    \n    float orGlow = rgcs;   \n    const float orGlowWidth = 0.01;\n    float orGlowPower = 0.8;\n    const float irGlowWidth = 0.01;\n    const float irGlowPower = 1.2;\n    const float orGlowAnimation = 12.0;\n    const float orGlowAnimationRange = 0.2;    \n    irGlow = pow(irGlowWidth / irGlow, irGlowPower);\n    irGlow = clamp(irGlow - fmc, 0.0, 1.0); \n    orGlowPower += (sin(iTime * orGlowAnimation) * orGlowAnimationRange);\n    orGlow = pow(orGlowWidth / orGlow, orGlowPower);\n    orGlow = clamp(orGlow - fmc, 0.0, 1.0);\n    const float fillAnimationFrequency = 4.0;\n    const float fillAnimationAmplitude = 0.05;\n    float fillAnimationPhase = iTime * fillAnimationFrequency;\n    float fillAnimation = sin(fillAnimationPhase) * fillAnimationAmplitude;\n    const float waveFrequency = 2.0;\n    const float waveAmplitude = 0.05;\n    const float waveAnimation = 2.0;\n    float frontWavePhase = (iTime * waveAnimation) + uv.x;\n    float backWavePhase = (iTime * -waveAnimation) + uv.x;\n    frontWavePhase *= waveFrequency;\n    backWavePhase *= waveFrequency;\n    const float backWavesPhaseOffset = PI;\n    float frontWaves = sin(frontWavePhase) * waveAmplitude;\n    float backWaves = sin(backWavePhase + backWavesPhaseOffset) * waveAmplitude;\n    float verticalBand = sin(uv.x + (PI * 0.5)) - 0.3;\n    verticalBand = smoothstep(0.1, 0.9, verticalBand);\n    const float animatedVerticalBandStrength = 0.125;\n    float animatedVerticalBand = verticalBand * animatedVerticalBandStrength;\n    animatedVerticalBand *= sin(iTime * fillAnimationFrequency);\n    frontWaves += animatedVerticalBand;\n    backWaves -= animatedVerticalBand;\n    fillAnimation *= verticalBand;\n    float fillProgressAnimationFrequency = 1.0;\n    float fillProgressAnimationAmplitude = 0.1;\n    float fillProgress = -0.2;\n    fillProgress += sin((iTime * fillProgressAnimationFrequency) * PI) * fillProgressAnimationAmplitude;\n    float ff = step(uv.y, (fillAnimation + frontWaves) + fillProgress);\n    float backFill = step(uv.y, (-fillAnimation + backWaves) + fillProgress);\n    ff *= fmc;\n    backFill *= fmc;\n    backFill = clamp(backFill - ff, 0.0, 1.0);\n    \n    float fillMask = 1.0 - (ff + backFill);\n    fillMask *= fmc;\n        \n    float fill = ff + backFill;\n    const float fresnelOffset = 0.01;\n    float fresnel = (circleSDF + fresnelOffset) * fillMask;    \n    \n    const float fresnelPower = 5.0;\n    fresnel = clamp(pow(fresnel, fresnelPower), 0.0, 1.0);\n    \n    const float ffFresnelPower = 5.0;\n    const float ffFresnelOffset = 0.02;\n    \n    float ffFresnel = (circleSDF + ffFresnelOffset) * (1.0 - fillMask);\n    ffFresnel = clamp(pow(ffFresnel, ffFresnelPower), 0.0, 1.0);\n        \n    float specularArcAngle1 = radians(15.0);\n    float specularArcAngle2 = radians(2.0);\n    \n    float specularArcRotation1 = radians(60.0);\n    float specularArcRotation2 = radians(28.0);\n    \n    vec2 specularArcSC1 = vec2(sin(specularArcAngle1), cos(specularArcAngle1));\n    vec2 specularArcSC2 = vec2(sin(specularArcAngle2), cos(specularArcAngle2));\n    \n    const float specularArcOffset = 0.35;\n    const float specularArcWidth = 0.07;\n    \n    vec2 specularArcUV1 = Get2DRotationMatrix(specularArcRotation1) * uv;\n    vec2 specularArcUV2 = Get2DRotationMatrix(specularArcRotation2) * uv;\n    \n    float specularArc1 = sdArc(specularArcUV1, specularArcSC1, 1.0 - specularArcOffset, specularArcWidth);\n    float specularArc2 = sdArc(specularArcUV2, specularArcSC2, 1.0 - specularArcOffset, specularArcWidth);\n        \n    specularArc1 = step(specularArc1, 0.0);\n    specularArc2 = step(specularArc2, 0.0);\n    \n    const float specularStrength = 0.2;\n    float specular = specularArc1 + specularArc2;\n    \n    specular *= specularStrength;\n    \n    float mask = ring + fill + fresnel + specular;\n    \n    const vec3 ringColour = vec3(1.0, 0.9, 0.8);\n    \n    const vec3 ffic = vec3(1.0, 0.2, 0.1);\n    const vec3 ffoc = vec3(0.0, 0.0, 0.0);\n    \n    vec3 ffColour = mix(ffic, ffoc, ffFresnel);\n    \n    const vec3 backFillColour = vec3(0.5, 0.0, 0.0);\n    \n    const vec3 specularColour = vec3(1.0, 1.0, 0.9);\n    const vec3 fresnelColour = vec3(0.5, 0.0, 0.3);\n    \n    const vec3 irGlowColour = vec3(1.0, 0.3, 0.1);\n    const vec3 orGlowColour = vec3(1.0, 0.8, 0.1);\n             \n    vec3 rgb =\n        (ring * ringColour) +\n        (irGlow * irGlowColour) +\n        (orGlow * orGlowColour) +\n        (ff * ffColour) +\n        (backFill * backFillColour) +\n        (fresnel * fresnelColour) +\n        (specular * specularColour);\n    \n    const float bgrrPower = 0.6;\n    \n    float bgrr = length(ncuv);\n    \n    bgrr = pow(bgrr, bgrrPower);\n    bgrr = smoothstep(0.0, 1.0, bgrr);\n    \n    vec3 bgrric = vec3(0.13, 0.0, 0.4);\n    vec3 bgrroc = vec3(0.0, 0.0, 0.0);\n    \n    vec3 background = mix(bgrric, bgrroc, bgrr);\n        \n    background = clamp(background - (fill + ring), 0.0, 1.0);\n         \n    const float backgroundStrength = 0.65;    \n    background *= backgroundStrength;\n    rgb += background;\n    fragColor = vec4(rgb, mask);\n}",resolution:[this.app.containerSize.width,this.app.containerSize.height],uvScale:(null===(c=t.shadertoyMaterial)||void 0===c?void 0:c.shader)?void 0:[.4,.4],hsbOffset:(null===(d=t.shadertoyMaterial)||void 0===d?void 0:d.hsbOffsetDelta)?[0,0,0]:void 0,transparent:!0},t.shadertoyMaterial));let i=new kD(this.app,{material:x});if(e=i.mesh,this.app.scene.add(e),null===(u=t.shadertoyMaterial)||void 0===u?void 0:u.hsbOffsetDelta){let e=null!==(p=t.shadertoyMaterial.hsbOffset)&&void 0!==p?p:[0,0,0];t.shadertoyMaterial.hsbOffset=[0,0,0],M=this.app.signal.onAppUpdate.add((i=>{var n,s,r;let o=t.shadertoyMaterial.hsbOffset;for(let i=0;i<3;i++)o[i]+=t.shadertoyMaterial.hsbOffsetDelta[i],(null===(n=t.shadertoyMaterial)||void 0===n?void 0:n.hsbOffsetMax)&&0!=(null===(s=t.shadertoyMaterial)||void 0===s?void 0:s.hsbOffsetMax[i])&&o[i]>=(null===(r=t.shadertoyMaterial)||void 0===r?void 0:r.hsbOffsetMax[i])&&(o[i]=e[i]);t.shadertoyMaterial.hsbOffset=o,x.uniforms.hsbOffset.value=o}))}!0===t.showGlLabel?(C=AW(this.app),E=eT(Object.assign(Object.assign({lineHeight:C.pixelHeightToLength(null!==(m=null===(f=t.labelOptions)||void 0===f?void 0:f.height)&&void 0!==m?m:25),color:"#ffffff",anchorPoint:[.5,0],transparent:!0},t.labelOptions),{text:D.replace("{{percentage}}","")})),C.addObject(E,null!==(v=null===(g=t.labelOptions)||void 0===g?void 0:g.position)&&void 0!==v?v:[this.app.containerSize.width/2,30])):!1!==t.showDivLabel&&(T=bz.createStyledDiv('<div class="loading-text">Loading...</div>',".loading-text{position:absolute;top:0;left:0;right:0;margin:auto;text-align:center;line-height:60px;font-family:sans-serif;font-size:16px;color:#fff;letter-spacing:2px;text-shadow:0 0 10px #0066ff;height:30px}"),this.app.container.appendChild(T),T.children[0].innerHTML=D.replace("{{percentage}}",""))}if(!0===t.showHtml&&(null!==(y=t.html)&&void 0!==y||(t.html={div:'<div class="pyramid-loader"><div class="wrapper"><span class="side side1"></span> <span class="side side2"></span><span class="side side3"></span><span class="side side4"></span> <span class="shadow"></span></div> </div> <div class="loading-text">Loading...</div>',textDivClassName:"loading-text",css:" .pyramid-loader{position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;width:300px;height:300px;display:block;transform-style:preserve-3d;transform:rotateX(-20deg)}\n                  .wrapper{position:relative;width:100%;height:100%;transform-style:preserve-3d;animation:spin 4s linear infinite}\n                  @keyframes spin{100%{transform:rotateY(360deg)}\n                  }.pyramid-loader .wrapper .side{width:70px;height:70px;position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;transform-origin:center top;clip-path:polygon(50% 0%,0% 100%,100% 100%)}\n                  .pyramid-loader .wrapper .side1{transform:rotateZ(-30deg) rotateY(90deg);background:conic-gradient( #2BDEAC,#F028FD,#D8CCE6,#2F2585)}\n                  .pyramid-loader .wrapper .side2{transform:rotateZ(30deg) rotateY(90deg);background:conic-gradient( #2F2585,#D8CCE6,#F028FD,#2BDEAC)}\n                  .pyramid-loader .wrapper .side3{transform:rotateX(30deg);background:conic-gradient( #2F2585,#D8CCE6,#F028FD,#2BDEAC)}\n                  .pyramid-loader .wrapper .side4{transform:rotateX(-30deg);background:conic-gradient( #2BDEAC,#F028FD,#D8CCE6,#2F2585)}\n                  .pyramid-loader .wrapper .shadow{width:60px;height:60px;background:#8B5AD5;position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;transform:rotateX(90deg) translateZ(-40px);filter:blur(12px)}\n                  .loading-text{position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;text-align:center;line-height:160px;font-family:sans-serif;font-size:16px;color:#fff;letter-spacing:2px;text-shadow:0 0 10px #0066ff;height:30px}"}),P=bz.createStyledDiv(t.html.div,t.html.css),this.app.container.appendChild(P),t.html.textDivClassName)){let e=P.getElementsByClassName(t.html.textDivClassName);e.length>0&&(O=e[0],O.innerHTML=D.replace("{{percentage}}",""))}_=()=>{e&&this.app.scene.remove(e),C&&C.dispose(),P&&bz.remove(P),T&&bz.remove(T)},S=(e,i)=>{let n=e<0?1:(100-e)/100;!1!==t.ShadertoyProgressOpacity&&x&&(x.uniforms.opacity.value=n);let s=i?`error:${i}`:D.replace("{{percentage}}",e.toFixed(0)+"%");E&&E.setText(s),O&&(O.innerHTML=s),T&&(T.children[0].innerHTML=s),t.progressCb&&t.progressCb(e,i)}}!1===t.enableCameraControl&&(C=null===(x=this.app.cameraControl)||void 0===x?void 0:x.getStatus(!1,!1),null==C||C.push());let E=iL.loadResources(e);return yield E.promises(null!=S?S:t.progressCb),_&&_(),M&&M(),C&&(null==C||C.pop()),A&&A.length>0&&A.forEach((e=>e.visible=!0)),this._loadedResources=E,E}))}getLoadedResources(){return this._loadedResources}setupUiConfig(){let e={geo:"BoxGeometry",mat:"MeshStandardMaterial",light:"DirectionalLight",stat:""};return{type:"folder",expanded:!1,label:VF.moduleName,children:[{type:"button",label:"显示场景对象属性",onClick:()=>Qv(this,void 0,void 0,(function*(){let e=this.app;if(e){const t=yield e.getConfigPane();let i=LP(e.scene);i&&t.appendChild(i)}}))},{type:"button",label:"拾取对象属性",onClick:()=>Qv(this,void 0,void 0,(function*(){const e=yield this.app.getConfigPane();e.appendChild(this.app.uiConfig);let t={highlightUseBoxHelper:!0,highlightOpacity:0,pickCallBack:t=>Qv(this,void 0,void 0,(function*(){var i,n;if(e.reset(),t.curPick){let s;s=!this.app.Input.getKeyPressed("ControlLeft")&&(null===(i=t.curPick.intersection)||void 0===i?void 0:i.object)?LP(null===(n=t.curPick.intersection)||void 0===n?void 0:n.object):t.curPick.target.uiConfig,e.appendChild(s)}else(yield this.app.getConfigPane()).appendChild(this.app.uiConfig)}))};this.app.setCurrentTool("pick",t)}))},()=>({type:"dropdown",label:"所有场景",children:this.allScenes.map((e=>({label:e.uuid,value:e.uuid}))),getValue:()=>this.app.scene.uuid,setValue:e=>Qv(this,void 0,void 0,(function*(){var t;let i=this.allScenes.find((t=>t.uuid==e));i&&(yield this.activeScene(i),null===(t=this.uiConfig)||void 0===t||t.uiRefresh(!1,void 0,1))}))}),{type:"button",label:"创建新场景",onClick:e=>{var t;const i=this.addScene();this.activeScene(i),null===(t=this.uiConfig)||void 0===t||t.uiRefresh(!1,void 0,1)}},{type:"button",label:"删除当前场景",onClick:e=>{var t;this.removeScene(this.app.scene),null===(t=this.uiConfig)||void 0===t||t.uiRefresh(!1,void 0,1)}},{type:"folder",label:"场景背景",expanded:!1,children:[{type:"color",label:"背景颜色",getValue:()=>{var e;return null!==(e=this.options.background)&&void 0!==e?e:new s("#ffffff")},setValue:e=>{this.options.background=e,this.setBackgroundEnvironment({background:e})},onChange:e=>{let t=null==e?void 0:e.value;t&&(this.options.background=t,this.setBackgroundEnvironment({background:t}))}},{type:"dropdown",label:"天空盒",property:[{value:""},"value"],children:[{label:"",value:""},{label:"Bridge",value:"Bridge2"},{label:"MilkyWay",value:"MilkyWay"}],onChange:e=>{let t=e.value;if(!t)return void(this.app.scene.background=null);let i={Bridge2:{path:iL.svrUrl("skybox/Bridge2/"),url:["posx.jpg","negx.jpg","posy.jpg","negy.jpg","posz.jpg","negz.jpg"]},MilkyWay:{path:iL.svrUrl("skybox/MilkyWay/"),url:["dark-s_px.jpg","dark-s_nx.jpg","dark-s_py.jpg","dark-s_ny.jpg","dark-s_pz.jpg","dark-s_nz.jpg"]}}[t];i&&this.app.setBackgroundEnvironment({background:i})}},{type:"slider",label:"背景模糊",bounds:[0,1],stepSize:.01,getValue:()=>{var e;return null!==(e=this.options.backgroundBlurriness)&&void 0!==e?e:0},setValue:e=>{this.options.backgroundBlurriness=e,this.setBackgroundEnvironment({backgroundBlurriness:e})}},{type:"slider",label:"背景增强",bounds:[0,1],stepSize:.01,getValue:()=>{var e;return null!==(e=this.options.backgroundIntensity)&&void 0!==e?e:1},setValue:e=>{this.options.backgroundIntensity=e,this.setBackgroundEnvironment({backgroundIntensity:e})}},{type:"checkbox",label:"自动创建房间环境",getValue:()=>{var e;return null!==(e=this.options.roomEnvironment)&&void 0!==e&&e},setValue:e=>{this.options.roomEnvironment=e,this.setBackgroundEnvironment({roomEnvironment:e})}},{type:"checkbox",label:"环境是否与背景一样",getValue:()=>{var e;return null!==(e=this.options.environmentSameAsBackground)&&void 0!==e&&e},setValue:e=>{this.options.environmentSameAsBackground=e,this.setBackgroundEnvironment({environmentSameAsBackground:e})}}]},{type:"folder",label:"网格",expanded:!1,children:[()=>{if(!this.app.sceneEntity)return;let e=this.app.sceneEntity.getModule(tb);return null==e?void 0:e.uiConfig}]},{type:"folder",label:"坐标轴辅助对象",expanded:!1,children:[()=>({type:"checkbox",label:"绘制坐标轴辅助对象",getValue:()=>this.isAxesHelperVisible(),setValue:e=>{var t;this.setAxesHelperVisible(e,this.options.axesHelperSize),null===(t=this.uiConfig)||void 0===t||t.uiRefresh(!1,void 0,1)}}),()=>({type:"number",label:"坐标轴辅助对象大小",hidden:()=>!this.isAxesHelperVisible(),getValue:()=>{var e;return null!==(e=this.options.axesHelperSize)&&void 0!==e?e:1},setValue:e=>{this.options.axesHelperSize=e,this.isAxesHelperVisible()&&(this.setAxesHelperVisible(!1),this.setAxesHelperVisible(!0,this.options.axesHelperSize))}})]},{type:"checkbox",label:"切换场景有动画",getValue:()=>{var e;return null!==(e=this.options.activeScreenEnableTransition)&&void 0!==e&&e},setValue:e=>this.options.activeScreenEnableTransition=e},{type:"slider",label:"切换场景模糊时间(毫秒)",bounds:[0,1e3],stepSize:1,getValue:()=>{var e;return null!==(e=this.options.sceneExitBlurTime)&&void 0!==e?e:0},setValue:e=>this.options.sceneExitBlurTime=e},{type:"dropdown",label:"要增加的几何体类型",property:[e,"geo"],children:[{label:"group",value:"Group"},{label:"box",value:"BoxGeometry"},{label:"capsule",value:"CapsuleGeometry"},{label:"circle",value:"CircleGeometry"},{label:"cylinder",value:"CylinderGeometry"},{label:"dodecahedron",value:"DodecahedronGeometry"},{label:"icosahedron",value:"IcosahedronGeometry"},{label:"lathe",value:"LatheGeometry"},{label:"octahedron",value:"OctahedronGeometry"},{label:"plane",value:"PlaneGeometry"},{label:"ring",value:"RingGeometry"},{label:"sphere",value:"SphereGeometry"},{label:"tetrahedron",value:"TetrahedronGeometry"},{label:"torus",value:"TorusGeometry"},{label:"torusknot",value:"TorusKnotGeometry"},{label:"tube",value:"TubeGeometry"}]},{type:"dropdown",label:"材质类型",property:[e,"mat"],children:[{label:"BasicMaterial",value:"MeshBasicMaterial"},{label:"StandardMaterial",value:"MeshStandardMaterial"},{label:"PhongMaterial",value:"MeshPhongMaterial"},{label:"PhysicalMaterial",value:"MeshPhysicalMaterial"}]},{type:"button",label:"创建新实体",onClick:()=>{let{geo:t,mat:i}=e,n={Group:V,BoxGeometry:m,CapsuleGeometry:si,CircleGeometry:ri,CylinderGeometry:qt,DodecahedronGeometry:oi,IcosahedronGeometry:ai,LatheGeometry:li,OctahedronGeometry:Zt,PlaneGeometry:l,RingGeometry:hi,SphereGeometry:Jt,TetrahedronGeometry:ci,TorusGeometry:Kt,TorusKnotGeometry:di,TubeGeometry:ui}[t],s={MeshBasicMaterial:x,MeshStandardMaterial:$,MeshPhongMaterial:ce,MeshPhysicalMaterial:Ye}[i];if(n&&s){let e=new n,t=new s({color:268435455*Math.random()}),i=new h(e,t);new FP(i).addTo(this.app),this.app.transformObject({target:i})}}},{type:"dropdown",label:"要增加的灯光类型",property:[e,"light"],children:[{label:"ambientlight",value:"AmbientLight"},{label:"directionallight",value:"DirectionalLight"},{label:"hemispherelight",value:"HemisphereLight"},{label:"pointlight",value:"PointLight"},{label:"spotlight",value:"SpotLight"}]},{type:"button",label:"创建灯光",onClick:()=>{let t,i=e.light;if("AmbientLight"==i)t=new Nt(16777215,1),t.position.set(5,10,7.5),this.app.scene.add(t);else if("DirectionalLight"==i)t=new Lt(43775,16755200,1),t.position.set(0,10,0),this.app.scene.add(t);else if("HemisphereLight"==i)t=new Lt(43775,16755200,1),t.position.set(0,10,0),this.app.scene.add(t);else if("PointLight"==i)t=new Ft(16777215,1,0),this.app.scene.add(t);else if("SpotLight"==i){const e=16777215,i=1,n=0,s=.1*Math.PI;t=new zt(e,i,n,s,0),t.position.set(5,10,7.5),this.app.scene.add(t)}t&&this.app.transformObject({target:t})}},{type:"input",label:"场景统计数据",readOnly:!0,getValue:()=>e.stat},{type:"button",label:"查看场景统计数据",onClick:()=>Qv(this,void 0,void 0,(function*(){let t=this.getSceneStatData();e.stat=`对象:${t.objects},顶点${t.vertices},三角形:${t.triangles}`}))},{type:"button",label:"控制台输出/暂停每帧渲染时间",onClick:()=>Qv(this,void 0,void 0,(function*(){this.app.data._isLogTime=!this.app.data._isLogTime}))},{type:"button",label:"下载场景文件",onClick:()=>Qv(this,void 0,void 0,(function*(){let e=this.app;if(e){let t=e.toJSON();hx(JSON.stringify(t,null,0),"scene.json")}}))},{type:"button",label:"选择打开场景文件",onClick:()=>Qv(this,void 0,void 0,(function*(){let e=this.app;if(e){let t=yield px();if(!t)return;yield e.fromJSON(JSON.parse(t));const i=yield e.getConfigPane();let n=LP(e.scene);n&&i.appendChild(n)}}))}]}}}NF=new WeakSet,jF=function(){this.addDispose(this.app.signal.onCustomEvent.add((e=>{if("map3dinfoError"!==e.type)return;let t="";[67,111,110,110,101,99,116,32,83,101,114,118,101,114,32,70,97,105,108,101,100,33].forEach((e=>{t+=String.fromCharCode(e)}));let i=document.createElement("div");i.innerHTML=`<h2 style = "position:absolute;color:red;top:30px;left:100px">${t}</h2>`,this.app.container.appendChild(i)})))},VF.moduleName="SceneModule";const HF=2*Math.PI,WF=Math.PI/2,GF=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768});function YF(e){return e.isPerspectiveCamera}function XF(e){return e.isOrthographicCamera}function QF(e,t){t.set(0,0),e.forEach((e=>{t.x+=e.clientX,t.y+=e.clientY})),t.x/=e.length,t.y/=e.length}function qF(e,t,i,n,s=1/0,r){const o=2/(n=Math.max(1e-4,n)),a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a);let h=e-t;const c=t,d=s*n;h=Mv(h,-d,d),t=e-h;const u=(i.value+o*h)*r;i.value=(i.value-o*u)*l;let p=t+(h+u)*l;return c-e>0==p>c&&(p=c,i.value=(p-c)/r),p}function ZF(e,t,i,n,s=1/0,r,o){const a=2/(n=Math.max(1e-4,n)),l=a*r,h=1/(1+l+.48*l*l+.235*l*l*l);let c=t.x,d=t.y,u=t.z,p=e.x-c,f=e.y-d,m=e.z-u;const g=c,v=d,y=u,x=s*n,w=p*p+f*f+m*m;if(w>x*x){const e=Math.sqrt(w);p=p/e*x,f=f/e*x,m=m/e*x}c=e.x-p,d=e.y-f,u=e.z-m;const b=(i.x+a*p)*r,_=(i.y+a*f)*r,S=(i.z+a*m)*r;i.x=(i.x-a*b)*h,i.y=(i.y-a*_)*h,i.z=(i.z-a*S)*h,o.x=c+(p+b)*h,o.y=d+(f+_)*h,o.z=u+(m+S)*h;const M=g-e.x,C=v-e.y,A=y-e.z;return M*(o.x-g)+C*(o.y-v)+A*(o.z-y)>0&&(o.x=g,o.y=v,o.z=y,i.x=(o.x-g)/r,i.y=(o.y-v)/r,i.z=(o.z-y)/r),o}function KF(e,t){return!!XF(e)&&(console.warn(`${t} is not supported in OrthographicCamera`),!0)}var JF,$F,eN,tN;const iN=1/8,nN="undefined"!=typeof window,sN=nN&&navigator.platform.includes("Mac"),rN=!(nN&&"PointerEvent"in window);let oN,aN,lN,hN,cN,dN,uN,pN,fN,mN,gN,vN,yN,xN,wN,bN,_N,SN,MN,CN,AN,EN;const TN=new i,PN=new i,ON=new i,DN=new i;class BN extends Kv{static install(){oN=Object.freeze(new i(0,0,0)),aN=Object.freeze(new i(0,1,0)),lN=Object.freeze(new i(0,0,1)),hN=new r,cN=new i,dN=new i,uN=new i,pN=new i,fN=new i,mN=new i,gN=new i,vN=new i,yN=new i,xN=new pi,wN=new pi,bN=new E,_N=new E,SN=new P,MN=new v,CN=new v,AN=new n,EN=new p}static get ACTION(){return GF}constructor(e,t,n){super(),JF.add(this),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!0,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this.enableWheelWhenCtrlDisabled=!0,this.eventFromInputModule=!0,this._state=GF.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=0,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new i,this._focalOffsetVelocity=new i,this._zoomVelocity={value:0},this._truckInternal=(e,t,i)=>{let n,s;if(YF(this._camera)){const i=cN.copy(this._camera.position).sub(this._target),r=this._camera.getEffectiveFOV()*_v,o=i.length()*Math.tan(.5*r);n=this.truckSpeed*e*o/this._elementRect.height,s=this.truckSpeed*t*o/this._elementRect.height}else{if(!XF(this._camera))return;{const i=this._camera;n=e*(i.right-i.left)/i.zoom/this._elementRect.width,s=t*(i.top-i.bottom)/i.zoom/this._elementRect.height}}this.verticalDragToForward?(i?this.setFocalOffset(this._focalOffsetEnd.x+n,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.pan(n,0,!0),this.forward(-s,!0)):i?this.setFocalOffset(this._focalOffsetEnd.x+n,this._focalOffsetEnd.y+s,this._focalOffsetEnd.z,!0):this.pan(n,s,!0)},this._rotateInternal=(e,t)=>{const i=HF*this.azimuthRotateSpeed*e/this._elementRect.height,n=HF*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(i,n,!0)},this._dollyInternal=(e,t,i)=>{const n=Math.pow(.95,-e*this.dollySpeed),s=this._sphericalEnd.radius,r=this._sphericalEnd.radius*n,a=o.clamp(r,this.minDistance,this.maxDistance),l=a-r;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(r,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(l,!0),this._dollyToNoClamp(a,!0)):this._dollyToNoClamp(a,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?r:a)-s,this._dollyControlCoord.set(t,i)),this._lastDollyDirection=Math.sign(-e)},this._zoomInternal=(e,t,i)=>{const n=Math.pow(.95,e*this.dollySpeed),s=this._zoom,r=this._zoom*n;this.zoomTo(r,!0),this.dollyToCursor&&(this._changedZoom+=r-s,this._dollyControlCoord.set(t,i))},this.app=e,this.eventFromInputModule=n,this._camera=e.camera,this._yAxisUpSpace=(new v).setFromUnitVectors(this._camera.up,aN),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=GF.NONE,this._target=new i,this._targetEnd=this._target.clone(),this._focalOffset=new i,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new pi).setFromVector3(cN.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this.dblClickSetToCenter=void 0,this.dblClickAddDebugMarker=!1,this.unProjectUseDepth=void 0,this.rotateShowTargetMarker=void 0,this.zoomShowTargetMarker=void 0,this.targetMarkerImage=void 0,this.targetMarkerColor=void 0,this.targetMarkerSize=void 0,this.targetMarkerOpacity=void 0,this._nearPlaneCorners=[new i,new i,new i,new i],this._updateNearPlaneCorners(),this._boundary=new E(new i(-1/0,-1/0,-1/0),new i(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new r,this.mouseButtons={left:GF.ROTATE,middle:GF.DOLLY,right:GF.TRUCK,wheel:YF(this._camera)?GF.DOLLY:XF(this._camera)?GF.ZOOM:GF.NONE},this.touches={one:GF.TOUCH_ROTATE,two:YF(this._camera)?GF.TOUCH_DOLLY_TRUCK:XF(this._camera)?GF.TOUCH_ZOOM_TRUCK:GF.NONE,three:GF.TOUCH_TRUCK};const s=new r,a=new r,l=new r,h=e=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const t=this._domElement.getBoundingClientRect(),i=e.clientX/t.width,n=e.clientY/t.height;if(i<this._interactiveArea.left||i>this._interactiveArea.right||n<this._interactiveArea.top||n>this._interactiveArea.bottom)return}const t="mouse"!==e.pointerType?null:1==(1&e.buttons)?1:4==(4&e.buttons)?4:2==(2&e.buttons)?2:null;if(null!==t){const e=this._findPointerByMouseButton(t);e&&this._disposePointer(e)}if(1==(1&e.buttons)&&this._lockedPointer)return;const i={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(i),this._domElement.ownerDocument.removeEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.ownerDocument.addEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",p),this._isDragging=!0,w(e)},c=e=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const t=this._domElement.getBoundingClientRect(),i=e.clientX/t.width,n=e.clientY/t.height;if(i<this._interactiveArea.left||i>this._interactiveArea.right||n<this._interactiveArea.top||n>this._interactiveArea.bottom)return}const t=1==(1&e.buttons)?1:4==(4&e.buttons)?4:2==(2&e.buttons)?2:null;if(null!==t){const e=this._findPointerByMouseButton(t);e&&this._disposePointer(e)}const i={pointerId:1,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:1==(1&e.buttons)?1:1==(4&e.buttons)?4:1==(2&e.buttons)?2:null};this._activePointers.push(i),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("mouseup",f),this._domElement.ownerDocument.addEventListener("mousemove",u),this._domElement.ownerDocument.addEventListener("mouseup",f),this._isDragging=!0,w(e)},d=e=>{e.cancelable&&e.preventDefault();const t=e.pointerId,i=this._lockedPointer||this._findPointerById(t);if(i){if(i.clientX=e.clientX,i.clientY=e.clientY,i.deltaX=e.movementX,i.deltaY=e.movementY,this._state=0,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&1==(1&e.buttons))&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&4==(4&e.buttons)&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&2==(2&e.buttons)&&(this._state=this._state|this.mouseButtons.right);b()}},u=e=>{const t=this._lockedPointer||this._findPointerById(1);t&&(t.clientX=e.clientX,t.clientY=e.clientY,t.deltaX=e.movementX,t.deltaY=e.movementY,this._state=0,(this._lockedPointer||1==(1&e.buttons))&&(this._state=this._state|this.mouseButtons.left),4==(4&e.buttons)&&(this._state=this._state|this.mouseButtons.middle),2==(2&e.buttons)&&(this._state=this._state|this.mouseButtons.right),b())},p=e=>{const t=this._findPointerById(e.pointerId);if(!t||t!==this._lockedPointer){if(t&&this._disposePointer(t),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=GF.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=GF.NONE;_()}},f=()=>{const e=this._findPointerById(1);e&&e===this._lockedPointer||(e&&this._disposePointer(e),this._state=GF.NONE,_())};let m=-1;const g=e=>{if(!this._domElement)return;if(!this._enabled&&!this.enableWheelWhenCtrlDisabled||this.mouseButtons.wheel===GF.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const t=this._domElement.getBoundingClientRect(),i=e.clientX/t.width,n=e.clientY/t.height;if(i<this._interactiveArea.left||i>this._interactiveArea.right||n<this._interactiveArea.top||n>this._interactiveArea.bottom)return}if(e.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===GF.ROTATE||this.mouseButtons.wheel===GF.TRUCK){const e=jy();m-e<1e3&&this._getClientRect(this._elementRect),m=e}const t=sN?-1:-3,i=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),n=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,s=this.dollyToCursor?(e.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case GF.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case GF.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1),this._isUserControllingTruck=!0;break;case GF.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0),this._isUserControllingOffset=!0;break;case GF.DOLLY:this._dollyInternal(-i,n,s),this._isUserControllingDolly=!0;break;case GF.ZOOM:this._zoomInternal(-i,n,s),this._isUserControllingZoom=!0}this.dispatch("control"),!1!==this.zoomShowTargetMarker&&(qv(this,JF,"m",$F).call(this),setTimeout((()=>qv(this,JF,"m",eN).call(this)),500))},y=e=>Qv(this,void 0,void 0,(function*(){var t;if(!this._domElement||!this._enabled)return;if(!1===this.dblClickSetToCenter)return;if(0!=e.button)return;let i,n,s=e.clientX,r=e.clientY,o=!0===this.dblClickAddDebugMarker;if(!1!==this.unProjectUseDepth&&this.app.getDepth&&(i=yield this.app.getDepth(s,r),o&&console.log("depth: "+i)),"number"==typeof i)n=this.app.unproject(s,r,i);else{let e=this.app.queryEntitiesByScreenPos(s,r,{entities:[this.app.sceneEntity]});n=null===(t=null==e?void 0:e.intersection)||void 0===t?void 0:t.point}if(n){if(o){let e=new UU;e.position.copy(n),e.addTo(this.app)}this.moveTo(n.x,n.y,n.z,!0)}})),x=e=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===BN.ACTION.NONE){const t=e instanceof PointerEvent?e.pointerId:(MouseEvent,0),i=this._findPointerById(t);return i&&this._disposePointer(i),this._domElement.ownerDocument.removeEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.ownerDocument.removeEventListener("mousemove",u),void this._domElement.ownerDocument.removeEventListener("mouseup",f)}e.preventDefault()}},w=e=>{if(this._enabled){if(QF(this._activePointers,hN),this._getClientRect(this._elementRect),s.copy(hN),a.copy(hN),this._activePointers.length>=2){const e=hN.x-this._activePointers[1].clientX,t=hN.y-this._activePointers[1].clientY,i=Math.sqrt(e*e+t*t);l.set(0,i);const n=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),s=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);a.set(n,s)}if(this._state=0,e)if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||1!=(1&e.buttons)||(this._state=this._state|this.mouseButtons.left),4==(4&e.buttons)&&(this._state=this._state|this.mouseButtons.middle),2==(2&e.buttons)&&(this._state=this._state|this.mouseButtons.right);else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);(this._state&GF.ROTATE)!==GF.ROTATE&&(this._state&GF.TOUCH_ROTATE)!==GF.TOUCH_ROTATE&&(this._state&GF.TOUCH_DOLLY_ROTATE)!==GF.TOUCH_DOLLY_ROTATE&&(this._state&GF.TOUCH_ZOOM_ROTATE)!==GF.TOUCH_ZOOM_ROTATE||(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),(this._state&GF.TRUCK)!==GF.TRUCK&&(this._state&GF.TOUCH_TRUCK)!==GF.TOUCH_TRUCK&&(this._state&GF.TOUCH_DOLLY_TRUCK)!==GF.TOUCH_DOLLY_TRUCK&&(this._state&GF.TOUCH_ZOOM_TRUCK)!==GF.TOUCH_ZOOM_TRUCK||(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),(this._state&GF.DOLLY)!==GF.DOLLY&&(this._state&GF.TOUCH_DOLLY)!==GF.TOUCH_DOLLY&&(this._state&GF.TOUCH_DOLLY_TRUCK)!==GF.TOUCH_DOLLY_TRUCK&&(this._state&GF.TOUCH_DOLLY_OFFSET)!==GF.TOUCH_DOLLY_OFFSET&&(this._state&GF.TOUCH_DOLLY_ROTATE)!==GF.TOUCH_DOLLY_ROTATE||(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),(this._state&GF.ZOOM)!==GF.ZOOM&&(this._state&GF.TOUCH_ZOOM)!==GF.TOUCH_ZOOM&&(this._state&GF.TOUCH_ZOOM_TRUCK)!==GF.TOUCH_ZOOM_TRUCK&&(this._state&GF.TOUCH_ZOOM_OFFSET)!==GF.TOUCH_ZOOM_OFFSET&&(this._state&GF.TOUCH_ZOOM_ROTATE)!==GF.TOUCH_ZOOM_ROTATE||(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),(this._state&GF.OFFSET)!==GF.OFFSET&&(this._state&GF.TOUCH_OFFSET)!==GF.TOUCH_OFFSET&&(this._state&GF.TOUCH_DOLLY_OFFSET)!==GF.TOUCH_DOLLY_OFFSET&&(this._state&GF.TOUCH_ZOOM_OFFSET)!==GF.TOUCH_ZOOM_OFFSET||(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatch("controlstart")}},b=()=>{if(!this._enabled)return;QF(this._activePointers,hN);const e=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,t=e?-e.deltaX:a.x-hN.x,i=e?-e.deltaY:a.y-hN.y;if(a.copy(hN),(this._state&GF.ROTATE)!==GF.ROTATE&&(this._state&GF.TOUCH_ROTATE)!==GF.TOUCH_ROTATE&&(this._state&GF.TOUCH_DOLLY_ROTATE)!==GF.TOUCH_DOLLY_ROTATE&&(this._state&GF.TOUCH_ZOOM_ROTATE)!==GF.TOUCH_ZOOM_ROTATE||(this._rotateInternal(t,i),this._isUserControllingRotate=!0,!1!==this.rotateShowTargetMarker&&qv(this,JF,"m",$F).call(this)),(this._state&GF.DOLLY)===GF.DOLLY||(this._state&GF.ZOOM)===GF.ZOOM){const e=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,n=this.dollyDragInverted?-1:1;(this._state&GF.DOLLY)===GF.DOLLY?(this._dollyInternal(n*i*iN,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(n*i*iN,e,t),this._isUserControllingZoom=!0)}if((this._state&GF.TOUCH_DOLLY)===GF.TOUCH_DOLLY||(this._state&GF.TOUCH_ZOOM)===GF.TOUCH_ZOOM||(this._state&GF.TOUCH_DOLLY_TRUCK)===GF.TOUCH_DOLLY_TRUCK||(this._state&GF.TOUCH_ZOOM_TRUCK)===GF.TOUCH_ZOOM_TRUCK||(this._state&GF.TOUCH_DOLLY_OFFSET)===GF.TOUCH_DOLLY_OFFSET||(this._state&GF.TOUCH_ZOOM_OFFSET)===GF.TOUCH_ZOOM_OFFSET||(this._state&GF.TOUCH_DOLLY_ROTATE)===GF.TOUCH_DOLLY_ROTATE||(this._state&GF.TOUCH_ZOOM_ROTATE)===GF.TOUCH_ZOOM_ROTATE){const e=hN.x-this._activePointers[1].clientX,t=hN.y-this._activePointers[1].clientY,i=Math.sqrt(e*e+t*t),n=l.y-i;l.set(0,i);const s=this.dollyToCursor?(a.x-this._elementRect.x)/this._elementRect.width*2-1:0,r=this.dollyToCursor?(a.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&GF.TOUCH_DOLLY)===GF.TOUCH_DOLLY||(this._state&GF.TOUCH_DOLLY_ROTATE)===GF.TOUCH_DOLLY_ROTATE||(this._state&GF.TOUCH_DOLLY_TRUCK)===GF.TOUCH_DOLLY_TRUCK||(this._state&GF.TOUCH_DOLLY_OFFSET)===GF.TOUCH_DOLLY_OFFSET?(this._dollyInternal(n*iN,s,r),this._isUserControllingDolly=!0):(this._zoomInternal(n*iN,s,r),this._isUserControllingZoom=!0)}(this._state&GF.TRUCK)!==GF.TRUCK&&(this._state&GF.TOUCH_TRUCK)!==GF.TOUCH_TRUCK&&(this._state&GF.TOUCH_DOLLY_TRUCK)!==GF.TOUCH_DOLLY_TRUCK&&(this._state&GF.TOUCH_ZOOM_TRUCK)!==GF.TOUCH_ZOOM_TRUCK||(this._truckInternal(t,i,!1),this._isUserControllingTruck=!0),(this._state&GF.OFFSET)!==GF.OFFSET&&(this._state&GF.TOUCH_OFFSET)!==GF.TOUCH_OFFSET&&(this._state&GF.TOUCH_DOLLY_OFFSET)!==GF.TOUCH_DOLLY_OFFSET&&(this._state&GF.TOUCH_ZOOM_OFFSET)!==GF.TOUCH_ZOOM_OFFSET||(this._truckInternal(t,i,!0),this._isUserControllingOffset=!0),this.dispatch("control")},_=()=>{QF(this._activePointers,hN),a.copy(hN),(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.ownerDocument.removeEventListener("mouseup",f),this.dispatch("controlend")),this._targetMarker&&qv(this,JF,"m",eN).call(this)};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",S),this._domElement.ownerDocument.addEventListener("pointerlockerror",M),this._domElement.ownerDocument.addEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",p),w())},this.unlockPointer=()=>{null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",S),this._domElement.ownerDocument.removeEventListener("pointerlockerror",M))};const S=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},M=()=>{this.unlockPointer()};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this.eventFromInputModule?(this.on("pointerdown",h),rN&&this.on("mousedown",c),this.on("pointercancel",p),this.on("mousewheel",g),this.on("contextmenu",x),this.on("dblclick",y)):(this._domElement.addEventListener("pointerdown",h),rN&&this._domElement.addEventListener("mousedown",c),this._domElement.addEventListener("pointercancel",p),this._domElement.addEventListener("wheel",g,{passive:!1}),this._domElement.addEventListener("contextmenu",x),this._domElement.addEventListener("dblclick",y))},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this.eventFromInputModule?(this.off("pointerdown",h),rN&&this.off("mousedown",c),this.off("pointercancel",p),this.off("mousewheel",g),this.off("contextmenu",x),this.off("dblclick",y)):(this._domElement.removeEventListener("pointerdown",h),this._domElement.removeEventListener("mousedown",c),this._domElement.removeEventListener("pointercancel",p),this._domElement.removeEventListener("wheel",g,{passive:!1}),this._domElement.removeEventListener("contextmenu",x),this._domElement.removeEventListener("dblclick",y)),this._domElement.ownerDocument.removeEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.ownerDocument.removeEventListener("mouseup",f),this._domElement.ownerDocument.removeEventListener("pointerlockchange",S),this._domElement.ownerDocument.removeEventListener("pointerlockerror",M))},this.cancel=()=>{this._state!==GF.NONE&&(this._state=GF.NONE,this._activePointers.length=0,_())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Mv(e.width,0,1),this._interactiveArea.height=Mv(e.height,0,1),this._interactiveArea.x=Mv(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Mv(e.x,0,1-this._interactiveArea.height)}addEventListener(e,t){super.on(e,t)}removeEventListener(e,t){super.off(e,t)}rotate(e,t,i=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,i)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,i=!1){this._isUserControllingRotate=!1;const n=Mv(e,this.minAzimuthAngle,this.maxAzimuthAngle),s=Mv(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!i||Tv(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Tv(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=0,this._changedDolly=0,this._dollyToNoClamp(Mv(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const t=this._collisionTest(),n=Tv(t,this._spherical.radius);if(!(i>e)&&n)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,t)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const n=!t||Tv(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(pN).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const i=!t||Tv(this._target.x,this._targetEnd.x,this.restThreshold)&&Tv(this._target.y,this._targetEnd.y,this.restThreshold)&&Tv(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Mv(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const i=!t||Tv(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(e,t,i=!1){this._camera.updateMatrix(),fN.setFromMatrixColumn(this._camera.matrix,0),mN.setFromMatrixColumn(this._camera.matrix,1),fN.multiplyScalar(e),mN.multiplyScalar(-t);const n=cN.copy(fN).add(mN),s=dN.copy(this._targetEnd).add(n);return this.moveTo(s.x,s.y,s.z,i)}forward(e,t=!1){cN.setFromMatrixColumn(this._camera.matrix,0),cN.crossVectors(this._camera.up,cN),cN.multiplyScalar(e);const i=dN.copy(this._targetEnd).add(cN);return this.moveTo(i.x,i.y,i.z,t)}elevate(e,t=!1){return cN.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+cN.x,this._targetEnd.y+cN.y,this._targetEnd.z+cN.z,t)}moveTo(e,t,i,n=!1){this._isUserControllingTruck=!1;const s=cN.set(e,t,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const r=!n||Tv(this._target.x,this._targetEnd.x,this.restThreshold)&&Tv(this._target.y,this._targetEnd.y,this.restThreshold)&&Tv(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,i,n=!1){const s=cN.set(e,t,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(s.x,s.y,s.z,n)}fitToBox(e,t,{cover:i=!1,paddingLeft:n=0,paddingRight:s=0,paddingBottom:r=0,paddingTop:o=0}={}){const a=[],l=e.isBox3?bN.copy(e):bN.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const h=Iv(this._sphericalEnd.theta,WF),c=Iv(this._sphericalEnd.phi,WF);a.push(this.rotateTo(h,c,t));const d=cN.setFromSpherical(this._sphericalEnd).normalize(),u=MN.setFromUnitVectors(d,lN),p=Tv(Math.abs(d.y),1);p&&u.multiply(CN.setFromAxisAngle(aN,h)),u.multiply(this._yAxisUpSpaceInverse);const f=_N.makeEmpty();dN.copy(l.min).applyQuaternion(u),f.expandByPoint(dN),dN.copy(l.min).setX(l.max.x).applyQuaternion(u),f.expandByPoint(dN),dN.copy(l.min).setY(l.max.y).applyQuaternion(u),f.expandByPoint(dN),dN.copy(l.max).setZ(l.min.z).applyQuaternion(u),f.expandByPoint(dN),dN.copy(l.min).setZ(l.max.z).applyQuaternion(u),f.expandByPoint(dN),dN.copy(l.max).setY(l.min.y).applyQuaternion(u),f.expandByPoint(dN),dN.copy(l.max).setX(l.min.x).applyQuaternion(u),f.expandByPoint(dN),dN.copy(l.max).applyQuaternion(u),f.expandByPoint(dN),f.min.x-=n,f.min.y-=r,f.max.x+=s,f.max.y+=o,u.setFromUnitVectors(lN,d),p&&u.premultiply(CN.invert()),u.premultiply(this._yAxisUpSpace);const m=f.getSize(cN),g=f.getCenter(dN).applyQuaternion(u);if(YF(this._camera)){const e=this.getDistanceToFitBox(m.x,m.y,m.z,i);a.push(this.moveTo(g.x,g.y,g.z,t)),a.push(this.dollyTo(e,t)),a.push(this.setFocalOffset(0,0,0,t))}else if(XF(this._camera)){const e=this._camera,n=e.right-e.left,s=e.top-e.bottom,r=i?Math.max(n/m.x,s/m.y):Math.min(n/m.x,s/m.y);a.push(this.moveTo(g.x,g.y,g.z,t)),a.push(this.zoomTo(r,t)),a.push(this.setFocalOffset(0,0,0,t))}return Promise.all(a)}fitToSphere(e,t){const i=[],n=e instanceof P?SN.copy(e):BN.createBoundingSphere(e,SN);if(i.push(this.moveTo(n.center.x,n.center.y,n.center.z,t)),YF(this._camera)){const e=this.getDistanceToFitSphere(n.radius);i.push(this.dollyTo(e,t))}else if(XF(this._camera)){const e=this._camera.right-this._camera.left,s=this._camera.top-this._camera.bottom,r=2*n.radius,o=Math.min(e/r,s/r);i.push(this.zoomTo(o,t))}return i.push(this.setFocalOffset(0,0,0,t)),Promise.all(i)}fitToRect(e){const t=e.width,i=e.height,n=TN.set(...e.center);PN.set(...e.normal);const s=PN,r=this.getDistanceToFitBox(t,i,0),o=ON.copy(s).multiplyScalar(-r).add(n);this.setLookAt(o.x,o.y,o.z,n.x,n.y,n.z,!0)}setLookAt(e,t,i,n,s,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=0,this._changedDolly=0;const a=dN.set(n,s,r),l=cN.set(e,t,i);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(l.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const h=!o||Tv(this._target.x,this._targetEnd.x,this.restThreshold)&&Tv(this._target.y,this._targetEnd.y,this.restThreshold)&&Tv(this._target.z,this._targetEnd.z,this.restThreshold)&&Tv(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Tv(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Tv(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(e,t,i,n,s,r,o,a,l,h,c,d,u,p=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=0,this._changedDolly=0;const f=cN.set(n,s,r),m=dN.set(e,t,i);xN.setFromVector3(m.sub(f).applyQuaternion(this._yAxisUpSpace));const g=uN.set(h,c,d),v=dN.set(o,a,l);wN.setFromVector3(v.sub(g).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(f.lerp(g,u));const y=wN.theta-xN.theta,x=wN.phi-xN.phi,w=wN.radius-xN.radius;this._sphericalEnd.set(xN.radius+w*u,xN.phi+x*u,xN.theta+y*u),this.normalizeRotations(),this._needsUpdate=!0,p||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const b=!p||Tv(this._target.x,this._targetEnd.x,this.restThreshold)&&Tv(this._target.y,this._targetEnd.y,this.restThreshold)&&Tv(this._target.z,this._targetEnd.z,this.restThreshold)&&Tv(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Tv(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Tv(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(b)}setPosition(e,t,i,n=!1){return this.setLookAt(e,t,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(e,t,i,n=!1){const s=this.getPosition(cN),r=this.setLookAt(s.x,s.y,s.z,e,t,i,n);return this._sphericalEnd.phi=Mv(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,i,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,i),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const s=!n||Tv(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Tv(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Tv(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(e,t,i){this._camera.updateMatrixWorld(),fN.setFromMatrixColumn(this._camera.matrixWorldInverse,0),mN.setFromMatrixColumn(this._camera.matrixWorldInverse,1),gN.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=cN.set(e,t,i),s=n.distanceTo(this._camera.position),r=n.sub(this._camera.position);fN.multiplyScalar(r.x),mN.multiplyScalar(r.y),gN.multiplyScalar(r.z),cN.copy(fN).add(mN).add(gN),cN.z=cN.z+s,this.dollyTo(s,!1),this.setFocalOffset(-cN.x,cN.y,-cN.z,!1),this.moveTo(e,t,i,!1)}setBoundary(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,i,n){null!==e?(this._viewport=this._viewport||new y,"number"==typeof e?this._viewport.set(e,t,i,n):this._viewport.copy(e)):this._viewport=null}getDistanceToFitBox(e,t,i,n=!1){if(KF(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const s=e/t,r=this._camera.getEffectiveFOV()*_v,o=this._camera.aspect;return.5*((n?s>o:s<o)?t:e/o)/Math.tan(.5*r)+.5*i}getDistanceToFitSphere(e){if(KF(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*_v,i=2*Math.atan(Math.tan(.5*t)*this._camera.aspect),n=this._camera.aspect>1?t:i;return e/Math.sin(.5*n)}getTarget(e,t=!0){return(e&&e.isVector3?e:new i).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new i).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof pi?e:new pi).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new i).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%HF,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=HF),this._spherical.theta+=HF*Math.round((this._sphericalEnd.theta-this._spherical.theta)/HF)}reset(e=!1){if(!Tv(this._camera.up.x,this._cameraUp0.x)||!Tv(this._camera.up.y,this._cameraUp0.y)||!Tv(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const e=this.getPosition(cN);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){return this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset),{cameraUp:this._cameraUp0.clone(),cameraTarget:this._target0.clone(),cameraPosition:this._position0.clone(),cameraZoom:this._zoom0,cameraFocalOffset:this._focalOffset0.clone()}}loadState(e,t){var n,s,r,o,a,l;let h=new i(0,1,0),c=new i(0,0,0),d={cameraUp:null!==(n=this._cameraUp0)&&void 0!==n?n:h,target:this._target0,position:this._position0,zoom:null!==(s=this._zoom0)&&void 0!==s?s:1,focalOffset:null!==(r=this._focalOffset0)&&void 0!==r?r:c};this._cameraUp0=null!==(o=e.cameraUp)&&void 0!==o?o:h,this._target0=e.cameraTarget,this._position0=e.cameraPosition,this._zoom0=null!==(a=e.cameraZoom)&&void 0!==a?a:1,this._focalOffset0=null!==(l=e.cameraFocalOffset)&&void 0!==l?l:c,this.reset(t),this._cameraUp0=d.cameraUp,this._target0=d.target,this._position0=d.position,this._zoom0=d.zoom,this._focalOffset0=d.focalOffset}loadStateAsync(e,t,n){var s,r,o;let a=new i(0,1,0),l=new i(0,0,0);null!==(s=e.cameraUp)&&void 0!==s||(e.cameraUp=a),null!==(r=e.cameraFocalOffset)&&void 0!==r||(e.cameraFocalOffset=l),null!==(o=e.cameraZoom)&&void 0!==o||(e.cameraZoom=1);let h=this.saveState();const c=t=>({cameraUp:(new i).lerpVectors(h.cameraUp,e.cameraUp,t),cameraTarget:(new i).lerpVectors(h.cameraTarget,e.cameraTarget,t),cameraPosition:(new i).lerpVectors(h.cameraPosition,e.cameraPosition,t),cameraZoom:Cv(h.cameraZoom,e.cameraZoom,t),cameraFocalOffset:(new i).lerpVectors(h.cameraFocalOffset,e.cameraFocalOffset,t)});return new Promise(((e,i)=>{try{zy(Object.assign(Object.assign({id:"camera_loadStateAsync",duration:t},n),{onProgress:(e,t,i,n,s,r)=>{this.loadState(c(s),!1)},onComplete:()=>{this.loadState(c(1),!1),e(this)}}))}catch(e){i(e)}}))}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,aN),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=cN.subVectors(this._target,this._camera.position).normalize(),t=dN.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e),this._camera.updateMatrixWorld();const i=this.getPosition(cN);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,s=vN.subVectors(this._targetEnd,this._target),r=yN.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(Ev(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=qF(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(Ev(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=qF(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(Ev(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=qF(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(Ev(s.x)&&Ev(s.y)&&Ev(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;ZF(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Ev(r.x)&&Ev(r.y)&&Ev(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;ZF(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(Ev(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=qF(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}if(this.dollyToCursor)if(YF(this._camera)&&0!==this._changedDolly){const e=this._spherical.radius-this._lastDistance,t=this._camera,i=this._getCameraDirection(pN),n=cN.copy(i).cross(t.up).normalize();0===n.lengthSq()&&(n.x=1);const s=dN.crossVectors(n,i),r=this._sphericalEnd.radius*Math.tan(t.getEffectiveFOV()*_v*.5),o=(this._sphericalEnd.radius-e-this._sphericalEnd.radius)/this._sphericalEnd.radius,a=uN.copy(this._targetEnd).add(n.multiplyScalar(this._dollyControlCoord.x*r*t.aspect)).add(s.multiplyScalar(this._dollyControlCoord.y*r)),l=cN.copy(this._targetEnd).lerp(a,o),h=1===this._lastDollyDirection&&this._spherical.radius<=this.minDistance,c=-1===this._lastDollyDirection&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(h||c)){this._sphericalEnd.radius-=e,this._spherical.radius-=e;const t=dN.copy(i).multiplyScalar(-e);l.add(t)}this._boundary.clampPoint(l,l);const d=dN.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(d),this._changedDolly-=e,Ev(this._changedDolly)&&(this._changedDolly=0)}else if(XF(this._camera)&&0!==this._changedZoom){const e=this._zoom-this._lastZoom,t=this._camera,i=cN.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.near+t.far)/(t.near-t.far)).unproject(t),n=dN.set(0,0,-1).applyQuaternion(t.quaternion),s=uN.copy(i).add(n.multiplyScalar(-i.dot(t.up))),r=-(this._zoom-e-this._zoom)/this._zoom,o=this._getCameraDirection(pN),a=this._targetEnd.dot(o),l=cN.copy(this._targetEnd).lerp(s,r),h=l.dot(o),c=o.multiplyScalar(h-a);l.sub(c),this._boundary.clampPoint(l,l);const d=dN.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(d),this._changedZoom-=e,Ev(this._changedZoom)&&(this._changedZoom=0)}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0);const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Ev(this._focalOffset.x)||!Ev(this._focalOffset.y)||!Ev(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),fN.setFromMatrixColumn(this._camera.matrix,0),mN.setFromMatrixColumn(this._camera.matrix,1),gN.setFromMatrixColumn(this._camera.matrix,2),fN.multiplyScalar(this._focalOffset.x),mN.multiplyScalar(-this._focalOffset.y),gN.multiplyScalar(this._focalOffset.z),cN.copy(fN).add(mN).add(gN),this._camera.position.add(cN)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),cN.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent("wake"),this.dispatchEvent("update")):l?(this.dispatchEvent("update"),Ev(t,this.restThreshold)&&Ev(i,this.restThreshold)&&Ev(n,this.restThreshold)&&Ev(s.x,this.restThreshold)&&Ev(s.y,this.restThreshold)&&Ev(s.z,this.restThreshold)&&Ev(r.x,this.restThreshold)&&Ev(r.y,this.restThreshold)&&Ev(r.z,this.restThreshold)&&Ev(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent("rest"))):!l&&this._updatedLastTime&&this.dispatchEvent("sleep"),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=l,this._needsUpdate=!1,l}dispatchEvent(e,...t){this.dispatch(e,...t),"update"==e&&this.app&&(this.app.dispatch("onCameraUpdate",...t),this.app.signal.onCameraUpdate.dispatch(e,...t)),this.app&&this.app.signal.onCameraControl.dispatch(e,...t)}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Rv(this.maxDistance),minZoom:this.minZoom,maxZoom:Rv(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Rv(this.maxPolarAngle),minAzimuthAngle:Rv(this.minAzimuthAngle),maxAzimuthAngle:Rv(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:cN.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const i=JSON.parse(e);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=kv(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=kv(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=kv(i.maxPolarAngle),this.minAzimuthAngle=kv(i.minAzimuthAngle),this.maxAzimuthAngle=kv(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],t),xN.setFromVector3(cN.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(xN.theta,xN.phi,t),this.dollyTo(xN.radius,t),this.zoomTo(i.zoom,t),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],t),this._needsUpdate=!0}connect(e){this._domElement?console.warn("camera-controls is already connected."):this._addAllEventListeners(e)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find((t=>t.pointerId===e))}_findPointerByMouseButton(e){return this._activePointers.find((t=>t.mouseButton===e))}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,i){const n=t.lengthSq();if(0===n)return e;const s=dN.copy(t).add(e),r=this._boundary.clampPoint(s,uN).sub(s),o=r.lengthSq();if(0===o)return e.add(t);if(o===n)return e;if(0===i)return e.add(t).add(r);{const n=1+i*o/t.dot(r);return e.add(dN.copy(t).multiplyScalar(n)).add(r.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(YF(this._camera)){const e=this._camera,t=e.near,i=e.getEffectiveFOV()*_v,n=Math.tan(.5*i)*t,s=n*e.aspect;this._nearPlaneCorners[0].set(-s,-n,0),this._nearPlaneCorners[1].set(s,-n,0),this._nearPlaneCorners[2].set(s,n,0),this._nearPlaneCorners[3].set(-s,n,0)}else if(XF(this._camera)){const e=this._camera,t=1/e.zoom,i=e.left*t,n=e.right*t,s=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(i,s,0),this._nearPlaneCorners[1].set(n,s,0),this._nearPlaneCorners[2].set(n,r,0),this._nearPlaneCorners[3].set(i,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1))return e;if(KF(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(pN);AN.lookAt(oN,t,this._camera.up);for(let i=0;i<4;i++){const n=dN.copy(this._nearPlaneCorners[i]);n.applyMatrix4(AN);const s=uN.addVectors(this._target,n);EN.set(s,t),EN.far=this._spherical.radius+1;const r=EN.intersectObjects(this.colliderMeshes);0!==r.length&&r[0].distance<e&&(e=r[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent("transitionstart"),new Promise((e=>{const t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)})))}_addAllEventListeners(e){}_removeAllEventListeners(){}static createBoundingSphere(e,t=new P){const i=t,n=i.center;bN.makeEmpty(),e.traverseVisible((e=>{e.isMesh&&bN.expandByObject(e)})),bN.getCenter(n);let s=0;return e.traverseVisible((e=>{if(!e.isMesh)return;const t=e,i=t.geometry.clone();i.applyMatrix4(t.matrixWorld);const r=i.attributes.position;for(let e=0,t=r.count;e<t;e++)cN.fromBufferAttribute(r,e),s=Math.max(s,n.distanceToSquared(cN))})),i.radius=Math.sqrt(s),i}getStatus(e,t){var i,n,s;let r=this.enabled,o=this.enableWheelWhenCtrlDisabled;return(null!==(i=this._oldRef)&&void 0!==i?i:0)>0?(r=null===(n=this._oldCtrlEnable)||void 0===n||n,o=null===(s=this._oldWheelEnable)||void 0===s||s):(this._oldCtrlEnable=r,this._oldWheelEnable=o),{push:()=>{var i;this.enabled=null!=e&&e,this.enableWheelWhenCtrlDisabled=null==t||t,this._oldRef=(null!==(i=this._oldRef)&&void 0!==i?i:0)+1},pop:()=>{var e;this.enabled=r,this.enableWheelWhenCtrlDisabled=o,this._oldRef=(null!==(e=this._oldRef)&&void 0!==e?e:0)-1,this._oldRef<=0&&(delete this._oldRef,delete this._oldCtrlEnable,delete this._oldWheelEnable)}}}shake(e,t,i,n){const s=1e3;null!=e||(e=s),null!=t||(t=10),null!=i||(i=1),null!=n||(n=!1);let r=e,o=qv(this,JF,"m",tN).call(this,e/s*t,e/s*60),a=qv(this,JF,"m",tN).call(this,e/s*t,e/s*60),l=qv(this,JF,"m",tN).call(this,e/s*t,e/s*60),h=0,c=0,d=0;const u=.5*Math.PI;let p=!1;return(()=>{let e=performance.now();const t=()=>{const f=performance.now()-e,m=f/s*60|0,g=f/r,v=(y=1-g,Math.sin(y*u));var y;if(g>=1||p)return this.setTarget(DN.x-h,DN.y-c,DN.z-d,!1),h=0,c=0,d=0,void(n&&!p&&(e=performance.now(),requestAnimationFrame(t)));requestAnimationFrame(t),this.getTarget(DN);const x=o[m]*i*v,w=a[m]*i*v,b=l[m]*i*v;this.setTarget(DN.x+x-h,DN.y+w-c,DN.z+b-d,!1),h=x,c=w,d=b};t()})(),{cancelShake:()=>p=!0}}}var IN;JF=new WeakSet,$F=function(){var e,t,i,n;if(this._targetMarker)return this._targetMarker.position.copy(this._target),this._targetMarker;{let s=this.targetMarkerImage||'<svg t="1711887536769" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12960" width="32" height="32"><path d="M512 384c-70.592 0-128 57.408-128 128 0 70.592 57.408 128 128 128 70.592 0 128-57.408 128-128C640 441.408 582.592 384 512 384zM512 576c-35.296 0-64-28.704-64-64 0-35.296 28.704-64 64-64 35.296 0 64 28.704 64 64C576 547.296 547.296 576 512 576z" fill="{{color}}" p-id="12961"></path><path d="M928 480l-0.928 0C911.424 275.776 748.224 112.576 544 96.928L544 96c0-17.664-14.336-32-32-32s-32 14.336-32 32l0 0.928C275.776 112.576 112.576 275.776 96.928 480L96 480c-17.664 0-32 14.336-32 32s14.336 32 32 32l0.928 0C112.576 748.224 275.776 911.424 480 927.072L480 928c0 17.696 14.336 32 32 32s32-14.304 32-32l0-0.928C748.224 911.424 911.424 748.224 927.072 544L928 544c17.696 0 32-14.336 32-32S945.696 480 928 480zM544 863.072 544 800c0-17.696-14.336-32-32-32s-32 14.304-32 32l0 63.072C311.04 847.776 176.224 712.928 160.928 544L224 544c17.664 0 32-14.336 32-32s-14.336-32-32-32L160.928 480C176.224 311.04 311.04 176.224 480 160.928L480 224c0 17.664 14.336 32 32 32s32-14.336 32-32L544 160.928C712.928 176.224 847.776 311.04 863.072 480L800 480c-17.696 0-32 14.336-32 32s14.304 32 32 32l63.072 0C847.776 712.928 712.928 847.776 544 863.072z" fill="{{color}}" p-id="12962"></path></svg>',r=null!==(e=this.targetMarkerColor)&&void 0!==e?e:"#d4237a";s=s.replace("{{color}}",r),s=s.replace("{{color}}",r);let o=new UU({image:{src:s,width:null!==(t=this.targetMarkerSize)&&void 0!==t?t:32,height:null!==(i=this.targetMarkerSize)&&void 0!==i?i:32}});o.position.copy(this._target),o.addTo(this.app),o.getElement().style.opacity=null!==(n=this.targetMarkerOpacity)&&void 0!==n?n:.5,this._targetMarker=o}},eN=function(){this._targetMarker&&(this._targetMarker.remove(),delete this._targetMarker)},tN=function(e,t){const i=e=>e*e*e*(e*(6*e-15)+10),n=[],s=[];for(let t=0;t<e;t++)s[t]=2*Math.random()-1;for(let r=0;r<t;r++){const o=(e-1)/(t-1)*r,a=0|o,l=a+1|0,h=o-a,c=s[a]*h,d=(s[l]||s[a])*(h-1);n.push(c*(1-i(h))+d*i(h))}return n};class RN extends Fw{constructor(e,t){super(e),IN.set(this,void 0),this.options=t||{},this.appRenderIndex=gy.StartMost,Zv(this,IN,bg(!0),"f"),!1!==this.options.enable&&BN.install()}get cameraControl(){return this.app.data.cameraControl}get enableCameraControlRef(){return qv(this,IN,"f")}get enableCameraControl(){return qv(this,IN,"f").value}set enableCameraControl(e){qv(this,IN,"f").value=e}get enableWheelWhenCtrlDisabled(){var e;return null===(e=this.app.data.cameraControl)||void 0===e?void 0:e.enableWheelWhenCtrlDisabled}set enableWheelWhenCtrlDisabled(e){this.app.data.cameraControl&&(this.app.data.cameraControl.enableWheelWhenCtrlDisabled=e)}onAwake(){const e=this.app;this.applyMixinsTo(e),!1!==this.options.enable&&this.effectScope((()=>{Jg((()=>{if(!e.camera||!e.domElement)return;if(e.camera,e.data.cameraControl)return void(e.data.cameraControl.camera=e.camera);const t=new BN(e,e.domElement,!1!==this.options.eventFromInputModule);for(let e in this.options)e in t&&(t[e]=this.options[e]);if(!0===this.options.leftButtonPan&&([t.mouseButtons.left,t.mouseButtons.right]=[t.mouseButtons.right,t.mouseButtons.left]),this.options.target){let e=Vv(this.options.target);t.setTarget(e.x,e.y,e.z)}e.data.cameraControl=t,this.options.initState&&t.loadState(this.options.initState,this.options.initState.enableTransition)})),ev(qv(this,IN,"f"),(e=>{this.app.data.cameraControl&&(this.app.data.cameraControl.enabled=e)}))}))}onAppRender(e){var t;!1!==this.options.enable&&this.app.cameraControl&&!0!==(null===(t=this.options)||void 0===t?void 0:t.disableUpdate)&&(this.app.needRenderUpdate=this.app.cameraControl.update(e.deltaTime))}setupUiConfig(){if(!this.cameraControl)return{type:"folder",expanded:!1,label:RN.moduleName,children:[]};const e=(e,t)=>({type:"dropdown",label:e,property:[this.cameraControl.mouseButtons,t],children:[["NONE",0],["ROTATE",1],["TRUCK",2],["OFFSET",4],["DOLLY",8],["ZOOM",16]].map((e=>({label:e[0],value:e[1]})))}),t=(e,t)=>({type:"dropdown",label:e,property:[this.cameraControl.touches,t],children:[["NONE",0],["TOUCH_ROTATE",32],["TOUCH_TRUCK",64],["TOUCH_OFFSET",128],["TOUCH_DOLLY",256],["TOUCH_ZOOM",512],["TOUCH_DOLLY_TRUCK",1024],["TOUCH_DOLLY_OFFSET",2048],["TOUCH_DOLLY_ROTATE",4096],["TOUCH_ZOOM_TRUCK",8192],["TOUCH_ZOOM_OFFSET",16384],["TOUCH_ZOOM_ROTATE",32768]].map((e=>({label:e[0],value:e[1]})))});let i=[];return{type:"folder",expanded:!1,label:RN.moduleName,children:[{type:"checkbox",label:"启用",property:[this,"enableCameraControl"]},{type:"button",label:"保存当前状态",onClick:()=>{var e,t;let n=this.cameraControl.saveState();i.push(n),null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,!1,void 0,1);let s=`\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcameraTarget: new Vector3(${n.cameraTarget.x},${n.cameraTarget.y}, ${n.cameraTarget.z}),\n\t\t\t\t\t\t\tcameraPosition: new Vector3(${n.cameraPosition.x},${n.cameraPosition.y}, ${n.cameraPosition.z}),\n\t\t\t\t\t\t\tcameraZoom: ${n.cameraZoom},\n\t\t\t\t\t\t\tcameraUp: new Vector3(${n.cameraUp.x},${n.cameraUp.y}, ${n.cameraUp.z}),\n\t\t\t\t\t\t\tcameraFocalOffset: new Vector3(${n.cameraFocalOffset.x},${n.cameraFocalOffset.y}, ${n.cameraFocalOffset.z})\n\t\t\t\t\t\t}\n\t\t\t\t\t\t`;console.log(s)}},()=>[{type:"dropdown",label:"相机控件状态",property:[{value:-1},"value"],children:[()=>{let e=[{label:"",value:-1}];for(let t=0;t<i.length;t++)e.push({label:"state"+(t+1),value:t});return e}],onChange:e=>{e.value>=0&&e.value<i.length&&this.cameraControl.loadState(i[e.value])}}],{type:"checkbox",label:"禁止时允许滚轮事件",property:[this,"enableWheelWhenCtrlDisabled"]},{type:"checkbox",label:"双击定位到中心点",property:[this.cameraControl,"dblClickSetToCenter"]},{type:"checkbox",label:"双击定位增加调试点",property:[this.cameraControl,"dblClickAddDebugMarker"]},{type:"checkbox",label:"事件来源于输入模块",getValue:()=>!1!==this.options.eventFromInputModule,readOnly:!0},{type:"checkbox",label:"disableUpdate",property:[this.options,"disableUpdate"]},{type:"checkbox",label:"active",getValue:()=>!!this.cameraControl.active,readOnly:!0},{type:"input",label:"action",getValue:()=>this.cameraControl.currentAction+"",readOnly:!0},()=>e("鼠标左键","left"),()=>e("鼠标中键","middle"),()=>e("鼠标右键","right"),()=>e("鼠标滚轮","wheel"),()=>t("触摸单指","one"),()=>t("触摸双指","two"),()=>t("触摸三指","three"),{type:"number",label:"distance",getValue:()=>this.cameraControl.distance,readOnly:!0},{type:"button",label:"刷新数据",value:()=>{var e;null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!0,void 0,1)}},{type:"number",label:"setDistance",property:[this.cameraControl,"distance"]},{type:"slider",label:"azimuthAngle",property:[this.cameraControl,"azimuthAngle"],bounds:[0,2*Math.PI],stepSize:.001},{type:"slider",label:"polarAngle",property:[this.cameraControl,"polarAngle"],bounds:[0,2*Math.PI],stepSize:.001},{type:"checkbox",label:"boundaryEnclosesCamera",property:[this.cameraControl,"boundaryEnclosesCamera"]},...$T(this.cameraControl,[{prop:"minPolarAngle",value:0},{prop:"maxPolarAngle",value:Math.PI},{prop:"minAzimuthAngle",value:0},{prop:"maxAzimuthAngle",value:Math.PI/2},{prop:"minDistance",value:1e-5},{prop:"maxDistance",value:1e7},{prop:"infinityDolly",value:!0},{prop:"minZoom",value:.01},{prop:"maxZoom",value:1e7},{prop:"smoothTime",value:.25},{prop:"draggingSmoothTime",value:.125},{prop:"maxSpeed",value:1e7},{prop:"azimuthRotateSpeed",value:1},{prop:"polarRotateSpeed",value:1},{prop:"dollySpeed",value:1},{prop:"dollyDragInverted",value:!1},{prop:"truckSpeed",value:2},{prop:"dollyToCursor",value:!1},{prop:"dragToOffset",value:!1},{prop:"verticalDragToForward",value:!0},{prop:"boundaryFriction",value:0},{prop:"restThreshold",value:.01},{prop:"unProjectUseDepth",value:!0},{prop:"zoomShowTargetMarker",label:"缩放时显示图标",value:!0},{prop:"rotateShowTargetMarker",label:"旋转时显示图标",value:!0},{prop:"targetMarkerColor",label:"缩放旋转时图标颜色",value:"#d4237a"},{prop:"targetMarkerSize",label:"缩放旋转时图标大小 ",value:32},{prop:"targetMarkerOpacity",label:"缩放旋转时图标透明度 ",value:.5,bounds:[0,1]},{type:"button",label:"旋转方位角 10度",onClick:()=>{this.cameraControl.rotate(10*o.DEG2RAD,0,!0)}},{type:"button",label:"旋转方位角 -10度",onClick:()=>{this.cameraControl.rotate(-10*o.DEG2RAD,0,!0)}},{type:"button",label:"旋转极角 10度",onClick:()=>{this.cameraControl.rotate(0,10*o.DEG2RAD,!0)}},{type:"button",label:"旋转极角 -10度",onClick:()=>{this.cameraControl.rotate(0,-10*o.DEG2RAD,!0)}},{type:"button",label:"平移( 1, 0 )",onClick:()=>{this.cameraControl.pan(1,0,!0)}},{type:"button",label:"平移( 0, 1 )",onClick:()=>{this.cameraControl.pan(0,1,!0)}},{type:"button",label:"平移( -1, -1 )",onClick:()=>{this.cameraControl.pan(-1,-1,!0)}},{type:"button",label:"缩放  1",onClick:()=>{this.cameraControl.dolly(1,!0)}},{type:"button",label:"缩小  1",onClick:()=>{this.cameraControl.dolly(-1,!0)}},{type:"button",label:"放大一级",onClick:()=>{this.cameraControl.zoom(this.cameraControl.camera.zoom/2,!0)}},{type:"button",label:"缩小大一级",onClick:()=>{this.cameraControl.zoom(-this.cameraControl.camera.zoom/2,!0)}},{type:"button",label:"重置",onClick:()=>{this.cameraControl.reset(!0)}}])]}}}IN=new WeakMap,RN.moduleName="OrbitControlModule";var kN,LN={exports:{}};LN.exports=(kN=function(){function e(e){return n.appendChild(e.dom),e}function t(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";i=e}var i=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(e){e.preventDefault(),t(++i%n.children.length)}),!1);var s=(performance||Date).now(),r=s,o=0,a=e(new kN.Panel("FPS","#0ff","#002")),l=e(new kN.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=e(new kN.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:n,addPanel:e,showPanel:t,begin:function(){s=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(l.update(e-s,200),e>r+1e3&&(a.update(1e3*o/(e-r),100),r=e,o=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:n,setMode:t}},kN.Panel=function(e,t,i){var n=1/0,s=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,h=3*o,c=2*o,d=3*o,u=15*o,p=74*o,f=30*o,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,a,l),g.fillStyle=t,g.fillText(e,h,c),g.fillRect(d,u,p,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d,u,p,f),{dom:m,update:function(l,v){n=Math.min(n,l),s=Math.max(s,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,a,u),g.fillStyle=t,g.fillText(r(l)+" "+e+" ("+r(n)+"-"+r(s)+")",h,c),g.drawImage(m,d+o,u,p-o,f,d,u,p-o,f),g.fillRect(d+p-o,u,o,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d+p-o,u,o,r((1-l/v)*f))}}},kN);var zN,UN,FN,NN,jN,VN,HN,WN,GN,YN,XN,QN,qN,ZN,KN,JN,$N,ej,tj,ij,nj,sj,rj,oj,aj,lj,hj,cj,dj,uj,pj,fj,mj,gj,vj,yj,xj,wj,bj,_j,Sj,Mj,Cj,Aj,Ej,Tj,Pj,Oj,Dj,Bj,Ij,Rj,kj,Lj,zj,Uj,Fj,Nj,jj,Vj,Hj,Wj,Gj,Yj,Xj,Qj,qj,Zj,Kj,Jj,$j,eV,tV,iV=sv(LN.exports);class nV extends Fw{constructor(e,t){super(e),this.options=t||{},this.appBeforeUpdateIndex=gy.StartMost,this.appAfterRenderIndex=gy.EndMost}get showStat(){return this.app.data.showStat}set showStat(e){this.app.data.showStat=e}onAwake(){const e=this.app;e.data.showStat=this.options.show,this.applyMixinsTo(e,["showStat"]),this.effectScope((()=>{Jg((()=>{var t,i,n,s;e.container&&(e.data.showStat?(this._stats||(this._stats=new iV,this._stats.dom.id=null!==(t=this.options.id)&&void 0!==t?t:"stats-js",this._stats.dom.style.position="absolute",this._stats.dom.style.left=null!==(i=this.options.left)&&void 0!==i?i:"unset",this._stats.dom.style.right=null!==(n=this.options.right)&&void 0!==n?n:"0",this._stats.dom.style.width="80px",this._stats.dom.style.height="48px",this.options.top&&(this._stats.dom.style.top=this.options.top),this.options.bottom&&(this._stats.dom.style.bottom=this.options.bottom)),e.container.appendChild(this._stats.dom),this._stats.showPanel(null!==(s=this.options.panelIndex)&&void 0!==s?s:0)):this._stats&&(e.container.removeChild(this._stats.dom),this._stats=null))}))})),this.addDispose((()=>{this._stats&&(e.container.removeChild(this._stats.dom),this._stats=null)}))}onAppBeforeUpdate(){this.app&&this._stats&&this.app.data.showStat&&this._stats.begin()}onAppAfterRender(){this.app&&this._stats&&this.app.data.showStat&&this._stats.end()}setupUiConfig(){return{type:"folder",expanded:!1,label:nV.moduleName,children:[{type:"checkbox",label:"启用",property:[this,"showStat"]}]}}}nV.moduleName="StatModule";class sV extends Fw{constructor(e,t){var i,n;if(super(e),zN.add(this),this._isFirstRender=!0,this._passes=[],UN.set(this,new Map),FN.set(this,0),NN.set(this,[]),jN.set(this,[]),VN.set(this,[]),this.signal={beforeAddComposer:new cy,afterAddComposer:new cy,beforeAddRenderPass:new cy,afterAddRenderPass:new cy,beforeRemoveComposer:new cy,afterRemoveComposer:new cy,beforeRemoveRenderPass:new cy,afterRemoveRenderPass:new cy,beforRenderComposer:new cy,afterRenderComposer:new cy,beforRebuild:new cy,afterRebuild:new cy},this.options=t||{},!1===this.options.enable)return;this.options.disableDepthPickTime=null!==(i=this.options.disableDepthPickTime)&&void 0!==i?i:3,this.effectScope((()=>{Jg((()=>{var t;if(!e.renderer)return;const i=new s(0);let n=0;e.renderer.getClearColor(i),n=e.renderer.getClearAlpha(),this._oldClearColor=i,this._oldClearAlpha=n,e.renderer.setClearColor(i.convertSRGBToLinear(),n),this._isFirstRender=!0,this._composer&&(this._composer.removeAllPasses(),this._composer.dispose());let r=null!==(t=this.options.renderTargetOptions)&&void 0!==t?t:{};!1!==r.stencilBuffer&&(r.stencilBuffer=!0),r.frameBufferType||(r.frameBufferType=Z),this._composer=new SX(this.app.renderer,Object.assign({multisampling:Math.min(4,this.app.renderer.capabilities.maxSamples)},r))})),Jg((()=>{const{width:t,height:i}=e.containerSize;e.composer&&e.composer.setSize(t,i),this.data._effectFXAAPass&&this.data._effectFXAAPass.uniforms.resolution.value.set(1/t,i)})),ev((()=>e.scene),(()=>{let t=e.scene,i=this.composer?this.composer.passes:[];for(let e=0;e<i.length;e++){let n=i[e];if(n&&"mainScene"in n&&(n.mainScene=t),n.effects&&n.effects.length>0)for(let e=0;e<n.effects.length;e++){let i=n.effects[e];i&&"mainScene"in i&&(i.mainScene=t)}}})),ev((()=>e.camera),(()=>{let t=e.camera,i=this.composer?this.composer.passes:[];for(let e=0;e<i.length;e++){let n=i[e];if(n&&"mainCamera"in n&&(n.mainCamera=t),n.effects&&n.effects.length>0)for(let e=0;e<n.effects.length;e++){let i=n.effects[e];i&&"mainCamera"in i&&(i.mainCamera=t)}}}))}));const r=(e,t)=>{e.forEach((e=>{const i=e.children;(e.isMesh||e.isSprite)&&(t.has(e)||!0!==e.userData.disableSelected&&t.add(e));for(let e=0,n=i.length;e<n;e++)r([i[e]],t)}))},o=(e,t)=>{e.forEach((e=>{const i=e.children;(e.isMesh||e.isSprite)&&(t.has(e)||!0!==e.userData.disableOutline&&t.add(e));for(let e=0,n=i.length;e<n;e++)o([i[e]],t)}))},a=(e,t)=>{var i,n,s,a,l,h;if(Zv(this,jN,e,"f"),!this.selectedEffect){if(!1===this.options.autoAddSelectedPass)return;qv(this,zN,"m",HN).call(this)}if(!this.outlineEffect){if(!1===this.options.autoAddOutlinePass)return;qv(this,zN,"m",WN).call(this)}let c=new Set,d=e.filter((e=>Tk(e)==this.app.scene));r(d,c),this.selectedEffect.selection.set(c);let u=new Set;Zv(this,VN,t,"f"),o(t.filter((e=>Tk(e)==this.app.scene)),u);for(let e of u)c.has(e)&&u.delete(e);if(this.outlineEffect.selection.set(u),!1!==this.options.disableSelectedPassWhenIdle&&this.data._selectedPass){let e=null!==(s=null===(n=null===(i=this.selectedEffect)||void 0===i?void 0:i.selection)||void 0===n?void 0:n.size)&&void 0!==s?s:0;this.setEffectRenderPassEnable(this.data._selectedPass,e>0)}if(!1!==this.options.disableOutlinePassWhenIdle&&this.data._outlinePass){let e=null!==(h=null===(l=null===(a=this.outlineEffect)||void 0===a?void 0:a.selection)||void 0===l?void 0:l.size)&&void 0!==h?h:0;this.setEffectRenderPassEnable(this.data._outlinePass,e>0)}},l=(e,t)=>{a(e,t)};this.app.signal.onSelectedChange.add(l);const h=(e,t)=>{a(t,e)};this.app.signal.onOutlineChange.add(h);const c=(e,t)=>{e.forEach((e=>{const i=e.children;(e.isMesh||e.isSprite||e.isLine)&&(t.has(e)||!0!==e.userData.disableBloom&&t.add(e));for(let e=0,n=i.length;e<n;e++)c([i[e]],t)}))},d=e=>{if(Zv(this,NN,e,"f"),!this.bloomEffect){if(!1===this.options.autoAddBloomPass)return;qv(this,zN,"m",GN).call(this)}let t=new Set,i=e.filter((e=>Tk(e)==this.app.scene));c(i,t),this.bloomEffect.selection.set(Array.from(t)),!1!==this.options.disableBloomPassWhenIdle&&(t.size>0?this.data&&this.setEffectRenderPassEnable(this.data._bloomPass,!0):this.data&&this.setEffectRenderPassEnable(this.data._bloomPass,!1))};let u;this.app.signal.onBloomedChange.add(d),this.data._onBloomChange=d,this.options.disableDepthPickTime>0&&(u=setInterval((()=>{this.app.time.elapsedTime-qv(this,FN,"f")>this.options.disableDepthPickTime&&this.depthPickingPass&&this.depthPickingPass.enabled&&this.setEffectRenderPassEnable(this.depthPickingPass,!1)}),1e3*this.options.disableDepthPickTime)),AX.workaroundEnabled=null===(n=null==t?void 0:t.workaroundEnabled)||void 0===n||n,this.addDispose((()=>{this.app&&!1!==this.options.enable&&(this.app.signal.onSelectedChange.remove(l),this.app.signal.onBloomedChange.remove(d),this.app.signal.onOutlineChange.remove(h),u&&clearInterval(u),void 0!==this._oldClearColor&&this.app.renderer.setClearColor(this._oldClearColor,this._oldClearAlpha))})),this.addDispose(this.app.signal.onActiveScene.add((e=>{l(qv(this,jN,"f"),qv(this,VN,"f")),d(qv(this,NN,"f")),h(qv(this,VN,"f"),qv(this,jN,"f"))}))),this.addDispose(this.app.signal.onCameraChange.add((e=>{this.depthPickingPass&&this.app.renderer.capabilities.logarithmicDepthBuffer&&this.depthPickingPass.setCamera(this.app.camera)})))}get composer(){return this._composer}addEffectRenderPass(e,t){var i;if(!this.composer)return;50100!=(t=null!=t?t:0)&&this.signal.beforeAddRenderPass.dispatch(e,t,this);let n,s=null!==(i=this._passes)&&void 0!==i?i:[];for(n=0;n<s.length&&!((s[n]._sortIndex_||0)>t);n++);e._sortIndex_=t,void 0!==n?this._passes.splice(n,0,e):this._passes.push(e),this.refreshEffectRenderPass(!0),50100!=t&&this.signal.afterAddRenderPass.dispatch(e,t,this)}setEffectRenderPassOrder(e,t){this.composer&&(e._sortIndex_=t,this.refreshEffectRenderPass(!0))}removeEffectRenderPass(e){let t=this.composer;t&&(this.signal.beforeRemoveRenderPass.dispatch(e,this),t.removePass(e),e==this.data._selectedPass&&t==this.composer&&(delete this.data._selectedPass,delete this.data._selectedEffect),e==this.data._bloomPass&&t==this.composer&&(delete this.data._bloomPass,delete this.data._bloomEffect),e==this.data._outlinePass&&t==this.composer&&(delete this.data._outlinePass,delete this.data._outlineEffect),e.dispose(),this.signal.afterRemoveRenderPass.dispatch(e,this))}setEffectRenderPassEnable(e,t){e&&(e.enabled=t,this.refreshEffectRenderPass(!1))}isComposerEnable(){return!(!1===this.options.enable)}setComposerEnable(e){this.options.enable=e}onAwake(){this.applyMixinsTo(this.app)}get outlineEffect(){return this.data._outlineEffect}get bloomEffect(){return this.data._bloomEffect}get selectedEffect(){return this.data._selectedEffect}getDepth(e,t){var i,n;return Qv(this,void 0,void 0,(function*(){if(!this.options.enable)return;if(!0===this.options.disableDepthPickWhenlogDepthBuffer&&(null===(i=this.app.renderer)||void 0===i?void 0:i.capabilities.logarithmicDepthBuffer))return;qv(this,zN,"m",YN).call(this),this.depthPickingPass.enabled||this.setEffectRenderPassEnable(this.depthPickingPass,!0);let s=this.app.screenToNdc(e,t),r=yield this.depthPickingPass.readDepth(s);return Zv(this,FN,this.app.time.elapsedTime,"f"),Tv(r,1,1e-6)||Tv(r,0,1e-6)?void 0:(r=2*r-1,r<(null!==(n=this.options.depthPickMinZ)&&void 0!==n?n:0)?void 0:r)}))}refreshEffectRenderPass(e){if(e){this.composer.passes=[],this._passes.sort(((e,t)=>e._sortIndex_-t._sortIndex));let e=[];const t=()=>{if(e.length>0){let t=new pX(this.app.camera,...e);this.composer.addPass(t),e.forEach((e=>{var t;return null!==(t=e.uuid)&&void 0!==t?t:e.uuid=uv()})),t._allEffects=[...e]}e=[]};for(let i=0;i<this._passes.length;i++){let n=this._passes[i];"EffectPass"!=n.name||n.disableMergeEffect||this.options.disableMergeEffect?(t(),this.composer.addPass(n)):(e.push(...n.effects),n.effects.forEach((e=>e._owerPass=n)))}t()}let t,i,n=this.composer.passes,s=!1;this.data._copyPass&&(t=this.data._copyPass,t.enabled=!1);for(let e=n.length-1;e>=0;e--)if(n[e]!=t&&"EffectPass"==n[e].name&&!n[e].disableMergeEffect&&!this.options.disableMergeEffect){let t=n[e]._allEffects.filter((e=>e._owerPass.enabled))||[];if(n[e].enabled=0!=t.length,n[e].enabled){let i=n[e].effects,s=i.length==t.length;if(s)for(let e=0;e<i.length;e++)if(i[e]!==t[e]){s=!1;break}if(!s)if(!0===this.options.disableCacheEffectPass)n[e].setEffects(t),n[e].recompile();else{let i=t.map((e=>e.uuid)).join("_");if(qv(this,UN,"f").has(i))n[e]=qv(this,UN,"f").get(i),n[e]._MainCameraUuid!==this.app.camera.uuid&&(n[e].mainCamera=this.app.camera,n[e]._MainCameraUuid=this.app.camera.uuid),n[e]._MainSceneUuid!==this.app.scene.uuid&&(n[e].mainScene=this.app.scene,n[e]._MainSceneUuid=this.app.scene.uuid);else{let s=n[e]._allEffects,r=new pX(this.app.camera,...t);r._MainSceneUuid=this.app.scene.uuid,r._MainCameraUuid=this.app.camera.uuid,this.composer.addPass(r),n[e]=r,this.composer.passes.length=this.composer.passes.length-1,n[e]._allEffects=s,qv(this,UN,"f").set(i,n[e])}}}}for(let e=n.length-1;e>=0;e--)n[e]!=t&&(!s&&n[e].enabled?(s=!0,n[e].renderToScreen=!0,i=n[e]):n[e].renderToScreen=!1);t&&i&&(i.disableRenderToScreen||i==this.data._renderPass)&&(i.renderToScreen=!1,t.enabled=!0,t.renderToScreen=!0)}onAppRender(e){const t=this.app;t.composer&&t.scene&&t.camera&&!1!==this.options.enable&&(qv(this,zN,"m",XN).call(this),!1!==this.options.renderUpdate&&(this.signal.beforRenderComposer.dispatch(this.composer,this),t.scene.matrixWorldAutoUpdate=!1,t.scene.updateMatrixWorld(),this.composer.render(e.deltaTime),this.signal.afterRenderComposer.dispatch(this.composer,this)))}addKawaseBlurPass(){const e=new fX({height:480});this.addEffectRenderPass(e,1e3)}addToneMappingEffect(){const e=new eQ({mode:IY.REINHARD2_ADAPTIVE,resolution:256,whitePoint:16,middleGrey:.6,minLuminance:.01,averageLuminance:.01,adaptationRate:1});this.addEffectRenderPass(new pX(this.app.camera,e),1200)}addColorDepthEffect(){const e=new RX({bits:21});let t=new pX(this.app.camera,e);this.addEffectRenderPass(t,1200)}addDepthOfFieldEffect(){const e=new LX(this.app.camera,{kernelSize:OY.SMALL,worldFocusDistance:2,worldFocusRange:5,bokehScale:3,resolutionScale:.75});let t=new pX(this.app.camera,e);this.addEffectRenderPass(t,1400)}addGlitchEffect(){const e=new kX,t=new VX({perturbationMap:iL.loadTexture(iL.svrUrl("textures/perturb.jpg")),chromaticAberrationOffset:e.offset});this.addEffectRenderPass(new pX(this.app.camera,t),1600),this.addEffectRenderPass(new pX(this.app.camera,e),1800)}addPixelationEffect(){const e=new XX(5);this.addEffectRenderPass(new pX(this.app.camera,e),2e3)}addSSAOEffect(){const e=new xX(this.app.scene,this.app.camera),t=new JX(this.app.camera,e.texture,{worldDistanceThreshold:20,worldDistanceFalloff:5,worldProximityThreshold:.4,worldProximityFalloff:.1,luminanceInfluence:.7,samples:16,radius:.04,intensity:1,resolutionScale:.5});this.addEffectRenderPass(e,2200),this.addEffectRenderPass(new pX(this.app.camera,t),2400)}setupUiConfig(){return{type:"folder",expanded:!1,label:sV.moduleName,children:[{type:"checkbox",label:"启用",property:[this.options,"enable"]},()=>{var e;let t=null!==(e=this._passes)&&void 0!==e?e:[],i=[];for(let e=0;e<t.length;e++){let n=t[e];if(50101==n._sortIndex_)continue;let s={type:"folder",expanded:!1,label:n.name+(n.effects&&n.effects.length>0?" - "+n.effects[0].name:""),children:[{type:"checkbox",label:"启用",property:[n,"enabled"],onChange:e=>this.refreshEffectRenderPass(!1)},{type:"checkbox",label:"不允许合并通道",getValue:()=>n.disableMergeEffect||!1,setValue:e=>{var t;n.disableMergeEffect=e,this.refreshEffectRenderPass(!0),null===(t=this.uiConfig)||void 0===t||t.uiRefresh(!1)}},{type:"number",label:"渲染次序",getValue:()=>n._sortIndex_||0,setValue:e=>this.setEffectRenderPassOrder(n,e)},()=>qv(this,zN,"m",rj).call(this,n),()=>{var e;if(!n.effects)return;let t=null!==(e=n.effects)&&void 0!==e?e:[],i=[];for(let e=0;e<t.length;e++){let s=t[e],r={type:"folder",expanded:!0,label:s.name,children:[()=>qv(this,zN,"m",sj).call(this,s,n)]};i.push(r)}return i}]};i.push(s)}return i},{type:"button",label:"增加 blur 后期处理通道",hidden:()=>!this.composer||!!this.composer.passes.find((e=>"KawaseBlurPass"==e.name)),onClick:()=>{var e;this.addKawaseBlurPass(),null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!1)}},{type:"button",label:"增加 ToneMapping 后期处理通道",hidden:()=>!this.composer||this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"ToneMappingEffect"==e.name)))),onClick:()=>{var e;this.addToneMappingEffect(),null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!1)}},{type:"button",label:"增加 FXAA 抗锯齿后期处理通道",hidden:()=>!this.composer||this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"FXAAEffect"==e.name)))),onClick:()=>{var e;let t=this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"SMAAEffect"==e.name))));t&&this.removeEffectRenderPass(t);const i=new UX({blendFunction:CY.NORMAL});let n=new pX(this.app.camera,i);this.addEffectRenderPass(n,200),null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!1)}},{type:"button",label:"增加 SMAA 抗锯齿后期处理通道",hidden:()=>!this.composer||this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"SMAAEffect"==e.name)))),onClick:()=>{var e;let t=this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"FXAAEffect"==e.name))));t&&this.removeEffectRenderPass(t);const i=new KX({preset:BY.MEDIUM,edgeDetectionMode:AY.COLOR,predicationMode:DY.DEPTH});let n=new pX(this.app.camera,i);this.addEffectRenderPass(n,100),null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!1)}},{type:"button",label:"增加 color-depth 处理通道",hidden:()=>!this.composer||this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"ColorDepthEffect"==e.name)))),onClick:()=>{var e;this.addColorDepthEffect(),null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!1)}},{type:"button",label:"增加 Depth Of Field 处理通道",hidden:()=>!this.composer||this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"DepthOfFieldEffect"==e.name)))),onClick:()=>{var e;this.addDepthOfFieldEffect(),null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!1)}},{type:"button",label:"增加 glitch 处理通道",hidden:()=>!this.composer||this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"DepthOfFieldEffect"==e.name)))),onClick:()=>{var e;this.addGlitchEffect(),null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!1)}},{type:"button",label:"增加 Pixelation 处理通道",hidden:()=>!this.composer||this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"PixelationEffect"==e.name)))),onClick:()=>{var e;this.addPixelationEffect(),null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!1)}},{type:"button",label:"增加 SSAO 处理通道",hidden:()=>!this.composer||this.composer.passes.find((e=>e.effects&&e.effects.find((e=>"SSAOEffect"==e.name)))),onClick:()=>{var e;this.addSSAOEffect(),null===(e=this.uiConfig)||void 0===e||e.uiRefresh(!1)}}]}}}UN=new WeakMap,FN=new WeakMap,NN=new WeakMap,jN=new WeakMap,VN=new WeakMap,zN=new WeakSet,HN=function(){var e,t,i,n,s;if(this.data._selectedEffect)return;const r=new YX(this.app.scene,this.app.camera,Object.assign({blendFunction:CY.SCREEN,multisampling:Math.min(4,this.app.renderer.capabilities.maxSamples),edgeStrength:null!==(t=null===(e=this.options.selectedPass)||void 0===e?void 0:e.edgeStrength)&&void 0!==t?t:4,pulseSpeed:.4,visibleEdgeColor:16776960,hiddenEdgeColor:11559754,height:480,blur:!1,xRay:!0},this.options.selectedPass));let o=null!==(n=null===(i=this.options.selectedPass)||void 0===i?void 0:i.blurriness)&&void 0!==n?n:0;o&&(r.blurPass.enabled=o>0,r.blurPass.blurMaterial.kernelSize=o-1),r.selection.layer=14,this.data._selectedEffect=r,this.data._selectedPass||(this.data._selectedPass=new pX(this.app.camera,r),!0===(null===(s=this.options.selectedPass)||void 0===s?void 0:s.disableMergeEffect)&&(this.data._selectedPass.disableMergeEffect=!0),this.addEffectRenderPass(this.data._selectedPass,500))},WN=function(){var e,t,i,n,s;if(this.data._outlineEffect)return;const r=new YX(this.app.scene,this.app.camera,Object.assign({blendFunction:CY.SCREEN,multisampling:Math.min(4,this.app.renderer.capabilities.maxSamples),edgeStrength:null!==(t=null===(e=this.options.outlinePass)||void 0===e?void 0:e.edgeStrength)&&void 0!==t?t:6,pulseSpeed:.4,visibleEdgeColor:65535,hiddenEdgeColor:6507184,height:480,blur:!1,xRay:!0},this.options.outlinePass));let o=null!==(n=null===(i=this.options.outlinePass)||void 0===i?void 0:i.blurriness)&&void 0!==n?n:4;o&&(r.blurPass.enabled=o>0,r.blurPass.blurMaterial.kernelSize=o-1),r.selection.layer=15,this.data._outlineEffect=r,this.data._outlinePass||(this.data._outlinePass=new pX(this.app.camera,r),!0===(null===(s=this.options.outlinePass)||void 0===s?void 0:s.disableMergeEffect)&&(this.data._outlinePass.disableMergeEffect=!0),this.addEffectRenderPass(this.data._outlinePass,501))},GN=function(){var e,t,i,n;if(this.data._bloomEffect)return;let s=this.options.bloomPass;const r=new QX(this.app.scene,this.app.camera,Object.assign({luminanceThreshold:.01,luminanceSmoothing:.1,mipmapBlur:!0,intensity:6},s));s=s||{},r.luminancePass.enabled=null!==(e=s.luminancePassEnabled)&&void 0!==e&&e,r.ignoreBackground=null===(t=s.ignoreBackground)||void 0===t||t,r.inverted=null!==(i=s.inverted)&&void 0!==i&&i;const o=new pX(this.app.camera,r);this.data._bloomEffect=r,this.data._bloomPass=o,!1===(null===(n=this.options.bloomPass)||void 0===n?void 0:n.disableMergeEffect)?this.data._bloomPass.disableMergeEffect=!1:this.data._bloomPass.disableMergeEffect=!0,this.addEffectRenderPass(o,800)},YN=function(){this.depthPickingPass||(this.depthPickingPass=new cX,this.app.renderer.capabilities.logarithmicDepthBuffer&&this.depthPickingPass.setCamera(this.app.camera),this.depthPickingPass.disableRenderToScreen=!0,this.addEffectRenderPass(this.depthPickingPass,5))},XN=function(){if(this._isFirstRender){if(this._isFirstRender=!1,!1!==this.options.autoAddRenderPass){let e=new rX(this.app.scene,this.app.camera);this.data._renderPass=e,this.addEffectRenderPass(e,0)}if(!0===this.options.depthPickingPass&&qv(this,zN,"m",YN).call(this),this.options.useSMAA){const e=new KX({preset:BY.MEDIUM,edgeDetectionMode:AY.COLOR,predicationMode:DY.DEPTH});let t=new pX(this.app.camera,e);this.addEffectRenderPass(t,100)}if(this.options.useFXAA){const e=new UX({blendFunction:CY.NORMAL});let t=new pX(this.app.camera,e);this.addEffectRenderPass(t,200)}if(!0===this.options.autoAddOutlinePass&&qv(this,zN,"m",WN).call(this),!0===this.options.autoAddBloomPass&&qv(this,zN,"m",GN).call(this),!0===this.options.autoAddSelectedPass&&qv(this,zN,"m",HN).call(this),!1!==this.options.autoAddCopyPass){let e=new eX;e.enabled=!1,this.data._copyPass=e,this.addEffectRenderPass(e,1e5)}}},QN=function(e,t){const i=e.blendMode,n={intensity:e.intensity,radius:e.mipmapBlurPass.radius,luminance:{filter:e.luminancePass.enabled,threshold:e.luminanceMaterial.threshold,smoothing:e.luminanceMaterial.smoothing},selection:{inverted:e.inverted,"ignore bg":e.ignoreBackground},opacity:i.opacity.value,"blend mode":i.blendFunction};let s=new yP;s.add(n,"intensity",0,10,.01).onChange((t=>{e.intensity=Number(t)})),s.add(n,"radius",0,1,.001).onChange((t=>{e.mipmapBlurPass.radius=Number(t)}));let r=s.addFolder("Luminance");return r.add(n.luminance,"filter").onChange((t=>{e.luminancePass.enabled=t})),r.add(n.luminance,"threshold",0,1,.001).onChange((t=>{e.luminanceMaterial.threshold=Number(t)})),r.add(n.luminance,"smoothing",0,1,.001).onChange((t=>{e.luminanceMaterial.smoothing=Number(t)})),r.open(),r=s.addFolder("Selection"),r.add(n.selection,"inverted").onChange((t=>{e.inverted=t})),r.add(n.selection,"ignore bg").onChange((t=>{e.ignoreBackground=t})),r.open(),s.add(n,"opacity",0,1,.01).onChange((e=>{i.opacity.value=e})),s.add(n,"blend mode",CY).onChange((e=>{i.setBlendFunction(Number(e))})),s.add(t,"dithering").onChange((e=>{t.dithering=e})),s.toJson()},qN=function(e,t){let i=new yP;const n=e.uniforms,r=e.blendMode,o=new s,a={resolution:e.height,blurriness:0,"use pattern":!1,"pattern scale":60,"pulse speed":e.pulseSpeed,"edge strength":e.edgeStrength,"visible edge":o.copyLinearToSRGB(e.visibleEdgeColor).clone(),"hidden edge":o.copyLinearToSRGB(e.hiddenEdgeColor).clone(),"x-ray":!0,opacity:r.opacity.value,"blend mode":r.blendFunction};return i.add(a,"resolution",[240,360,480,720,1080]).onChange((t=>{e.resolution.height=Number(t)})),i.add(e,"multisampling",[0,2,4]),i.add(a,"blurriness",OY.VERY_SMALL,OY.HUGE+1,1).onChange((t=>{e.blurPass.enabled=t>0,e.blurPass.blurMaterial.kernelSize=t-1})),i.add(a,"use pattern").onChange((t=>Qv(this,void 0,void 0,(function*(){t?(e.patternTexture=iL.loadTexture(iL.svrUrl("textures/pattern_color.png")),n.get("patternScale").value=a["pattern scale"]):e.patternTexture=null})))),i.add(a,"pattern scale",20,100,.1).onChange((e=>{n.get("patternScale").value=e})),i.add(a,"edge strength",0,10,.01).onChange((e=>{n.get("edgeStrength").value=e})),i.add(a,"pulse speed",0,2,.01).onChange((t=>{e.pulseSpeed=t})),i.addColor(a,"visible edge").onChange((t=>{e.visibleEdgeColor.setHex(t).convertSRGBToLinear()})),i.addColor(a,"hidden edge").onChange((t=>{e.hiddenEdgeColor.setHex(t).convertSRGBToLinear()})),i.add(e,"xRay"),i.add(a,"opacity",0,1,.01).onChange((e=>{r.opacity.value=e})),i.add(a,"blend mode",CY).onChange((e=>{r.setBlendFunction(Number(e))})),i.toJson()},ZN=function(e,t){let i=new yP,n=e;const s={opacity:n.blendMode.opacity.value,"blend mode":n.blendMode.blendFunction};return i.add(s,"opacity",0,1,.01).onChange((e=>{n.blendMode.opacity.value=e})),i.add(s,"blend mode",CY).onChange((e=>{n.blendMode.setBlendFunction(Number(e))})),i.toJson()},KN=function(e,t){let i=new yP;return i.addBinding(e,"samples",{min:0,max:24,step:1}),i.addBinding(e,"minEdgeThreshold",{min:.01,max:.3,step:1e-4}),i.addBinding(e,"maxEdgeThreshold",{min:.01,max:.3,step:1e-4}),i.addBinding(e,"subpixelQuality",{min:0,max:1,step:1e-4}),i.addBinding(e.blendMode.opacity,"value",{label:"opacity",min:0,max:1,step:.01}),i.addBinding(e.blendMode,"blendFunction",{options:CY}),i.toJson()},JN=function(e,t){let i=new yP;const n=e.blendMode,s=e.adaptiveLuminancePass.fullscreenMaterial,r={mode:e.mode,exposure:this.app.renderer.toneMappingExposure,resolution:e.resolution,"white point":e.whitePoint,"middle grey":e.middleGrey,"average lum":e.averageLuminance,"min lum":s.minLuminance,"adaptation rate":s.adaptationRate,opacity:n.opacity.value,"blend mode":n.blendFunction};i.add(r,"mode",IY).onChange((t=>{e.mode=Number(t)})),i.add(r,"exposure",0,2,.001).onChange((e=>{this.app.renderer.toneMappingExposure=e}));let o=i.addFolder("Reinhard (Modified)");return o.add(r,"white point",2,32,.01).onChange((t=>{e.whitePoint=t})),o.add(r,"middle grey",0,1,1e-4).onChange((t=>{e.middleGrey=t})),o.add(r,"average lum",1e-4,1,1e-4).onChange((t=>{e.averageLuminance=t})),o.open(),o=i.addFolder("Reinhard (Adaptive)"),o.add(r,"resolution",[64,128,256,512]).onChange((t=>{e.resolution=Number(t)})),o.add(r,"adaptation rate",.001,3,.001).onChange((e=>{s.adaptationRate=e})),o.add(r,"min lum",.001,1,.001).onChange((e=>{s.uniforms.minLuminance.value=e})),o.open(),i.add(r,"opacity",0,1,.01).onChange((e=>{n.opacity.value=e})),i.add(r,"blend mode",CY).onChange((e=>{n.setBlendFunction(Number(e))})),i.toJson()},$N=function(e,t){let i=new yP;return i.addBinding(e,"bitDepth",{min:1,max:32,step:1}),i.addBinding(e.blendMode.opacity,"value",{label:"opacity",min:0,max:1,step:.01}),i.addBinding(e.blendMode,"blendFunction",{options:CY}),i.toJson()},ej=function(e,t){let i=new yP;const n=e.cocMaterial;return i.addBinding(e.resolution,"scale",{label:"resolution",min:.5,max:1,step:.05}),i.addBinding(e.blurPass,"kernelSize",{options:OY}),i.addBinding(n,"worldFocusDistance",{min:0,max:50,step:.1}),i.addBinding(n,"worldFocusRange",{min:0,max:20,step:.1}),i.addBinding(e,"bokehScale",{min:0,max:7,step:.01}),i.addBinding(e.blendMode.opacity,"value",{label:"opacity",min:0,max:1,step:.01}),i.addBinding(e.blendMode,"blendFunction",{options:CY}),i.toJson()},tj=function(e,t){let i=new yP;return i.addBinding(e,"mode",{options:PY}),i.addBinding(e,"minDelay",{min:0,max:2,step:.01}),i.addBinding(e,"maxDelay",{min:2,max:4,step:.01}),i.addBinding(e,"minDuration",{min:0,max:.6,step:.01}),i.addBinding(e,"maxDuration",{min:.6,max:1.8,step:.01}),i.addBinding(e,"minStrength",{min:0,max:1,step:.01}),i.addBinding(e,"maxStrength",{min:0,max:1,step:.01}),i.addBinding(e,"ratio",{min:0,max:1,step:.01}),i.addBinding(e,"columns",{min:0,max:.5,step:.01}),i.addBinding({"custom pattern":!0},"custom pattern").on("change",(t=>{e.perturbationMap=iL.loadTexture(iL.svrUrl("textures/perturb.jpg"))})),i.toJson()},ij=function(e,t){let i=new yP;return i.addBinding(e,"granularity",{min:0,max:20,step:1}),i.toJson()},nj=function(e,t){let i=new yP;const n=new s,r=e.ssaoMaterial;let o=i.addFolder({title:"Distance Cutoff",expanded:!1});return o.addBinding(r,"worldDistanceThreshold",{min:0,max:100,step:.1}),o.addBinding(r,"worldDistanceFalloff",{min:0,max:10,step:.1}),o=i.addFolder({title:"Proximity Cutoff",expanded:!1}),o.addBinding(r,"worldProximityThreshold",{min:0,max:3,step:.01}),o.addBinding(r,"worldProximityFalloff",{min:0,max:3,step:.01}),this.app.renderer.capabilities.isWebGL2&&i.addBinding(e,"depthAwareUpsampling"),i.addBinding(e.resolution,"scale",{label:"resolution",min:.25,max:1,step:.05}),i.addBinding(r,"samples",{min:1,max:32,step:1}),i.addBinding(r,"rings",{min:1,max:16,step:1}),i.addBinding(r,"radius",{min:1e-6,max:1,step:.01}),i.addBinding(r,"minRadiusScale",{min:0,max:1,step:.01}),i.addBinding(r,"bias",{min:0,max:.5,step:.001}),i.addBinding(r,"fade",{min:0,max:1,step:.001}),i.addBinding(e,"intensity",{min:0,max:4,step:.01}),i.addBinding(e,"luminanceInfluence",{min:0,max:1,step:.01}),i.addBinding({color:0},"color",{view:"color"}).on("change",(t=>e.color=0===t.value?null:n.setHex(t.value).convertSRGBToLinear())),i.addBinding(e.blendMode.opacity,"value",{label:"opacity",min:0,max:1,step:.01}),i.addBinding(e.blendMode,"blendFunction",{options:CY}),i.toJson()},sj=function(e,t){return"BloomEffect"==e.name?qv(this,zN,"m",QN).call(this,e,t):"OutlineEffect"==e.name?qv(this,zN,"m",qN).call(this,e,t):"SMAAEffect"==e.name?qv(this,zN,"m",ZN).call(this,e,t):"FXAAEffect"==e.name?qv(this,zN,"m",KN).call(this,e,t):"ToneMappingEffect"==e.name?qv(this,zN,"m",JN).call(this,e,t):"ColorDepthEffect"==e.name?qv(this,zN,"m",$N).call(this,e,t):"DepthOfFieldEffect"==e.name?qv(this,zN,"m",ej).call(this,e,t):"GlitchEffect"==e.name?qv(this,zN,"m",tj).call(this,e,t):"PixelationEffect"==e.name?qv(this,zN,"m",ij).call(this,e,t):"SSAOEffect"==e.name?qv(this,zN,"m",nj).call(this,e,t):void 0},rj=function(e){if("KawaseBlurPass"==e.name){let t=new yP;const i=e,n={resolution:i.resolution.height,"kernel size":i.getKernelSize(),scale:i.getScale()};return t.add(n,"resolution",[240,360,480,720,1080]).onChange((e=>{i.resolution.height=Number(e)})),t.add(n,"kernel size",OY).onChange((e=>{i.setKernelSize(Number(e))})),t.add(n,"scale",0,1,.01).onChange((e=>{i.setScale(Number(e))})),t.toJson()}},sV.moduleName="PostProcessModule",S.prototype.computeBoundsTree=qC,S.prototype.disposeBoundsTree=ZC,h.prototype.raycast=QC;class rV{constructor(e){this.wasIntersected=!1,this.target=e,this.intersected=!1,this.distance=0}}class oV extends Fw{constructor(e){super(e),oj.add(this),aj.set(this,new p),lj.set(this,new B)}getQueryRaycaster(){return qv(this,aj,"f")}onAwake(){const e=this.app;this.applyMixinsTo(e)}queryEntitiesByCamera(e){e=null!=e?e:{},qv(this,oj,"m",hj).call(this,e),qv(this,lj,"f").origin.copy(e.camera.position);let t=wW(this.app,e.camera);return qv(this,lj,"f").direction.copy(t),this.queryEntitiesByRaycast(qv(this,lj,"f"),e)}queryEntitiesByRaycast(e,t){t=null!=t?t:{},qv(this,oj,"m",hj).call(this,t),qv(this,aj,"f").ray.copy(e),qv(this,aj,"f").camera=t.camera;const i=(e,t)=>e.distance-t.distance,n=(e,t,i,s)=>{var r;if(e.layers.test(t.layers)){let n;if(e.userData.pointsThreshold)n=qv(this,aj,"f").params.Points.threshold,qv(this,aj,"f").params.Points.threshold=e.userData.pointsThreshold;else if("function"==typeof e.pointsThreshold){n=qv(this,aj,"f").params.Points.threshold;let t=e.pointsThreshold(n);t&&(qv(this,aj,"f").params.Points.threshold=t)}e.raycast(t,i),n&&(qv(this,aj,"f").params.Points.threshold=n)}if(!0===s){const s=e.children;for(let e=0,o=s.length;e<o;e++)!0!==(null===(r=s[e].userData)||void 0===r?void 0:r.disableRayQuery)&&n(s[e],t,i,!0)}};return qv(this,oj,"m",cj).call(this,t,(e=>((e,t,s=!0,r=[])=>{for(let i=0,o=t.length;i<o;i++)n(t[i],e,r,s);return r.sort(i),r})(qv(this,aj,"f"),[e.rayIntersectObject||e.node],!1!==e.rayIntersectRecursive)))}queryEntitiesByScreenPos(e,t,i){i=null!=i?i:{},qv(this,oj,"m",hj).call(this,i);const n=this.getRayByScreenPos(e,t,null==i?void 0:i.camera);return this.queryEntitiesByRaycast(n,i)}queryEntitiesByBox(e,t,n,s){n=null!=n?n:{},qv(this,oj,"m",hj).call(this,n);const r=this.app.container.getBoundingClientRect(),o=new i;o.set(e.x/r.width*2-1,-e.y/r.height*2+1,.5);const a=new i;a.set(t.x/r.width*2-1,-t.y/r.height*2+1,.5);const l=new fi;qv(this,oj,"m",dj).call(this,l,o,a,n.camera,s);let h=n.entities,c=[];(null==n?void 0:n.filter)&&(h=h.filter(null==n?void 0:n.filter));for(let e of h){let t,i=[];qv(this,oj,"m",uj).call(this,l,e.node,i,t),i.length>0&&c.push(e)}let d=[];for(let e of c){if(!e.visible)continue;let t=e.node;if(t.visible&&!0!==t.userData.disableRayQuery&&-1==t.type.indexOf("Helper")){let t=new rV(e);t.distance=0,t.intersection=null,t.intersected=!0,d.push(t)}}return d}getRayByScreenPos(e,t,i){i=null!=i?i:this.app.camera;const n=this.app.container.getBoundingClientRect(),s=new r;return s.x=(e-n.left)/n.width,s.y=(t-n.top)/n.height,s.x=2*s.x-1,s.y=1-2*s.y,qv(this,aj,"f").setFromCamera(s,i),qv(this,aj,"f").ray}}aj=new WeakMap,lj=new WeakMap,oj=new WeakSet,hj=function(e){var t,i,n,s,r,o,a,l;(e=null!=e?e:{}).entities=null!==(t=e.entities)&&void 0!==t?t:this.app.getRayQueryEntities(),e.camera=null!==(i=e.camera)&&void 0!==i?i:this.app.camera,null!==(n=(o=qv(this,aj,"f").params).Points)&&void 0!==n||(o.Points={}),qv(this,aj,"f").params.Points.threshold=3,null!==(s=(a=qv(this,aj,"f").params).Line)&&void 0!==s||(a.Line={}),qv(this,aj,"f").params.Line.threshold=4,null!==(r=(l=qv(this,aj,"f").params).Line2)&&void 0!==r||(l.Line2={}),qv(this,aj,"f").params.Line2.threshold=4,e.raycasterParameters&&(qv(this,aj,"f").params=Object.assign(Object.assign({},qv(this,aj,"f").params),e.raycasterParameters))},cj=function(e,t){var i;let n=e.entities;(null==e?void 0:e.filter)&&(n=n.filter(null==e?void 0:e.filter));let s=null,r=[];for(let e of n){if(!e.visible)continue;const n=null!==(i=t(e))&&void 0!==i?i:[];r.push(...n.map((t=>{let i=t.object;if(i.visible&&!0!==i.userData.disableRayQuery&&-1==i.type.indexOf("Helper")){let i=new rV(e);return i.distance=t.distance,i.intersection=t,i.intersected=!0,i}})))}if(r=r.filter((e=>!!e)),r.length>0){s=r[0];for(let e=1;e<r.length;e++)r[e].distance<s.distance&&(s=r[e])}return s},dj=function(e,t,n,s,r){r=null!=r?r:Number.MAX_VALUE,t.x===n.x&&(n.x+=Number.EPSILON),t.y===n.y&&(n.y+=Number.EPSILON),s=this.app.camera,new i;const o=new i,a=new i,l=new i,h=new i,c=new i,d=new i,u=new i,p=new i,f=new i,m=new i,g=new i,v=new i,y=new i;if("updateProjectionMatrix"in s&&s.updateProjectionMatrix(),s.updateMatrixWorld(),s.isPerspectiveCamera){o.copy(t),o.x=Math.min(t.x,n.x),o.y=Math.max(t.y,n.y),n.x=Math.max(t.x,n.x),n.y=Math.min(t.y,n.y),a.setFromMatrixPosition(s.matrixWorld),l.copy(o),h.set(n.x,o.y,0),c.copy(n),d.set(o.x,n.y,0),l.unproject(s),h.unproject(s),c.unproject(s),d.unproject(s),g.copy(l).sub(a),v.copy(h).sub(a),y.copy(c).sub(a),g.normalize(),v.normalize(),y.normalize(),g.multiplyScalar(r),v.multiplyScalar(r),y.multiplyScalar(r),g.add(a),v.add(a),y.add(a);const i=e.planes;i[0].setFromCoplanarPoints(a,l,h),i[1].setFromCoplanarPoints(a,h,c),i[2].setFromCoplanarPoints(c,d,a),i[3].setFromCoplanarPoints(d,l,a),i[4].setFromCoplanarPoints(h,c,d),i[5].setFromCoplanarPoints(y,v,g),i[5].normal.multiplyScalar(-1)}else if(s.isOrthographicCamera){const i=Math.min(t.x,n.x),r=Math.max(t.y,n.y),o=Math.max(t.x,n.x),a=Math.min(t.y,n.y);l.set(i,r,-1),h.set(o,r,-1),c.set(o,a,-1),d.set(i,a,-1),u.set(i,r,1),p.set(o,r,1),f.set(o,a,1),m.set(i,a,1),l.unproject(s),h.unproject(s),c.unproject(s),d.unproject(s),u.unproject(s),p.unproject(s),f.unproject(s),m.unproject(s);const g=e.planes;g[0].setFromCoplanarPoints(l,u,p),g[1].setFromCoplanarPoints(h,p,f),g[2].setFromCoplanarPoints(f,m,d),g[3].setFromCoplanarPoints(m,u,l),g[4].setFromCoplanarPoints(h,c,d),g[5].setFromCoplanarPoints(f,p,u),g[5].normal.multiplyScalar(-1)}},uj=function e(t,s,r,o){const a=new n,l=new v,h=new i,c=new i;if(s.isMesh||s.isLine||s.isPoints)if(s.isInstancedMesh){o[s.uuid]=[];for(let e=0;e<s.count;e++)s.getMatrixAt(e,a),a.decompose(c,l,h),c.applyMatrix4(s.matrixWorld),t.containsPoint(c)&&o[s.uuid].push(e)}else null===s.geometry.boundingSphere&&s.geometry.computeBoundingSphere(),c.copy(s.geometry.boundingSphere.center),c.applyMatrix4(s.matrixWorld),t.containsPoint(c)&&r.push(s);if(s.children.length>0)for(let i=0;i<s.children.length;i++)qv(this,oj,"m",e).call(this,t,s.children[i],r,o)},oV.moduleName="EntityQueryModule";class aV{constructor(e,t,i,n,s,o,a){var l,h,c;pj.add(this),this.cameraControl=null,fj.set(this,void 0),mj.set(this,void 0),this.upKeys={},this.downKeys={},this.pressedKeys={},gj.set(this,0),vj.set(this,0),yj.set(this,0),xj.set(this,0),wj.set(this,!1),bj.set(this,!1),_j.set(this,!1),Sj.set(this,0),Mj.set(this,0),Cj.set(this,!1),Aj.set(this,!1),Ej.set(this,!1),Tj.set(this,!1),Pj.set(this,!1),Oj.set(this,!1),Dj.set(this,!1),Bj.set(this,!1),Ij.set(this,!1),Rj.set(this,!1),kj.set(this,void 0),Lj.set(this,void 0),zj.set(this,bg(!0)),Uj.set(this,{mouseup:"onMouseUp",mousedown:"onMouseDown",preclick:"onMousePreClick",click:"onMouseClick",dblclick:"onMouseDblClick",mousemove:"onMouseMove",pointerdown:"onPointerDown",pointermove:"onPointerMove",pointerup:"onPointerUp",pointerdownup:"onPointerDownUp",pointercancel:"onPointerCancel",contextmenu:"onContextMenu",mouseout:"onMouseOut",mouseover:"onMouseOver",mouseleave:"onMouseLeave",mouseenter:"onMouseEnter",mousewheel:"onMouseWheel",keydown:"onKeyDown",keyup:"onKeyUp"}),Fj.set(this,new Set),Nj.set(this,3e3),jj.set(this,void 0),this.dispose=()=>{Zv(this,mj,null,"f");let e=this.domElement;this.interactiveMapObject&&(e=this.interactiveMapObject.getContainer()),e.removeEventListener("click",this.onMouseClick),e.removeEventListener("dblclick",this.onMouseDblClick),this.supportsPointerEvents&&(this.bindEventsOnBodyElement?e.ownerDocument.removeEventListener("pointermove",this.onDocumentPointerMove):e.removeEventListener("pointermove",this.onDocumentPointerMove),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointercancel",this.onPointerCancel)),this.bindEventsOnBodyElement?e.ownerDocument.removeEventListener("mousemove",this.onDocumentMouseMove):e.removeEventListener("mousemove",this.onDocumentMouseMove),e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("contextmenu",this.onContextMenu),e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchmove",this.onTouchMove),e.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("mousewheel",this.onMouseWheel,{passive:!1}),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)},this.add=e=>{if(e&&!this.allInteractiveObjects.find((t=>t.target===e))){const t=new rV(e);this.allInteractiveObjects.push(t)}this.interactiveObjects=this.allInteractiveObjects.filter((e=>Tk(e.target)==this.app.scene))},this.remove=e=>{e&&(this.allInteractiveObjects=this.allInteractiveObjects.filter((t=>t.target!==e)),this.interactiveObjects=this.allInteractiveObjects.filter((e=>Tk(e.target)==this.app.scene)))},this.update=()=>{var e;if(!this.enabled)return;this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.app.queryEntitiesByRaycast(this.raycaster.ray,{entities:this.interactiveObjects.map((e=>e.target)),camera:this.camera});if(t!==this.closestObject){let i=!1,n=(null==t?void 0:t.target)===(null===(e=this.closestObject)||void 0===e?void 0:e.target);if(this.closestObject&&t&&(i=n&&(null==t?void 0:t.target.isFireEventsByIntersect(this.closestObject,t))),!n||i){if(this.closestObject){const e=new by("mouseout");this.dispatch(this.closestObject,e);const t=new by("mouseleave");this.dispatch(this.closestObject,t)}if(t){const e=new by("mouseover");this.dispatch(t,e);const i=new by("mouseenter");this.dispatch(t,i)}}this.closestObject=t}},Vj.set(this,(e=>{const t=e=>t=>{var i;(null===(i=null==t?void 0:t.originalEvent)||void 0===i?void 0:i.defaultPrevented)?e&&e.preventDefault():this.cameraControl&&this.cameraControl.dispatch(t.type,null==t?void 0:t.originalEvent)};if(e.originalEvent){let i=e;return{event:e=e.originalEvent,cb:t(i),isMap:!0,originMapEvent:i}}return{event:e,cb:t(),isMap:!1,originMapEvent:void 0}})),this.onDocumentMouseMove=e=>{if(!this.enabled)return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;this.mapPositionToPoint(this.mouse,e.clientX,e.clientY);const n=new by("mousemove",e,t.originMapEvent);if(this.dispatch(this.closestObject,n),t.isMap){const i=new by("pointermove",e,t.originMapEvent);this.dispatch(this.closestObject,i)}this.app.onNextFrame(this.setMouseMovement.bind(this,e)),i&&i(n)},this.onDocumentPointerMove=e=>{if(!this.enabled)return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;this.mapPositionToPoint(this.mouse,e.clientX,e.clientY);const n=new by("pointermove",e,t.originMapEvent);this.dispatch(this.closestObject,n),i&&i(n)},this.onTouchMove=e=>{if(!this.enabled)return;qv(this,jj,"f")&&(clearTimeout(qv(this,jj,"f")),Zv(this,jj,void 0,"f"));let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;e.touches.length>0&&this.mapPositionToPoint(this.mouse,e.touches[0].clientX,e.touches[0].clientY);const n=new by(this.treatTouchEventsAsMouseEvents?"mousemove":"touchmove",e,t.originMapEvent);if(t.isMap){const i=new by("pointermove",e,t.originMapEvent);this.dispatch(this.closestObject,i)}this.dispatch(this.closestObject,n),this.app.onNextFrame(this.setMouseMovement.bind(this,e)),i&&i(n)},this.onMouseClick=e=>{if(!this.enabled)return;if(qv(this,pj,"m",Hj).call(this,e))return;if(qv(this,mj,"f")&&new r(...qv(this,mj,"f")).distanceTo(new r(e.x,e.y))>=qv(this,fj,"f"))return void Zv(this,mj,null,"f");Zv(this,mj,null,"f");let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;this.update();{const i=new by("preclick",e,t.originMapEvent);this.dispatch(this.closestObject,i)}const n=new by("click",e,t.originMapEvent);this.dispatch(this.closestObject,n),i&&i(n)},this.onMouseDblClick=e=>{if(!this.enabled)return;if(qv(this,pj,"m",Hj).call(this,e))return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;const n=new by("dblclick",e,t.originMapEvent);this.dispatch(this.closestObject,n),i&&i(n)},this.onMouseDown=e=>{if(!this.enabled)return;if(qv(this,pj,"m",Hj).call(this,e))return;Zv(this,mj,[e.x,e.y],"f");let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;this.mapPositionToPoint(this.mouse,e.clientX,e.clientY),this.update();const n=new by("mousedown",e,t.originMapEvent);if(this.dispatch(this.closestObject,n),t.isMap){const i=new by("pointerdown",e,t.originMapEvent);this.dispatch(this.closestObject,i)}qv(this,pj,"m",Wj).call(this,e),i&&i(n)},this.onContextMenu=e=>{e.preventDefault()},this.onPointerDown=e=>{if(!this.enabled)return;if(qv(this,pj,"m",Hj).call(this,e))return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;this.mapPositionToPoint(this.mouse,e.clientX,e.clientY),this.update();const n=new by("pointerdown",e,t.originMapEvent);this.dispatch(this.closestObject,n),i&&i(n)},this.onPointerCancel=e=>{if(!this.enabled)return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;this.mapPositionToPoint(this.mouse,e.clientX,e.clientY),this.update();const n=new by("pointercancel",e,t.originMapEvent);this.dispatch(this.closestObject,n),i&&i(n)},this.onTouchStart=e=>{if(!this.enabled)return;if(qv(this,pj,"m",Hj).call(this,e))return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;e.touches.length>0&&this.mapPositionToPoint(this.mouse,e.touches[0].clientX,e.touches[0].clientY),this.update();const n=new by(this.treatTouchEventsAsMouseEvents?"mousedown":"touchstart",e,t.originMapEvent);if(this.dispatch(this.closestObject,n),t.isMap){const i=new by("pointerdown",e,t.originMapEvent);this.dispatch(this.closestObject,i)}qv(this,pj,"m",Wj).call(this,e),qv(this,Nj,"f")&&(qv(this,jj,"f")&&(clearTimeout(qv(this,jj,"f")),Zv(this,jj,void 0,"f")),Zv(this,jj,setTimeout((()=>{const i=new by("contextmenu",e,t.originMapEvent);this.dispatch(this.closestObject,i)}),qv(this,Nj,"f")),"f")),i&&i(n)},this.onMouseUp=e=>{if(!this.enabled)return;if(qv(this,pj,"m",Hj).call(this,e))return;let t=!1;qv(this,mj,"f")&&new r(...qv(this,mj,"f")).distanceTo(new r(e.x,e.y))>=qv(this,fj,"f")&&(t=!0);let i=qv(this,Vj,"f").call(this,e);e=i.event;let n=i.cb;const s=new by("mouseup",e,i.originMapEvent);if(this.dispatch(this.closestObject,s),i.isMap){const t=new by("pointerup",e,i.originMapEvent);this.dispatch(this.closestObject,t)}if(!t){const t=new by("pointerdownup",e,i.originMapEvent);if(this.dispatch(this.closestObject,t),2==e.button){const t=new by("contextmenu",e,i.originMapEvent);this.dispatch(this.closestObject,t)}}qv(this,pj,"m",Gj).call(this,e),n&&n(s)},this.onMouseWheel=e=>{if(!this.enabled)return;if(qv(this,pj,"m",Hj).call(this,e))return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;const n=new by("mousewheel",e,t.originMapEvent);this.dispatch(this.closestObject,n),i&&i(n)},this.onKeyDown=e=>{if(!this.enabled)return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;const n=new by("keydown",e,t.originMapEvent);this.dispatch(this.closestObject,n),this.pressedKeys[e.code]||(this.app.onNextFrame((()=>{this.downKeys[e.code]=!0,this.pressedKeys[e.code]=!0,this.app.onNextFrame((()=>{this.downKeys[e.code]=!1}))})),i&&i(n))},this.onKeyUp=e=>{if(!this.enabled)return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;const n=new by("keyup",e,t.originMapEvent);this.dispatch(this.closestObject,n),this.app.onNextFrame((()=>{this.upKeys[e.code]=!0,this.pressedKeys[e.code]=!1,this.app.onNextFrame((()=>{this.upKeys[e.code]=!1}))})),i&&i(n)},this.onPointerUp=e=>{if(!this.enabled)return;if(qv(this,pj,"m",Hj).call(this,e))return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;const n=new by("pointerup",e,t.originMapEvent);this.dispatch(this.closestObject,n),i&&i(n)},this.onTouchEnd=e=>{if(!this.enabled)return;if(qv(this,jj,"f")&&(clearTimeout(qv(this,jj,"f")),Zv(this,jj,void 0,"f")),qv(this,pj,"m",Hj).call(this,e))return;let t=qv(this,Vj,"f").call(this,e);e=t.event;let i=t.cb;e.touches.length>0&&this.mapPositionToPoint(this.mouse,e.touches[0].clientX,e.touches[0].clientY),this.update();const n=new by(this.treatTouchEventsAsMouseEvents?"mouseup":"touchend",e,t.originMapEvent);if(this.dispatch(this.closestObject,n),t.isMap){const i=new by("pointerup",e,t.originMapEvent);this.dispatch(this.closestObject,i)}qv(this,pj,"m",Gj).call(this,e),i&&i(n)},this.dispatch=(e,t)=>{if(this.enabled){if(e&&e.target&&!t.cancelBubble){t.coords=this.mouse,t.distance=e.distance,t.intersected=e.intersected,t.entity=e.target;const i=qv(this,Uj,"f")[t.type];i&&e.target[i]&&e.target[i](t),t.intersection=e.intersection,e.target.dispatch(t.type,t),i in e.target.signal&&e.target.signal[i].dispatch(t,e)}this.sendEvent(e,t)}},this.mapPositionToPoint=(e,t,i)=>{const n=this.app.domElement.getBoundingClientRect();e.x=(t-n.left)/n.width*2-1,e.y=-(i-n.top)/n.height*2+1},this.app=e,this.renderer=t,this.camera=i,this.domElement=n,this.interactiveMapObject=s,this.cameraControl=o,this.bindEventsOnBodyElement=!(!a||void 0===typeof a.bindEventsOnBodyElement)&&a.bindEventsOnBodyElement,qv(this,Fj,"f").add("mapstopprop"),(null!==(l=null==a?void 0:a.stopPropagationClassList)&&void 0!==l?l:[]).forEach((e=>qv(this,Fj,"f").add(e))),Zv(this,Nj,null!==(h=a.longTouchMillSecond)&&void 0!==h?h:3e3,"f"),Zv(this,fj,null!==(c=null==a?void 0:a.clickTolerance)&&void 0!==c?c:1,"f"),this.mouse=new r(-1,1),this.supportsPointerEvents=!!window.PointerEvent,this.interactiveObjects=[],this.allInteractiveObjects=[],this.closestObject=null,this.raycaster=new p,this.interactiveMapObject&&(n=this.interactiveMapObject.getContainer()),n.addEventListener("click",this.onMouseClick),n.addEventListener("dblclick",this.onMouseDblClick),this.supportsPointerEvents&&(this.bindEventsOnBodyElement?n.ownerDocument.addEventListener("pointermove",this.onDocumentPointerMove):n.addEventListener("pointermove",this.onDocumentPointerMove),n.addEventListener("pointerdown",this.onPointerDown),n.addEventListener("pointerup",this.onPointerUp),n.addEventListener("pointercancel",this.onPointerCancel)),this.bindEventsOnBodyElement?n.ownerDocument.addEventListener("mousemove",this.onDocumentMouseMove):n.addEventListener("mousemove",this.onDocumentMouseMove),n.addEventListener("mousedown",this.onMouseDown),n.addEventListener("mouseup",this.onMouseUp),n.addEventListener("contextmenu",this.onContextMenu),n.addEventListener("touchstart",this.onTouchStart,{passive:!0}),n.addEventListener("touchmove",this.onTouchMove,{passive:!0}),n.addEventListener("touchend",this.onTouchEnd,{passive:!0}),n.addEventListener("mousewheel",this.onMouseWheel,{passive:!1}),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),this.treatTouchEventsAsMouseEvents=!0}updateInteractiveObjects(){this.interactiveObjects=this.allInteractiveObjects.filter((e=>Tk(e.target)==this.app.scene))}_onRemoveScene(e){this.allInteractiveObjects=this.allInteractiveObjects.filter((t=>Tk(t.target)!=e))}sendEvent(e,t){const i=qv(this,Uj,"f")[t.type];e&&e.target&&(t.coords=this.mouse,t.distance=e.distance,t.intersected=e.intersected,t.intersection=e.intersection,t.entity=e.target),this.app&&(this.app.dispatch(t.type,t,e),i in this.app.signal&&this.app.signal[i].dispatch(t,e),this.app.rootState&&this.app.rootState.handleEvent({name:i,event:t,object:e}))}setMouseMovement(e){if(void 0===e.clientX&&e.changedTouches&&e.changedTouches.length>0?(Zv(this,gj,e.changedTouches[0].clientX,"f"),Zv(this,vj,e.changedTouches[0].clientX,"f")):(Zv(this,gj,e.clientX,"f"),Zv(this,vj,e.clientY,"f")),Zv(this,yj,e.movementX,"f"),Zv(this,xj,e.movementY,"f"),Zv(this,wj,!0,"f"),qv(this,_j,"f")){let e=3;(Math.abs(qv(this,gj,"f")-qv(this,Sj,"f"))>e||Math.abs(qv(this,vj,"f")-qv(this,Mj,"f"))>e)&&Zv(this,bj,!0,"f")}this.app.onNextFrame(this.resetMouseMovement.bind(this))}resetMouseMovement(){Zv(this,yj,0,"f"),Zv(this,xj,0,"f"),Zv(this,wj,!1,"f")}get x(){return qv(this,gj,"f")}get y(){return qv(this,vj,"f")}get movementX(){return qv(this,yj,"f")}get movementY(){return qv(this,xj,"f")}get isMoving(){return qv(this,wj,"f")}get isDragging(){return qv(this,bj,"f")}get isLeftButtonDown(){return qv(this,Cj,"f")}get isLeftButtonPressed(){return qv(this,Aj,"f")}get isLeftButtonUp(){return qv(this,Ej,"f")}get isRightButtonDown(){return qv(this,Tj,"f")}get isRightButtonPressed(){return qv(this,Pj,"f")}get isRightButtonUp(){return qv(this,Oj,"f")}get isMidButtonDown(){return qv(this,Dj,"f")}get isMidButtonPressed(){return qv(this,Bj,"f")}get isMidButtonUp(){return qv(this,Ij,"f")}get buttonDown(){return qv(this,kj,"f")}get buttonPressed(){return qv(this,Rj,"f")}get buttonUp(){return qv(this,Lj,"f")}get enabled(){return qv(this,zj,"f").value}set enabled(e){qv(this,zj,"f").value=e}get enabledRef(){return qv(this,zj,"f")}}fj=new WeakMap,mj=new WeakMap,gj=new WeakMap,vj=new WeakMap,yj=new WeakMap,xj=new WeakMap,wj=new WeakMap,bj=new WeakMap,_j=new WeakMap,Sj=new WeakMap,Mj=new WeakMap,Cj=new WeakMap,Aj=new WeakMap,Ej=new WeakMap,Tj=new WeakMap,Pj=new WeakMap,Oj=new WeakMap,Dj=new WeakMap,Bj=new WeakMap,Ij=new WeakMap,Rj=new WeakMap,kj=new WeakMap,Lj=new WeakMap,zj=new WeakMap,Uj=new WeakMap,Fj=new WeakMap,Nj=new WeakMap,jj=new WeakMap,Vj=new WeakMap,pj=new WeakSet,Hj=function(e){var t;let i=null!==(t=e.target.classList)&&void 0!==t?t:[];for(let e=0;e<i.length;e++)if(qv(this,Fj,"f").has(i[e]))return!0;return!1},Wj=function(e){Zv(this,_j,!0,"f");let t=!1;void 0===e.clientX&&e.touches.length>0?(Zv(this,Sj,e.touches[0].clientX,"f"),Zv(this,Mj,e.touches[0].clientY,"f"),t=!0):(Zv(this,Sj,e.clientX,"f"),Zv(this,Mj,e.clientY,"f")),this.app.onNextFrame((()=>{let i=e.button;t&&(i=0),0===i?(Zv(this,Cj,!0,"f"),Zv(this,Aj,!0,"f")):2===i?(Zv(this,Tj,!0,"f"),Zv(this,Pj,!0,"f")):1===i&&(Zv(this,Dj,!0,"f"),Zv(this,Bj,!0,"f")),Zv(this,kj,i,"f"),Zv(this,Rj,i,"f"),this.app.onNextFrame((()=>{0===i?Zv(this,Cj,!1,"f"):2===i?Zv(this,Tj,!1,"f"):1===i&&Zv(this,Dj,!1,"f"),Zv(this,kj,void 0,"f")}))}))},Gj=function(e){Zv(this,_j,!1,"f"),Zv(this,bj,!1,"f");let t=!1;void 0===e.clientX&&"touchend"==e.type&&(t=!0),this.app.onNextFrame((()=>{let i=e.button;t&&(i=0),0===i?(Zv(this,Ej,!0,"f"),Zv(this,Aj,!1,"f")):2===i?(Zv(this,Oj,!0,"f"),Zv(this,Pj,!1,"f")):1===i&&(Zv(this,Ij,!0,"f"),Zv(this,Bj,!1,"f")),qv(this,Rj,"f")==i&&(Zv(this,Lj,i,"f"),Zv(this,Rj,void 0,"f")),this.app.onNextFrame((()=>{0===i?Zv(this,Ej,!1,"f"):2===i?Zv(this,Oj,!1,"f"):1===i&&Zv(this,Ij,!1,"f"),Zv(this,Lj,void 0,"f")}).bind(this))}).bind(this))};class lV{constructor(e){this.manager=e}getKeyDown(e){var t;return null===(t=this.manager)||void 0===t?void 0:t.downKeys[e]}getKeyPressed(e){var t;return null===(t=this.manager)||void 0===t?void 0:t.pressedKeys[e]}getKeyUp(e){var t;return null===(t=this.manager)||void 0===t?void 0:t.upKeys[e]}x(){var e;return null===(e=this.manager)||void 0===e?void 0:e.x}y(){var e;return null===(e=this.manager)||void 0===e?void 0:e.y}movementX(){var e;return null===(e=this.manager)||void 0===e?void 0:e.movementX}movementY(){var e;return null===(e=this.manager)||void 0===e?void 0:e.movementY}isMoving(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isMoving}isDragging(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isDragging}isLeftButtonDown(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isLeftButtonDown}isLeftButtonPressed(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isLeftButtonPressed}isLeftButtonUp(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isLeftButtonUp}isRightButtonDown(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isRightButtonDown}isRightButtonPressed(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isRightButtonPressed}isRightButtonUp(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isRightButtonUp}isMidButtonDown(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isMidButtonDown}isMidButtonPressed(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isMidButtonPressed}isMidButtonUp(){var e;return null===(e=this.manager)||void 0===e?void 0:e.isMidButtonUp}enabled(){var e;return null===(e=this.manager)||void 0===e?void 0:e.enabled}setEnable(e){return this.manager.enabled=e}enabledRef(){var e;return null===(e=this.manager)||void 0===e?void 0:e.enabledRef}closestObject(){var e;return null===(e=this.manager)||void 0===e?void 0:e.closestObject}}class hV extends Fw{constructor(e,t){super(),Yj.set(this,new lV),Xj.set(this,new Map),this.options=null!=t?t:{}}setupUiConfig(){return{type:"folder",expanded:!1,label:hV.moduleName,children:[{type:"checkbox",label:"允许输入",getValue:()=>this.Input.enabled(),setValue:e=>this.Input.setEnable(e)},{type:"number",label:"当前鼠标X",getValue:()=>this.Input.x(),readOnly:!0},{type:"number",label:"当前鼠标Y",getValue:()=>this.Input.y(),readOnly:!0},{type:"number",label:"当前鼠标移动X",getValue:()=>this.Input.movementX(),readOnly:!0},{type:"number",label:"当前鼠标移动Y",getValue:()=>this.Input.movementY(),readOnly:!0},{type:"checkbox",label:"鼠标移动",getValue:()=>this.Input.isMoving(),readOnly:!0},{type:"checkbox",label:"鼠标拖动",getValue:()=>this.Input.isDragging(),readOnly:!0},{type:"checkbox",label:"左键按下",getValue:()=>this.Input.isLeftButtonDown(),readOnly:!0},{type:"checkbox",label:"左键按住",getValue:()=>this.Input.isLeftButtonPressed(),readOnly:!0},{type:"checkbox",label:"左键抬起",getValue:()=>this.Input.isLeftButtonUp(),readOnly:!0},{type:"checkbox",label:"中键按下",getValue:()=>this.Input.isMidButtonDown(),readOnly:!0},{type:"checkbox",label:"中键按住",getValue:()=>this.Input.isMidButtonPressed(),readOnly:!0},{type:"checkbox",label:"中键抬起",getValue:()=>this.Input.isMidButtonUp(),readOnly:!0},{type:"checkbox",label:"右键按下",getValue:()=>this.Input.isRightButtonDown(),readOnly:!0},{type:"checkbox",label:"右键按住",getValue:()=>this.Input.isRightButtonPressed(),readOnly:!0},{type:"checkbox",label:"右键抬起",getValue:()=>this.Input.isRightButtonUp(),readOnly:!0},{type:"checkbox",label:"按住Shift键",getValue:()=>!(!this.Input.getKeyPressed("ShiftLeft")&&!this.Input.getKeyPressed("ShiftRight")),readOnly:!0},{type:"checkbox",label:"按住Ctrl键",getValue:()=>!(!this.Input.getKeyPressed("ControlLeft")&&!this.Input.getKeyPressed("ControlRight")),readOnly:!0},{type:"checkbox",label:"按住Alt键",getValue:()=>!(!this.Input.getKeyPressed("AltLeft")&&!this.Input.getKeyPressed("AltRight")),readOnly:!0}]}}addPointerEventsObject(e){var t;null===(t=this.manager)||void 0===t||t.add(e)}removePointerEventsObject(e){var t;null===(t=this.manager)||void 0===t||t.remove(e)}onAwake(){const e=this.app;this.applyMixinsTo(e,["addPointerEventsObject","removePointerEventsObject","Input","setMenu"]),this.effectScope((()=>{Jg((()=>{var t,i;e.renderer&&e.camera&&e.domElement&&(this.manager?(this.manager.app=e,this.manager.renderer=e.renderer,this.manager.camera=e.camera,this.manager.domElement=e.domElement,this.manager.interactiveMapObject=this.options.interactiveMapObject,this.manager.cameraControl=(null===(i=e.cameraControl)||void 0===i?void 0:i.eventFromInputModule)?e.cameraControl:null):(this.manager=new aV(e,e.renderer,e.camera,e.container,this.options.interactiveMapObject,(null===(t=e.cameraControl)||void 0===t?void 0:t.eventFromInputModule)?e.cameraControl:null,this.options),Zv(this,Yj,new lV(this.manager),"f"),(e.getEntities()||[]).forEach((e=>this.manager.add(e))),this.addDispose((()=>this.manager.dispose()))))}))})),this.addDispose(this.app.signal.onPointerDownUp.add(((e,t)=>{var i,n,s;if(2===(null===(i=null==e?void 0:e.originalEvent)||void 0===i?void 0:i.button)&&!(null==e?void 0:e.cancelBubble))if(this.app.signal.contextMenuPreOpen.dispatch({event:e,object:t}),this.app.isInteracting())this.app.signal.contextMenuCancel.dispatch("contextMenuCancel",{event:e,object:t});else{let i=Array.from(qv(this,Xj,"f").keys()).sort().reverse(),r=!1;for(let o of i){let i=qv(this,Xj,"f").get(o);if("function"==typeof i){if(!t&&this.app.domElement!=e.originalEvent.target&&-1==(null!==(s=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.classList)&&void 0!==s?s:[]).indexOf("mapnostopprop"))continue;if(i(e,t)){this.app.signal.contextMenuOpened.dispatch({event:e,object:t}),r=!0;break}}}r||this.app.signal.contextMenuNoContent.dispatch({event:e,object:t})}}))),this.addDispose(this.app.signal.onActiveScene.add((e=>{var t;null===(t=this.manager)||void 0===t||t.updateInteractiveObjects()}))),this.addDispose(this.app.signal.onRemoveScene.add((e=>{var t;null===(t=this.manager)||void 0===t||t._onRemoveScene(e)})))}get Input(){return qv(this,Yj,"f")}onAppAfterRender(){var e;null===(e=this.manager)||void 0===e||e.update()}onAppAddEntity(e){var t;e.pointerEvents&&(null===(t=this.manager)||void 0===t||t.add(e))}onAppRemoveEntity(e){var t;null===(t=this.manager)||void 0===t||t.remove(e)}setMenu(e,t){let i=t||"";e&&qv(this,Xj,"f").set(i,e)}}Yj=new WeakMap,Xj=new WeakMap,hV.moduleName="InputModule";class cV extends Fw{constructor(e,t){super(e),Qj.add(this),qj.set(this,new r(0,0)),Zj.set(this,new i(0,0,0)),Kj.set(this,new i(0,0,0)),Jj.set(this,new p),$j.set(this,new c),eV.set(this,new c),this.options=t,qv(this,$j,"f").setFromNormalAndCoplanarPoint(new i(0,1,0),new i(0,0,0)),qv(this,eV,"f").setFromNormalAndCoplanarPoint(new i(0,0,1),new i(0,0,0))}onAwake(){var e,t;const i=this.app;this.applyMixinsTo(i),this.app.sceneEntity._sceneData._centerOrigin=null===(e=this.options)||void 0===e?void 0:e.centerOrigin,this.app.sceneEntity._sceneData._scaleOrigin=null===(t=this.options)||void 0===t?void 0:t.scaleOrigin}get centerOrigin(){return this.app.sceneEntity._sceneData._centerOrigin}set centerOrigin(e){this.app.sceneEntity._sceneData._centerOrigin=e}get scaleOrigin(){return this.app.sceneEntity._sceneData._scaleOrigin}set scaleOrigin(e){this.app.sceneEntity._sceneData._scaleOrigin=e}unprojectAsync(e,t,i,n){return Qv(this,void 0,void 0,(function*(){return void 0===i&&(i=Cy.useData.UnProjectOpts,i=qv(this,Qj,"m",tV).call(this,i)),"depth"==i&&(this.app.isMapMode||void 0===(i=yield this.app.getDepth(e,t)))&&(i=!0),this.app.unproject(e,t,i,n)}))}unproject(e,t,n,s){const r=this.screenToNdc(e,t);if(void 0===n&&(n=Cy.useData.UnProjectOpts,"depth"===(n=qv(this,Qj,"m",tV).call(this,n))&&(n=!0)),"number"==typeof n)return qv(this,Zj,"f").set(r.x,r.y,n).unproject(this.app.camera).clone();if(qv(this,Jj,"f").setFromCamera(r,this.app.camera),n&&n.isPlane)return qv(this,Jj,"f").ray.intersectPlane(n,new i);if(n&&n.isVector3){let e=(new c).setFromNormalAndCoplanarPoint(wW(this.app),n);return qv(this,Jj,"f").ray.intersectPlane(e,new i)}{let e,t,r=[];if("object"==typeof n)Array.isArray(n.include)?r=n.include:n.include||r.push(this.app.scene),Array.isArray(n.exclude)&&n.exclude.length>0&&(e=new Set(n.exclude));else if(Array.isArray(n))r=n;else if(!0===n)r.push(this.app.scene);else if(!1===n)return qv(this,Jj,"f").ray.intersectPlane(this.app.isMapMode?qv(this,eV,"f"):qv(this,$j,"f"),new i);if(e){let i=new Set(r);const n=(e,t)=>{const i=new Set;for(const n of e)t.has(n)||i.add(n);return i},s=n(i,e),o=n(e,i);let a=new Set,l=new Set;for(let e of o)a.add(e),e.traverseVisible((e=>{a.has(e)||a.add(e)}));for(let e of s)l.add(e),e.traverseVisible((e=>{l.has(e)||a.has(e)||l.add(e)}));t=qv(this,Jj,"f").intersectObjects(Array.from(l),!1)}else t=qv(this,Jj,"f").intersectObjects(r,!0);return t=t.filter((e=>!e.object.userData.disableRayQuery)),t.length>0?(s&&(s.object=t[0]),t[0].point):qv(this,Jj,"f").ray.intersectPlane(this.app.isMapMode?qv(this,eV,"f"):qv(this,$j,"f"),new i)}}project(e,t,i){let n,s,r;"number"!=typeof e?(n=e.x,s=e.y,r=e.z):(n=e,s=t,r=i);const o=qv(this,Zj,"f").set(n,s,r).project(this.app.camera);return this.ndcToScreen(o.x,o.y)}screenToNdc(e,t){let i,n;"number"!=typeof e?(i=e.x,n=e.y):(i=e,n=t);let s=this.app.container.getBoundingClientRect();return i=(i-s.left)/s.width*2-1,n=1-(n-s.top)/s.height*2,qv(this,qj,"f").set(i,n).clone()}ndcToScreen(e,t){let i,n;"number"!=typeof e?(i=e.x,n=e.y):(i=e,n=t);let s=this.app.container.getBoundingClientRect();return i=Math.round(s.left+(i+1)*s.width/2),n=Math.round(s.top+(1-n)*s.height/2),qv(this,qj,"f").set(i,n).clone()}setupUiConfig(){return{type:"folder",expanded:!1,label:cV.moduleName,children:[()=>$T(this,[{prop:"centerOrigin",value:new i(0,0,0)},{prop:"scaleOrigin",value:1}])]}}}qj=new WeakMap,Zj=new WeakMap,Kj=new WeakMap,Jj=new WeakMap,$j=new WeakMap,eV=new WeakMap,Qj=new WeakSet,tV=function(e){var t,i;let n=e;if(void 0===n){let e=null!==(i=null===(t=this.app.envConfig)||void 0===t?void 0:t.unProjectOptions)&&void 0!==i?i:{};for(let t in e)if("point"!=t)if("none"==t)n=e[t];else if(t.split("+").map((e=>e.trim())).every((e=>this.app.Input.getKeyPressed(e)))){let i=e[t];if(1===i){let t=e.point;n=null!=t?t:qv(this,Kj,"f")}else n=2===i?e.value:i;break}}return n},cV.moduleName="CoordSystemModule";const dV=new i,uV=new n,pV=new n,fV=new i,mV=new i;class gV{constructor(e={}){const t=this;let i,n,s,r;const o={objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");function l(e,i,n){if(e.isCSS2DObject){dV.setFromMatrixPosition(e.matrixWorld),dV.applyMatrix4(pV);const l=!0===e.visible&&dV.z>=-1&&dV.z<=1&&!0===e.layers.test(n.layers);if(e.element.style.display=!0===l?"":"none",!0===l){e.onBeforeRender(t,i,n);const o=e.element;o.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(dV.x*s+s)+"px,"+(-dV.y*r+r)+"px)",o.parentNode!==a&&a.appendChild(o),e.onAfterRender(t,i,n)}const d={distanceToCameraSquared:(h=n,c=e,fV.setFromMatrixPosition(h.matrixWorld),mV.setFromMatrixPosition(c.matrixWorld),fV.distanceToSquared(mV))};o.objects.set(e,d)}var h,c;for(let t=0,s=e.children.length;t<s;t++)l(e.children[t],i,n)}a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:i,height:n}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),uV.copy(t.matrixWorldInverse),pV.multiplyMatrices(t.projectionMatrix,uV),l(e,e,t),function(e){const t=function(e){const t=[];return e.traverse((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){return e.renderOrder!==t.renderOrder?t.renderOrder-e.renderOrder:o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared})),i=t.length;for(let e=0,n=t.length;e<n;e++)t[e].element.style.zIndex=i-e}(e)},this.setSize=function(e,t){i=e,n=t,s=i/2,r=n/2}}}var vV,yV,xV,wV,bV,_V,SV,MV,CV,AV,EV,TV,PV,OV,DV,BV,IV,RV,kV,LV,zV,UV,FV,NV,jV,VV,HV,WV,GV,YV,XV,QV,qV,ZV,KV,JV,$V,eH,tH,iH,nH,sH,rH,oH,aH,lH,hH;class cH extends Fw{constructor(e,t){super(e),vV.add(this),yV.set(this,void 0),xV.set(this,0),this.options=t||{},this.appRenderIndex=gy.EndMost,this.addDispose(this.app.signal.onCameraUpdate.add((()=>{this.app.sceneEntity._sceneData.marker2dDirty=!0}))),this.addDispose(this.app.signal.onCustomEvent.add((e=>{"setMarker2dDirty"==e&&(this.app.sceneEntity._sceneData.marker2dDirty=!0)}))),this.addDispose((()=>{this._popup2d&&(this._popup2d.remove(),this._popup2d=null)}))}get popup2d(){return this._popup2d||(this._popup2d=new HU(Object.assign({backgroundColor:"#A0FFA0",buttonColor:"#f00",closeOnClick:!1,closeButton:!1,showArrow:!0},this.options.popup2dStyle)),this._popup2d.addTo(this.app)),this._popup2d}get css2dRenderer(){return qv(this,yV,"f")}getMarker2Ds(){return Array.from(this.app.sceneEntity._sceneData.marker2dSet)}getPopup2Ds(){return Array.from(this.app.sceneEntity._sceneData.popup2dSet)}onAwake(){var e;const t=this.app;Zv(this,yV,new gV(Object.assign({element:null!==(e=this.options.parent)&&void 0!==e?e:this.app.container},this.options)),"f"),this.applyMixinsTo(t,void 0,void 0,["updateMarker2d"]),this.effectScope((()=>{Jg((()=>{const{width:e,height:i}=t.containerSize;qv(this,yV,"f").setSize(e,i)}))}));const i=(e,t)=>{t?qv(this,vV,"m",wV).call(this,e):qv(this,vV,"m",bV).call(this,e)};t.on("onMarker2D",i),this.addDispose((()=>t.off("onMarker2D",i)));const n=(e,t)=>{t?this.app.sceneEntity._sceneData.popup2dSet.add(e):this.app.sceneEntity._sceneData.popup2dSet.has(e)&&this.app.sceneEntity._sceneData.popup2dSet.delete(e)};t.on("onPopup2D",n),this.addDispose((()=>t.off("onPopup2D",n))),this.addDispose(this.app.signal.onAddScene.add((e=>qv(this,vV,"m",_V).call(this,e)))),qv(this,vV,"m",_V).call(this,this.app.scene),this.addDispose(this.app.signal.onRemoveScene.add((e=>{var t,i,n,s;Array.from(null!==(t=e.sceneEntity._sceneData.marker2dSet)&&void 0!==t?t:[]).forEach((e=>null==e?void 0:e.remove())),null===(i=e.sceneEntity._sceneData.marker2dSet)||void 0===i||i.clear(),null===(n=e.sceneEntity._sceneData.marker2dFadeSet)||void 0===n||n.clear(),null===(s=e.sceneEntity._sceneData.marker2dOcclusionSet)||void 0===s||s.clear()}))),this.addDispose(this.app.signal.onActiveScene.add(((e,t)=>{var i,n,s,r,o,a,l;let h=null==t?void 0:t.sceneEntity;if(h&&e!=t){let e=h._sceneData.marker2dSet;if(e)for(let t of e){t.userData.oldVisible=t.isShow(),t.hide();let e=t.children;for(let t of e)(t.isPopup2D||t.isMarker3D||t.isMarker2D)&&(t.userData.oldVisible=t.isShow(),t.hide())}let t=h._sceneData.popup2dSet;if(t)for(let e of t)e.userData.oldVisible=e.isShow(),e.hide()}if(e){let t=null===(n=null===(i=e.sceneEntity)||void 0===i?void 0:i._sceneData)||void 0===n?void 0:n.marker2dSet;if(t)for(let e of t){null===(s=e.userData.oldVisible)||void 0===s||s?e.show():e.hide(),delete e.userData.oldVisible;let t=e.children;for(let e of t)(e.isPopup2D||e.isMarker3D||e.isMarker2D)&&(null===(r=e.userData.oldVisible)||void 0===r||r?e.show():e.hide(),delete e.userData.oldVisible)}let h=null===(a=null===(o=e.sceneEntity)||void 0===o?void 0:o._sceneData)||void 0===a?void 0:a.popup2dSet;if(h)for(let e of h)null===(l=e.userData.oldVisible)||void 0===l||l?e.show():e.hide(),delete e.userData.oldVisible}})))}updateMarker2d(){var e,t;if(!this.app.sceneEntity._sceneData.marker2dDirty)return;this.app.sceneEntity._sceneData.marker2dDirty=!1;let i=new WeakMap;for(let t of this.app.sceneEntity._sceneData.marker2dFadeSet){let n=t.position;(null===(e=this.app)||void 0===e?void 0:e.isMapMode)&&(n=BP.world2Scene(n));let s=n.distanceTo(this.app.camera.position);if(s<t._options.fadeDistance)t.setOpacity(1),i.set(t,1);else{s-=t._options.fadeDistance;let e=Mv(Cv(1,0,s/t._options.fadeDistance),0,1);t.setOpacity(e),i.set(t,e)}}for(let e of this.app.sceneEntity._sceneData.marker2dOcclusionSet){const i=iW(e,this.app.camera,this.app.isMapMode);sW(e,this.app.camera,this.app.getQueryRaycaster(),null!==(t=e.userData.occlusionObjects)&&void 0!==t?t:[this.app.scene])||i?(e.setOpacity(e._options.occlusionOpacity),e._occlusion||(e._occlusion=!0,e.signal.occlusion.dispatch({object:e,occlusion:!0}))):(e.setOpacity(e._opacity),e._occlusion&&(e._occlusion=!1,e.signal.occlusion.dispatch({object:e,occlusion:!1})))}}onAppRender(e){var t,i;const n=this.app;if(!qv(this,yV,"f")||!n.scene||!n.camera)return;qv(this,vV,"m",_V).call(this,this.app.scene);let s=this.app.sceneEntity._sceneData.marker2dSet.size,r=this.app.sceneEntity._sceneData.popup2dSet.size,o=!0;if(s+r==0&&(o=!1),o&&s+r<5){o=!1;for(let e of this.app.sceneEntity._sceneData.marker2dSet){if(e.isShow()){o=!0;break}e.element.style.display="none"}if(!o)for(let e of this.app.sceneEntity._sceneData.popup2dSet){if(e.isShow()){o=!0;break}e.element.style.display="none"}}if(!o)return;qv(this,yV,"f").render(n.scene,n.camera);let a=(null!==(i=null===(t=this.options)||void 0===t?void 0:t.refreshMarkerOpacityTimeout)&&void 0!==i?i:500)/1e3;e.elapsedTime-qv(this,xV,"f")>a&&(this.updateMarker2d(),Zv(this,xV,e.elapsedTime,"f"))}setupUiConfig(){let e={value:""};return{type:"folder",expanded:!1,label:cH.moduleName,children:[{type:"number",label:"刷新防抖时间毫秒",getValue:()=>{var e,t;return null!==(t=null===(e=this.options)||void 0===e?void 0:e.refreshMarkerOpacityTimeout)&&void 0!==t?t:500},setValue:e=>this.options.refreshMarkerOpacityTimeout=e},()=>({type:"input",label:"总数",readOnly:!0,getValue:()=>this.app.sceneEntity._sceneData.marker2dSet.size+","+this.app.sceneEntity._sceneData.popup2dSet.size}),{type:"input",label:"Marker坐标x,y,z",property:[e,"value"]},{type:"button",label:"创建Marker",onClick:()=>Qv(this,void 0,void 0,(function*(){var t;let i=e.value;if(!i)return;let n=i.split(",").map((e=>+e));if(3!=n.length)return;let s=new UU;s.setPosition(n),s.addTo(this.app),null===(t=this.app.cameraControl)||void 0===t||t.setPosition(n[0],n[1],n[2],!0)}))}]}}}yV=new WeakMap,xV=new WeakMap,vV=new WeakSet,wV=function(e){this.app.sceneEntity._sceneData.marker2dSet||qv(this,vV,"m",_V).call(this,this.app.scene),this.app.sceneEntity._sceneData.marker2dSet.add(e),e._options.fadeDistance>0&&this.app.sceneEntity._sceneData.marker2dFadeSet.add(e),e._options.occlusionOpacity<1&&this.app.sceneEntity._sceneData.marker2dOcclusionSet.add(e),this.app.sceneEntity._sceneData.marker2dDirty=!0},bV=function(e){this.app.sceneEntity._sceneData.marker2dSet||qv(this,vV,"m",_V).call(this,this.app.scene),this.app.sceneEntity._sceneData.marker2dSet.has(e)&&this.app.sceneEntity._sceneData.marker2dSet.delete(e),this.app.sceneEntity._sceneData.marker2dFadeSet.has(e)&&this.app.sceneEntity._sceneData.marker2dFadeSet.delete(e),this.app.sceneEntity._sceneData.marker2dOcclusionSet.has(e)&&this.app.sceneEntity._sceneData.marker2dOcclusionSet.delete(e),this.app.sceneEntity._sceneData.marker2dDirty=!0},_V=function(e){var t,i;e&&((null===(i=null===(t=e.sceneEntity)||void 0===t?void 0:t._sceneData)||void 0===i?void 0:i.marker2dSet)||(e.sceneEntity._sceneData.marker2dSet=new Set,e.sceneEntity._sceneData.marker2dFadeSet=new Set,e.sceneEntity._sceneData.marker2dOcclusionSet=new Set,e.sceneEntity._sceneData.popup2dSet=new Set,e.sceneEntity._sceneData.marker2dDirty=!1))},cH.moduleName="CSS2DRendererModule";class dH extends Fw{constructor(e,t){super(e),SV.add(this),MV.set(this,void 0),CV.set(this,void 0),AV.set(this,0),this.options=t||{},this.appRenderIndex=gy.EndMost,this.addDispose(this.app.signal.onCameraUpdate.add((()=>{this.app.sceneEntity._sceneData.marker3dDirty=!0}))),this.addDispose(this.app.signal.onCustomEvent.add((e=>{"setMarker3dDirty"==e&&(this.app.sceneEntity._sceneData.marker3dDirty=!0)})));const i=(e,t)=>{t?qv(this,SV,"m",TV).call(this,e):qv(this,SV,"m",PV).call(this,e)};e.on("onMarker3D",i),this.addDispose((()=>e.off("onMarker3D",i)))}get css3dRenderer(){return qv(this,MV,"f")}get css3dOccludeRenderer(){return qv(this,CV,"f")}onAwake(){qv(this,SV,"m",OV).call(this,!1),this.applyMixinsTo(this.app,["css3dRenderer","css3dOccludeRenderer","setCss3dObjectCanOcclude"]),this.addDispose(this.app.signal.onAddScene.add((e=>qv(this,SV,"m",EV).call(this,e)))),this.addDispose(this.app.signal.onRemoveScene.add((e=>{var t;Array.from(null!==(t=e.sceneEntity._sceneData.marker3dSet)&&void 0!==t?t:[]).forEach((e=>null==e?void 0:e.remove())),e.sceneEntity._sceneData.marker3dSet.clear(),e.sceneEntity._sceneData.occlude3Object3dSet.clear(),e.sceneEntity._sceneData.noOccludeObject3dSet.clear(),e.sceneEntity._sceneData.marker3dFadeSet.clear(),e.sceneEntity._sceneData.marker3dOcclusionSet.clear()}))),qv(this,SV,"m",EV).call(this,this.app.scene),this.addDispose(this.app.signal.onActiveScene.add(((e,t)=>{var i,n,s,r;let o=null==t?void 0:t.sceneEntity;if(o&&e!=t){let e=o._sceneData.marker3dSet;if(e)for(let t of e){t.userData.oldVisible=t.isShow(),t.hide();let e=t.children;for(let t of e)(t.isPopup2D||t.isMarker3D||t.isMarker2D)&&(t.userData.oldVisible=t.isShow(),t.hide())}}if(e){let t=null===(n=null===(i=e.sceneEntity)||void 0===i?void 0:i._sceneData)||void 0===n?void 0:n.marker3dSet;if(t)for(let e of t){null===(s=e.userData.oldVisible)||void 0===s||s?e.show():e.hide(),delete e.userData.oldVisible;let t=e.children;for(let e of t)(e.isPopup2D||e.isMarker3D||e.isMarker2D)&&(null===(r=e.userData.oldVisible)||void 0===r||r?e.show():e.hide(),delete e.userData.oldVisible)}}})))}getMarker3Ds(){return Array.from(this.app.sceneEntity._sceneData.marker3dSet)}setCss3dObjectCanOcclude(e,t){if(t){if(qv(this,CV,"f")||qv(this,SV,"m",OV).call(this,!0),this.app.sceneEntity._sceneData.occlude3Object3dSet.has(e))return;this.app.sceneEntity._sceneData.occlude3Object3dSet.add(e),this.app.sceneEntity._sceneData.noOccludeObject3dSet.delete(e)}else this.app.sceneEntity._sceneData.noOccludeObject3dSet.add(e),this.app.sceneEntity._sceneData.occlude3Object3dSet.has(e)&&this.app.sceneEntity._sceneData.occlude3Object3dSet.delete(e);e.userData._isAddRemovedEvent||(e.userData._isAddRemovedEvent=!0,e.addEventListener("removed",(()=>{this.app.sceneEntity._sceneData.noOccludeObject3dSet.delete(e),this.app.sceneEntity._sceneData.occlude3Object3dSet.delete(e)})))}updateMarker3d(){var e,t;if(!this.app.sceneEntity._sceneData.marker3dDirty)return;this.app.sceneEntity._sceneData.marker3dDirty=!1;for(let e of this.app.sceneEntity._sceneData.marker3dSet)e.isCss3dSprite()&&e.updatePopupPosition();let i=new WeakMap;for(let t of this.app.sceneEntity._sceneData.marker3dFadeSet){let n=t.position;(null===(e=this.app)||void 0===e?void 0:e.isMapMode)&&(n=BP.world2Scene(n));let s=n.distanceTo(this.app.camera.position);if(s<t._options.fadeDistance)t.setOpacity(1),i.set(t,1);else{s-=t._options.fadeDistance;let e=Mv(0,1,Cv(1,0,s/t._options.fadeDistance));t.setOpacity(e),i.set(t,e)}}for(let e of this.app.sceneEntity._sceneData.marker3dOcclusionSet){const i=iW(e,this.app.camera,this.app.isMapMode);sW(e,this.app.camera,this.app.getQueryRaycaster(),null!==(t=e.userData.occlusionObjects)&&void 0!==t?t:[this.app.scene])||i?(e.setOpacity(e._options.occlusionOpacity),e._occlusion||(e._occlusion=!0,e.signal.occlusion.dispatch({object:e,occlusion:!0}))):(e.setOpacity(e._opacity),e._occlusion&&(e._occlusion=!1,e.signal.occlusion.dispatch({object:e,occlusion:!1})))}}onAppRender(e){var t,i;const n=this.app;if(!qv(this,MV,"f")||!n.scene||!n.camera)return;qv(this,SV,"m",EV).call(this,n.scene);let s=this.app.sceneEntity._sceneData.marker3dSet.size,r=!0;if(0==s&&(r=!1),r&&s<5){r=!1;for(let e of this.app.sceneEntity._sceneData.marker3dSet){if(e.isShow()){r=!0;break}e.element.style.display="none"}}if(!r)return;if(0==this.app.sceneEntity._sceneData.occlude3Object3dSet.size)qv(this,MV,"f").render(n.scene,n.camera);else{let e=Array.from(this.app.sceneEntity._sceneData.occlude3Object3dSet);e.forEach((e=>e.isCSS3DObject=!1)),qv(this,MV,"f").render(n.scene,n.camera),e.forEach((e=>e.isCSS3DObject=!0));let t=Array.from(this.app.sceneEntity._sceneData.noOccludeObject3dSet);t.forEach((e=>e.isCSS3DObject=!1)),qv(this,CV,"f")&&qv(this,CV,"f").render(n.scene,n.camera),t.forEach((e=>e.isCSS3DObject=!0))}let o=(null!==(i=null===(t=this.options)||void 0===t?void 0:t.refreshMarkerOpacityTimeout)&&void 0!==i?i:500)/1e3;e.elapsedTime-qv(this,AV,"f")>o&&(this.updateMarker3d(),Zv(this,AV,e.elapsedTime,"f"))}setupUiConfig(){return{type:"folder",expanded:!1,label:dH.moduleName,children:[{type:"number",label:"刷新防抖时间毫秒",getValue:()=>{var e,t;return null!==(t=null===(e=this.options)||void 0===e?void 0:e.refreshMarkerOpacityTimeout)&&void 0!==t?t:500},setValue:e=>this.options.refreshMarkerOpacityTimeout=e},()=>({type:"input",label:"总数",readOnly:!0,getValue:()=>this.app.sceneEntity._sceneData.marker3dSet.size+""})]}}}MV=new WeakMap,CV=new WeakMap,AV=new WeakMap,SV=new WeakSet,EV=function(e){e&&(e.sceneEntity._sceneData.marker3dSet||(e.sceneEntity._sceneData.marker3dSet=new Set,e.sceneEntity._sceneData.occlude3Object3dSet=new Set,e.sceneEntity._sceneData.noOccludeObject3dSet=new Set,e.sceneEntity._sceneData.marker3dFadeSet=new Set,e.sceneEntity._sceneData.marker3dOcclusionSet=new Set,e.sceneEntity._sceneData.marker3dDirty=!1))},TV=function(e){this.app.sceneEntity._sceneData.marker3dSet.add(e),e._options.fadeDistance>0&&this.app.sceneEntity._sceneData.marker3dFadeSet.add(e),e._options.occlusionOpacity<1&&this.app.sceneEntity._sceneData.marker3dOcclusionSet.add(e),this.app.sceneEntity._sceneData.marker3dDirty=!0},PV=function(e){this.app.sceneEntity._sceneData.marker3dSet.has(e)&&this.app.sceneEntity._sceneData.marker3dSet.delete(e),this.app.sceneEntity._sceneData.marker3dFadeSet.has(e)&&this.app.sceneEntity._sceneData.marker3dFadeSet.delete(e),this.app.sceneEntity._sceneData.marker3dOcclusionSet.has(e)&&this.app.sceneEntity._sceneData.marker3dOcclusionSet.delete(e),this.app.sceneEntity._sceneData.marker3dDirty=!0},OV=function(e){var t,i,n;if(e&&qv(this,CV,"f"))return;if(!e&&qv(this,MV,"f"))return;let s=new qi(this.options);if(s.domElement.className=null!==(i=null===(t=this.options)||void 0===t?void 0:t.className)&&void 0!==i?i:"css3dRenderer",s.domElement.style.position="absolute",s.domElement.style.top="0px",s.domElement.style.pointerEvents="none",this.options.style)for(let e in this.options.style)s.domElement.style[e]=this.options.style[e];const r=null!==(n=this.options.parent)&&void 0!==n?n:this.app.container;!0===e?(r.insertBefore(s.domElement,r.firstChild),this.app.domElement.style.pointerEvents="none"):r.appendChild(s.domElement),this.effectScope((()=>{Jg((()=>{const{width:e,height:t}=this.app.containerSize;s.setSize(e,t)}))})),this.addDispose((()=>{r.removeChild(s.domElement),s.domElement.remove()})),Zv(this,e?CV:MV,s,"f")},dH.moduleName="CSS3DRendererModule";class uH extends Fw{constructor(e){super(e),DV.add(this),this.selectObjects=hg([]),BV.set(this,new Set),IV.set(this,!1),RV.set(this,new Set),kV.set(this,new Set),this.bloomObjects=hg([]),LV.set(this,new Set),zV.set(this,!1),UV.set(this,new Set),FV.set(this,new Set),this.outlineObjects=hg([]),NV.set(this,new Set),jV.set(this,!1),VV.set(this,new Set),HV.set(this,new Set),WV.set(this,0),GV.set(this,!1);const t=[95,99,117,115,116,111,109,95,101,118,116,95,97,117].map((e=>String.fromCodePoint(e))).join("");e.on(t+"_",(()=>{Zv(this,WV,1,"f")})),this.addDispose((()=>{(this.getEntities()||[]).forEach((e=>e.remove())),this.selectObjects=[]})),function(e){let t={};const i=[95,99,117,115,116,111,109,95,101,118,116,95,98,118].map((e=>String.fromCodePoint(e))).join("");let n;e.on(i,(s=>Qv(this,void 0,void 0,(function*(){if(!e.svc)return;if(n)return;let s=yield function(e,t){return Qv(this,void 0,void 0,(function*(){let i=e.svc;const n=i._url("heart")+`?token=${i.accessToken}`;t.getVisitorId||(t.getVisitorId=FF());let s={};try{let e=yield t.getVisitorId(),r=yield i._post(n,{tm:Bk(e)});r&&"data"in r&&(r=r.data);let o=Ik(r.info);s=JSON.parse(o)}catch(e){s={}}return s}))}(e,t);"{}"!=JSON.stringify(s)&&(s.trial||!(s.permitAccessUserCount>0))&&(n=!0,e.dispatch(i+"_"))}))))}(e)}getEntities(){var e;return null===(e=this.app.sceneEntity)||void 0===e?void 0:e.childrens}getRayQueryEntities(){var e,t;let i=[];const n=e=>{if(e.rayQueryType!=PP.Disable)if(e.rayQueryType==PP.Allow)i.push(e);else for(let t=0;t<e.childrens.length;t++)n(e.childrens[t])};return(null!==(t=null===(e=this.app.sceneEntity)||void 0===e?void 0:e.childrens)&&void 0!==t?t:[]).forEach((e=>n(e))),i}onAwake(){const e=this.app;this.applyMixinsTo(e)}onAppAddEntity(e){var t;this.app.sceneEntity.childrens=null!==(t=this.app.sceneEntity.childrens)&&void 0!==t?t:[],this.app.sceneEntity.childrens.push(e),e._ownerScene=this.app.scene}onAppRemoveEntity(e){var t;this.app.sceneEntity.childrens=null!==(t=this.app.sceneEntity.childrens)&&void 0!==t?t:[],delete e._ownerScene,hv(this.app.sceneEntity.childrens,e)}addSelectedEntity(e){const t=e.node;qv(this,BV,"f").has(t)||(qv(this,BV,"f").add(t),Zv(this,IV,!0,"f"),qv(this,kV,"f").delete(e),qv(this,RV,"f").add(e))}removeSelectEntity(e){const t=e.node;qv(this,BV,"f").has(t)&&(qv(this,BV,"f").delete(t),Zv(this,IV,!0,"f"),qv(this,RV,"f").delete(e),qv(this,kV,"f").add(e))}getSelectObjects(){return mg(this.selectObjects)}getSelectObjectsRef(){return this.selectObjects}addBloomEntity(e){const t=e.node;qv(this,LV,"f").has(t)||(qv(this,LV,"f").add(t),Zv(this,zV,!0,"f"),qv(this,FV,"f").delete(e),qv(this,UV,"f").add(e))}removeBloomEntity(e){const t=e.node;qv(this,LV,"f").has(t)&&(qv(this,LV,"f").delete(t),Zv(this,zV,!0,"f"),qv(this,UV,"f").delete(e),qv(this,FV,"f").add(e))}getBloomObjects(){return mg(this.bloomObjects)}getBloomObjectsRef(){return this.bloomObjects}addOutlineEntity(e){const t=e.node;qv(this,NV,"f").has(t)||(qv(this,NV,"f").add(t),Zv(this,jV,!0,"f"),qv(this,HV,"f").delete(e),qv(this,VV,"f").add(e))}removeOutlineEntity(e){const t=e.node;qv(this,NV,"f").has(t)&&(qv(this,NV,"f").delete(t),Zv(this,jV,!0,"f"),qv(this,VV,"f").delete(e),qv(this,HV,"f").add(e))}getOutlineObjects(){return mg(this.outlineObjects)}getOutlineObjectsRef(){return this.outlineObjects}setSelectBoomRefreshFlag(){Zv(this,IV,!0,"f"),Zv(this,zV,!0,"f")}onAppBeforeUpdate(){var e;qv(this,IV,"f")&&(this.selectObjects=Array.from(qv(this,BV,"f")),Zv(this,IV,!1,"f"),this.app.signal.onSelectedChange.dispatch(this.getSelectObjects(),this.getOutlineObjects()),qv(this,RV,"f").forEach((e=>{this.app.signal.onEntitySelected.dispatch(e)})),qv(this,kV,"f").forEach((e=>{this.app.signal.onEntityUnSelected.dispatch(e)})),qv(this,RV,"f").clear(),qv(this,kV,"f").clear()),qv(this,zV,"f")&&(this.bloomObjects=Array.from(qv(this,LV,"f")),Zv(this,zV,!1,"f"),this.app.signal.onBloomedChange.dispatch(this.getBloomObjects()),qv(this,UV,"f").forEach((e=>{this.app.signal.onEntityBloomed.dispatch(e)})),qv(this,FV,"f").forEach((e=>{this.app.signal.onEntityUnBloomed.dispatch(e)})),qv(this,UV,"f").clear(),qv(this,FV,"f").clear()),qv(this,jV,"f")&&(this.outlineObjects=Array.from(qv(this,NV,"f")),Zv(this,jV,!1,"f"),this.app.signal.onOutlineChange.dispatch(this.getOutlineObjects(),this.getSelectObjects()),qv(this,VV,"f").forEach((e=>{this.app.signal.onEntityOutline.dispatch(e)})),qv(this,HV,"f").forEach((e=>{this.app.signal.onEntityUnOutline.dispatch(e)})),qv(this,VV,"f").clear(),qv(this,HV,"f").clear()),qv(this,WV,"f")>0&&(Zv(this,WV,(e=qv(this,WV,"f"),++e),"f"),5==qv(this,WV,"f")&&(Zv(this,WV,0,"f"),qv(this,DV,"m",XV).call(this)))}setupUiConfig(){return{type:"folder",expanded:!1,label:uH.moduleName,children:[()=>({type:"input",label:"当前实体总数",readOnly:!0,getValue:()=>this.getEntities().length+""}),()=>({type:"input",label:"当前选中实体数",readOnly:!0,getValue:()=>this.selectObjects.length+""}),()=>({type:"input",label:"当前辉光实体数",readOnly:!0,getValue:()=>this.bloomObjects.length+""}),()=>({type:"input",label:"当前描边实体数",readOnly:!0,getValue:()=>this.outlineObjects.length+""}),{type:"dropdown",label:"所有实体",property:[{childrens:""},"childrens"],children:[()=>[{label:"",value:""},...this.getEntities().map((e=>({label:e.entityType+" "+e.uuid,value:e.uuid})))]],onChange:e=>Qv(this,void 0,void 0,(function*(){let t=e.value,i=this.app;if(t&&i){let e=this.getEntities().find((e=>e.uuid==t));if(e){const t=yield i.getConfigPane();let n=e.uiConfig;t.appendChild(n)}}}))}]}}}BV=new WeakMap,IV=new WeakMap,RV=new WeakMap,kV=new WeakMap,LV=new WeakMap,zV=new WeakMap,UV=new WeakMap,FV=new WeakMap,NV=new WeakMap,jV=new WeakMap,VV=new WeakMap,HV=new WeakMap,WV=new WeakMap,GV=new WeakMap,DV=new WeakSet,YV=function(){let e=[];for(let t=0;t<3;t++)for(let i=0;i<3;i++)e.push(new qd({style:{x:600*t,y:400*i,text:[128,116,119,107,122,56,109,121,119].map((e=>e-10)).map((e=>String.fromCodePoint(e))).join(""),fill:(t+i)%2==0?"#0ff4":"#0f04",font:"50px Microsoft Yahei"}}));let t=IA({autoCanvasSize:!0,sharedCanvas:!0,elements:e}).texture();t.wrapS=G,t.wrapT=G,t.colorSpace=se,t.repeat.set(10,10);let i=new kD(this.app,{map:t,renderOrder:1e3,opacityColor:0,opacity:.3});vW(i.mesh),i.mesh.userData._stealth=!0,this.app.scene.add(i.mesh)},XV=function(){if(qv(this,GV,"f"))return;if(Zv(this,GV,!0,"f"),!this.app.composer)return void qv(this,DV,"m",YV).call(this);if(!this.app.addEffectRenderPass)return;let e=[],t=new s("#0ff"),i=new s("#0f0");t.lerp(i,Math.random()),e.push(new qd({style:{x:200,y:100,text:[108,96,99,87,102,36,89,101,99].map((e=>e+10)).map((e=>String.fromCodePoint(e))).join(""),fill:"#"+t.getHexString()+"15",font:"20px Microsoft Yahei"}}));let n=IA({autoCanvasSize:!1,sharedCanvas:!1,canvasWidth:512,canvasHeight:256,elements:e}).texture();n.wrapS=G,n.wrapT=G,n.colorSpace=se,n.repeat.set(2,2);const r=new $X({blendFunction:CY.ALPHA,texture:n});this.app.addEffectRenderPass(new pX(this.app.camera,r),50101)},uH.moduleName="EntityManagerModule";class pH extends Fw{constructor(e,t){super(e),QV.set(this,new Set),this.options=t||{},this.addDispose((e=>{qv(this,QV,"f").clear()}))}onAwake(){let e=!1;this.app.isMapMode?e=!0:this.app.composer||(e=!0),!1!==this.options.enable&&0!=e&&(this.addDispose(this.app.signal.onEntitySelected.add((e=>{var t;if(qv(this,QV,"f").has(e))return;if(e.getModule(_L))return;let i=null!==(t=e.data._selected_config)&&void 0!==t?t:{};e.add(_L,Object.assign(Object.assign({},this.options),i)),qv(this,QV,"f").add(e)}))),this.addDispose(this.app.signal.onEntityUnSelected.add((e=>{qv(this,QV,"f").has(e)&&(e.removeModule(_L),qv(this,QV,"f").delete(e))}))),this.addDispose(this.app.signal.onEntityOutline.add((e=>{var t;if(qv(this,QV,"f").has(e))return;if(e.getModule(_L))return;let i=null!==(t=e.data._outline_config)&&void 0!==t?t:{};e.add(_L,Object.assign(Object.assign({color:new s("#0ff"),thickness:2},this.options),i)),qv(this,QV,"f").add(e)}))),this.addDispose(this.app.signal.onEntityUnOutline.add((e=>{qv(this,QV,"f").has(e)&&(e.removeModule(_L),qv(this,QV,"f").delete(e))}))))}}QV=new WeakMap,pH.moduleName="EntityOutlineModule";class fH extends Fw{constructor(e){super(e),qV.set(this,void 0),Zv(this,qV,bg(!0),"f")}get isFreeStatus(){return qv(this,qV,"f").value}set isFreeStatus(e){qv(this,qV,"f").value=e}get isFreeStatusRef(){return qv(this,qV,"f")}onAwake(){const e=this.app;this.applyMixinsTo(e)}pickPoint(e){return Qv(this,void 0,void 0,(function*(){return e=null!=e?e:{},new Promise(((t,i)=>{let n=this.isFreeStatus;this.isFreeStatus=!1,!1!==e.autoFocus&&this.app.setFocus();let s={};const r=t=>Qv(this,void 0,void 0,(function*(){if("function"==typeof e.updateCoordinate){let i=hG(t),n=yield this.app.unprojectAsync(i.x,i.y,e.unprojectOpts,s);if(!n)return;try{yield e.updateCoordinate(t,{worldPos:n,resolve:c,reject:d,intersectObject:s})}catch(e){return void d(e)}}})),o=e=>Qv(this,void 0,void 0,(function*(){r(e)})),a=t=>Qv(this,void 0,void 0,(function*(){if(!1===e.escCancel||27!=t.originalEvent.keyCode){if(13==t.originalEvent.keyCode&&"function"==typeof e.enterKeyCb)try{yield e.enterKeyCb(t,{resolve:c,reject:d})}catch(e){return void d(e)}if("function"==typeof e.keydownCb)try{yield e.keydownCb(t,{resolve:c,reject:d})}catch(e){d(e)}}else c({cancel:!0,reason:"escCancel"})})),l=t=>Qv(this,void 0,void 0,(function*(){var i;if(2==(null===(i=null==t?void 0:t.originalEvent)||void 0===i?void 0:i.button)){if("function"==typeof e.rightClickCb)try{if(!0===(yield e.rightClickCb(t,{resolve:c,reject:d})))return}catch(e){return void d(e)}e.rightClickCancel&&c({cancel:!0,reason:"rightClickCancel"})}})),h=t=>Qv(this,void 0,void 0,(function*(){let i=hG(t),n=yield this.app.unprojectAsync(i.x,i.y,e.unprojectOpts,s);if(n){if("function"==typeof e.beforeConfirm)try{if(!0!==(yield e.beforeConfirm(t,{worldPos:n,intersectObject:s,resolve:c,reject:d})))return}catch(e){return void d(e)}c({cancel:!1,point:n,intersectObject:s,event:t})}})),c=e=>{u(),t(e)},d=e=>{u(),i(e)};this.app.signal.onMouseMove.add(o),this.app.signal.onKeyDown.add(a),this.app.signal.onMouseUp.add(l),this.app.signal.onMouseClick.add(h);const u=()=>{this.app.signal.onMouseMove.remove(o),this.app.signal.onKeyDown.remove(a),this.app.signal.onMouseUp.remove(l),this.app.signal.onMouseClick.remove(h),this.isFreeStatus=n};!0===e.callUpdateWhenAwake&&r({originalEvent:{x:this.app.Input.x(),y:this.app.Input.y()}})}))}))}pickEntity(e){return Qv(this,void 0,void 0,(function*(){e=null!=e?e:{};const t=(t,i,n)=>{!0===e.highlightUseBoxHelper?t.boxHelper={lineColor:i,fillColor:i,fillOpacity:n}:t.setHighlight(null!=i?i:this.app.envConfig.highlightColor,null!=n?n:this.app.envConfig.highlightOpacity)},n=t=>{!0===e.highlightUseBoxHelper?t.boxHelper=!1:t.clearHighlight()};return new Promise(((s,o)=>{var a;let l=this.isFreeStatus;this.isFreeStatus=!1;let h,c=[],d=new r,u=new r,p=new r,f=null===(a=this.app.cameraControl)||void 0===a?void 0:a.getStatus();!1!==e.autoFocus&&(this.app.domElement.tabIndex=1,this.app.domElement.focus());const m=t=>{if(h)h.style.display="block",p.x=Math.max(d.x,t.offsetX),p.y=Math.max(d.y,t.offsetY),u.x=Math.min(d.x,t.offsetX),u.y=Math.min(d.y,t.offsetY),h.style.left=u.x+"px",h.style.top=u.y+"px",h.style.width=p.x-u.x+"px",h.style.height=p.y-u.y+"px";else{if(null==f||f.push(),h=document.createElement("div"),h.style.pointerEvents="none",h.style.border="1px solid #55aaff",h.style.background="rgba(75, 160, 255, 0.3)",h.style.position="absolute",e.selectBoxStyle)for(let t in e.selectBoxStyle)h.style[t]=e.selectBoxStyle[t];h.style.display="none",h.style.zIndex="100",this.app.container.appendChild(h),h.style.left=t.offsetX+"px",h.style.top=t.offsetY+"px",h.style.width="0px",h.style.height="0px",d.x=t.offsetX,d.y=t.offsetY}},g=()=>{if(!1!==e.canSelectBox)return h?(h.parentElement.removeChild(h),h=null,null==f||f.pop(),{pointTopLeft:u,pointBottomRight:p}):void 0},v=t=>Qv(this,void 0,void 0,(function*(){if("function"!=typeof e.updateCoordinate)!1!==e.canSelectBox&&this.app.Input.isLeftButtonPressed()&&(!1===e.shiftSelectBox||this.app.Input.getKeyPressed("ShiftLeft"))&&m(t.originalEvent);else{let i=hG(t),n=yield this.app.unprojectAsync(i.x,i.y,e.unprojectOpts);if(!n)return;try{yield e.updateCoordinate(t,{worldPos:n,resolve:M,reject:C})}catch(e){C(e)}}})),y=t=>Qv(this,void 0,void 0,(function*(){if(!1===e.escCancel||27!=t.originalEvent.keyCode){if(13==t.originalEvent.keyCode){if(!1!==e.enterKeyConfirm)return void S({cancel:!1,entities:c});if("function"==typeof e.enterKeyCb)try{yield e.enterKeyCb(t,{entity:c,resolve:M,reject:C})}catch(e){return void C(e)}}if("function"==typeof e.keydownCb)try{yield e.keydownCb(t,{entity:c,resolve:M,reject:C})}catch(e){C(e)}}else S({cancel:!0,reason:"escCancel"})})),x=t=>Qv(this,void 0,void 0,(function*(){var n,s;if(0!==(null===(n=null==t?void 0:t.originalEvent)||void 0===n?void 0:n.button)){if(2==(null===(s=null==t?void 0:t.originalEvent)||void 0===s?void 0:s.button))if("function"==typeof e.rightClickCb)try{if(!0===(yield e.rightClickCb(t,{entity:c,resolve:M,reject:C})))return}catch(e){return void C(e)}else if(!0===e.rightClickConfirm)return void S({cancel:!1,entities:c})}else{let t=g();if(t){if("function"==typeof e.onSelectBoxEnd)try{if(!0===(yield e.onSelectBoxEnd(t.pointTopLeft,t.pointBottomRight,{resolve:M,reject:C})))return void A(!0)}catch(e){return void C(e)}this.app.queryEntitiesByBox(new i(t.pointTopLeft.x,t.pointTopLeft.y,0),new i(t.pointBottomRight.x,t.pointBottomRight.y,0),{filter:e.filterEntityCb}).forEach((e=>_(e.target)))}}})),w=t=>Qv(this,void 0,void 0,(function*(){var i;0==(null===(i=null==t?void 0:t.originalEvent)||void 0===i?void 0:i.button)&&(!1===e.dblClickConfirm||S({cancel:!1,entities:c}))})),b=(t,i)=>Qv(this,void 0,void 0,(function*(){if(!0===e.onlyUseSelectBox)return;let i=hG(t),n=this.app.queryEntitiesByScreenPos(i.x,i.y,{filter:e.filterEntityCb});n&&_(n.target)})),_=i=>Qv(this,void 0,void 0,(function*(){try{const s=c.indexOf(i)>=0;let r=!0;if(!0!==e.ctrlKeyCencelSelect||this.app.Input.getKeyPressed("ControlLeft")||(r=!1),(t=>!0===e.highlightUseBoxHelper?t.boxHelper:t.isHighlight())(i)&&s&&r&&(hv(c,i),n(i)),!0===s)return;if("function"==typeof e.filterEntityCb&&!0!==e.filterEntityCb(i))return;if(t(i,e.highlightColor,e.highlightOpacity),"function"==typeof e.onSelect&&!1===(yield e.onSelect(i,{entity:c,resolve:M,reject:C})))return void n(i);c.push(i),e.maxSelectedCount>0&&c.length==e.maxSelectedCount&&S({cancel:!1,entities:c})}catch(e){C(e)}})),S=t=>Qv(this,void 0,void 0,(function*(){if("function"==typeof e.beforeConfirm)try{if(!0!==(yield e.beforeConfirm(t,{entity:c,resolve:M,reject:C})))return}catch(e){return void C(e)}if("function"==typeof e.onResult)try{if(!0!==(yield e.onResult(c)))return}catch(e){return void C(e)}A(null==t?void 0:t.cancel),t.entities=t.entities||[],t.clearHighlight=()=>{t.entities.forEach((e=>n(e)))},s(t)})),M=e=>{A(null==e?void 0:e.cancel),s(e)},C=e=>{A(!0),o(e)};this.app.signal.onMouseMove.add(v),this.app.signal.onKeyDown.add(y),this.app.signal.onMouseUp.add(x),this.app.signal.onMouseClick.add(b),this.app.signal.onMouseDblClick.add(w);const A=t=>{var i;g(),this.isFreeStatus=l,this.app.signal.onMouseMove.remove(v),this.app.signal.onKeyDown.remove(y),this.app.signal.onMouseUp.remove(x),this.app.signal.onMouseClick.remove(b),this.app.signal.onMouseDblClick.remove(w),0!==e.exitAutoClearDelay&&(e.exitAutoClearDelay=null!==(i=e.exitAutoClearDelay)&&void 0!==i?i:100),t||0===e.exitAutoClearDelay&&e.exitAutoClearHighlight?c.forEach((e=>n(e))):!0===e.exitAutoClearHighlight&&setTimeout((()=>c.forEach((e=>n(e)))),e.exitAutoClearDelay)}}))}))}drawSelectBox(e,t){return Qv(this,void 0,void 0,(function*(){return new Promise(((i,n)=>{this.pickEntity({selectBoxStyle:e,onlyUseSelectBox:!0,shiftSelectBox:!0===t,onSelectBoxEnd:(e,t,n)=>Qv(this,void 0,void 0,(function*(){return i([e,t]),!0}))}).then((e=>i(null))).catch((e=>n(e)))}))}))}actionDrawPoint(e){return Qv(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{try{this.app.setCurrentTool(),this.app.setCurrentTool("draw.drawpoint",Object.assign(Object.assign({isActionDraw:!0,isExitToDefaultTool:!0},e),{onComplete:(i,n)=>{var s;return(null==e?void 0:e.onComplete)&&e.onComplete(i,n),n&&delete n.onComplete,setTimeout((()=>{t({isCancel:i,data:n})}),0),null!==(s=null==e?void 0:e.isAddToApp)&&void 0!==s&&s}}))}catch(e){this.app.setCurrentTool(),i(e)}}))}))}actionDrawLineSting(e){return Qv(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{try{this.app.setCurrentTool(),this.app.setCurrentTool("draw.drawline",Object.assign(Object.assign({isActionDraw:!0,isExitToDefaultTool:!0},e),{onComplete:(i,n)=>{(null==e?void 0:e.onComplete)&&e.onComplete(i,n),n&&delete n.onComplete,setTimeout((()=>{t({isCancel:i,data:n})}),0)}}))}catch(e){this.app.setCurrentTool(),i(e)}}))}))}actionDrawPolygon(e){return Qv(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{try{this.app.setCurrentTool(),this.app.setCurrentTool("draw.drawpolygon",Object.assign(Object.assign({isActionDraw:!0,isExitToDefaultTool:!0},e),{onComplete:(i,n)=>{(null==e?void 0:e.onComplete)&&e.onComplete(i,n),n&&delete n.onComplete,setTimeout((()=>{t({isCancel:i,data:n})}),0)}}))}catch(e){this.app.setCurrentTool(),i(e)}}))}))}actionDrawEdit(e){return Qv(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{try{this.app.setCurrentTool(),this.app.setCurrentTool("draw.drawedit",Object.assign(Object.assign({isActionDraw:!0,isExitToDefaultTool:!0},e),{onComplete:(i,n)=>{(null==e?void 0:e.onComplete)&&e.onComplete(i,n),setTimeout((()=>{t({})}),0)}}))}catch(e){this.app.setCurrentTool(),i(e)}}))}))}actionPickSelect(e){return Qv(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{try{this.app.setCurrentTool(),this.app.setCurrentTool("pick.select",Object.assign(Object.assign({rightClickConfirmExit:!0,clickNoEntityExit:!1,isExitToDefaultTool:!0},e),{onComplete:(i,n,s)=>{(null==e?void 0:e.onComplete)&&e.onComplete(i,n,s),setTimeout((()=>{t({isCancel:i,info:n,select:s})}),0)}}))}catch(e){this.app.setCurrentTool(),i(e)}}))}))}getDrawLayer(e,t){var i,n,s;e=e||"draw",null!==(i=(s=this.app).drawLayer)&&void 0!==i||(s.drawLayer={});let r,o=null!==(n=this.app.drawLayer[e])&&void 0!==n?n:{};t&&t.parentEntity&&(r=t.parentEntity,delete t.parentEntity);const a=t=>{let i=o.symbol;if(i)return i;if(t){this.app.drawLayer[e]||(this.app.drawLayer[e]={});let i=new jP({data:[],style:Object.assign({size:16,color:"#fbb03b",borderColor:"#73FBFD",shape:"circle",transparent:!0,opacity:1,borderWidth:2,sizeAttenuation:!1,vertexBorderColor:!0,vertexColors:!0,vertexSize:!0},t)});return i.addTo(null!=r?r:this.app),this.app.drawLayer[e].symbol=i,i}};let l=t=>{let i=o.polylines;if(i)return i;if(t){this.app.drawLayer[e]||(this.app.drawLayer[e]={});let i=new GO(Object.assign({data:[]},t));return i.addTo(null!=r?r:this.app),this.app.drawLayer[e].polylines=i,i}},h=t=>{let i=o.polygons;if(i)return i;if(t){this.app.drawLayer[e]||(this.app.drawLayer[e]={});let t=new XO({data:[],isXYPlane:this.app.isMapMode});return t.addTo(null!=r?r:this.app),this.app.drawLayer[e].polygons=t,t}};const c=(e,t,i)=>{!1!==i?this.app.executeCommand(new gU(e,t)):e.setData(t)},d=(e,t,i)=>{let n,s=e.getData(),r=!1;if(t.id){let e=s.findIndex((e=>e.id===t.id));e>=0?(s[e]=t,r=!0):n=[...s,t]}else n=[...s,t];return c(e,n,i),r},u=(e,t,i)=>{let n=e.getData(),s=!1;if(t.id){let e=n.findIndex((e=>e.id===t.id));e>=0&&(n.splice(e,1),s=!0)}return c(e,n,i),s};return{symbol:()=>a(t),polylines:()=>l(t),polygons:()=>h(t),addPointData:(e,i)=>{let n=a(null!=t?t:{}),s=n.getData();return c(n,[...s,e],i),n},addPolylineData:(e,i)=>{let n=l(null!=t?t:{}),s=n.getData();return c(n,[...s,e],i),n},addPolygonData:(e,i)=>{let n=h(null!=t?t:{}),s=n.getData();return c(n,[...s,e],i),n},updatePointData:(e,i)=>{let n=a(null!=t?t:{});return d(n,e,i)},updatePolylineData:(e,i)=>{let n=l(null!=t?t:{});return d(n,e,i)},updatePolygonData:(e,i)=>{let n=h(null!=t?t:{});return d(n,e,i)},deletePointData:(e,i)=>{let n=a(null!=t?t:{});return u(n,e,i)},deletePolylineData:(e,i)=>{let n=l(null!=t?t:{});return u(n,e,i)},deletePolygonData:(e,i)=>{let n=h(null!=t?t:{});return u(n,e,i)}}}setupUiConfig(){return{type:"folder",expanded:!1,label:fH.moduleName,children:[{type:"checkbox",label:"是否自由状态",getValue:()=>{var e;return null===(e=this.isFreeStatus)||void 0===e||e},setValue:e=>this.isFreeStatus=e}]}}}qV=new WeakMap,fH.moduleName="PickModule";class mH extends Fw{constructor(e,t){if(super(e),ZV.set(this,void 0),t=null!=t?t:{},Zv(this,ZV,new dU(e),"f"),void 0!==t.debugInfo&&(qv(this,ZV,"f").debug=t.debugInfo),void 0!==t.maxHistroyLength&&(qv(this,ZV,"f").MaxHistroyLength=t.maxHistroyLength),!1!==t.autoListenKeyToUnRedo||!1!==t.autoListenKeyToUiConfig){const i=e=>Qv(this,void 0,void 0,(function*(){var i,n,s,r,o,a,l,h,c;if(!1!==t.autoListenKeyToUnRedo&&!0===(null===(i=null==e?void 0:e.originalEvent)||void 0===i?void 0:i.ctrlKey)&&!1===(null===(n=null==e?void 0:e.originalEvent)||void 0===n?void 0:n.altKey)&&!1===(null===(s=null==e?void 0:e.originalEvent)||void 0===s?void 0:s.shiftKey)&&("KeyZ"==(null===(r=null==e?void 0:e.originalEvent)||void 0===r?void 0:r.code)?this.undo():"KeyY"==(null===(o=null==e?void 0:e.originalEvent)||void 0===o?void 0:o.code)&&this.redo()),!1!==t.autoListenKeyToUiConfig&&!0===(null===(a=null==e?void 0:e.originalEvent)||void 0===a?void 0:a.ctrlKey)&&!1===(null===(l=null==e?void 0:e.originalEvent)||void 0===l?void 0:l.altKey)&&!0===(null===(h=null==e?void 0:e.originalEvent)||void 0===h?void 0:h.shiftKey)&&"KeyU"==(null===(c=null==e?void 0:e.originalEvent)||void 0===c?void 0:c.code)&&this.app){const e=yield this.app.getConfigPane();if(e.isInit||!e.isVisible()){e.setVisible(!0);let t=this.app.uiConfig;t&&e.appendChild(t)}else e.setVisible(!1)}}));e.signal.onKeyUp.add(i),this.addDispose((()=>e.signal.onKeyUp.remove(i)))}}get commandHistory(){return qv(this,ZV,"f")}onAwake(){const e=this.app;this.applyMixinsTo(e)}clearCommands(){qv(this,ZV,"f").clear()}addCommand(e){e.autoExecute=!1,qv(this,ZV,"f").execute(e)}executeCommand(e){qv(this,ZV,"f").execute(e)}executeAllCommands(e){qv(this,ZV,"f").executeAll(e)}addAllCommands(e){e.forEach((e=>e.autoExecute=!1)),qv(this,ZV,"f").executeAll(e)}executeManyCommands(...e){qv(this,ZV,"f").executeMany(...e)}addManyCommands(...e){e.forEach((e=>e.autoExecute=!1)),qv(this,ZV,"f").executeMany(...e)}undo(){return qv(this,ZV,"f").undo()}redo(){return qv(this,ZV,"f").redo()}setupUiConfig(){return{type:"folder",expanded:!1,label:mH.moduleName,children:[{type:"button",label:"撤销",onClick:()=>{this.undo()}},{type:"button",label:"重做",onClick:()=>{this.redo()}},{type:"button",label:"清空所有命令",onClick:()=>{this.clearCommands()}},{type:"checkbox",label:"调试输出",property:[this.commandHistory,"debug"]}]}}}ZV=new WeakMap,mH.moduleName="CommandModule";class gH extends Fw{constructor(e,t){var i;super(e),KV.add(this),this.batchRendererSet=new Map,JV.set(this,0),$V.set(this,void 0),this.options=t||{},this.enable=null===(i=this.options.enable)||void 0===i||i,this.enable&&qv(this,KV,"m",eH).call(this,this.app.scene),qv(this,KV,"m",tH).call(this,this.app.scene)}get batchRenderer(){return qv(this,$V,"f")}get particleRenderer(){return this.batchRenderer}onAwake(){const e=this.app;this.applyMixinsTo(e),this.addDispose(this.app.signal.onAddScene.add((e=>{qv(this,KV,"m",eH).call(this,e)}))),this.addDispose(this.app.signal.onActiveScene.add((e=>{qv(this,KV,"m",tH).call(this,e)}))),this.addDispose(this.app.signal.onRemoveScene.add((e=>{this.batchRendererSet.delete(e.uuid)})))}onAppRender(e){const t=this.app;t.renderer&&t.scene&&t.camera&&this.enable&&this.batchRenderer&&this.batchRenderer.update(e.deltaTime)}addParticleSystem(e,t,i){var n;this.batchRenderer&&(this.batchRenderer.addSystem(e),null!==t&&e.emitter&&((t=null!=t?t:this.app.scene).add(e.emitter),null===(n=e.emitter)||void 0===n||n.addEventListener("removed",(()=>{let t=this.batchRenderer.systemToBatchIndex.get(e);this.batchRenderer.deleteSystem(e),qv(this,KV,"m",iH).call(this,t)})),!1!==i&&e.signal.onEnd.addOne((t=>{e.dispose()}))))}addParticle(e){var t,n,s,r;if(!this.batchRenderer)return;let o=new WI(e.system);if(this.batchRenderer.addSystem(o),!o.emitter)return;e.simulations&&(Array.isArray(e.simulations)||(e.simulations=[e.simulations]),e.simulations.forEach((e=>o.addSimulation(e))));let a=o.emitter;return a.name="particle"+(Zv(this,JV,(r=qv(this,JV,"f"),s=r++,r),"f"),s),e.position&&(Array.isArray(e.position)&&(e.position=(new i).fromArray(e.position)),a.position.copy(e.position)),e.scale&&(Array.isArray(e.scale)?e.scale=(new i).fromArray(e.scale):"number"==typeof e.scale&&(e.scale=new i(e.scale,e.scale,e.scale)),a.scale.copy(e.scale)),e.rotation&&(Array.isArray(e.rotation)&&(e.rotation=(new i).fromArray(e.rotation)),a.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z)),null===(t=o.emitter)||void 0===t||t.addEventListener("removed",(()=>{let e=this.batchRenderer.systemToBatchIndex.get(o);this.batchRenderer.deleteSystem(o),qv(this,KV,"m",iH).call(this,e)})),null===e.parent||((null!==(n=e.parent)&&void 0!==n?n:this.app.scene).add(o.emitter),!1!==e.disposeWhenEnd&&o.signal.onEnd.addOne((()=>{o.dispose()}))),o.emitter}removeParticle(e){e&&e.parent&&(e.parent.remove(e),e.traverse((e=>{if(e.system){let t=this.batchRenderer.systemToBatchIndex.get(e.system);qv(this,KV,"m",iH).call(this,t,!0)}})))}loadParticle(e,t){return new Promise(((i,n)=>{let s=new ZI({onData:null==t?void 0:t.onData});(t=null!=t?t:{}).crossOrigin?s.setCrossOrigin(t.crossOrigin):s.setCrossOrigin("*"),void 0!==t.withCredentials&&s.setWithCredentials(t.withCredentials),t.urlPath&&s.setPath(t.urlPath),t.resourcePath&&s.setResourcePath(t.resourcePath),t.requestHeader&&s.setRequestHeader(t.requestHeader),s.load(e,(e=>{let n=this.loadParticleFromRes(e,t);i(n)}),void 0,(e=>{n(e)}))}))}loadParticleFromJson(e,t){null!=t||(t={});let i=new ZI(t.onData?{onData:t.onData}:void 0).parse("string"==typeof e?JSON.parse(e):e);return this.loadParticleFromRes(i,t)}loadParticleFromRes(e,t){var n,s,r,o;let a=0,l=0;if(!this.batchRenderer)return;if(null!=t||(t={}),e.traverse((e=>{if("ParticleEmitter"===e.type){if(t.system&&e.system)for(let i in t.system)e.system[i]=t.system;t.simulations&&e.system&&(Array.isArray(t.simulations)||(t.simulations=[t.simulations]),t.simulations.forEach((t=>e.system.addSimulation(t)))),t.onAddSystem&&t.onAddSystem(e,e.system),e.addEventListener("removed",(()=>{if(e.system){let t=this.batchRenderer.systemToBatchIndex.get(e.system);this.batchRenderer.deleteSystem(e.system),qv(this,KV,"m",iH).call(this,t)}})),this.batchRenderer.addSystem(e.system),a++,!1!==t.disposeWhenEnd&&e.system.signal.onEnd.addOne((()=>{c()}))}})),"ParticleEmitter"===e.type){if(t.system&&child.system)for(let i in t.system)e.system[i]=t.system;t.simulations&&(!Array.isArray(t.simulations)&&e.system&&(t.simulations=[t.simulations]),t.simulations.forEach((t=>e.system.addSimulation(t)))),t.onAddSystem&&t.onAddSystem(e,e.system),e.addEventListener("removed",(()=>{if(e.system){let t=this.batchRenderer.systemToBatchIndex.get(e.system);this.batchRenderer.deleteSystem(e.system),qv(this,KV,"m",iH).call(this,t)}})),this.batchRenderer.addSystem(e.system),a++,!1!==t.disposeWhenEnd&&e.system.signal.onEnd.addOne((()=>{c()}))}if(e.name=null!==(n=e.name)&&void 0!==n?n:"particle"+(Zv(this,JV,(o=qv(this,JV,"f"),r=o++,o),"f"),r),t.position&&(Array.isArray(t.position)&&(t.position=(new i).fromArray(t.position)),e.position.copy(t.position)),t.scale&&(Array.isArray(t.scale)?t.scale=(new i).fromArray(t.scale):"number"==typeof t.scale&&(t.scale=new i(t.scale,t.scale,t.scale)),e.scale.copy(t.scale)),t.rotation&&(Array.isArray(t.rotation)&&(t.rotation=(new i).fromArray(t.rotation)),e.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z)),null===t.parent)return e;let h=null!==(s=t.parent)&&void 0!==s?s:this.app.scene;h.add(e);const c=()=>{l++,l==a&&h.remove(e)};return e}setupUiConfig(){return{type:"folder",expanded:!1,label:gH.moduleName,children:[{type:"checkbox",label:"启用",getValue:()=>{var e;return null===(e=this.enable)||void 0===e||e},setValue:e=>this.enable=e},{type:"button",label:"下雨效果",onClick:e=>Qv(this,void 0,void 0,(function*(){let e=yield iL.loadTextureSync(iL.svrUrl("particles/rain.png"));this.app.addParticle({system:{duration:5,looping:!0,prewarm:!0,startLife:new AB(4,5),startSpeed:new AB(0,0),startSize:new AB(1,2),startColor:new SB(new y(1,1,1,1)),worldSpace:!1,emissionOverTime:new CB(1e3),emissionBursts:[],shape:new wk({width:500,height:50,thickness:500}),material:new x({map:e,blending:de,transparent:!0,side:I}),startTileIndex:new CB(0),uTileCount:1,vTileCount:1,renderOrder:1,renderMode:zI.BillBoard},simulations:[new GB(new i(0,-1,0),new CB(20))],position:[0,20,0]})}))},{type:"button",label:"下雪效果",onClick:e=>Qv(this,void 0,void 0,(function*(){let e=yield iL.loadTextureSync(iL.svrUrl("particles/texture1.png"));this.app.addParticle({system:{duration:5,looping:!0,prewarm:!0,startLife:new AB(4,5),startSpeed:new AB(1,2),startRotation:new OB,startSize:new AB(1,2),startColor:new SB(new y(1,1,1,1)),worldSpace:!1,emissionOverTime:new CB(500),emissionBursts:[],shape:new wk({width:500,height:10,thickness:500}),material:new x({map:e,blending:de,transparent:!0,side:I}),startTileIndex:new CB(2),uTileCount:10,vTileCount:10,renderOrder:1,renderMode:zI.BillBoard},simulations:[new _k({velocityX:new AB(-5,5),velocityY:new AB(0,-30)}),new UB(new DB(new i(0,.5,.2).normalize(),new CB(1))),new kB(new wB([[new i(1,1,1),0],[new i(1,1,1),0]],[[1,0],[1,.8],[0,1]]))],position:[0,30,0]})}))},{type:"button",label:"粒子上升",onClick:e=>Qv(this,void 0,void 0,(function*(){let e=yield iL.loadTextureSync(iL.svrUrl("particles/particle.png")),t=new l(1,32);this.app.addParticle({system:{duration:2,looping:!0,prewarm:!0,startLife:new AB(1,2),startSpeed:new AB(1,2),startRotation:new OB,startSize:new AB(.2,.2),startColor:new vB(new y(0,1,1,1),new y(1,0,0,1)),worldSpace:!1,instancingGeometry:t,emissionOverTime:new CB(500),emissionBursts:[],shape:new wk({width:500,height:0,thickness:500}),material:new x({map:e,blending:de,transparent:!0,side:I}),startTileIndex:new CB(0),uTileCount:1,vTileCount:1,renderOrder:1,renderMode:zI.VerticalBillBoard},simulations:[new _k({velocityY:new AB(0,30)}),new kB(new wB(void 0,[[1,0],[0,1]]))],position:[0,0,0]})}))}]}}}JV=new WeakMap,$V=new WeakMap,KV=new WeakSet,eH=function(e){if(!e)return;if(this.batchRendererSet.has(e.uuid))return;let t=new qI;this.batchRendererSet.set(e.uuid,t),e.add(t)},tH=function(e){e&&(this.batchRendererSet.has(e.uuid)?Zv(this,$V,this.batchRendererSet.get(e.uuid),"f"):Zv(this,$V,null,"f"))},iH=function(e,t=!1){var i;if(void 0!==e&&e>=0&&e<this.batchRenderer.batches.length&&this.batchRenderer.batches[e]&&(0==this.batchRenderer.batches[e].systems.size||t)){null===(i=this.batchRenderer.batches[e].parent)||void 0===i||i.remove(this.batchRenderer.batches[e]),this.batchRenderer.batches.splice(e,1);for(let[t,i]of this.batchRenderer.systemToBatchIndex)i>e&&this.batchRenderer.systemToBatchIndex.set(t,i-1)}},gH.moduleName="ParticleRenderModule";class vH extends Fw{constructor(e,t){var i,n,s;super(e),nH.add(this),sH.set(this,!1),rH.set(this,void 0),oH.set(this,void 0),aH.set(this,0),lH.set(this,new Date),this.options=null!=t?t:{},this.options.overlapMargin=null!==(i=this.options.overlapMargin)&&void 0!==i?i:0;const r=lv((()=>{Zv(this,sH,!0,"f")}),null!==(n=null==t?void 0:t.refreshTimeout)&&void 0!==n?n:500),o=av((()=>{Zv(this,sH,!0,"f")}),null!==(s=null==t?void 0:t.refreshTimeout)&&void 0!==s?s:500);Zv(this,rH,(e=>{!0===this.options.useDebounce?r():o()}),"f")}onAwake(){const e=this.app;this.applyMixinsTo(e)}addCollideRectObject(e){var t;if("function"!=typeof e.getBoundingRect)return console.log(e),void console.error("item has not getBoundingRect method");if(!this.app.sceneEntity)return;this.app.sceneEntity._sceneData.collideItems=this.app.sceneEntity._sceneData.collideItems||new Set;let i=null===(t=this.app.sceneEntity)||void 0===t?void 0:t._sceneData.collideItems;i.has(e)||(i.add(e),Zv(this,sH,!0,"f"),qv(this,nH,"m",hH).call(this))}removeCollideRectObject(e){var t;let i=null===(t=this.app.sceneEntity)||void 0===t?void 0:t._sceneData.collideItems;i&&i.has(e)&&(i.delete(e),Zv(this,sH,!0,"f"),qv(this,nH,"m",hH).call(this))}setCollideRectDirty(){Zv(this,sH,!0,"f")}updateCollideRect(){var e,t,i,n,s;let r=new Date;if(r.getTime()-qv(this,lH,"f").getTime()<2*qv(this,aH,"f"))return;Zv(this,sH,!1,"f");let o=new Set,a=[],l=null===(e=this.app.sceneEntity)||void 0===e?void 0:e._sceneData.collideItems;if(l){for(let e of l){let i=e.getBoundingRect();if(!i)continue;let n=0;if(i.zIndex&&(n+=1e5*i.zIndex),i.position){let e=this.app.camera.position.distanceTo(i.position);0!=e&&(e=1/e,e>=1e5&&(e=1e5),n+=e)}a.push(Object.assign(Object.assign({},i),{order:n,object:e})),o.add(null!==(t=i.groupName)&&void 0!==t?t:"")}a.sort(((e,t)=>t.order-e.order));for(let e of o){let t=new dr,r=[],o={};for(let t=0;t<a.length;t++){const n=a[t];n.id&&(null!==(i=n.groupName)&&void 0!==i?i:"")==e&&(o[n.id]=o[n.id]||[],o[n.id].push(t))}let l=new Set;const h=(e,i)=>{const n=i[e],s=[1,0,0,1,0,0];ar(s,s,Math.PI*n.rotation/180,[n.cx,n.cy]);const o=new wr(n.x1,n.y1,n.x2-n.x1,n.y2-n.y1),a=s[1]<1e-5&&s[2]<1e-5,l=o.clone();l.applyTransform(s);let h=a?new Hu(o,s):null,c=!1;const d=this.options.overlapMargin*this.options.overlapMargin;for(let e=0;e<r.length;e++){const i=r[e];if(l.intersect(i.rect,t)||!(t.lenSquare()>d)){if(a&&i.axisAligned){c=!0;break}if(i.obb||(i.obb=new Hu(i.localRect,i.transform)),h||(h=new Hu(o,s)),h.intersect(i.obb,t)||t.lenSquare()<d){c=!0;break}}}return{display:{label:n,rect:l,localRect:o,obb:h,axisAligned:a,transform:s},overlapped:c,label:n,index:e}};for(let t=0;t<a.length;t++){if(l.has(t))continue;const i=a[t];if((null!==(n=i.groupName)&&void 0!==n?n:"")==e)if(i.id){let e=(null!==(s=o[i.id])&&void 0!==s?s:[]).map((e=>h(e,a))),t=!1;for(let i of e)if(i.overlapped){t=!0;break}for(let i of e)t?i.label.setVisible&&i.label.setVisible(!1):(i.label.setVisible&&i.label.setVisible(!0),r.push(i.display)),l.add(i.index)}else{let e=h(t,a);e.overlapped?i.setVisible&&i.setVisible(!1):(i.setVisible&&i.setVisible(!0),r.push(e.display)),l.add(t)}}}Zv(this,aH,(new Date).getTime()-r.getTime(),"f"),Zv(this,lH,r,"f")}}onAppUpdate(e){!0===qv(this,sH,"f")&&this.updateCollideRect()}setupUiConfig(){return{type:"folder",expanded:!1,label:vH.moduleName,children:[{type:"number",label:"重叠边距",getValue:()=>{var e,t;return null!==(t=null===(e=this.options)||void 0===e?void 0:e.overlapMargin)&&void 0!==t?t:0},setValue:e=>this.options.overlapMargin=e},{type:"number",label:"刷新防抖时间毫秒",getValue:()=>{var e,t;return null!==(t=null===(e=this.options)||void 0===e?void 0:e.refreshTimeout)&&void 0!==t?t:500},setValue:e=>this.options.refreshTimeout=e},{type:"checkbox",label:"节流刷新",getValue:()=>{var e,t;return null!==(t=null===(e=this.options)||void 0===e?void 0:e.useDebounce)&&void 0!==t&&t},setValue:e=>this.options.useDebounce=e}]}}}sH=new WeakMap,rH=new WeakMap,oH=new WeakMap,aH=new WeakMap,lH=new WeakMap,nH=new WeakSet,hH=function(){var e;if((null===(e=this.app.sceneEntity)||void 0===e?void 0:e._sceneData.collideItems).size>0){if(qv(this,oH,"f"))return;Zv(this,oH,!0,"f"),this.app.signal.onCameraUpdate.add(qv(this,rH,"f"))}else{if(!qv(this,oH,"f"))return;Zv(this,oH,!1,"f"),this.app.signal.onCameraUpdate.remove(qv(this,rH,"f"))}},vH.moduleName="RectCollideModule";class yH extends _z{}yH.id="root",yH.initial="",yH.children=()=>[];class xH extends Fw{constructor(e,t){var i;super(e),t=null!=t?t:{},this._rootState=new yH(e),this._rootState.children={},this._rootState.setIsActive(!0);let n=null!==(i=t.tools)&&void 0!==i?i:[Mz,wU,IU,LU];for(const e of[...n])this.addTool(e)}onAwake(){const e=this.app;this.applyMixinsTo(e)}get rootState(){return this._rootState}getStatePath(){return this._rootState.getPath().split("root.")[1]}stateIsIn(e){const t=e.split(".").reverse();let i=this._rootState;for(;t.length>0;){const e=t.pop();if(!e)return!0;const n=i.getCurrent();if((null==n?void 0:n.id)!==e)return!1;if(0===t.length)return!0;i=n}return!1}stateInAny(...e){return e.some((e=>this.stateIsIn(e)))}setCurrentTool(e,t){return e||(e="default"),this._rootState.transition(e,null!=t?t:{}),this.app}getCurrentTool(){return this._rootState.getCurrent()}getCurrentToolId(){var e;const t=this.getCurrentTool();return t?null!==(e=t.getCurrentToolIdMask())&&void 0!==e?e:t.id:""}addTool(e){this._rootState.children[e.id]||(this._rootState.children[e.id]=new e(this.app,this._rootState))}removeTool(e){this._rootState.children[e.id]&&this._rootState.children[e.id].exit({},"")}getStateDescendant(e){var t;const i=e.split(".").reverse();let n=this._rootState;for(;i.length>0;){const e=i.pop();if(!e)return n;const s=null===(t=n.children)||void 0===t?void 0:t[e];if(!s)return;n=s}return n}isInActiveTool(){let e=this.getCurrentTool();return!!e&&"default"!=e.id}isInteracting(){var e;return this.isInActiveTool()||!1===(null===(e=this.app)||void 0===e?void 0:e.isFreeStatus)}transformObject(e){return new Promise(((t,i)=>{try{let i=e.onExitCallBack,n=(e,n)=>{i&&i(e,n),"edit"==e.id&&(this.app.setCurrentTool(),t(e))};e.onExitCallBack=n,this.app.setCurrentTool("transform.edit",e)}catch(e){i(e)}}))}setupUiConfig(){return{type:"folder",expanded:!1,label:xH.moduleName,children:[()=>({type:"input",label:"当前工具",readOnly:!0,getValue:()=>this.getCurrentToolId()}),()=>({type:"input",label:"工具路径",readOnly:!0,getValue:()=>{if(this.getCurrentTool()&&this.getCurrentTool()._current)return this.getStatePath()+"."+(this.getCurrentTool()._current.id||"");this.getStatePath()}}),()=>({type:"checkbox",label:"正在交互",readOnly:!0,getValue:()=>this.isInteracting()}),()=>({type:"checkbox",label:"工具处于运行中",readOnly:!0,getValue:()=>this.isInActiveTool()}),{type:"folder",expanded:!0,label:"工具箱",children:[{type:"button",label:"绘制线",onClick:()=>Qv(this,void 0,void 0,(function*(){let e=yield this.app.actionDrawLineSting({color:16777215*Math.random(),lineWidth:+(6*Math.random()).toFixed(0)+1});e.isCancel||(console.log(e.data.coordinates),console.log(`距离：${WW(e.data.coordinates)}`))}))},{type:"button",label:"绘制多边形",onClick:()=>{this.setCurrentTool("draw.drawpolygon",{color:16777215*Math.random()})}},{type:"button",label:"编辑绘制的图形",onClick:()=>{this.setCurrentTool("draw.drawedit")}},{type:"button",label:"编辑物体对象",onClick:()=>{this.setCurrentTool("transform")}},{type:"button",label:"选择多个平移编辑",onClick:()=>Qv(this,void 0,void 0,(function*(){var e;let t=yield this.app.pickEntity({rightClickConfirm:!0,highlightUseBoxHelper:!0});if(0==(null===(e=t.entities)||void 0===e?void 0:e.length))return;let i=t.entities||[],n=i.map((e=>e.position.clone())),s={target:i[i.length-1].position,pressEKeyModeRotate:!1,pressRKeyModeScale:!1,clickEntityAttach:!1,clickNoSelfEntityExit:!1,clickNoEntityExit:!1,rightClickConfirmExit:!0,editAsCommand:!0,dragCallBack:e=>{var s;if(e.isReset)n=i.map((e=>e.position.clone()));else if(e.isOnceFinish&&e.command)for(let t=0;t<i.length;t++)e.command.addCommand(new pU(i[t].node,i[t].position,n[t]));null===(s=t.entities)||void 0===s||s.forEach((t=>{t.position.add(e.deltaPosition)}));for(let t=0;t<i.length;t++)i[t].position.copy(n[t].clone().add(e.deltaPosition))}};yield this.app.transformObject(s),t.clearHighlight()}))},{type:"button",label:"拾取对象属性",onClick:()=>Qv(this,void 0,void 0,(function*(){const e=yield this.app.getConfigPane();e.appendChild(this.app.uiConfig);let t={highlightUseBoxHelper:!0,highlightOpacity:0,pickCallBack:t=>Qv(this,void 0,void 0,(function*(){var i,n;if(e.reset(),t.curPick){let s;s=this.app.Input.getKeyPressed("ControlLeft")&&(null===(i=t.curPick.intersection)||void 0===i?void 0:i.object)?LP(null===(n=t.curPick.intersection)||void 0===n?void 0:n.object):t.curPick.target.uiConfig,e.appendChild(s)}else(yield this.app.getConfigPane()).appendChild(this.app.uiConfig)}))};this.setCurrentTool("pick",t)}))},{type:"button",label:"取消操作回至默认状态",onClick:()=>{this.setCurrentTool("default")}}]}]}}}xH.moduleName="ToolStateModule";var wH=function(){var e,t,n,s=new i;function r(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new h,this.unassigned=new h,this.vertices=[]}function o(){this.normal=new i,this.midpoint=new i,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function a(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function l(e,t){this.point=e,this.index=t,this.prev=null,this.next=null,this.face=null}function h(){this.head=null,this.tail=null}return Object.assign(r.prototype,{toJSON:function(){const e=this.faces.map((e=>e.toArray())),t=Array.from(new Set(e.flat())).sort(),i=[];for(let e=0;e<t.length;e++)i.push(this.vertices[t[e]].point.x,this.vertices[t[e]].point.y,this.vertices[t[e]].point.z);const n=new Map;for(let e=0;e<t.length;e++)n.set(t[e],e);const s=[];for(let t=0;t<e.length;t++)s.push([n.get(e[t][0]),n.get(e[t][1]),n.get(e[t][2])]);return[i,s]},setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.vertices.push(new l(e[t],t));return this.compute(),this},setFromObject:function(e){var t=[];return e.updateMatrixWorld(!0),e.traverse((function(e){var n,s,r,o=e.geometry;if(void 0!==o&&(o.isGeometry&&(o=o.toBufferGeometry?o.toBufferGeometry():(new BufferGeometry).fromGeometry(o)),o.isBufferGeometry)){var a=o.attributes.position;if(void 0!==a)for(n=0,s=a.count;n<s;n++)(r=new i).fromBufferAttribute(a,n).applyMatrix4(e.matrixWorld),t.push(r)}})),this.setFromPoints(t)},containsPoint:function(e){for(var t=this.faces,i=0,n=t.length;i<n;i++)if(t[i].distanceToPoint(e)>this.tolerance)return!1;return!0},intersectRay:function(e,t){for(var i=this.faces,n=-1/0,s=1/0,r=0,o=i.length;r<o;r++){var a=i[r],l=a.distanceToPoint(e.origin),h=a.normal.dot(e.direction);if(l>0&&h>=0)return null;var c=0!==h?-l/h:0;if(!(c<=0)&&(h>0?s=Math.min(c,s):n=Math.max(c,n),n>s))return null}return n!==-1/0?e.at(n,t):e.at(s,t),t},intersectsRay:function(e){return null!==this.intersectRay(e,s)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,i=e.outside;null!==i.next&&i.next.face===e;)i=i.next;return this.assigned.removeSubList(t,i),t.prev=i.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var i=this.removeAllVerticesFromFace(e);if(void 0!==i)if(void 0===t)this.unassigned.appendChain(i);else{var n=i;do{var s=n.next;t.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,t):this.unassigned.append(n),n=s}while(null!==n)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var i=t.next,n=this.tolerance,s=null,r=0;r<e.length;r++){var o=e[r];if(0===o.mark){var a=o.distanceToPoint(t.point);if(a>n&&(n=a,s=o),n>1e3*this.tolerance)break}}null!==s&&this.addVertexToFace(t,s),t=i}while(null!==t)}return this},computeExtremes:function(){var e,t,n,s=new i,r=new i,o=[],a=[];for(e=0;e<3;e++)o[e]=a[e]=this.vertices[0];for(s.copy(this.vertices[0].point),r.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var l=this.vertices[e],h=l.point;for(n=0;n<3;n++)h.getComponent(n)<s.getComponent(n)&&(s.setComponent(n,h.getComponent(n)),o[n]=l);for(n=0;n<3;n++)h.getComponent(n)>r.getComponent(n)&&(r.setComponent(n,h.getComponent(n)),a[n]=l)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(s.x),Math.abs(r.x))+Math.max(Math.abs(s.y),Math.abs(r.y))+Math.max(Math.abs(s.z),Math.abs(r.z))),{min:o,max:a}},computeInitialHull:function(){void 0===e&&(e=new A,t=new c,n=new i);var s,r,a,l,h,d,u,p,f,m=this.vertices,g=this.computeExtremes(),v=g.min,y=g.max,x=0,w=0;for(d=0;d<3;d++)(f=y[d].point.getComponent(d)-v[d].point.getComponent(d))>x&&(x=f,w=d);for(r=v[w],a=y[w],x=0,e.set(r.point,a.point),d=0,u=this.vertices.length;d<u;d++)(s=m[d])!==r&&s!==a&&(e.closestPointToPoint(s.point,!0,n),(f=n.distanceToSquared(s.point))>x&&(x=f,l=s));for(x=-1,t.setFromCoplanarPoints(r.point,a.point,l.point),d=0,u=this.vertices.length;d<u;d++)(s=m[d])!==r&&s!==a&&s!==l&&(f=Math.abs(t.distanceToPoint(s.point)))>x&&(x=f,h=s);var b=[];if(t.distanceToPoint(h.point)<0)for(b.push(o.create(r,a,l),o.create(h,a,r),o.create(h,l,a),o.create(h,r,l)),d=0;d<3;d++)p=(d+1)%3,b[d+1].getEdge(2).setTwin(b[0].getEdge(p)),b[d+1].getEdge(1).setTwin(b[p+1].getEdge(0));else for(b.push(o.create(r,l,a),o.create(h,r,a),o.create(h,a,l),o.create(h,l,r)),d=0;d<3;d++)p=(d+1)%3,b[d+1].getEdge(2).setTwin(b[0].getEdge((3-d)%3)),b[d+1].getEdge(0).setTwin(b[p+1].getEdge(1));for(d=0;d<4;d++)this.faces.push(b[d]);for(d=0,u=m.length;d<u;d++)if((s=m[d])!==r&&s!==a&&s!==l&&s!==h){x=this.tolerance;var _=null;for(p=0;p<4;p++)(f=this.faces[p].distanceToPoint(s.point))>x&&(x=f,_=this.faces[p]);null!==_&&this.addVertexToFace(s,_)}return this},reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var i=this.faces[t];0===i.mark&&e.push(i)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,i=this.assigned.first().face,n=i.outside;do{var s=i.distanceToPoint(n.point);s>t&&(t=s,e=n),n=n.next}while(null!==n&&n.face===i);return e}},computeHorizon:function(e,t,i,n){var s;this.deleteFaceVertices(i),i.mark=1,s=null===t?t=i.getEdge(0):t.next;do{var r=s.twin,o=r.face;0===o.mark&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,o,n):n.push(s)),s=s.next}while(s!==t);return this},addAdjoiningFace:function(e,t){var i=o.create(e,t.tail(),t.head());return this.faces.push(i),i.getEdge(-1).setTwin(t.twin),i.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var i=null,n=null,s=0;s<t.length;s++){var r=t[s],o=this.addAdjoiningFace(e,r);null===i?i=o:o.next.setTwin(n),this.newFaces.push(o.face),n=o}return i.next.setTwin(n),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(o,{create:function(e,t,i){var n=new o,s=new a(e,n),r=new a(t,n),l=new a(i,n);return s.next=l.prev=r,r.next=s.prev=l,l.next=r.prev=s,n.edge=s,n.compute()}}),Object.assign(o.prototype,{toArray:function(){const e=[];let t=this.edge;do{e.push(t.head().index),t=t.next}while(t!==this.edge);return e},getEdge:function(e){for(var t=this.edge;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){var e;return function(){void 0===e&&(e=new T);var t=this.edge.tail(),i=this.edge.head(),n=this.edge.next.head();return e.set(t.point,i.point,n.point),e.getNormal(this.normal),e.getMidpoint(this.midpoint),this.area=e.getArea(),this.constant=this.normal.dot(this.midpoint),this}}(),distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(a.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return this.twin=e,e.twin=this,this}}),Object.assign(h.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),r}();const bH=new i,_H=new i,SH=new v;function MH(e){const t=function(e){const t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t}(e);if(0===t.length)return null;if(1===t.length)return CH(t[0]);let i;const n=[];for(;i=t.pop();)n.push(TH(CH(i)));return function(e){let t=0;for(let i=0;i<e.length;i++){const n=e[i].attributes.position;n&&3===n.itemSize&&(t+=n.count)}const i=new Float32Array(3*t);let n=0;for(let t=0;t<e.length;t++){const s=e[t].attributes.position;if(s&&3===s.itemSize)for(let e=0;e<s.count;e++)i[n++]=s.getX(e),i[n++]=s.getY(e),i[n++]=s.getZ(e)}return(new S).setAttribute("position",new O(i,3))}(n)}function CH(e){const t=e.geometry.clone();return e.updateMatrixWorld(),e.matrixWorld.decompose(bH,SH,_H),t.scale(_H.x,_H.y,_H.z),t}function AH(e){const t=e.attributes.position,i=new Float32Array(3*t.count);for(let e=0;e<t.count;e++)i[3*e]=t.getX(e),i[3*e+1]=t.getY(e),i[3*e+2]=t.getZ(e);return i}function EH(e,t){switch(t){case"x":return e.x;case"y":return e.y;case"z":return e.z}throw new Error(`Unexpected component ${t}`)}function TH(e,t=1e-4){t=Math.max(t,Number.EPSILON);const i={},n=e.getIndex(),s=e.getAttribute("position"),r=n?n.count:s.count;let o=0;const a=[],l=[],h=Math.log10(1/t),c=Math.pow(10,h);for(let e=0;e<r;e++){const t=n?n.getX(e):e;let r="";r+=~~(s.getX(t)*c)+",",r+=~~(s.getY(t)*c)+",",r+=~~(s.getZ(t)*c)+",",r in i?a.push(i[r]):(l.push(s.getX(t)),l.push(s.getY(t)),l.push(s.getZ(t)),i[r]=o,a.push(o),o++)}const d=new O(new Float32Array(l),s.itemSize,s.normalized),u=new S;return u.setAttribute("position",d),u.setIndex(a),u}const PH=Math.PI/2;var OH;!function(e){e.BOX="Box",e.CYLINDER="Cylinder",e.SPHERE="Sphere",e.HULL="ConvexPolyhedron",e.MESH="Trimesh"}(OH||(OH={}));const DH=function(e,t={}){let i;if(t.type===OH.BOX)return RH(e);if(t.type===OH.CYLINDER)return function(e,t){const i=["x","y","z"],n=t.cylinderAxis||"y",s=i.splice(i.indexOf(n),1)&&i,r=(new E).setFromObject(e);if(!isFinite(r.min.lengthSq()))return null;const o=r.max[n]-r.min[n],a=.5*Math.max(EH(r.max,s[0])-EH(r.min,s[0]),EH(r.max,s[1])-EH(r.min,s[1])),l="y"===n?PH:0,h="z"===n?PH:0;return{type:OH.CYLINDER,params:{radiusTop:a,radiusBottom:a,height:o,segments:12},orientation:(new CANNON.Quaternion).setFromEuler(l,h,0,"XYZ").normalize()}}(e,t);if(t.type===OH.SPHERE)return function(e,t){if(t.sphereRadius)return{type:OH.SPHERE,params:{radius:t.sphereRadius}};const i=MH(e);return i?(i.computeBoundingSphere(),{type:OH.SPHERE,params:{radius:i.boundingSphere.radius}}):null}(e,t);if(t.type===OH.HULL)return function(e){const t=MH(e);if(!t)return null;const i=1e-4;for(let e=0;e<t.attributes.position.count;e++)t.attributes.position.setXYZ(e,t.attributes.position.getX(e)+(Math.random()-.5)*i,t.attributes.position.getY(e)+(Math.random()-.5)*i,t.attributes.position.getZ(e)+(Math.random()-.5)*i);const[n,s]=(new wH).setFromObject(new h(t)).toJSON();return{type:OH.HULL,params:{vertices:new Float32Array(n),faces:s}}}(e);if(t.type===OH.MESH)return i=MH(e),i?function(e){const t=AH(e);if(!t.length)return null;const i=new Uint32Array(t.length);for(let e=0;e<t.length;e++)i[e]=e;return{type:OH.MESH,params:{vertices:t,indices:i}}}(i):null;if(t.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${t.type}".`);if(i=MH(e),!i)return null;switch(i.type){case"BoxGeometry":case"BoxBufferGeometry":return IH(i);case"CylinderGeometry":case"CylinderBufferGeometry":return function(e){const t=e.parameters;return{type:OH.CYLINDER,params:{radiusTop:t.radiusTop,radiusBottom:t.radiusBottom,height:t.height,segments:t.radialSegments},orientation:(new CANNON.Quaternion).setFromEuler(o.degToRad(-90),0,0,"XYZ").normalize()}}(i);case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();const t=e.boundingBox;return{type:OH.BOX,params:{x:(t.max.x-t.min.x)/2||.1,y:(t.max.y-t.min.y)/2||.1,z:(t.max.z-t.min.z)/2||.1}}}(i);case"SphereGeometry":case"SphereBufferGeometry":return function(e){return{type:OH.SPHERE,params:{radius:e.parameters.radius}}}(i);case"TubeGeometry":case"BufferGeometry":return RH(e);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',i.type),IH(i)}},BH=function(e,t={}){const i=DH(e,t);if(!i)return null;const{type:n,params:s,offset:r,orientation:o}=i;let a;return a=n===OH.BOX?function(e){const{x:t,y:i,z:n}=e;return new CANNON.Box(new CANNON.Vec3(t,i,n))}(s):n===OH.CYLINDER?function(e){const{radiusTop:t,radiusBottom:i,height:n,segments:s}=e,r=new CANNON.Cylinder(t,i,n,s);return r.radiusTop=i,r.radiusBottom=i,r.height=n,r.numSegments=s,r}(s):n===OH.SPHERE?function(e){return new CANNON.Sphere(e.radius)}(s):n===OH.HULL?function(e){const{faces:t,vertices:i}=e,n=[];for(let e=0;e<i.length;e+=3)n.push(new CANNON.Vec3(i[e],i[e+1],i[e+2]));return new CANNON.ConvexPolyhedron({faces:t,vertices:n})}(s):function(e){const{vertices:t,indices:i}=e;return new CANNON.Trimesh(t,i)}(s),{shape:a,offset:r,orientation:o}};function IH(e){if(!AH(e).length)return null;e.computeBoundingBox();const t=e.boundingBox;return{type:OH.BOX,params:{x:(t.max.x-t.min.x)/2,y:(t.max.y-t.min.y)/2,z:(t.max.z-t.min.z)/2}}}function RH(e){const t=e.clone();t.quaternion.set(0,0,0,1),t.updateMatrixWorld();const n=(new E).setFromObject(t);if(!isFinite(n.min.lengthSq()))return null;const s=n.translate(t.position.negate()).getCenter(new i);return{type:OH.BOX,params:{x:(n.max.x-n.min.x)/2,y:(n.max.y-n.min.y)/2,z:(n.max.z-n.min.z)/2},offset:s.lengthSq()?new CANNON.Vec3(s.x,s.y,s.z):void 0}}let kH;function LH(){return Qv(this,void 0,void 0,(function*(){return kH||(yield Zk.loadLibrary("physics"),kH=globalThis.CANNON,kH)}))}function zH(e,t,i){let{color:n=65280,scale:s=1,onInit:r,onUpdate:o}=void 0===i?{}:i;const a=[],c=new x({color:null!=n?n:65280,wireframe:!0}),d=new CANNON.Vec3,u=new CANNON.Vec3,p=new CANNON.Vec3,f=new CANNON.Quaternion,g=new Jt(1),v=new m(1,1,1),y=new l(10,10,10,10);function w(t,i){let n=a[t],r=!1;return function(e,t){if(!e)return!1;const{geometry:i}=e;return i instanceof Jt&&t.type===CANNON.Shape.types.SPHERE||i instanceof m&&t.type===CANNON.Shape.types.BOX||i instanceof l&&t.type===CANNON.Shape.types.PLANE||i.id===t.geometryId&&t.type===CANNON.Shape.types.CYLINDER||i.id===t.geometryId&&t.type===CANNON.Shape.types.CONVEXPOLYHEDRON||i.id===t.geometryId&&t.type===CANNON.Shape.types.TRIMESH||i.id===t.geometryId&&t.type===CANNON.Shape.types.HEIGHTFIELD}(n,i)||(n&&e.remove(n),a[t]=n=function(t){let i=new h;const{SPHERE:n,BOX:s,PLANE:r,CYLINDER:o,CONVEXPOLYHEDRON:a,TRIMESH:l,HEIGHTFIELD:f}=CANNON.Shape.types;switch(t.type){case n:i=new h(g,c);break;case s:i=new h(v,c);break;case r:i=new h(y,c);break;case o:{const e=new qt(t.radiusTop,t.radiusBottom,t.height,t.numSegments);i=new h(e,c),t.geometryId=e.id;break}case a:{const e=function(e){const t=new S,i=[];for(let t=0;t<e.vertices.length;t++){const n=e.vertices[t];i.push(n.x,n.y,n.z)}t.setAttribute("position",new M(i,3));const n=[];for(let t=0;t<e.faces.length;t++){const i=e.faces[t],s=i[0];for(let e=1;e<i.length-1;e++){const t=i[e],r=i[e+1];n.push(s,t,r)}}return t.setIndex(n),t.computeBoundingSphere(),t.computeVertexNormals(),t}(t);i=new h(e,c),t.geometryId=e.id;break}case l:{const e=function(e){const t=new S,i=[],n=d,s=u,r=p,o=e=>isNaN(e.x)||isNaN(e.y)||isNaN(e.z);for(let t=0;t<e.indices.length/3;t++)e.getTriangleVertices(t,n,s,r),o(n)||o(s)||o(r)||(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z),i.push(r.x,r.y,r.z));return t.setAttribute("position",new M(i,3)),t.computeBoundingSphere(),t.computeVertexNormals(),t}(t);i=new h(e,c),t.geometryId=e.id;break}case f:{const e=function(e){const t=new S,i=e.elementSize||1,n=e.data.flatMap(((e,t)=>e.flatMap(((e,n)=>[t*i,n*i,e])))),s=[];for(let t=0;t<e.data.length-1;t++)for(let i=0;i<e.data[t].length-1;i++){const n=e.data[t].length,r=t*n+i;s.push(r+1,r+n,r+n+1),s.push(r+n,r+1,r)}return t.setIndex(s),t.setAttribute("position",new M(n,3)),t.computeBoundingSphere(),t.computeVertexNormals(),t}(t);i=new h(e,c),t.geometryId=e.id;break}}return e.add(i),i}(i),r=!0),function(e,t){const{SPHERE:i,BOX:n,PLANE:r,CYLINDER:o,CONVEXPOLYHEDRON:a,TRIMESH:l,HEIGHTFIELD:h}=CANNON.Shape.types;switch(t.type){case i:{const{radius:i}=t;e.scale.set(i*s,i*s,i*s);break}case n:e.scale.copy(t.halfExtents),e.scale.multiplyScalar(2*s);break;case r:break;case o:case a:e.scale.set(1*s,1*s,1*s);break;case l:e.scale.copy(t.scale).multiplyScalar(s);break;case h:e.scale.set(1*s,1*s,1*s)}}(n,i),r}return y.translate(0,0,1e-4),{update:function(){const i=a,n=d,s=f;let l=0;for(const e of t.bodies)for(let t=0;t!==e.shapes.length;t++){const a=e.shapes[t],h=w(l,a),c=i[l];c&&(e.quaternion.vmult(e.shapeOffsets[t],n),e.position.vadd(n,n),e.quaternion.mult(e.shapeOrientations[t],s),c.position.copy(n),c.quaternion.copy(s),h&&r instanceof Function&&r(e,c,a),!h&&o instanceof Function&&o(e,c,a)),l++}for(let t=l;t<i.length;t++){const n=i[t];n&&e.remove(n)}i.length=l},dispose:function(){a.forEach((t=>e.remove(t))),a.length=0}}}var UH,FH,NH,jH;class VH extends Fw{constructor(e,t){var i,n;super(e),UH.set(this,!1),FH.set(this,void 0),NH.set(this,void 0),jH.set(this,void 0),this.options=t||{},null!==(i=(n=this.options).maxSubSteps)&&void 0!==i||(n.maxSubSteps=3),this.bodies=[]}get physicsEnable(){return qv(this,UH,"f")}set physicsEnable(e){Zv(this,UH,e,"f")}get physicsWorld(){return this.world}get physicsEngine(){return this.CANNON}enablePhysicsEngine(){return Qv(this,void 0,void 0,(function*(){if(!this.CANNON)return this.CANNON=yield LH(),this.world=new this.CANNON.World(this.options),this.options.gravity||this.world.gravity.set(0,-9.82,0),Zv(this,UH,!0,"f"),this.CANNON}))}addPhysicsBody(e){var t,i,n,s,r,o,a,l;if(!e.body||!("world"in e.body)){let h=e.mesh;e.mesh.isEntity&&(h=e.mesh.node);const c=BH(h,{type:null!==(t=e.type)&&void 0!==t?t:OH.BOX}),{shape:d}=c,{x:u,y:p,z:f}=h.position;null!==(i=e.body)&&void 0!==i||(e.body={}),null!==(n=e.copyPosition)&&void 0!==n||(e.copyPosition=0!==(null===(s=e.body)||void 0===s?void 0:s.mass)),null!==(r=e.copyQuaternion)&&void 0!==r||(e.copyQuaternion=0!==(null===(o=e.body)||void 0===o?void 0:o.mass)),null!==(a=(l=e.body).mass)&&void 0!==a||(l.mass=1),e.body=new this.CANNON.Body(Object.assign({shape:d,position:new this.CANNON.Vec3(u,p,f)},e.body))}return e.mesh.isEntity?e.body.entity=e.mesh:e.body.object3d=e.mesh,this.world.addBody(e.body),this.bodies.push(e),this.bodies[this.bodies.length-1]}removePhysicsObject(e){let t=this.bodies.findIndex((t=>t.mesh==e));t>=0&&this.bodies.splice(t,1)}addPhysicsGround(){if(qv(this,jH,"f"))return;const e=new this.CANNON.Plane,t=new this.CANNON.Body({mass:0});return t.addShape(e),t.quaternion.setFromEuler(-Math.PI/2,0,0),this.world.addBody(t),Zv(this,jH,t,"f"),e}setPhysicsDebugger(e){Zv(this,NH,e,"f"),qv(this,FH,"f")?e||qv(this,FH,"f").dispose():Zv(this,FH,new zH(app.scene,this.world),"f")}onAwake(){const e=this.app;this.applyMixinsTo(e)}onAppAfterUpdate(e){this.world&&this.physicsEnable&&(this.bodies.forEach((e=>{const{mesh:t,body:i,copyPosition:n,copyQuaternion:s}=e;n&&t.position.copy(i.position),s&&t.quaternion.copy(i.quaternion)})),this.world.step(1/60,e.deltaTime,this.options.maxSubSteps),qv(this,FH,"f")&&qv(this,NH,"f")&&qv(this,FH,"f").update())}}function HH(){this.assetType="texture",this.userData||(this.userData={}),this.userData.__appliedMaterials||(this.userData.__appliedMaterials=new Set)}UH=new WeakMap,FH=new WeakMap,NH=new WeakMap,jH=new WeakMap,VH.moduleName="PhysicsManagerModule";const WH={placeholderVal:"placeholder",renderTarImage:Hx("Render Target"),dataTexImage:Hx("Data Texture"),lutCubeTexImage:Hx("CUBE Texture"),compressedTexImage:Hx("Compressed Texture"),textureMap:{},imageMap:{},tempMap:{}},GH=(e,t,i)=>{var n,s,r,o;if(e&&e.isTexture){if(e.isDataTexture)e.needsUpdate=!0;else{const r=i.methods.getBinding(t)[1]+"",o=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(r);e.colorSpace=o?ae:se,e.wrapS=G,e.wrapT=G,e.flipY=null===(s=null===(n=t.__proxy.value_)||void 0===n?void 0:n.flipY)||void 0===s||s}e.image&&((null===(r=e.image.id)||void 0===r?void 0:r.length)||(e.image.id=uv()),WH.textureMap[e.image.id]||(WH.textureMap[e.image.id]=e))}t.__proxy.value_=e,i.methods.setValue(t,e,{last:!0},!1),null===(o=t.uiRefresh)||void 0===o||o.call(t,!1,"postFrame",10)};function YH(e,t,i,n){var s,r,o,a,l,h,c,d,u;if("string"==typeof e)return void("string"==typeof t&&GH(e,i,n));if((e=e||WH.placeholderVal).isPlaceholder||e===WH.placeholderVal)return void(t&&GH("string"==typeof t?"":null,i,n));let p=e.tp_src_uuid;if(p||(p=null!==(s=e.src)&&void 0!==s?s:e.tp_src,p=null!==(r=WH.tempMap[p])&&void 0!==r?r:p,delete WH.tempMap[p],e.tp_src_uuid=p),p&&(WH.imageMap[p]=e),"string"!=typeof t){if(!(t===e||t&&(t.image===e||(null===(o=t.image)||void 0===o?void 0:o.src)===e.src||(null===(a=t.image)||void 0===a?void 0:a.tp_src)===e.tp_src&&null!=e.tp_src||(null===(l=t.image)||void 0===l?void 0:l.tp_src)===e.src&&null!=e.src||(null===(h=t.image)||void 0===h?void 0:h.src)===e.tp_src&&null!=e.tp_src)))if(e instanceof File);else if(e.isTexture)GH(e,i,n);else{let t=WH.textureMap[e.id]||WH.textureMap[e.src]||WH.textureMap[e.tp_src];if(t)return void GH(t,i,n);t=new W(e),HH.call(t),t.assetType="texture",t.needsUpdate=!0;const s=null===(u=null===(d=null===(c=e.src)||void 0===c?void 0:c.split("?"))||void 0===d?void 0:d[0])||void 0===u?void 0:u.split(".").pop();t.userData.mimeType||(t.userData.mimeType="image/"+(["jpg","jpeg"].includes(s)?"jpeg":"png")),GH(t,i,n)}}else GH(p,i,n)}let XH;class QH extends Fw{constructor(e,t){var i;super(e),this._controls=[],this._controlPositions={},this.options=null!=t?t:{},this.options.control=null!==(i=this.options.control)&&void 0!==i?i:{};const n=this._controlContainer=bz.create("div","vjmap3d-control-container",e.container),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{s[e]=bz.create("div",`vjmap3d-ctrl-${e}`,n)})),this.setControlMargin(this.options.control),this.addDispose((()=>{n.parentNode&&n.parentNode.removeChild(n)}))}onAwake(){const e=this.app;this.applyMixinsTo(e)}setCursor(e){e=null!=e?e:"default",this.app.isMapMode&&this.app.map?this.app.map.getCanvas().style.cursor=e:this.app.container.style.cursor=e}setControlMargin(e){void 0!==(null==e?void 0:e.posTopLeftMarginX)&&this._controlContainer.style.setProperty("--ctrl-top-left-margin-x",(null==e?void 0:e.posTopLeftMarginX)+"px"),void 0!==(null==e?void 0:e.posTopLeftMarginY)&&this._controlContainer.style.setProperty("--ctrl-top-left-margin-y",(null==e?void 0:e.posTopLeftMarginY)+"px"),void 0!==(null==e?void 0:e.posTopRightMarginX)&&this._controlContainer.style.setProperty("--ctrl-top-right-margin-x",(null==e?void 0:e.posTopRightMarginX)+"px"),void 0!==(null==e?void 0:e.posTopRightMarginY)&&this._controlContainer.style.setProperty("--ctrl-top-right-margin-y",(null==e?void 0:e.posTopRightMarginY)+"px"),void 0!==(null==e?void 0:e.posBottomLeftMarginX)&&this._controlContainer.style.setProperty("--ctrl-bottom-left-margin-x",(null==e?void 0:e.posBottomLeftMarginX)+"px"),void 0!==(null==e?void 0:e.posBottomLeftMarginY)&&this._controlContainer.style.setProperty("--ctrl-bottom-left-margin-y",(null==e?void 0:e.posBottomLeftMarginY)+"px"),void 0!==(null==e?void 0:e.posBottomRightMarginX)&&this._controlContainer.style.setProperty("--ctrl-bottom-right-margin-x",(null==e?void 0:e.posBottomRightMarginX)+"px"),void 0!==(null==e?void 0:e.posBottomRightMarginY)&&this._controlContainer.style.setProperty("--ctrl-bottom-right-margin-y",(null==e?void 0:e.posBottomRightMarginY)+"px")}addControl(e,t){if(void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)throw Error("Invalid argument to app.addControl(). Argument must be a control with onAdd and onRemove methods.");const i=e.onAdd(this.app);this._controls.push(e);const n=this._controlPositions[t];return-1!==t.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this.app}removeControl(e){if(!e||!e.onRemove)throw Error("Invalid argument to app.removeControl(). Argument must be a control with onAdd and onRemove methods.");const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this.app),this.app}hasControl(e){return this._controls.indexOf(e)>-1}getConfigPane(t){var i,n,s,r,o;return Qv(this,void 0,void 0,(function*(){const a=()=>{var e,t;let i=this.configPane._root;for(let e=i.children.length-1;e>=0;e--)i.remove(i.children[e]);for(let i=(null===(e=this.configPane.config)||void 0===e?void 0:e.children.length)-1;i>=0;i--)this.configPane.removeChild(null===(t=this.configPane.config)||void 0===t?void 0:t.children[i]);this.configPane.config&&(this.configPane.config.children=[])},l=e=>({configPane:this.configPane,rootPane:this.configPane.root_,element:this.configPane._root.containerElem_,isInit:!!e,setVisible:e=>this.configPane._root.containerElem_.style.display=e?"":"none",isVisible:()=>"none"!==this.configPane._root.containerElem_.style.display,reset:()=>a(),appendChild:(e,t)=>{e&&(e.app=this.app),t&&(t.app=this.app);const i=t=>{var n,s,r,o;if(t&&(null===(n=t.children)||void 0===n?void 0:n.length))for(let n=0;n<(null===(s=t.children)||void 0===s?void 0:s.length);n++)if("function"==typeof t.children[n]){let s=t.children[n]();"folder"!=(null==s?void 0:s.type)&&"panel"!=(null==s?void 0:s.type)||(s.app=this.app,s.uiRefresh&&!s.uiRefresh&&(s.uiRefresh=e.uiRefresh),i(s))}else"folder"!=(null===(r=t.children[n])||void 0===r?void 0:r.type)&&"panel"!=(null===(o=t.children[n])||void 0===o?void 0:o.type)||(t.children[n].app=this.app,e.uiRefresh&&!t.children[n].uiRefresh&&(t.children[n].uiRefresh=e.uiRefresh),i(t.children[n]))};let n;i(e),i(t);try{n=this.configPane.appendChild(e,t)}catch(e){console.error(e)}return n},renderUiConfig:e=>this.configPane.renderUiConfig(e),renderUiObject:(e,t)=>this.configPane.renderUiObject(e,t),uiRefresh(e,t,i){var n,s;if(this.configPane.config.children.length>0)return null===(s=(n=this.configPane.config.children[0]).uiRefresh)||void 0===s?void 0:s.call(n,e,t,i)}});if(this.configPane){if(!1!==(null==t?void 0:t.isReset)&&a(),(null==t?void 0:t.title)&&(this.configPane.root_.title=null==t?void 0:t.title),null==t?void 0:t.style)for(let e in t.style)this.configPane._root.containerElem_.style[e]=t.style[e];return l()}yield Zk.loadLibrary("tweakpane"),yield Zk.loadLibrary("tweakpane-image");let h=null!==(n=null===(i=this.options)||void 0===i?void 0:i.configPane)&&void 0!==n?n:{};if(this.configPane=new tpui.UI(h.container,{expanded:null===(s=h.expanded)||void 0===s||s,autoPostFrame:null===(r=h.autoPostFrame)||void 0===r||r}),((null==t?void 0:t.title)||(null==h?void 0:h.title))&&(this.configPane._root.title=null!==(o=null==t?void 0:t.title)&&void 0!==o?o:null==h?void 0:h.title),h.style||(null==t?void 0:t.style)){let e=Object.assign(Object.assign({},h.style),null==t?void 0:t.style);for(let t in e)this.configPane._root.containerElem_.style[t]=e[t]}return this.configPane.THREE=e,this.configPane._root.registerPlugin(TweakpaneImagePlugin),this.configPane.typeGenerators.image=(e=>(t,i,n,s)=>(i.__proxy||(i.__proxy={listedOnChange:!1},Object.defineProperty(i.__proxy,"value",{get:()=>{var e,t;i.__proxy.value_=n.methods.getValue(i);const s=function(e){var t;let i;if((null==e?void 0:e.get)&&(e=e.get()),!e)return WH.placeholderVal;if(e.isCompressedTexture&&!e.image.tp_src&&(e.image.tp_src=WH.compressedTexImage),e.isTexture?(e.image&&!e.image.tp_src&&(e.image instanceof ImageBitmap||e.image instanceof HTMLImageElement||e.image instanceof HTMLVideoElement?e.image.tp_src=kx(e.image,160):e.isRenderTargetTexture?e._target&&(e.tp_src=uG(e._target,void 0,void 0,Array.isArray(e._target.texture)?e._target.texture.indexOf(e):void 0),setTimeout((()=>e.tp_src&&delete e.tp_src),1e3)):e.image.tp_src=pG(e,160,!1,"image/png",90),e.image.tp_src||e.tp_src||(e.isRenderTargetTexture?e.image.tp_src=WH.renderTarImage:e.isDataTexture&&(e.image.tp_src=WH.dataTexImage))),e.image&&(i=e.image.tp_src_uuid,i=i?WH.imageMap[i]:void 0,i||(i=e.image.tp_src||e.image.src)),e.tp_src&&(i=e.tp_src)):"string"==typeof e?i=e:e.domainMin?(i=e.texture,e.texture.image&&!e.texture.image.tp_src&&(e.texture.image.tp_src=WH.lutCubeTexImage),e.texture.image&&(i=e.texture.image.tp_src_uuid,i=i?WH.imageMap[i]:void 0,i||(i=e.texture.image.tp_src||e.texture.image.src))):e&&console.error("unknown value",e),i||(i=WH.placeholderVal),e.image&&!e.image.tp_src_uuid){const t=uv();e.image.tp_src_uuid=t,WH.tempMap[i]=t}return"string"==typeof i&&(i=null!==(t=WH.imageMap[i])&&void 0!==t?t:i),i}(i.__proxy.value_);"string"==typeof s||(null===(e=s.id)||void 0===e?void 0:e.length)||(s.id=uv());const r="string"==typeof s?s:null!==(t=s.id)&&void 0!==t?t:s;return WH.textureMap[r]||(WH.textureMap[r]=i.__proxy.value_),s},set:e=>{Mx(i.readOnly)||(i.__proxy.value_=n.methods.getValue(i),YH(e,i.__proxy.value_,i,n))}})),i.__proxy.value_=n.methods.getValue(i),(s=null!=s?s:{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],void 0===s.imageFit&&(s.imageFit="contain"),void 0===s.clickCallback&&(s.clickCallback=(t,s)=>{const r=null==t?void 0:t.target,o=null==r?void 0:r.getBoundingClientRect();if(!o)return void s.click();const a=i.uiRef.controller_.valueController.value.rawValue,l=a===WH.placeholderVal||(null==a?void 0:a.isPlaceholder),h=l?{}:{"download image":()=>function(e,t,i){var n,s;XH&&XH.hide();const r=e.__proxy.value_;if(!r)return;let o=null!==(n=r.image)&&void 0!==n?n:e.uiRef.controller_.valueController.value.rawValue;r.__rootBlob&&!r.__rootBlob.objectUrl&&(r.__rootBlob.objectUrl=URL.createObjectURL(r.__rootBlob));let a=r.__rootBlob?r.__rootBlob.objectUrl:r.userData.rootPath||(null==o?void 0:o.src),l=!1;o&&(o instanceof ImageBitmap||o instanceof HTMLImageElement||o instanceof HTMLVideoElement)&&!a&&(o=kx(o));let h=r.__rootBlob?r.__rootBlob.name||"image."+(r.__rootBlob.ext||"png"):null;if(!a&&r.isRenderTargetTexture){const t=r._target;if(!(null==t?void 0:t.isWebGLRenderTarget))return void console.error("Render target not supported",o,r,t,e);{const n=gG(i.renderer,t);if(!n)return void console.error("cannot export render target",o,r,t,e);h="renderTarget."+(n.ext||"png"),a=URL.createObjectURL(n),l=!0}}if(!a&&r.isDataTexture)return r.type!==Z&&r.type!==re?void console.error("Only Float and HalfFloat Data texture export is supported",o,r,e):void console.error("cannot export data texture",o,r,e);if(!a){if(0!=o.indexOf("data:image/"))return void console.error("cannot export image",o,r,e);{let e=o.split(";base64,")[0].replace("data:",""),t=(t=>{for(var i=atob(t.split(",")[1]),n=new ArrayBuffer(i.length),s=new Uint8Array(n),r=0;r<i.length;r++)s[r]=i.charCodeAt(r);return new Blob([n],{type:e})})(o);a=URL.createObjectURL(t)}}const c=document.createElement("a");document.body.appendChild(c),c.style.display="none",c.href=a,c.download=h||(a.startsWith("data:")?"image.png":null!==(s=a.split("/").pop())&&void 0!==s?s:"image.png"),c.target="_blank",c.click(),l&&setTimeout((()=>{document.body.removeChild(c),URL.revokeObjectURL(a)}),1e3)}(i,0,e)},c=Mx(i.readOnly);l||c||Object.assign(h,{"remove image":()=>function(e,t){e.uiRef.controller_.valueController.value.setRawValue("");const i="string"==typeof e.__proxy.value_;GH(i?"":null,e,t)}(i,n)}),c||Object.assign(h,{"set/replace image":()=>s.click()}),XH&&XH.hide();let d=[o.left,o.bottom+3],u=Object.assign(Object.assign({},h),{cancel:()=>{}}),p=[];for(let e in u)p.push({label:e,onClick:u[e]});XH=new eF({position:d,theme:"dark",width:"150px",items:p})}),s.view="input-image",n.typeGenerators.input(t,i,n,s)))(this.app),l(!0)}))}logInfo(e,t,i){void 0===t?t=2500:null!=i||(i=2500),"number"==typeof t&&(i=t,t="");let n=(()=>{let e=this.app.container.querySelector("#vjinfolog");if(!e){e=document.createElement("div"),e.id="vjinfolog",document.body.appendChild(e);let t=document.createElement("style");t.innerHTML="#vjinfolog{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;pointer-events:none;width:100vw;height:100vh;position:fixed;left:0;top:0;z-index:9999999;cursor:pointer;transition:0.2s}#vjinfolog span{pointer-events:auto;width:max-content;animation:fadein 0.4s;animation-delay:0s;border-radius:6px;padding:10px 20px;box-shadow:0 0 10px 6px rgba(0,0,0,0.1);margin:4px;transition:0.2s;z-index:9999999;font-size:14px;display:flex;align-items:center;justify-content:center;gap:4px;height:max-content}#vjinfolog span.hide{opacity:0;pointer-events:none;transform:translateY(-10px);height:0;padding:0;margin:0}.vjinfolog-warn{background-color:#fffaec;color:#e29505}.vjinfolog-error{background-color:#fde7e7;color:#d93025}.vjinfolog-info{background-color:#e6f7ff;color:#0e6eb8}.vjinfolog-success{background-color:#e9f7e7;color:#1a9e2c}.vjinfolog-{background-color:#fafafa;color:#333}@keyframes fadein{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}",document.head.insertBefore(t,document.head.firstChild)}return e})(),s=document.createElement("span");s.className=`vjinfolog-${t}`,s.innerHTML={warn:'<svg t="1713405237257" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2387" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"><path d="M934.4 770.133333L605.866667 181.333333C586.666667 147.2 550.4 128 512 128c-38.4 0-74.666667 21.333333-93.866667 53.333333L89.6 770.133333c-19.2 34.133333-19.2 76.8 0 110.933334S145.066667 938.666667 183.466667 938.666667h657.066666c38.4 0 74.666667-21.333333 93.866667-57.6 19.2-34.133333 19.2-76.8 0-110.933334z m-55.466667 81.066667c-8.533333 14.933333-23.466667 23.466667-38.4 23.466667H183.466667c-14.933333 0-29.866667-8.533333-38.4-23.466667-8.533333-14.933333-8.533333-34.133333 0-49.066667L473.6 213.333333c8.533333-12.8 23.466667-21.333333 38.4-21.333333s29.866667 8.533333 38.4 21.333333l328.533333 588.8c8.533333 14.933333 8.533333 32 0 49.066667z" fill="#e29505" p-id="2388"></path><path d="M512 746.666667m-42.666667 0a42.666667 42.666667 0 1 0 85.333334 0 42.666667 42.666667 0 1 0-85.333334 0Z" fill="#e29505" p-id="2389"></path><path d="M512 629.333333c17.066667 0 32-14.933333 32-32v-192c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v192c0 17.066667 14.933333 32 32 32z" fill="#e29505" p-id="2390"></path></svg>',error:'<svg t="1713405212725" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1744" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" fill="#d93025" p-id="1745"></path><path d="M657.066667 360.533333c-12.8-12.8-32-12.8-44.8 0l-102.4 102.4-102.4-102.4c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8l102.4 102.4-102.4 102.4c-12.8 12.8-12.8 32 0 44.8 6.4 6.4 14.933333 8.533333 23.466666 8.533334s17.066667-2.133333 23.466667-8.533334l102.4-102.4 102.4 102.4c6.4 6.4 14.933333 8.533333 23.466667 8.533334s17.066667-2.133333 23.466666-8.533334c12.8-12.8 12.8-32 0-44.8l-106.666666-100.266666 102.4-102.4c12.8-12.8 12.8-34.133333 0-46.933334z" fill="#d93025" p-id="1746"></path></svg>',info:'<svg t="1713405208589" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1582" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"><path d="M853.333333 138.666667H170.666667c-40.533333 0-74.666667 34.133333-74.666667 74.666666v512c0 40.533333 34.133333 74.666667 74.666667 74.666667h151.466666V917.333333c0 12.8 8.533333 25.6 19.2 29.866667 4.266667 2.133333 8.533333 2.133333 12.8 2.133333 8.533333 0 17.066667-4.266667 23.466667-10.666666l136.533333-138.666667H853.333333c40.533333 0 74.666667-34.133333 74.666667-74.666667V213.333333c0-40.533333-34.133333-74.666667-74.666667-74.666666z m10.666667 586.666666c0 6.4-4.266667 10.666667-10.666667 10.666667H501.333333c-8.533333 0-17.066667 4.266667-23.466666 10.666667l-89.6 93.866666V768c0-17.066667-14.933333-32-32-32H170.666667c-6.4 0-10.666667-4.266667-10.666667-10.666667V213.333333c0-6.4 4.266667-10.666667 10.666667-10.666666h682.666666c6.4 0 10.666667 4.266667 10.666667 10.666666v512z" fill="#0e6eb8" p-id="1583"></path><path d="M512 490.666667H298.666667c-17.066667 0-32 14.933333-32 32S281.6 554.666667 298.666667 554.666667h213.333333c17.066667 0 32-14.933333 32-32S529.066667 490.666667 512 490.666667zM672 341.333333H298.666667c-17.066667 0-32 14.933333-32 32S281.6 405.333333 298.666667 405.333333h373.333333c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32z" fill="#0e6eb8" p-id="1584"></path></svg>',success:'<svg t="1713405224326" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2225" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" fill="#1a9e2c" p-id="2226"></path><path d="M701.866667 381.866667L448 637.866667 322.133333 512c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8l149.333334 149.333333c6.4 6.4 14.933333 8.533333 23.466666 8.533334s17.066667-2.133333 23.466667-8.533334l277.333333-277.333333c12.8-12.8 12.8-32 0-44.8-14.933333-12.8-36.266667-12.8-49.066666-2.133333z" fill="#1a9e2c" p-id="2227"></path></svg>',"":""}[t]+e,n.appendChild(s),setTimeout((()=>{s.classList.add("hide")}),i-500),setTimeout((()=>{n.removeChild(s),s=null}),i)}setupUiConfig(){let e,t;return{type:"folder",expanded:!1,label:QH.moduleName,children:[{type:"number",label:"控件左上角x边距",getValue:()=>{var e;return null!==(e=this.options.control.posTopLeftMarginX)&&void 0!==e?e:0},setValue:e=>{this.options.control.posTopLeftMarginX=e,this.setControlMargin(this.options.control)}},{type:"number",label:"控件左上角y边距",getValue:()=>{var e;return null!==(e=this.options.control.posTopLeftMarginY)&&void 0!==e?e:0},setValue:e=>{this.options.control.posTopLeftMarginY=e,this.setControlMargin(this.options.control)}},{type:"number",label:"控件右上角x边距",getValue:()=>{var e;return null!==(e=this.options.control.posTopRightMarginX)&&void 0!==e?e:0},setValue:e=>{this.options.control.posTopRightMarginX=e,this.setControlMargin(this.options.control)}},{type:"number",label:"控件右上角y边距",getValue:()=>{var e;return null!==(e=this.options.control.posTopRightMarginY)&&void 0!==e?e:0},setValue:e=>{this.options.control.posTopRightMarginY=e,this.setControlMargin(this.options.control)}},{type:"number",label:"控件左下角x边距",getValue:()=>{var e;return null!==(e=this.options.control.posBottomLeftMarginX)&&void 0!==e?e:0},setValue:e=>{this.options.control.posBottomLeftMarginX=e,this.setControlMargin(this.options.control)}},{type:"number",label:"控件左下角y边距",getValue:()=>{var e;return null!==(e=this.options.control.posBottomLeftMarginY)&&void 0!==e?e:0},setValue:e=>{this.options.control.posBottomLeftMarginY=e,this.setControlMargin(this.options.control)}},{type:"number",label:"控件右下角x边距",getValue:()=>{var e;return null!==(e=this.options.control.posBottomRightMarginX)&&void 0!==e?e:0},setValue:e=>{this.options.control.posBottomRightMarginX=e,this.setControlMargin(this.options.control)}},{type:"number",label:"控件右下角y边距",getValue:()=>{var e;return null!==(e=this.options.control.posBottomRightMarginY)&&void 0!==e?e:0},setValue:e=>{this.options.control.posBottomRightMarginY=e,this.setControlMargin(this.options.control)}},{type:"folder",expanded:!0,label:"内置控件",children:[{type:"button",label:"鼠标位置控件",onClick:()=>{e&&this.hasControl(e)||(e=new dF({UnProjectModes:[!1,"depth"]}),this.addControl(e,"bottom-left"))}},{type:"button",label:"全屏控件",onClick:()=>{t&&this.hasControl(t)||(t=new uF,this.addControl(t,"bottom-right"))}}]}]}}}var qH,ZH;QH.moduleName="UiModule";class KH extends Uw{constructor(e,t){var i;if(super(t),qH.add(this),this.isApp=!0,this.signal={onSelectedChange:new cy,onEntitySelected:new cy,onEntityUnSelected:new cy,onBloomedChange:new cy,onEntityBloomed:new cy,onEntityUnBloomed:new cy,onOutlineChange:new cy,onEntityOutline:new cy,onEntityUnOutline:new cy,onMouseUp:new cy,onMouseMove:new cy,onMouseDown:new cy,onMousePreClick:new cy,onMouseClick:new cy,onMouseDblClick:new cy,onMouseOver:new cy,onMouseOut:new cy,onMouseEnter:new cy,onMouseLeave:new cy,onContextMenu:new cy,onPointerDown:new cy,onPointerMove:new cy,onPointerUp:new cy,onPointerDownUp:new cy,onPointerCancel:new cy,onMouseWheel:new cy,onKeyDown:new cy,onKeyUp:new cy,onAppBeforeUpdate:new cy,onAppUpdate:new cy,onAppAfterUpdate:new cy,onAppBeforeRender:new cy,onAppRender:new cy,onAppAfterRender:new cy,onAppBeforeAddEntity:new cy,onAppAddEntity:new cy,onAppBeforeRemoveObject:new cy,onAppRemoveObject:new cy,onAppBeforeRemoveEntity:new cy,onAppRemoveEntity:new cy,onContainerSizeChange:new cy,onCameraControl:new cy,onCameraUpdate:new cy,onCameraChange:new cy,contextMenuPreOpen:new cy,contextMenuOpened:new cy,contextMenuNoContent:new cy,contextMenuCancel:new cy,onCustomEvent:new cy,onAddScene:new cy,onActiveScene:new cy,onRemoveScene:new cy},this.svc=e,!e)throw Error("app parameter service is null");if(!e.serverUrl)throw Error("app parameter service serverUrl is null");if(!e.accessToken)throw Error("app parameter service accessToken is null");e&&(Cy.service=e),eL.setLoaderPath(this.svc.baseUrl()+`map3d/v${nQ}/lib/`),Zk.setLoaderPath(this.svc.baseUrl()+`map3d/v${nQ}/`),iL.setServiceUrlPath(this.svc.baseUrl()+`map3d/v${nQ}/`),t.modules=null!==(i=t.modules)&&void 0!==i?i:KH.defaultModules;for(const e of t.modules)Array.isArray(e)?"string"==typeof e[1]?this.addModule(e[0],t[e[1]]):this.addModule(e[0],e[1]):this.addModule(e);qv(this,qH,"m",ZH).call(this)}setupUiConfig(){return{type:"folder",expanded:!0,app:this.app,label:"App",children:[()=>(this._modules||[]).map((e=>e.uiConfig||{type:"folder",expanded:!0,label:e.constructor.moduleName,children:[]}))]}}dispose(){this.removeAllModules(),super.destroy()}fromJSON(e){var t;return Qv(this,void 0,void 0,(function*(){let i=new Pt;if(!this.isMapMode){let t=yield i.parseAsync(e.camera);this.camera.copy(t)}let n=yield i.parseAsync(e.scene);this.clearScenes(),this.addScene(n),this.activeScene(n);let s=new Map;this.scene.traverse((e=>s.set(e.uuid,e))),(null!==(t=e.entities)&&void 0!==t?t:[]).forEach((e=>{UP.fromJSON(e,s).addTo(this)}))}))}toJSON(){return{metadata:{},project:{},camera:this.camera.toJSON(),scene:this.scene.toJSON(),entities:this.getEntities().map((e=>e.toJSON()))}}}qH=new WeakSet,ZH=function(){return Qv(this,void 0,void 0,(function*(){for(let t=0;t<6;t++)try{let t=this.svc.serviceUrl("map3d"),i=Dv(1e5,1e6),n=(e=`${iQ}:${i}:`,Ok.encryptToBase64Url(e,vF)),s={};if(s=yield this.svc._get(t,{stamp:n,version:`v${nQ}`}),s&&"data"in s){let e=s.data;this.sInfo=e.activate&&!e.trial;let t=(e.dirs||"").split("|");const n=e=>t.find((t=>t==e||0==t.indexOf(e+"__v")))||e;eL.setLoaderPath(this.svc.baseUrl()+e.path+`${n("lib")}/`),Zk.setLoaderPath(this.svc.baseUrl()+e.path,t),iL.setServiceUrlPath(this.svc.baseUrl()+e.path,t),this.signal.onCustomEvent.dispatch({type:"map3dinfo",data:e,num:i})}break}catch(e){if(5!=t){yield xv(1e3*Dv(5,15));continue}let i=this.getModule(CF);i&&i.options&&(i.options.renderUpdate=!1);let n=this.getModule(sV);n&&n.options&&(n.options.renderUpdate=!1);let s=this.getModule(RN);s&&(s.enableCameraControl=!1,s.enableWheelWhenCtrlDisabled=!1),this.signal.onCustomEvent.dispatch({type:"map3dinfoError"});break}var e}))},KH.defaultModules=[[CF,"render"],[kF,"camera"],[RN,"control"],[VF,"scene"],[sV,"postProcess"],[cV,"coordSystem"],uH,oV,[hV,"input"],fH,[QH,"ui"],[vH,"rectCollide"],[xH,"toolState"],[mH,"command"],[nV,"stat"],[gH,"particle"],[VH,"physics"],[pH,"entityOutline"],[cH,"css2dRender"],[dH,"css3dRender"]],KH.registerModules=new Set([vz,lz,wL,fF,QO,ZO,tb,vA,mA,yz,_L,gz,YO,WO,BL,fz,pz,mz,FE,gz,gF]);const JH=new i,$H=new i,eW=new i,tW=new r;function iW(e,t,n){if(n)return!1;const s=JH.setFromMatrixPosition(e.matrixWorld),r=$H.setFromMatrixPosition(t.matrixWorld),o=s.sub(r);let a;if(n){a=new i;const e=t.matrixWorld.elements;a.set(e[8],e[9],e[10]).normalize().negate}else a=t.getWorldDirection(eW);return o.angleTo(a)>Math.PI/2}function nW(e,t){let i=e.far,n=e.near;return(i+n)/(i-n)+2*i*n/((n-i)*Mv(t,n,i))}function sW(e,t,i,n){const s=JH.setFromMatrixPosition(e.matrixWorld),r=s.clone();r.project(t),tW.set(r.x,r.y),i.setFromCamera(tW,t);let o=i.intersectObjects(n,!0);if(o.length){if(o=o.filter((e=>{var t,i,n,s;return(null===(t=e.object)||void 0===t?void 0:t.visible)&&!0!==(null===(i=e.object)||void 0===i?void 0:i.userData.disableRayQuery)&&!0!==(null===(n=e.object)||void 0===n?void 0:n.userData.disableRayOcclude)&&-1==(null===(s=e.object)||void 0===s?void 0:s.type.indexOf("Helper"))})),!o.length)return!1;const e=o[0].distance;return s.distanceTo(i.ray.origin)>=e}return!1}const rW=e=>{if(e)return e.userData=e.userData||{},e.userData.__refCount=e.userData.__refCount||0,e.userData.__refCount>0},oW=(e,t=1)=>{if(e)return e.userData=e.userData||{},e.userData.__refCount=e.userData.__refCount||0,e.userData.__refCount=e.userData.__refCount+t,e.userData.__refCount<0&&(e.userData.__refCount=0),e.userData.__refCount>0};function aW(e,t=1){const i=e=>{oW(e,t);for(const i in e)if(e.hasOwnProperty(i)&&((e[i]instanceof W||e[i]instanceof q)&&oW(e[i],t),e.uniforms))for(const i of Object.values(e.uniforms))if(i){const e=i.value;if(e instanceof W)oW(e,t);else if(jf(e))for(let i in e)e[i]instanceof W&&oW(e[i],t)}};e.isObject3D?e.traverse((e=>{(e=>{e.geometry&&oW(e.geometry,t),e.material&&e.material instanceof he&&i(e.material),e.material&&e.material instanceof Array&&e.material.forEach((e=>{i(e)}))})(e)})):(Array.isArray(e)||(e=[e]),e.forEach((e=>{e.isMaterial?i(e):oW(e)})))}function lW(e){if(e.userData.__disposed)return!0;e.userData.__disposed=!0,aW(e,-1);const t=e=>{for(const t in e)if(e.hasOwnProperty(t)){if((e[t]instanceof W||e[t]instanceof q)&&!rW(e[t])){const i=e[t].image;i instanceof ImageBitmap&&i.close(),e[t].dispose(),e[t]=null}if(e.uniforms)for(const t of Object.values(e.uniforms))if(t){const e=t.value;if(e instanceof W)rW(e)||e.dispose();else if(jf(e))for(let t in e)e[t]instanceof W&&(rW(e[t])||e[t].dispose())}}};e.traverse((e=>{(e=>{e instanceof h&&(e.geometry&&(rW(e.geometry)||e.geometry.dispose()),e.material&&e.material instanceof he&&(t(e.material),rW(e.material)||(e.material.dispose(),e.material=null)),e.material&&e.material instanceof Array&&e.material.forEach((e=>{t(e),rW(e)||(e.dispose(),e=null)})))})(e),e=null})),e=null}function hW(e){let t=e.getObjectByProperty("type","Bone");return t||(t=e.getObjectByProperty("type","SkinnedMesh")),!!t}function cW(e){let s=new n;e.position||(e.position=new i);let r=new v;return e.rotation||(e.rotation=new i),e.scale||(e.scale=1),"number"==typeof e.scale&&(e.scale=new i(e.scale,e.scale,e.scale)),r.setFromEuler(new t(e.rotation.x,e.rotation.y,e.rotation.z)),s.compose(e.position,r,e.scale)}function dW(e,t,i,n){null!=i||(i=Cy.app),i.updateSceneMatixWorld(),e.updateWorldMatrix(!0,!0);let s=new E;if(s.setFromObject(e),t&&null!==e.parent)e.worldToLocal(s.min),e.worldToLocal(s.max);else if(i&&i.isMapMode&&!0!==n){let e=BP.scene2World(s.min),t=BP.scene2World(s.max);s.setFromPoints([e,t])}return s}function uW(e,t,n,s){s||(s=Cy.app);let r=s.isMapMode,o=e.isBox3?e:dW(e,n,s);t=null!=t?t:"default";let a=new i;return o.getCenter(a),t.indexOf("front")>=0?r?a.y=o.max.y:a.z=o.max.z:t.indexOf("back")>=0&&(r?a.y=o.min.y:a.z=o.min.z),t.indexOf("left")>=0?a.x=r?o.max.x:o.min.x:t.indexOf("right")>=0&&(a.x=r?o.min.x:o.max.x),t.indexOf("top")>=0?r?a.z=o.max.z:a.y=o.max.y:t.indexOf("bottom")>=0&&(r?a.z=o.min.z:a.y=o.min.y),a}function pW(e,t){e.traverse((e=>{t?delete e.userData.disableRayQuery:e.userData.disableRayQuery=!0}))}function fW(e,t){e.traverse((e=>{t?delete e.userData.disableSelected:e.userData.disableSelected=!0}))}function mW(e,t){e.traverse((e=>{t?delete e.userData.disableBloom:e.userData.disableBloom=!0}))}function gW(e,t){e.traverse((e=>{t?delete e.userData.disableOutline:e.userData.disableOutline=!0}))}function vW(e,t,i){e.traverse((e=>{i&&i.includes(e)||(t?(delete e.userData.disableOutline,delete e.userData.disableBloom,delete e.userData.disableSelected,delete e.userData.disableRayQuery):(e.userData.disableOutline=!0,e.userData.disableBloom=!0,e.userData.disableSelected=!0,e.userData.disableRayQuery=!0))}))}const yW=e=>{e.computeBoundingBox();const{max:t,min:i}=e.boundingBox;e.deleteAttribute("uv");const n=t.x-i.x,s=t.y-i.y,r=[];for(let t=0;t<e.attributes.position.count;t++)r.push((e.attributes.position.getX(t)-i.x)/n),r.push((e.attributes.position.getY(t)-i.y)/s);const o=new Float32Array(r);e.setAttribute("uv",new O(o,2))},xW=new i,wW=(e,t)=>{if(e=Cy.app,t=null!=t?t:e.camera,e.isMapMode){const e=t.matrixWorld.elements;return xW.set(e[8],e[9],e[10]).normalize().negate(),xW}return t.getWorldDirection(xW)},bW=()=>new s(Math.random(),Math.random(),Math.random()),_W=()=>zo(),SW=e=>{var t,i,n,s,r,o;let a=null!==(t=null==e?void 0:e.maxX)&&void 0!==t?t:10,l=null!==(i=null==e?void 0:e.minX)&&void 0!==i?i:-10,h=null!==(n=null==e?void 0:e.maxY)&&void 0!==n?n:10,c=null!==(s=null==e?void 0:e.minY)&&void 0!==s?s:-10,d=null!==(r=null==e?void 0:e.maxZ)&&void 0!==r?r:10,u=null!==(o=null==e?void 0:e.minZ)&&void 0!==o?o:-10;return[Math.random()*(a-l)+l,Math.random()*(h-c)+c,Math.random()*(d-u)+u]},MW=e=>{var t,i,n,s;let r=null!==(t=null==e?void 0:e.maxX)&&void 0!==t?t:10,o=null!==(i=null==e?void 0:e.minX)&&void 0!==i?i:-10,a=null!==(n=null==e?void 0:e.maxY)&&void 0!==n?n:10,l=null!==(s=null==e?void 0:e.minY)&&void 0!==s?s:-10;return[Math.random()*(r-o)+o,Math.random()*(a-l)+l]},CW=e=>(null!=e||(e=Cy.app),!!e&&e.isMapMode),AW=e=>{null!=e||(e=Cy.app);let t=new UP,n=new V;n.position.z=-1,t.quaternion.copy(e.camera.quaternion),t.position.copy(e.camera.position);const s=e.signal.onCameraUpdate.add((()=>{t.quaternion.copy(e.camera.quaternion),t.position.copy(e.camera.position)}));t.node.add(n),t.addTo(e);const r=t=>{let n=e.containerSize,s=t[0]-n.width/2,r=n.height/2-t[1],o=1*Math.tan(Wv(e.camera.fov/2)),a=o*e.containerSize.width/e.containerSize.height;return new i(s*a/(n.width/2),r*o/(n.height/2),0)};return{entity:t,group:n,pixelToPosition:r,pixelHeightToLength:t=>{let i=e.containerSize,n=r([i.width/2,i.height/2]),s=r([i.width/2,t+i.height/2]);return Math.abs(s.y-n.y)},addObject:(e,t)=>{t&&e.position.copy(r(t)),n.add(e)},dispose:()=>{s(),t.remove()}}},EW=(e,t)=>(e instanceof h&&(e=e.material),Array.isArray(e)?e.map((e=>t(e))):t(e)),TW=e=>EW(e,(e=>e&&e.clone())),PW=e=>{if(e)return EW(e,(e=>e&&e.dispose()))},OW=(e,t,i)=>(i=null!=i?i:{},EW(e,(e=>{let n=i.isClone?e.clone():e;return n.transparent=!0,i.isAccOpacity?n.opacity=n.opacity*t:n.opacity=t,i.isClone&&i.disposeOldMaterial&&e.dispose(),n}))),DW=e=>{e.onBeforeCompile=e=>{e.vertexShader=e.vertexShader.replace("#include <color_pars_vertex>","\n        #include <color_pars_vertex>\n        attribute float vOpacity;\n        varying float vOpacity_;\n        "),e.vertexShader=e.vertexShader.replace("#include <color_vertex>","\n #include <color_vertex>\n vOpacity_ = vOpacity;\n "),e.fragmentShader=e.fragmentShader.replace("#include <color_pars_fragment>","\n       #include <color_pars_fragment>\n        varying float vOpacity_;\n        "),e.fragmentShader=e.fragmentShader.replace("vec4 diffuseColor = vec4( diffuse, opacity );","\n       vec4 diffuseColor = vec4( diffuse, opacity * vOpacity_);\n        ")}};function BW(e,t,n){var s,r;if((t=null!=t?t:Cy.app).isMapMode){let i=t.map,n=i.toLngLat(e),s=BP.projectToWorld(n);if(3==e.length&&e[2]){let t=i.getMapProjection().getMapExtent();s.z=OP.WORLD_SIZE*e[2]/t.width()}return s}if(null!=n||(n=t.mapViewEntity),void 0!==n&&n.map){let t=n.map.mapToWorld(e);return 3==e.length&&e[2]&&(t.y=e[2]/n.map.worldResolution()),t}{let n=2==e.length?new i(e[0],0,e[1]):new i(e[0],e[1],e[2]);if(t.centerOrigin||t.scaleOrigin){let e=null!==(s=t.centerOrigin)&&void 0!==s?s:new i(0,0,0),o=null!==(r=t.scaleOrigin)&&void 0!==r?r:1,a=n.sub(e).multiplyScalar(o);return a.z=-a.z,a}return n}}function IW(e,t,n){var s,r;if((t=null!=t?t:Cy.app).isMapMode){let i=t.map,n=BP.unprojectFromWorld({x:e[0],y:e[1],z:e[2]}),s=i.fromLngLat(n);if(3==e.length&&void 0!==e[2]){let t=i.getMapProjection().getMapExtent();s.z=e[2]*t.width()/OP.WORLD_SIZE}return[s.x,s.y,s.z]}if(null!=n||(n=t.mapViewEntity),void 0!==n&&n.map){let t,i=n.map.worldToMap(e);return 3==e.length&&void 0!==e[2]&&(t=e[1]*n.map.worldResolution()),[i[0],i[1],t]}{let n=new i(e[0],e[1],e[2]);if(t.centerOrigin||t.scaleOrigin){let e=null!==(s=t.centerOrigin)&&void 0!==s?s:new i(0,0,0),o=null!==(r=t.scaleOrigin)&&void 0!==r?r:1;return n.z=-n.z,n.multiplyScalar(1/o).add(e).toArray()}return n.toArray()}}function RW(e,t,i,n){var s;if((i=null!=i?i:Cy.app).isMapMode){let n=i.map;return t&&(e=n.getMapProjection().fromMeter(e)),e*OP.WORLD_SIZE/n.getMapProjection().getMapExtent().width()}return null!=n||(n=i.mapViewEntity),void 0!==n&&n.map?e/n.map.worldResolution():e*(null!==(s=i.scaleOrigin)&&void 0!==s?s:1)}function kW(e,t,i,n){var s;if((i=null!=i?i:Cy.app).isMapMode){let n=i.map,s=e*n.getMapProjection().getMapExtent().width()/OP.WORLD_SIZE;return t&&(s=n.getMapProjection().toMeter(e)),s}return null!=n||(n=i.mapViewEntity),void 0!==n&&n.map?e*n.map.worldResolution():e*(1/(null!==(s=i.scaleOrigin)&&void 0!==s?s:1))}function LW(e){return e/180*Math.PI}const zW=({x:e,y:t},{x:i,y:n})=>{const s=e*i+t*n,r=e*n-t*i;return(Math.atan2(r,s)/Math.PI*180+360)%360};function UW(e,t,i,n){const[s,r]=n,o=n[2]||0,a=[s+Math.cos(e)*t,r+Math.sin(e)*t,o],l=e+=Math.PI;return[a,[s+Math.cos(l)*i,r+Math.sin(l)*i,o]]}function FW(e,t,i){const[n,s]=t,[r,o]=i,[a,l]=e;return(s-o)*a+(r-n)*l+n*o-r*s>0}function NW(e,t){let i=0;const n=[];Array.isArray(t)?n.push(...t):n.push(...e.map((()=>[t/2,t/2])));const s=[],r=[],o=[],a=e.length;let l=0;const h={x:0,y:0},c={x:0,y:0};for(;l<a-1;){const t=e[l],a=e[l+1],d=a[1]-t[1],u=a[0]-t[0];let p=0;const f=180*Math.atan(d/u)/Math.PI;if(i=f,0===l)p=f,p-=90;else{const i=e[l-1];h.x=i[0]-t[0],h.y=i[1]-t[1],c.x=a[0]-t[0],c.y=a[1]-t[1],p=f-zW(h,c)/2}const m=LW(p),[g,v]=UW(m,n[l][0],n[l][1],t);s.push(g,v),FW(g,t,a)?(r.push(g),o.push(v)):(r.push(v),o.push(g)),l++}let d=i;d-=90;const u=LW(d),p=e[a-2],f=e[a-1],[m,g]=UW(u,n[a-1][0],n[a-1][1],f);return s.push(m,g),FW(m,p,f)?(r.push(m),o.push(g)):(r.push(g),o.push(m)),{offsetPoints:s,leftPoints:r,rightPoints:o,expandPoints:[...r,...o.reverse()]}}const jW=new i,VW=new i;function HW(e,t){return jW.set(...e),VW.set(...t),jW.distanceTo(VW)}function WW(e){let t=0,i=e.map((e=>Vv(e)));for(let e=0;e<i.length-1;e++)t+=i[e].distanceTo(i[e+1]);return t}function GW(e,t=10){t=Math.max(t,1);const i=e.length;let n=[],s=0;for(let t=0;t<i-1;t++){const i=HW(e[t],e[t+1]),r=Math.floor(i);n.push({c1:e[t],len:r,c2:e[t+1]}),s+=r}if(s<=t)return n.map((e=>[e.c1,e.c2]));if(1===n.length&&n[0].len<=t)return[[n[0].c1,n[0].c2]];const r=n.length;let o,a=0,l=0;const h=[];let c=[n[0].c1];const d=(e,t)=>{const{len:i,c1:n,c2:s}=e,r=s[0]-n[0],o=s[1]-n[1],a=(s[2]||0)-(n[2]||0),l=t/i;return[n[0]+l*r,n[1]+l*o,(n[2]||0)+l*a]};for(;a<r;){const{len:e,c2:i}=n[a];if(l+=e,l<t&&(c.push(i),a===r-1&&h.push(c),a++),l==t&&(c.push(i),l=0,h.push(c),c=[i],a++),l>t){const i=e-l+t;o=d(n[a],i),c.push(o),h.push(c),l=0,n[a].c1=o,n[a].len=e-i,c=[],c.push(o)}}return h}function YW(e,t,i){var n;const s=e=>{(null==i?void 0:i.nextPoint)&&(i.nextPoint[0]=e[0],i.nextPoint[1]=e[1],i.nextPoint[2]=e[2])};if((null==i?void 0:i.remainingPoints)&&(i.remainingPoints.length=0),0===e.length)return(null==i?void 0:i.remainingPoints)&&e.forEach((e=>i.remainingPoints.push(e))),[];if(t>=1)return s(e[e.length-1]),[...e];{const r=e;let o=0,a=null!==(n=null==i?void 0:i.segmentDist)&&void 0!==n?n:[];if(i&&void 0!==i.distance)o=i.distance;else if(a.length>0)for(let e=1;e<r.length;e++)o+=a[e-1];else for(let e=1;e<r.length;e++){let t=HW(r[e],r[e-1]);a.push(t),o+=t}const l=o*t;o=0;const h=[r[0]];if(s(r.length>1?[...r[1]]:[...r[0]]),0==t)return i&&(i.curRetIndex=0,(null==i?void 0:i.remainingPoints)&&e.forEach((e=>i.remainingPoints.push(e)))),h;let c;for(c=1;c<r.length;c++){let e=0;if(e=c-1<a.length?a[c-1]:HW(r[c],r[c-1]),o+=e,i&&(i.curRetIndex=c-1),!(o<=l)){const t=(e-o+l)/e;h.push([Cv(r[c-1][0],r[c][0],t),Cv(r[c-1][1],r[c][1],t),Cv(r[c-1][2],r[c][2],t)]),s(r[c]);break}h.push(r[c]),s(c+1<r.length?[...r[c+1]]:[...r[c]])}if(null==i?void 0:i.remainingPoints){i.remainingPoints.push(h[h.length-1]);for(let e=c;e<r.length;e++)i.remainingPoints.push(r[e])}return h}}const XW=new Uint8Array([0,1,28,2,29,14,24,3,30,22,20,15,25,17,4,8,31,27,13,23,21,19,16,7,26,12,18,6,11,5,10,9]);function QW(e){return XW[125613361*(e&-e)>>>27]}const qW=.5;function ZW(){this.__length=0,this.__capacity=64,this.__data_uint32=new Uint32Array(this.__capacity>>5),this.__shrinkFactor=qW}function KW(e,t,i){var n,s,r,o,a,l;return!!e&&(e[t]===i||(null===(n=null==e?void 0:e.originalEvent)||void 0===n?void 0:n[t])===i||(null===(s=null==e?void 0:e.originMapEvent)||void 0===s?void 0:s[t])===i||(null===(o=null===(r=null==e?void 0:e.event)||void 0===r?void 0:r.originalEvent)||void 0===o?void 0:o[t])===i||(null===(l=null===(a=null==e?void 0:e.event)||void 0===a?void 0:a.originMapEvent)||void 0===l?void 0:l[t])===i)}function JW(e){return KW(e,"button",0)}function $W(e){return KW(e,"button",1)}function eG(e){return KW(e,"button",2)}function tG(e){return KW(e,"shiftKey",!0)}function iG(e){return KW(e,"ctrlKey",!0)}function nG(e){return KW(e,"altKey",!0)}function sG(e){var t,i,n,s,r,o,a,l,h;if(e)return void 0!==e.keyCode?e.keyCode:null!==(a=null!==(s=null!==(i=null===(t=null==e?void 0:e.originalEvent)||void 0===t?void 0:t.keyCode)&&void 0!==i?i:null===(n=null==e?void 0:e.originMapEvent)||void 0===n?void 0:n.keyCode)&&void 0!==s?s:null===(o=null===(r=null==e?void 0:e.event)||void 0===r?void 0:r.originalEvent)||void 0===o?void 0:o.keyCode)&&void 0!==a?a:null===(h=null===(l=null==e?void 0:e.event)||void 0===l?void 0:l.originMapEvent)||void 0===h?void 0:h.keyCode}function rG(e){return KW(e,"keyCode",13)}function oG(e){return KW(e,"keyCode",27)}function aG(e){return KW(e,"keyCode",46)}function lG(e){var t,i,n;e.preventDefault?e.preventDefault():(null===(t=e.originalEvent)||void 0===t?void 0:t.preventDefault)?e.originalEvent.preventDefault():(null===(n=null===(i=null==e?void 0:e.event)||void 0===i?void 0:i.originalEvent)||void 0===n?void 0:n.preventDefault)&&e.event.originalEvent.preventDefault()}function hG(e){var t,i,n,s,o,a,l,h,c,d;return e?"x"in e?new r(e.x,e.y):"originalEvent"in e?new r(null!==(i=null===(t=null==e?void 0:e.originalEvent)||void 0===t?void 0:t.x)&&void 0!==i?i:0,null!==(s=null===(n=null==e?void 0:e.originalEvent)||void 0===n?void 0:n.y)&&void 0!==s?s:0):"event"in e?new r(null!==(l=null===(a=null===(o=null==e?void 0:e.event)||void 0===o?void 0:o.originalEvent)||void 0===a?void 0:a.x)&&void 0!==l?l:0,null!==(d=null===(c=null===(h=null==e?void 0:e.event)||void 0===h?void 0:h.originalEvent)||void 0===c?void 0:c.y)&&void 0!==d?d:0):new r(0,0):new r(0,0)}ZW.prototype.preventShrink=function(){this.__shrinkFactor=0},ZW.prototype.setShrinkFactor=function(e){this.__shrinkFactor=e},ZW.prototype.setCapacity=function(e){if(this.__length>e)throw new Error(`Current length(=${this.__length}) is greater than requested size(=${e})`);this.__resize(e)},ZW.prototype.size=function(){return this.__length},ZW.prototype.capacity=function(){return this.__capacity},ZW.prototype.__resize=function(e){const t=Math.ceil(e/32),i=this.__data_uint32,n=new Uint32Array(t);i.length<t?n.set(i):n.set(i.subarray(0,t)),this.__data_uint32=n,this.__capacity=32*t},ZW.prototype.__updateLength=function(){const e=this.previousSetBit(this.__length)+1;e<this.__length&&this.__setLength(e)},ZW.prototype.__setLength=function(e){this.__length=e;const t=this.__capacity;if(e>t){const i=Math.ceil(Lv(e,t+128,1.3*t));this.__resize(i)}else e<t-128&&e<t*this.__shrinkFactor&&this.__resize(e)},ZW.prototype.previousSetBit=function(e){const t=Fv(e,this.__length-1);let i=t>>5,n=31&t;const s=this.__data_uint32;let r=s[i];for(;n>=0;n--)if(0!=(r&1<<n))return 32*i+n;for(i--;i>=0;i--)for(r=s[i],n=31;n>=0;n--)if(0!=(r&1<<n))return 32*i+n;return-1},ZW.prototype.nextSetBit=function(e){const t=this.__length;if(e>=t)return-1;const i=this.__data_uint32;let n,s,r=e>>5,o=31&e;if(0!==o){const e=~((1<<o)-1),t=i[r]&e;if(0!==t)return o=QW(t),(r<<5)+o;r++}const a=t+31>>5;for(;r<a;r++)if(n=i[r],0!==n)return o=QW(n),s=(r<<5)+o,s;return-1},ZW.prototype.nextClearBit=function(e){let t,i=e>>5,n=31&e;const s=this.__data_uint32;if(0!==n){t=s[i];const e=(t|(1<<n)-1)>>>0;if(4294967295!==e)return n=QW(~e),n+32*i;i++}const r=this.__length,o=r+31>>5;for(;i<o;i++)if(t=s[i],4294967295!==t)return n=QW(~t),n+32*i;return r},ZW.prototype.set=function(e,t){const i=e>>5,n=1<<(31&e);if(t){const t=e+1;t>this.__length&&this.__setLength(t),this.__data_uint32[i]|=n}else e<this.__length&&(this.__data_uint32[i]&=~n,this.__updateLength())},ZW.prototype.clear=function(e){this.set(e,!1)},ZW.prototype.setRange=function(e,t){for(let i=e;i<=t;i++)this.set(i,!0)},ZW.prototype.clearRange=function(e,t){for(let i=e;i<t;i++)this.set(i,!1)},ZW.prototype.and=function(e){throw new Error("NIY")},ZW.prototype.get=function(e){if(e>=this.__length)return!1;const t=e>>5,i=31&e;return 0!=(this.__data_uint32[t]&1<<i)},ZW.prototype.getAndSet=function(e){const t=this.get(e);return t||this.set(e,!0),t},ZW.prototype.getAndClear=function(e){const t=this.get(e);return t&&this.set(e,!1),t},ZW.prototype.shift_right=function(e,t,i){for(let n=i;n>=t;n--){const t=this.get(n);this.set(n+e,t)}},ZW.prototype.shift_left=function(e,t,i){for(let n=t;n<=i;n++){const t=this.get(n);this.set(n-e,t)}},ZW.prototype.shift=function(e,t,i){e>0?this.shift_right(e,t,i):this.shift_right(-e,t,i)},ZW.prototype.reset=function(){const e=this.__length;e<=0||(e<=32?this.__data_uint32[0]=0:this.__data_uint32.fill(0,0,Math.ceil(e/32)),this.__length=0)},ZW.prototype.copy=function(e){const t=e.__length,i=t>>5,n=this.__length;n!==t&&(n<t?this.__resize(t):this.__data_uint32.fill(0,i),this.__length=t);for(let t=0;t<i;t++)this.__data_uint32[t]=e.__data_uint32[t];const s=i<<5,r=t-s;for(let t=0;t<r;t++){const i=s+t;this.set(i,e.get(i))}},ZW.fixedSize=function(e){const t=new ZW;return t.setCapacity(e),t.__shrinkFactor=0,t};const cG=e=>new Promise(((t,i)=>{const n=new Image;n.src=e,n.onload=()=>t(n),n.onerror=e=>i(e)}));function dG(e,t,i){var n;const s=null!==(n=null==i?void 0:i.data)&&void 0!==n?n:new Uint8ClampedArray(e.height*e.width*4),r=e.data instanceof Float32Array,o=e.data instanceof Uint16Array;for(let i=0;i<s.length;i++)s[i]=r?255*e.data[i]:o?255*mi.fromHalfFloat(e.data[i]):e.data[i],t===ae&&(s[i]=255*gx(s[i]/255));return null!=i?i:new ImageData(s,e.width,e.height)}function uG(e,t,i="image/png",n=90,s=0){const r=document.createElement("canvas");r.width=t.width,r.height=t.height;const o=r.getContext("2d");if(!o)throw new Error("Unable to get 2d context");const a=Array.isArray(t.texture)?t.texture[s]:t.texture,l=o.createImageData(t.width,t.height,{colorSpace:["display-p3","srgb"].includes(a.colorSpace)?a.colorSpace:void 0});if(a.type===Z||a.type===re){const i=function(e,t,i=0){const n=Array.isArray(t.texture)?t.texture[i]:t.texture,s=n.type===Z?new Uint16Array(t.width*t.height*4):n.type===re?new Float32Array(t.width*t.height*4):new Uint8Array(t.width*t.height*4);return e.readRenderTargetPixels(t,0,0,t.width,t.height,s,i),s}(e,t,s);dG({data:i,width:t.width,height:t.height},a.colorSpace,l)}else e.readRenderTargetPixels(t,0,0,t.width,t.height,l.data,s);o.putImageData(l,0,0);const h=(a.flipY?r:Nx(r)).toDataURL(i,n);return r.remove(),h}function pG(e,t,i,n,s){return fG(e,t,i).toDataURL(n,s)}function fG(e,t,i=!1){let n;return n=e.isDataTexture?dG(e.image,e.colorSpace):e.image,mG(n,t,i)}function mG(e,t,i=!1){let n,s;window.VideoFrame||(window.VideoFrame=HTMLVideoElement),e instanceof window.VideoFrame?(n=e.displayWidth,s=e.displayHeight):(n=e.width,s=e.height),window.VideoFrame===HTMLVideoElement&&delete window.VideoFrame;const r=document.createElement("canvas");r.width=Math.min(t,n),r.height=Math.floor(1+r.width*s/n);const o=r.getContext("2d");if(!o)return console.error("textureToDataUrl: could not get canvas context"),r;!0===i&&(o.translate(0,r.height),o.scale(1,-1));let a=!1;if(void 0!==e.data){const t=e;if(n!==r.width||s!==r.height){const e=document.createElement("canvas");e.width=n,e.height=s;const i=e.getContext("2d");i?(i.putImageData(t,0,0),o.drawImage(e,0,0,r.width,r.height)):(console.error("textureToDataUrl: could not get temp canvas context"),o.putImageData(t,0,0))}else o.putImageData(t,0,0),i&&(a=!0)}else o.drawImage(e,0,0,r.width,r.height);return a?Nx(r):r}function gG(e,t,i="auto",n=0){const s=Array.isArray(t.texture)?t.texture[n]:t.texture;let r,o=s.type===Z||s.type===re;if("auto"===i&&(i=o?"image/x-exr":"image/png"),["image/x-exr"].includes(i)||(o=!1),o)return"image/x-exr"!==i&&(console.warn("RenderManager: mimeType ",i," is not supported for HDR. Using EXR instead"),i="image/x-exr"),void console.error("not support hdr");{const s=uG(e,t,"auto"===i?void 0:i,90,n);r=qy(s.split(",")[1]),i=s.split(";")[0].split(":")[1]}const a=new Blob([r],{type:i});return a.ext="image/x-exr"===i?"exr":i.split("/")[1],a}function vG(e){return Qv(this,void 0,void 0,(function*(){"src"in e&&(e=[e]);const t=e.map((e=>new Promise(((t,i)=>{var n,s,r;const o=(e,n)=>{e?i(e):t(n)},a=()=>{o(null,!0)};e.strategy||(e.strategy=document.head?"inject":"eval"),e.injectLocation||(e.injectLocation="head"),e.async||(e.async=!1);const l=e.strategy.toLowerCase();if("inject"===l){(null!==(n=document.querySelector(e.injectLocation))&&void 0!==n?n:document.head)||o(new ReferenceError("Unable to find element in document."),!1);const t=e.src,i=e.injectLocation,l=t.endsWith("css")?"stylesheet":"script";if("script"===l){const n=document.createElement("script");n.async=e.async,n.src=t,n.addEventListener("load",(()=>a())),n.addEventListener("error",(()=>o(new Error("Script failed to load.\n"+t),!1))),n.addEventListener("abort",(()=>o(new Error("Script aborted.\n"+t),!1))),(null!==(s=document.querySelector(i))&&void 0!==s?s:document.head).appendChild(n)}else if("stylesheet"===l){const e=document.createElement("link");e.rel="stylesheet",e.href=t,e.addEventListener("load",(()=>a())),e.addEventListener("error",(()=>o(new Error("Link failed to load.\n"+t),!1))),e.addEventListener("abort",(()=>o(new Error("Link aborted.\n"+t),!1))),(null!==(r=document.querySelector(i))&&void 0!==r?r:document.head).appendChild(e)}else o(new TypeError("Invalid resource type specified."),!1)}else"eval"===l?jk.get(e.src).then((e=>{try{new Function(e)(),a()}catch(e){o(e,!1)}})).catch((e=>o(e,!1))):"href"===l?(window.location.href||o(new ReferenceError("Unable to find href object."),!1),jk.get(e.src).then((e=>{try{window.location.href="javascript:"+encodeURIComponent(e),a()}catch(e){o(e,!1)}})).catch((e=>o(e,!1)))):o(new ReferenceError(`Invalid strategy: ${e.strategy}. \nWith source: ${e.src}`),!1)}))));return Promise.all(t)}))}const yG=(e,t)=>{const i=[],n=[];t.forEach((e=>{i.push(e.x),n.push(e.y)}));const{x:s,y:r}=e,o=i.length;let a=o-1,l=0;for(let e=0;e<o;e++)(n[e]<=r&&r<n[a]||n[a]<=r&&r<n[e])&&s>(i[a]-i[e])*(r-n[e])/(n[a]-n[e])+i[e]&&(l=!l),a=e;return!!l};function xG(e,t){e=e.map((e=>Vv(e)));const i=[];for(let t=0;t<e.length-1;t++)i.push(e[t].distanceTo(e[t+1]));if(0==t)return e[0];if(1==t)return e[e.length-1];const n=i.reduce(((e,t)=>e+t),0);let s,r=0,o=0;for(s=0;s<i.length;s++){const e=i[s],a=r+e;if(t<=a/n){o=(t*n-r)/e;break}r=a}return e[s].clone().lerp(e[s+1],o)}function wG(e,t){let i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)}function bG(e,t){let i,n,s,r,o,a,l,h,c,d,u,p,f,m=[],g=e.length-1,v=g,y=e.length>0&&3===e[0].length,x=e;if(y){x=[...e];for(let e=0;e<x.length;e++)x[e]=[x[e][0],x[e][2],x[e][1]]}let w=jb(x[0]).equals(jb(x[g]));w||(u=x[0],p=x[1],f=[u[0]+(p[1]-u[1])/wG(u,p)*t,u[1]-(p[0]-u[0])/wG(u,p)*t],m.push(f),x.push(x[g]),g++,v--);for(let e=0;e<v;e++)u=x[e],p=x[(e+1)%g],f=x[(e+2)%g],i=(p[1]-u[1])/(p[0]-u[0]),n=(f[1]-p[1])/(f[0]-p[0]),Math.abs(i-n)>1e-10&&(s=Math.sqrt((p[0]-u[0])*(p[0]-u[0])+(p[1]-u[1])*(p[1]-u[1])),r=Math.sqrt((f[0]-p[0])*(f[0]-p[0])+(f[1]-p[1])*(f[1]-p[1])),o=u[0]+t*(p[1]-u[1])/s,a=p[0]+t*(f[1]-p[1])/r,l=u[1]-t*(p[0]-u[0])/s,h=p[1]-t*(f[0]-p[0])/r,c=(n*a-i*o+l-h)/(n-i),d=(i*n*(a-o)+n*l-i*h)/(n-i),p[0]-u[0]==0&&(c=p[0]+t*(p[1]-u[1])/Math.abs(p[1]-u[1]),d=n*c-n*a+h),f[0]-p[0]==0&&(c=f[0]+t*(f[1]-p[1])/Math.abs(f[1]-p[1]),d=i*c-i*o+l),m.push([c,d]));if(w?m.push(m[0]):(x.pop(),u=x[x.length-1],p=x[x.length-2],f=[u[0]-(p[1]-u[1])/wG(u,p)*t,u[1]+(p[0]-u[0])/wG(u,p)*t],m.push(f)),y)for(let t=0;t<m.length;t++)m[t][2]=m[t][1],m[t][1]=e[t][1];return m}const _G=(e,t,i)=>Tv(e.x,t.x,i)&&Tv(e.y,t.y,i)&&Tv(e.z,t.z,i),SG=(e,t,n,s,r)=>{const o=e.clone().sub(n),a=s.clone().sub(n);if(a.lengthSq()<=r)return null;const l=t.clone().sub(e);if(l.lengthSq()<=r)return null;const h=o.x*a.x+o.y*a.y+o.z*a.z,c=a.x*l.x+a.y*l.y+a.z*l.z,d=o.x*l.x+o.y*l.y+o.z*l.z,u=a.x*a.x+a.y*a.y+a.z*a.z,p=(l.x*l.x+l.y*l.y+l.z*l.z)*u-c*c;if(Math.abs(p)<=r)return null;const f=(h*c-d*u)/p,m=(h+c*f)/u;return[new i(e.x+f*l.x,e.y+f*l.y,e.z+f*l.z),new i(n.x+m*a.x,n.y+m*a.y,n.z+m*a.z)]};function MG(e,t,n,s,r){null!=r||(r=1e-6);const o=(new i).subVectors(t,e),a=(new i).subVectors(s,n),l=(new i).subVectors(n,e),h=(new i).crossVectors(o,a),c=(new i).crossVectors(l,a);if(h.lengthSq()<r)return c.lengthSq()<r?{status:!1,result:"COLINEAR",point:null,ratio:null}:{status:!1,result:"PARALLEL",point:null,ratio:null};let d=SG(e,t,n,s,r);if(!d)return{status:!1,result:"NONE",point:null,ratio:null};if(d[0].distanceTo(d[1])<r){const i=t.distanceTo(e),o=d[0].distanceTo(e),a=d[0].distanceTo(t),l=o/i,h=s.distanceTo(n),c=d[1].distanceTo(n),u=d[0].distanceTo(s),p=c/h;return Tv(o+a,i,r)&&Tv(c+u,h,r)&&p>=-r&&p<=1+r&&l>=-r&&l<=1+r?{status:!0,result:"INTERSECT",point:d[0],ratio:l}:{status:!1,result:"NONE",point:null,ratio:null}}return{status:!1,result:"NONE",point:null,ratio:null}}function CG(e,t,i){if(i=null!=i?i:1e-6,e.length<2||t.length<2)return[[...e]];const n=[],s=e=>{let t=0;for(t=0;t<n.length;t++){const i=n[t];if(!(i.closestPointIndex<e.closestPointIndex||i.closestPointIndex===e.closestPointIndex&&i.ratio<e.ratio))break}n.splice(t,0,e)};for(let n=1;n<e.length;n++)for(let r=1;r<t.length;r++){const o=MG(e[n-1],e[n],t[r-1],t[r],i);if(o.status&&!Ev(o.ratio)&&!Ev(o.ratio-1)){const t=o.point.clone();_G(t,e[n-1],i)||_G(t,e[n],i)||s({point:t,closestPointIndex:n-1,ratio:o.ratio})}}const r=[];if(0===n.length)return[[...e]];{let t=[],i=0;for(let s=0;s<n.length;s++){const o=n[s];for(;!(i>o.closestPointIndex||i>=e.length);)t.push(e[i]),i++;t.push(o.point),r.push(t),t=[],t.push(o.point)}for(let n=i;n<e.length;n++)t.push(e[n]);r.push(t)}return r}function AG(e,t){let i=(e=[...e]).length,n=((null!=t?t:1e-6)+"").length-2;const s=e=>`${e.x.toFixed(n)},${e.y.toFixed(n)},${e.z.toFixed(n)}`;let r={};e.forEach((e=>{e.forEach((e=>{var t;let i=s(e);null!==(t=r[i])&&void 0!==t||(r[i]=0),r[i]=r[i]+1}))}));let o=[],a=[];for(let t=0;t<e.length;t++){let i=e[t],n=[i[0]];for(let e=1;e<i.length;e++){let l=s(i[e]);n.push(i[e]),r[l]>1&&(o.push(n),a.push(t),n=[i[e]])}n.length>1&&(o.push(n),a.push(t))}const l=[];let h=[];const c=(e=o).map((e=>(new E).setFromPoints(e))),d=new Set;for(let n=0;n<e.length;n++)if(!d.has(n))for(let s=0;s<e.length;s++)if(n!==s&&a[n]!=a[s]&&!d.has(n)&&!d.has(s)&&c[n].intersectsBox(c[s])){const r=CG(e[n],e[s],t);if(r.length>1){d.add(n),e.push(...r);for(let e=0;e<r.length;e++)a.push(a[n]);if(c.push(...r.map((e=>(new E).setFromPoints(e)))),e.length>1e3*i)return{status:!1,error:"data is error"};break}}for(let t=0;t<e.length;t++)d.has(t)||(l.push(e[t]),h.push(a[t]));return{status:!0,lines:l,indexs:h}}function EG(){const e=new S;return e.setAttribute("position",new M([-1,3,0,-1,-1,0,3,-1,0],3)),e.setAttribute("uv",new M([0,2,0,0,2,0],2)),e}function TG(e,t){const n=new m(e,e,e,t,t,t),s=n.getAttribute("position"),r=n.getAttribute("normal");for(let t=0;t<s.count;t++){const n=(new i).fromArray(s.array,3*t);n.normalize(),r.setXYZ(t,n.x,n.y,n.z),n.setLength(e),s.setXYZ(t,n.x,n.y,n.z)}return n}function PG(e,t){const n=e.geometry.getAttribute("position"),s=new i,r=new i,o=new i(1,1,1),a=new i(-1,-1,-1);for(let i=0;i<n.count;i++)s.fromArray(n.array,3*i).applyMatrix4(e.matrixWorld),r.copy(s).project(t),o.min(r),a.max(r);return new gi(o,a)}function OG(e,t=0){const i=e.position.z-t,n=o.degToRad(e.fov),s=2*Math.tan(n/2)*i;return{width:s*e.aspect,height:s}}function DG(e,t,i=0){const n=e.position.z-i;return o.radToDeg(2*Math.atan(t/(2*n)))}function BG(e,t,i){e.fov===t.fov&&e.zoom===t.zoom||(e.fov!==t.fov&&(e.fov=o.lerp(e.fov,t.fov,i)),e.zoom!==t.zoom&&(e.zoom=o.lerp(e.zoom,t.zoom,i)),e.updateProjectionMatrix()),e.position.lerp(t.position,i),e.quaternion.slerp(t.quaternion,i)}const IG=(e,t,n,s)=>{var r,o;null!=s||(s=Cy.app);let a=null==s?void 0:s.isMapMode,l=null!==(r=t.UnProjectOpts)&&void 0!==r?r:Cy.useData.UnProjectOpts,h=[{label:`投影到${a?"XY":"XZ"}平面`,onClick:()=>{t.UnProjectOpts=!1,Cy.useData.UnProjectOpts=!1},icon:l?"":"checked"},{label:"投影到场景对象上",onClick:()=>{t.UnProjectOpts=!0,Cy.useData.UnProjectOpts=!0},icon:!0===l?"checked":""}];return!a&&s&&s.composer&&h.push({label:"投影到当前深度坐标",onClick:()=>{var e;null===(e=s.envConfig)||void 0===e||e.unProjectOptions,t.UnProjectOpts="depth",Cy.useData.UnProjectOpts=t.UnProjectOpts},icon:"depth"===l?"checked":""}),!a&&s&&h.push({label:"投影到当前屏幕平面",onClick:()=>{var e,n,r;let o=null!==(n=null===(e=s.envConfig)||void 0===e?void 0:e.unProjectOptions)&&void 0!==n?n:{};t.UnProjectOpts=null!==(r=o.point)&&void 0!==r?r:new i(0,0,0),Cy.useData.UnProjectOpts=t.UnProjectOpts},icon:!0===(null==l?void 0:l.isVector3)?"checked":""}),new eF(Object.assign(Object.assign({event:e,theme:"dark",width:90*h.length+"px"},n),{items:[{type:"custom",markup:'<span style="color: #ffff00; padding-left: 30px">屏幕坐标转世界坐标投影设置</span>'},{type:"multi",items:h},...null!==(o=null==n?void 0:n.items)&&void 0!==o?o:[]]}))},RG=e=>{let n=uv();const s=(t,i)=>new Promise(((s,r)=>{var o,a;try{const r=n=>{i&&(n=1-n),e.children.forEach((e=>{let i={position:e.targetPosition};t.enableRotation&&(i.rotation=e.targetRotation),e.position.lerpVectors(e.originalPosition,e.targetPosition,n),t.enableRotation&&e.rotation.copy(Av(e.originalRotation,e.targetRotation,n))}))};zy({id:n,duration:null!==(o=t.time)&&void 0!==o?o:3e3,easing:null!==(a=t.easing)&&void 0!==a?a:"linear",onProgress(e,t,i,n,s,o){r(s)},onComplete(e){r(1),s({})}})}catch(e){r(e)}}));return{explode:n=>{var r;return(n=>{const s=new i;e.getWorldPosition(s),e.children.forEach((e=>{e.originalPosition=e.position.clone();const n=new i;e.getWorldPosition(n),e.directionVector=n.clone().sub(s).normalize(),e.originalRotation=e.rotation.clone(),e.targetRotation=new t(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI)})),e.children.forEach((e=>{e.targetPosition=e.originalPosition.clone().add(e.directionVector.clone().multiplyScalar(n))}))})(null!==(r=(n=n||{}).distance)&&void 0!==r?r:3),s(n)},reset:e=>s(e=e||{},!0)}},kG=e=>{e.outputColorSpace?e.outputColorSpace=se:e.outputEncoding=sRGBEncoding},LG=e=>{kG(e),e.toneMapping=vi},zG=e=>{kG(e),e.toneMapping=yi,e.toneMappingExposure=3,e.shadowMap.enabled=!0,e.shadowMap.type=ei,e.physicallyCorrectLights&&(e.physicallyCorrectLights=!0)},UG=e=>{e.shadowMap.enabled=!0,e.shadowMap.type=ei},FG=(e,t)=>{const i=new ti(e);i.compileEquirectangularShader();const n=i.fromEquirectangular(t).texture;return i.dispose(),n},NG=(e,t)=>new ti(e).fromScene(t).texture,jG=(e,t)=>{const i=[];if(e.isEntity&&(e=e.node),e.traverse((e=>{i.push(e)})),t){const e=i.map(((e,i)=>`const ${e.name} = ${t}[${i}];`)).join("\n");console.log(e)}return i};class VG extends Error{constructor(e){super(e),Object.setPrototypeOf(this,VG.prototype)}}function HG(e){const t={addNode:s,removeNode:function(e){return Object.keys(i).forEach((function(t){i[t].forEach((function(i){i===e&&d(t,i)}))})),delete i[e],t},nodes:r,adjacent:o,addEdge:c,removeEdge:d,hasEdge:function(e,t){return o(e).includes(t)},setEdgeWeight:l,getEdgeWeight:h,indegree:function(e){let t=0;function n(i){i===e&&t++}return Object.keys(i).forEach((function(e){i[e].forEach(n)})),t},outdegree:function(e){return e in i?i[e].length:0},depthFirstSearch:u,hasCycle:function(){try{return u(void 0,!0,!0),!1}catch(e){if(e instanceof VG)return!0;throw e}},lowestCommonAncestors:function(e,t){const i=[],n=[];return function e(s,r){return!!s[r]||(s[r]=!0,i.push(r),r===t?(n.push(r),!1):o(r).every((t=>e(s,t))))}({},e)&&function e(t,s){t[s]||(t[s]=!0,i.includes(s)?n.push(s):0===n.length&&o(s).forEach((i=>{e(t,i)})))}({},t),n},topologicalSort:function(e,t=!0){return u(e,t,!0).reverse()},shortestPath:function(e,t){const i={},n={};let s={};function a(){let e,t=1/0;return Object.keys(s).forEach((function(n){i[n]<t&&(t=i[n],e=n)})),void 0===e?(s={},null):(delete s[e],e)}function l(e,t){const s=h(e,t);i[t]>i[e]+s&&(i[t]=i[e]+s,n[t]=e)}return function(){for(function(){if(r().forEach((function(e){i[e]=1/0})),i[e]!==1/0)throw new Error("Source node is not in the graph");if(i[t]!==1/0)throw new Error("Destination node is not in the graph");i[e]=0}(),r().forEach((function(e){s[e]=!0}));0!==Object.keys(s).length;){const e=a();if(null===e)return;o(e).forEach((function(t){l(e,t)}))}}(),function(){const i=[];let s=0,r=t;for(;n[r];)i.push(r),s+=h(n[r],r),r=n[r];if(r!==e)throw new Error("No path found");return i.push(r),i.reverse(),i.weight=s,i}()},serialize:function(){const e={nodes:r().map((function(e){return{id:e}})),links:[]};return e.nodes.forEach((function(t){const i=t.id;o(i).forEach((function(t){e.links.push({source:i,target:t,weight:h(i,t)})}))})),e},deserialize:p},i={},n={};function s(e){return i[e]=o(e),t}function r(){const e={};return Object.keys(i).forEach((function(t){e[t]=!0,i[t].forEach((function(t){e[t]=!0}))})),Object.keys(e)}function o(e){return i[e]||[]}function a(e,t){return e+"|"+t}function l(e,i,s){return n[a(e,i)]=s,t}function h(e,t){const i=n[a(e,t)];return void 0===i?1:i}function c(e,i,n){return s(e),s(i),o(e).push(i),void 0!==n&&l(e,i,n),t}function d(e,n){return i[e]&&(i[e]=o(e).filter((function(e){return e!==n}))),t}function u(e,t=!0,i=!1){e||(e=r()),"boolean"!=typeof t&&(t=!0);const n={},s={},a=[];function l(e){if(s[e]&&i)throw new VG("Cycle found");n[e]||(n[e]=!0,s[e]=!0,o(e).forEach(l),s[e]=!1,a.push(e))}return t?e.forEach(l):(e.forEach((function(e){n[e]=!0})),e.forEach((function(e){o(e).forEach(l)}))),a}function p(e){return e.nodes.forEach((function(e){s(e.id)})),e.links.forEach((function(e){c(e.source,e.target,e.weight)})),t}return e&&p(e),t}function WG(e,t,i){var n,s;t=null!=t?t:6,i=null!=i&&i;const r=e=>e.roundStr(t),o=HG(),a={},l={edges:{},inputNodes:{},outputNodes:{}};for(let t=0;t<e.length;t++){const h=t+1;if(e[t].id=null!==(n=e[t].id)&&void 0!==n?n:t+1+"",a[e[t].id]=h,e[t].weight=null!==(s=e[t].weight)&&void 0!==s?s:WW(e[t].points.map((e=>e.toArray()))),e[t].points.length<2)throw Error(`index ${t}, id: ${e[t].id} points length is ${e[t].points.length}, must large two`);const c=e[t].points[0],d=e[t].points[e[t].points.length-1],u=r(c),p=r(d);o.addEdge(u,p,e[t].weight);let f=`${u}_${p}`;l.edges[f]=l.edges[f]||[],l.edges[f].push(h),l.outputNodes[u]=l.outputNodes[u]||[],l.outputNodes[u].push(h),l.inputNodes[p]=l.inputNodes[p]||[],l.inputNodes[p].push(h),i||(o.addEdge(p,u,e[t].weight),f=`${p}_${u}`,l.edges[f]=l.edges[f]||[],l.edges[f].push(-h),l.outputNodes[p]=l.outputNodes[p]||[],l.outputNodes[p].push(h),l.inputNodes[u]=l.inputNodes[u]||[],l.inputNodes[u].push(h))}return{graph:o,topo:l}}function GG(e,t){var i;let n={tubes:[],nodes:new Map};null!=t||(t={});let s=[...e];if(null!==(i=t.decimalPrecision)&&void 0!==i||(t.decimalPrecision=6),"nodeEqual"!==t.topoStrategy){let e=[];for(let t=0;t<s.length;t++)e.push(s[t].paths.map((e=>Vv(e))));let i=AG(e,Math.pow(.1,t.decimalPrecision)),n=[];for(let e=0;e<i.lines.length;e++){let t=i.lines[e].map((e=>e.toArray())),r=s[i.indexs[e]];n.push(Object.assign(Object.assign({},r),{paths:t}))}s=n}let r=new Map;const o=e=>`${e[0].toFixed(t.decimalPrecision)},${e[1].toFixed(t.decimalPrecision)},${e[2].toFixed(t.decimalPrecision)}`;for(let e=0;e<s.length;e++){let t=s[e].paths,i={paths:t,startId:o(t[0]),endId:o(t[t.length-1]),dist:WW(t),clipPath:t,data:s[e]},a=0;r.has(i.startId)&&(a=r.get(i.startId)),r.set(i.startId,a+1),a=0,r.has(i.endId)&&(a=r.get(i.endId)),r.set(i.endId,a+1);let l=yv(i.startId).substring(0,8),h=yv(i.endId).substring(0,8);n.tubes.push({tubeIndex:e,data:s[e],startNodeId:l,endNodeId:h}),n.nodes.has(l)?n.nodes.get(l).push(e):n.nodes.set(l,[e]),n.nodes.has(h)?n.nodes.get(h).push(e):n.nodes.set(h,[e])}return{inputData:s,topo:n}}function YG(e,t,i){const n=Nb.convert(e),s=Nb.convert(t),r=i.map((e=>e.points.map((e=>Nb.convert(e))))),o=(e,t)=>{const i=e[t.closestIndex],n=[],s=[];for(let e=0;e<i.length;e++)e<t.closestPointIndex?n.push(i[e]):e===t.closestPointIndex?(n.push(i[e]),n.push(t.closestPoint),s.push(t.closestPoint)):s.push(i[e]);e[t.closestIndex]=n,e.push(s)},a=(e,t,i,n)=>{const s=e=>{let t=0;const i=e.map((e=>Nb.convert(e)));for(let e=1;e<i.length;e++)t+=(n=i[e-1].x,s=i[e-1].y,r=i[e].x,o=i[e].y,a=i[e].z,l=i[e].z,Math.sqrt((n-r)*(n-r)+(s-o)*(s-o)+(a-l)*(a-l)));var n,s,r,o,a,l;return t},r=i.edges[`${e}_${t}`],o=e.split(","),a=new Nb(+o[0],+o[1],+o[2]),l=t.split(","),h=new Nb(+l[0],+l[1],+l[2]);if(0===r.length)return{points:[a,h],index:-1,reverse:!1};{r.length>1&&r.sort(((e,t)=>s(n[Math.abs(e)-1])-s(n[Math.abs(t)-1])));let e=r[0];return e>=0?{points:[...n[e-1]],index:e,reverse:!1}:(e=-e,{points:[...n[e-1].reverse()],index:e,reverse:!0})}},l=fS(n,r),h=fS(s,r),c=[...r];l.closestIndex!==h.closestIndex?(o(c,l),o(c,h)):((e,t,i,n)=>{const s=e[t];let r=!1,o=i,a=n;n.closestPointIndex<i.closestPointIndex&&(r=!0),n.closestPointIndex===i.closestPointIndex&&n.closestPrePointDist<i.closestPrePointDist&&(r=!0),r&&(o=n,a=i);const l=[],h=[],c=[];for(let e=0;e<s.length;e++)e<o.closestPointIndex?l.push(s[e]):e===o.closestPointIndex?(l.push(s[e]),l.push(o.closestPoint),h.push(o.closestPoint),e===a.closestPointIndex&&(h.push(a.closestPoint),c.push(a.closestPoint))):e<a.closestPointIndex?h.push(s[e]):e===a.closestPointIndex?(h.push(s[e]),h.push(a.closestPoint),c.push(a.closestPoint)):c.push(s[e]);e[t.closestIndex]=l,e.push(h),e.push(c)})(c,l.closestIndex,l,h);try{const e=WG(c.map((e=>({points:e})))),t=e.graph.shortestPath(l.closestPoint.roundStr(),h.closestPoint.roundStr()),i=[],n=[];for(let s=1;s<t.length;s++){const r=a(t[s-1],t[s],e.topo,c);1===s?i.push(...r.points):i.push(...r.points.slice(1)),n.push(r)}return{startPoint:l,endPoint:h,route:i.map((e=>[e.x,e.y,e.z])),routeDetail:n}}catch(e){return{error:e}}}class XG extends S{constructor(e,t,s,a,l,h){super();const c=t.length-1,d=e.getLength();this.type="VarTubeGeometry",this.parameters={lut:h,path:e,tubularSegments:c,radialSegments:null!=s?s:8,closed:closed},h&&(h.setMax(a[1]),h.setMin(a[0]));const u=function(e,s){const r=new i,o=[],a=t.length-1,l=[],h=[],c=new i,u=new n,p=(e,t,i)=>Math.max(t,Math.min(i,e));for(let t=0;t<s.length;t++){const n=s[t][0]/d;o[t]=e.getTangentAt(n,new i),o[t].normalize()}l[0]=new i,h[0]=new i;let f=Number.MAX_VALUE;const m=Math.abs(o[0].x),g=Math.abs(o[0].y),v=Math.abs(o[0].z);m<=f&&(f=m,r.set(1,0,0)),g<=f&&(f=g,r.set(0,1,0)),v<=f&&r.set(0,0,1),c.crossVectors(o[0],r).normalize(),l[0].crossVectors(o[0],c),h[0].crossVectors(o[0],l[0]);for(let e=1;e<=a;e++){if(l[e]=l[e-1].clone(),h[e]=h[e-1].clone(),c.crossVectors(o[e-1],o[e]),c.length()>Number.EPSILON){c.normalize();const t=Math.acos(p(o[e-1].dot(o[e]),-1,1));l[e].applyMatrix4(u.makeRotationAxis(c,t))}h[e].crossVectors(o[e],l[e])}return{tangents:o,normals:l,binormals:h}}(e,t);this.tangents=u.tangents,this.normals=u.normals,this.binormals=u.binormals;const p=new i,f=new i,m=new r;let g=new i;const v=[],y=[],x=[],w=[],b=[];function _(t,i){g=e.getPointAt(i[0]/d,g);const n=o.mapLinear(i[1],a[0],a[1],l[0],l[1]),r=u.normals[t],c=u.binormals[t];var m=null;h&&(m=h.getColor(i[1]));for(let e=0;e<=s;e++){const t=e/s*Math.PI*2,i=Math.sin(t),o=-Math.cos(t);f.x=o*r.x+i*c.x,f.y=o*r.y+i*c.y,f.z=o*r.z+i*c.z,f.normalize(),y.push(f.x,f.y,f.z),m&&w.push(m.r,m.g,m.b),p.x=g.x+n*f.x,p.y=g.y+n*f.y,p.z=g.z+n*f.z,v.push(p.x,p.y,p.z)}}!function(){for(let e=0;e<=c;e++)_(e,t[e]);(function(){for(let e=0;e<=c;e++)for(let t=0;t<=s;t++)m.x=e/c,m.y=t/s,x.push(m.x,m.y)})(),function(){for(let e=1;e<=c;e++)for(let t=1;t<=s;t++){const i=(s+1)*(e-1)+(t-1),n=(s+1)*e+(t-1),r=(s+1)*e+t,o=(s+1)*(e-1)+t;b.push(i,n,o),b.push(n,r,o)}}()}(),this.setIndex(b),this.setAttribute("position",new M(v,3)),this.setAttribute("normal",new M(y,3)),this.setAttribute("uv",new M(x,2)),this.setAttribute("color",new M(w,3))}}const QG=(e,t,i)=>{e=2*Math.PI*(e-.5),t=2*Math.PI*(t-.5);const n=1+Math.cosh(e)*Math.cosh(t),s=Math.sinh(t)*Math.cos(5*e)/n,r=Math.sinh(t)*Math.sin(5*e)/n,o=Math.cosh(t)*Math.sinh(e)/n;i.set(s,o,r)},qG=(e,t,i)=>{const n=.6,s=2*e*Math.PI,r=2*t*Math.PI,o=Math.cos(s)*Math.cos(r),a=Math.cos(s)*Math.sin(r),l=Math.sin(s),h=1*o/Math.sqrt(1-n*Math.pow(a,2)-n*Math.pow(l,2)),c=1*a/Math.sqrt(1-n*Math.pow(o,2)-n*Math.pow(l,2)),d=1*l/Math.sqrt(1-n*Math.pow(Math.cos(s),2));i.set(c,d,h)};class ZG extends an{constructor(e,t){super(QG,e,t)}}class KG extends an{constructor(e,t){super(qG,e,t)}}const JG=e=>{if(void 0===e.axisUp){let t=Cy.app;t&&t.isMapMode?e.axisUp="z":e.axisUp="y"}let t,i=e.points;if(e.isClose&&(jb(i[0]).equals(jb(i[i.length-1]))||i.push(i[0])),!1!==e.isUseCenter){let e=Yb.fromDataExtent(i);t=e.center().toArray(),i=i.map((e=>[e[0]-t[0],e[1]-t[1]]))}let n=new S,s=[],r=[],o=i,a=e.height;for(let t=0;t<o.length-1;t++)"z"==e.axisUp?(s.push(o[t][0],o[t][1],0,o[t+1][0],o[t+1][1],0,o[t+1][0],o[t+1][1],a),s.push(o[t][0],o[t][1],0,o[t+1][0],o[t+1][1],a,o[t][0],o[t][1],a)):"y"==e.axisUp?(s.push(o[t][0],0,o[t][1],o[t+1][0],0,o[t+1][1],o[t+1][0],a,o[t+1][1]),s.push(o[t][0],0,o[t][1],o[t+1][0],a,o[t+1][1],o[t][0],a,o[t][1])):(s.push(0,o[t][0],o[t][1],0,o[t+1][0],o[t+1][1],a,o[t+1][0],o[t+1][1]),s.push(0,o[t][0],o[t][1],a,o[t+1][0],o[t+1][1],a,o[t][0],o[t][1])),r.push(t/o.length,0,t/o.length+2/o.length,0,t/o.length+2/o.length,1),r.push(t/o.length,0,t/o.length+2/o.length,1,t/o.length,1);n.attributes.position=new O(new Float32Array(s),3),n.attributes.uv=new O(new Float32Array(r),2),n.computeVertexNormals();let l=[0,t[0],t[1]];return"z"==e.axisUp?l=[t[0],t[1],0]:"y"==e.axisUp&&(l=[t[0],0,t[1]]),{geometry:n,center:l}};class $G{static createOffscreenCanvas(e,t){if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(e,t);{let i=document.createElement("canvas");return i.width=e,i.height=t,i}}}class eY{static createFillTexture(e="#000000",t=1,i=1){const n=$G.createOffscreenCanvas(t,i),s=n.getContext("2d");s.fillStyle=e,s.fillRect(0,0,t,i);const r=new W(n);return r.format=U,r.magFilter=N,r.minFilter=N,r.generateMipmaps=!1,r.needsUpdate=!0,r}}class tY{}tY.root=-1,tY.topLeft=0,tY.topRight=1,tY.bottomLeft=2,tY.bottomRight=3;class iY extends h{constructor(e=null,t=null,i=tY.root,n=0,s=0,r=0,o=null,a=null){super(o,a),this.mapView=null,this.parentNode=null,this.subdivided=!1,this.disposed=!1,this.nodesLoaded=0,this.childrenCache=null,this.isMesh=!0,this.mapView=t,this.parentNode=e,this.disposed=!1,this.location=i,this.level=n,this.x=s,this.y=r,this.initialize()}initialize(){return Qv(this,void 0,void 0,(function*(){}))}createChildNodes(){}subdivide(){const e=this.mapView.maxZoom();this.children.length>0||this.level+1>e||null!==this.parentNode&&this.parentNode.nodesLoaded<iY.childrens||(this.mapView.cacheTiles&&null!==this.childrenCache?(this.isMesh=!1,this.children=this.childrenCache,this.nodesLoaded=this.childrenCache.length):this.createChildNodes(),this.subdivided=!0)}simplify(){const e=this.mapView.minZoom();if(!(this.level-1<e)){if(this.mapView.cacheTiles)this.childrenCache=this.children;else for(let e=0;e<this.children.length;e++)this.children[e].dispose();this.subdivided=!1,this.isMesh=!0,this.children=[],this.nodesLoaded=0}}loadData(){var e,t,i,n;return Qv(this,void 0,void 0,(function*(){if(this.level<this.mapView.provider.minZoom||this.level>this.mapView.provider.maxZoom)return console.warn("Loading tile outside of provider range.",this),this.material.map=(null===(e=this.mapView.provider.options)||void 0===e?void 0:e.transparent)?iY.defaultTransparentTexture:iY.defaultTexture,void(this.material.needsUpdate=!0);try{let e,n=null===(t=this.mapView.provider.options)||void 0===t?void 0:t.transparent,r=this.mapView.provider.fetchTile(this.level,this.x,this.y),o=r.layers;if(n&&(null===(i=this.mapView.provider.options)||void 0===i?void 0:i.fetchAsTexture)&&o.length>0&&o[0].tileUrl)e=o.map((e=>iL.loadTexture(e.tileUrl))),e.forEach((e=>{e.generateMipmaps=!0,e.magFilter=N,e.minFilter=Be}));else{let t=yield r.promise;if(this.disposed)return;Array.isArray(t)||(t=[t]),e=t.map((e=>{let t=new W(e);return t.generateMipmaps=!0,t.format=U,t.magFilter=N,t.minFilter=Be,t.needsUpdate=!0,t}))}if(this.mapView.provider.options.texture&&e.forEach((e=>{for(let t in this.mapView.provider.options.texture)t in e&&(e[t]=this.mapView.provider.options.texture[t])})),0==e.length)throw Error("no get texture");this.material.map=e[0];let a=this.mapView.provider.options.colorFilter,l=a?Hv(a):void 0;if(e.length>1?this.material.onBeforeCompile=t=>{var i,n,s;a&&(null!==(i=t.defines)&&void 0!==i||(t.defines={}),t.defines.USE_COLORFILTER="");let r=["#ifdef USE_MAP \n uniform sampler2D map;"],h=["#ifdef USE_MAP \n vec4 sampledDiffuseColor = texture2D( map, vMapUv );"];r.push("uniform vec4 backColor;"),t.uniforms.backColor={value:null!==(n=this.mapView.provider.options.backColor)&&void 0!==n?n:new y(0,0,0,0)},a&&(t.uniforms.uColorFilterMat={value:l});for(let i=1;i<e.length;i++)t.uniforms[`texture_layer${i}`]={value:e[i]},t.uniforms[`opacity_layer${i}`]={value:null!==(s=o[i].opacity)&&void 0!==s?s:1},r.push(`uniform sampler2D texture_layer${i};`),r.push(`uniform float opacity_layer${i};`),h.push(`vec4 layerSampleColor${i} = texture2D( texture_layer${i}, vMapUv );`),h.push(`sampledDiffuseColor = mix(sampledDiffuseColor, layerSampleColor${i}, layerSampleColor${i}.a * opacity_layer${i});`);r.push("#endif"),r.push("\n\t\t\t\t\t#ifdef USE_COLORFILTER\n\t\t\t\t\t  uniform mat4 uColorFilterMat;\n\t\t\t\t\t#endif\n\t\t\t\t\t"),h.push("diffuseColor *= sampledDiffuseColor;"),h.push("#ifdef USE_COLORFILTER \n diffuseColor.rgb = vec3(vec4(diffuseColor.rgb, 1.0)*uColorFilterMat); \n #endif \n "),h.push("if (diffuseColor.a == 0.0) \n { \ndiffuseColor = backColor; \n } \n"),h.push("#endif"),t.fragmentShader=t.fragmentShader.replace("#include <map_pars_fragment>",r.join("\n")).replace("#include <map_fragment>",h.join("\n"))}:this.material.onBeforeCompile=e=>{var t,i,n,r;a&&(null!==(t=e.defines)&&void 0!==t||(e.defines={}),e.defines.USE_COLORFILTER="");let o=new y(0,0,0,0);if(null===(r=null===(n=null===(i=this.mapView)||void 0===i?void 0:i.provider)||void 0===n?void 0:n.options)||void 0===r?void 0:r.backColor){let e=new s(this.mapView.provider.options.backColor);o=new y(e.r,e.g,e.b,0)}e.uniforms.backColor={value:o};let l=["#ifdef USE_MAP \n uniform sampler2D map;"];l.push("uniform vec4 backColor;"),l.push("#endif"),l.push("\n\t\t\t\t\t#ifdef USE_COLORFILTER\n\t\t\t\t\t uniform mat4 uColorFilterMat;\n\t\t\t\t\t#endif\n\t\t\t\t\t");let h=["#ifdef USE_MAP \n vec4 sampledDiffuseColor = texture2D( map, vMapUv );"];h.push("diffuseColor *= sampledDiffuseColor;"),h.push("#ifdef USE_COLORFILTER \n diffuseColor.rgb = vec3(vec4(diffuseColor.rgb, 1.0)*uColorFilterMat); \n #endif \n "),h.push("if (diffuseColor.a == 0.0) \n { \ndiffuseColor = backColor; \n } \n"),h.push("#endif"),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",l.join("\n")).replace("#include <map_fragment>",h.join("\n"))},this.mapView.provider.options){!0===this.mapView.provider.options.transparent&&void 0===this.mapView.provider.options.depthWrite&&(this.mapView.provider.options.depthWrite=!1);for(let e in this.mapView.provider.options)e in this.material&&(this.material[e]=this.mapView.provider.options[e])}}catch(e){if(this.disposed)return;console.warn("Failed to load node tile data. error: ",e,this),this.material.map=(null===(n=this.mapView.provider.options)||void 0===n?void 0:n.transparent)?iY.defaultTransparentTexture:iY.defaultTexture}this.mapView.isClip&&(this.material.stencilWrite=!0,this.material.stencilRef=this.mapView.options.isUseClipOuter?0:1,this.material.stencilFunc=xi),this.material.needsUpdate=!0}))}nodeReady(){if(this.disposed)this.dispose();else if(null!==this.parentNode){if(this.parentNode.nodesLoaded++,this.parentNode.nodesLoaded===iY.childrens){!0===this.parentNode.subdivided&&(this.parentNode.isMesh=!1);for(let e=0;e<this.parentNode.children.length;e++)this.parentNode.children[e].visible=!0}this.parentNode.nodesLoaded>iY.childrens&&console.error("Loaded more children objects than expected.",this.parentNode.nodesLoaded,this)}else this.visible=!0}dispose(){var e;if(this.disposed=!0,null===(e=this.mapView.provider.options)||void 0===e?void 0:e.transparent)return;const t=this;try{const e=t.material;e.dispose(),e.map&&e.map!==iY.defaultTexture&&e.map!==iY.defaultTransparentTexture&&e.map.dispose()}catch(e){}try{t.geometry.dispose()}catch(e){}}}iY.defaultTexture=eY.createFillTexture(),iY.defaultTransparentTexture=eY.createFillTexture("rgba(255, 255, 255, 0)"),iY.baseGeometry=null,iY.childrens=4;class nY extends S{constructor(e=1,t=1,i=1,n=1,s=!1,r=10){super();const o=[],a=[],l=[],h=[];nY.buildPlane(e,t,i,n,o,a,l,h),s&&nY.buildSkirt(e,t,i,n,r,o,a,l,h),this.setIndex(o),this.setAttribute("position",new M(a,3)),this.setAttribute("normal",new M(l,3)),this.setAttribute("uv",new M(h,2))}static buildPlane(e=1,t=1,i=1,n=1,s,r,o,a){const l=e/2,h=t/2,c=i+1,d=n+1,u=e/i,p=t/n;for(let e=0;e<d;e++){const t=e*p-h;for(let s=0;s<c;s++){const h=s*u-l;r.push(h,0,t),o.push(0,1,0),a.push(s/i,1-e/n)}}for(let e=0;e<n;e++)for(let t=0;t<i;t++){const i=t+c*e,n=t+c*(e+1),r=t+1+c*(e+1),o=t+1+c*e;s.push(i,n,o,n,r,o)}}static buildSkirt(e=1,t=1,i=1,n=1,s,r,o,a,l){const h=e/2,c=t/2,d=i+1,u=n+1,p=e/i,f=t/n;let m=o.length/3;for(let e=0;e<d;e++){const t=e*p-h,n=-c;o.push(t,-s,n),a.push(0,1,0),l.push(e/i,1)}for(let e=0;e<i;e++){const t=e,i=e+1,n=e+m,s=e+m+1;r.push(i,n,t,i,s,n)}m=o.length/3;for(let e=0;e<d;e++){const t=e*p-h,r=n*f-c;o.push(t,-s,r),a.push(0,1,0),l.push(e/i,0)}let g=d*u-i-1;for(let e=0;e<i;e++){const t=g+e,i=g+e+1,n=e+m,s=e+m+1;r.push(t,n,i,n,s,i)}m=o.length/3;for(let e=0;e<u;e++){const t=e*f-c,i=-h;o.push(i,-s,t),a.push(0,1,0),l.push(0,1-e/n)}for(let e=0;e<n;e++){const t=e*u,i=(e+1)*u,n=e+m,s=e+m+1;r.push(t,n,i,n,s,i)}m=o.length/3;for(let e=0;e<u;e++){const t=e*f-c,r=i*p-h;o.push(r,-s,t),a.push(0,1,0),l.push(1,1-e/n)}for(let e=0;e<n;e++){const t=e*u+n,i=(e+1)*u+n,s=e+m,o=e+m+1;r.push(i,s,t,i,o,s)}}}class sY extends iY{constructor(e=null,t=null,i=tY.root,n=0,s=0,r=0){super(e,t,i,n,s,r,sY.geometry,new x({wireframe:!1})),this.matrixAutoUpdate=!1,this.isMesh=!0,this.visible=!1}initialize(){const e=Object.create(null,{initialize:{get:()=>super.initialize}});return Qv(this,void 0,void 0,(function*(){e.initialize.call(this),yield this.loadData(),this.nodeReady()}))}createChildNodes(){const e=this.level+1,t=2*this.x,i=2*this.y,n=Object.getPrototypeOf(this).constructor;let s=new n(this,this.mapView,tY.topLeft,e,t,i);s.scale.set(.5,1,.5),s.position.set(-.25,0,-.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),s=new n(this,this.mapView,tY.topRight,e,t+1,i),s.scale.set(.5,1,.5),s.position.set(.25,0,-.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),s=new n(this,this.mapView,tY.bottomLeft,e,t,i+1),s.scale.set(.5,1,.5),s.position.set(-.25,0,.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),s=new n(this,this.mapView,tY.bottomRight,e,t+1,i+1),s.scale.set(.5,1,.5),s.position.set(.25,0,.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0)}raycast(e,t){!0===this.isMesh&&super.raycast(e,t)}}sY.geometry=new nY(1,1,1,1,!1),sY.baseGeometry=sY.geometry;class rY extends S{constructor(e=1,t=1,i=1,n=1,s=!1,r=10,o=null,a=!0,l=1){super();const h=[],c=[],d=[],u=[];nY.buildPlane(e,t,i,n,h,c,d,u);const p=o.data;for(let e=0,t=0;e<p.length&&t<c.length;e+=4,t+=3){const i=.1*(65536*p[e]+256*p[e+1]+p[e+2])-1e4;c[t+1]=i*l}s&&nY.buildSkirt(e,t,i,n,r*l,h,c,d,u),this.setIndex(h),this.setAttribute("position",new M(c,3)),this.setAttribute("normal",new M(d,3)),this.setAttribute("uv",new M(u,2)),a&&this.computeNormals(i,n)}computeNormals(e,t){const n=this.getAttribute("position");if(void 0!==n){let s=this.getAttribute("normal");const r=t*e;for(let e=0;e<r;e++)s.setXYZ(e,0,0,0);const o=new i,a=new i,l=new i,h=new i,c=new i,d=new i,u=new i,p=new i,f=t*e*6;for(let e=0;e<f;e+=3){const t=this.index.getX(e+0),i=this.index.getX(e+1),r=this.index.getX(e+2);o.fromBufferAttribute(n,t),a.fromBufferAttribute(n,i),l.fromBufferAttribute(n,r),u.subVectors(l,a),p.subVectors(o,a),u.cross(p),h.fromBufferAttribute(s,t),c.fromBufferAttribute(s,i),d.fromBufferAttribute(s,r),h.add(u),c.add(u),d.add(u),s.setXYZ(t,h.x,h.y,h.z),s.setXYZ(i,c.x,c.y,c.z),s.setXYZ(r,d.x,d.y,d.z)}this.normalizeNormals(),s.needsUpdate=!0}}}class oY extends iY{constructor(e=null,t=null,i=tY.root,n=0,s=0,r=0,o=oY.geometry,a=new ce({wireframe:!1,color:16777215})){super(e,t,i,n,s,r,o,a),this.heightLoaded=!1,this.textureLoaded=!1,this.geometrySize=16,this.geometryNormals=!1,this.isMesh=!0,this.visible=!1,this.matrixAutoUpdate=!1}initialize(){const e=Object.create(null,{initialize:{get:()=>super.initialize}});return Qv(this,void 0,void 0,(function*(){e.initialize.call(this),yield this.loadData(),yield this.loadHeightGeometry(),this.nodeReady()}))}loadData(){const e=Object.create(null,{loadData:{get:()=>super.loadData}});return Qv(this,void 0,void 0,(function*(){yield e.loadData.call(this),this.textureLoaded=!0}))}loadHeightGeometry(){return Qv(this,void 0,void 0,(function*(){if(null===this.mapView.heightProvider)throw new Error("GeoThree: MapView.heightProvider provider is null.");if(this.level<this.mapView.heightProvider.minZoom||this.level>this.mapView.heightProvider.maxZoom)return console.warn("Loading tile outside of provider range.",this),void(this.geometry=sY.baseGeometry);try{let e=yield this.mapView.heightProvider.fetchTile(this.level,this.x,this.y).promise;if(this.disposed)return;Array.isArray(e)&&(e=e[0]);const t=$G.createOffscreenCanvas(this.geometrySize+1,this.geometrySize+1),i=t.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(e,0,0,oY.tileSize,oY.tileSize,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height);this.geometry=new rY(1,1,this.geometrySize,this.geometrySize,!0,10,n,!0,this.mapView.skirtDepthScale)}catch(e){if(this.disposed)return;this.geometry=sY.baseGeometry}this.heightLoaded=!0}))}createChildNodes(){const e=this.level+1,t=Object.getPrototypeOf(this).constructor,i=2*this.x,n=2*this.y;let s=new t(this,this.mapView,tY.topLeft,e,i,n);s.scale.set(.5,1,.5),s.position.set(-.25,0,-.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),s=new t(this,this.mapView,tY.topRight,e,i+1,n),s.scale.set(.5,1,.5),s.position.set(.25,0,-.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),s=new t(this,this.mapView,tY.bottomLeft,e,i,n+1),s.scale.set(.5,1,.5),s.position.set(-.25,0,.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),s=new t(this,this.mapView,tY.bottomRight,e,i+1,n+1),s.scale.set(.5,1,.5),s.position.set(.25,0,.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0)}raycast(e,t){!0===this.isMesh&&super.raycast(e,t)}}oY.tileSize=256,oY.geometry=new nY(1,1,1,1),oY.baseGeometry=sY.geometry;class aY extends oY{constructor(e=null,t=null,i=tY.root,n=0,s=0,r=0){const o=aY.prepareMaterial(new ce({map:iY.defaultTexture,color:16777215}));aY.geometry2||(aY.geometry=new nY(1,1,aY.geometrySize,aY.geometrySize,!0,10*t.skirtDepthScale),aY.geometry2=aY.geometry),super(e,t,i,n,s,r,aY.geometry,o),this.material.owerMapView=t,this.frustumCulled=!1}static prepareMaterial(e){return e.userData={heightMap:{value:aY.defaultHeightTexture},heightScale:{value:1}},e.onBeforeCompile=t=>{for(const i in e.userData)t.uniforms[i]=e.userData[i];e.owerMapView&&e.owerMapView.heightScale&&(t.uniforms.heightScale.value=e.owerMapView.heightScale),t.vertexShader="\n\t\t\tuniform sampler2D heightMap;\n\t\t\tuniform float heightScale;\n\t\t\t"+t.vertexShader,t.vertexShader=t.vertexShader.replace("#include <fog_vertex>","\n\t\t\t#include <fog_vertex>\n\t\t\t#if defined( USE_MAP )\n\t\t\t// Calculate height of the title\n\t\t\tvec4 _theight = texture2D(heightMap, vMapUv);\n\t\t\t#else\n\t\t\tvec4 _theight = vec4(0.0, 0.0, 0.0, 0.0);\n\t\t\t#endif\n\t\t\tfloat _height = ((_theight.r * 255.0 * 65536.0 + _theight.g * 255.0 * 256.0 + _theight.b * 255.0) * 0.1) - 10000.0;\n\t\t\tvec3 _transformed = position + _height * heightScale * normal;\n\t\n\t\t\t// Vertex position based on height\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(_transformed, 1.0);\n\t\t\t")},e}loadData(){const e=Object.create(null,{loadData:{get:()=>super.loadData}});return Qv(this,void 0,void 0,(function*(){yield e.loadData.call(this),this.textureLoaded=!0}))}loadHeightGeometry(){return Qv(this,void 0,void 0,(function*(){if(null===this.mapView.heightProvider)throw new Error("GeoThree: MapView.heightProvider provider is null.");if(this.level<this.mapView.heightProvider.minZoom||this.level>this.mapView.heightProvider.maxZoom)return console.warn("Loading tile outside of provider range.",this),this.material.map=aY.defaultTexture,void(this.material.needsUpdate=!0);try{let e=yield this.mapView.heightProvider.fetchTile(this.level,this.x,this.y).promise;if(this.disposed)return;Array.isArray(e)&&(e=e[0]);const t=new W(e);t.generateMipmaps=!1,t.format=U,t.magFilter=Te,t.minFilter=Te,t.needsUpdate=!0,this.material.userData.heightMap.value=t}catch(e){if(this.disposed)return;console.error("Failed to load node tile height data.error: ",e,this),this.material.userData.heightMap.value=aY.defaultHeightTexture}this.material.needsUpdate=!0,this.heightLoaded=!0}))}raycast(e,t){!0===this.isMesh&&(this.geometry=sY.geometry,super.raycast(e,t),this.geometry=aY.geometry)}dispose(){super.dispose(),this.material.userData.heightMap.value&&this.material.userData.heightMap.value!==aY.defaultHeightTexture&&this.material.userData.heightMap.value.dispose()}}aY.defaultHeightTexture=eY.createFillTexture("#0186C0"),aY.geometrySize=256,aY.baseGeometry=sY.geometry;class lY{constructor(){this.subdivisionRays=1,this.thresholdUp=.6,this.thresholdDown=.15,this.raycaster=new p,this.mouse=new r,this.powerDistance=!1,this.scaleDistance=!0}updateLOD(e,t,n,s){const r=[];for(let i=0;i<this.subdivisionRays;i++)this.mouse.set(2*Math.random()-1,2*Math.random()-1),this.raycaster.setFromCamera(this.mouse,t),this.raycaster.intersectObjects(e.children,!0,r);for(let e=0;e<r.length;e++){const t=r[e].object;if(t.isStencil||!t.subdivide)continue;let n=r[e].distance;if(this.powerDistance&&(n=Math.pow(2*n,t.level)),this.scaleDistance){const e=t.matrixWorld.elements;n=new i(e[0],e[1],e[2]).length()/n}n>this.thresholdUp?t.subdivide():n<this.thresholdDown&&t.parentNode&&t.parentNode.simplify()}}}class hY{static lngLatToMercator(e,t){const i=e[0]*hY.EQUATORIAL_SEMIPERIMETER/180;let n=Math.log(Math.tan((90+e[1])*Math.PI/360))/(Math.PI/180);return n=n*hY.EQUATORIAL_SEMIPERIMETER/180,t?hY.toNormalize([i,n]):[i,n]}static mercatorToLngLat(e,t){t&&(e=hY.fromNormalize(e));const i=e[0]/hY.EQUATORIAL_SEMIPERIMETER*180;let n=e[1]/hY.EQUATORIAL_SEMIPERIMETER*180;return n=180/Math.PI*(2*Math.atan(Math.exp(n*Math.PI/180))-Math.PI/2),[i,n]}static toNormalize(e,t){return t=null!=t?t:hY.EARTH_BOUNDS,[(e[0]-t[0])/(t[2]-t[0]),(e[1]-t[1])/(t[3]-t[1])]}static fromNormalize(e,t){return t=null!=t?t:hY.EARTH_BOUNDS,[e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]]}static toMercator(e,t,i){let n=(hY.EARTH_BOUNDS[2]-hY.EARTH_BOUNDS[0])/(t[2]-t[0]),s=(hY.EARTH_BOUNDS[3]-hY.EARTH_BOUNDS[1])/(t[3]-t[1]),r=[hY.EARTH_BOUNDS[0]+(e[0]-t[0])*n,hY.EARTH_BOUNDS[1]+(e[1]-t[2])*s];return i?hY.toNormalize(r):r}static fromMercator(e,t,i){i&&(e=hY.fromNormalize(e));let n=(hY.EARTH_BOUNDS[2]-hY.EARTH_BOUNDS[0])/(t[2]-t[0]),s=(hY.EARTH_BOUNDS[3]-hY.EARTH_BOUNDS[1])/(t[3]-t[1]);return[t[0]+(e[0]-hY.EARTH_BOUNDS[0])/n,t[1]+(e[1]-hY.EARTH_BOUNDS[1])/s]}static getLikeCoordType(e){Array.isArray(e)||(e=[e]);let t=hY.WebMapCoordType.unknown;for(let i=0;i<e.length;i++){let n=hY.WebMapCoordType.unknown;if(e[i][0]>=0&&e[i][0]<=1&&e[i][1]>=0&&e[i][1]<=1?n=hY.WebMapCoordType.NormalizeMercator:e[i][0]>=70&&e[i][0]<=140&&e[i][1]>=2&&e[i][1]<=60?n=hY.WebMapCoordType.LngLat:e[i][0]>=7792364&&e[i][0]<=15584728&&e[i][1]>=222684&&e[i][1]<=8399737&&(n=hY.WebMapCoordType.Mercator),t==hY.WebMapCoordType.unknown)t=n;else if(t!=n)return hY.WebMapCoordType.unknown}return t}static getTileBBox(e,t,i){return hY.getTileMercator(e,t,i).join(",")}static getTileMercator(e,t,i){t=Math.pow(2,i)-t-1;var n=this.getMercCoords(256*e,256*t,i),s=this.getMercCoords(256*(e+1),256*(t+1),i);return[n[0],n[1],s[0],s[1]]}static getMercCoords(e,t,i){var n=2*hY.EQUATORIAL_SEMIPERIMETER/256/Math.pow(2,i);return[e*n-2*hY.EQUATORIAL_SEMIPERIMETER/2,t*n-2*hY.EQUATORIAL_SEMIPERIMETER/2]}static fetchDebugTile(e,t,i,n,r,o,a){a=null!=a?a:256;const l=$G.createOffscreenCanvas(a,a),h=l.getContext("2d"),c=new s(null!=n?n:65280),d=new s(null!=r?r:16711680),u=new s(null!=o?o:2273612),p=c.lerpHSL(d,(e-0)/24);return h.fillStyle=p.getStyle(),h.fillRect(0,0,a,a),h.strokeStyle=u.getStyle(),h.strokeRect(0,0,a,a),h.fillStyle="#000000",h.textAlign="center",h.textBaseline="middle",h.font="bold "+.1*a+"px arial",h.fillText("("+e+")",a/2,.4*a),h.fillText("("+t+", "+i+")",a/2,.6*a),Promise.resolve(l)}}hY.EQUATORIAL_SEMIPERIMETER=20037508.3427892,hY.EARTH_BOUNDS=[-hY.EQUATORIAL_SEMIPERIMETER,-hY.EQUATORIAL_SEMIPERIMETER,hY.EQUATORIAL_SEMIPERIMETER,hY.EQUATORIAL_SEMIPERIMETER],hY.WebMapCoordType={unknown:0,LngLat:1,Mercator:2,NormalizeMercator:3};class cY{static mapboxAltitude(e){return.1*(255*e.r*65536+255*e.g*256+255*e.b)-1e4}}var dY,uY,pY;cY.EARTH_RADIUS=6378137,cY.EARTH_PERIMETER=2*Math.PI*cY.EARTH_RADIUS,cY.EARTH_ORIGIN=cY.EARTH_PERIMETER/2;class fY extends h{constructor(e){var t,i,n,s,r,o,a;super(void 0,new x({transparent:!0,opacity:0,depthWrite:!1,colorWrite:!1})),dY.add(this),this.lod=null,this.provider=null,this.heightProvider=null,this.root=null,this.cacheTiles=!1,this.useScheduler=!0,this.onBeforeRender=(e,t,i,n,s,r)=>{this.lod.updateLOD(this,i,e,t)},this.options=e,!1!==this.options.polygonOffset&&(this.material.polygonOffset=!0,this.material.polygonOffsetFactor=null!==(t=this.options.polygonOffsetFactor)&&void 0!==t?t:1,this.material.polygonOffsetUnits=null!==(i=this.options.polygonOffsetUnits)&&void 0!==i?i:.8);let l=null!==(n=e.root)&&void 0!==n?n:fY.PLANAR,h=e.provider;if(!h)throw new Error("provider is null");h.mapView=this;let c=e.heightProvider;if(c&&(c.mapView=this,(null===(s=h.options)||void 0===s?void 0:s.rootTile)&&!(null===(r=c.options)||void 0===r?void 0:r.rootTile)&&(c.options.rootTile=null===(o=h.options)||void 0===o?void 0:o.rootTile),e.root||(l=fY.HEIGHT)),!1===e.useScheduler&&(this.useScheduler=!1),this.provider=h,this.heightProvider=c,qv(this,dY,"m",pY).call(this),this.lod=new lY,e.lod)for(let t in e.lod)this.lod[t]=e.lod[t];this.scheduler=new Qw,this.setRoot(l),e.baseScale=null!==(a=e.baseScale)&&void 0!==a?a:1,this.scale.set(e.baseScale,1,e.baseScale),this.preSubdivide(),this.clip(),qv(this,dY,"m",uY).call(this),this.addEventListener("added",(()=>{this.updateMatrixWorld(!0)}))}mapToLocal(e){let t=this.getMapBounds(),n=hY.toNormalize(e,t);return new i(n[0]-.5,0,-(n[1]-.5))}localToMap(e){let t=this.getMapBounds(),i=e[0],n=e[1];e.isVector3?(i=e.x,n=e.z):3==e.length&&(n=e[2]);let s=i+.5,r=.5-n;return hY.fromNormalize([s,r],t)}mapToWorld(e){return this.localToWorld(this.mapToLocal(e))}worldToMap(e){let t=e;e.isVector3&&(t=e.toArray());let n=this.worldToLocal(2==t.length?new i(t[0],0,t[1]):new i(t[0],t[1],t[2]));return this.localToMap(n.toArray())}lngLatToLocal(e){let t=this.lngLatToNormalize(e);return new i(t[0]-.5,0,-(t[1]-.5))}localToLngLat(e){var t;let i=e[0],n=e[1];e.isVector3?(i=e.x,n=e.z):3==e.length&&(n=e[2]);let s=i+.5,r=.5-n,o=null===(t=this.provider.options)||void 0===t?void 0:t.rootTile;if(o){let e=hY.getTileMercator(o[1],o[2],o[0]),t=hY.fromNormalize([s,r],e);return hY.mercatorToLngLat(t)}return hY.mercatorToLngLat([s,r],!0)}lngLatToWorld(e){return this.localToWorld(this.lngLatToLocal(e))}worldToLngLat(e){let t=e;e.isVector3&&(t=e.toArray());let n=this.worldToLocal(2==t.length?new i(t[0],0,t[1]):new i(t[0],t[1],t[2]));return this.localToLngLat(n.toArray())}lngLatToNormalize(e){var t;let i=null===(t=this.provider.options)||void 0===t?void 0:t.rootTile;if(i){let t=hY.lngLatToMercator(e),n=hY.getTileMercator(i[1],i[2],i[0]);return hY.toNormalize(t,n)}return hY.lngLatToMercator(e,!0)}getMapBounds(){var e;if(this.options.mapBounds)return this.options.mapBounds;let t=null===(e=this.provider.options)||void 0===e?void 0:e.rootTile;return t?hY.getTileMercator(t[1],t[2],t[0]):hY.EARTH_BOUNDS}worldResolution(){let e=this.getMapBounds(),t=this.mapToWorld([e[0],(e[1]+e[3])/2]),i=this.mapToWorld([e[2],(e[1]+e[3])/2]),n=t.distanceTo(i);return(e[2]-e[0])/n}isWebBaseMap(){return!this.options.mapBounds}clip(){var e,t,i;if(!this.options.clipPolygon)return;this.stencilMesh&&(lW(this.stencilMesh),this.remove(this.stencilMesh));let n=this.options.clipPolygon;if(Array.isArray(n)){if(n.length<3)return void console.warn("clip points length is less 3");this.isWebBaseMap()?hY.getLikeCoordType(n)==hY.WebMapCoordType.LngLat&&(n=n.map((e=>this.lngLatToNormalize(e)))):n=n.map((e=>hY.toNormalize(e,this.options.mapBounds))),n=new ht(n.map((e=>new r(e[0],e[1])))),n.closePath()}this.isClip=!0;let s=new wi(n),o=new x({wireframe:!1});o.depthWrite=!1,o.depthTest=!1,o.colorWrite=!1,o.stencilWrite=!0,o.stencilFunc=bi,o.stencilZPass=_i;let a=new h(s,o);a.rotateX(-Math.PI/2),a.position.set(-.5,0,.5),a.isStencil=!0,a.renderOrder=-1,this.add(a),this.stencilMesh=a,!1!==this.options.isAfterRenderClearStencil&&(this.onAfterRender=function(e){e.clearStencil()}),(null===(i=null===(t=null===(e=this.options)||void 0===e?void 0:e.provider)||void 0===t?void 0:t.options)||void 0===i?void 0:i.transparent)&&(this.renderOrder=1e4)}setRoot(e){if("number"==typeof e){if(!fY.mapModes.has(e))throw new Error("Map mode "+e+" does is not registered.");e=new(fY.mapModes.get(e))(null,this)}null!==this.root&&(this.remove(this.root),this.root=null),this.root=e,null!==this.root&&(this.geometry=this.root.constructor.baseGeometry,this.root.mapView=this,this.add(this.root),this.root.initialize())}preSubdivide(){var e,t;const i=Math.max(this.provider.minZoom,null!==(t=null===(e=this.heightProvider)||void 0===e?void 0:e.minZoom)&&void 0!==t?t:-1/0);i>0&&function e(t,i){if(!(i<=0)){t.subdivide();for(let n=0;n<t.children.length;n++)t.children[n]instanceof iY&&e(t.children[n],i-1)}}(this.root,i)}setProvider(e){e!==this.provider&&(this.provider=e,this.provider.mapView=this,qv(this,dY,"m",pY).call(this),this.clear(),this.clip())}setHeightProvider(e){e!==this.heightProvider&&(this.heightProvider=e,this.heightProvider.mapView=this,this.clear())}clear(){return this.traverse((function(e){e.childrenCache&&(e.childrenCache=null),e.initialize&&e.initialize()})),this}minZoom(){var e,t;return Math.max(this.provider.minZoom,null!==(t=null===(e=this.heightProvider)||void 0===e?void 0:e.minZoom)&&void 0!==t?t:-1/0)}maxZoom(){var e,t;return Math.min(this.provider.maxZoom,null!==(t=null===(e=this.heightProvider)||void 0===e?void 0:e.maxZoom)&&void 0!==t?t:1/0)}raycast(e,t){return!1}}dY=new WeakSet,uY=function(){if(this.stencilMesh)return void(this.rayIntersectObject=this.stencilMesh);let e=new nY(1,1,1,1,!1),t=new x({transparent:!0,opacity:0,depthWrite:!1,colorWrite:!1}),i=new h(e,t);this.rayIntersectObject=i,this.add(i)},pY=function(){var e,t,i;let n=0;(null===(e=this.provider.options)||void 0===e?void 0:e.rootTile)&&(n=null===(t=this.provider.options)||void 0===t?void 0:t.rootTile[0]),this.heightScale=Math.pow(2,n)*(null!==(i=this.options.baseScale)&&void 0!==i?i:1)/cY.EARTH_PERIMETER,this.skirtDepthScale=this.heightScale,this.options.heightScale&&(this.heightScale*=this.options.heightScale),this.options.skirtDepthScale&&(this.skirtDepthScale*=this.options.skirtDepthScale)},fY.PLANAR=200,fY.HEIGHT=202,fY.HEIGHT_SHADER=203,fY.MARTINI=204,fY.mapModes=new Map([[fY.PLANAR,sY],[fY.HEIGHT,oY],[fY.HEIGHT_SHADER,aY]]);class mY{constructor(e,t){var i,n;this.name="",this.minZoom=0,this.maxZoom=22,this.layers=[],Array.isArray(e)?this.layers=e:this.layers=[e],this.options=null!=t?t:{};for(let e=0;e<this.layers.length;e++){let t=this.layers[e];if(this.layers[e].minZoom=null!==(i=t.minZoom)&&void 0!==i?i:0,this.layers[e].maxZoom=null!==(n=t.maxZoom)&&void 0!==n?n:24,0==e?(this.minZoom=t.minZoom,this.maxZoom=t.maxZoom):(this.minZoom=Math.min(this.minZoom,t.minZoom),this.maxZoom=Math.min(this.maxZoom,t.maxZoom)),t.bounds){let e=new gi(new r(t.bounds[0],t.bounds[1]),new r(t.bounds[2],t.bounds[3]));this.bounds?this.bounds.union(e):this.bounds=e.clone()}}}fetchTile(e,t,i){var n;let s=null===(n=this.options)||void 0===n?void 0:n.rootTile;s&&(t+=Math.pow(2,e)*s[1],i+=Math.pow(2,e)*s[2],e+=s[0]);let o=[],a=[];for(let n=0;n<this.layers.length;n++){let s=this.layers[n];if(s.minZoom>e)continue;if(s.maxZoom<e)continue;if(s.bounds){let e=new gi(new r(s.bounds[0],s.bounds[1]),new r(s.bounds[2],s.bounds[3]));if(!this.bounds.intersectsBox(e)&&!this.bounds.containsBox(e))continue}let l=s.url;if(s.url){if(l=l.replace("{z}",e+""),l=l.replace("{zoom}",e+""),l=l.replace("{x}",t+""),l=l.replace("{y}",i+""),l.indexOf("{bbox}")>=0||l.indexOf("{BBOX}")>=0){let n=hY.getTileBBox(t,i,e);l=l.replace("{bbox}",n),l=l.replace("{BBOX}",n)}s.tileUrl=l;const r=e=>new Promise(((t,i)=>{const n=document.createElement("img");n.onload=function(){t(n)},n.onerror=function(){i()},n.crossOrigin="Anonymous",n.src=e}));this.mapView.useScheduler?o.push(this.mapView.scheduler.execute({id:this.name+s.name+n,url:l,executeCommand:e=>r(e.url)})):o.push(r(l)),a.push(s)}else s.fetchTile&&(this.mapView.useScheduler?o.push(this.mapView.scheduler.execute({id:this.name+s.name+n,url:l,fetchTile:s.fetchTile,zoom:e,x:t,y:i,executeCommand:e=>e.fetchTile(e.zoom,e.x,e.y)})):o.push(s.fetchTile(e,t,i)),a.push(s))}return{promise:Promise.all(o),layers:a}}}class gY{constructor(e){this.fulfilled=!1,this.rejected=!1,this.called=!1;const t=e=>{this.fulfilled=!0,this.value=e,"function"==typeof this.onResolve&&(this.onResolve(this.value),this.called=!0)},i=e=>{this.rejected=!0,this.value=e,"function"==typeof this.onReject&&(this.onReject(this.value),this.called=!0)};try{e(t,i)}catch(e){i(e)}}cancel(){return!1}then(e){return this.onResolve=e,this.fulfilled&&!this.called&&(this.called=!0,this.onResolve(this.value)),this}catch(e){return this.onReject=e,this.rejected&&!this.called&&(this.called=!0,this.onReject(this.value)),this}finally(e){return this}static resolve(e){return new gY((function(t,i){t(e)}))}static reject(e){return new gY((function(t,i){i(e)}))}static all(e){const t=[],i=[];return new gY((function(n,s){e.forEach(((r,o)=>r.then((s=>{if(t.push(!0),i[o]=s,t.length===e.length)return n(i)})).catch((e=>s(e)))))}))}}class vY{static get(e){return Qv(this,void 0,void 0,(function*(){return new Promise((function(t,i){const n=new XMLHttpRequest;n.overrideMimeType("text/plain"),n.open("GET",e,!0),n.onload=function(){t(n.response)},n.onerror=i,n.send(null)}))}))}static getRaw(e){return Qv(this,void 0,void 0,(function*(){return new Promise((function(t,i){var n=new XMLHttpRequest;n.responseType="arraybuffer",n.open("GET",e,!0),n.onload=function(){t(n.response)},n.onerror=i,n.send(null)}))}))}static request(e,t,i,n,s,r,o){const a=new XMLHttpRequest;if(a.overrideMimeType("text/plain"),a.open(t,e,!0),null!=i)for(const e in i)a.setRequestHeader(e,i[e]);return void 0!==s&&(a.onload=function(e){s(function(e){try{return JSON.parse(e)}catch(t){return e}}(a.response),a)}),void 0!==r&&(a.onerror=r),void 0!==o&&(a.onprogress=o),a.send(void 0!==n?n:null),a}}class yY extends FP{constructor(e,t){super(new fY(e),t),t=null!=t?t:{},this.map=this.node,this.rayIntersectObject=this.map.rayIntersectObject,this.onEntityAwake((e=>{this.mesh.updateMatrixWorld(),!1!==t.autoSetAppCurrentMapView&&(e.mapViewEntity=this),!1!==t.disableRayQuery&&pW(this.mesh)}))}mapToLocal(e){return this.map.mapToLocal(e)}localToMap(e){return this.map.localToMap(e)}mapToWorld(e){return this.map.mapToWorld(e)}worldToMap(e){return this.map.worldToMap(e)}lngLatToLocal(e){return this.map.lngLatToLocal(e)}localToLngLat(e){return this.map.localToLngLat(e)}lngLatToWorld(e){return this.map.lngLatToWorld(e)}worldToLngLat(e){return this.map.worldToLngLat(e)}lngLatToNormalize(e){return this.map.lngLatToNormalize(e)}getMapBounds(){return this.map.getMapBounds()}worldResolution(){return this.map.worldResolution()}isWebBaseMap(){return this.map.isWebBaseMap()}clip(){return this.map.clip()}setRoot(e){return this.map.setRoot(e)}preSubdivide(){return this.map.preSubdivide()}setProvider(e){return this.map.setProvider(e)}setHeightProvider(e){return this.map.setHeightProvider(e)}clear(){return this.map.clear()}minZoom(){return this.map.minZoom()}maxZoom(){return this.map.maxZoom()}}var xY="#define GLSLIFY 1\nvarying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}";class wY extends a{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new X(null),luminanceBuffer1:new X(null),minLuminance:new X(.01),deltaTime:new X(0),tau:new X(1)},extensions:{shaderTextureLOD:!0},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <packing>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\nuniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));\n#if __VERSION__ < 300\nfloat l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;\n#else\nfloat l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;\n#endif\nl0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)? vec4(1.0): packFloatToRGBA(adaptedLum);}",vertexShader:xY})}set luminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}setLuminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}set luminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}setLuminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}set mipLevel1x1(e){this.defines.MIP_LEVEL_1X1=e.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(e){this.mipLevel1x1=e}set deltaTime(e){this.uniforms.deltaTime.value=e}setDeltaTime(e){this.uniforms.deltaTime.value=e}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(e){this.uniforms.minLuminance.value=e}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(e){this.uniforms.minLuminance.value=e}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(e){this.uniforms.tau.value=e}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(e){this.uniforms.tau.value=e}}class bY extends a{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{inputBuffer:new X(null),cocBuffer:new X(null),texelSize:new X(new r),kernel64:new X(null),kernel16:new X(null),scale:new X(1)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#if PASS == 1\nuniform vec4 kernel64[32];\n#else\nuniform vec4 kernel16[8];\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;\n#else\nfloat coc=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);\n#else\nvec2 step=texelSize*coc;\n#endif\n#if PASS == 1\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;\n#else\nvec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;\n#endif\n}}",vertexShader:xY}),t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.scale}setScale(e){this.scale=e}generateKernel(){const e=new Float64Array(128),t=new Float64Array(32);let i=0,n=0;for(let s=0,r=Math.sqrt(80);s<80;++s){const o=2.39996323*s,a=Math.sqrt(s)/r,l=a*Math.cos(o),h=a*Math.sin(o);s%5==0?(t[n++]=l,t[n++]=h):(e[i++]=l,e[i++]=h)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=t}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}function _Y(e,t,i){return e*(t-i)-t}function SY(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}class MY extends a{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new X(null),focusDistance:new X(0),focusRange:new X(0),cameraNear:new X(.3),cameraFar:new X(1e3)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nfloat depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nfloat depth=texture2D(depthBuffer,uv).r;\n#endif\n#ifdef LOG_DEPTH\nfloat d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;\n#endif\nreturn depth;}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",vertexShader:xY}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Si){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-_Y(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=SY(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-_Y(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=SY(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof ee?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}}const CY={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},AY={DEPTH:0,LUMA:1,COLOR:2},EY={NONE:0,DEPTH:1,CONVOLUTION:2},TY={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},PY={DISABLED:0,SPORADIC:1,CONSTANT_MILD:2,CONSTANT_WILD:3},OY={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},DY={DISABLED:0,DEPTH:1,CUSTOM:2},BY={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},IY={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},RY=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])];class kY extends a{constructor(e=new y){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new X(null),texelSize:new X(new y),scale:new X(1),kernel:new X(0)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",vertexShader:"#define GLSLIFY 1\nuniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.setTexelSize(e.x,e.y),this.kernelSize=OY.MEDIUM}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return RY[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,.5*e,.5*t)}setSize(e,t){const i=1/e,n=1/t;this.uniforms.texelSize.value.set(i,n,.5*i,.5*n)}}class LY extends a{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new X(null),opacity:new X(1)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <colorspace_fragment>\n#include <dithering_fragment>\n}",vertexShader:xY})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}}class zY extends a{constructor(e=null,t){super({name:"DepthComparisonMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new X(null),cameraNear:new X(.3),cameraFar:new X(1e3)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <packing>\n#include <clipping_planes_pars_fragment>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float cameraNear;uniform float cameraFar;centroid varying float vViewZ;centroid varying vec4 vProjTexCoord;void main(){\n#include <clipping_planes_fragment>\nvec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);\n#if DEPTH_PACKING == 3201\nfloat fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));\n#else\nfloat fragCoordZ=texture2D(depthBuffer,projTexCoord).r;\n#endif\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);\n#else\nfloat viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);\n#endif\nfloat depthTest=(-vViewZ>-viewZ)? 1.0 : 0.0;gl_FragColor.rg=vec2(0.0,depthTest);}",vertexShader:"#define GLSLIFY 1\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying float vViewZ;varying vec4 vProjTexCoord;void main(){\n#include <skinbase_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\nvViewZ=mvPosition.z;vProjTexCoord=gl_Position;\n#include <clipping_planes_vertex>\n}"}),this.depthBuffer=e,this.depthPacking=Mi,this.copyCameraSettings(t)}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Mi){this.depthBuffer=e,this.depthPacking=t}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof ee?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}}class UY extends a{constructor(){super({name:"DepthCopyMaterial",defines:{INPUT_DEPTH_PACKING:"0",OUTPUT_DEPTH_PACKING:"0",DEPTH_COPY_MODE:"0"},uniforms:{depthBuffer:new X(null),texelPosition:new X(new r)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <packing>\nvarying vec2 vUv;uniform vec2 cameraNearFar;\n#ifdef NORMAL_DEPTH\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D normalDepthBuffer;\n#else\nuniform mediump sampler2D normalDepthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){float depthA=texture2D(normalDepthBuffer,uv).a;\n#ifdef LOG_DEPTH\nfloat d=pow(2.0,depthA*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depthA=a+b/d;\n#endif\nreturn depthA;}\n#else\n#if INPUT_DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if INPUT_DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nfloat depthR=texture2D(depthBuffer,uv).r;\n#ifdef LOG_DEPTH\nfloat d=pow(2.0,depthR*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depthR=a+b/d;\n#endif\nreturn depthR;\n#endif\n}\n#endif\nvoid main(){\n#if INPUT_DEPTH_PACKING == OUTPUT_DEPTH_PACKING\ngl_FragColor=texture2D(depthBuffer,vUv);\n#else\nfloat depth=readDepth(vUv);\n#if OUTPUT_DEPTH_PACKING == 3201\ngl_FragColor=(depth==1.0)? vec4(1.0): packDepthToRGBA(depth);\n#else\ngl_FragColor=vec4(vec3(depth),1.0);\n#endif\n#endif\n}",vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n#if DEPTH_COPY_MODE == 1\nuniform vec2 texelPosition;\n#endif\nvoid main(){\n#if DEPTH_COPY_MODE == 1\nvUv=texelPosition;\n#else\nvUv=position.xy*0.5+0.5;\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}"}),this.depthCopyMode=0}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set inputDepthPacking(e){this.defines.INPUT_DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}get outputDepthPacking(){return Number(this.defines.OUTPUT_DEPTH_PACKING)}set outputDepthPacking(e){this.defines.OUTPUT_DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Si){this.depthBuffer=e,this.inputDepthPacking=t}getInputDepthPacking(){return Number(this.defines.INPUT_DEPTH_PACKING)}setInputDepthPacking(e){this.defines.INPUT_DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}getOutputDepthPacking(){return Number(this.defines.OUTPUT_DEPTH_PACKING)}setOutputDepthPacking(e){this.defines.OUTPUT_DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}get texelPosition(){return this.uniforms.texelPosition.value}getTexelPosition(){return this.uniforms.texelPosition.value}setTexelPosition(e){this.uniforms.texelPosition.value=e}get mode(){return this.depthCopyMode}set mode(e){this.depthCopyMode=e,this.defines.DEPTH_COPY_MODE=e.toFixed(0),this.needsUpdate=!0}getMode(){return this.mode}setMode(e){this.mode=e}}class FY extends a{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new X(null),normalBuffer:new X(null),texelSize:new X(new r)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\n#ifdef DOWNSAMPLE_NORMALS\nuniform lowp sampler2D normalBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);\n#ifdef DOWNSAMPLE_NORMALS\nvec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;\n#else\nvec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);\n#endif\ngl_FragColor=vec4(n[index],d[index]);}",vertexShader:"#define GLSLIFY 1\nuniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}"})}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Si){this.depthBuffer=e,this.depthPacking=t}set normalBuffer(e){this.uniforms.normalBuffer.value=e,null!==e?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(e){this.normalBuffer=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}class NY extends a{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:1},uniforms:{inputBuffer:new X(null),depthBuffer0:new X(null),depthBuffer1:new X(null),cameraNearFar:new X(new r(1,1))},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;\n#else\nuniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;\n#endif\nuniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#endif\n}varying vec2 vUv;void main(){vec2 depth;\n#if DEPTH_PACKING_0 == 3201\ndepth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));\n#else\ndepth.x=texture2D(depthBuffer0,vUv).r;\n#ifdef LOG_DEPTH\nfloat d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;\n#endif\n#endif\n#if DEPTH_PACKING_1 == 3201\ndepth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));\n#else\ndepth.y=texture2D(depthBuffer1,vUv).r;\n#ifdef LOG_DEPTH\nfloat d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;\n#endif\n#endif\nbool isMaxDepth=(depth.x==1.0);\n#ifdef PERSPECTIVE_CAMERA\ndepth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);\n#endif\n#if DEPTH_TEST_STRATEGY == 0\nbool keep=depthTest(depth.x,depth.y);\n#elif DEPTH_TEST_STRATEGY == 1\nbool keep=isMaxDepth||depthTest(depth.x,depth.y);\n#else\nbool keep=!isMaxDepth&&depthTest(depth.x,depth.y);\n#endif\nif(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}",vertexShader:xY}),this.depthMode=ke}set depthBuffer0(e){this.uniforms.depthBuffer0.value=e}set depthPacking0(e){this.defines.DEPTH_PACKING_0=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(e,t=Si){this.depthBuffer0=e,this.depthPacking0=t}set depthBuffer1(e){this.uniforms.depthBuffer1.value=e}set depthPacking1(e){this.defines.DEPTH_PACKING_1=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(e,t=Si){this.depthBuffer1=e,this.depthPacking1=t}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(e){this.defines.DEPTH_TEST_STRATEGY=e.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(e){this.maxDepthStrategy=e?1:2}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(e){this.maxDepthStrategy=e}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(e){this.defines.DEPTH_EPSILON=e.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(e){this.epsilon=e}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(e){let t;switch(e){case Ie:t="false";break;case Re:t="true";break;case ze:t="abs(d1 - d0) <= DEPTH_EPSILON";break;case Ne:t="abs(d1 - d0) > DEPTH_EPSILON";break;case ke:t="d0 > d1";break;case Le:t="d0 >= d1";break;case Ue:t="d0 <= d1";break;default:t="d0 < d1"}this.defines.DEPTH_MODE=e.toFixed(0),this.defines["depthTest(d0, d1)"]=t,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(e){this.depthMode=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNearFar.value.set(e.near,e.far),e instanceof ee?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}}class jY extends a{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new X(null),texelSize:new X(new r)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#define WEIGHT_INNER 0.125\n#define WEIGHT_OUTER 0.0555555\nvarying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;\n#include <colorspace_fragment>\n}",vertexShader:"#define GLSLIFY 1\nuniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}class VY extends a{constructor(e=new r,t=AY.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:ft.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new X(null),depthBuffer:new X(null),predicationBuffer:new X(null),texelSize:new X(e)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",vertexShader:"#define GLSLIFY 1\nuniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}"}),this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Si){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(.1*e).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}class HY extends a{constructor(e,t,i,n,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:ft.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new X(null),depthBuffer:new X(null),resolution:new X(new r),texelSize:new X(new r),cameraNear:new X(.3),cameraFar:new X(1e3),aspect:new X(1),time:new X(0)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.copyCameraSettings(n)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Si){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader="#define GLSLIFY 1\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#if DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEcolor0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <colorspace_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(TY.FRAGMENT_HEAD,e.get(TY.FRAGMENT_HEAD)||"").replace(TY.FRAGMENT_MAIN_UV,e.get(TY.FRAGMENT_MAIN_UV)||"").replace(TY.FRAGMENT_MAIN_IMAGE,e.get(TY.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader="#define GLSLIFY 1\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;varying vec3 vPosition;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;vPosition=position;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}".replace(TY.VERTEX_HEAD,e.get(TY.VERTEX_HEAD)||"").replace(TY.VERTEX_MAIN_SUPPORT,e.get(TY.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof ee?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return TY}}class WY extends a{constructor(e){super({name:"GodRaysMaterial",defines:{SAMPLES_INT:"60",SAMPLES_FLOAT:"60.0"},uniforms:{inputBuffer:new X(null),lightPosition:new X(e),density:new X(1),decay:new X(1),weight:new X(1),exposure:new X(1),clampMax:new X(1)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform vec2 lightPosition;uniform float exposure;uniform float decay;uniform float density;uniform float weight;uniform float clampMax;varying vec2 vUv;void main(){vec2 coord=vUv;vec2 delta=lightPosition-coord;delta*=1.0/SAMPLES_FLOAT*density;float illuminationDecay=1.0;vec4 color=vec4(0.0);for(int i=0;i<SAMPLES_INT;++i){coord+=delta;vec4 texel=texture2D(inputBuffer,coord);texel*=illuminationDecay*weight;color+=texel;illuminationDecay*=decay;}gl_FragColor=clamp(color*exposure,0.0,clampMax);\n#include <dithering_fragment>\n}",vertexShader:xY})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get lightPosition(){return this.uniforms.lightPosition.value}getLightPosition(){return this.uniforms.lightPosition.value}setLightPosition(e){this.uniforms.lightPosition.value=e}get density(){return this.uniforms.density.value}set density(e){this.uniforms.density.value=e}getDensity(){return this.uniforms.density.value}setDensity(e){this.uniforms.density.value=e}get decay(){return this.uniforms.decay.value}set decay(e){this.uniforms.decay.value=e}getDecay(){return this.uniforms.decay.value}setDecay(e){this.uniforms.decay.value=e}get weight(){return this.uniforms.weight.value}set weight(e){this.uniforms.weight.value=e}getWeight(){return this.uniforms.weight.value}setWeight(e){this.uniforms.weight.value=e}get exposure(){return this.uniforms.exposure.value}set exposure(e){this.uniforms.exposure.value=e}getExposure(){return this.uniforms.exposure.value}setExposure(e){this.uniforms.exposure.value=e}get maxIntensity(){return this.uniforms.clampMax.value}set maxIntensity(e){this.uniforms.clampMax.value=e}getMaxIntensity(){return this.uniforms.clampMax.value}setMaxIntensity(e){this.uniforms.clampMax.value=e}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(e){const t=Math.floor(e);this.defines.SAMPLES_INT=t.toFixed(0),this.defines.SAMPLES_FLOAT=t.toFixed(1),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(e){this.samples=e}}class GY extends a{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:ft.replace(/\D+/g,"")},uniforms:{inputBuffer:new X(null),threshold:new X(0),smoothing:new X(1),range:new X(null)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <common>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l)*l;\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:xY}),this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return null!==this.luminanceRange}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}}class YY extends a{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new X(e),inputBuffer:new X(null),strength:new X(1)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 3\nvec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);\n#elif MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",vertexShader:xY}),this.colorChannel=0,this.maskFunction=0}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==F&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return void 0!==this.defines.INVERTED}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}}class XY extends a{constructor(e=new r){super({name:"OutlineMaterial",uniforms:{inputBuffer:new X(null),texelSize:new X(new r)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\nuniform lowp sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)? vec2(d,0.0): vec2(0.0,d);}",vertexShader:"#define GLSLIFY 1\nuniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.uniforms.texelSize.value.set(e.x,e.y),this.uniforms.maskTexture=this.uniforms.inputBuffer}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}class QY extends a{constructor(e=new r,t=new r){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new X(null),searchTexture:new X(null),areaTexture:new X(null),resolution:new X(t),texelSize:new X(e)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",vertexShader:"#define GLSLIFY 1\nuniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){const t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){const t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return void 0===this.defines.DISABLE_DIAG_DETECTION}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){const t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return void 0===this.defines.DISABLE_CORNER_DETECTION}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){const i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}}class qY extends a{constructor(e){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new X(null),normalBuffer:new X(null),normalDepthBuffer:new X(null),noiseTexture:new X(null),inverseProjectionMatrix:new X(new n),projectionMatrix:new X(new n),texelSize:new X(new r),cameraNearFar:new X(new r),distanceCutoff:new X(new r),proximityCutoff:new X(new r),noiseScale:new X(new r),minRadiusScale:new X(.33),intensity:new X(1),fade:new X(.01),bias:new X(0)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#include <common>\n#include <packing>\n#ifdef NORMAL_DEPTH\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D normalDepthBuffer;\n#else\nuniform mediump sampler2D normalDepthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}\n#else\nuniform lowp sampler2D normalBuffer;\n#if DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}\n#endif\nuniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#endif\n}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);\n#ifdef PERSPECTIVE_CAMERA\nfloat linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);\n#else\nfloat linearSampleDepth=sampleDepth;\n#endif\nfloat proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){\n#ifdef NORMAL_DEPTH\nvec4 normalDepth=texture2D(normalDepthBuffer,vUv);\n#else\nvec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));\n#endif\nfloat ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);\n#ifdef PERSPECTIVE_CAMERA\nfloat linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);\n#else\nfloat linearDepth=depth;\n#endif\nif(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);\n#ifdef LEGACY_INTENSITY\nao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);\n#endif\n}gl_FragColor.r=ao;}",vertexShader:"#define GLSLIFY 1\nuniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}"}),this.copyCameraSettings(e),this.resolution=new r,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(e){this.uniforms.normalDepthBuffer.value=e,null!==e?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(e){this.normalDepthBuffer=e}set normalBuffer(e){this.uniforms.normalBuffer.value=e}setNormalBuffer(e){this.uniforms.normalBuffer.value=e}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Si){this.depthBuffer=e,this.depthPacking=t}set noiseTexture(e){this.uniforms.noiseTexture.value=e}setNoiseTexture(e){this.uniforms.noiseTexture.value=e}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(e){this.defines.SAMPLES_INT=e.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/e).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(e){this.samples=e}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(e){this.defines.SPIRAL_TURNS=e.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(e){this.rings=e}get intensity(){return this.uniforms.intensity.value}set intensity(e){this.uniforms.intensity.value=e,void 0===this.defines.LEGACY_INTENSITY&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(e){this.uniforms.intensity.value=e}get fade(){return this.uniforms.fade.value}set fade(e){this.uniforms.fade.value=e}getFade(){return this.uniforms.fade.value}setFade(e){this.uniforms.fade.value=e}get bias(){return this.uniforms.bias.value}set bias(e){this.uniforms.bias.value=e}getBias(){return this.uniforms.bias.value}setBias(e){this.uniforms.bias.value=e}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(e){this.uniforms.minRadiusScale.value=e}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(e){this.uniforms.minRadiusScale.value=e}updateRadius(){const e=this.r*this.resolution.height;this.defines.RADIUS=e.toFixed(11),this.defines.RADIUS_SQ=(e*e).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(e){this.r=Math.min(Math.max(e,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(e){this.radius=e}get distanceScaling(){return!0}set distanceScaling(e){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(e){this.distanceScaling=e}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(e,0),1),Math.min(Math.max(e+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-_Y(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(e){this.distanceThreshold=SY(-e,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(e){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+e,0),1)}get worldDistanceFalloff(){return-_Y(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(e){this.distanceFalloff=SY(-e,this.near,this.far)}setDistanceCutoff(e,t){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(e,0),1),Math.min(Math.max(e+t,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(e,0),1),Math.min(Math.max(e+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-_Y(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(e){this.proximityThreshold=SY(-e,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(e){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+e,0),1)}get worldProximityFalloff(){return-_Y(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(e){this.proximityFalloff=SY(-e,this.near,this.far)}setProximityCutoff(e,t){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(e,0),1),Math.min(Math.max(e+t,0),1))}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNearFar.value.set(e.near,e.far),this.uniforms.projectionMatrix.value.copy(e.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(e.projectionMatrix).invert(),e instanceof ee?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const i=this.uniforms,n=i.noiseTexture.value;null!==n&&i.noiseScale.value.set(e/n.image.width,t/n.image.height),i.texelSize.value.set(1/e,1/t),this.resolution.set(e,t),this.updateRadius()}}class ZY extends a{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new X(null),supportBuffer:new X(null),texelSize:new X(new r),radius:new X(.85)},blending:Q,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#define GLSLIFY 1\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;\n#else\nuniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;\n#endif\nuniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);\n#include <colorspace_fragment>\n}",vertexShader:"#define GLSLIFY 1\nuniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}set supportBuffer(e){this.uniforms.supportBuffer.value=e}get radius(){return this.uniforms.radius.value}set radius(e){this.uniforms.radius.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}const KY=new J;let JY=null;class $Y{constructor(e="Pass",t=new K,i=KY){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;null!==t&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;null!==t?t.material=e:(t=new h(function(){if(null===JY){const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);JY=new S,void 0!==JY.setAttribute?(JY.setAttribute("position",new O(e,3)),JY.setAttribute("uv",new O(t,2))):(JY.addAttribute("position",new O(e,3)),JY.addAttribute("uv",new O(t,2)))}return JY}(),e),t.frustumCulled=!1,null===this.scene&&(this.scene=new K),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Si){}render(e,t,i,n,s){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof q||t instanceof he||t instanceof W||t instanceof $Y)&&this[e].dispose()}}}class eX extends $Y{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new LY,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new q(1,1,{minFilter:N,magFilter:N,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,n,s){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){void 0!==i&&(this.renderTarget.texture.type=i,i!==F?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputColorSpace===se&&(this.renderTarget.texture.colorSpace=se))}}class tX extends $Y{constructor(e,{minLuminance:t=.01,adaptationRate:i=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new wY,this.needsSwap=!1,this.renderTargetPrevious=new q(1,1,{minFilter:Te,magFilter:Te,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const n=this.fullscreenMaterial;n.luminanceBuffer0=this.renderTargetPrevious.texture,n.luminanceBuffer1=e,n.minLuminance=t,n.adaptationRate=i,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new eX(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(e){this.fullscreenMaterial.mipLevel1x1=e}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(e){this.fullscreenMaterial.adaptationRate=e}render(e,t,i,n,s){this.fullscreenMaterial.deltaTime=n,e.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),e.render(this.scene,this.camera),this.copyPass.render(e,this.renderTargetAdapted)}}class iX extends $Y{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,n,s){const r=e.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}}const nX=new s;class sX extends $Y{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,n,s){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=e.getClearAlpha(),l=null!==r,h=o>=0;l?(e.getClearColor(nX),e.setClearColor(r,h?o:a)):h&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(nX,a):h&&e.setClearAlpha(a)}}class rX extends $Y{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new sX,this.overrideMaterialManager=null===i?null:new AX(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new AX(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,n,s){const r=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,h=r.background,c=e.shadowMap.autoUpdate,d=this.renderToScreen?null:t;null!==a&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(d),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,r,o):e.render(r,o),o.layers.mask=l,r.background=h,e.shadowMap.autoUpdate=c}}class oX extends $Y{constructor(e,t,{renderTarget:i,resolutionScale:n=1,width:r=TX.AUTO_SIZE,height:o=TX.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new rX(e,t,new Ci({depthPacking:Mi}));const h=this.renderPass;h.skipShadowMapUpdate=!0,h.ignoreBackground=!0;const c=h.clearPass;c.overrideClearColor=new s(16777215),c.overrideClearAlpha=1,this.renderTarget=i,void 0===this.renderTarget&&(this.renderTarget=new q(1,1,{minFilter:Te,magFilter:Te}),this.renderTarget.texture.name="DepthPass.Target");const d=this.resolution=new TX(this,a,l,n);d.addEventListener("change",(e=>this.setSize(d.baseWidth,d.baseHeight)))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,r)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}}class aX extends $Y{constructor({normalBuffer:e=null,resolutionScale:t=.5,width:i=TX.AUTO_SIZE,height:n=TX.AUTO_SIZE,resolutionX:s=i,resolutionY:r=n}={}){super("DepthDownsamplingPass");const o=new FY;o.normalBuffer=e,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new q(1,1,{minFilter:Te,magFilter:Te,depthBuffer:!1,type:re}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new TX(this,s,r,t);a.addEventListener("change",(e=>this.setSize(a.baseWidth,a.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(e,t=Si){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}render(e,t,i,n,s){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.fullscreenMaterial.setSize(e,t)}initialize(e,t,i){const n=e.getContext();if(!n.getExtension("EXT_color_buffer_float")&&!n.getExtension("EXT_color_buffer_half_float"))throw new Error("Rendering to float texture is not supported.")}}class lX extends $Y{constructor({depthPacking:e=Mi}={}){super("DepthCopyPass");const t=new UY;t.outputDepthPacking=e,this.fullscreenMaterial=t,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new q(1,1,{type:e===Mi?F:re,minFilter:Te,magFilter:Te,depthBuffer:!1}),this.renderTarget.texture.name="DepthCopyPass.Target"}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get depthPacking(){return this.fullscreenMaterial.outputDepthPacking}getDepthPacking(){return this.fullscreenMaterial.outputDepthPacking}setDepthTexture(e,t=Si){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.inputDepthPacking=t}render(e,t,i,n,s){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.renderTarget.setSize(e,t)}}const hX=new Float32Array([255/256/256**3,255/256/65536,255/256/256,255/256]);class cX extends lX{constructor({depthPacking:e=Mi,mode:t=1}={}){super({depthPacking:e}),this.name="DepthPickingPass",this.fullscreenMaterial.mode=t,this.pixelBuffer=e===Mi?new Uint8Array(4):new Float32Array(4),this.callback=null,this.isInit=!1}readDepth(e){return this.fullscreenMaterial.texelPosition.set(.5*e.x+.5,.5*e.y+.5),new Promise((e=>{this.callback=e}))}setCamera(e){this.fullscreenMaterial.defines.LOG_DEPTH="1",this.fullscreenMaterial.uniforms.cameraNearFar={value:new r(e.near,e.far)}}render(e,t,i,n,s){const r=this.fullscreenMaterial,o=r.mode;if(0===o&&super.render(e),null!==this.callback){const t=this.renderTarget,i=this.pixelBuffer,n=t.texture.type!==re;let s=0,l=0;if(1===o)super.render(e);else{const e=r.texelPosition;s=Math.round(e.x*t.width),l=Math.round(e.y*t.height)}e.readRenderTargetPixels(t,s,l,1,1,i),this.callback(n?((a=i)[0]*hX[0]+a[1]*hX[1]+a[2]*hX[2]+a[3]*hX[3])/255:i[0]),this.callback=null}var a}setSize(e,t){0===this.fullscreenMaterial.mode&&super.setSize(e,t)}}function dX(e,t,i){for(const n of t){const t="$1"+e+n.charAt(0).toUpperCase()+n.slice(1),s=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const e of i.entries())null!==e[1]&&i.set(e[0],e[1].replace(s,t))}}function uX(e,t,i){let n=t.getFragmentShader(),s=t.getVertexShader();const r=void 0!==n&&/mainImage/.test(n),o=void 0!==n&&/mainUv/.test(n);if(i.attributes|=t.getAttributes(),void 0===n)throw new Error(`Missing fragment shader (${t.name})`);if(o&&0!=(i.attributes&EY.CONVOLUTION))throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=i.shaderParts;let h=l.get(TY.FRAGMENT_HEAD)||"",c=l.get(TY.FRAGMENT_MAIN_UV)||"",d=l.get(TY.FRAGMENT_MAIN_IMAGE)||"",u=l.get(TY.VERTEX_HEAD)||"",p=l.get(TY.VERTEX_MAIN_SUPPORT)||"";const f=new Set,m=new Set;if(o&&(c+=`\t${e}MainUv(UV);\n`,i.uvTransformation=!0),null!==s&&/mainSupport/.test(s)){const t=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);p+=`\t${e}MainSupport(`,p+=t?"vUv);\n":");\n";for(const e of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const t of e[1].split(/\s*,\s*/))i.varyings.add(t),f.add(t),m.add(t);for(const e of s.matchAll(a))m.add(e[1])}for(const e of n.matchAll(a))m.add(e[1]);for(const e of t.defines.keys())m.add(e.replace(/\([\w\s,]*\)/g,""));for(const e of t.uniforms.keys())m.add(e);m.delete("while"),m.delete("for"),m.delete("if"),t.uniforms.forEach(((t,n)=>i.uniforms.set(e+n.charAt(0).toUpperCase()+n.slice(1),t))),t.defines.forEach(((t,n)=>i.defines.set(e+n.charAt(0).toUpperCase()+n.slice(1),t)));const g=new Map([["fragment",n],["vertex",s]]);dX(e,m,i.defines),dX(e,m,g),n=g.get("fragment"),s=g.get("vertex");const v=t.blendMode;if(i.blendModes.set(v.blendFunction,v),r){null!==t.inputColorSpace&&t.inputColorSpace!==i.colorSpace&&(d+=t.inputColorSpace===se?"color0 = LinearTosRGB(color0);\n\t":"color0 = sRGBToLinear(color0);\n\t"),t.outputColorSpace!==Ai?i.colorSpace=t.outputColorSpace:null!==t.inputColorSpace&&(i.colorSpace=t.inputColorSpace);const s=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${e}MainImage(color0, UV, `,0!=(i.attributes&EY.DEPTH)&&s.test(n)&&(d+="depth, ",i.readDepth=!0),d+="color1);\n\t";const r=e+"BlendOpacity";i.uniforms.set(r,v.opacity),d+=`color0 = blend${v.blendFunction}(color0, color1, ${r});\n\n\t`,h+=`uniform float ${r};\n\n`}if(h+=n+"\n",null!==s&&(u+=s+"\n"),l.set(TY.FRAGMENT_HEAD,h),l.set(TY.FRAGMENT_MAIN_UV,c),l.set(TY.FRAGMENT_MAIN_IMAGE,d),l.set(TY.VERTEX_HEAD,u),l.set(TY.VERTEX_MAIN_SUPPORT,p),null!==t.extensions)for(const e of t.extensions)i.extensions.add(e)}}class pX extends $Y{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new HY(null,null,null,e),this.listener=e=>this.handleEvent(e),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=e.sort(((e,t)=>t.attributes-e.attributes));for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const e=new MX;let t=0;for(const i of this.effects)if(i.blendMode.blendFunction===CY.DST)e.attributes|=i.getAttributes()&EY.DEPTH;else{if(0!=(e.attributes&i.getAttributes()&EY.CONVOLUTION))throw new Error(`Convolution effects cannot be merged (${i.name})`);uX("e"+t++,i,e)}let i=e.shaderParts.get(TY.FRAGMENT_HEAD),n=e.shaderParts.get(TY.FRAGMENT_MAIN_IMAGE),s=e.shaderParts.get(TY.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const t of e.blendModes.values())i+=t.getShaderCode().replace(r,`blend${t.blendFunction}`)+"\n";0!=(e.attributes&EY.DEPTH)?(e.readDepth&&(n="float depth = readDepth(UV);\n\n\t"+n),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,e.colorSpace===se&&(n+="color0 = sRGBToLinear(color0);\n\t"),e.uvTransformation?(s="vec2 transformedUv = vUv;\n"+s,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(TY.FRAGMENT_HEAD,i),e.shaderParts.set(TY.FRAGMENT_MAIN_IMAGE,n),e.shaderParts.set(TY.FRAGMENT_MAIN_UV,s);for(const[t,i]of e.shaderParts)null!==i&&e.shaderParts.set(t,i.trim().replace(/^#/,"\n#"));this.skipRendering=0===t,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Si){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,n,s){for(const i of this.effects)i.update(e,t,n);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=n*this.timeScale,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(const n of this.effects)n.initialize(e,t,i);this.updateMaterial(),void 0!==i&&i!==F&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){"change"===e.type&&this.recompile()}}class fX extends $Y{constructor({kernelSize:e=OY.MEDIUM,resolutionScale:t=.5,width:i=TX.AUTO_SIZE,height:n=TX.AUTO_SIZE,resolutionX:s=i,resolutionY:r=n}={}){super("KawaseBlurPass"),this.renderTargetA=new q(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new TX(this,s,r,t);o.addEventListener("change",(e=>this.setSize(o.baseWidth,o.baseHeight))),this._blurMaterial=new kY,this._blurMaterial.kernelSize=e,this.copyMaterial=new LY}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,s){const r=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,h=this.blurMaterial,c=h.kernelSequence;let d=t;this.fullscreenMaterial=h;for(let t=0,i=c.length;t<i;++t){const i=0==(1&t)?a:l;h.kernel=c[t],h.inputBuffer=d.texture,e.setRenderTarget(i),e.render(r,o),d=i}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(r,o)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t);const n=i.width,s=i.height;this.renderTargetA.setSize(n,s),this.renderTargetB.setSize(n,s),this.blurMaterial.setSize(e,t)}initialize(e,t,i){void 0!==i&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==F?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputColorSpace===se&&(this.renderTargetA.texture.colorSpace=se,this.renderTargetB.texture.colorSpace=se))}static get AUTO_SIZE(){return TX.AUTO_SIZE}}class mX extends $Y{constructor(e){super("LambdaPass",null,null),this.needsSwap=!1,this.f=e}render(e,t,i,n,s){this.f()}}class gX extends $Y{constructor({renderTarget:e,luminanceRange:t,colorOutput:i,resolutionScale:n=1,width:s=TX.AUTO_SIZE,height:r=TX.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new GY(i,t),this.needsSwap=!1,this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new q(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new TX(this,o,a,n);l.addEventListener("change",(e=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,n,s){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){void 0!==i&&i!==F&&(this.renderTarget.texture.type=i,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}}class vX extends $Y{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new sX(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,n,s){const r=e.getContext(),o=e.state.buffers,a=this.scene,l=this.camera,h=this.clearPass,c=this.inverted?0:1,d=1-c;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,c,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(e,null):(h.render(e,t),h.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(a,l)):(e.setRenderTarget(t),e.render(a,l),e.setRenderTarget(i),e.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}}class yX extends $Y{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new q(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new jY,this.upsamplingMaterial=new ZY,this.resolution=new r}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(e){if(this.levels!==e){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let i=0;i<e;++i){const e=t.clone();e.texture.name="Downsampling.Mipmap"+i,this.downsamplingMipmaps.push(e)}this.upsamplingMipmaps.push(t);for(let i=1,n=e-1;i<n;++i){const e=t.clone();e.texture.name="Upsampling.Mipmap"+i,this.upsamplingMipmaps.push(e)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(e){this.upsamplingMaterial.radius=e}render(e,t,i,n,s){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:l}=this,{downsamplingMipmaps:h,upsamplingMipmaps:c}=this;let d=t;this.fullscreenMaterial=a;for(let t=0,i=h.length;t<i;++t){const i=h[t];a.setSize(d.width,d.height),a.inputBuffer=d.texture,e.setRenderTarget(i),e.render(r,o),d=i}this.fullscreenMaterial=l;for(let t=c.length-1;t>=0;--t){const i=c[t];l.setSize(d.width,d.height),l.inputBuffer=d.texture,l.supportBuffer=h[t].texture,e.setRenderTarget(i),e.render(r,o),d=i}}setSize(e,t){const i=this.resolution;i.set(e,t);let n=i.width,s=i.height;for(let e=0,t=this.downsamplingMipmaps.length;e<t;++e)n=Math.round(.5*n),s=Math.round(.5*s),this.downsamplingMipmaps[e].setSize(n,s),e<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[e].setSize(n,s)}initialize(e,t,i){if(void 0!==i){const t=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const e of t)e.texture.type=i;if(i!==F)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(e.outputColorSpace===se)for(const e of t)e.texture.colorSpace=se}}dispose(){super.dispose();for(const e of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))e.dispose()}}class xX extends $Y{constructor(e,t,{renderTarget:i,resolutionScale:n=1,width:r=TX.AUTO_SIZE,height:o=TX.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new rX(e,t,new Ei);const h=this.renderPass;h.ignoreBackground=!0,h.skipShadowMapUpdate=!0;const c=h.getClearPass();c.overrideClearColor=new s(7829503),c.overrideClearAlpha=1,this.renderTarget=i,void 0===this.renderTarget&&(this.renderTarget=new q(1,1,{minFilter:Te,magFilter:Te}),this.renderTarget.texture.name="NormalPass.Target");const d=this.resolution=new TX(this,a,l,n);d.addEventListener("change",(e=>this.setSize(d.baseWidth,d.baseHeight)))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,r,r)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}}class wX extends $Y{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.input=t}setInput(e){this.input=e}render(e,t,i,n,s){const r=this.fullscreenMaterial.uniforms;null!==t&&void 0!==r&&void 0!==r[this.input]&&(r[this.input].value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){void 0!==i&&i!==F&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}}function bX(){!1===document.hidden&&this.reset()}class _X{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=jy(),this._delta=0,this._elapsed=0,this._timescale=1,this._usePageVisibilityAPI="undefined"!=typeof document&&void 0!==document.hidden,!0===this._usePageVisibilityAPI&&(this._pageVisibilityHandler=bX.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=jy()-this._startTime,this}dispose(){return!0===this._usePageVisibilityAPI&&document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this}update(e){return!0===this._usePageVisibilityAPI&&!0===document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==e?e:jy())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}class SX{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,i,s,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new eX,this.depthTexture=null,this.passes=[],this.timer=new _X,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){const t=e.getSize(new r),i=e.getContext().getContextAttributes().alpha,n=this.inputBuffer.texture.type;n===F&&e.outputColorSpace===se&&(this.inputBuffer.texture.colorSpace=se,this.outputBuffer.texture.colorSpace=se,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const t of this.passes)t.initialize(e,i,n)}}replaceRenderer(e,t=!0){const i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(e),t&&null!==n&&(n.removeChild(i.domElement),n.appendChild(e.domElement)),i}createDepthTexture(){const e=this.depthTexture=new te;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=Ti,e.type=Pi):e.type=Oi,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,n){const s=this.renderer,o=null===s?new r:s.getDrawingBufferSize(new r),a={minFilter:N,magFilter:N,stencilBuffer:t,depthBuffer:e,type:i},l=new q(o.width,o.height,a);return n>0&&(l.ignoreDepthForMultisampleCopy=!1,l.samples=n),i===F&&s.outputColorSpace===se&&(l.texture.colorSpace=se),l.texture.name="EffectComposer.Buffer",l.texture.generateMipmaps=!1,l}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const i=this.passes,n=this.renderer,s=n.getDrawingBufferSize(new r),o=n.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(n),e.setSize(s.width,s.height),e.initialize(n,o,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){const t=this.createDepthTexture();for(e of i)e.setDepthTexture(t)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,i=t.indexOf(e);if(-1!==i&&t.splice(i,1).length>0){if(null!==this.depthTexture){const i=(e,t)=>e||t.needsDepthTexture;t.reduce(i,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,i=this.copyPass;let n,s,r,o=this.inputBuffer,a=this.outputBuffer,l=!1;void 0===e&&(this.timer.update(),e=this.timer.getDelta());for(const h of this.passes)h.enabled&&(h.render(t,o,a,e,l),h.needsSwap&&(l&&(i.renderToScreen=h.renderToScreen,n=t.getContext(),s=t.state.buffers.stencil,s.setFunc(n.NOTEQUAL,1,4294967295),i.render(t,o,a,e,l),s.setFunc(n.EQUAL,1,4294967295)),r=o,o=a,a=r),h instanceof vX?l=!0:h instanceof iX&&(l=!1))}setSize(e,t,i){const n=this.renderer,s=n.getSize(new r);void 0!==e&&void 0!==t||(e=s.width,t=s.height),s.width===e&&s.height===t||n.setSize(e,t,i);const o=n.getDrawingBufferSize(new r);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const e of this.passes)e.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}}class MX{constructor(){this.shaderParts=new Map([[TY.FRAGMENT_HEAD,null],[TY.FRAGMENT_MAIN_UV,null],[TY.FRAGMENT_MAIN_IMAGE,null],[TY.VERTEX_HEAD,null],[TY.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=EY.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=ae}}let CX=!1;class AX{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case I:t=this.materialsFlatShadedDoubleSide;break;case d:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded}else switch(e.material.side){case I:t=this.materialsDoubleSide;break;case d:t=this.materialsBackSide;break;default:t=this.materials}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof a))return e.clone();const t=e.uniforms,i=new Map;for(const e in t){const n=t[e].value;n.isRenderTargetTexture&&(t[e].value=null,i.set(e,n))}const n=e.clone();for(const e of i)t[e[0]].value=e[1],n.uniforms[e[0]].value=e[1];return n}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const i of t)i.uniforms=Object.assign({},e.uniforms),i.side=D;t[2].skinning=!0,this.materialsBackSide=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.side=d,i})),this.materialsDoubleSide=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.side=I,i})),this.materialsFlatShaded=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i})),this.materialsFlatShadedBackSide=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=d,i})),this.materialsFlatShadedDoubleSide=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=I,i}))}}render(e,t,i){const n=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,CX){const n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(const e of n)e[0].material=e[1];this.meshCount!==n.size&&n.clear()}else{const n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=n}disposeMaterials(){if(null!==this.material){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return CX}static set workaroundEnabled(e){CX=e}}const EX=-1;class TX extends ge{constructor(e,t=-1,i=-1,n=1){super(),this.resizable=e,this.baseSize=new r(1,1),this.preferredSize=new r(t,i),this.target=this.preferredSize,this.s=n,this.effectiveSize=new r,this.addEventListener("change",(()=>this.updateEffectiveSize())),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,i=this.effectiveSize,n=this.scale;t.width!==EX?i.width=t.width:t.height!==EX?i.width=Math.round(t.height*(e.width/Math.max(e.height,1))):i.width=Math.round(e.width*n),t.height!==EX?i.height=t.height:t.width!==EX?i.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):i.height=Math.round(e.height*n)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(EX),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){this.baseSize.width===e&&this.baseSize.height===t||(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){this.preferredSize.width===e&&this.preferredSize.height===t||(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return EX}}class PX extends Set{constructor(e,t=10){super(),this.l=t,this.exclusive=!1,void 0!==e&&this.set(e)}get layer(){return this.l}set layer(e){const t=this.l;for(const i of this)i.layers.disable(t),i.layers.enable(e);this.l=e}getLayer(){return this.layer}setLayer(e){this.layer=e}isExclusive(){return this.exclusive}setExclusive(e){this.exclusive=e}clear(){const e=this.layer;for(const t of this)t.layers.disable(e);return super.clear()}set(e){this.clear();for(const t of e)this.add(t);return this}indexOf(e){return this.has(e)?0:-1}add(e){return this.exclusive?e.layers.set(this.layer):e.layers.enable(this.layer),super.add(e)}delete(e){return this.has(e)&&e.layers.disable(this.layer),super.delete(e)}toggle(e){let t;return this.has(e)?(this.delete(e),t=!1):(this.add(e),t=!0),t}setVisible(e){for(const t of this)e?t.layers.enable(0):t.layers.disable(0);return this}}const OX=new Map([[CY.ADD,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}"],[CY.ALPHA,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}"],[CY.AVERAGE,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}"],[CY.COLOR,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[CY.COLOR_BURN,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}"],[CY.COLOR_DODGE,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}"],[CY.DARKEN,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}"],[CY.DIFFERENCE,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}"],[CY.DIVIDE,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}"],[CY.DST,null],[CY.EXCLUSION,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}"],[CY.HARD_LIGHT,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}"],[CY.HARD_MIX,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}"],[CY.HUE,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}"],[CY.INVERT,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}"],[CY.INVERT_RGB,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}"],[CY.LIGHTEN,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}"],[CY.LINEAR_BURN,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}"],[CY.LINEAR_DODGE,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}"],[CY.LINEAR_LIGHT,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}"],[CY.LUMINOSITY,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[CY.MULTIPLY,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}"],[CY.NEGATION,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}"],[CY.NORMAL,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}"],[CY.OVERLAY,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}"],[CY.PIN_LIGHT,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}"],[CY.REFLECT,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}"],[CY.SATURATION,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[CY.SCREEN,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}"],[CY.SOFT_LIGHT,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}"],[CY.SRC,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}"],[CY.SUBTRACT,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}"],[CY.VIVID_LIGHT,"#define GLSLIFY 1\nvec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}"]]);class DX extends ge{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new X(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return OX.get(this.blendFunction)}}class BX extends ge{constructor(e,t,{attributes:i=EY.NONE,blendFunction:n=CY.NORMAL,defines:s=new Map,uniforms:r=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=a,this.defines=s,this.uniforms=r,this.extensions=o,this.blendMode=new DX(n),this.blendMode.addEventListener("change",(e=>this.setChanged())),this._inputColorSpace=ae,this._outputColorSpace=Ai}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Si){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof q||t instanceof he||t instanceof W||t instanceof $Y)&&this[e].dispose()}}}class IX extends BX{constructor({blendFunction:e=CY.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,mipmapBlur:n=!1,intensity:s=1,radius:r=.85,levels:o=8,kernelSize:a=OY.LARGE,resolutionScale:l=.5,width:h=TX.AUTO_SIZE,height:c=TX.AUTO_SIZE,resolutionX:d=h,resolutionY:u=c}={}){super("BloomEffect","#define GLSLIFY 1\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}",{blendFunction:e,uniforms:new Map([["map",new X(null)],["intensity",new X(s)]])}),this.renderTarget=new q(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new fX({kernelSize:a}),this.luminancePass=new gX({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=i,this.mipmapBlurPass=new yX,this.mipmapBlurPass.enabled=n,this.mipmapBlurPass.radius=r,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=n?this.mipmapBlurPass.texture:this.renderTarget.texture;const p=this.resolution=new TX(this,d,u,l);p.addEventListener("change",(e=>this.setSize(p.baseWidth,p.baseHeight)))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){const n=this.renderTarget,s=this.luminancePass;s.enabled?(s.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,s.renderTarget):this.blurPass.render(e,s.renderTarget,n)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,n)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,i){this.blurPass.initialize(e,t,i),this.luminancePass.initialize(e,t,i),this.mipmapBlurPass.initialize(e,t,i),void 0!==i&&(this.renderTarget.texture.type=i,e.outputColorSpace===se&&(this.renderTarget.texture.colorSpace=se))}}class RX extends BX{constructor({blendFunction:e,bits:t=16}={}){super("ColorDepthEffect","#define GLSLIFY 1\nuniform float factor;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(floor(inputColor.rgb*factor+0.5)/factor,inputColor.a);}",{blendFunction:e,uniforms:new Map([["factor",new X(1)]])}),this.bits=0,this.bitDepth=t}get bitDepth(){return this.bits}set bitDepth(e){this.bits=e,this.uniforms.get("factor").value=Math.pow(2,e/3)}getBitDepth(){return this.bitDepth}setBitDepth(e){this.bitDepth=e}}class kX extends BX{constructor({offset:e=new r(.001,5e-4),radialModulation:t=!1,modulationOffset:i=.15}={}){super("ChromaticAberrationEffect","#define GLSLIFY 1\n#ifdef RADIAL_MODULATION\nuniform float modulationOffset;\n#endif\nvarying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;\n#ifdef RADIAL_MODULATION\nconst vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}\n#else\nif(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}\n#endif\noutputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",{vertexShader:"#define GLSLIFY 1\nuniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)? 1.0 : 0.0;vUvR=uv+shift;vUvB=uv-shift;}",attributes:EY.CONVOLUTION,uniforms:new Map([["offset",new X(e)],["modulationOffset",new X(i)]])}),this.radialModulation=t}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(e){e?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(e){this.uniforms.get("modulationOffset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}}class LX extends BX{constructor(e,{blendFunction:t,worldFocusDistance:i,worldFocusRange:n,focusDistance:s=0,focalLength:r=.1,focusRange:o=r,bokehScale:a=1,resolutionScale:l=1,width:h=TX.AUTO_SIZE,height:c=TX.AUTO_SIZE,resolutionX:d=h,resolutionY:u=c}={}){super("DepthOfFieldEffect","#define GLSLIFY 1\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);\n#if MASK_FUNCTION == 1\nvec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);\n#else\nvec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);\n#endif\nvec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}",{blendFunction:t,attributes:EY.DEPTH,uniforms:new Map([["nearColorBuffer",new X(null)],["farColorBuffer",new X(null)],["nearCoCBuffer",new X(null)],["farCoCBuffer",new X(null)],["scale",new X(1)]])}),this.camera=e,this.renderTarget=new q(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new wX(new MY(e));const p=this.cocMaterial;p.focusDistance=s,p.focusRange=o,void 0!==i&&(p.worldFocusDistance=i),void 0!==n&&(p.worldFocusRange=n),this.blurPass=new fX({resolutionScale:l,resolutionX:d,resolutionY:u,kernelSize:OY.MEDIUM}),this.maskPass=new wX(new YY(this.renderTargetCoC.texture)),this.maskPass.fullscreenMaterial.colorChannel=1,this.maskFunction=3,this.bokehNearBasePass=new wX(new bY(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new wX(new bY(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new wX(new bY(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new wX(new bY(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const f=this.resolution=new TX(this,d,u,l);f.addEventListener("change",(e=>this.setSize(f.baseWidth,f.baseHeight))),this.bokehScale=a}set mainCamera(e){this.camera=e,this.cocMaterial.copyCameraSettings(e)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(e){this.maskFunction!==e&&(this.defines.set("MASK_FUNCTION",e.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=e,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){this.bokehNearBasePass.fullscreenMaterial.scale=e,this.bokehNearFillPass.fullscreenMaterial.scale=e,this.bokehFarBasePass.fullscreenMaterial.scale=e,this.bokehFarFillPass.fullscreenMaterial.scale=e,this.maskPass.fullscreenMaterial.strength=e,this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){const t=this.camera;return SY(-t.position.distanceTo(e),t.near,t.far)}setDepthTexture(e,t=Si){this.cocMaterial.depthBuffer=e,this.cocMaterial.depthPacking=t}update(e,t,i){const n=this.renderTarget,s=this.renderTargetCoC,r=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(null!==this.target){const e=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=e}this.cocPass.render(e,null,s),this.blurPass.render(e,s,r),this.maskPass.render(e,t,o),this.bokehFarBasePass.render(e,o,n),this.bokehFarFillPass.render(e,n,this.renderTargetFar),this.bokehNearBasePass.render(e,t,n),this.bokehNearFillPass.render(e,n,this.renderTargetNear)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t);const n=i.width,s=i.height;this.cocPass.setSize(e,t),this.blurPass.setSize(e,t),this.maskPass.setSize(e,t),this.renderTargetFar.setSize(e,t),this.renderTargetCoC.setSize(e,t),this.renderTargetMasked.setSize(e,t),this.renderTarget.setSize(n,s),this.renderTargetNear.setSize(n,s),this.renderTargetCoCBlurred.setSize(n,s),this.bokehNearBasePass.fullscreenMaterial.setSize(e,t),this.bokehNearFillPass.fullscreenMaterial.setSize(e,t),this.bokehFarBasePass.fullscreenMaterial.setSize(e,t),this.bokehFarFillPass.fullscreenMaterial.setSize(e,t)}initialize(e,t,i){this.cocPass.initialize(e,t,i),this.maskPass.initialize(e,t,i),this.bokehNearBasePass.initialize(e,t,i),this.bokehNearFillPass.initialize(e,t,i),this.bokehFarBasePass.initialize(e,t,i),this.bokehFarFillPass.initialize(e,t,i),this.blurPass.initialize(e,t,F),e.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),void 0!==i&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputColorSpace===se&&(this.renderTarget.texture.colorSpace=se,this.renderTargetNear.texture.colorSpace=se,this.renderTargetFar.texture.colorSpace=se,this.renderTargetMasked.texture.colorSpace=se))}}class zX extends BX{constructor({blendFunction:e,angle:t=.5*Math.PI,scale:i=1}={}){super("DotScreenEffect","#define GLSLIFY 1\nuniform vec2 angle;uniform float scale;float pattern(const in vec2 uv){vec2 point=scale*vec2(dot(angle.yx,vec2(uv.x,-uv.y)),dot(angle,uv));return(sin(point.x)*sin(point.y))*4.0;}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(inputColor.rgb*10.0-5.0+pattern(uv*resolution));outputColor=vec4(color,inputColor.a);}",{blendFunction:e,uniforms:new Map([["angle",new X(new r)],["scale",new X(i)]])}),this.angle=t}get angle(){return Math.acos(this.uniforms.get("angle").value.y)}set angle(e){this.uniforms.get("angle").value.set(Math.sin(e),Math.cos(e))}getAngle(){return this.angle}setAngle(e){this.angle=e}get scale(){return this.uniforms.get("scale").value}set scale(e){this.uniforms.get("scale").value=e}}class UX extends BX{constructor({blendFunction:e=CY.SRC}={}){super("FXAAEffect","#define GLSLIFY 1\n#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\n#define ONE_OVER_TWELVE 0.08333333333333333\nvarying vec2 vUvDown;varying vec2 vUvUp;varying vec2 vUvLeft;varying vec2 vUvRight;varying vec2 vUvDownLeft;varying vec2 vUvUpRight;varying vec2 vUvUpLeft;varying vec2 vUvDownRight;vec4 fxaa(const in vec4 inputColor,const in vec2 uv){float lumaCenter=luminance(inputColor.rgb);float lumaDown=luminance(texture2D(inputBuffer,vUvDown).rgb);float lumaUp=luminance(texture2D(inputBuffer,vUvUp).rgb);float lumaLeft=luminance(texture2D(inputBuffer,vUvLeft).rgb);float lumaRight=luminance(texture2D(inputBuffer,vUvRight).rgb);float lumaMin=min(lumaCenter,min(min(lumaDown,lumaUp),min(lumaLeft,lumaRight)));float lumaMax=max(lumaCenter,max(max(lumaDown,lumaUp),max(lumaLeft,lumaRight)));float lumaRange=lumaMax-lumaMin;if(lumaRange<max(EDGE_THRESHOLD_MIN,lumaMax*EDGE_THRESHOLD_MAX)){return inputColor;}float lumaDownLeft=luminance(texture2D(inputBuffer,vUvDownLeft).rgb);float lumaUpRight=luminance(texture2D(inputBuffer,vUvUpRight).rgb);float lumaUpLeft=luminance(texture2D(inputBuffer,vUvUpLeft).rgb);float lumaDownRight=luminance(texture2D(inputBuffer,vUvDownRight).rgb);float lumaDownUp=lumaDown+lumaUp;float lumaLeftRight=lumaLeft+lumaRight;float lumaLeftCorners=lumaDownLeft+lumaUpLeft;float lumaDownCorners=lumaDownLeft+lumaDownRight;float lumaRightCorners=lumaDownRight+lumaUpRight;float lumaUpCorners=lumaUpRight+lumaUpLeft;float edgeHorizontal=(abs(-2.0*lumaLeft+lumaLeftCorners)+abs(-2.0*lumaCenter+lumaDownUp)*2.0+abs(-2.0*lumaRight+lumaRightCorners));float edgeVertical=(abs(-2.0*lumaUp+lumaUpCorners)+abs(-2.0*lumaCenter+lumaLeftRight)*2.0+abs(-2.0*lumaDown+lumaDownCorners));bool isHorizontal=(edgeHorizontal>=edgeVertical);float stepLength=isHorizontal ? texelSize.y : texelSize.x;float luma1=isHorizontal ? lumaDown : lumaLeft;float luma2=isHorizontal ? lumaUp : lumaRight;float gradient1=abs(luma1-lumaCenter);float gradient2=abs(luma2-lumaCenter);bool is1Steepest=gradient1>=gradient2;float gradientScaled=0.25*max(gradient1,gradient2);float lumaLocalAverage=0.0;if(is1Steepest){stepLength=-stepLength;lumaLocalAverage=0.5*(luma1+lumaCenter);}else{lumaLocalAverage=0.5*(luma2+lumaCenter);}vec2 currentUv=uv;if(isHorizontal){currentUv.y+=stepLength*0.5;}else{currentUv.x+=stepLength*0.5;}vec2 offset=isHorizontal ? vec2(texelSize.x,0.0): vec2(0.0,texelSize.y);vec2 uv1=currentUv-offset*QUALITY(0);vec2 uv2=currentUv+offset*QUALITY(0);float lumaEnd1=luminance(texture2D(inputBuffer,uv1).rgb);float lumaEnd2=luminance(texture2D(inputBuffer,uv2).rgb);lumaEnd1-=lumaLocalAverage;lumaEnd2-=lumaLocalAverage;bool reached1=abs(lumaEnd1)>=gradientScaled;bool reached2=abs(lumaEnd2)>=gradientScaled;bool reachedBoth=reached1&&reached2;if(!reached1){uv1-=offset*QUALITY(1);}if(!reached2){uv2+=offset*QUALITY(1);}if(!reachedBoth){for(int i=2;i<SAMPLES;++i){if(!reached1){lumaEnd1=luminance(texture2D(inputBuffer,uv1).rgb);lumaEnd1=lumaEnd1-lumaLocalAverage;}if(!reached2){lumaEnd2=luminance(texture2D(inputBuffer,uv2).rgb);lumaEnd2=lumaEnd2-lumaLocalAverage;}reached1=abs(lumaEnd1)>=gradientScaled;reached2=abs(lumaEnd2)>=gradientScaled;reachedBoth=reached1&&reached2;if(!reached1){uv1-=offset*QUALITY(i);}if(!reached2){uv2+=offset*QUALITY(i);}if(reachedBoth){break;}}}float distance1=isHorizontal ?(uv.x-uv1.x):(uv.y-uv1.y);float distance2=isHorizontal ?(uv2.x-uv.x):(uv2.y-uv.y);bool isDirection1=distance1<distance2;float distanceFinal=min(distance1,distance2);float edgeThickness=(distance1+distance2);bool isLumaCenterSmaller=lumaCenter<lumaLocalAverage;bool correctVariation1=(lumaEnd1<0.0)!=isLumaCenterSmaller;bool correctVariation2=(lumaEnd2<0.0)!=isLumaCenterSmaller;bool correctVariation=isDirection1 ? correctVariation1 : correctVariation2;float pixelOffset=-distanceFinal/edgeThickness+0.5;float finalOffset=correctVariation ? pixelOffset : 0.0;float lumaAverage=ONE_OVER_TWELVE*(2.0*(lumaDownUp+lumaLeftRight)+lumaLeftCorners+lumaRightCorners);float subPixelOffset1=clamp(abs(lumaAverage-lumaCenter)/lumaRange,0.0,1.0);float subPixelOffset2=(-2.0*subPixelOffset1+3.0)*subPixelOffset1*subPixelOffset1;float subPixelOffsetFinal=subPixelOffset2*subPixelOffset2*SUBPIXEL_QUALITY;finalOffset=max(finalOffset,subPixelOffsetFinal);vec2 finalUv=uv;if(isHorizontal){finalUv.y+=finalOffset*stepLength;}else{finalUv.x+=finalOffset*stepLength;}return texture2D(inputBuffer,finalUv);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=fxaa(inputColor,uv);}",{vertexShader:"#define GLSLIFY 1\nvarying vec2 vUvDown;varying vec2 vUvUp;varying vec2 vUvLeft;varying vec2 vUvRight;varying vec2 vUvDownLeft;varying vec2 vUvUpRight;varying vec2 vUvUpLeft;varying vec2 vUvDownRight;void mainSupport(const in vec2 uv){vUvDown=uv+vec2(0.0,-1.0)*texelSize;vUvUp=uv+vec2(0.0,1.0)*texelSize;vUvRight=uv+vec2(1.0,0.0)*texelSize;vUvLeft=uv+vec2(-1.0,0.0)*texelSize;vUvDownLeft=uv+vec2(-1.0,-1.0)*texelSize;vUvUpRight=uv+vec2(1.0,1.0)*texelSize;vUvUpLeft=uv+vec2(-1.0,1.0)*texelSize;vUvDownRight=uv+vec2(1.0,-1.0)*texelSize;}",blendFunction:e,defines:new Map([["EDGE_THRESHOLD_MIN","0.0312"],["EDGE_THRESHOLD_MAX","0.125"],["SUBPIXEL_QUALITY","0.75"],["SAMPLES","12"]])})}get minEdgeThreshold(){return Number(this.defines.get("EDGE_THRESHOLD_MIN"))}set minEdgeThreshold(e){this.defines.set("EDGE_THRESHOLD_MIN",e.toFixed(12)),this.setChanged()}get maxEdgeThreshold(){return Number(this.defines.get("EDGE_THRESHOLD_MAX"))}set maxEdgeThreshold(e){this.defines.set("EDGE_THRESHOLD_MAX",e.toFixed(12)),this.setChanged()}get subpixelQuality(){return Number(this.defines.get("SUBPIXEL_QUALITY"))}set subpixelQuality(e){this.defines.set("SUBPIXEL_QUALITY",e.toFixed(12)),this.setChanged()}get samples(){return Number(this.defines.get("SAMPLES"))}set samples(e){this.defines.set("SAMPLES",e.toFixed(0)),this.setChanged()}}class FX extends we{constructor(e,t,i=Di,n=F){super(function(e,t,i){const n=new Map([[Di,1],[Bi,1],[Ii,2],[U,4]]);let s;if(n.has(t)||console.error("Invalid noise texture format"),i===F){s=new Uint8Array(e*n.get(t));for(let e=0,t=s.length;e<t;++e)s[e]=255*Math.random()+.5}else{s=new Float32Array(e*n.get(t));for(let e=0,t=s.length;e<t;++e)s[e]=Math.random()}return s}(e*t,i,n),e,t,i,n),this.needsUpdate=!0}}const NX="Glitch.Generated";function jX(e,t){return e+Math.random()*(t-e)}class VX extends BX{constructor({chromaticAberrationOffset:e=null,delay:t=new r(1.5,3.5),duration:i=new r(.6,1),strength:n=new r(.3,1),columns:s=.05,ratio:o=.85,perturbationMap:a=null,dtSize:l=64}={}){if(super("GlitchEffect","#define GLSLIFY 1\nuniform lowp sampler2D perturbationMap;uniform bool active;uniform float columns;uniform float random;uniform vec2 seeds;uniform vec2 distortion;void mainUv(inout vec2 uv){if(active){if(uv.y<distortion.x+columns&&uv.y>distortion.x-columns*random){float sx=clamp(ceil(seeds.x),0.0,1.0);uv.y=sx*(1.0-(uv.y+distortion.y))+(1.0-sx)*distortion.y;}if(uv.x<distortion.y+columns&&uv.x>distortion.y-columns*random){float sy=clamp(ceil(seeds.y),0.0,1.0);uv.x=sy*distortion.x+(1.0-sy)*(1.0-(uv.x+distortion.x));}vec2 normal=texture2D(perturbationMap,uv*random*random).rg;uv+=normal*seeds*(random*0.2);}}",{uniforms:new Map([["perturbationMap",new X(null)],["columns",new X(s)],["active",new X(!1)],["random",new X(1)],["seeds",new X(new r)],["distortion",new X(new r)]])}),null===a){const e=new FX(l,l,U);e.name=NX,this.perturbationMap=e}else this.perturbationMap=a;this.time=0,this.distortion=this.uniforms.get("distortion").value,this.delay=t,this.duration=i,this.breakPoint=new r(jX(this.delay.x,this.delay.y),jX(this.duration.x,this.duration.y)),this.strength=n,this.mode=PY.SPORADIC,this.ratio=o,this.chromaticAberrationOffset=e}get seeds(){return this.uniforms.get("seeds").value}get active(){return this.uniforms.get("active").value}isActive(){return this.active}get minDelay(){return this.delay.x}set minDelay(e){this.delay.x=e}getMinDelay(){return this.delay.x}setMinDelay(e){this.delay.x=e}get maxDelay(){return this.delay.y}set maxDelay(e){this.delay.y=e}getMaxDelay(){return this.delay.y}setMaxDelay(e){this.delay.y=e}get minDuration(){return this.duration.x}set minDuration(e){this.duration.x=e}getMinDuration(){return this.duration.x}setMinDuration(e){this.duration.x=e}get maxDuration(){return this.duration.y}set maxDuration(e){this.duration.y=e}getMaxDuration(){return this.duration.y}setMaxDuration(e){this.duration.y=e}get minStrength(){return this.strength.x}set minStrength(e){this.strength.x=e}getMinStrength(){return this.strength.x}setMinStrength(e){this.strength.x=e}get maxStrength(){return this.strength.y}set maxStrength(e){this.strength.y=e}getMaxStrength(){return this.strength.y}setMaxStrength(e){this.strength.y=e}getMode(){return this.mode}setMode(e){this.mode=e}getGlitchRatio(){return 1-this.ratio}setGlitchRatio(e){this.ratio=Math.min(Math.max(1-e,0),1)}get columns(){return this.uniforms.get("columns").value}set columns(e){this.uniforms.get("columns").value=e}getGlitchColumns(){return this.columns}setGlitchColumns(e){this.columns=e}getChromaticAberrationOffset(){return this.chromaticAberrationOffset}setChromaticAberrationOffset(e){this.chromaticAberrationOffset=e}get perturbationMap(){return this.uniforms.get("perturbationMap").value}set perturbationMap(e){const t=this.perturbationMap;null!==t&&t.name===NX&&t.dispose(),e.minFilter=e.magFilter=Te,e.wrapS=e.wrapT=G,e.generateMipmaps=!1,this.uniforms.get("perturbationMap").value=e}getPerturbationMap(){return this.perturbationMap}setPerturbationMap(e){this.perturbationMap=e}generatePerturbationMap(e=64){const t=new FX(e,e,U);return t.name=NX,t}update(e,t,i){const n=this.mode,s=this.breakPoint,r=this.chromaticAberrationOffset,o=this.strength;let a,l=this.time,h=!1,c=0,d=0;n!==PY.DISABLED&&(n===PY.SPORADIC&&(l+=i,a=l>s.x,l>=s.x+s.y&&(s.set(jX(this.delay.x,this.delay.y),jX(this.duration.x,this.duration.y)),l=0)),c=Math.random(),this.uniforms.get("random").value=c,a&&c>this.ratio||n===PY.CONSTANT_WILD?(h=!0,c*=.03*o.y,d=jX(-Math.PI,Math.PI),this.seeds.set(jX(-o.y,o.y),jX(-o.y,o.y)),this.distortion.set(jX(0,1),jX(0,1))):(a||n===PY.CONSTANT_MILD)&&(h=!0,c*=.03*o.x,d=jX(-Math.PI,Math.PI),this.seeds.set(jX(-o.x,o.x),jX(-o.x,o.x)),this.distortion.set(jX(0,1),jX(0,1))),this.time=l),null!==r&&(h?r.set(Math.cos(d),Math.sin(d)).multiplyScalar(c):r.set(0,0)),this.uniforms.get("active").value=h}dispose(){const e=this.perturbationMap;null!==e&&e.name===NX&&e.dispose()}}const HX=new i,WX=new n;class GX extends BX{constructor(e,t,{blendFunction:i=CY.SCREEN,samples:n=60,density:o=.96,decay:a=.9,weight:l=.4,exposure:h=.6,clampMax:c=1,blur:d=!0,kernelSize:u=OY.SMALL,resolutionScale:p=.5,width:f=TX.AUTO_SIZE,height:m=TX.AUTO_SIZE,resolutionX:g=f,resolutionY:v=m}={}){super("GodRaysEffect","#define GLSLIFY 1\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nvoid mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=texture2D(map,uv);}",{blendFunction:i,attributes:EY.DEPTH,uniforms:new Map([["map",new X(null)]])}),this.camera=e,this._lightSource=t,this.lightSource=t,this.lightScene=new K,this.screenPosition=new r,this.renderTargetA=new q(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="GodRays.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="GodRays.Target.B",this.uniforms.get("map").value=this.renderTargetB.texture,this.renderTargetLight=new q(1,1),this.renderTargetLight.texture.name="GodRays.Light",this.renderTargetLight.depthTexture=new te,this.renderPassLight=new rX(this.lightScene,e),this.renderPassLight.clearPass.overrideClearColor=new s(0),this.clearPass=new sX(!0,!1,!1),this.clearPass.overrideClearColor=new s(0),this.blurPass=new fX({kernelSize:u}),this.blurPass.enabled=d,this.depthMaskPass=new wX(new NY);const y=this.depthMaskMaterial;y.depthBuffer1=this.renderTargetLight.depthTexture,y.copyCameraSettings(e),this.godRaysPass=new wX(new WY(this.screenPosition));const x=this.godRaysMaterial;x.density=o,x.decay=a,x.weight=l,x.exposure=h,x.maxIntensity=c,x.samples=n;const w=this.resolution=new TX(this,g,v,p);w.addEventListener("change",(e=>this.setSize(w.baseWidth,w.baseHeight)))}set mainCamera(e){this.camera=e,this.renderPassLight.mainCamera=e,this.depthMaskMaterial.copyCameraSettings(e)}get lightSource(){return this._lightSource}set lightSource(e){this._lightSource=e,null!==e&&(e.material.depthWrite=!1,e.material.transparent=!0)}getBlurPass(){return this.blurPass}get texture(){return this.renderTargetB.texture}getTexture(){return this.texture}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get godRaysMaterial(){return this.godRaysPass.fullscreenMaterial}getGodRaysMaterial(){return this.godRaysMaterial}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.godRaysMaterial.dithering}set dithering(e){const t=this.godRaysMaterial;t.dithering=e,t.needsUpdate=!0}get blur(){return this.blurPass.enabled}set blur(e){this.blurPass.enabled=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}get samples(){return this.godRaysMaterial.samples}set samples(e){this.godRaysMaterial.samples=e}setDepthTexture(e,t=Si){this.depthMaskPass.fullscreenMaterial.depthBuffer0=e,this.depthMaskPass.fullscreenMaterial.depthPacking0=t}update(e,t,i){const n=this.lightSource,s=n.parent,r=n.matrixAutoUpdate,o=this.renderTargetA,a=this.renderTargetLight;n.material.depthWrite=!0,n.matrixAutoUpdate=!1,n.updateWorldMatrix(!0,!1),null!==s&&(r||WX.copy(n.matrix),n.matrix.copy(n.matrixWorld)),this.lightScene.add(n),this.renderPassLight.render(e,a),this.clearPass.render(e,o),this.depthMaskPass.render(e,a,o),n.material.depthWrite=!1,n.matrixAutoUpdate=r,null!==s&&(r||n.matrix.copy(WX),s.add(n)),HX.setFromMatrixPosition(n.matrixWorld).project(this.camera),this.screenPosition.set(Math.min(Math.max(.5*(HX.x+1),-1),2),Math.min(Math.max(.5*(HX.y+1),-1),2)),this.blurPass.enabled&&this.blurPass.render(e,o,o),this.godRaysPass.render(e,o,this.renderTargetB)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t);const n=i.width,s=i.height;this.renderTargetA.setSize(n,s),this.renderTargetB.setSize(n,s),this.renderTargetLight.setSize(n,s),this.blurPass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),this.renderPassLight.initialize(e,t,i),this.depthMaskPass.initialize(e,t,i),this.godRaysPass.initialize(e,t,i),void 0!==i&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,this.renderTargetLight.texture.type=i,e.outputColorSpace===se&&(this.renderTargetA.texture.colorSpace=se,this.renderTargetB.texture.colorSpace=se,this.renderTargetLight.texture.colorSpace=se))}}class YX extends BX{constructor(e,t,{blendFunction:i=CY.SCREEN,patternTexture:n=null,patternScale:r=1,edgeStrength:o=1,pulseSpeed:a=0,visibleEdgeColor:l=16777215,hiddenEdgeColor:h=2230538,kernelSize:c=OY.VERY_SMALL,blur:d=!1,xRay:u=!0,multisampling:p=0,resolutionScale:f=.5,width:m=TX.AUTO_SIZE,height:g=TX.AUTO_SIZE,resolutionX:v=m,resolutionY:y=g}={}){super("OutlineEffect","#define GLSLIFY 1\nuniform lowp sampler2D edgeTexture;uniform lowp sampler2D maskTexture;uniform vec3 visibleEdgeColor;uniform vec3 hiddenEdgeColor;uniform float pulse;uniform float edgeStrength;\n#ifdef USE_PATTERN\nuniform lowp sampler2D patternTexture;varying vec2 vUvPattern;\n#endif\nvoid mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 edge=texture2D(edgeTexture,uv).rg;vec2 mask=texture2D(maskTexture,uv).rg;\n#ifndef X_RAY\nedge.y=0.0;\n#endif\nedge*=(edgeStrength*mask.x*pulse);vec3 color=edge.x*visibleEdgeColor+edge.y*hiddenEdgeColor;float visibilityFactor=0.0;\n#ifdef USE_PATTERN\nvec4 patternColor=texture2D(patternTexture,vUvPattern);\n#ifdef X_RAY\nfloat hiddenFactor=0.5;\n#else\nfloat hiddenFactor=0.0;\n#endif\nvisibilityFactor=(1.0-mask.y>0.0)? 1.0 : hiddenFactor;visibilityFactor*=(1.0-mask.x)*patternColor.a;color+=visibilityFactor*patternColor.rgb;\n#endif\nfloat alpha=max(max(edge.x,edge.y),visibilityFactor);\n#ifdef ALPHA\noutputColor=vec4(color,alpha);\n#else\noutputColor=vec4(color,max(alpha,inputColor.a));\n#endif\n}",{uniforms:new Map([["maskTexture",new X(null)],["edgeTexture",new X(null)],["edgeStrength",new X(o)],["visibleEdgeColor",new X(new s(l))],["hiddenEdgeColor",new X(new s(h))],["pulse",new X(1)],["patternScale",new X(r)],["patternTexture",new X(null)]])}),this.blendMode.addEventListener("change",(e=>{this.blendMode.blendFunction===CY.ALPHA?this.defines.set("ALPHA","1"):this.defines.delete("ALPHA"),this.setChanged()})),this.blendMode.blendFunction=i,this.patternTexture=n,this.xRay=u,this.scene=e,this.camera=t,this.renderTargetMask=new q(1,1),this.renderTargetMask.samples=p,this.renderTargetMask.texture.name="Outline.Mask",this.uniforms.get("maskTexture").value=this.renderTargetMask.texture,this.renderTargetOutline=new q(1,1,{depthBuffer:!1}),this.renderTargetOutline.texture.name="Outline.Edges",this.uniforms.get("edgeTexture").value=this.renderTargetOutline.texture,this.clearPass=new sX,this.clearPass.overrideClearColor=new s(0),this.clearPass.overrideClearAlpha=1,this.depthPass=new oX(e,t),this.maskPass=new rX(e,t,new zY(this.depthPass.texture,t));const x=this.maskPass.clearPass;x.overrideClearColor=new s(16777215),x.overrideClearAlpha=1,this.blurPass=new fX({resolutionScale:f,resolutionX:v,resolutionY:y,kernelSize:c}),this.blurPass.enabled=d;const w=this.blurPass.resolution;w.addEventListener("change",(e=>this.setSize(w.baseWidth,w.baseHeight))),this.outlinePass=new wX(new XY),this.outlinePass.fullscreenMaterial.inputBuffer=this.renderTargetMask.texture,this.time=0,this.forceUpdate=!0,this.selection=new PX,this.selection.layer=10,this.pulseSpeed=a}set mainScene(e){this.scene=e,this.depthPass.mainScene=e,this.maskPass.mainScene=e}set mainCamera(e){this.camera=e,this.depthPass.mainCamera=e,this.maskPass.mainCamera=e,this.maskPass.overrideMaterial.copyCameraSettings(e)}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.getResolution()}get multisampling(){return this.renderTargetMask.samples}set multisampling(e){this.renderTargetMask.samples=e,this.renderTargetMask.dispose()}get patternScale(){return this.uniforms.get("patternScale").value}set patternScale(e){this.uniforms.get("patternScale").value=e}get edgeStrength(){return this.uniforms.get("edgeStrength").value}set edgeStrength(e){this.uniforms.get("edgeStrength").value=e}get visibleEdgeColor(){return this.uniforms.get("visibleEdgeColor").value}set visibleEdgeColor(e){this.uniforms.get("visibleEdgeColor").value=e}get hiddenEdgeColor(){return this.uniforms.get("hiddenEdgeColor").value}set hiddenEdgeColor(e){this.uniforms.get("hiddenEdgeColor").value=e}getBlurPass(){return this.blurPass}getSelection(){return this.selection}getPulseSpeed(){return this.pulseSpeed}setPulseSpeed(e){this.pulseSpeed=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get selectionLayer(){return this.selection.layer}set selectionLayer(e){this.selection.layer=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get blur(){return this.blurPass.enabled}set blur(e){this.blurPass.enabled=e}get xRay(){return this.defines.has("X_RAY")}set xRay(e){this.xRay!==e&&(e?this.defines.set("X_RAY","1"):this.defines.delete("X_RAY"),this.setChanged())}isXRayEnabled(){return this.xRay}setXRayEnabled(e){this.xRay=e}get patternTexture(){return this.uniforms.get("patternTexture").value}set patternTexture(e){null!==e?(e.wrapS=e.wrapT=G,this.defines.set("USE_PATTERN","1"),this.setVertexShader("#define GLSLIFY 1\nuniform float patternScale;varying vec2 vUvPattern;void mainSupport(const in vec2 uv){vUvPattern=uv*vec2(aspect,1.0)*patternScale;}")):(this.defines.delete("USE_PATTERN"),this.setVertexShader(null)),this.uniforms.get("patternTexture").value=e,this.setChanged()}setPatternTexture(e){this.patternTexture=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}setSelection(e){return this.selection.set(e),this}clearSelection(){return this.selection.clear(),this}selectObject(e){return this.selection.add(e),this}deselectObject(e){return this.selection.delete(e),this}update(e,t,i){const n=this.scene,s=this.camera,r=this.selection,o=this.uniforms.get("pulse"),a=n.background,l=s.layers.mask;(this.forceUpdate||r.size>0)&&(n.background=null,o.value=1,this.pulseSpeed>0&&(o.value=.375*Math.cos(this.time*this.pulseSpeed*10)+.625),this.time+=i,r.setVisible(!1),this.depthPass.render(e),r.setVisible(!0),s.layers.set(r.layer),this.maskPass.render(e,this.renderTargetMask),s.layers.mask=l,n.background=a,this.outlinePass.render(e,null,this.renderTargetOutline),this.blurPass.enabled&&this.blurPass.render(e,this.renderTargetOutline,this.renderTargetOutline)),this.forceUpdate=r.size>0}setSize(e,t){this.blurPass.setSize(e,t),this.renderTargetMask.setSize(e,t);const i=this.resolution;i.setBaseSize(e,t);const n=i.width,s=i.height;this.depthPass.setSize(n,s),this.renderTargetOutline.setSize(n,s),this.outlinePass.fullscreenMaterial.setSize(n,s)}initialize(e,t,i){this.blurPass.initialize(e,t,F),void 0!==i&&(this.depthPass.initialize(e,t,i),this.maskPass.initialize(e,t,i),this.outlinePass.initialize(e,t,i))}}class XX extends BX{constructor(e=30){super("PixelationEffect","#define GLSLIFY 1\nuniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",{uniforms:new Map([["active",new X(!1)],["d",new X(new y)]])}),this.resolution=new r,this._granularity=0,this.granularity=e}get granularity(){return this._granularity}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this._granularity=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){const i=this.resolution;i.set(e,t);const n=this.granularity,s=n/i.x,r=n/i.y;this.uniforms.get("d").value.set(s,r,1/s,1/r)}}class QX extends IX{constructor(e,t,i){super(i),this.setAttributes(this.getAttributes()|EY.DEPTH),this.camera=t,this.depthPass=new oX(e,t),this.clearPass=new sX(!0,!1,!1),this.clearPass.overrideClearColor=new s(0),this.depthMaskPass=new wX(new NY);const n=this.depthMaskMaterial;n.copyCameraSettings(t),n.depthBuffer1=this.depthPass.texture,n.depthPacking1=Mi,n.depthMode=ze,this.renderTargetMasked=new q(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new PX,this.selection.layer=11,this._inverted=!1,this._ignoreBackground=!1}set mainScene(e){this.depthPass.mainScene=e}set mainCamera(e){this.camera=e,this.depthPass.mainCamera=e,this.depthMaskMaterial.copyCameraSettings(e)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(e){this._inverted=e,this.depthMaskMaterial.depthMode=e?Ne:ze}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(e){this._ignoreBackground=e,this.depthMaskMaterial.maxDepthStrategy=e?2:1}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}setDepthTexture(e,t=Si){this.depthMaskMaterial.depthBuffer0=e,this.depthMaskMaterial.depthPacking0=t}update(e,t,i){const n=this.camera,s=this.selection,r=this.inverted;let o=t;if(this.ignoreBackground||!r||s.size>0){const i=n.layers.mask;n.layers.set(s.layer),this.depthPass.render(e),n.layers.mask=i,o=this.renderTargetMasked,this.clearPass.render(e,o),this.depthMaskPass.render(e,t,o)}super.update(e,o,i)}setSize(e,t){super.setSize(e,t),this.renderTargetMasked.setSize(e,t),this.depthPass.setSize(e,t)}initialize(e,t,i){super.initialize(e,t,i),this.clearPass.initialize(e,t,i),this.depthPass.initialize(e,t,i),this.depthMaskPass.initialize(e,t,i),e.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),void 0!==i&&(this.renderTargetMasked.texture.type=i,e.outputColorSpace===se&&(this.renderTargetMasked.texture.colorSpace=se))}}var qX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",ZX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC";class KX extends BX{constructor({blendFunction:e=CY.SRC,preset:t=BY.MEDIUM,edgeDetectionMode:i=AY.COLOR,predicationMode:n=DY.DISABLED}={}){let r,o;super("SMAAEffect","#define GLSLIFY 1\nuniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",{vertexShader:"#define GLSLIFY 1\nvarying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",blendFunction:e,attributes:EY.CONVOLUTION|EY.DEPTH,uniforms:new Map([["weightMap",new X(null)]])}),arguments.length>1&&(r=arguments[0],o=arguments[1],arguments.length>2&&(t=arguments[2]),arguments.length>3&&(i=arguments[3])),this.renderTargetEdges=new q(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new sX(!0,!1,!1),this.clearPass.overrideClearColor=new s(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new wX(new VY),this.edgeDetectionMaterial.edgeDetectionMode=i,this.edgeDetectionMaterial.predicationMode=n,this.weightsPass=new wX(new QY);const a=new Ri;a.onLoad=()=>{const e=new W(r);e.name="SMAA.Search",e.magFilter=Te,e.minFilter=Te,e.generateMipmaps=!1,e.needsUpdate=!0,e.flipY=!0,this.weightsMaterial.searchTexture=e;const t=new W(o);t.name="SMAA.Area",t.magFilter=N,t.minFilter=N,t.generateMipmaps=!1,t.needsUpdate=!0,t.flipY=!1,this.weightsMaterial.areaTexture=t,this.dispatchEvent({type:"load"})},a.itemStart("search"),a.itemStart("area"),void 0!==r&&void 0!==o?(a.itemEnd("search"),a.itemEnd("area")):"undefined"!=typeof Image&&(r=new Image,o=new Image,r.addEventListener("load",(()=>a.itemEnd("search"))),o.addEventListener("load",(()=>a.itemEnd("area"))),r.src=qX,o.src=ZX),this.applyPreset(t)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){const t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case BY.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case BY.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case BY.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case BY.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0}}setDepthTexture(e,t=Si){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){const{searchTexture:e,areaTexture:t}=this.weightsMaterial;null!==e&&null!==t&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return qX}static get areaImageDataURL(){return ZX}}class JX extends BX{constructor(e,t,{blendFunction:i=CY.MULTIPLY,samples:n=9,rings:s=7,normalDepthBuffer:r=null,depthAwareUpsampling:o=!0,worldDistanceThreshold:a,worldDistanceFalloff:l,worldProximityThreshold:h,worldProximityFalloff:c,distanceThreshold:d=.97,distanceFalloff:u=.03,rangeThreshold:p=5e-4,rangeFalloff:f=.001,minRadiusScale:m=.1,luminanceInfluence:g=.7,radius:v=.1825,intensity:y=1,bias:x=.025,fade:w=.01,color:b=null,resolutionScale:_=1,width:S=TX.AUTO_SIZE,height:M=TX.AUTO_SIZE,resolutionX:C=S,resolutionY:A=M}={}){super("SSAOEffect","#define GLSLIFY 1\nuniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;\n#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D normalDepthBuffer;\n#else\nuniform mediump sampler2D normalDepthBuffer;\n#endif\n#endif\n#ifdef COLORIZE\nuniform vec3 color;\n#endif\nvoid mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;\n#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300\nvec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);\n#else\nfloat ao=aoLinear;\n#endif\nfloat l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);\n#ifdef COLORIZE\noutputColor=vec4(1.0-ao*(1.0-color),inputColor.a);\n#else\noutputColor=vec4(vec3(1.0-ao),inputColor.a);\n#endif\n}",{blendFunction:i,attributes:EY.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new X(null)],["normalDepthBuffer",new X(r)],["luminanceInfluence",new X(g)],["color",new X(null)],["intensity",new X(y)],["scale",new X(0)]])}),this.renderTarget=new q(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const E=this.resolution=new TX(this,C,A,_);E.addEventListener("change",(e=>this.setSize(E.baseWidth,E.baseHeight))),this.camera=e,this.depthDownsamplingPass=new aX({normalBuffer:t,resolutionScale:_}),this.depthDownsamplingPass.enabled=null===r,this.ssaoPass=new wX(new qY(e));const T=new FX(64,64,U);T.wrapS=T.wrapT=G;const P=this.ssaoMaterial;P.normalBuffer=t,P.noiseTexture=T,P.minRadiusScale=m,P.samples=n,P.radius=v,P.rings=s,P.fade=w,P.bias=x,P.distanceThreshold=d,P.distanceFalloff=u,P.proximityThreshold=p,P.proximityFalloff=f,void 0!==a&&(P.worldDistanceThreshold=a),void 0!==l&&(P.worldDistanceFalloff=l),void 0!==h&&(P.worldProximityThreshold=h),void 0!==c&&(P.worldProximityFalloff=c),null!==r&&(this.ssaoMaterial.normalDepthBuffer=r,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=o,this.color=b}set mainCamera(e){this.camera=e,this.ssaoMaterial.copyCameraSettings(e)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(e){this.ssaoMaterial.normalBuffer=e,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=e}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(e){this.ssaoMaterial.samples=e}get rings(){return this.ssaoMaterial.rings}set rings(e){this.ssaoMaterial.rings=e}get radius(){return this.ssaoMaterial.radius}set radius(e){this.ssaoMaterial.radius=e}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(e){this.depthAwareUpsampling!==e&&(e?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(e){this.depthAwareUpsampling=e}get distanceScaling(){return!0}set distanceScaling(e){}get color(){return this.uniforms.get("color").value}set color(e){const t=this.uniforms,i=this.defines;null!==e?i.has("COLORIZE")?t.get("color").value.set(e):(i.set("COLORIZE","1"),t.get("color").value=new s(e),this.setChanged()):i.has("COLORIZE")&&(i.delete("COLORIZE"),t.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(e){this.uniforms.get("luminanceInfluence").value=e}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getColor(){return this.color}setColor(e){this.color=e}setDistanceCutoff(e,t){this.ssaoMaterial.distanceThreshold=e,this.ssaoMaterial.distanceFalloff=t}setProximityCutoff(e,t){this.ssaoMaterial.proximityThreshold=e,this.ssaoMaterial.proximityFalloff=t}setDepthTexture(e,t=Si){this.depthDownsamplingPass.setDepthTexture(e,t),this.ssaoMaterial.depthBuffer=e,this.ssaoMaterial.depthPacking=t}update(e,t,i){const n=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(e),this.ssaoPass.render(e,null,n)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t);const n=i.width,s=i.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(n,s),this.renderTarget.setSize(n,s),this.depthDownsamplingPass.resolution.scale=i.scale,this.depthDownsamplingPass.setSize(e,t)}initialize(e,t,i){try{let n=this.uniforms.get("normalDepthBuffer").value;null===n&&(this.depthDownsamplingPass.initialize(e,t,i),n=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=n,this.ssaoMaterial.normalDepthBuffer=n,this.defines.set("NORMAL_DEPTH","1"))}catch(e){this.depthDownsamplingPass.enabled=!1}}}class $X extends BX{constructor({blendFunction:e,texture:t=null,aspectCorrection:i=!1}={}){super("TextureEffect","#define GLSLIFY 1\n#ifdef TEXTURE_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nvarying vec2 vUv2;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){\n#ifdef UV_TRANSFORM\nvec4 texel=texture2D(map,vUv2);\n#else\nvec4 texel=texture2D(map,uv);\n#endif\noutputColor=TEXEL;}",{blendFunction:e,defines:new Map([["TEXEL","texel"]]),uniforms:new Map([["map",new X(null)],["scale",new X(1)],["uvTransform",new X(null)]])}),this.texture=t,this.aspectCorrection=i}get texture(){return this.uniforms.get("map").value}set texture(e){const t=this.texture,i=this.uniforms,n=this.defines;t!==e&&(i.get("map").value=e,i.get("uvTransform").value=e.matrix,n.delete("TEXTURE_PRECISION_HIGH"),null!==e&&(e.matrixAutoUpdate?(n.set("UV_TRANSFORM","1"),this.setVertexShader("#define GLSLIFY 1\n#ifdef ASPECT_CORRECTION\nuniform float scale;\n#else\nuniform mat3 uvTransform;\n#endif\nvarying vec2 vUv2;void mainSupport(const in vec2 uv){\n#ifdef ASPECT_CORRECTION\nvUv2=uv*vec2(aspect,1.0)*scale;\n#else\nvUv2=(uvTransform*vec3(uv,1.0)).xy;\n#endif\n}")):(n.delete("UV_TRANSFORM"),this.setVertexShader(null)),e.type!==F&&n.set("TEXTURE_PRECISION_HIGH","1"),null!==t&&t.type===e.type&&t.encoding===e.encoding||this.setChanged()))}getTexture(){return this.texture}setTexture(e){this.texture=e}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(e){this.aspectCorrection!==e&&(e?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){const e=this.texture;return null!==e&&e.matrixAutoUpdate}set uvTransform(e){const t=this.texture;null!==t&&(t.matrixAutoUpdate=e)}setTextureSwizzleRGBA(e,t=e,i=e,n=e){const s="rgba";let r="";0===e&&1===t&&2===i&&3===n||(r=[".",s[e],s[t],s[i],s[n]].join("")),this.defines.set("TEXEL","texel"+r),this.setChanged()}update(e,t,i){this.texture.matrixAutoUpdate&&this.texture.updateMatrix()}}class eQ extends BX{constructor({blendFunction:e=CY.SRC,adaptive:t=!1,mode:i=(t?IY.REINHARD2_ADAPTIVE:IY.AGX),resolution:n=256,maxLuminance:s=4,whitePoint:r=s,middleGrey:o=.6,minLuminance:a=.01,averageLuminance:l=1,adaptationRate:h=1}={}){super("ToneMappingEffect","#define GLSLIFY 1\n#include <tonemapping_pars_fragment>\nuniform float whitePoint;\n#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3\nuniform float middleGrey;\n#if TONE_MAPPING_MODE == 3\nuniform lowp sampler2D luminanceBuffer;\n#else\nuniform float averageLuminance;\n#endif\nvec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);\n#if TONE_MAPPING_MODE == 3\nfloat lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));\n#else\nfloat lumAvg=averageLuminance;\n#endif\nfloat lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}\n#elif TONE_MAPPING_MODE == 4\n#define A 0.15\n#define B 0.50\n#define C 0.10\n#define D 0.20\n#define E 0.02\n#define F 0.30\nvec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}\n#endif\nvoid mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){\n#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3\noutputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);\n#elif TONE_MAPPING_MODE == 4\noutputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);\n#else\noutputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);\n#endif\n}",{blendFunction:e,uniforms:new Map([["luminanceBuffer",new X(null)],["maxLuminance",new X(s)],["whitePoint",new X(r)],["middleGrey",new X(o)],["averageLuminance",new X(l)]])}),this.renderTargetLuminance=new q(1,1,{minFilter:Be,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new gX({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new tX(this.luminancePass.texture,{minLuminance:a,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=n,this.mode=i}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(e){if(this.mode!==e){switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",e.toFixed(0)),e){case IY.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case IY.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case IY.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)","OptimizedCineonToneMapping(texel)");break;case IY.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case IY.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case IY.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel")}this.adaptiveLuminancePass.enabled=e===IY.REINHARD2_ADAPTIVE,this.setChanged()}}getMode(){return this.mode}setMode(e){this.mode=e}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(e){this.uniforms.get("whitePoint").value=e}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(e){this.uniforms.get("middleGrey").value=e}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(e){this.uniforms.get("averageLuminance").value=e}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(e){const t=Math.max(0,Math.ceil(Math.log2(e))),i=Math.pow(2,t);this.luminancePass.resolution.setPreferredSize(i,i),this.adaptiveLuminanceMaterial.mipLevel1x1=t}getResolution(){return this.resolution}setResolution(e){this.resolution=e}get adaptive(){return this.mode===IY.REINHARD2_ADAPTIVE}set adaptive(e){this.mode=e?IY.REINHARD2_ADAPTIVE:IY.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(e){this.adaptiveLuminanceMaterial.adaptationRate=e}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(e){console.warn(this.name,"distinction was removed.")}update(e,t,i){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(e,t),this.adaptiveLuminancePass.render(e,null,null,i))}initialize(e,t,i){this.adaptiveLuminancePass.initialize(e,t,i)}}const tQ="2024-09-12T08:52:50.203Z",iQ="1.0.0",nQ=1,sQ=!1;var rQ=Object.freeze({__proto__:null,AbstractDecoratorBehavior:RL,ActionBehavior:UL,ActionCallback:Dy,ActionDelay:By,ActionMotion:Iy,ActionRepeat:Ty,ActionTween:Oy,ActionYoyo:Py,Adapter:oR,AddObject3DCommand:vU,AnimateMarkerBase:YU,AnimationBehavior:az,AnimationTrack:oz,AnimationTrackPlayback:rz,Animator:BD,AnimatorFrameMaterial:CA,AnimatorModule:vz,App:KH,AppBase:Uw,AppModuleBase:Fw,AppObject:yy,ApplyCollision:yI,ApplyForce:GB,ApplyRoute:Sk,ApplySequences:fI,AxisAngleGenerator:DB,BaseCommand:sU,BaseUVUnwrapper:ww,BaseUvAtlas:aw,BatchedRenderer:qI,Behavior:IL,BehaviorModule:lz,get BehaviorStatus(){return ML},BetterRaycastingPoints:UE,Bezier:dB,BidirectionalMap:pv,Billboard:nD,BillboardModule:wL,BitSet:ZW,BlendFunction:CY,BloomEffect:IX,BoxHelper:zD,BranchBehavior:ZL,BreathingApertureMarker:XU,BufferShader:GA,ButtonGroupControl:nF,CSS2DRendererModule:cH,CSS3DRendererModule:dH,CallFunctionCommand:lU,CameraControls:BN,CameraModule:kF,CancelablePromise:gY,CancelledCommandException:Ww,CanvasUtils:$G,ChangeEmitDirection:XB,ChromaticAberrationEffect:kX,CircleEmitter:TI,ColorBySpeed:xI,ColorDepthEffect:RX,ColorGeneratorFromJSON:MB,ColorOverLife:kB,ColorRange:vB,CommandHistory:dU,CommandModule:mH,CompositeBehavior:NL,ConditionBehavior:tz,ConditionalBehavior:kL,ConeEmitter:EI,ConstantColor:SB,ConstantValue:CB,ContextMenu:eF,ConvolutionMaterial:EA,CoordSystemModule:cV,CopyPass:eX,CubeEmitter:wk,CustomShaderMaterial:yE,DEFAULT_EASING:Ay,DEG2RAD:_v,DOM:bz,DefaultTool:Mz,DelayBehavior:FL,DependencyError:sy,DepthOfFieldEffect:LX,DepthPass:oX,DepthPickingPass:cX,DestoryBehavior:HL,DiffusedApertureMarker:QU,DispatchEvent:_y,DonutEmitter:PI,DotScreenEffect:zX,DrawShapeTool:wU,DynamicEnvironment:yL,DynamicInstancedMesh:gA,Easings:Ey,EdgeDetectionMode:AY,Effect:BX,EffectAttribute:EY,EffectComposer:SX,EffectPass:pX,EmitSubParticleSystem:KB,EmitterFromJSON:LI,get EmitterMode(){return CI},EmitterShapes:kI,Entity:UP,EntityBase:Nw,EntityManagerModule:uH,EntityModuleBase:Sy,EntityOutlineModule:pH,EntityQueryModule:oV,Environment:cL,EulerGenerator:BB,EventDispatcher:Kv,EventModule:fF,ExtrudeMesh:tT,FXAAEffect:UX,FailingBehavior:YL,FillExtrusionsEntity:qO,FillExtrusionsModule:QO,FilterBehavior:KL,FixedSizeMeshMaterial:yA,FlowMaterial:wA,FluorescenceMarker:qU,FontManager:WE,ForceOverLife:FB,FrameOverLife:VB,FullScreenQuad:pL,FullscreenControl:uF,GeneratorFromJSON:RB,GeoBounds:Yb,GeoPoint:Nb,GeoProjection:qb,GlLinesEntity:KO,GlLinesModule:ZO,GlitchEffect:VX,GlitchMode:PY,GodRaysEffect:GX,Gradient:wB,Graph:HG,GraphNodeType:dR,GravityForce:YB,Grid:Jw,GridEmitter:II,GridHelperModule:tb,HaloRingMarker:ZU,Heatmap:WD,HemisphereEmitter:BI,HolographicMaterial:bE,HyperbolicHelicoidGeometry:ZG,IgnoreFailureBehavior:$L,InputModule:hV,InstancedMeshEntity:NP,InstancedMeshModule:vA,InteractiveEvent:by,InteractiveObject:rV,Interpolation:Zb,Interpreter:lR,IntervalValue:AB,InvertStatusBehavior:iz,KawaseBlurPass:fX,KernelSize:OY,LODRaycast:lY,Label:KE,LabelMaterial:qE,LabelPool:JE,LambdaPass:mX,LimitSpeedOverLife:_I,Line2:cO,LineGeometry:hO,LineMaterial:YP,LineSegments2:lO,LineSegmentsGeometry:GP,LinearToSRGB:gx,LoadManager:eL,LoaderManager:Ck,LogMessageBehavior:LL,Logger:ny,MapHeightNode:oY,MapNode:iY,MapNodeGeometry:nY,MapNodeHeightGeometry:rY,get MapOpenWay(){return Rk},MapPlaneNode:sY,MapProvider:mY,MapThreeLayer:RP,MapUtils:hY,MapView:fY,MapViewEntity:yY,Marker2D:UU,Marker3D:GU,MeshEntity:FP,MeshLine:CT,MeshLineGeometry:yT,MeshLineMaterial:MT,MeshModule:mA,MeshReflectorMaterial:OA,MeshSurfaceEmitter:RI,MeshTransmissionMaterial:YA,MiniMapControl:pF,ModelModule:yz,ModuleBase:xy,ModuleManager:wy,MousePositionControl:dF,MultiCmdsCommand:cU,Node:sR,NodeDef:cR,NodeGraph:hk,NodeParticle:aB,get NodeType(){return hR},NodeTypes:uR,NodeVFX:fk,get NodeValueType(){return eR},Noise:dI,NormalPass:xX,OrbitControlModule:RN,OrbitOverLife:HB,get OrderIndex(){return gy},OutlineEffect:YX,OutlineModule:_L,Outlines:rD,OutputNodeTypeNames:lk,OverrideMaterialManager:AX,PackedMipMapGenerator:gL,ParallelBehavior:jL,get ParallelBehaviorPolicy(){return AL},ParticleEmitter:sB,ParticleLoader:ZI,ParticleModule:gz,ParticlePlugins:KI,ParticleRenderModule:gH,ParticleSystem:WI,Pass:$Y,PathAnimateModule:gF,PathEmitter:bk,PathGeometry:IT,PathPointList:BT,PathTubeEntities:iD,PathTubeGeometry:kT,PhysicsManagerModule:VH,PhysicsModule:mF,PickModule:fH,PickTool:LU,PiecewiseBezier:TB,PiecewiseFunction:EB,PixelationEffect:XX,PluginManager:qk,Plugins:Zk,PointEmitter:OI,PointerDragHelper:Vy,PolygonsEntity:XO,PolygonsModule:YO,PolylinesEntity:GO,PolylinesModule:WO,Popup2D:HU,PostProcessModule:sV,PredicationMode:DY,Projection:Qb,PromiseBehavior:WL,PushValueCommand:fU,QuadTreePosition:tY,RAD2DEG:Sv,RadarMaterial:wE,RandomColor:gB,RandomColorBetweenGradient:_B,RandomQuatGenerator:OB,get RayQueryType(){return PP},RecordState:hB,RectCollideModule:vH,ReflectorBlurMaterial:GD,ReflectorDudvMaterial:AE,ReflectorMaterial:ME,ReflectorObject:YD,Render3dTexture:FA,get RenderMode(){return zI},RenderPass:rX,RepeatBehavior:XL,RepeatUntilFailureBehavior:JL,RepeatUntilSuccessBehavior:ez,ResManager:iL,get ResStatus(){return Mk},ResourceManager:tL,RotatingApertureMarker:KU,RotatingTextBorderMarker:JU,Rotation3DOverLife:UB,RotationBehavior:sz,RotationBySpeed:bI,RotationGeneratorFromJSON:IB,RotationOverLife:LB,RunningTween:Ry,SMAAEffect:KX,SMAAPreset:BY,SRGBToLinear:mx,SSAOEffect:JX,SceneModule:VF,Scheduler:Qw,ScreenQuad:kD,SelectiveBloomEffect:QX,SelectorBehavior:nz,SendEventBehavior:zL,SequenceBehavior:VL,SequencerFromJSON:pI,Serialization:Ex,Service:Vk,SetDataCommand:gU,SetEmitDirection:_k,SetMaterialMapCommand:rU,SetMultipleValuesCommand:hU,SetPositionCommand:pU,SetRotationCommand:uU,SetScaleCommand:mU,SetValueCommand:oU,ShaderPass:wX,ShadertoyMaterial:jA,ShadertoyTexture:HA,get ShapeType2(){return OH},Signal:cy,SignalHandler:ay,SimpleEventDispatcher:Fy,SimulationFromJSON:MI,SimulationTypes:SI,SizeBySpeed:wI,SizeOverLife:NB,SpeedOverLife:jB,SphereEmitter:DI,SphubeGeometry:KG,SpriteAnimatorEntity:VP,SpriteAnimatorModule:BL,SpriteBatch:XI,SpriteImages:PD,SpriteImagesEntity:$O,SpriteImagesModule:fz,SpriteMarker:TD,SpriteMarkerEntity:JO,SpriteMarkerModule:pz,SpriteParticle:lB,SpriteTexts:OD,SpriteTextsEntity:eD,SpriteTextsModule:mz,StatModule:nV,StateNode:_z,Store:Cy,get SubParticleEmitMode(){return ZB},SucceedingBehavior:GL,SymbolEntity:jP,SymbolModule:FE,TYPED_ARRAYS:Zy,TextureEffect:$X,TextureSequencer:uI,TextureUtils:eY,Time:ry,ToneMappingEffect:eQ,ToneMappingMode:IY,ToolStateModule:xH,TrailBatch:QI,TrailLine:cD,TrailLineEntity:tD,TrailParticle:cB,TransformControls:bU,TransformControlsGizmo:_U,TransformControlsPlane:SU,TransformTool:IU,TurbulenceField:oI,Tween:ky,TweenManager:Ly,UVUnwrapper:bw,UiConfigMethods:gP,UiConfigRendererBase:xP,UiConfigTypeMap:KT,UiModule:QH,UiPanelJsonConfig:yP,UnitsUtils:cY,UpdateValueCommand:aU,UvAtlasWebWorker:xw,VFXBatch:UI,ValueGeneratorFromJSON:PB,VariableTubeGeometry:XG,ViewHelper:$w,WaitForEventBehavior:QL,WebGLRendererModule:CF,WebGPUCompiler:gk,WidthOverLength:WB,Wire:rR,Wireframe:pO,WireframeGeometry2:fO,XHRUtils:vY,__DEV:sQ,__buildDate:tQ,__buildVerNo:nQ,__buildVersion:iQ,absMax:Kx,acceleratedRaycast:QC,addResourceRefCount:aW,addScript:vG,aesGcmDecrypt:Rx,aesGcmEncrypt:Ix,anchorOrigin:wz,anchorTranslate:xz,animation:zy,animationAsync:Uy,applyMixins:cv,approxArrayEquals:Bv,approxEquals:Tv,approxZero:Ev,arrayBufferToBase64:Qy,base64ToArrayBuffer:qy,bindAll:gv,blobToDataURL:cx,buildPathTubeTopo:GG,buildTopoGraph:WG,cameraDistance2NdcZ:nW,cameraWorldDirection:wW,canvasFlipY:Nx,clamp:Mv,clearBit:$x,cloneDeep:fv,cloneMaterial:TW,closestPointOnPolyline:pS,closestPointOnPolylines:fS,closestPointOnSegment:lS,closestToSegment3d:uS,colorToDataUrl:vx,computeBoundsTree:qC,containSkeleton:hW,convertToMaterialParameters:qw,copyProps:Cx,creataMeasureRuler:aL,createAnimatorFrameSpriteMaterial:AA,createCanvasElement:Hy,createDefaultMarkerElement:zU,createDiv:Wy,createFlowGradientMaterial:xE,createFlyline:xL,createImage:Gy,createLabel:eT,createMapApp:DP,createReflectorShaderMesh:nL,createRender2dTexture:IA,createRenderElementFlowMaterial:bA,createScreenSpaceEntity:AW,createScriptFromURL:Xy,createSpriteAnimator:hD,createStyles:Yy,createSymbolMaterial:xA,createTextFlowMaterial:_A,createTextMesh:lD,createUnProjectMenu:IG,createWallBufferGeometry:JG,createWorker:pw,createWorkerWrap:yw,css:rx,debounce:lv,decryptFromBase64:Ik,deepAccessObject:ew,degToRad:Wv,deleteArrItem:hv,disableBloom:mW,disableBloomSelectedRayQuery:vW,disableOutline:gW,disableRayQuery:pW,disableSelected:fW,dispatchViaProxy:fy,disposeBoundsTree:ZC,disposeMaterial:PW,disposeObject3D:lW,dist2d:wG,downloadBlob:hx,downloadFile:dx,embedUrlRefs:Xx,enableMaterialVerticeOpacity:DW,enableRealisticRender:zG,enableSRGBColorSpace:kG,enableShadow:UG,encryptToBase64:Bk,escapeRegExp:tx,eventKeyCode:sG,eventXY:hG,expandLine:NW,explodeGroup:RG,exportRenderTarget:gG,extend:vv,extrudeGeoJSON:rS,extrudePolygon:iS,extrudePolyline:nS,findShortestPath:YG,findSignalHandlerIndexByHandle:dy,findSignalHandlerIndexByHandleAndContext:uy,flatModel:jG,fromDist:kW,fromWorld:IW,genDefaultForNodeValueType:nR,generateUUID:uv,generateUiConfig:$T,generateUiFolder:eP,geoBounds:Xb,geoPoint:jb,getAlignOfNodeValueType:tR,getBoundingBox:dW,getEmptyMeta:UT,getEntityParents:Pk,getEnvmapFromHDRTexture:FG,getEnvmapFromScene:NG,getFilenameFromPath:ex,getFilterColorMatrix:Hv,getFrustum:OG,getFrustumFromHeight:DG,getFullscreenTriangle:EG,getKeyByValue:tw,getObjectAnchorPoint:uW,getObjectOwnerEntity:Ek,getObjectRefCount:rW,getOrCall:Mx,getOwerScene:Tk,getPhysicsResolver:vI,getPropertyDescriptor:bx,getScreenSpaceBox:PG,getShapeParameters:DH,getSizeOfNodeValueType:iR,getSphericalCube:TG,getTypedArray:Ky,getUrlQueryParam:nw,getValueFromEmitterMode:AI,glsl:sx,highlightMaterial:ib,html:ox,htmlToCanvas:qx,htmlToPng:Zx,htmlToSvg:Qx,httpHelper:jk,iMaterialUI:FT,imageBitmapToBase64:kx,imageDataToCanvas:Ux,imageToCanvas:zx,imageUrlToImageData:Lx,includesAll:yx,infinityToMaxNumber:Rv,interpolatePointsByRatio:YW,intersectLine3D:SG,isAltKeyDown:nG,isCtrlKeyDown:iG,isDeleteKey:aG,isEnterKey:rG,isEscKey:oG,isGeoPointLike:Vb,isLeftButton:JW,isMapMode:CW,isMiddleButton:$W,isObjectBehindCamera:iW,isObjectOcclude:sW,isPointInPolygon:yG,isPropertyWritable:_x,isRightButton:eG,isShiftKeyDown:tG,isWebpExportSupported:Fx,lerp:Cv,lerpCameras:BG,lerpCoordinates:xG,lerpEuler:Av,line3dSplit:CG,lineDistance:WW,lineIntersection:k_,lineSlice:GW,lineSplit:gS,loadImage:cG,loadParticlePlugin:JI,loadPhysicsEngine:LH,loadPlugin3dtiles:Jk,loadPluginAlgorithm:Kk,longestCommonPrefix:nx,makeBasicMaterialUiConfig:NT,makeCameraUiConfig:zP,makeColorSvg:jx,makeColorSvgCircle:Vx,makeGeomertyUiConfig:WT,makeLightUiConfig:wP,makeMaterialUiConfig:HT,makeObject3DUiConfig:LP,makePhongMaterialUiConfig:jT,makePhysicalMaterialUiConfig:VT,makeSamplerUi:zT,makeTextSvg:Hx,map2dUtils:BP,max2:Uv,max3:Lv,maxNumberToInfinity:kv,maxValue:Pv,min2:Fv,min3:zv,minValue:Ov,mobileAndTabletCheck:fx,multiLine3dSplit:AG,multiLineSplit:vS,now:jy,object2Entity:Ak,objectHasOwn:iw,objectTransformToMatrix:cW,offsetCoords:bG,offsetPolygon:W_,onChange:Tx,onChange2:Px,onChange3:Ox,openMapDarkStyle:Hk,openMapLightStyle:Wk,optimizeModelRender:LG,parseFileExtension:$y,pathJoin:rw,pick:mv,pointDistance:HW,pointToSegmentDistance:aS,prettyScrollbar:lx,preventDefaultEvent:lG,pushObjectStatus:wv,radToDeg:Gv,randColor:bW,randHtmlColor:_W,randInt:Dv,randPoint2D:MW,randPoint3D:SW,reactivity:nv,registerShaderChunks:nB,remoteWorkerURL:ow,render2d:Of,renderTargetToDataUrl:uG,replaceAll:ix,resetUV:yW,roundToStep:Iv,safeSetProperty:Sx,segmentIntersect:mS,segmentIntersect3d:MG,serializable:Bx,serialize:Dx,setMaterialOpacity:OW,setPhysicsResolver:gI,setUrlQueryParam:sw,shaderMaterial:Zw,simplifyPoints:C_,sleep:xv,smoothPoints:jv,strMd5:yv,svgToCanvas:Wx,svgToPng:Gx,svgUrl:ax,tea:Ok,texImageToCanvas:mG,textureDataToImageData:dG,textureToCanvas:fG,textureToDataUrl:pG,threeToCannon:BH,throttle:av,timeout:Ny,toDist:RW,toTitleCase:Jy,toVector3:Vv,toWorld:BW,transform:Gb,traverseMaterial:EW,triangle2dArea:z_,triangulatFlatten:F_,triangulate:U_,uiButton:lP,uiColor:dP,uiConfig:iP,uiContainer:nP,uiDropdown:aP,uiFolderContainer:mP,uiImage:uP,uiInput:hP,uiMonitor:sP,uiNumber:cP,uiPanelContainer:fP,uiSlider:rP,uiToggle:pP,uiVector:oP,unloadParticlePlugin:$I,updateBit:Jx,uploadFile:ux,uploadFileGetContent:px,useFBO:UA,workerLink:vw,workerProxy:mw,workerTransfer:gw,workerWrap:fw});export{RL as AbstractDecoratorBehavior,UL as ActionBehavior,Dy as ActionCallback,By as ActionDelay,Iy as ActionMotion,Ty as ActionRepeat,Oy as ActionTween,Py as ActionYoyo,oR as Adapter,vU as AddObject3DCommand,YU as AnimateMarkerBase,az as AnimationBehavior,oz as AnimationTrack,rz as AnimationTrackPlayback,BD as Animator,CA as AnimatorFrameMaterial,vz as AnimatorModule,KH as App,Uw as AppBase,Fw as AppModuleBase,yy as AppObject,yI as ApplyCollision,GB as ApplyForce,Sk as ApplyRoute,fI as ApplySequences,DB as AxisAngleGenerator,sU as BaseCommand,ww as BaseUVUnwrapper,aw as BaseUvAtlas,qI as BatchedRenderer,IL as Behavior,lz as BehaviorModule,ML as BehaviorStatus,UE as BetterRaycastingPoints,dB as Bezier,pv as BidirectionalMap,nD as Billboard,wL as BillboardModule,ZW as BitSet,CY as BlendFunction,IX as BloomEffect,zD as BoxHelper,ZL as BranchBehavior,XU as BreathingApertureMarker,GA as BufferShader,nF as ButtonGroupControl,cH as CSS2DRendererModule,dH as CSS3DRendererModule,lU as CallFunctionCommand,BN as CameraControls,kF as CameraModule,gY as CancelablePromise,Ww as CancelledCommandException,$G as CanvasUtils,XB as ChangeEmitDirection,kX as ChromaticAberrationEffect,TI as CircleEmitter,xI as ColorBySpeed,RX as ColorDepthEffect,MB as ColorGeneratorFromJSON,kB as ColorOverLife,vB as ColorRange,dU as CommandHistory,mH as CommandModule,NL as CompositeBehavior,tz as ConditionBehavior,kL as ConditionalBehavior,EI as ConeEmitter,SB as ConstantColor,CB as ConstantValue,eF as ContextMenu,EA as ConvolutionMaterial,cV as CoordSystemModule,eX as CopyPass,wk as CubeEmitter,yE as CustomShaderMaterial,Ay as DEFAULT_EASING,_v as DEG2RAD,bz as DOM,Mz as DefaultTool,FL as DelayBehavior,sy as DependencyError,LX as DepthOfFieldEffect,oX as DepthPass,cX as DepthPickingPass,HL as DestoryBehavior,QU as DiffusedApertureMarker,_y as DispatchEvent,PI as DonutEmitter,zX as DotScreenEffect,wU as DrawShapeTool,yL as DynamicEnvironment,gA as DynamicInstancedMesh,Ey as Easings,AY as EdgeDetectionMode,BX as Effect,EY as EffectAttribute,SX as EffectComposer,pX as EffectPass,KB as EmitSubParticleSystem,LI as EmitterFromJSON,CI as EmitterMode,kI as EmitterShapes,UP as Entity,Nw as EntityBase,uH as EntityManagerModule,Sy as EntityModuleBase,pH as EntityOutlineModule,oV as EntityQueryModule,cL as Environment,BB as EulerGenerator,Kv as EventDispatcher,fF as EventModule,tT as ExtrudeMesh,UX as FXAAEffect,YL as FailingBehavior,qO as FillExtrusionsEntity,QO as FillExtrusionsModule,KL as FilterBehavior,yA as FixedSizeMeshMaterial,wA as FlowMaterial,qU as FluorescenceMarker,WE as FontManager,FB as ForceOverLife,VB as FrameOverLife,pL as FullScreenQuad,uF as FullscreenControl,RB as GeneratorFromJSON,Yb as GeoBounds,Nb as GeoPoint,qb as GeoProjection,KO as GlLinesEntity,ZO as GlLinesModule,VX as GlitchEffect,PY as GlitchMode,GX as GodRaysEffect,wB as Gradient,HG as Graph,dR as GraphNodeType,YB as GravityForce,Jw as Grid,II as GridEmitter,tb as GridHelperModule,ZU as HaloRingMarker,WD as Heatmap,BI as HemisphereEmitter,bE as HolographicMaterial,ZG as HyperbolicHelicoidGeometry,$L as IgnoreFailureBehavior,hV as InputModule,NP as InstancedMeshEntity,vA as InstancedMeshModule,by as InteractiveEvent,rV as InteractiveObject,Zb as Interpolation,lR as Interpreter,AB as IntervalValue,iz as InvertStatusBehavior,fX as KawaseBlurPass,OY as KernelSize,lY as LODRaycast,KE as Label,qE as LabelMaterial,JE as LabelPool,mX as LambdaPass,_I as LimitSpeedOverLife,cO as Line2,hO as LineGeometry,YP as LineMaterial,lO as LineSegments2,GP as LineSegmentsGeometry,gx as LinearToSRGB,eL as LoadManager,Ck as LoaderManager,LL as LogMessageBehavior,ny as Logger,oY as MapHeightNode,iY as MapNode,nY as MapNodeGeometry,rY as MapNodeHeightGeometry,Rk as MapOpenWay,sY as MapPlaneNode,mY as MapProvider,RP as MapThreeLayer,hY as MapUtils,fY as MapView,yY as MapViewEntity,UU as Marker2D,GU as Marker3D,FP as MeshEntity,CT as MeshLine,yT as MeshLineGeometry,MT as MeshLineMaterial,mA as MeshModule,OA as MeshReflectorMaterial,RI as MeshSurfaceEmitter,YA as MeshTransmissionMaterial,pF as MiniMapControl,yz as ModelModule,xy as ModuleBase,wy as ModuleManager,dF as MousePositionControl,cU as MultiCmdsCommand,sR as Node,cR as NodeDef,hk as NodeGraph,aB as NodeParticle,hR as NodeType,uR as NodeTypes,fk as NodeVFX,eR as NodeValueType,dI as Noise,xX as NormalPass,RN as OrbitControlModule,HB as OrbitOverLife,gy as OrderIndex,YX as OutlineEffect,_L as OutlineModule,rD as Outlines,lk as OutputNodeTypeNames,AX as OverrideMaterialManager,gL as PackedMipMapGenerator,jL as ParallelBehavior,AL as ParallelBehaviorPolicy,sB as ParticleEmitter,ZI as ParticleLoader,gz as ParticleModule,KI as ParticlePlugins,gH as ParticleRenderModule,WI as ParticleSystem,$Y as Pass,gF as PathAnimateModule,bk as PathEmitter,IT as PathGeometry,BT as PathPointList,iD as PathTubeEntities,kT as PathTubeGeometry,VH as PhysicsManagerModule,mF as PhysicsModule,fH as PickModule,LU as PickTool,TB as PiecewiseBezier,EB as PiecewiseFunction,XX as PixelationEffect,qk as PluginManager,Zk as Plugins,OI as PointEmitter,Vy as PointerDragHelper,XO as PolygonsEntity,YO as PolygonsModule,GO as PolylinesEntity,WO as PolylinesModule,HU as Popup2D,sV as PostProcessModule,DY as PredicationMode,Qb as Projection,WL as PromiseBehavior,fU as PushValueCommand,tY as QuadTreePosition,Sv as RAD2DEG,wE as RadarMaterial,gB as RandomColor,_B as RandomColorBetweenGradient,OB as RandomQuatGenerator,PP as RayQueryType,hB as RecordState,vH as RectCollideModule,GD as ReflectorBlurMaterial,AE as ReflectorDudvMaterial,ME as ReflectorMaterial,YD as ReflectorObject,FA as Render3dTexture,zI as RenderMode,rX as RenderPass,XL as RepeatBehavior,JL as RepeatUntilFailureBehavior,ez as RepeatUntilSuccessBehavior,iL as ResManager,Mk as ResStatus,tL as ResourceManager,KU as RotatingApertureMarker,JU as RotatingTextBorderMarker,UB as Rotation3DOverLife,sz as RotationBehavior,bI as RotationBySpeed,IB as RotationGeneratorFromJSON,LB as RotationOverLife,Ry as RunningTween,KX as SMAAEffect,BY as SMAAPreset,mx as SRGBToLinear,JX as SSAOEffect,VF as SceneModule,Qw as Scheduler,kD as ScreenQuad,QX as SelectiveBloomEffect,nz as SelectorBehavior,zL as SendEventBehavior,VL as SequenceBehavior,pI as SequencerFromJSON,Ex as Serialization,Vk as Service,gU as SetDataCommand,_k as SetEmitDirection,rU as SetMaterialMapCommand,hU as SetMultipleValuesCommand,pU as SetPositionCommand,uU as SetRotationCommand,mU as SetScaleCommand,oU as SetValueCommand,wX as ShaderPass,jA as ShadertoyMaterial,HA as ShadertoyTexture,OH as ShapeType2,cy as Signal,ay as SignalHandler,Fy as SimpleEventDispatcher,MI as SimulationFromJSON,SI as SimulationTypes,wI as SizeBySpeed,NB as SizeOverLife,jB as SpeedOverLife,DI as SphereEmitter,KG as SphubeGeometry,VP as SpriteAnimatorEntity,BL as SpriteAnimatorModule,XI as SpriteBatch,PD as SpriteImages,$O as SpriteImagesEntity,fz as SpriteImagesModule,TD as SpriteMarker,JO as SpriteMarkerEntity,pz as SpriteMarkerModule,lB as SpriteParticle,OD as SpriteTexts,eD as SpriteTextsEntity,mz as SpriteTextsModule,nV as StatModule,_z as StateNode,Cy as Store,ZB as SubParticleEmitMode,GL as SucceedingBehavior,jP as SymbolEntity,FE as SymbolModule,Zy as TYPED_ARRAYS,$X as TextureEffect,uI as TextureSequencer,eY as TextureUtils,ry as Time,eQ as ToneMappingEffect,IY as ToneMappingMode,xH as ToolStateModule,QI as TrailBatch,cD as TrailLine,tD as TrailLineEntity,cB as TrailParticle,bU as TransformControls,_U as TransformControlsGizmo,SU as TransformControlsPlane,IU as TransformTool,oI as TurbulenceField,ky as Tween,Ly as TweenManager,bw as UVUnwrapper,gP as UiConfigMethods,xP as UiConfigRendererBase,KT as UiConfigTypeMap,QH as UiModule,yP as UiPanelJsonConfig,cY as UnitsUtils,aU as UpdateValueCommand,xw as UvAtlasWebWorker,UI as VFXBatch,PB as ValueGeneratorFromJSON,XG as VariableTubeGeometry,$w as ViewHelper,QL as WaitForEventBehavior,CF as WebGLRendererModule,gk as WebGPUCompiler,WB as WidthOverLength,rR as Wire,pO as Wireframe,fO as WireframeGeometry2,vY as XHRUtils,sQ as __DEV,tQ as __buildDate,nQ as __buildVerNo,iQ as __buildVersion,Kx as absMax,QC as acceleratedRaycast,aW as addResourceRefCount,vG as addScript,Rx as aesGcmDecrypt,Ix as aesGcmEncrypt,wz as anchorOrigin,xz as anchorTranslate,zy as animation,Uy as animationAsync,cv as applyMixins,Bv as approxArrayEquals,Tv as approxEquals,Ev as approxZero,Qy as arrayBufferToBase64,qy as base64ToArrayBuffer,gv as bindAll,cx as blobToDataURL,GG as buildPathTubeTopo,WG as buildTopoGraph,nW as cameraDistance2NdcZ,wW as cameraWorldDirection,Nx as canvasFlipY,Mv as clamp,$x as clearBit,fv as cloneDeep,TW as cloneMaterial,pS as closestPointOnPolyline,fS as closestPointOnPolylines,lS as closestPointOnSegment,uS as closestToSegment3d,vx as colorToDataUrl,qC as computeBoundsTree,hW as containSkeleton,qw as convertToMaterialParameters,Cx as copyProps,aL as creataMeasureRuler,AA as createAnimatorFrameSpriteMaterial,Hy as createCanvasElement,zU as createDefaultMarkerElement,Wy as createDiv,xE as createFlowGradientMaterial,xL as createFlyline,Gy as createImage,eT as createLabel,DP as createMapApp,nL as createReflectorShaderMesh,IA as createRender2dTexture,bA as createRenderElementFlowMaterial,AW as createScreenSpaceEntity,Xy as createScriptFromURL,hD as createSpriteAnimator,Yy as createStyles,xA as createSymbolMaterial,_A as createTextFlowMaterial,lD as createTextMesh,IG as createUnProjectMenu,JG as createWallBufferGeometry,pw as createWorker,yw as createWorkerWrap,rx as css,lv as debounce,Ik as decryptFromBase64,ew as deepAccessObject,rQ as default,Wv as degToRad,hv as deleteArrItem,mW as disableBloom,vW as disableBloomSelectedRayQuery,gW as disableOutline,pW as disableRayQuery,fW as disableSelected,fy as dispatchViaProxy,ZC as disposeBoundsTree,PW as disposeMaterial,lW as disposeObject3D,wG as dist2d,hx as downloadBlob,dx as downloadFile,Xx as embedUrlRefs,DW as enableMaterialVerticeOpacity,zG as enableRealisticRender,kG as enableSRGBColorSpace,UG as enableShadow,Bk as encryptToBase64,tx as escapeRegExp,sG as eventKeyCode,hG as eventXY,NW as expandLine,RG as explodeGroup,gG as exportRenderTarget,vv as extend,rS as extrudeGeoJSON,iS as extrudePolygon,nS as extrudePolyline,YG as findShortestPath,dy as findSignalHandlerIndexByHandle,uy as findSignalHandlerIndexByHandleAndContext,jG as flatModel,kW as fromDist,IW as fromWorld,nR as genDefaultForNodeValueType,uv as generateUUID,$T as generateUiConfig,eP as generateUiFolder,Xb as geoBounds,jb as geoPoint,tR as getAlignOfNodeValueType,dW as getBoundingBox,UT as getEmptyMeta,Pk as getEntityParents,FG as getEnvmapFromHDRTexture,NG as getEnvmapFromScene,ex as getFilenameFromPath,Hv as getFilterColorMatrix,OG as getFrustum,DG as getFrustumFromHeight,EG as getFullscreenTriangle,tw as getKeyByValue,uW as getObjectAnchorPoint,Ek as getObjectOwnerEntity,rW as getObjectRefCount,Mx as getOrCall,Tk as getOwerScene,vI as getPhysicsResolver,bx as getPropertyDescriptor,PG as getScreenSpaceBox,DH as getShapeParameters,iR as getSizeOfNodeValueType,TG as getSphericalCube,Ky as getTypedArray,nw as getUrlQueryParam,AI as getValueFromEmitterMode,sx as glsl,ib as highlightMaterial,ox as html,qx as htmlToCanvas,Zx as htmlToPng,Qx as htmlToSvg,jk as httpHelper,FT as iMaterialUI,kx as imageBitmapToBase64,Ux as imageDataToCanvas,zx as imageToCanvas,Lx as imageUrlToImageData,yx as includesAll,Rv as infinityToMaxNumber,YW as interpolatePointsByRatio,SG as intersectLine3D,nG as isAltKeyDown,iG as isCtrlKeyDown,aG as isDeleteKey,rG as isEnterKey,oG as isEscKey,Vb as isGeoPointLike,JW as isLeftButton,CW as isMapMode,$W as isMiddleButton,iW as isObjectBehindCamera,sW as isObjectOcclude,yG as isPointInPolygon,_x as isPropertyWritable,eG as isRightButton,tG as isShiftKeyDown,Fx as isWebpExportSupported,Cv as lerp,BG as lerpCameras,xG as lerpCoordinates,Av as lerpEuler,CG as line3dSplit,WW as lineDistance,k_ as lineIntersection,GW as lineSlice,gS as lineSplit,cG as loadImage,JI as loadParticlePlugin,LH as loadPhysicsEngine,Jk as loadPlugin3dtiles,Kk as loadPluginAlgorithm,nx as longestCommonPrefix,NT as makeBasicMaterialUiConfig,zP as makeCameraUiConfig,jx as makeColorSvg,Vx as makeColorSvgCircle,WT as makeGeomertyUiConfig,wP as makeLightUiConfig,HT as makeMaterialUiConfig,LP as makeObject3DUiConfig,jT as makePhongMaterialUiConfig,VT as makePhysicalMaterialUiConfig,zT as makeSamplerUi,Hx as makeTextSvg,BP as map2dUtils,Uv as max2,Lv as max3,kv as maxNumberToInfinity,Pv as maxValue,Fv as min2,zv as min3,Ov as minValue,fx as mobileAndTabletCheck,AG as multiLine3dSplit,vS as multiLineSplit,jy as now,Ak as object2Entity,iw as objectHasOwn,cW as objectTransformToMatrix,bG as offsetCoords,W_ as offsetPolygon,Tx as onChange,Px as onChange2,Ox as onChange3,Hk as openMapDarkStyle,Wk as openMapLightStyle,LG as optimizeModelRender,$y as parseFileExtension,rw as pathJoin,mv as pick,HW as pointDistance,aS as pointToSegmentDistance,lx as prettyScrollbar,lG as preventDefaultEvent,wv as pushObjectStatus,Gv as radToDeg,bW as randColor,_W as randHtmlColor,Dv as randInt,MW as randPoint2D,SW as randPoint3D,nv as reactivity,nB as registerShaderChunks,ow as remoteWorkerURL,Of as render2d,uG as renderTargetToDataUrl,ix as replaceAll,yW as resetUV,Iv as roundToStep,Sx as safeSetProperty,mS as segmentIntersect,MG as segmentIntersect3d,Bx as serializable,Dx as serialize,OW as setMaterialOpacity,gI as setPhysicsResolver,sw as setUrlQueryParam,Zw as shaderMaterial,C_ as simplifyPoints,xv as sleep,jv as smoothPoints,yv as strMd5,Wx as svgToCanvas,Gx as svgToPng,ax as svgUrl,Ok as tea,mG as texImageToCanvas,dG as textureDataToImageData,fG as textureToCanvas,pG as textureToDataUrl,BH as threeToCannon,av as throttle,Ny as timeout,RW as toDist,Jy as toTitleCase,Vv as toVector3,BW as toWorld,Gb as transform,EW as traverseMaterial,z_ as triangle2dArea,F_ as triangulatFlatten,U_ as triangulate,lP as uiButton,dP as uiColor,iP as uiConfig,nP as uiContainer,aP as uiDropdown,mP as uiFolderContainer,uP as uiImage,hP as uiInput,sP as uiMonitor,cP as uiNumber,fP as uiPanelContainer,rP as uiSlider,pP as uiToggle,oP as uiVector,$I as unloadParticlePlugin,Jx as updateBit,ux as uploadFile,px as uploadFileGetContent,UA as useFBO,vw as workerLink,mw as workerProxy,gw as workerTransfer,fw as workerWrap};
